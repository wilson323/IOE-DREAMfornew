# IOE-DREAM 脚本使用指南

> **更新时间**: 2025-12-09
> **版本**: v2.0
> **状态**: ✅ 已修复所有脚本问题

## 📋 脚本概览

### 核心脚本（推荐使用）

| 脚本名称 | 位置 | 功能 | 状态 |
|---------|------|------|------|
| `quick-build.bat` | 根目录 | 快速编译后端微服务 | ✅ 修复完成 |
| `start-all-fixed.bat` | 根目录 | 一键启动完整项目 | ✅ 修复完成 |
| `mobile-build-start-fixed.bat` | 根目录 | 移动端构建启动 | ✅ 修复完成 |
| `stop-all-fixed.bat` | 根目录 | 停止所有服务 | ✅ 修复完成 |

### 微服务脚本

| 脚本名称 | 位置 | 功能 | 状态 |
|---------|------|------|------|
| `build-all-fixed.bat` | microservices/ | 编译微服务 | ✅ 修复完成 |
| `start-services.bat` | microservices/ | 启动微服务 | ✅ 原有脚本 |

## 🚀 快速开始

### 1. 首次编译后端

```bash
# 在项目根目录运行
D:\IOE-DREAM\quick-build.bat
```

**功能**:
- 自动检测Java和Maven环境
- 优先编译microservices-common核心模块
- 编译所有微服务并打包
- 显示构建产物统计

### 2. 启动完整项目

```bash
# 在项目根目录运行
D:\IOE-DREAM\start-all-fixed.bat
```

**启动选项**:
1. 仅启动前端项目
2. 仅启动后端微服务
3. 仅启动移动端项目
4. 启动完整项目（推荐）
5. 启动Web项目（前端+后端）
6. 启动移动全端（前端+后端+移动端）
7. 仅编译项目
8. 检查项目状态

### 3. 移动端开发

```bash
# 在项目根目录运行
D:\IOE-DREAM\mobile-build-start-fixed.bat
```

**移动端选项**:
1. 开发模式启动 (H5)
2. 生产模式构建
3. 微信小程序构建
4. 支付宝小程序构建
5. APP平台构建
6. 全平台构建
7. 仅安装依赖
8. 清理项目

### 4. 停止所有服务

```bash
# 在项目根目录运行
D:\IOE-DREAM\stop-all-fixed.bat
```

**功能**:
- 停止所有Java进程（后端微服务）
- 停止所有Node.js进程（前端和移动端）
- 释放占用端口 (3000, 8080-8095)
- 清理临时文件

## 🔧 脚本特性

### 自动环境检测

- ✅ Java环境自动检测
- ✅ Maven环境自动检测和配置
- ✅ Node.js环境检测
- ✅ 项目结构验证

### 错误处理

- ✅ 详细的错误提示
- ✅ 编译失败时给出解决建议
- ✅ 环境检查失败时明确指导

### 智能路径处理

- ✅ 自动检测Maven安装路径
- ✅ 支持多种Maven安装方式
- ✅ 正确处理Windows路径分隔符

### 编码支持

- ✅ UTF-8编码设置
- ✅ 中文显示支持
- ✅ 控制台输出优化

## 📁 项目结构要求

### 必需目录

```
D:\IOE-DREAM/
├── microservices/              # 后端微服务
│   ├── pom.xml                # Maven主配置
│   ├── microservices-common/  # 公共模块（必须先编译）
│   ├── ioedream-*-service/    # 业务服务
│   └── build-all-fixed.bat    # 微服务编译脚本
├── smart-admin-web-javascript/ # 前端项目
│   └── package.json           # 前端配置
├── smart-app/                  # 移动端项目
│   └── src/manifest.json      # 移动端配置
└── quick-build.bat            # 快速编译脚本
```

### 端口分配

| 服务 | 端口 | 说明 |
|------|------|------|
| 前端 | 3000 | Vue3开发服务器 |
| 移动端H5 | 8081 | UniApp H5开发服务器 |
| 网关服务 | 8080 | API网关 |
| 公共服务 | 8088 | 用户/权限/系统配置 |
| 设备通讯 | 8087 | 设备协议通讯 |
| OA服务 | 8089 | 办公自动化 |
| 门禁服务 | 8090 | 智能门禁 |
| 考勤服务 | 8091 | 考勤管理 |
| 视频服务 | 8092 | 视频监控 |
| 消费服务 | 8094 | 一卡通消费 |
| 访客服务 | 8095 | 访客管理 |

## 🛠️ 环境要求

### 基础环境

- **操作系统**: Windows 10/11
- **Java**: JDK 17+ (推荐 Temurin JDK 17)
- **Node.js**: 16.0+ (推荐 LTS 版本)
- **Maven**: 3.6+ (自动检测)

### 可选环境

- **MySQL**: 8.0+ (数据库)
- **Redis**: 6.0+ (缓存)
- **Git**: 版本控制

## 🔍 故障排除

### 常见问题

#### 1. Maven编译失败

**问题**: `java.lang.ClassNotFoundException: #`

**解决**:
```bash
# 1. 检查Java版本
java -version

# 2. 检查Maven版本
mvn -version

# 3. 使用快速编译脚本
D:\IOE-DREAM\quick-build.bat
```

#### 2. 端口被占用

**问题**: 服务启动失败，端口被占用

**解决**:
```bash
# 1. 停止所有服务
D:\IOE-DREAM\stop-all-fixed.bat

# 2. 检查端口占用
netstat -ano | findstr :8080

# 3. 手动结束占用进程
taskkill /F /PID <进程ID>
```

#### 3. Node.js依赖安装失败

**问题**: npm install 失败

**解决**:
```bash
# 1. 清理npm缓存
npm cache clean --force

# 2. 删除node_modules
rmdir /s /q node_modules

# 3. 使用国内镜像
npm install --registry=https://registry.npmmirror.com
```

#### 4. 前端无法连接后端

**问题**: 前端页面无法访问API

**解决**:
1. 确认后端服务已启动
2. 检查网关服务是否在8080端口运行
3. 查看浏览器控制台的错误信息
4. 确认前端API配置正确

### 脚本执行权限

如果脚本无法执行，请检查：

1. **右键脚本** → **属性** → **解除锁定**
2. **以管理员身份运行**命令提示符
3. **检查杀毒软件**是否阻止脚本执行

## 📞 技术支持

如果遇到无法解决的问题：

1. **检查错误日志**: 查看详细的错误信息
2. **重启服务**: 使用stop-all-fixed.bat停止后重新启动
3. **检查环境**: 确认Java、Node.js版本正确
4. **清理缓存**: 清理Maven和npm缓存
5. **查看文档**: 阅读项目相关文档

## 📝 更新日志

### v2.0 (2025-12-09)

- ✅ 修复所有脚本执行问题
- ✅ 添加自动环境检测
- ✅ 优化错误处理和提示
- ✅ 添加移动端支持
- ✅ 创建快速编译脚本
- ✅ 完善文档和使用指南

### v1.0 (历史版本)

- ❌ 脚本执行失败
- ❌ 环境检测不完善
- ❌ 错误处理不够友好

---

**💡 提示**: 建议收藏此文档，方便后续使用脚本时参考。