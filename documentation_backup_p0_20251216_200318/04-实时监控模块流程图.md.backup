# ZKBioSecurity-ACC门禁系统 - 实时监控模块流程图

## 实时监控模块流程图

```mermaid
graph TB
    subgraph 实时监控模块
        MonitorStart(实时监控开始) --> MonitorChoose{选择监控类型}

        MonitorChoose -->|实时状态监控| StatusMonitor
        MonitorChoose -->|报警处理| AlarmProcess
        MonitorChoose -->|视频联动| VideoLinkage
        MonitorChoose -->|人员追踪| PersonTrack

        subgraph 实时状态监控流程
            StatusMonitor --> DeviceConnect[设备连接]
            DeviceConnect --> StatusSubscribe[状态订阅]
            StatusSubscribe --> RealtimeUpdate[实时更新]
            RealtimeUpdate --> ExceptionCheck{异常处理}
            ExceptionCheck -->|是| ExceptionHandle[异常处理]
            ExceptionCheck -->|否| MonitorContinue[继续监控]
            ExceptionHandle --> MonitorContinue
            MonitorContinue --> StatusEnd[状态监控完成]
        end

        subgraph 报警处理流程
            AlarmProcess --> AlarmReceive[报警接收]
            AlarmReceive --> AlarmAnalysis[报警分析]
            AlarmAnalysis --> AlarmPush[报警推送]
            AlarmPush --> AlarmHandle[报警处理]
            AlarmHandle --> AlarmRecord[报警记录]
            AlarmRecord --> AlarmEnd[报警处理完成]
        end

        subgraph 视频联动流程
            VideoLinkage --> EventTrigger[事件触发]
            EventTrigger --> CameraSelect[摄像头选择]
            CameraSelect --> VideoStart[录像启动]
            VideoStart --> VideoStore[存储关联]
            VideoStore --> VideoEnd[视频联动完成]
        end

        subgraph 人员追踪流程
            PersonTrack --> TrackCollect[轨迹收集]
            TrackCollect --> TrackAnalysis[轨迹分析]
            TrackAnalysis --> PositionCalc[位置计算]
            PositionCalc --> TrackDisplay[轨迹展示]
            TrackDisplay --> AbnormalCheck{异常检测}
            AbnormalCheck -->|是| AbnormalAlert[异常告警]
            AbnormalCheck -->|否| TrackEnd[追踪完成]
            AbnormalAlert --> TrackEnd
        end
    end
```

## 流程说明

### 实时状态监控流程
1. **设备连接**：建立与门禁设备的连接
2. **状态订阅**：订阅设备状态变化通知
3. **实时更新**：接收并处理设备状态更新
4. **异常处理**：检测和处理设备异常状态
5. **继续监控**：持续监控设备状态

### 报警处理流程
1. **报警接收**：接收来自各系统的报警信息
2. **报警分析**：分析报警类型、级别和影响范围
3. **报警推送**：向相关人员推送报警通知
4. **报警处理**：相关人员处理报警事件
5. **报警记录**：记录报警处理过程和结果

### 视频联动流程
1. **事件触发**：门禁事件触发视频联动
2. **摄像头选择**：根据事件位置选择最近的摄像头
3. **录像启动**：启动录像和抓拍
4. **存储关联**：将视频文件与门禁事件关联存储

### 人员追踪流程
1. **轨迹收集**：收集人员在各区域的进出记录
2. **轨迹分析**：分析人员移动轨迹和停留时间
3. **位置计算**：计算人员当前精确位置
4. **轨迹展示**：在地图上展示人员移动轨迹
5. **异常检测**：检测异常移动和长时间逗留

## 关键控制点
## 📋 IOE-DREAM七微服务架构

**核心架构组成**:
- **Gateway Service (8080)**: API网关
- **Common Service (8088)**: 公共模块微服务
- **DeviceComm Service (8087)**: 设备通讯微服务
- **OA Service (8089)**: OA微服务
- **Access Service (8090)**: 门禁服务
- **Attendance Service (8091)**: 考勤服务
- **Video Service (8092)**: 视频服务
- **Consume Service (8094)**: 消费服务
- **Visitor Service (8095)**: 访客服务

**架构特点**:
- 基于Spring Boot 3.5.8 + Java 17
- 严格遵循企业级微服务规范
- 支持高并发、高可用、水平扩展

**技术栈标准**:
- **数据库**: MySQL 8.0 + Druid连接池
- **缓存**: Redis + Caffeine多级缓存
- **注册中心**: Nacos
- **配置中心**: Nacos Config
- **认证授权**: Sa-Token
- 设备状态监控延迟不超过5秒
## 🏗️ 四层架构规范

**标准架构模式**:
```
Controller (接口控制层)
    ↓
Service (核心业务层)
    ↓
Manager (流程管理层)
    ↓
DAO (数据访问层)
```

**层级职责**:
- **Controller层**: HTTP请求处理、参数验证、权限控制
- **Service层**: 核心业务逻辑、事务管理、业务规则验证
- **Manager层**: 复杂流程编排、多数据组装、第三方服务集成
- **DAO层**: 数据库CRUD操作、SQL查询实现、数据访问边界

**严格禁止跨层访问**: Controller不能直接调用Manager/DAO！
- 紧急报警必须在30秒内响应
## ⚠️ IOE-DREAM零容忍规则（强制执行）

**必须遵守的架构规则**:
- ✅ **必须使用 @Resource 注入依赖**
- ✅ **必须使用 @Mapper 注解** (禁止@Repository)
- ✅ **必须使用 Dao 后缀** (禁止Repository)
- ✅ **必须使用 @RestController 注解**
- ✅ **必须使用 @Valid 参数校验**
- ✅ **必须返回统一ResponseDTO格式**
- ✅ **必须遵循四层架构边界**

**严格禁止事项**:
- ❌ **禁止使用 @Autowired 注入**
- ❌ **禁止使用 @Repository 注解**
- ❌ **禁止使用 Repository 后缀命名**
- ❌ **禁止跨层访问**
- ❌ **禁止在Controller中包含业务逻辑**
- ❌ **禁止直接访问数据库**

**违规后果**: P0级问题，立即修复，禁止合并！
- 视频联动必须在2秒内启动录像
- 人员位置计算误差控制在2米内
- 报警处理必须记录完整的操作日志

## 性能指标
- 设备状态更新频率：≤ 1秒
- 报警响应时间：≤ 30秒
- 视频联动响应时间：≤ 2秒
- 轨迹数据采集频率：≤ 3秒
- 异常检测准确率：≥ 95%

## 注意事项
- 实时监控需要处理大量并发数据，注意性能优化
- 视频联动需要预先配置摄像头与门禁点的对应关系
- 人员追踪需要考虑隐私保护，只允许授权人员查看
- 报警处理需要建立完善的升级机制，确保重要报警不被遗漏