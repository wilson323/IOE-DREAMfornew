# ç­æ¬¡æ—¶é—´åŠŸèƒ½å¸ƒå±€æ–‡æ¡£ - å®Œæ•´ç‰ˆ

## åŠŸèƒ½æ¦‚è¿°

ç­æ¬¡æ—¶é—´ç®¡ç†æ¨¡å—æ˜¯è€ƒå‹¤ç³»ç»Ÿçš„æ ¸å¿ƒæ—¶é—´é…ç½®ä¸­å¿ƒï¼Œè´Ÿè´£ç®¡ç†æ—¶é—´æ®µã€ç­æ¬¡ã€ç­æ¬¡æ—¶é—´å…³è”å’Œç­æ¬¡æ¨¡æ¿ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—æä¾›çµæ´»çš„æ—¶é—´é…ç½®æ–¹æ¡ˆï¼Œæ”¯æŒæ ‡å‡†ç­æ¬¡ã€ç‰¹æ®Šç­æ¬¡ã€è½®ç­ç­æ¬¡ç­‰å¤šç§ç­æ¬¡ç±»å‹ï¼Œèƒ½å¤Ÿæ»¡è¶³ä¸åŒä¼ä¸šçš„å¤šæ ·åŒ–å·¥ä½œæ—¶é—´éœ€æ±‚ã€‚

## æŠ€æœ¯æ¶æ„è§„èŒƒ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶**: Vue 3.4.27 (Composition API)
- **UIç»„ä»¶åº“**: Ant Design Vue 4.2.5
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1.7
- **è·¯ç”±ç®¡ç†**: Vue Router 4.3.2
- **HTTPå®¢æˆ·ç«¯**: Axios 1.6.8
- **æ—¶é—´å¤„ç†**: Day.js
- **æ‹–æ‹½ç»„ä»¶**: Vue.Draggable
- **æ ·å¼é¢„å¤„ç†å™¨**: Less 4.2.0
- **å›¾æ ‡åº“**: @ant-design/icons-vue

### é¡¹ç›®æ–‡ä»¶ç»„ç»‡ç»“æ„
```
src/views/business/attendance/shift/
â”œâ”€â”€ index.vue                        # ç­æ¬¡æ—¶é—´ä¸»é¡µé¢
â”œâ”€â”€ time-period/
â”‚   â”œâ”€â”€ index.vue                   # æ—¶é—´æ®µç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ TimePeriodForm.vue      # æ—¶é—´æ®µè¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ TimePeriodGroup.vue     # æ—¶é—´æ®µç»„ç»„ä»¶
â”‚   â”‚   â””â”€â”€ TimePeriodTemplate.vue  # æ—¶é—´æ®µæ¨¡æ¿ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ time-period-api.js      # æ—¶é—´æ®µAPI
â”œâ”€â”€ shift/
â”‚   â”œâ”€â”€ index.vue                   # ç­æ¬¡ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ShiftForm.vue           # ç­æ¬¡è¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ShiftCard.vue           # ç­æ¬¡å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ SpecialShiftForm.vue    # ç‰¹æ®Šç­æ¬¡è¡¨å•
â”‚   â”‚   â””â”€â”€ ShiftConfig.vue         # ç­æ¬¡é…ç½®ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ shift-api.js            # ç­æ¬¡API
â”œâ”€â”€ association/
â”‚   â”œâ”€â”€ index.vue                   # ç­æ¬¡æ—¶é—´å…³è”é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ StandardShiftAssoc.vue  # æ ‡å‡†ç­æ¬¡å…³è”
â”‚   â”‚   â”œâ”€â”€ RotationShiftAssoc.vue  # è½®ç­ç­æ¬¡å…³è”
â”‚   â”‚   â””â”€â”€ ComplexShiftConfig.vue  # å¤æ‚ç­æ¬¡é…ç½®
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ association-api.js      # å…³è”API
â”œâ”€â”€ template/
â”‚   â”œâ”€â”€ index.vue                   # ç­æ¬¡æ¨¡æ¿é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ DeptTemplate.vue        # éƒ¨é—¨ç­æ¬¡æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ PersonalTemplate.vue    # ä¸ªäººç­æ¬¡æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ TemplateApply.vue       # æ¨¡æ¿åº”ç”¨ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ template-api.js         # æ¨¡æ¿API
â”œâ”€â”€ mock/
â”‚   â””â”€â”€ shift-mock.js               # æ¨¡æ‹Ÿæ•°æ®
â”œâ”€â”€ api/
â”‚   â””â”€â”€ shift-api.js                # ç»Ÿä¸€APIæ¥å£
â””â”€â”€ utils/
    â”œâ”€â”€ time-utils.js               # æ—¶é—´å·¥å…·å‡½æ•°
    â”œâ”€â”€ shift-utils.js              # ç­æ¬¡å·¥å…·å‡½æ•°
    â””â”€â”€ calendar-utils.js           # æ—¥å†å·¥å…·å‡½æ•°
```

### APIæ¥å£è®¾è®¡
```javascript
// src/api/business/attendance/shift/time-period-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const timePeriodApi = {
  // åŸºç¡€æ—¶é—´æ®µ
  getTimePeriods: (params) => getRequest('/attendance/shift/time-period/list', params),
  createTimePeriod: (params) => postRequest('/attendance/shift/time-period/create', params),
  updateTimePeriod: (id, params) => putRequest(`/attendance/shift/time-period/update/${id}`, params),
  deleteTimePeriod: (id) => deleteRequest(`/attendance/shift/time-period/delete/${id}`),

  // æ—¶é—´æ®µç»„
  getTimePeriodGroups: (params) => getRequest('/attendance/shift/time-period/group/list', params),
  createTimePeriodGroup: (params) => postRequest('/attendance/shift/time-period/group/create', params),
  updateTimePeriodGroup: (id, params) => putRequest(`/attendance/shift/time-period/group/update/${id}`, params),

  // æ—¶é—´æ®µæ¨¡æ¿
  getTimePeriodTemplates: () => getRequest('/attendance/shift/time-period/templates'),
  applyTimePeriodTemplate: (templateId, params) => postRequest(`/attendance/shift/time-period/template/${templateId}/apply`, params),
};

// src/api/business/attendance/shift/shift-api.js
export const shiftApi = {
  // ç­æ¬¡ç®¡ç†
  getShifts: (params) => getRequest('/attendance/shift/list', params),
  createShift: (params) => postRequest('/attendance/shift/create', params),
  updateShift: (id, params) => putRequest(`/attendance/shift/update/${id}`, params),
  deleteShift: (id) => deleteRequest(`/attendance/shift/delete/${id}`),

  // ç‰¹æ®Šç­æ¬¡
  getSpecialShifts: (params) => getRequest('/attendance/shift/special/list', params),
  createSpecialShift: (params) => postRequest('/attendance/shift/special/create', params),
  updateSpecialShift: (id, params) => putRequest(`/attendance/shift/special/update/${id}`, params),

  // ç­æ¬¡é…ç½®
  getShiftConfig: (shiftId) => getRequest(`/attendance/shift/${shiftId}/config`),
  updateShiftConfig: (shiftId, params) => putRequest(`/attendance/shift/${shiftId}/config`, params),

  // ç­æ¬¡å¤åˆ¶
  copyShift: (shiftId, params) => postRequest(`/attendance/shift/${shiftId}/copy`, params),
};

// src/api/business/attendance/shift/association-api.js
export const associationApi = {
  // æ ‡å‡†ç­æ¬¡å…³è”
  getStandardShiftAssociations: (params) => getRequest('/attendance/shift/association/standard/list', params),
  createStandardShiftAssociation: (params) => postRequest('/attendance/shift/association/standard/create', params),
  updateStandardShiftAssociation: (id, params) => putRequest(`/attendance/shift/association/standard/update/${id}`, params),

  // è½®ç­ç­æ¬¡å…³è”
  getRotationShiftAssociations: (params) => getRequest('/attendance/shift/association/rotation/list', params),
  createRotationShiftAssociation: (params) => postRequest('/attendance/shift/association/rotation/create', params),

  // å¤æ‚ç­æ¬¡é…ç½®
  getComplexShiftConfigs: (params) => getRequest('/attendance/shift/association/complex/list', params),
  createComplexShiftConfig: (params) => postRequest('/attendance/shift/association/complex/create', params),
};
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 1. æ—¶é—´æ®µç®¡ç†
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

#### æ—¶é—´æ®µè¡¨å•ç»„ä»¶
```vue
<!-- src/views/business/attendance/shift/time-period/components/TimePeriodForm.vue -->
<template>
  <a-modal
    :open="visible"
    :title="isEditing ? 'ç¼–è¾‘æ—¶é—´æ®µ' : 'æ–°å¢æ—¶é—´æ®µ'"
    @ok="handleSubmit"
    @cancel="handleCancel"
    :confirm-loading="loading"
    width="800px"
  >
    <a-form
      ref="formRef"
      :model="formData"
      :rules="formRules"
      :label-col="{ span: 6 }"
      :wrapper-col="{ span: 18 }"
    >
      <a-form-item label="æ—¶é—´æ®µåç§°" name="name">
        <a-input v-model:value="formData.name" placeholder="è¯·è¾“å…¥æ—¶é—´æ®µåç§°" />
      </a-form-item>

      <a-form-item label="æ—¶é—´æ®µç±»å‹" name="type">
        <a-radio-group v-model:value="formData.type" @change="handleTypeChange">
          <a-radio value="work">å·¥ä½œæ—¶é—´</a-radio>
          <a-radio value="break">ä¼‘æ¯æ—¶é—´</a-radio>
          <a-radio value="overtime">åŠ ç­æ—¶é—´</a-radio>
          <a-radio value="flexible">å¼¹æ€§æ—¶é—´</a-radio>
        </a-radio-group>
      </a-form-item>

      <a-form-item label="æ—¶é—´èŒƒå›´" name="timeRange">
        <a-time-range-picker
          v-model:value="formData.timeRange"
          format="HH:mm"
          placeholder="['å¼€å§‹æ—¶é—´', 'ç»“æŸæ—¶é—´']"
          style="width: 100%"
        />
      </a-form-item>

      <a-form-item label="è·¨å¤©è®¾ç½®" name="crossDay" v-if="needCrossDay">
        <a-switch v-model:checked="formData.crossDay" @change="handleCrossDayChange" />
        <span style="margin-left: 8px; color: #666;">æ—¶é—´æ®µè·¨è¶Šåˆå¤œ</span>
      </a-form-item>

      <a-form-item label="å·¥ä½œæ—¶é•¿" name="duration">
        <a-input-group compact>
          <a-input-number
            v-model:value="formData.duration.hours"
            :min="0"
            :max="24"
            placeholder="å°æ—¶"
            style="width: 100px"
          />
          <a-input
            style="width: 30px; text-align: center; border-left: 0; pointer-events: none"
            placeholder="æ—¶"
            disabled
          />
          <a-input-number
            v-model:value="formData.duration.minutes"
            :min="0"
            :max="59"
            placeholder="åˆ†é’Ÿ"
            style="width: 100px; border-left: 0"
          />
          <a-input
            style="width: 30px; text-align: center; border-left: 0; pointer-events: none"
            placeholder="åˆ†"
            disabled
          />
        </a-input-group>
      </a-form-item>

      <a-form-item label="è®¡è–ªè§„åˆ™" name="payRule">
        <a-select v-model:value="formData.payRule" placeholder="è¯·é€‰æ‹©è®¡è–ªè§„åˆ™">
          <a-select-option value="full">å…¨é¢è®¡è–ª</a-select-option>
          <a-select-option value="proportional">æŒ‰æ¯”ä¾‹è®¡è–ª</a-select-option>
          <a-select-option value="overtime">åŠ ç­è®¡è–ª</a-select-option>
          <a-select-option value="none">ä¸è®¡è–ª</a-select-option>
        </a-select>
      </a-form-item>

      <a-form-item label="è€ƒå‹¤è¦æ±‚" name="attendanceRequirement">
        <a-checkbox-group v-model:value="formData.attendanceRequirement">
          <a-checkbox value="clockIn">éœ€è¦ä¸Šç­æ‰“å¡</a-checkbox>
          <a-checkbox value="clockOut">éœ€è¦ä¸‹ç­æ‰“å¡</a-checkbox>
          <a-checkbox value="gpsRequired">éœ€è¦GPSå®šä½</a-checkbox>
          <a-checkbox value="photoRequired">éœ€è¦æ‹ç…§éªŒè¯</a-checkbox>
        </a-checkbox-group>
      </a-form-item>

      <a-form-item label="å¼¹æ€§è®¾ç½®" name="flexibleSettings" v-if="formData.type === 'flexible'">
        <div class="flexible-settings">
          <div class="setting-item">
            <label>æœ€æ—©æ‰“å¡æ—¶é—´ï¼š</label>
            <a-time-picker
              v-model:value="formData.flexibleSettings.earliestClockIn"
              format="HH:mm"
              placeholder="é€‰æ‹©æ—¶é—´"
            />
          </div>
          <div class="setting-item">
            <label>æœ€æ™šæ‰“å¡æ—¶é—´ï¼š</label>
            <a-time-picker
              v-model:value="formData.flexibleSettings.latestClockIn"
              format="HH:mm"
              placeholder="é€‰æ‹©æ—¶é—´"
            />
          </div>
          <div class="setting-item">
            <label>æœ€çŸ­å·¥ä½œæ—¶é•¿ï¼š</label>
            <a-input-number
              v-model:value="formData.flexibleSettings.minWorkHours"
              :min="0"
              :max="24"
              :step="0.5"
              placeholder="å°æ—¶"
            />
            <span style="margin-left: 8px;">å°æ—¶</span>
          </div>
        </div>
      </a-form-item>

      <a-form-item label="æè¿°" name="description">
        <a-textarea v-model:value="formData.description" placeholder="è¯·è¾“å…¥æ—¶é—´æ®µæè¿°" :rows="3" />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive, computed, watch } from 'vue';
import { message } from 'ant-design-vue';
import dayjs from 'dayjs';
import { timePeriodApi } from '/@/api/business/attendance/shift/time-period-api';

const props = defineProps({
  visible: Boolean,
  isEditing: Boolean,
  periodData: Object,
});

const emit = defineEmits(['update:visible', 'success']);

const formRef = ref();
const loading = ref(false);

const formData = reactive({
  name: '',
  type: 'work',
  timeRange: [],
  crossDay: false,
  duration: {
    hours: 8,
    minutes: 0
  },
  payRule: 'full',
  attendanceRequirement: ['clockIn', 'clockOut'],
  flexibleSettings: {
    earliestClockIn: null,
    latestClockIn: null,
    minWorkHours: 8
  },
  description: ''
});

const formRules = {
  name: [
    { required: true, message: 'è¯·è¾“å…¥æ—¶é—´æ®µåç§°', trigger: 'blur' }
  ],
  type: [
    { required: true, message: 'è¯·é€‰æ‹©æ—¶é—´æ®µç±»å‹', trigger: 'change' }
  ],
  timeRange: [
    { required: true, message: 'è¯·é€‰æ‹©æ—¶é—´èŒƒå›´', trigger: 'change' }
  ],
  duration: [
    { required: true, message: 'è¯·è®¾ç½®å·¥ä½œæ—¶é•¿', trigger: 'blur' }
  ],
  payRule: [
    { required: true, message: 'è¯·é€‰æ‹©è®¡è–ªè§„åˆ™', trigger: 'change' }
  ]
};

// æ˜¯å¦éœ€è¦è·¨å¤©è®¾ç½®
const needCrossDay = computed(() => {
  if (formData.timeRange.length === 2) {
    const start = formData.timeRange[0];
    const end = formData.timeRange[1];
    return start && end && end.isBefore(start);
  }
  return false;
});

// ç›‘å¬propså˜åŒ–
watch(() => props.visible, (visible) => {
  if (visible) {
    initForm();
  }
});

// ç›‘å¬æ—¶é—´èŒƒå›´å˜åŒ–ï¼Œè‡ªåŠ¨è®¡ç®—æ—¶é•¿
watch(() => formData.timeRange, (newRange) => {
  if (newRange.length === 2 && newRange[0] && newRange[1]) {
    calculateDuration();
  }
});

// åˆå§‹åŒ–è¡¨å•
const initForm = () => {
  if (props.isEditing && props.periodData) {
    Object.assign(formData, {
      ...props.periodData,
      timeRange: props.periodData.startTime && props.periodData.endTime
        ? [dayjs(props.periodData.startTime, 'HH:mm'), dayjs(props.periodData.endTime, 'HH:mm')]
        : []
    });
  } else {
    resetForm();
  }
};

// é‡ç½®è¡¨å•
const resetForm = () => {
  Object.assign(formData, {
    name: '',
    type: 'work',
    timeRange: [],
    crossDay: false,
    duration: {
      hours: 8,
      minutes: 0
    },
    payRule: 'full',
    attendanceRequirement: ['clockIn', 'clockOut'],
    flexibleSettings: {
      earliestClockIn: null,
      latestClockIn: null,
      minWorkHours: 8
    },
    description: ''
  });
};

// ç±»å‹å˜åŒ–å¤„ç†
const handleTypeChange = () => {
  // æ ¹æ®ç±»å‹è®¾ç½®é»˜è®¤å€¼
  if (formData.type === 'break') {
    formData.payRule = 'none';
    formData.attendanceRequirement = [];
  } else if (formData.type === 'work') {
    formData.attendanceRequirement = ['clockIn', 'clockOut'];
  }
};

// è·¨å¤©è®¾ç½®å˜åŒ–
const handleCrossDayChange = (checked) => {
  if (!checked) {
    // å–æ¶ˆè·¨å¤©æ—¶ï¼Œè°ƒæ•´æ—¶é—´èŒƒå›´
    if (formData.timeRange.length === 2) {
      const start = formData.timeRange[0];
      const end = formData.timeRange[1];
      if (start && end && end.isBefore(start)) {
        formData.timeRange[1] = start.add(8, 'hour');
      }
    }
  }
};

// è®¡ç®—æ—¶é•¿
const calculateDuration = () => {
  const start = formData.timeRange[0];
  const end = formData.timeRange[1];

  if (start && end) {
    let duration;
    if (formData.crossDay) {
      // è·¨å¤©è®¡ç®—
      duration = end.add(1, 'day').diff(start, 'minute');
    } else {
      duration = end.diff(start, 'minute');
    }

    formData.duration.hours = Math.floor(duration / 60);
    formData.duration.minutes = duration % 60;
  }
};

// æäº¤è¡¨å•
const handleSubmit = async () => {
  try {
    await formRef.value.validate();
    loading.value = true;

    const submitData = {
      ...formData,
      startTime: formData.timeRange[0].format('HH:mm'),
      endTime: formData.timeRange[1].format('HH:mm'),
      duration: formData.duration.hours * 60 + formData.duration.minutes
    };

    if (props.isEditing) {
      await timePeriodApi.updateTimePeriod(props.periodData.id, submitData);
      message.success('æ—¶é—´æ®µæ›´æ–°æˆåŠŸ');
    } else {
      await timePeriodApi.createTimePeriod(submitData);
      message.success('æ—¶é—´æ®µåˆ›å»ºæˆåŠŸ');
    }

    emit('success');
    handleCancel();
  } catch (error) {
    if (error.errorFields) {
      message.error('è¯·æ£€æŸ¥è¡¨å•å¡«å†™æ˜¯å¦æ­£ç¡®');
    } else {
      message.error(props.isEditing ? 'æ—¶é—´æ®µæ›´æ–°å¤±è´¥' : 'æ—¶é—´æ®µåˆ›å»ºå¤±è´¥');
    }
  } finally {
    loading.value = false;
  }
};

// å–æ¶ˆ
const handleCancel = () => {
  emit('update:visible', false);
  formRef.value?.resetFields();
};
</script>

<style scoped lang="less">
.flexible-settings {
  .setting-item {
    display: flex;
    align-items: center;
    margin-bottom: 12px;

    label {
      width: 120px;
      text-align: right;
      margin-right: 8px;
      color: #666;
    }
  }
}
</style>
```

### 2. ç­æ¬¡ç®¡ç†

#### ç­æ¬¡å¡ç‰‡ç»„ä»¶
```vue
<!-- src/views/business/attendance/shift/shift/components/ShiftCard.vue -->
<template>
  <div class="shift-card" :class="{ active: selected, disabled: !enabled }">
    <div class="card-header">
      <div class="shift-info">
        <h4 class="shift-name">{{ shiftData.name }}</h4>
        <a-tag :color="getShiftTypeColor(shiftData.type)">{{ getShiftTypeText(shiftData.type) }}</a-tag>
      </div>
      <div class="shift-actions">
        <a-dropdown>
          <template #overlay>
            <a-menu @click="({ key }) => handleMenuClick(key)">
              <a-menu-item key="edit">
                <EditOutlined />
                ç¼–è¾‘
              </a-menu-item>
              <a-menu-item key="copy">
                <CopyOutlined />
                å¤åˆ¶
              </a-menu-item>
              <a-menu-item key="config">
                <SettingOutlined />
                é…ç½®
              </a-menu-item>
              <a-menu-divider />
              <a-menu-item key="enable" v-if="!enabled">
                <CheckCircleOutlined />
                å¯ç”¨
              </a-menu-item>
              <a-menu-item key="disable" v-if="enabled">
                <StopOutlined />
                ç¦ç”¨
              </a-menu-item>
              <a-menu-item key="delete" class="danger">
                <DeleteOutlined />
                åˆ é™¤
              </a-menu-item>
            </a-menu>
          </template>
          <a-button type="text" size="small">
            <MoreOutlined />
          </a-button>
        </a-dropdown>
      </div>
    </div>

    <div class="card-content">
      <div class="time-periods">
        <div
          v-for="(period, index) in shiftData.timePeriods"
          :key="index"
          class="time-period"
        >
          <div class="period-time">
            <ClockCircleOutlined />
            {{ period.startTime }} - {{ period.endTime }}
          </div>
          <div class="period-info">
            <span class="period-name">{{ period.name }}</span>
            <span class="period-duration">{{ formatDuration(period.duration) }}</span>
          </div>
        </div>
      </div>

      <div class="shift-stats">
        <div class="stat-item">
          <span class="label">å·¥ä½œæ—¶é•¿ï¼š</span>
          <span class="value">{{ getTotalWorkTime() }}</span>
        </div>
        <div class="stat-item">
          <span class="label">ä¼‘æ¯æ—¶é•¿ï¼š</span>
          <span class="value">{{ getTotalBreakTime() }}</span>
        </div>
        <div class="stat-item">
          <span class="label">é€‚ç”¨äººæ•°ï¼š</span>
          <span class="value">{{ shiftData.employeeCount || 0 }}äºº</span>
        </div>
      </div>
    </div>

    <div class="card-footer">
      <div class="shift-tags">
        <a-tag v-for="tag in shiftData.tags" :key="tag" size="small">{{ tag }}</a-tag>
      </div>
      <div class="shift-status">
        <a-badge :status="enabled ? 'success' : 'default'" />
        <span>{{ enabled ? 'å¯ç”¨' : 'ç¦ç”¨' }}</span>
      </div>
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import {
  MoreOutlined,
  EditOutlined,
  CopyOutlined,
  SettingOutlined,
  CheckCircleOutlined,
  StopOutlined,
  DeleteOutlined,
  ClockCircleOutlined
} from '@ant-design/icons-vue';

const props = defineProps({
  shiftData: {
    type: Object,
    required: true
  },
  selected: {
    type: Boolean,
    default: false
  },
  enabled: {
    type: Boolean,
    default: true
  }
});

const emit = defineEmits(['edit', 'copy', 'config', 'enable', 'disable', 'delete', 'select']);

// è·å–ç­æ¬¡ç±»å‹é¢œè‰²
const getShiftTypeColor = (type) => {
  const colorMap = {
    standard: 'blue',
    rotation: 'green',
    special: 'orange',
    flexible: 'purple'
  };
  return colorMap[type] || 'default';
};

// è·å–ç­æ¬¡ç±»å‹æ–‡æœ¬
const getShiftTypeText = (type) => {
  const typeMap = {
    standard: 'æ ‡å‡†ç­æ¬¡',
    rotation: 'è½®ç­ç­æ¬¡',
    special: 'ç‰¹æ®Šç­æ¬¡',
    flexible: 'å¼¹æ€§ç­æ¬¡'
  };
  return typeMap[type] || 'æœªçŸ¥';
};

// æ ¼å¼åŒ–æ—¶é•¿
const formatDuration = (minutes) => {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  return `${hours}å°æ—¶${mins > 0 ? mins + 'åˆ†é’Ÿ' : ''}`;
};

// è®¡ç®—æ€»å·¥ä½œæ—¶é—´
const getTotalWorkTime = () => {
  const workPeriods = props.shiftData.timePeriods?.filter(p => p.type === 'work') || [];
  const totalMinutes = workPeriods.reduce((sum, period) => sum + (period.duration || 0), 0);
  return formatDuration(totalMinutes);
};

// è®¡ç®—æ€»ä¼‘æ¯æ—¶é—´
const getTotalBreakTime = () => {
  const breakPeriods = props.shiftData.timePeriods?.filter(p => p.type === 'break') || [];
  const totalMinutes = breakPeriods.reduce((sum, period) => sum + (period.duration || 0), 0);
  return formatDuration(totalMinutes);
};

// èœå•ç‚¹å‡»å¤„ç†
const handleMenuClick = (key) => {
  switch (key) {
    case 'edit':
      emit('edit', props.shiftData);
      break;
    case 'copy':
      emit('copy', props.shiftData);
      break;
    case 'config':
      emit('config', props.shiftData);
      break;
    case 'enable':
      emit('enable', props.shiftData);
      break;
    case 'disable':
      emit('disable', props.shiftData);
      break;
    case 'delete':
      emit('delete', props.shiftData);
      break;
  }
};
</script>

<style scoped lang="less">
.shift-card {
  border: 1px solid #f0f0f0;
  border-radius: 8px;
  padding: 16px;
  background: #fff;
  cursor: pointer;
  transition: all 0.3s;
  height: 100%;
  display: flex;
  flex-direction: column;

  &:hover {
    border-color: #1890ff;
    box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);
  }

  &.active {
    border-color: #1890ff;
    background: #f0f8ff;
  }

  &.disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;

    .shift-info {
      flex: 1;

      .shift-name {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: 600;
        color: #262626;
      }
    }
  }

  .card-content {
    flex: 1;
    margin-bottom: 12px;

    .time-periods {
      margin-bottom: 12px;

      .time-period {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 8px;
        background: #fafafa;
        border-radius: 4px;
        margin-bottom: 4px;

        .period-time {
          display: flex;
          align-items: center;
          gap: 6px;
          font-size: 14px;
          color: #1890ff;
          font-weight: 500;
        }

        .period-info {
          display: flex;
          align-items: center;
          gap: 8px;

          .period-name {
            font-size: 12px;
            color: #666;
          }

          .period-duration {
            font-size: 12px;
            color: #999;
          }
        }
      }
    }

    .shift-stats {
      .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        font-size: 13px;

        .label {
          color: #666;
        }

        .value {
          font-weight: 500;
          color: #262626;
        }
      }
    }
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #f0f0f0;
    padding-top: 8px;

    .shift-tags {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .shift-status {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #666;
    }
  }
}
</style>
```

### 3. ç­æ¬¡æ¨¡æ¿åº”ç”¨

```vue
<!-- src/views/business/attendance/shift/template/components/TemplateApply.vue -->
<template>
  <div class="template-apply">
    <div class="apply-header">
      <h4>åº”ç”¨ç­æ¬¡æ¨¡æ¿</h4>
      <a-steps :current="currentStep" size="small">
        <a-step title="é€‰æ‹©æ¨¡æ¿" />
        <a-step title="é…ç½®å‚æ•°" />
        <a-step title="ç¡®è®¤åº”ç”¨" />
      </a-steps>
    </div>

    <!-- æ­¥éª¤1ï¼šé€‰æ‹©æ¨¡æ¿ -->
    <div v-show="currentStep === 0" class="step-content">
      <div class="template-selection">
        <div class="template-filters">
          <a-input-search
            v-model:value="searchKeyword"
            placeholder="æœç´¢æ¨¡æ¿åç§°"
            style="width: 300px; margin-bottom: 16px"
            @search="handleSearch"
          />
        </div>

        <div class="template-grid">
          <div
            v-for="template in filteredTemplates"
            :key="template.id"
            class="template-item"
            :class="{ selected: selectedTemplateId === template.id }"
            @click="selectTemplate(template)"
          >
            <div class="template-preview">
              <div class="template-header">
                <h5>{{ template.name }}</h5>
                <a-tag :color="getTemplateTypeColor(template.type)">
                  {{ getTemplateTypeText(template.type) }}
                </a-tag>
              </div>
              <div class="template-info">
                <p class="template-desc">{{ template.description }}</p>
                <div class="template-meta">
                  <span><CalendarOutlined /> {{ getWeekdaysText(template.weekdays) }}</span>
                  <span><ClockCircleOutlined /> {{ template.shiftCount }}ä¸ªç­æ¬¡</span>
                  <span><TeamOutlined /> é€‚ç”¨{{ templateé€‚ç”¨èŒƒå›´ || 'å…¨éƒ¨' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ­¥éª¤2ï¼šé…ç½®å‚æ•° -->
    <div v-show="currentStep === 1" class="step-content">
      <a-form
        ref="configFormRef"
        :model="configForm"
        :rules="configRules"
        layout="vertical"
      >
        <a-form-item label="åº”ç”¨èŒƒå›´" name="scope">
          <a-radio-group v-model:value="configForm.scope.type">
            <a-radio value="department">éƒ¨é—¨</a-radio>
            <a-radio value="position">å²—ä½</a-radio>
            <a-radio value="employee">å‘˜å·¥</a-radio>
          </a-radio-group>
        </a-form-item>

        <a-form-item name="scope" v-if="configForm.scope.type">
          <a-select
            v-model:value="configForm.scope.targets"
            mode="multiple"
            :placeholder="getScopePlaceholder(configForm.scope.type)"
            style="width: 100%"
          >
            <a-select-option
              v-for="item in scopeOptions"
              :key="item.id"
              :value="item.id"
            >
              {{ item.name }}
            </a-select-option>
          </a-select>
        </a-form-item>

        <a-form-item label="åº”ç”¨æ—¶é—´" name="dateRange">
          <a-range-picker
            v-model:value="configForm.dateRange"
            style="width: 100%"
            :disabled-date="disabledDate"
          />
        </a-form-item>

        <a-form-item label="è¦†ç›–è§„åˆ™" name="overwriteRule">
          <a-radio-group v-model:value="configForm.overwriteRule">
            <a-radio value="none">ä¸è¦†ç›–ç°æœ‰æ’ç­</a-radio>
            <a-radio value="empty">ä»…è¦†ç›–ç©ºç¼ºæ’ç­</a-radio>
            <a-radio value="all">è¦†ç›–æ‰€æœ‰æ’ç­</a-radio>
          </a-radio-group>
        </a-form-item>

        <a-form-item label="ç‰¹æ®Šæ—¥æœŸå¤„ç†" name="specialDateHandling">
          <a-checkbox-group v-model:value="configForm.specialDateHandling">
            <a-checkbox value="holiday">è·³è¿‡èŠ‚å‡æ—¥</a-checkbox>
            <a-checkbox value="weekend">è·³è¿‡å‘¨æœ«</a-checkbox>
            <a-checkbox value="custom">è·³è¿‡è‡ªå®šä¹‰æ—¥æœŸ</a-checkbox>
          </a-checkbox-group>
        </a-form-item>

        <a-form-item label="è‡ªå®šä¹‰è·³è¿‡æ—¥æœŸ" name="skipDates" v-if="configForm.specialDateHandling.includes('custom')">
          <a-range-picker
            v-model:value="configForm.skipDates"
            mode="multiple"
            style="width: 100%"
          />
        </a-form-item>

        <a-form-item label="é€šçŸ¥è®¾ç½®" name="notification">
          <a-checkbox v-model:checked="configForm.notification.enabled">
            åº”ç”¨åé€šçŸ¥ç›¸å…³äººå‘˜
          </a-checkbox>
          <div v-if="configForm.notification.enabled" style="margin-top: 8px;">
            <a-checkbox-group v-model:value="configForm.notification.channels">
              <a-checkbox value="app">APPæ¨é€</a-checkbox>
              <a-checkbox value="email">é‚®ä»¶</a-checkbox>
              <a-checkbox value="sms">çŸ­ä¿¡</a-checkbox>
            </a-checkbox-group>
          </div>
        </a-form-item>
      </a-form>
    </div>

    <!-- æ­¥éª¤3ï¼šç¡®è®¤åº”ç”¨ -->
    <div v-show="currentStep === 2" class="step-content">
      <div class="apply-preview">
        <a-descriptions title="åº”ç”¨é¢„è§ˆ" bordered :column="2">
          <a-descriptions-item label="æ¨¡æ¿åç§°">
            {{ selectedTemplate?.name }}
          </a-descriptions-item>
          <a-descriptions-item label="åº”ç”¨èŒƒå›´">
            {{ getScopeText() }}
          </a-descriptions-item>
          <a-descriptions-item label="åº”ç”¨æ—¶é—´">
            {{ formatDateRange(configForm.dateRange) }}
          </a-descriptions-item>
          <a-descriptions-item label="è¦†ç›–è§„åˆ™">
            {{ getOverwriteRuleText() }}
          </a-descriptions-item>
          <a-descriptions-item label="å½±å“äººæ•°" :span="2">
            {{ affectedCount }}äºº
          </a-descriptions-item>
        </a-descriptions>

        <div class="preview-calendar">
          <h5>æ’ç­é¢„è§ˆ</h5>
          <a-calendar v-model:value="previewDate" :fullscreen="false">
            <template #dateCellRender="{ current }">
              <div class="calendar-cell">
                <div class="date-number">{{ current.date() }}</div>
                <div v-if="hasShiftOnDate(current)" class="shift-indicator">
                  <a-badge status="success" />
                  <span class="shift-name">{{ getShiftOnDate(current) }}</span>
                </div>
              </div>
            </template>
          </a-calendar>
        </div>
      </div>
    </div>

    <div class="apply-actions">
      <a-button v-if="currentStep > 0" @click="prevStep">ä¸Šä¸€æ­¥</a-button>
      <a-button v-if="currentStep < 2" type="primary" @click="nextStep">ä¸‹ä¸€æ­¥</a-button>
      <a-button v-if="currentStep === 2" type="primary" @click="handleApply" :loading="applying">
        ç¡®è®¤åº”ç”¨
      </a-button>
      <a-button @click="handleCancel">å–æ¶ˆ</a-button>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import { CalendarOutlined, ClockCircleOutlined, TeamOutlined } from '@ant-design/icons-vue';
import { templateApi } from '/@/api/business/attendance/shift/template-api';
import dayjs from 'dayjs';

const props = defineProps({
  visible: Boolean,
});

const emit = defineEmits(['update:visible', 'success']);

const currentStep = ref(0);
const searchKeyword = ref('');
const selectedTemplateId = ref(null);
const selectedTemplate = computed(() => templates.value.find(t => t.id === selectedTemplateId.value));
const applying = ref(false);
const previewDate = ref(dayjs());
const affectedCount = ref(0);

const templates = ref([]);
const scopeOptions = ref([]);

const configForm = reactive({
  scope: {
    type: '',
    targets: []
  },
  dateRange: [],
  overwriteRule: 'none',
  specialDateHandling: [],
  skipDates: [],
  notification: {
    enabled: false,
    channels: []
  }
});

const configFormRef = ref();

const configRules = {
  'scope.type': [
    { required: true, message: 'è¯·é€‰æ‹©åº”ç”¨èŒƒå›´', trigger: 'change' }
  ],
  'scope.targets': [
    { required: true, message: 'è¯·é€‰æ‹©å…·ä½“ç›®æ ‡', trigger: 'change' }
  ],
  dateRange: [
    { required: true, message: 'è¯·é€‰æ‹©åº”ç”¨æ—¶é—´', trigger: 'change' }
  ],
  overwriteRule: [
    { required: true, message: 'è¯·é€‰æ‹©è¦†ç›–è§„åˆ™', trigger: 'change' }
  ]
};

// è¿‡æ»¤åçš„æ¨¡æ¿åˆ—è¡¨
const filteredTemplates = computed(() => {
  if (!searchKeyword.value) return templates.value;
  return templates.value.filter(template =>
    template.name.toLowerCase().includes(searchKeyword.value.toLowerCase()) ||
    template.description.toLowerCase().includes(searchKeyword.value.toLowerCase())
  );
});

// åŠ è½½æ¨¡æ¿åˆ—è¡¨
const loadTemplates = async () => {
  try {
    const response = await templateApi.getShiftTemplates();
    templates.value = response.data;
  } catch (error) {
    console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', error);
  }
};

// åŠ è½½åº”ç”¨èŒƒå›´é€‰é¡¹
const loadScopeOptions = async () => {
  try {
    // æ ¹æ®é€‰æ‹©çš„èŒƒå›´ç±»å‹åŠ è½½å¯¹åº”é€‰é¡¹
    const response = await templateApi.getScopeOptions();
    scopeOptions.value = response.data;
  } catch (error) {
    console.error('åŠ è½½èŒƒå›´é€‰é¡¹å¤±è´¥:', error);
  }
};

// é€‰æ‹©æ¨¡æ¿
const selectTemplate = (template) => {
  selectedTemplateId.value = template.id;
};

// æœç´¢æ¨¡æ¿
const handleSearch = () => {
  // æœç´¢é€»è¾‘å·²åœ¨computedä¸­å®ç°
};

// è·å–æ¨¡æ¿ç±»å‹é¢œè‰²
const getTemplateTypeColor = (type) => {
  const colorMap = {
    department: 'blue',
    personal: 'green',
    special: 'orange'
  };
  return colorMap[type] || 'default';
};

// è·å–æ¨¡æ¿ç±»å‹æ–‡æœ¬
const getTemplateTypeText = (type) => {
  const typeMap = {
    department: 'éƒ¨é—¨æ¨¡æ¿',
    personal: 'ä¸ªäººæ¨¡æ¿',
    special: 'ç‰¹æ®Šæ¨¡æ¿'
  };
  return typeMap[type] || 'æœªçŸ¥';
};

// è·å–å·¥ä½œæ—¥æ–‡æœ¬
const getWeekdaysText = (weekdays) => {
  const dayNames = ['', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
  return weekdays.map(day => dayNames[day]).join('ã€');
};

// è·å–èŒƒå›´å ä½ç¬¦
const getScopePlaceholder = (type) => {
  const placeholders = {
    department: 'è¯·é€‰æ‹©éƒ¨é—¨',
    position: 'è¯·é€‰æ‹©å²—ä½',
    employee: 'è¯·é€‰æ‹©å‘˜å·¥'
  };
  return placeholders[type] || 'è¯·é€‰æ‹©';
};

// ç¦ç”¨æ—¥æœŸ
const disabledDate = (current) => {
  return current && current < dayjs().startOf('day');
};

// ä¸‹ä¸€æ­¥
const nextStep = async () => {
  if (currentStep.value === 0) {
    if (!selectedTemplateId.value) {
      message.warning('è¯·é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿');
      return;
    }
  } else if (currentStep.value === 1) {
    try {
      await configFormRef.value.validate();
      // è®¡ç®—å½±å“äººæ•°
      await calculateAffectedCount();
    } catch (error) {
      return;
    }
  }
  currentStep.value++;
};

// ä¸Šä¸€æ­¥
const prevStep = () => {
  currentStep.value--;
};

// è®¡ç®—å½±å“äººæ•°
const calculateAffectedCount = async () => {
  try {
    const response = await templateApi.calculateAffectedCount({
      templateId: selectedTemplateId.value,
      scope: configForm.scope,
      dateRange: configForm.dateRange
    });
    affectedCount.value = response.data.count;
  } catch (error) {
    console.error('è®¡ç®—å½±å“äººæ•°å¤±è´¥:', error);
  }
};

// è·å–èŒƒå›´æ–‡æœ¬
const getScopeText = () => {
  const typeText = {
    department: 'éƒ¨é—¨',
    position: 'å²—ä½',
    employee: 'å‘˜å·¥'
  };
  return `${typeText[configForm.scope.type]} (${configForm.scope.targets.length}ä¸ª)`;
};

// æ ¼å¼åŒ–æ—¥æœŸèŒƒå›´
const formatDateRange = (dateRange) => {
  if (!dateRange || dateRange.length !== 2) return '';
  return `${dateRange[0].format('YYYY-MM-DD')} è‡³ ${dateRange[1].format('YYYY-MM-DD')}`;
};

// è·å–è¦†ç›–è§„åˆ™æ–‡æœ¬
const getOverwriteRuleText = () => {
  const ruleText = {
    none: 'ä¸è¦†ç›–ç°æœ‰æ’ç­',
    empty: 'ä»…è¦†ç›–ç©ºç¼ºæ’ç­',
    all: 'è¦†ç›–æ‰€æœ‰æ’ç­'
  };
  return ruleText[configForm.overwriteRule];
};

// æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰ç­æ¬¡
const hasShiftOnDate = (date) => {
  // æ¨¡æ‹Ÿé€»è¾‘ï¼šæ ¹æ®æ¨¡æ¿å’Œåº”ç”¨é…ç½®åˆ¤æ–­
  return selectedTemplate.value?.weekdays?.includes(date.day() + 1);
};

// è·å–æ—¥æœŸçš„ç­æ¬¡åç§°
const getShiftOnDate = (date) => {
  // æ¨¡æ‹Ÿé€»è¾‘
  return selectedTemplate.value?.defaultShift || 'æ ‡å‡†ç­æ¬¡';
};

// åº”ç”¨æ¨¡æ¿
const handleApply = async () => {
  applying.value = true;
  try {
    await templateApi.applyShiftTemplate({
      templateId: selectedTemplateId.value,
      config: configForm
    });
    message.success('æ¨¡æ¿åº”ç”¨æˆåŠŸ');
    emit('success');
    handleCancel();
  } catch (error) {
    message.error('æ¨¡æ¿åº”ç”¨å¤±è´¥');
  } finally {
    applying.value = false;
  }
};

// å–æ¶ˆ
const handleCancel = () => {
  emit('update:visible', false);
  currentStep.value = 0;
  selectedTemplateId.value = null;
  configFormRef.value?.resetFields();
};

onMounted(() => {
  loadTemplates();
  loadScopeOptions();
});
</script>

<style scoped lang="less">
.template-apply {
  .apply-header {
    margin-bottom: 24px;

    h4 {
      margin-bottom: 16px;
      font-size: 16px;
      font-weight: 600;
    }
  }

  .step-content {
    min-height: 400px;
    margin-bottom: 24px;

    .template-selection {
      .template-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;

        .template-item {
          border: 1px solid #f0f0f0;
          border-radius: 8px;
          padding: 16px;
          cursor: pointer;
          transition: all 0.3s;

          &:hover {
            border-color: #1890ff;
          }

          &.selected {
            border-color: #1890ff;
            background: #f0f8ff;
          }

          .template-preview {
            .template-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 8px;

              h5 {
                margin: 0;
                font-size: 14px;
                font-weight: 600;
              }
            }

            .template-desc {
              color: #666;
              font-size: 12px;
              margin-bottom: 8px;
              line-height: 1.4;
            }

            .template-meta {
              display: flex;
              flex-wrap: wrap;
              gap: 12px;

              span {
                display: flex;
                align-items: center;
                gap: 4px;
                font-size: 12px;
                color: #999;
              }
            }
          }
        }
      }
    }

    .apply-preview {
      .preview-calendar {
        margin-top: 24px;

        h5 {
          margin-bottom: 16px;
          font-weight: 600;
        }

        .calendar-cell {
          height: 60px;
          padding: 4px;

          .date-number {
            font-weight: 500;
            margin-bottom: 4px;
          }

          .shift-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;

            .shift-name {
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
            }
          }
        }
      }
    }
  }

  .apply-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding-top: 16px;
    border-top: 1px solid #f0f0f0;
  }
}
</style>
```

## Mockæ•°æ®ç¤ºä¾‹

```javascript
// src/mock/shift-mock.js
export const mockTimePeriods = [
  {
    id: 'tp001',
    name: 'æ ‡å‡†å·¥ä½œæ—¶é—´',
    type: 'work',
    startTime: '09:00',
    endTime: '18:00',
    duration: 480,
    payRule: 'full',
    attendanceRequirement: ['clockIn', 'clockOut']
  },
  {
    id: 'tp002',
    name: 'åˆä¼‘æ—¶é—´',
    type: 'break',
    startTime: '12:00',
    endTime: '13:00',
    duration: 60,
    payRule: 'none',
    attendanceRequirement: []
  },
  {
    id: 'tp003',
    name: 'å¼¹æ€§å·¥ä½œæ—¶é—´æ®µ',
    type: 'flexible',
    startTime: '08:00',
    endTime: '20:00',
    duration: 480,
    payRule: 'full',
    flexibleSettings: {
      earliestClockIn: '08:00',
      latestClockIn: '10:00',
      minWorkHours: 8
    }
  }
];

export const mockShifts = [
  {
    id: 'shift001',
    name: 'æ ‡å‡†æ—©ç­',
    type: 'standard',
    timePeriods: [
      { id: 'tp001', name: 'æ ‡å‡†å·¥ä½œæ—¶é—´', startTime: '09:00', endTime: '18:00', duration: 480, type: 'work' },
      { id: 'tp002', name: 'åˆä¼‘æ—¶é—´', startTime: '12:00', endTime: '13:00', duration: 60, type: 'break' }
    ],
    tags: ['å¸¸è§„', 'æ—¥é—´'],
    employeeCount: 500,
    enabled: true
  },
  {
    id: 'shift002',
    name: 'å¤œç­',
    type: 'standard',
    timePeriods: [
      { id: 'tp004', name: 'å¤œç­å·¥ä½œæ—¶é—´', startTime: '22:00', endTime: '06:00', duration: 480, type: 'work' }
    ],
    tags: ['å¤œé—´', 'è·¨å¤©'],
    employeeCount: 100,
    enabled: true
  }
];

export const mockShiftTemplates = [
  {
    id: 'tpl001',
    name: 'æ ‡å‡†äº”å¤©å·¥ä½œåˆ¶',
    type: 'department',
    description: 'å‘¨ä¸€è‡³å‘¨äº”æ ‡å‡†å·¥ä½œæ—¶é—´ï¼Œé€‚ç”¨äºå¤§éƒ¨åˆ†åŠå…¬å®¤å²—ä½',
    weekdays: [1, 2, 3, 4, 5],
    shiftCount: 1,
    defaultShift: 'æ ‡å‡†æ—©ç­',
    applicableScope: 'åŠå…¬å®¤å‘˜å·¥'
  },
  {
    id: 'tpl002',
    name: 'è½®ç­å·¥ä½œåˆ¶',
    type: 'department',
    description: 'ä¸‰ç­å€’è½®ç­åˆ¶åº¦ï¼Œé€‚ç”¨äºç”Ÿäº§ä¸€çº¿',
    weekdays: [1, 2, 3, 4, 5, 6, 7],
    shiftCount: 3,
    rotationCycle: 7,
    applicableScope: 'ç”Ÿäº§çº¿å‘˜å·¥'
  }
];

export default {
  mockTimePeriods,
  mockShifts,
  mockShiftTemplates
};
```

## å¼€å‘æ³¨æ„äº‹é¡¹æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½è¦ç‚¹
1. **æ—¶é—´æ®µç®¡ç†** - çµæ´»çš„æ—¶é—´æ®µé…ç½®å’Œç»„åˆ
2. **ç­æ¬¡é…ç½®** - å¤šç§ç­æ¬¡ç±»å‹çš„æ”¯æŒ
3. **å…³è”ç®¡ç†** - ç­æ¬¡ä¸æ—¶é—´çš„åŠ¨æ€å…³è”
4. **æ¨¡æ¿ç³»ç»Ÿ** - å¿«é€Ÿåº”ç”¨å¸¸ç”¨é…ç½®
5. **æ‰¹é‡æ“ä½œ** - é«˜æ•ˆçš„æ‰¹é‡é…ç½®åŠŸèƒ½
6. **é¢„è§ˆéªŒè¯** - åº”ç”¨å‰çš„æ•ˆæœé¢„è§ˆ

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. ç­æ¬¡è®¡ç®—é‡‡ç”¨ç¼“å­˜æœºåˆ¶
2. å¤§é‡æ•°æ®åˆ†é¡µåŠ è½½
3. æ¨¡æ¿é¢„è§ˆå¼‚æ­¥è®¡ç®—
4. æ—¥å†ç»„ä»¶è™šæ‹Ÿæ»šåŠ¨

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. å¯è§†åŒ–çš„æ—¶é—´é…ç½®ç•Œé¢
2. æ‹–æ‹½å¼çš„ç­æ¬¡ç»„åˆ
3. å®æ—¶çš„æ•ˆæœé¢„è§ˆ
4. æ™ºèƒ½çš„å†²çªæ£€æµ‹

## æ€»ç»“

ç­æ¬¡æ—¶é—´ç®¡ç†æ¨¡å—ä½œä¸ºè€ƒå‹¤ç³»ç»Ÿçš„æ—¶é—´é…ç½®æ ¸å¿ƒï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š

- æ—¶é—´é…ç½®çš„çµæ´»æ€§å’Œå‡†ç¡®æ€§
- ç­æ¬¡ç»„åˆçš„ä¾¿æ·æ€§å’Œç›´è§‚æ€§
- æ¨¡æ¿åº”ç”¨çš„æ•ˆç‡å’Œå¯é æ€§
- å…³è”å…³ç³»çš„æ¸…æ™°è¡¨è¾¾
- ç”¨æˆ·ä½“éªŒçš„å‹å¥½æ€§

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æŠ€æœ¯è§„èŒƒï¼Œå¯ä»¥æ„å»ºå‡ºåŠŸèƒ½å®Œå–„ã€æ“ä½œä¾¿æ·çš„ç­æ¬¡æ—¶é—´ç®¡ç†æ¨¡å—ã€‚