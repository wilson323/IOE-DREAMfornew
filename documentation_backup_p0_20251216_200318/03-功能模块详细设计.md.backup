# åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†å®šä¹‰äº†æ™ºèƒ½è§†é¢‘æ¨¡å—çš„å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼ŒåŒ…æ‹¬åŠŸèƒ½ç‚¹æ¸…å•ã€ä¸šåŠ¡æµç¨‹ã€æƒé™æ§åˆ¶ç­‰å†…å®¹ã€‚æ¯ä¸ªæ¨¡å—éƒ½æŒ‰ç…§å®‰å…¨çº§åˆ«è¿›è¡Œæƒé™æ§åˆ¶ï¼Œç¡®ä¿ä¸åŒçº§åˆ«ç”¨æˆ·è®¿é—®ç›¸åº”æƒé™çš„åŠŸèƒ½ã€‚

---

## 1. å®æ—¶ç›‘æ§æ¨¡å—

### 1.1 åŠŸèƒ½æ¦‚è¿°

å®æ—¶ç›‘æ§æ¨¡å—æä¾›å®æ—¶è§†é¢‘é¢„è§ˆã€äº‘å°æ§åˆ¶ã€æˆªå›¾å½•åƒç­‰æ ¸å¿ƒç›‘æ§åŠŸèƒ½ï¼Œæ”¯æŒå¤šç”»é¢å¸ƒå±€ã€å¤šåè®®è§†é¢‘æµæ¥å…¥ã€‚

### 1.2 åŠŸèƒ½æ¸…å•

#### 1.2.1 è§†é¢‘é¢„è§ˆåŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å•ç”»é¢é¢„è§ˆ | å•ä¸ªè§†é¢‘ç”»é¢é¢„è§ˆ | âœ… | âœ… | âœ… | âœ… | âœ… |
| 4ç”»é¢é¢„è§ˆ | 4ä¸ªè§†é¢‘ç”»é¢åŒæ—¶é¢„è§ˆ | âœ… | âœ… | âœ… | âœ… | âŒ |
| 9ç”»é¢é¢„è§ˆ | 9ä¸ªè§†é¢‘ç”»é¢åŒæ—¶é¢„è§ˆ | âœ… | âœ… | âœ… | âœ… | âŒ |
| 16ç”»é¢é¢„è§ˆ | 16ä¸ªè§†é¢‘ç”»é¢åŒæ—¶é¢„è§ˆ | âœ… | âœ… | âœ… | âŒ | âŒ |
| 25ç”»é¢é¢„è§ˆ | 25ä¸ªè§†é¢‘ç”»é¢åŒæ—¶é¢„è§ˆ | âœ… | âœ… | âŒ | âŒ | âŒ |
| å…¨å±é¢„è§ˆ | å…¨å±æ˜¾ç¤ºå•ä¸ªç”»é¢ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç”»ä¸­ç”»é¢„è§ˆ | ä¸»ç”»é¢+å°çª—å£é¢„è§ˆ | âœ… | âœ… | âœ… | âœ… | âŒ |
| è½®å·¡é¢„è§ˆ | æŒ‰è®¡åˆ’è‡ªåŠ¨åˆ‡æ¢é¢„è§ˆ | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 1.2.2 äº‘å°æ§åˆ¶åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| æ–¹å‘æ§åˆ¶ | ä¸Šä¸‹å·¦å³æ–¹å‘æ§åˆ¶ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å˜ç„¦æ§åˆ¶ | å…‰å­¦å˜ç„¦ã€æ•°å­—å˜ç„¦ | âœ… | âœ… | âœ… | âœ… | âŒ |
| é¢„ç½®ä½è®¾ç½® | è®¾ç½®ç›‘æ§é¢„ç½®ä½ | âœ… | âœ… | âœ… | âŒ | âŒ |
| é¢„ç½®ä½è°ƒç”¨ | è°ƒç”¨é¢„ç½®ä½ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å·¡èˆªè®¾ç½® | è®¾ç½®å·¡èˆªè·¯å¾„ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å·¡èˆªå¯åŠ¨ | å¯åŠ¨/åœæ­¢å·¡èˆª | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç¼©æ”¾æ§åˆ¶ | ç”»é¢ç¼©æ”¾æ§åˆ¶ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç„¦ç‚¹æ§åˆ¶ | è‡ªåŠ¨/æ‰‹åŠ¨å¯¹ç„¦ | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 1.2.3 æˆªå›¾å½•åƒåŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å®æ—¶æˆªå›¾ | å®æ—¶è§†é¢‘æˆªå›¾ | âœ… | âœ… | âœ… | âœ… | âŒ |
| æ‰¹é‡æˆªå›¾ | å¤šä¸ªç”»é¢æˆªå›¾ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å®šæ—¶æˆªå›¾ | æŒ‰æ—¶é—´é—´éš”æˆªå›¾ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æ‰‹åŠ¨å½•åƒ | æ‰‹åŠ¨å¼€å§‹/åœæ­¢å½•åƒ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å®šæ—¶å½•åƒ | æŒ‰è®¡åˆ’å½•åƒ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æŠ¥è­¦å½•åƒ | æŠ¥è­¦è§¦å‘å½•åƒ | âœ… | âœ… | âœ… | âœ… | âŒ |
| æˆªå›¾ç®¡ç† | æˆªå›¾æŸ¥çœ‹ã€ä¸‹è½½ã€åˆ é™¤ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å½•åƒç®¡ç† | å½•åƒæŸ¥çœ‹ã€æ’­æ”¾ã€ä¸‹è½½ | âœ… | âœ… | âœ… | âœ… | âŒ |

#### 1.2.4 ç”»é¢æ§åˆ¶åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| ç”»é¢æ—‹è½¬ | ç”»é¢æ—‹è½¬è§’åº¦æ§åˆ¶ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç”»é¢é•œåƒ | ç”»é¢æ°´å¹³/å‚ç›´é•œåƒ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç”»é¢ç¿»è½¬ | ç”»é¢ä¸Šä¸‹ç¿»è½¬ | âœ… | âœ… | âœ… | âœ… | âŒ |
| äº®åº¦è°ƒèŠ‚ | ç”»é¢äº®åº¦è°ƒèŠ‚ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å¯¹æ¯”åº¦è°ƒèŠ‚ | ç”»é¢å¯¹æ¯”åº¦è°ƒèŠ‚ | âœ… | âœ… | âœ… | âœ… | âŒ |
| é¥±å’Œåº¦è°ƒèŠ‚ | ç”»é¢é¥±å’Œåº¦è°ƒèŠ‚ | âœ… | âœ… | âœ… | âœ… | âŒ |
| è‰²è°ƒè°ƒèŠ‚ | ç”»é¢è‰²è°ƒè°ƒèŠ‚ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç”µå­æ”¾å¤§ | ç”»é¢ç”µå­æ”¾å¤§ | âœ… | âœ… | âœ… | âœ… | âœ… |

### 1.3 ä¸šåŠ¡æµç¨‹è®¾è®¡

#### 1.3.1 è§†é¢‘é¢„è§ˆæµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·è¿›å…¥ç›‘æ§é¡µé¢] --> B[è·å–ç”¨æˆ·å®‰å…¨çº§åˆ«]
    B --> C{çº§åˆ«éªŒè¯}
    C -->|å¤±è´¥| D[æ˜¾ç¤ºæƒé™ä¸è¶³é¡µé¢]
    C -->|æˆåŠŸ| E[è·å–ç”¨æˆ·å¯è®¿é—®è®¾å¤‡åˆ—è¡¨]
    E --> F[åŠ è½½è®¾å¤‡æ ‘]
    F --> G[ç”¨æˆ·é€‰æ‹©è®¾å¤‡]
    G --> H{æ£€æŸ¥è®¾å¤‡è®¿é—®æƒé™}
    H -->|æ— æƒé™| I[æ˜¾ç¤ºè®¾å¤‡æ— è®¿é—®æƒé™]
    H -->|æœ‰æƒé™| J[è¯·æ±‚è§†é¢‘æµ]
    J --> K[è·å–è§†é¢‘æµåœ°å€]
    K --> L[åˆå§‹åŒ–æ’­æ”¾å™¨]
    L --> M[æ˜¾ç¤ºè§†é¢‘ç”»é¢]
    M --> N[å¼€å§‹æ’­æ”¾]
    N --> O{æŒç»­ç›‘æ§}
    O -->|ç»§ç»­| P[ä¿æŒè¿æ¥]
    O -->|åœæ­¢| Q[æ–­å¼€è¿æ¥]
    O -->|åˆ‡æ¢| G
    P --> O
```

#### 1.3.2 äº‘å°æ§åˆ¶æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant C as å®¢æˆ·ç«¯
    participant S as ç›‘æ§æœåŠ¡
    participant D as è®¾å¤‡

    U->>C: ç‚¹å‡»äº‘å°æ§åˆ¶æŒ‰é’®
    C->>C: æ£€æŸ¥ç”¨æˆ·æƒé™
    C->>S: å‘é€äº‘å°æ§åˆ¶æŒ‡ä»¤
    S->>S: éªŒè¯ç”¨æˆ·æƒé™å’Œè®¾å¤‡æƒé™
    S->>D: å‘é€PTZæ§åˆ¶æŒ‡ä»¤
    D->>D: æ‰§è¡ŒPTZæ“ä½œ
    D-->>S: è¿”å›æ‰§è¡Œç»“æœ
    S-->>C: è¿”å›æ§åˆ¶ç»“æœ
    C->>U: æ˜¾ç¤ºæ§åˆ¶ç»“æœ
    U->>C: æŒç»­æŒ‰ä½æ§åˆ¶æŒ‰é’®
    C->>S: å‘é€æŒç»­æ§åˆ¶æŒ‡ä»¤
    S->>D: å‘é€æŒç»­PTZæ§åˆ¶
    D-->>S: è¿”å›çŠ¶æ€
    S-->>C: è¿”å›çŠ¶æ€
    C->>U: æ›´æ–°ç”»é¢æ˜¾ç¤º
```

#### 1.3.3 æˆªå›¾å½•åƒæµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·ç‚¹å‡»æˆªå›¾/å½•åƒ] --> B[æ£€æŸ¥ç”¨æˆ·æƒé™]
    B --> C{æƒé™éªŒè¯}
    C -->|å¤±è´¥| D[æç¤ºæƒé™ä¸è¶³]
    C -->|æˆåŠŸ| E[æ£€æŸ¥è®¾å¤‡çŠ¶æ€]
    E --> F{è®¾å¤‡åœ¨çº¿?}
    F -->|å¦| G[æç¤ºè®¾å¤‡ç¦»çº¿]
    F -->|æ˜¯| H{æ“ä½œç±»å‹}
    H -->|æˆªå›¾| I[ç”Ÿæˆæˆªå›¾ä»»åŠ¡]
    H -->|å½•åƒ| J[ç”Ÿæˆå½•åƒä»»åŠ¡]
    I --> K[è¯·æ±‚è§†é¢‘å¸§]
    J --> L[å¯åŠ¨å½•åƒç¼–ç ]
    K --> M[ä¿å­˜å›¾ç‰‡æ–‡ä»¶]
    L --> N[æŒç»­ç¼–ç ]
    N --> O{æ˜¯å¦åœæ­¢}
    O -->|å¦| N
    O -->|æ˜¯| P[åœæ­¢ç¼–ç ]
    P --> Q[ä¿å­˜å½•åƒæ–‡ä»¶]
    M --> R[è¿”å›ç»“æœ]
    Q --> R
    R --> S[æ›´æ–°æˆªå›¾/å½•åƒåˆ—è¡¨]
```

### 1.4 æŠ€æœ¯å®ç°

#### 1.4.1 è§†é¢‘æµåè®®æ”¯æŒ

```java
// è§†é¢‘æµåè®®æšä¸¾
public enum VideoStreamProtocol {
    RTSP("rtsp", "RTSPåè®®"),
    RTMP("rtmp", "RTMPåè®®"),
    HLS("http", "HLSåè®®"),
    WEBRTC("webrtc", "WebRTCåè®®"),
    HTTP_FLV("http", "HTTP-FLVåè®®");

    private final String prefix;
    private final String description;

    VideoStreamProtocol(String prefix, String description) {
        this.prefix = prefix;
        this.description = description;
    }
}

// è§†é¢‘æµç®¡ç†å™¨
@Service
public class VideoStreamManager {

    // è·å–è§†é¢‘æµåœ°å€
    public String getStreamUrl(Device device, String streamType) {
        VideoStreamProtocol protocol = getDeviceProtocol(device);
        switch (protocol) {
            case RTSP:
                return buildRtspUrl(device, streamType);
            case RTMP:
                return buildRtmpUrl(device, streamType);
            case HLS:
                return buildHlsUrl(device, streamType);
            case WEBRTC:
                return buildWebrtcUrl(device, streamType);
            default:
                throw new UnsupportedProtocolException("ä¸æ”¯æŒçš„è§†é¢‘åè®®");
        }
    }

    // æ„å»ºRTSPåœ°å€
    private String buildRtspUrl(Device device, String streamType) {
        return String.format("rtsp://%s:%s/%s/%s",
            device.getIp(),
            device.getPort(),
            device.getChannel(),
            streamType);
    }
}
```

#### 1.4.2 å®æ—¶é¢„è§ˆæœåŠ¡

```java
@RestController
@RequestMapping("/api/monitor")
@SecurityLevel(value = 2) // éœ€è¦Level 2ä»¥ä¸Šæƒé™
public class MonitorController {

    @Resource
    private DeviceService deviceService;

    @Resource
    private PermissionService permissionService;

    @GetMapping("/devices")
    public Result<List<DeviceVO>> getUserDevices() {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        List<Device> devices;
        if (userLevel >= 4) {
            // Level 4åŠä»¥ä¸Šå¯è®¿é—®æ‰€æœ‰è®¾å¤‡
            devices = deviceService.getAllDevices();
        } else {
            // Level 3åŠä»¥ä¸‹åªèƒ½è®¿é—®åˆ†é…è®¾å¤‡
            devices = deviceService.getAssignedDevices(userId);
        }

        return Result.success(devices);
    }

    @GetMapping("/stream/{deviceId}")
    public Result<Map<String, String>> getStreamUrl(@PathVariable Long deviceId) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ£€æŸ¥è®¾å¤‡è®¿é—®æƒé™
        if (!permissionService.hasDevicePermission(userId, deviceId, "view")) {
            throw new ForbiddenException("æ— è®¾å¤‡è®¿é—®æƒé™");
        }

        Device device = deviceService.getById(deviceId);
        String streamUrl = videoStreamManager.getStreamUrl(device, "main");

        Map<String, String> result = new HashMap<>();
        result.put("streamUrl", streamUrl);
        result.put("playUrl", transformPlayUrl(streamUrl));

        return Result.success(result);
    }

    @PostMapping("/ptz/{deviceId}/control")
    public Result<Void> ptzControl(@PathVariable Long deviceId,
                                   @RequestBody PtzControlRequest request) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ£€æŸ¥äº‘å°æ§åˆ¶æƒé™ï¼ˆLevel 2ä»¥ä¸Šï¼‰
        if (userLevel < 2) {
            throw new ForbiddenException("æ— äº‘å°æ§åˆ¶æƒé™");
        }

        // æ£€æŸ¥è®¾å¤‡æ“ä½œæƒé™
        if (!permissionService.hasDevicePermission(userId, deviceId, "control")) {
            throw new ForbiddenException("æ— è®¾å¤‡æ§åˆ¶æƒé™");
        }

        ptzService.control(deviceId, request);
        return Result.success();
    }
}
```

---

## 2. è®¾å¤‡ç®¡ç†äº¤äº’æ¨¡å—ï¼ˆä»å…¬å…±æ¨¡å—è·å–ï¼‰
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 2.1 åŠŸèƒ½æ¦‚è¿°
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

è®¾å¤‡ç®¡ç†äº¤äº’æ¨¡å—è´Ÿè´£ä¸å…¬å…±è®¾å¤‡ç®¡ç†æ¨¡å—è¿›è¡Œæ•°æ®äº¤äº’ï¼Œè·å–è®¾å¤‡ä¿¡æ¯ã€ç›‘æ§è®¾å¤‡çŠ¶æ€ã€å¤„ç†è®¾å¤‡ç¦»çº¿å‘Šè­¦ç­‰åŠŸèƒ½ã€‚**æ³¨æ„ï¼šè®¾å¤‡ç®¡ç†åŠŸèƒ½ç”±å…¬å…±æ¨¡å—å®ç°ï¼Œæœ¬æ¨¡å—ä»…è´Ÿè´£æ•°æ®è·å–å’Œäº¤äº’ã€‚**

### 2.2 åŠŸèƒ½æ¸…å•

#### 2.2.1 è®¾å¤‡æ•°æ®è·å–åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| è®¾å¤‡æ•°æ®è®¢é˜… | ä»è®¾å¤‡ç®¡ç†æ¨¡å—è®¢é˜…è®¾å¤‡ä¿¡æ¯ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡åˆ—è¡¨åŒæ­¥ | åŒæ­¥è®¾å¤‡åˆ—è¡¨æ•°æ® | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡è¯¦æƒ…æŸ¥è¯¢ | æŸ¥è¯¢è®¾å¤‡è¯¦ç»†ä¿¡æ¯ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡æ•°æ®ç¼“å­˜ | ç¼“å­˜çƒ­ç‚¹è®¾å¤‡æ•°æ® | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ•°æ®æ›´æ–°æ¨é€ | æ¥æ”¶è®¾å¤‡æ•°æ®æ›´æ–°æ¨é€ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡æœç´¢ | æœç´¢å¯ç”¨è®¾å¤‡ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡ç­›é€‰ | æŒ‰æ¡ä»¶ç­›é€‰è®¾å¤‡ | âœ… | âœ… | âœ… | âœ… | âœ… |

#### 2.2.2 è®¾å¤‡çŠ¶æ€ç›‘æ§åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| è®¾å¤‡å¿ƒè·³ç›‘æ§ | ç›‘æ§è®¾å¤‡å¿ƒè·³çŠ¶æ€ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡æ€§èƒ½ç›‘æ§ | ç›‘æ§CPU/å†…å­˜/ç½‘ç»œ | âœ… | âœ… | âœ… | âœ… | âŒ |
| è®¾å¤‡ç¦»çº¿æ£€æµ‹ | æ£€æµ‹è®¾å¤‡ç¦»çº¿çŠ¶æ€ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡ç¦»çº¿å‘Šè­¦ | **è®¾å¤‡ç¦»çº¿è§¦å‘å‘Šè­¦** | âœ… | âœ… | âœ… | âœ… | âŒ |
| è®¾å¤‡åœ¨çº¿ç»Ÿè®¡ | ç»Ÿè®¡è®¾å¤‡åœ¨çº¿ç‡ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ•…éšœè¯Šæ–­ | è®¾å¤‡æ•…éšœè‡ªåŠ¨è¯Šæ–­ | âœ… | âœ… | âœ… | âŒ | âŒ |
| çŠ¶æ€å†å²è®°å½• | è®°å½•è®¾å¤‡çŠ¶æ€å†å² | âœ… | âœ… | âœ… | âœ… | âŒ |

#### 2.2.3 è®¾å¤‡è”åŠ¨æŠ“æ‹åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| è”åŠ¨è§„åˆ™é…ç½® | é…ç½®è”åŠ¨æŠ“æ‹è§„åˆ™ | âœ… | âœ… | âœ… | âŒ | âŒ |
| **ä½å»¶æ—¶æŠ“æ‹** | **è”åŠ¨æŠ“æ‹å“åº”<200ms** | âœ… | âœ… | âœ… | âœ… | âŒ |
| æŠ“æ‹ä»»åŠ¡è§¦å‘ | è§¦å‘æŠ“æ‹ä»»åŠ¡ | âœ… | âœ… | âœ… | âœ… | âŒ |
| æŠ“æ‹ç»“æœæ¨é€ | æ¨é€æŠ“æ‹ç»“æœ | âœ… | âœ… | âœ… | âœ… | âŒ |
| æŠ“æ‹å†å²æŸ¥è¯¢ | æŸ¥è¯¢æŠ“æ‹å†å²è®°å½• | âœ… | âœ… | âœ… | âœ… | âœ… |
| æŠ“æ‹æ€§èƒ½ç›‘æ§ | ç›‘æ§æŠ“æ‹å»¶æ—¶æ€§èƒ½ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æ‰¹é‡æŠ“æ‹ | æ‰¹é‡æ‰§è¡ŒæŠ“æ‹ä»»åŠ¡ | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 2.2.4 è®¾å¤‡æ•°æ®ç¼“å­˜åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| çƒ­ç‚¹æ•°æ®ç¼“å­˜ | ç¼“å­˜çƒ­ç‚¹è®¾å¤‡æ•°æ® | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç¼“å­˜æ›´æ–°ç­–ç•¥ | æ™ºèƒ½æ›´æ–°ç¼“å­˜æ•°æ® | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç¼“å­˜å¤±æ•ˆæœºåˆ¶ | è‡ªåŠ¨å¤±æ•ˆè¿‡æœŸç¼“å­˜ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç¼“å­˜æ€§èƒ½ä¼˜åŒ– | ä¼˜åŒ–ç¼“å­˜è®¿é—®æ€§èƒ½ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç¼“å­˜ç›‘æ§å‘Šè­¦ | ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç¼“å­˜é¢„çƒ­ | ç³»ç»Ÿå¯åŠ¨é¢„çƒ­ç¼“å­˜ | âœ… | âœ… | âœ… | âœ… | âœ… |

### 2.3 ä¸šåŠ¡æµç¨‹è®¾è®¡

#### 2.3.1 è®¾å¤‡æ•°æ®è®¢é˜…æµç¨‹

```mermaid
flowchart TD
    A[å¯åŠ¨è®¾å¤‡æ•°æ®è®¢é˜…] --> B[è¿æ¥è®¾å¤‡ç®¡ç†æ¨¡å—]
    B --> C[è®¢é˜…è®¾å¤‡æ•°æ®å˜æ›´]
    C --> D[æ¥æ”¶è®¾å¤‡æ•°æ®æ¨é€]
    D --> E[æ›´æ–°æœ¬åœ°ç¼“å­˜]
    E --> F[æ¨é€æ•°æ®åˆ°ä¸šåŠ¡æ¨¡å—]
    F --> G{è®¾å¤‡æ•°æ®æ›´æ–°?}
    G -->|æ˜¯| H[æ›´æ–°ä¸šåŠ¡æ•°æ®]
    G -->|å¦| I[ç­‰å¾…æ•°æ®æ›´æ–°]
    I --> D
    H --> D
```

#### 2.3.2 è®¾å¤‡ç¦»çº¿å‘Šè­¦æµç¨‹

```mermaid
flowchart TD
    A[ç›‘æ§è®¾å¤‡å¿ƒè·³] --> B{å¿ƒè·³æ­£å¸¸?}
    B -->|æ˜¯| C[æ›´æ–°åœ¨çº¿çŠ¶æ€]
    B -->|å¦| D[æ£€æŸ¥ç¦»çº¿æ¬¡æ•°]
    D --> E{ç¦»çº¿æ¬¡æ•°>é˜ˆå€¼?}
    E -->|å¦| F[ç­‰å¾…ä¸‹æ¬¡å¿ƒè·³]
    E -->|æ˜¯| G[è§¦å‘ç¦»çº¿å‘Šè­¦]
    G --> H[å‘å¸ƒå‘Šè­¦äº‹ä»¶]
    H --> I[é€šçŸ¥ç›¸å…³äººå‘˜]
    F --> A
    C --> A
```
    K -->|æœ‰æƒé™| J
    J --> M[æ›´æ–°è®¾å¤‡åˆ†ç»„]
    M --> N[æ›´æ–°åˆ†ç»„ç»Ÿè®¡]
    N --> O[è®°å½•æ“ä½œæ—¥å¿—]
    O --> P[è¿”å›åˆ†ç»„ç»“æœ]
```

### 2.4 æŠ€æœ¯å®ç°

```java
@RestController
@RequestMapping("/api/device")
@SecurityLevel(value = 3) // éœ€è¦Level 3ä»¥ä¸Šæƒé™
public class DeviceController {

    @Resource
    private DeviceService deviceService;

    @Resource
    private PermissionService permissionService;

    @GetMapping("/list")
    public Result<Page<DeviceVO>> getDeviceList(DeviceQueryParam param) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ ¹æ®å®‰å…¨çº§åˆ«è¿‡æ»¤è®¾å¤‡
        if (userLevel >= 4) {
            param.setIncludeAll(true);
        } else {
            param.setUserId(userId);
        }

        Page<DeviceVO> result = deviceService.getDeviceList(param);
        return Result.success(result);
    }

    @PostMapping("/add")
    public Result<Long> addDevice(@RequestBody DeviceAddRequest request) {
        Long userId = getCurrentUserId();

        // æ£€æŸ¥æ·»åŠ æƒé™
        if (!permissionService.hasPermission(userId, "device:add")) {
            throw new ForbiddenException("æ— è®¾å¤‡æ·»åŠ æƒé™");
        }

        Device device = new Device();
        BeanUtils.copyProperties(request, device);
        device.setCreateBy(userId);
        device.setCreateTime(new Date());

        Long deviceId = deviceService.addDevice(device);
        return Result.success(deviceId);
    }

    @PutMapping("/{deviceId}")
    public Result<Void> updateDevice(@PathVariable Long deviceId,
                                     @RequestBody DeviceUpdateRequest request) {
        Long userId = getCurrentUserId();

        // æ£€æŸ¥è®¾å¤‡æƒé™
        if (!permissionService.hasDevicePermission(userId, deviceId, "update")) {
            throw new ForbiddenException("æ— è®¾å¤‡ä¿®æ”¹æƒé™");
        }

        Device device = deviceService.getById(deviceId);
        BeanUtils.copyProperties(request, device);
        device.setUpdateBy(userId);
        device.setUpdateTime(new Date());

        deviceService.updateDevice(device);
        return Result.success();
    }

    @DeleteMapping("/{deviceId}")
    public Result<Void> deleteDevice(@PathVariable Long deviceId) {
        Long userId = getCurrentUserId();

        // æ£€æŸ¥åˆ é™¤æƒé™
        if (!permissionService.hasPermission(userId, "device:delete")) {
            throw new ForbiddenException("æ— è®¾å¤‡åˆ é™¤æƒé™");
        }

        deviceService.deleteDevice(deviceId);
        return Result.success();
    }

    @PostMapping("/{deviceId}/reboot")
    public Result<Void> rebootDevice(@PathVariable Long deviceId) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ£€æŸ¥é‡å¯æƒé™ï¼ˆLevel 2ä»¥ä¸Šï¼‰
        if (userLevel < 2) {
            throw new ForbiddenException("æ— è®¾å¤‡é‡å¯æƒé™");
        }

        // æ£€æŸ¥è®¾å¤‡æ“ä½œæƒé™
        if (!permissionService.hasDevicePermission(userId, deviceId, "reboot")) {
            throw new ForbiddenException("æ— è®¾å¤‡æ“ä½œæƒé™");
        }

        deviceService.rebootDevice(deviceId);
        return Result.success();
    }
}
```

---

## 3. å½•åƒå›æ”¾æ¨¡å—

### 3.1 åŠŸèƒ½æ¦‚è¿°

å½•åƒå›æ”¾æ¨¡å—æä¾›å½•åƒçš„æŸ¥è¯¢ã€å›æ”¾ã€ä¸‹è½½ã€ç®¡ç†ç­‰åŠŸèƒ½ï¼Œæ”¯æŒå¤šæ¡ä»¶æŸ¥è¯¢ã€ç²¾å‡†å®šä½ã€å¿«é€Ÿå›æ”¾ã€‚

### 3.2 åŠŸèƒ½æ¸…å•

#### 3.2.1 å½•åƒæŸ¥è¯¢åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| æ—¶é—´æ®µæŸ¥è¯¢ | æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢å½•åƒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è®¾å¤‡æŸ¥è¯¢ | æŒ‰è®¾å¤‡æŸ¥è¯¢å½•åƒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| äº‹ä»¶æŸ¥è¯¢ | æŒ‰äº‹ä»¶ç±»å‹æŸ¥è¯¢å½•åƒ | âœ… | âœ… | âœ… | âœ… | âŒ |
| æ ‡ç­¾æŸ¥è¯¢ | æŒ‰æ ‡ç­¾æŸ¥è¯¢å½•åƒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| é«˜çº§æŸ¥è¯¢ | å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å¿«é€ŸæŸ¥è¯¢ | å¿«æ·æŸ¥è¯¢æ¨¡æ¿ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ”¶è—æŸ¥è¯¢ | æ”¶è—æŸ¥è¯¢æ¡ä»¶ | âœ… | âœ… | âœ… | âœ… | âŒ |
| æœç´¢å†å² | æŸ¥çœ‹æœç´¢å†å² | âœ… | âœ… | âœ… | âœ… | âœ… |

#### 3.2.2 å›æ”¾æ§åˆ¶åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| æ’­æ”¾/æš‚åœ | å¼€å§‹/æš‚åœå›æ”¾ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å€é€Ÿæ’­æ”¾ | 0.25x-8xå€é€Ÿ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æ—¶é—´è·³è½¬ | è·³è½¬åˆ°æŒ‡å®šæ—¶é—´ | âœ… | âœ… | âœ… | âœ… | âœ… |
| è¿›åº¦æ‹–æ‹½ | æ‹–æ‹½è¿›åº¦æ¡è·³è½¬ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å•å¸§æ’­æ”¾ | é€å¸§æ’­æ”¾ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å€’æ”¾ | å€’åºæ’­æ”¾ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å¾ªç¯æ’­æ”¾ | å¾ªç¯æ’­æ”¾å½•åƒ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ä¹¦ç­¾æ ‡è®° | æ·»åŠ /åˆ é™¤ä¹¦ç­¾ | âœ… | âœ… | âœ… | âœ… | âŒ |

#### 3.2.3 å½•åƒä¸‹è½½åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å•ç‰‡æ®µä¸‹è½½ | ä¸‹è½½æŒ‡å®šç‰‡æ®µ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å¤šç‰‡æ®µä¸‹è½½ | æ‰¹é‡ä¸‹è½½ç‰‡æ®µ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å®šæ—¶ä¸‹è½½ | å®šæ—¶ä¸‹è½½ä»»åŠ¡ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ä¸‹è½½ä»»åŠ¡ç®¡ç† | æŸ¥çœ‹/æš‚åœä¸‹è½½ä»»åŠ¡ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ä¸‹è½½è¿›åº¦æŸ¥çœ‹ | æŸ¥çœ‹ä¸‹è½½è¿›åº¦ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ä¸‹è½½å†å² | æŸ¥çœ‹ä¸‹è½½å†å² | âœ… | âœ… | âœ… | âŒ | âŒ |
| ä¸‹è½½æ ¼å¼é€‰æ‹© | é€‰æ‹©ä¸‹è½½æ ¼å¼ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ä¸‹è½½æ°´å° | æ·»åŠ æ°´å° | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 3.2.4 å½•åƒç®¡ç†åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å½•åƒåˆ—è¡¨ | æŸ¥çœ‹å½•åƒåˆ—è¡¨ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å½•åƒè¯¦æƒ… | æŸ¥çœ‹å½•åƒè¯¦æƒ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| å½•åƒåˆ é™¤ | åˆ é™¤å½•åƒ | âœ… | âœ… | âŒ | âŒ | âŒ |
| å½•åƒå¤‡ä»½ | å¤‡ä»½å½•åƒ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å½•åƒæ¢å¤ | æ¢å¤å½•åƒ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å½•åƒå½’æ¡£ | å½’æ¡£å†å²å½•åƒ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å½•åƒç»Ÿè®¡ | å½•åƒç»Ÿè®¡åˆ†æ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å­˜å‚¨åˆ†æ | å­˜å‚¨ä½¿ç”¨åˆ†æ | âœ… | âœ… | âœ… | âœ… | âŒ |

### 3.3 ä¸šåŠ¡æµç¨‹è®¾è®¡

#### 3.3.1 å½•åƒæŸ¥è¯¢å›æ”¾æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·è¿›å…¥å›æ”¾é¡µé¢] --> B[æ£€æŸ¥ç”¨æˆ·æƒé™]
    B --> C[è·å–ç”¨æˆ·å®‰å…¨çº§åˆ«]
    C --> D{æƒé™éªŒè¯}
    D -->|å¤±è´¥| E[æç¤ºæƒé™ä¸è¶³]
    D -->|æˆåŠŸ| F[é€‰æ‹©æŸ¥è¯¢æ¡ä»¶]
    F --> G[é€‰æ‹©è®¾å¤‡]
    G --> H[é€‰æ‹©æ—¶é—´èŒƒå›´]
    H --> I[é€‰æ‹©äº‹ä»¶ç±»å‹(å¯é€‰)]
    I --> J[æ‰§è¡ŒæŸ¥è¯¢]
    J --> K[æŸ¥è¯¢å½•åƒæ•°æ®]
    K --> L[è¿”å›å½•åƒåˆ—è¡¨]
    L --> M[ç”¨æˆ·é€‰æ‹©å½•åƒ]
    M --> N[æ£€æŸ¥å½•åƒè®¿é—®æƒé™]
    N --> O{æœ‰æƒé™?}
    O -->|å¦| P[æç¤ºæ— è®¿é—®æƒé™]
    O -->|æ˜¯| Q[åŠ è½½å½•åƒæ–‡ä»¶]
    Q --> R[åˆå§‹åŒ–æ’­æ”¾å™¨]
    R --> S[å¼€å§‹å›æ”¾]
    S --> T{å›æ”¾æ§åˆ¶}
    T -->|æš‚åœ| U[æš‚åœæ’­æ”¾]
    T -->|å¿«è¿›| V[è°ƒæ•´æ’­æ”¾é€Ÿåº¦]
    T -->|è·³è½¬| W[è·³è½¬åˆ°æŒ‡å®šæ—¶é—´]
    T -->|æ­£å¸¸| S
```

#### 3.3.2 å½•åƒä¸‹è½½æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant C as å®¢æˆ·ç«¯
    participant S as å›æ”¾æœåŠ¡
    participant F as æ–‡ä»¶æœåŠ¡
    participant D as å­˜å‚¨

    U->>C: é€‰æ‹©å½•åƒç‰‡æ®µ
    C->>C: æ£€æŸ¥ä¸‹è½½æƒé™
    C->>S: è¯·æ±‚ä¸‹è½½
    S->>S: éªŒè¯æƒé™
    S->>D: è·å–å½•åƒæ–‡ä»¶
    D-->>S: è¿”å›æ–‡ä»¶æ•°æ®
    S->>F: å¯åŠ¨ä¸‹è½½ä»»åŠ¡
    F->>F: å°è£…æ–‡ä»¶
    F->>C: è¿”å›ä¸‹è½½é“¾æ¥
    C->>U: æ˜¾ç¤ºä¸‹è½½é“¾æ¥
    U->>C: ç‚¹å‡»ä¸‹è½½
    C->>F: å‘é€ä¸‹è½½è¯·æ±‚
    F-->>C: è¿”å›æ–‡ä»¶æµ
    C->>U: ä¸‹è½½æ–‡ä»¶
```

### 3.4 æŠ€æœ¯å®ç°

```java
@RestController
@RequestMapping("/api/playback")
@SecurityLevel(value = 2) // éœ€è¦Level 2ä»¥ä¸Šæƒé™
public class PlaybackController {

    @Resource
    private PlaybackService playbackService;

    @Resource
    private PermissionService permissionService;

    @GetMapping("/records")
    public Result<Page<RecordVO>> getRecords(RecordQueryParam param) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ ¹æ®å®‰å…¨çº§åˆ«è¿‡æ»¤è®¾å¤‡
        if (userLevel < 4) {
            List<Long> deviceIds = permissionService.getAccessibleDevices(userId);
            param.setDeviceIds(deviceIds);
        }

        Page<RecordVO> result = playbackService.getRecords(param);
        return Result.success(result);
    }

    @GetMapping("/stream/{recordId}")
    public Result<Map<String, String>> getPlaybackStream(@PathVariable Long recordId) {
        Long userId = getCurrentUserId();

        // æ£€æŸ¥å½•åƒè®¿é—®æƒé™
        Record record = playbackService.getRecordById(recordId);
        if (!permissionService.hasDevicePermission(userId, record.getDeviceId(), "view")) {
            throw new ForbiddenException("æ— å½•åƒè®¿é—®æƒé™");
        }

        String streamUrl = playbackService.getRecordStreamUrl(recordId);
        Map<String, String> result = new HashMap<>();
        result.put("streamUrl", streamUrl);
        return Result.success(result);
    }

    @PostMapping("/download")
    public Result<Long> downloadRecord(@RequestBody DownloadRequest request) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ£€æŸ¥ä¸‹è½½æƒé™ï¼ˆLevel 3ä»¥ä¸Šï¼‰
        if (userLevel < 3) {
            throw new ForbiddenException("æ— å½•åƒä¸‹è½½æƒé™");
        }

        // æ£€æŸ¥å½•åƒæƒé™
        Record record = playbackService.getRecordById(request.getRecordId());
        if (!permissionService.hasDevicePermission(userId, record.getDeviceId(), "download")) {
            throw new ForbiddenException("æ— ä¸‹è½½æƒé™");
        }

        Long taskId = playbackService.createDownloadTask(userId, request);
        return Result.success(taskId);
    }
}
```

---

## 4. è¡Œä¸ºåˆ†ææ¨¡å—

### 4.1 åŠŸèƒ½æ¦‚è¿°

è¡Œä¸ºåˆ†ææ¨¡å—é›†æˆAIç®—æ³•ï¼Œæä¾›äººè„¸è¯†åˆ«ã€è¡Œä¸ºåˆ†æã€å¼‚å¸¸æ£€æµ‹ç­‰æ™ºèƒ½åˆ†æåŠŸèƒ½ï¼Œæ”¯æŒç®—æ³•é…ç½®ã€è§„åˆ™ç®¡ç†ã€ç»“æœæŸ¥çœ‹ã€‚

### 4.2 åŠŸèƒ½æ¸…å•

#### 4.2.1 ç®—æ³•ç®¡ç†åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| ç®—æ³•æ¨¡å‹ç®¡ç† | æ¨¡å‹çš„CRUDæ“ä½œ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç®—æ³•å‚æ•°é…ç½® | é…ç½®ç®—æ³•å‚æ•° | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç®—æ³•ç‰ˆæœ¬ç®¡ç† | ç®¡ç†ç®—æ³•ç‰ˆæœ¬ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç®—æ³•æ€§èƒ½è°ƒä¼˜ | æ€§èƒ½å‚æ•°è°ƒä¼˜ | âœ… | âœ… | âŒ | âŒ | âŒ |
| æ¨¡å‹è®­ç»ƒ | è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹ | âœ… | âœ… | âŒ | âŒ | âŒ |
| æ¨¡å‹æ›´æ–° | æ›´æ–°ç®—æ³•æ¨¡å‹ | âœ… | âœ… | âŒ | âŒ | âŒ |
| æ¨¡å‹è¯„ä¼° | è¯„ä¼°æ¨¡å‹æ€§èƒ½ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç®—æ³•ç›‘æ§ | ç›‘æ§ç®—æ³•è¿è¡ŒçŠ¶æ€ | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 4.2.2 æ£€æµ‹è§„åˆ™åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| æ£€æµ‹åŒºåŸŸè®¾ç½® | è®¾ç½®æ£€æµ‹åŒºåŸŸ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æ£€æµ‹è§„åˆ™é…ç½® | é…ç½®æ£€æµ‹è§„åˆ™ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦é˜ˆå€¼è®¾ç½® | è®¾ç½®å‘Šè­¦é˜ˆå€¼ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æ£€æµ‹æ—¶é—´æ®µ | è®¾ç½®æ£€æµ‹æ—¶é—´æ®µ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç›®æ ‡è¿‡æ»¤ | è¿‡æ»¤æ£€æµ‹ç›®æ ‡ | âœ… | âœ… | âœ… | âŒ | âŒ |
| è§„åˆ™æ¨¡æ¿ | ç®¡ç†è§„åˆ™æ¨¡æ¿ | âœ… | âœ… | âœ… | âŒ | âŒ |
| æ‰¹é‡è§„åˆ™é…ç½® | æ‰¹é‡é…ç½®è§„åˆ™ | âœ… | âœ… | âœ… | âŒ | âŒ |
| è§„åˆ™ä¼˜å…ˆçº§ | è®¾ç½®è§„åˆ™ä¼˜å…ˆçº§ | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 4.2.3 åˆ†æç»“æœåŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å®æ—¶åˆ†æç»“æœ | æŸ¥çœ‹å®æ—¶åˆ†æç»“æœ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å†å²åˆ†æç»“æœ | æŸ¥çœ‹å†å²åˆ†æç»“æœ | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç»“æœç­›é€‰ | ç­›é€‰åˆ†æç»“æœ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç»“æœå¯¼å‡º | å¯¼å‡ºåˆ†æç»“æœ | âœ… | âœ… | âœ… | âŒ | âŒ |
| ç»“æœè¯¦æƒ… | æŸ¥çœ‹ç»“æœè¯¦æƒ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| ç»“æœç¡®è®¤ | ç¡®è®¤/é©³å›ç»“æœ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ç»“æœåˆ é™¤ | åˆ é™¤åˆ†æç»“æœ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç»“æœç»Ÿè®¡ | ç»Ÿè®¡åˆ†æç»“æœ | âœ… | âœ… | âœ… | âœ… | âŒ |

### 4.3 æŠ€æœ¯å®ç°

```java
@RestController
@RequestMapping("/api/analysis")
@SecurityLevel(value = 3) // éœ€è¦Level 3ä»¥ä¸Šæƒé™
public class AnalysisController {

    @Resource
    private AnalysisService analysisService;

    @GetMapping("/algorithms")
    public Result<List<AlgorithmVO>> getAlgorithms() {
        return Result.success(analysisService.getAlgorithms());
    }

    @PostMapping("/rules")
    public Result<Long> createAnalysisRule(@RequestBody AnalysisRuleRequest request) {
        Long userId = getCurrentUserId();

        // æ£€æŸ¥è§„åˆ™åˆ›å»ºæƒé™
        if (!permissionService.hasPermission(userId, "analysis:rule:create")) {
            throw new ForbiddenException("æ— è§„åˆ™åˆ›å»ºæƒé™");
        }

        AnalysisRule rule = new AnalysisRule();
        BeanUtils.copyProperties(request, rule);
        rule.setCreateBy(userId);

        Long ruleId = analysisService.createRule(rule);
        return Result.success(ruleId);
    }

    @GetMapping("/results")
    public Result<Page<AnalysisResultVO>> getAnalysisResults(ResultQueryParam param) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ ¹æ®å®‰å…¨çº§åˆ«è¿‡æ»¤è®¾å¤‡
        if (userLevel < 4) {
            List<Long> deviceIds = permissionService.getAccessibleDevices(userId);
            param.setDeviceIds(deviceIds);
        }

        Page<AnalysisResultVO> result = analysisService.getResults(param);
        return Result.success(result);
    }
}
```

---

## 5. å‘Šè­¦ç®¡ç†æ¨¡å—

### 5.1 åŠŸèƒ½æ¦‚è¿°

å‘Šè­¦ç®¡ç†æ¨¡å—æä¾›å‘Šè­¦é…ç½®ã€äº‹ä»¶å¤„ç†ã€è”åŠ¨æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œæ”¯æŒå®æ—¶å‘Šè­¦ã€è§„åˆ™é…ç½®ã€æ™ºèƒ½è”åŠ¨ã€‚

### 5.2 åŠŸèƒ½æ¸…å•

#### 5.2.1 å‘Šè­¦é…ç½®åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å‘Šè­¦è§„åˆ™é…ç½® | é…ç½®å‘Šè­¦è§„åˆ™ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦è”åŠ¨é…ç½® | é…ç½®å‘Šè­¦è”åŠ¨ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦é€šçŸ¥é…ç½® | é…ç½®é€šçŸ¥æ–¹å¼ | âœ… | âœ… | âŒ | âŒ | âŒ |
| å‘Šè­¦æ¨¡æ¿ç®¡ç† | ç®¡ç†å‘Šè­¦æ¨¡æ¿ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦çº§åˆ«è®¾ç½® | è®¾ç½®å‘Šè­¦çº§åˆ« | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦æŠ‘åˆ¶é…ç½® | é…ç½®å‘Šè­¦æŠ‘åˆ¶ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦å‡çº§é…ç½® | é…ç½®å‘Šè­¦å‡çº§ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦è¿‡æ»¤é…ç½® | é…ç½®å‘Šè­¦è¿‡æ»¤ | âœ… | âœ… | âœ… | âŒ | âŒ |

#### 5.2.2 å‘Šè­¦å¤„ç†åŠŸèƒ½

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| å®æ—¶å‘Šè­¦æŸ¥çœ‹ | æŸ¥çœ‹å®æ—¶å‘Šè­¦ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å†å²å‘Šè­¦æŸ¥è¯¢ | æŸ¥è¯¢å†å²å‘Šè­¦ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å‘Šè­¦ç¡®è®¤ | ç¡®è®¤å‘Šè­¦ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å‘Šè­¦å¤„ç† | å¤„ç†å‘Šè­¦ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å‘Šè­¦åé¦ˆ | åé¦ˆå¤„ç†ç»“æœ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å‘Šè­¦è½¬å‘ | è½¬å‘å‘Šè­¦ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å‘Šè­¦åˆå¹¶ | åˆå¹¶é‡å¤å‘Šè­¦ | âœ… | âœ… | âœ… | âŒ | âŒ |
| å‘Šè­¦å±è”½ | ä¸´æ—¶å±è”½å‘Šè­¦ | âœ… | âœ… | âœ… | âŒ | âŒ |

### 5.3 æŠ€æœ¯å®ç°

```java
@RestController
@RequestMapping("/api/alarm")
@SecurityLevel(value = 2) // éœ€è¦Level 2ä»¥ä¸Šæƒé™
public class AlarmController {

    @Resource
    private AlarmService alarmService;

    @GetMapping("/realtime")
    public Result<List<AlarmVO>> getRealtimeAlarms() {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        List<Alarm> alarms = alarmService.getRealtimeAlarms();

        // æ ¹æ®å®‰å…¨çº§åˆ«è¿‡æ»¤å‘Šè­¦
        if (userLevel < 4) {
            List<Long> deviceIds = permissionService.getAccessibleDevices(userId);
            alarms = alarms.stream()
                .filter(alarm -> deviceIds.contains(alarm.getDeviceId()))
                .collect(Collectors.toList());
        }

        return Result.success(alarms);
    }

    @PostMapping("/{alarmId}/confirm")
    public Result<Void> confirmAlarm(@PathVariable Long alarmId,
                                     @RequestBody AlarmConfirmRequest request) {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        // æ£€æŸ¥ç¡®è®¤æƒé™ï¼ˆLevel 2ä»¥ä¸Šå¯ç¡®è®¤ï¼ŒLevel 1åªèƒ½æŸ¥çœ‹ï¼‰
        Alarm alarm = alarmService.getById(alarmId);
        if (!permissionService.hasDevicePermission(userId, alarm.getDeviceId(), "alarm:confirm")) {
            throw new ForbiddenException("æ— å‘Šè­¦ç¡®è®¤æƒé™");
        }

        alarmService.confirmAlarm(alarmId, userId, request.getNote());
        return Result.success();
    }
}
```

---

## 6. è§£ç ä¸Šå¢™æ¨¡å—

### 6.1 åŠŸèƒ½æ¦‚è¿°

è§£ç ä¸Šå¢™æ¨¡å—æä¾›è§£ç å™¨ç®¡ç†ã€å¤§å±æ§åˆ¶ã€å¤šå±è”åŠ¨ç­‰åŠŸèƒ½ï¼Œæ”¯æŒå®æ—¶è§†é¢‘ä¸Šå¢™ã€å›æ”¾ç”»é¢ä¸Šå¢™ã€‚

### 6.2 åŠŸèƒ½æ¸…å•

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° | ç»å¯†çº§ | æœºå¯†çº§ | ç§˜å¯†çº§ | å†…éƒ¨çº§ | å…¬å¼€çº§ |
|--------|---------|--------|--------|--------|--------|--------|
| è§£ç å™¨æ³¨å†Œ | æ³¨å†Œè§£ç å™¨è®¾å¤‡ | âœ… | âœ… | âœ… | âŒ | âŒ |
| è§£ç å™¨é…ç½® | é…ç½®è§£ç å™¨å‚æ•° | âœ… | âœ… | âœ… | âŒ | âŒ |
| å¤§å±å¸ƒå±€é…ç½® | é…ç½®å¤§å±å¸ƒå±€ | âœ… | âœ… | âœ… | âŒ | âŒ |
| çª—å£ç®¡ç† | ç®¡ç†æ˜¾ç¤ºçª—å£ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å®æ—¶è§†é¢‘ä¸Šå¢™ | ä¸Šå¢™å®æ—¶è§†é¢‘ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å½•åƒå›æ”¾ä¸Šå¢™ | ä¸Šå¢™å›æ”¾ç”»é¢ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å›¾ç‰‡ä¸Šå¢™ | ä¸Šå¢™å›¾ç‰‡ | âœ… | âœ… | âœ… | âœ… | âŒ |
| å¤šå±è”åŠ¨ | é…ç½®å¤šå±è”åŠ¨ | âœ… | âœ… | âœ… | âŒ | âŒ |

### 6.3 æŠ€æœ¯å®ç°

```java
@RestController
@RequestMapping("/api/wall")
@SecurityLevel(value = 2) // éœ€è¦Level 2ä»¥ä¸Šæƒé™
public class WallController {

    @Resource
    private WallService wallService;

    @PostMapping("/{wallId}/display")
    public Result<Void> displayVideo(@PathVariable Long wallId,
                                     @RequestBody DisplayRequest request) {
        Long userId = getCurrentUserId();

        // æ£€æŸ¥ä¸Šå¢™æƒé™
        if (!permissionService.hasWallPermission(userId, wallId, "display")) {
            throw new ForbiddenException("æ— ä¸Šå¢™æƒé™");
        }

        wallService.displayVideo(wallId, request);
        return Result.success();
    }
}
```

---

## 7. æ¶ˆæ¯ä¸­å¿ƒæ¨¡å—

### 7.1 åŠŸèƒ½æ¦‚è¿°

æ¶ˆæ¯ä¸­å¿ƒæ¨¡å—æ˜¯ç³»ç»Ÿçš„æ¶ˆæ¯æ¢çº½ï¼Œè´Ÿè´£äº‹ä»¶è®¢é˜…ã€æ¶ˆæ¯æ¨é€ã€é€šçŸ¥ç®¡ç†ï¼Œæ”¯æŒå¤šç§é€šçŸ¥æ¸ é“ã€‚

### 7.2 åŠŸèƒ½æ¸…å•

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° |
|--------|---------|
| äº‹ä»¶è®¢é˜…ç®¡ç† | ç®¡ç†äº‹ä»¶è®¢é˜…è§„åˆ™ |
| æ¶ˆæ¯æ¨é€æœºåˆ¶ | å®æ—¶æ¶ˆæ¯æ¨é€ |
| é€šçŸ¥æ¸ é“é…ç½® | é…ç½®çŸ­ä¿¡ã€é‚®ä»¶ã€APPæ¨é€ |
| æ¶ˆæ¯æ¨¡æ¿ç®¡ç† | ç®¡ç†æ¶ˆæ¯æ¨¡æ¿ |
| æ¨é€è®°å½•ç»Ÿè®¡ | ç»Ÿè®¡æ¨é€è®°å½• |
| æ¶ˆæ¯é˜Ÿåˆ—ç®¡ç† | ç®¡ç†æ¶ˆæ¯é˜Ÿåˆ— |
| å¤±è´¥é‡è¯•æœºåˆ¶ | å¤±è´¥æ¶ˆæ¯é‡è¯• |
| æ¨é€æ€§èƒ½ç›‘æ§ | ç›‘æ§æ¨é€æ€§èƒ½ |

### 7.3 æŠ€æœ¯å®ç°

```java
@Service
public class MessageCenterService {

    @Resource
    private RabbitTemplate rabbitTemplate;

    // å‘å¸ƒäº‹ä»¶
    public void publishEvent(Event event) {
        // æŸ¥æ‰¾è®¢é˜…è€…
        List<Subscription> subscriptions = subscriptionService.getSubscriptions(event.getType());

        for (Subscription subscription : subscriptions) {
            // æ£€æŸ¥è®¢é˜…æ¡ä»¶
            if (matchesCondition(subscription, event)) {
                // å‘é€æ¶ˆæ¯
                sendMessage(subscription, event);
            }
        }

        // è®°å½•äº‹ä»¶
        eventLogService.recordEvent(event);
    }

    // å‘é€æ¶ˆæ¯
    private void sendMessage(Subscription subscription, Event event) {
        Message message = new Message();
        message.setSubscriberId(subscription.getSubscriberId());
        message.setEventType(event.getType());
        message.setContent(transformContent(event, subscription.getTemplate()));

        // æ ¹æ®æ¸ é“å‘é€
        for (String channel : subscription.getChannels()) {
            switch (channel) {
                case "SMS":
                    smsService.send(message);
                    break;
                case "EMAIL":
                    emailService.send(message);
                    break;
                case "APP":
                    appPushService.send(message);
                    break;
            }
        }
    }
}
```

---

## 8. åœ°å›¾æ˜¾ç¤ºæ¨¡å—

### 8.1 åŠŸèƒ½æ¦‚è¿°

åœ°å›¾æ˜¾ç¤ºæ¨¡å—æä¾›GISåœ°å›¾å±•ç¤ºã€è®¾å¤‡å®šä½ã€åŒºåŸŸç®¡ç†ã€åœ°å›¾è”åŠ¨ç­‰åŠŸèƒ½ã€‚

### 8.2 åŠŸèƒ½æ¸…å•

| åŠŸèƒ½é¡¹ | åŠŸèƒ½æè¿° |
|--------|---------|
| GISåœ°å›¾æ˜¾ç¤º | æ˜¾ç¤ºåœ°å›¾ç•Œé¢ |
| è®¾å¤‡ä½ç½®æ ‡æ³¨ | åœ¨åœ°å›¾ä¸Šæ ‡æ³¨è®¾å¤‡ |
| åŒºåŸŸç®¡ç† | ç®¡ç†ç›‘æ§åŒºåŸŸ |
| è½¨è¿¹å›æ”¾ | è®¾å¤‡è½¨è¿¹å›æ”¾ |
| åœ°å›¾è”åŠ¨ | ç‚¹å‡»åœ°å›¾è”åŠ¨è§†é¢‘ |
| æ¡†é€‰åŠŸèƒ½ | æ¡†é€‰åŒºåŸŸè®¾å¤‡ |
| æµ‹è·åŠŸèƒ½ | åœ°å›¾æµ‹è· |
| æ ‡æ³¨ç®¡ç† | ç®¡ç†åœ°å›¾æ ‡æ³¨ |

### 8.3 æŠ€æœ¯å®ç°

```java
@RestController
@RequestMapping("/api/map")
@SecurityLevel(value = 1) // Level 1ä»¥ä¸Šæƒé™
public class MapController {

    @GetMapping("/devices")
    public Result<List<DeviceLocationVO>> getDeviceLocations() {
        Long userId = getCurrentUserId();
        int userLevel = getCurrentUserLevel(userId);

        List<Device> devices;
        if (userLevel >= 4) {
            devices = deviceService.getAllDevices();
        } else {
            devices = deviceService.getAssignedDevices(userId);
        }

        List<DeviceLocationVO> locations = devices.stream()
            .filter(d -> d.getLatitude() != null && d.getLongitude() != null)
            .map(d -> {
                DeviceLocationVO vo = new DeviceLocationVO();
                vo.setDeviceId(d.getId());
                vo.setDeviceName(d.getName());
                vo.setLatitude(d.getLatitude());
                vo.setLongitude(d.getLongitude());
                vo.setStatus(d.getStatus());
                return vo;
            })
            .collect(Collectors.toList());

        return Result.success(locations);
    }
}
```

---

## ğŸ“ æ€»ç»“

æœ¬åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£è¦†ç›–äº†æ™ºèƒ½è§†é¢‘æ¨¡å—çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **å®æ—¶ç›‘æ§æ¨¡å—**ï¼šè§†é¢‘é¢„è§ˆã€äº‘å°æ§åˆ¶ã€æˆªå›¾å½•åƒã€ç”»é¢ä¸Šå¢™
2. **è®¾å¤‡ç®¡ç†æ¨¡å—**ï¼šè®¾å¤‡æ³¨å†Œã€é…ç½®ã€æ“ä½œã€åˆ†ç»„ç®¡ç†
3. **å½•åƒå›æ”¾æ¨¡å—**ï¼šå½•åƒæŸ¥è¯¢ã€å›æ”¾æ§åˆ¶ã€ä¸‹è½½ã€ç®¡ç†
4. **è¡Œä¸ºåˆ†ææ¨¡å—**ï¼šç®—æ³•ç®¡ç†ã€æ£€æµ‹è§„åˆ™ã€åˆ†æç»“æœ
5. **å‘Šè­¦ç®¡ç†æ¨¡å—**ï¼šå‘Šè­¦é…ç½®ã€äº‹ä»¶å¤„ç†ã€è”åŠ¨æ§åˆ¶
6. **è§£ç ä¸Šå¢™æ¨¡å—**ï¼šè§£ç å™¨ç®¡ç†ã€å¤§å±æ§åˆ¶ã€å¤šå±è”åŠ¨
7. **æ¶ˆæ¯ä¸­å¿ƒæ¨¡å—**ï¼šäº‹ä»¶è®¢é˜…ã€æ¶ˆæ¯æ¨é€ã€é€šçŸ¥ç®¡ç†
8. **åœ°å›¾æ˜¾ç¤ºæ¨¡å—**ï¼šåœ°å›¾å±•ç¤ºã€è®¾å¤‡å®šä½ã€åŒºåŸŸç®¡ç†

æ¯ä¸ªæ¨¡å—éƒ½æŒ‰ç…§5çº§å®‰å…¨ä½“ç³»è¿›è¡Œæƒé™è®¾è®¡ï¼Œç¡®ä¿ä¸åŒçº§åˆ«ç”¨æˆ·è®¿é—®ç›¸åº”æƒé™çš„åŠŸèƒ½ã€‚

**ä¸‹ä¸€æ­¥**ï¼šåˆ›å»ºç•Œé¢åŸå‹å›¾è®¾è®¡æ–‡æ¡£ï¼Œè¯¦ç»†å±•ç¤ºæ¯ä¸ªé¡µé¢çš„è®¾è®¡ã€‚

---

*æœ¬æ–‡æ¡£è¯¦ç»†å®šä¹‰äº†æ™ºèƒ½è§†é¢‘æ¨¡å—çš„æ‰€æœ‰åŠŸèƒ½ç‚¹ã€ä¸šåŠ¡æµç¨‹å’ŒæŠ€æœ¯å®ç°ã€‚*
