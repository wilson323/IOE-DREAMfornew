global:
  resolve_timeout: 5m
  # 邮件通知配置（需要根据实际环境修改）
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alertmanager@ioedream.com'
  smtp_auth_username: 'alertmanager@ioedream.com'
  smtp_auth_password: 'your-password-here'
  smtp_require_tls: true

# 路由配置
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default-receiver'
  routes:
    # 严重告警立即通知
    - match:
        severity: critical
      receiver: 'critical-receiver'
      continue: true
    # 协议相关告警
    - match:
        service: device-comm-service
      receiver: 'protocol-receiver'
      continue: true
    # 系统告警
    - match:
        alert_type: system
      receiver: 'system-receiver'
      continue: true

# 抑制规则（避免告警风暴）
inhibit_rules:
  # 如果严重告警触发，抑制相同服务的警告告警
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']

# 接收器配置
receivers:
  # 默认接收器（邮件）
  - name: 'default-receiver'
    email_configs:
      - to: 'devops@ioedream.com'
        headers:
          Subject: '{{ .GroupLabels.alertname }} - {{ .GroupLabels.service }}'
        html: |
          <h2>告警通知</h2>
          <p><strong>告警名称:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>服务:</strong> {{ .GroupLabels.service }}</p>
          <p><strong>严重程度:</strong> {{ .GroupLabels.severity }}</p>
          <p><strong>告警详情:</strong></p>
          <ul>
            {{ range .Alerts }}
            <li>{{ .Annotations.description }}</li>
            {{ end }}
          </ul>
          <p><strong>处理手册:</strong> <a href="{{ .Annotations.runbook_url }}">查看详情</a></p>

  # 严重告警接收器（邮件 + 钉钉）
  - name: 'critical-receiver'
    email_configs:
      - to: 'devops@ioedream.com,oncall@ioedream.com'
        headers:
          Subject: '[CRITICAL] {{ .GroupLabels.alertname }}'
        html: |
          <h2 style="color: red;">严重告警通知</h2>
          <p><strong>告警名称:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>服务:</strong> {{ .GroupLabels.service }}</p>
          <p><strong>告警详情:</strong></p>
          <ul>
            {{ range .Alerts }}
            <li>{{ .Annotations.description }}</li>
            {{ end }}
          </ul>
          <p><strong>处理手册:</strong> <a href="{{ .Annotations.runbook_url }}">查看详情</a></p>
    # 钉钉通知（需要配置钉钉机器人Webhook）
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=your-dingtalk-token'
        send_resolved: true
        http_config:
          bearer_token: 'your-bearer-token'

  # 协议服务接收器（邮件 + 钉钉）
  - name: 'protocol-receiver'
    email_configs:
      - to: 'protocol-team@ioedream.com'
        headers:
          Subject: '[Protocol] {{ .GroupLabels.alertname }}'
        html: |
          <h2>协议服务告警</h2>
          <p><strong>告警名称:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>服务:</strong> {{ .GroupLabels.service }}</p>
          <p><strong>严重程度:</strong> {{ .GroupLabels.severity }}</p>
          <p><strong>告警详情:</strong></p>
          <ul>
            {{ range .Alerts }}
            <li>{{ .Annotations.description }}</li>
            {{ end }}
          </ul>
          <p><strong>处理手册:</strong> <a href="{{ .Annotations.runbook_url }}">查看详情</a></p>
    # 钉钉通知
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=your-dingtalk-token'
        send_resolved: true

  # 系统告警接收器
  - name: 'system-receiver'
    email_configs:
      - to: 'system-admin@ioedream.com'
        headers:
          Subject: '[System] {{ .GroupLabels.alertname }}'
        html: |
          <h2>系统告警</h2>
          <p><strong>告警名称:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>告警详情:</strong></p>
          <ul>
            {{ range .Alerts }}
            <li>{{ .Annotations.description }}</li>
            {{ end }}
          </ul>

