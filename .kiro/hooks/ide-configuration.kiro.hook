# IOE-DREAM IDEé…ç½®Hook
# ä¸ºå¼€å‘è€…æä¾›IDEçº§åˆ«çš„å®æ—¶ä»£ç è´¨é‡æ£€æŸ¥å’Œè§„èŒƒæç¤º

hook {
  name: "IDEé…ç½®å’Œå®æ—¶æ£€æŸ¥å™¨"
  description: "ä¸ºIDEæä¾›å®æ—¶ä»£ç è´¨é‡æ£€æŸ¥ã€è§„èŒƒæç¤ºå’Œæœ€ä½³å®è·µå»ºè®®ï¼Œç¡®ä¿å¼€å‘è¿‡ç¨‹ä¸­éµå¾ªIOE-DREAMä¼ä¸šçº§æ ‡å‡†"
  priority: "P0"

  # è§¦å‘æ¡ä»¶
  triggers {
    ide_events {
      events: ["file_open", "file_save", "code_completion", "refactor"]
      file_types: ["*.java", "*.xml", "*.yml", "*.yaml", "*.md"]
    }

    file_patterns {
      # Javaæºç æ–‡ä»¶
      include: ["**/src/main/java/**/*.java"]
      include: ["**/src/test/java/**/*.java"]
      # é…ç½®æ–‡ä»¶
      include: ["**/src/main/resources/**/*.yml"]
      include: ["**/src/main/resources/**/*.yaml"]
      include: ["**/src/main/resources/**/*.xml"]
      # æ–‡æ¡£æ–‡ä»¶
      include: ["**/*.md"]
    }
  }

  # æ‰§è¡Œé˜¶æ®µ
  stages {
    stage1: {
      name: "Javaä»£ç å®æ—¶æ£€æŸ¥"
      commands: [
        "echo \"ğŸ’» Stage 1: Javaä»£ç å®æ—¶æ£€æŸ¥\"",
        "",
        "# æ£€æŸ¥æ³¨è§£ä½¿ç”¨è§„èŒƒ",
        "echo \"æ£€æŸ¥æ³¨è§£ä½¿ç”¨è§„èŒƒ...\"",
        "AUTOWIRED_CHECK=$(grep -n \"@Autowired\" \"$1\" 2>/dev/null || echo \"\")",
        "if [ ! -z \"$AUTOWIRED_CHECK\" ]; then",
        "  echo \"âŒ ç¬¬$(echo $AUTOWIRED_CHECK | cut -d: -f1)è¡Œï¼š@Autowiredè¿è§„ä½¿ç”¨ï¼Œåº”ä½¿ç”¨@Resource\"",
        "  echo \"å»ºè®®ä¿®æ”¹ä¸ºï¼š@Resource\"",
        "fi",
        "",
        "REPOSITORY_CHECK=$(grep -n \"@Repository\" \"$1\" 2>/dev/null || echo \"\")",
        "if [ ! -z \"$REPOSITORY_CHECK\" ]; then",
        "  echo \"âŒ ç¬¬$(echo $REPOSITORY_CHECK | cut -d: -f1)è¡Œï¼š@Repositoryè¿è§„ä½¿ç”¨ï¼Œåº”ä½¿ç”¨@Mapper\"",
        "  echo \"å»ºè®®ä¿®æ”¹ä¸ºï¼š@Mapper\"",
        "fi",
        "",
        "# æ£€æŸ¥åŒ…å¯¼å…¥è§„èŒƒ",
        "echo \"æ£€æŸ¥åŒ…å¯¼å…¥è§„èŒƒ...\"",
        "JPA_IMPORTS=$(grep -n \"jakarta.persistence\" \"$1\" 2>/dev/null || echo \"\")",
        "if [ ! -z \"$JPA_IMPORTS\" ]; then",
        "  echo \"âŒ ç¬¬$(echo $JPA_IMPORTS | cut -d: -f1)è¡Œï¼šJPAåŒ…å¯¼å…¥è¿è§„ï¼Œåº”ä½¿ç”¨MyBatis-Plus\"",
        "  echo \"å»ºè®®ç§»é™¤jakarta.persistenceå¯¼å…¥ï¼Œä½¿ç”¨MyBatis-Plusæ³¨è§£\"",
        "fi",
        "",
        "# æ£€æŸ¥æ—¥å¿—æ³¨è§£ä½¿ç”¨",
        "echo \"æ£€æŸ¥æ—¥å¿—æ³¨è§£ä½¿ç”¨...\"",
        "LOMBOK_SLF4J_CHECK=$(grep -n \"@Slf4j\" \"$1\" 2>/dev/null || echo \"\")",
        "LOGGER_FACTORY_CHECK=$(grep -n \"LoggerFactory.getLogger\" \"$1\" 2>/dev/null || echo \"\")",
        "if [ -z \"$LOMBOK_SLF4J_CHECK\" ] && [ ! -z \"$LOGGER_FACTORY_CHECK\" ]; then",
        "  echo \"âš ï¸ å»ºè®®ï¼šä½¿ç”¨@Slf4jæ³¨è§£æ›¿ä»£LoggerFactory.getLogger()\"",
        "  echo \"æ·»åŠ ï¼šimport lombok.extern.slf4j.Slf4j;\"",
        "  echo \"ç±»ä¸Šæ·»åŠ ï¼š@Slf4jæ³¨è§£\"",
        "fi",
        "",
        "echo \"âœ… Javaä»£ç å®æ—¶æ£€æŸ¥å®Œæˆ\""
      ]
    }

    stage2: {
      name: "æ¶æ„æ¨¡å¼å®æ—¶æ£€æŸ¥"
      commands: [
        "echo \"ğŸ—ï¸ Stage 2: æ¶æ„æ¨¡å¼å®æ—¶æ£€æŸ¥\"",
        "",
        "# æ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œä½ç½®",
        "FILE_PATH=\"$1\"",
        "if echo \"$FILE_PATH\" | grep -q \"Controller.java\"; then",
        "  echo \"æ£€æŸ¥Controllerå±‚æ¶æ„è§„èŒƒ...\"",
        "  ",
        "  # æ£€æŸ¥Controlleræ˜¯å¦ç›´æ¥æ³¨å…¥DAO",
        "  DAO_INJECTION=$(grep -n \"Dao\\|Mapper\" \"$1\" 2>/dev/null || echo \"\")",
        "  if [ ! -z \"$DAO_INJECTION\" ]; then",
        "    echo \"âŒ Controllerå±‚ä¸åº”ç›´æ¥æ³¨å…¥DAOï¼Œåº”é€šè¿‡Serviceå±‚\"",
        "    echo \"å»ºè®®æ¶æ„ï¼šController â†’ Service â†’ Manager â†’ DAO\"",
        "  fi",
        "  ",
        "  # æ£€æŸ¥RESTæ³¨è§£ä½¿ç”¨",
        "  REST_MAPPING_CHECK=$(grep -n \"@RequestMapping\\|@GetMapping\\|@PostMapping\" \"$1\" 2>/dev/null || echo \"\")",
        "  if [ -z \"$REST_MAPPING_CHECK\" ]; then",
        "    echo \"âš ï¸ å»ºè®®ï¼šä¸ºControlleræ·»åŠ RESTæ˜ å°„æ³¨è§£\"",
        "  fi",
        "fi",
        "",
        "if echo \"$FILE_PATH\" | grep -q \"Service.java\"; then",
        "  echo \"æ£€æŸ¥Serviceå±‚æ¶æ„è§„èŒƒ...\"",
        "  ",
        "  # æ£€æŸ¥Serviceæ˜¯å¦ç›´æ¥æ“ä½œMyBatis-Plus",
        "  MYBATIS_DIRECT_CHECK=$(grep -n \"insert\\|update\\|delete\\|selectList\" \"$1\" 2>/dev/null || echo \"\")",
        "  if [ ! -z \"$MYBATIS_DIRECT_CHECK\" ]; then",
        "    echo \"âš ï¸ å»ºè®®ï¼šServiceå±‚åº”é€šè¿‡Managerå±‚æ“ä½œæ•°æ®ï¼Œé¿å…ç›´æ¥ä½¿ç”¨MyBatis-Plusæ–¹æ³•\"",
        "  fi",
        "fi",
        "",
        "if echo \"$FILE_PATH\" | grep -q \"Manager.java\"; then",
        "  echo \"æ£€æŸ¥Managerå±‚æ¶æ„è§„èŒƒ...\"",
        "  ",
        "  # æ£€æŸ¥Manageræ˜¯å¦ä½¿ç”¨Springæ³¨è§£",
        "  SPRING_ANNOTATIONS=$(grep -n \"@Component\\|@Service\\|@Repository\" \"$1\" 2>/dev/null || echo \"\")",
        "  if [ ! -z \"$SPRING_ANNOTATIONS\" ]; then",
        "    echo \"âš ï¸ å»ºè®®ï¼šManagerå±‚åº”ä¸ºçº¯Javaç±»ï¼Œä¸ä½¿ç”¨Springæ³¨è§£\"",
        "  fi",
        "fi",
        "",
        "echo \"âœ… æ¶æ„æ¨¡å¼å®æ—¶æ£€æŸ¥å®Œæˆ\""
      ]
    }

    stage3: {
      name: "ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µæ£€æŸ¥"
      commands: [
        "echo \"ğŸ“ Stage 3: ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µæ£€æŸ¥\"",
        "",
        "# æ£€æŸ¥æ–¹æ³•å¤æ‚åº¦",
        "echo \"æ£€æŸ¥æ–¹æ³•å¤æ‚åº¦...\"",
        "LONG_METHODS=$(grep -n -A 20 \"public.*{$\" \"$1\" 2>/dev/null | awk '/public.*{$/{flag=1; line=NR} flag && /}$/{print line\":\"NR-1; flag=0}' | awk -F: '$2-$1>20{print $1}')",
        "if [ ! -z \"$LONG_METHODS\" ]; then",
        "  echo \"âš ï¸ å‘ç°é•¿æ–¹æ³•ï¼ˆè¶…è¿‡20è¡Œï¼‰ï¼Œå»ºè®®æ‹†åˆ†ä¸ºå¤šä¸ªæ–¹æ³•ï¼š$LONG_METHODS\"",
        "fi",
        "",
        "# æ£€æŸ¥å¼‚å¸¸å¤„ç†",
        "echo \"æ£€æŸ¥å¼‚å¸¸å¤„ç†...\"",
        "CATCH_BLOCKS=$(grep -n -A 2 \"catch.*{\" \"$1\" 2>/dev/null || echo \"\")",
        "if echo \"$CATCH_BLOCKS\" | grep -q \"printStackTrace\"; then",
        "  echo \"âš ï¸ å»ºè®®ï¼šé¿å…ä½¿ç”¨printStackTrace()ï¼Œåº”ä½¿ç”¨æ—¥å¿—æ¡†æ¶è®°å½•å¼‚å¸¸\"",
        "fi",
        "",
        "if echo \"$CATCH_BLOCKS\" | grep -q \"catch.*Exception.*Exception\"; then",
        "  echo \"âš ï¸ å»ºè®®ï¼šä½¿ç”¨å…·ä½“çš„å¼‚å¸¸ç±»å‹è€ŒéException\";",
        "fi",
        "",
        "# æ£€æŸ¥ç¡¬ç¼–ç å­—ç¬¦ä¸²",
        "echo \"æ£€æŸ¥ç¡¬ç¼–ç å­—ç¬¦ä¸²...\"",
        "HARDCODED_STRINGS=$(grep -n '\"[^\"]*[Cc]onnection\\|[Uu]sername\\|[Pp]assword' \"$1\" 2>/dev/null || echo \"\")",
        "if [ ! -z \"$HARDCODED_STRINGS\" ]; then",
        "  echo \"âš ï¸ å‘ç°å¯èƒ½çš„ç¡¬ç¼–ç é…ç½®ï¼Œå»ºè®®ä½¿ç”¨é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ï¼š$HARDCODED_STRINGS\"",
        "fi",
        "",
        "# æ£€æŸ¥æ³¨é‡Šè´¨é‡",
        "echo \"æ£€æŸ¥æ³¨é‡Šè´¨é‡...\"",
        "CLASS_COMMENT=$(grep -A 5 \"class.*{$\" \"$1\" 2>/dev/null | grep -v \"^\\s*$\" | grep -v \"^\\s*//\" | grep -v \"^\\s*\\*\" | head -1)",
        "if [ -z \"$CLASS_COMMENT\" ]; then",
        "  echo \"âš ï¸ å»ºè®®ï¼šä¸ºç±»æ·»åŠ JavaDocæ³¨é‡Šè¯´æ˜ç±»çš„ä½œç”¨å’ŒèŒè´£\"",
        "fi",
        "",
        "echo \"âœ… ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µæ£€æŸ¥å®Œæˆ\""
      ]
    }

    stage4: {
      name: "é…ç½®æ–‡ä»¶å®æ—¶æ£€æŸ¥"
      commands: [
        "echo \"âš™ï¸ Stage 4: é…ç½®æ–‡ä»¶å®æ—¶æ£€æŸ¥\"",
        "",
        "if echo \"$1\" | grep -q \"\\.yml$\\|\\.yaml$\"; then",
        "  echo \"æ£€æŸ¥YAMLé…ç½®æ–‡ä»¶...\"",
        "  ",
        "  # æ£€æŸ¥YAMLè¯­æ³•",
        "  if command -v yamllint >/dev/null 2>&1; then",
        "    yamllint \"$1\" || echo \"YAMLè¯­æ³•æ£€æŸ¥å®Œæˆ\"",
        "  fi",
        "  ",
        "  # æ£€æŸ¥é…ç½®é¡¹è§„èŒƒæ€§",
        "  if grep -q \"spring.datasource\" \"$1\" 2>/dev/null; then",
        "    echo \"å‘ç°æ•°æ®åº“é…ç½®ï¼Œè¯·ç¡®ä¿ï¼š\"",
        "    echo \"1. ä½¿ç”¨Druidè¿æ¥æ± è€ŒéHikariCP\"",
        "    echo \"2. æ•æ„Ÿä¿¡æ¯ä½¿ç”¨åŠ å¯†é…ç½®\"",
        "  fi",
        "  ",
        "  if grep -q \"server.port\" \"$1\" 2>/dev/null; then",
        "    PORT=$(grep \"server.port\" \"$1\" | awk '{print $2}')",
        "    echo \"å‘ç°æœåŠ¡ç«¯å£é…ç½®: $PORT\"",
        "  fi",
        "fi",
        "",
        "if echo \"$1\" | grep -q \"pom\\.xml$\"; then",
        "  echo \"æ£€æŸ¥Mavené…ç½®æ–‡ä»¶...\"",
        "  ",
        "  # æ£€æŸ¥Spring Bootç‰ˆæœ¬",
        "  SPRING_BOOT_VERSION=$(grep -A 1 \"spring-boot-starter-parent\" \"$1\" | grep -o '<version>[^<]*' | sed 's/<version>//' 2>/dev/null || echo \"\")",
        "  if [ ! -z \"$SPRING_BOOT_VERSION\" ]; then",
        "    echo \"Spring Bootç‰ˆæœ¬: $SPRING_BOOT_VERSION\"",
        "    if ! echo \"$SPRING_BOOT_VERSION\" | grep -q \"3.5\"; then",
        "      echo \"âš ï¸ å»ºè®®ä½¿ç”¨Spring Boot 3.5.xç‰ˆæœ¬\"",
        "    fi",
        "  fi",
        "  ",
        "  # æ£€æŸ¥ä¾èµ–ç®¡ç†",
        "  if grep -q \"jakarta.persistence\" \"$1\" 2>/dev/null; then",
        "    echo \"âŒ å‘ç°JPAä¾èµ–ï¼Œåº”ä½¿ç”¨MyBatis-Plus\"",
        "  fi",
        "fi",
        "",
        "echo \"âœ… é…ç½®æ–‡ä»¶å®æ—¶æ£€æŸ¥å®Œæˆ\""
      ]
    }

    stage5: {
      name: "æ–‡æ¡£å®æ—¶æ£€æŸ¥"
      commands: [
        "echo \"ğŸ“š Stage 5: æ–‡æ¡£å®æ—¶æ£€æŸ¥\"",
        "",
        "if echo \"$1\" | grep -q \"\\.md$\"; then",
        "  echo \"æ£€æŸ¥Markdownæ–‡æ¡£...\"",
        "  ",
        "  # æ£€æŸ¥æŠ€æœ¯æ ˆç‰ˆæœ¬ä¸€è‡´æ€§",
        "  if grep -q \"Spring Boot\" \"$1\" 2>/dev/null; then",
        "    SPRING_VERSIONS=$(grep \"Spring Boot\" \"$1\" | grep -o '[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+' || echo \"\")",
        "    if [ ! -z \"$SPRING_VERSIONS\" ]; then",
        "      echo \"å‘ç°Spring Bootç‰ˆæœ¬ä¿¡æ¯: $SPRING_VERSIONS\"",
        "      if ! echo \"$SPRING_VERSIONS\" | grep -q \"3.5\"; then",
        "        echo \"âš ï¸ å»ºè®®æ›´æ–°ä¸ºSpring Boot 3.5.8ç‰ˆæœ¬\"",
        "      fi",
        "    fi",
        "  fi",
        "  ",
        "  # æ£€æŸ¥ä»£ç ç¤ºä¾‹è§„èŒƒ",
        "  if grep -q \"@Autowired\" \"$1\" 2>/dev/null; then",
        "    echo \"âŒ æ–‡æ¡£ä¸­åŒ…å«@Autowiredç¤ºä¾‹ï¼Œåº”æ›´æ–°ä¸º@Resource\"",
        "  fi",
        "  ",
        "  if grep -q \"@Repository\" \"$1\" 2>/dev/null; then",
        "    echo \"âŒ æ–‡æ¡£ä¸­åŒ…å«@Repositoryç¤ºä¾‹ï¼Œåº”æ›´æ–°ä¸º@Mapper\"",
        "  fi",
        "  ",
        "  if grep -q \"javax.persistence.Entity\" \"$1\" 2>/dev/null; then",
        "    echo \"âŒ æ–‡æ¡£ä¸­åŒ…å«JPAç¤ºä¾‹ï¼Œåº”æ›´æ–°ä¸ºMyBatis-Plusæ³¨è§£\"",
        "  fi",
        "  ",
        "  # æ£€æŸ¥æ–‡æ¡£ç»“æ„",
        "  if ! grep -q \"^# \" \"$1\" 2>/dev/null; then",
        "      echo \"âš ï¸ å»ºè®®ä¸ºæ–‡æ¡£æ·»åŠ æ ‡é¢˜\"",
        "  fi",
        "fi",
        "",
        "echo \"âœ… æ–‡æ¡£å®æ—¶æ£€æŸ¥å®Œæˆ\""
      ]
    }
  }

  # æˆåŠŸæ¶ˆæ¯
  success {
    message: "âœ… IDEå®æ—¶æ£€æŸ¥å®Œæˆï¼ä»£ç ç¬¦åˆIOE-DREAMä¼ä¸šçº§æ ‡å‡† ğŸ’»"
    details: [
      "- Javaä»£ç è§„èŒƒ: æ³¨è§£ä½¿ç”¨ã€åŒ…å¯¼å…¥ã€æ—¥å¿—æ³¨è§£æ£€æŸ¥é€šè¿‡",
      "- æ¶æ„æ¨¡å¼: å››å±‚æ¶æ„ã€åˆ†å±‚èŒè´£æ£€æŸ¥é€šè¿‡",
      "- ä»£ç è´¨é‡: æ–¹æ³•å¤æ‚åº¦ã€å¼‚å¸¸å¤„ç†ã€æ³¨é‡Šè´¨é‡æ£€æŸ¥é€šè¿‡",
      "- é…ç½®æ–‡ä»¶: YAMLè¯­æ³•ã€Mavené…ç½®ã€ä¾èµ–è§„èŒƒæ£€æŸ¥é€šè¿‡",
      "- æ–‡æ¡£è§„èŒƒ: æŠ€æœ¯æ ˆç‰ˆæœ¬ã€ä»£ç ç¤ºä¾‹ã€æ–‡æ¡£ç»“æ„æ£€æŸ¥é€šè¿‡"
    ]
  }

  # å¤±è´¥æ¶ˆæ¯å’Œå»ºè®®
  failure {
    message: "âŒ IDEå®æ—¶æ£€æŸ¥å‘ç°é—®é¢˜ï¼è¯·æŒ‰ç…§å»ºè®®ä¿®æ”¹ä»£ç "
    suggestions: [
      "1. ä½¿ç”¨@Resourceæ›¿ä»£@Autowired",
      "2. ä½¿ç”¨@Mapperæ›¿ä»£@Repository",
      "3. ç§»é™¤JPAå¯¼å…¥ï¼Œä½¿ç”¨MyBatis-Plusæ³¨è§£",
      "4. éµå¾ªå››å±‚æ¶æ„æ¨¡å¼ï¼Œé¿å…è·¨å±‚è®¿é—®",
      "5. æ‹†åˆ†é•¿æ–¹æ³•ï¼Œæé«˜ä»£ç å¯è¯»æ€§",
      "6. ä½¿ç”¨æ—¥å¿—æ¡†æ¶æ›¿ä»£printStackTrace",
      "7. ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯",
      "8. æ›´æ–°æ–‡æ¡£ä¸­çš„æŠ€æœ¯æ ˆç‰ˆæœ¬å’Œä»£ç ç¤ºä¾‹",
      "9. ä½¿ç”¨/call-skills tech-stack-unification-guardianè¿›è¡ŒæŠ€æœ¯æ ˆç»Ÿä¸€"
    ]
    blocking: false
  }

  # IDEé›†æˆé…ç½®
  ide_integration {
    supported_ides: ["IntelliJ IDEA", "Eclipse", "VS Code", "WebStorm"]

    intellij_idea: {
      plugin_suggestions: [
        "Lombok Plugin",
        "MyBatis Log Plugin",
        "SonarLint",
        "CheckStyle-IDEA",
        "Alibaba Java Coding Guidelines"
      ]

      live_templates: [
        "log: è‡ªåŠ¨ç”Ÿæˆ@Slf4jæ—¥å¿—ä»£ç ",
        "res: ç”Ÿæˆ@Resourceæ³¨å…¥ä»£ç ",
        "ctrl: ç”ŸæˆControlleråŸºç¡€ç»“æ„",
        "serv: ç”ŸæˆServiceåŸºç¡€ç»“æ„",
        "mgr: ç”ŸæˆManageråŸºç¡€ç»“æ„"
      ]
    }

    vscode: {
      extension_suggestions: [
        "Extension Pack for Java",
        "Lombok Annotations Support for VS Code",
        "SonarLint",
        "Checkstyle for Java",
        "YAML Support"
      ]

      settings: {
        "java.compile.nullAnalysis.mode": "automatic",
        "java.format.settings.url": ".vscode/java-format.xml",
        "java.checkstyle.configuration": ".vscode/checkstyle.xml"
      }
    }
  }

  # è¾“å‡ºé…ç½®
  output {
    verbose: true
    color: true
    log_file: ".kiro/logs/ide-real-time-check-$(date +%Y%m%d-%H%M%S).log"
    real_time: true
    notifications: true
  }
}