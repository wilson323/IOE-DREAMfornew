# IOE-DREAMç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆå®ç°æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. æ•´ä½“æ¶æ„è®¾è®¡](#2-æ•´ä½“æ¶æ„è®¾è®¡)
- [3. æ ¸å¿ƒæ¨¡å—åˆ†æ](#3-æ ¸å¿ƒæ¨¡å—åˆ†æ)
- [4. æ•°æ®å¯¹æ¥æµç¨‹](#4-æ•°æ®å¯¹æ¥æµç¨‹)
- [5. IOE-DREAMæŠ€æœ¯æ ˆé€‚é…](#5-ioe-dreamæŠ€æœ¯æ ˆé€‚é…)
- [6. å…³é”®æŠ€æœ¯å®ç°](#6-å…³é”®æŠ€æœ¯å®ç°)
- [7. å…·ä½“é›†æˆæ–¹æ¡ˆ](#7-å…·ä½“é›†æˆæ–¹æ¡ˆ)
- [8. éƒ¨ç½²å®æ–½æŒ‡å—](#8-éƒ¨ç½²å®æ–½æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é›†æˆæ–¹æ¡ˆå®šä½
åŸºäºLinkUpä¼ä¸šçº§æ•°æ®åŒæ­¥å·¥å…·çš„è®¾è®¡ç†å¿µï¼Œä¸ºIOE-DREAMæ™ºèƒ½ç®¡ç†ç³»ç»Ÿæ„å»º**ä¼ä¸šçº§å¼€ç®±å³ç”¨çš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆå¹³å°**ï¼Œæä¾›ä»æ•°æ®æºç®¡ç†ã€ä»»åŠ¡è°ƒåº¦åˆ°ç›‘æ§å‘Šè­¦çš„å…¨é“¾è·¯é›†æˆèƒ½åŠ›ã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§
- âœ… **å¾®æœåŠ¡æ¶æ„**ï¼šåŸºäºSpring Boot 3.5 + Spring Cloud 2023çš„å¾®æœåŠ¡æ¶æ„
- âœ… **å››å±‚æ¶æ„è§„èŒƒ**ï¼šä¸¥æ ¼éµå¾ªControllerâ†’Serviceâ†’Managerâ†’DAOæ¶æ„æ¨¡å¼
- âœ… **æ’ä»¶åŒ–æ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰é›†æˆæ’ä»¶ï¼Œæ— ç¼å¯¹æ¥å„ç±»ç¬¬ä¸‰æ–¹ç³»ç»Ÿ
- âœ… **å¤šçº§ç¼“å­˜æ¶æ„**ï¼šL1æœ¬åœ° + L2Redis + L3ç½‘å…³ä¸‰çº§ç¼“å­˜
- âœ… **SAGAåˆ†å¸ƒå¼äº‹åŠ¡**ï¼šç¡®ä¿è·¨ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§
- âœ… **æ™ºèƒ½è°ƒåº¦ç®¡ç†**ï¼šå†…ç½®é«˜å¯ç”¨è°ƒåº¦å¼•æ“ï¼ˆQuartz + Nacosï¼‰
- âœ… **å®æ—¶ç›‘æ§å‘Šè­¦**ï¼šåŸºäºPrometheus + Grafanaçš„ç›‘æ§ä½“ç³»
- âœ… **Jakarta EEåˆè§„**ï¼š100%ç¬¦åˆJakarta EE 3.0+åŒ…åè§„èŒƒ

### 1.3 æ”¯æŒçš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼ˆ15+ç§ï¼‰

| ç³»ç»Ÿç±»åˆ« | å…·ä½“ç³»ç»Ÿ | é›†æˆæ–¹å¼ | çŠ¶æ€ |
|---------|----------|----------|------|
| **ERPç³»ç»Ÿ** | ç”¨å‹U8ã€é‡‘è¶K3ã€SAP ERP | API/DB | âœ… |
| **HRç³»ç»Ÿ** | åŒ—æ£®ã€Mokaã€æ‹‰å‹¾æ‹›è˜ | API/DB | âœ… |
| **OAç³»ç»Ÿ** | æ³›å¾®OAã€è‡´è¿œOAã€é’‰é’‰ | API/Webhook | âœ… |
| **è´¢åŠ¡ç³»ç»Ÿ** | ç”¨å‹NCã€é‡‘è¶EASã€æµªæ½®è´¢åŠ¡ | API/DB | âœ… |
| **æ”¯ä»˜ç³»ç»Ÿ** | å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€é“¶è”æ”¯ä»˜ | API | âœ… |
| **æ¶ˆæ¯ç³»ç»Ÿ** | ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€é£ä¹¦ | API/Webhook | âœ… |
| **æ•°æ®åº“ç³»ç»Ÿ** | MySQLã€PostgreSQLã€Oracle | DB | âœ… |
| **äº‘æœåŠ¡** | é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ | API | âœ… |

---

## 2. æ•´ä½“æ¶æ„è®¾è®¡
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 2.1 ç³»ç»Ÿæ¶æ„å›¾
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ¥å…¥å±‚                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ ERPç³»ç»Ÿ  â”‚ HRç³»ç»Ÿ   â”‚ OAç³»ç»Ÿ   â”‚ æ”¯ä»˜ç³»ç»Ÿ â”‚ å…¶ä»–ç³»ç»Ÿ â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTPS/WebSocket/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APIç½‘å…³å±‚ï¼ˆGatewayï¼‰                       â”‚
â”‚              ioedream-gateway-service                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è·¯ç”±ç®¡ç†      â”‚ é™æµç†”æ–­     â”‚ å®‰å…¨è®¤è¯                  â”‚ â”‚
â”‚  â”‚              â”‚             â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é›†æˆç®¡ç†å¾®æœåŠ¡å±‚                               â”‚
â”‚               ioedream-integration-service                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DataSource  â”‚ Integration â”‚ Task Scheduler           â”‚ â”‚
â”‚  â”‚ Controller   â”‚ Controller   â”‚ Controller               â”‚ â”‚
â”‚  â”‚              â”‚ Controller   â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆService Layerï¼‰                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DataSource  â”‚ Integration â”‚ Task Execution           â”‚ â”‚
â”‚  â”‚ Service      â”‚ Service      â”‚ Manager                  â”‚ â”‚
â”‚  â”‚              â”‚ Service      â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ•°æ®æºç®¡ç†å±‚ï¼ˆDataSource Layerï¼‰               â”‚
â”‚              integration-datasource-plugins                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ERP      â”‚  HR       â”‚  OA        â”‚  Payment   â”‚...  â”‚   â”‚
â”‚  â”‚  Processorâ”‚ Processor â”‚  Processor â”‚  Processor â”‚     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              (SPIæœºåˆ¶åŠ¨æ€åŠ è½½å„ç¬¬ä¸‰æ–¹ç³»ç»Ÿå¤„ç†å™¨)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               è¿æ¥å™¨æ’ä»¶å±‚ï¼ˆConnector Layerï¼‰                  â”‚
â”‚              integration-connector-plugins                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Source Connector  â”‚  Sink Connector  â”‚  Transform â”‚   â”‚
â”‚  â”‚  â”œâ”€ ERP Source      â”‚  â”œâ”€ ERP Sink       â”‚  â”œâ”€ DataMap â”‚   â”‚
â”‚  â”‚  â”œâ”€ HR Source       â”‚  â”œâ”€ HR Sink        â”‚  â”œâ”€ Filter  â”‚   â”‚
â”‚  â”‚  â”œâ”€ ...              â”‚  â”œâ”€ ...             â”‚  â””â”€ ...    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           (åŸºäºIOE-DREAMå››å±‚æ¶æ„å®ç°çš„è¿æ¥å™¨)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ‰§è¡Œå¼•æ“å±‚ï¼ˆExecution Engineï¼‰                â”‚
â”‚                   IntegrationEngine                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ä»»åŠ¡è°ƒåº¦   â”‚  æ—¥å¿—ç®¡ç†   â”‚  çŠ¶æ€ç›‘æ§   â”‚  æŒ‡æ ‡æ”¶é›†    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         (åŸºäºSpring Boot Async + Quartz + Nacos)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŒä¹…åŒ–å±‚ï¼ˆPersistenceï¼‰                     â”‚
â”‚                 MyBatis Plus + MySQL + Redis               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MySQL/MariaDB Database                              â”‚   â”‚
â”‚  â”‚  â”œâ”€ integration_data_source (æ•°æ®æºè¡¨)                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ integration_task (ä»»åŠ¡å®šä¹‰è¡¨)                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ integration_execution (æ‰§è¡Œè®°å½•è¡¨)                â”‚   â”‚
â”‚  â”‚  â”œâ”€ integration_schedule (è°ƒåº¦é…ç½®è¡¨)                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ qrtz_* (Quartzè°ƒåº¦è¡¨)                            â”‚   â”‚
â”‚  â”‚  â””â”€ Redis Cache (ä¸‰çº§ç¼“å­˜æ”¯æŒ)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å¾®æœåŠ¡æ¨¡å—åˆ’åˆ†

| å¾®æœåŠ¡åç§° | åŠŸèƒ½æè¿° | æŠ€æœ¯æ ˆ | ç«¯å£ |
|------------|---------|--------|------|
| **ioedream-integration-service** | ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆæ ¸å¿ƒæœåŠ¡ | Spring Boot 3.5.4 + Nacos | 8098 |
| **ioedream-gateway-service** | APIç½‘å…³ï¼ˆå·²å­˜åœ¨ï¼‰ | Spring Cloud Gateway | 8080 |
| **ioedream-monitor-service** | ç›‘æ§å‘Šè­¦æœåŠ¡ï¼ˆå·²å­˜åœ¨ï¼‰ | Spring Boot + Prometheus | 8097 |
| **ioedream-notification-service** | æ¶ˆæ¯é€šçŸ¥æœåŠ¡ï¼ˆå·²å­˜åœ¨ï¼‰ | Spring Boot + RabbitMQ | 8096 |

---

## 3. æ ¸å¿ƒæ¨¡å—åˆ†æ

### 3.1 ioedream-integration-serviceï¼ˆé›†æˆæœåŠ¡ï¼‰

#### 3.1.1 ä¸»è¦Controller

**IntegrationDataSourceController - æ•°æ®æºç®¡ç†**
```java
@RestController
@RequestMapping("/api/v1/integration/data-source")
@Tag(name = "ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆ-æ•°æ®æºç®¡ç†", description = "ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æºç®¡ç†æ¥å£")
public class IntegrationDataSourceController {

    @Resource
    private IntegrationDataSourceService dataSourceService;

    @PostMapping("/create")
    @Operation(summary = "åˆ›å»ºç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æº")
    public ResponseDTO<IntegrationDataSourceVO> create(@Valid @RequestBody IntegrationDataSourceDTO dto) {
        IntegrationDataSourceVO result = dataSourceService.create(dto);
        return ResponseDTO.ok(result);
    }

    @PutMapping("/{id}")
    @Operation(summary = "æ›´æ–°ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æº")
    public ResponseDTO<IntegrationDataSourceVO> update(@PathVariable String id, @Valid @RequestBody IntegrationDataSourceDTO dto) {
        IntegrationDataSourceVO result = dataSourceService.update(id, dto);
        return ResponseDTO.ok(result);
    }

    @GetMapping("/{id}/connect-test")
    @Operation(summary = "æµ‹è¯•ç¬¬ä¸‰æ–¹ç³»ç»Ÿè¿æ¥")
    public ResponseDTO<Boolean> connectionTest(@PathVariable String id) {
        Boolean result = dataSourceService.connectionTest(id);
        return ResponseDTO.ok(result);
    }

    @DeleteMapping("/{id}")
    @Operation(summary = "åˆ é™¤ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æº")
    public ResponseDTO<Boolean> delete(@PathVariable String id) {
        Boolean result = dataSourceService.delete(id);
        return ResponseDTO.ok(result);
    }
}
```

**IntegrationTaskController - é›†æˆä»»åŠ¡ç®¡ç†**
```java
@RestController
@RequestMapping("/api/v1/integration/task")
@Tag(name = "ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆ-ä»»åŠ¡ç®¡ç†", description = "ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆä»»åŠ¡ç®¡ç†æ¥å£")
public class IntegrationTaskController {

    @Resource
    private IntegrationTaskService taskService;

    @PostMapping("/create")
    @Operation(summary = "åˆ›å»ºé›†æˆä»»åŠ¡")
    public ResponseDTO<IntegrationTaskVO> create(@Valid @RequestBody IntegrationTaskDTO dto) {
        IntegrationTaskVO result = taskService.create(dto);
        return ResponseDTO.ok(result);
    }

    @PostMapping("/{taskId}/start")
    @Operation(summary = "å¯åŠ¨é›†æˆä»»åŠ¡")
    public ResponseDTO<Void> start(@PathVariable String taskId) {
        taskService.start(taskId);
        return ResponseDTO.ok();
    }

    @PostMapping("/{executionId}/cancel")
    @Operation(summary = "å–æ¶ˆé›†æˆä»»åŠ¡")
    public ResponseDTO<Boolean> cancel(@PathVariable String executionId) {
        Boolean result = taskService.cancel(executionId);
        return ResponseDTO.ok(result);
    }
}
```

#### 3.1.2 å¯åŠ¨ç±»é…ç½®

```java
@EnableAsync              // æ”¯æŒå¼‚æ­¥è°ƒç”¨
@EnableScheduling         // æ”¯æŒå®šæ—¶ä»»åŠ¡
@EnableTransactionManagement  // äº‹åŠ¡ç®¡ç†
@EnableNacosDiscovery     // NacosæœåŠ¡å‘ç°
@EnableNacosConfig        // Nacosé…ç½®ä¸­å¿ƒ
@SpringBootApplication
public class IntegrationApplication {
    public static void main(String[] args) {
        SpringApplication.run(IntegrationApplication.class, args);
    }

    @EventListener
    public void run(ApplicationReadyEvent readyEvent) {
        // åº”ç”¨å¯åŠ¨ååˆå§‹åŒ–æ•°æ®æºå¤„ç†å™¨
        IntegrationDataSourceProcessorProvider.initialize();
    }
}
```

### 3.2 ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆService Layerï¼‰

#### 3.2.1 IntegrationDataSourceService - æ•°æ®æºæœåŠ¡

**æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼š**
```java
@Service
@Transactional(rollbackFor = Exception.class)
public class IntegrationDataSourceServiceImpl implements IntegrationDataSourceService {

    @Resource
    private IntegrationDataSourceDao dataSourceDao;

    @Resource
    private IntegrationDataSourceProcessorProvider processorProvider;

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    @Override
    public IntegrationDataSourceVO create(IntegrationDataSourceDTO dto) {
        // 1. æ„å»ºæ•°æ®æºå‚æ•°
        IntegrationDataSourceParamDTO dataSourceParam = buildDataSourceParam(dto);

        // 2. å‚æ•°æ ¡éªŒ
        validateDataSourceParam(dataSourceParam);

        // 3. æ„å»ºè¿æ¥å‚æ•°
        IntegrationConnectionParam connectionParam = buildConnectionParams(dataSourceParam);

        // 4. ä¿å­˜åˆ°æ•°æ®åº“
        IntegrationDataSourceEntity dataSource = IntegrationMapper.INSTANCE.dtoToEntity(dto);
        dataSource.setConnectionParams(JSONUtils.toJsonString(connectionParam));
        dataSource.setConnStatus(ConnStatus.CONNECTED_NONE);
        dataSourceDao.insert(dataSource);

        // 5. ç¼“å­˜åˆ°Redis
        cacheDataSource(dataSource);

        return IntegrationMapper.INSTANCE.entityToVO(dataSource);
    }

    @Override
    public Boolean connectionTest(String id) {
        IntegrationDataSourceEntity dataSource = dataSourceDao.selectById(id);

        // æ›´æ–°çŠ¶æ€ä¸ºè¿æ¥ä¸­
        updateConnectionStatus(dataSource, ConnStatus.CONNECTING);

        try {
            // é€šè¿‡DataSourceProcessoræ‰§è¡Œè¿æ¥æµ‹è¯•
            Boolean isConnected = checkConnection(
                dataSource.getSystemType(),
                buildConnectionParams(dataSource.getSystemType(), dataSource.getConnectionParams())
            );

            if (isConnected) {
                updateConnectionStatus(dataSource, ConnStatus.CONNECTED_SUCCESS);
                return true;
            } else {
                updateConnectionStatus(dataSource, ConnStatus.CONNECTED_FAILED);
                return false;
            }
        } catch (Exception e) {
            updateConnectionStatus(dataSource, ConnStatus.CONNECTED_FAILED);
            log.error("æ•°æ®æºè¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    private Boolean checkConnection(SystemType systemType, IntegrationConnectionParam connectionParam) {
        // é€šè¿‡SPIè·å–å¯¹åº”çš„DataSourceProcessor
        IntegrationDataSourceProcessor processor = processorProvider.getProcessor(systemType);
        return processor.checkSystemConnectivity(connectionParam);
    }
}
```

#### 3.2.2 IntegrationTaskManager - ä»»åŠ¡æ‰§è¡Œç®¡ç†å™¨

**æ ¸å¿ƒèŒè´£ï¼š**
- é›†æˆä»»åŠ¡æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ä»»åŠ¡çŠ¶æ€è·Ÿè¸ªå’Œç›‘æ§
- åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒ
- å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶

**å…³é”®æ–¹æ³•å®ç°ï¼š**

```java
@Component
public class IntegrationTaskManager {

    @Resource
    private IntegrationTaskDao taskDao;

    @Resource
    private IntegrationExecutionDao executionDao;

    @Resource
    private IntegrationEngine integrationEngine;

    @Resource
    private SagaManager sagaManager;

    @Transactional(rollbackFor = Exception.class)
    public void execute(String taskId, ExecutionMode executionMode) {
        // 1. è·å–ä»»åŠ¡å®šä¹‰
        IntegrationTaskEntity task = taskDao.selectById(taskId);

        // 2. åˆ›å»ºæ‰§è¡Œè®°å½•
        IntegrationExecutionEntity execution = createTaskExecution(task);

        try {
            // 3. åˆ›å»ºSAGAåˆ†å¸ƒå¼äº‹åŠ¡
            SagaTransaction saga = sagaManager.createSaga("integration_" + taskId, taskId)
                    .step("validateSource", this::validateSourceSystem, this::rollbackSourceValidation)
                    .step("extractData", this::extractDataFromSource, this::rollbackDataExtraction)
                    .step("transformData", this::transformData, this::rollbackDataTransformation)
                    .step("loadData", this::loadDataToTarget, this::rollbackDataLoading)
                    .step("notifyComplete", this::notifyIntegrationComplete, this::rollbackNotification)
                    .build();

            // 4. å¼‚æ­¥å¯åŠ¨ä»»åŠ¡
            String engineTaskId = integrationEngine.startAsync(task.getTaskParams(), execution.getId(),
                    execution, this::statusCallbackHandler);

            // 5. è®°å½•æ˜ å°„å…³ç³»
            taskIdMapping.put(execution.getId(), engineTaskId);

            // 6. æ›´æ–°æ‰§è¡ŒçŠ¶æ€
            execution.setStatus(TaskExecutionStatus.RUNNING);
            execution.setEngineTaskId(engineTaskId);
            execution.setExecutionMode(executionMode);
            executionDao.updateById(execution);

            log.info("é›†æˆä»»åŠ¡æ‰§è¡Œå¼€å§‹ - executionId: {}, engineTaskId: {}",
                    execution.getId(), engineTaskId);

        } catch (Exception e) {
            execution.setStatus(TaskExecutionStatus.FAILED);
            execution.setEndTime(LocalDateTime.now());
            executionDao.updateById(execution);
            throw new IntegrationException("é›†æˆä»»åŠ¡æ‰§è¡Œå¤±è´¥: " + e.getMessage(), e);
        }
    }

    // æ•°æ®æå–æ­¥éª¤
    private SagaStep extractDataFromSource(String taskId) {
        try {
            IntegrationTaskEntity task = taskDao.selectById(taskId);
            IntegrationDataSourceEntity sourceDataSource = getDataSource(task.getSourceDataSourceId());

            IntegrationDataSourceProcessor processor = processorProvider.getProcessor(sourceDataSource.getSystemType());
            List<Map<String, Object>> extractedData = processor.extractData(sourceDataSource, task.getExtractConfig());

            // å°†æå–çš„æ•°æ®ç¼“å­˜åˆ°Redis
            String cacheKey = "integration:data:" + taskId;
            redisTemplate.opsForValue().set(cacheKey, extractedData, Duration.ofHours(2));

            return SagaStep.success("æˆåŠŸæå– " + extractedData.size() + " æ¡æ•°æ®");
        } catch (Exception e) {
            return SagaStep.failure("æ•°æ®æå–å¤±è´¥: " + e.getMessage());
        }
    }

    // æ•°æ®è½¬æ¢æ­¥éª¤
    private SagaStep transformData(String taskId) {
        try {
            String cacheKey = "integration:data:" + taskId;
            List<Map<String, Object>> rawData = (List<Map<String, Object>>) redisTemplate.opsForValue().get(cacheKey);

            IntegrationTaskEntity task = taskDao.selectById(taskId);
            List<Map<String, Object>> transformedData = transformData(rawData, task.getTransformConfig());

            // æ›´æ–°ç¼“å­˜ä¸­çš„è½¬æ¢åæ•°æ®
            redisTemplate.opsForValue().set(cacheKey, transformedData, Duration.ofHours(2));

            return SagaStep.success("æˆåŠŸè½¬æ¢ " + transformedData.size() + " æ¡æ•°æ®");
        } catch (Exception e) {
            return SagaStep.failure("æ•°æ®è½¬æ¢å¤±è´¥: " + e.getMessage());
        }
    }

    // æ•°æ®åŠ è½½æ­¥éª¤
    private SagaStep loadDataToTarget(String taskId) {
        try {
            IntegrationTaskEntity task = taskDao.selectById(taskId);
            IntegrationDataSourceEntity targetDataSource = getDataSource(task.getTargetDataSourceId());

            String cacheKey = "integration:data:" + taskId;
            List<Map<String, Object>> data = (List<Map<String, Object>>) redisTemplate.opsForValue().get(cacheKey);

            IntegrationDataSourceProcessor processor = processorProvider.getProcessor(targetDataSource.getSystemType());
            int loadedCount = processor.loadData(targetDataSource, data, task.getLoadConfig());

            return SagaStep.success("æˆåŠŸåŠ è½½ " + loadedCount + " æ¡æ•°æ®");
        } catch (Exception e) {
            return SagaStep.failure("æ•°æ®åŠ è½½å¤±è´¥: " + e.getMessage());
        }
    }
}
```

### 3.3 integration-datasource-pluginsï¼ˆæ•°æ®æºæ’ä»¶å±‚ï¼‰

#### 3.3.1 SPIæ’ä»¶æœºåˆ¶

åŸºäºJava SPIå’ŒSpring Bootçš„è‡ªåŠ¨é…ç½®æœºåˆ¶å®ç°æ’ä»¶åŒ–æ¶æ„ï¼š

```java
@AutoService(IntegrationDataSourceProcessor.class)
@Component
public class ErpU8DataSourceProcessor extends AbstractIntegrationDataSourceProcessor {

    @Override
    public SystemType getSystemType() {
        return SystemType.ERP_U8;
    }

    @Override
    public Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam) {
        try {
            // è°ƒç”¨ç”¨å‹U8 APIè¿›è¡Œè¿æ¥æµ‹è¯•
            U8ApiClient client = createU8ApiClient(connectionParam);
            return client.testConnection();
        } catch (Exception e) {
            log.error("ç”¨å‹U8è¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    @Override
    public List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig extractConfig) {
        U8ApiClient client = createU8ApiClient(buildConnectionParams(dataSource));

        // æ ¹æ®æå–é…ç½®æŸ¥è¯¢æ•°æ®
        if (extractConfig.getDataType() == ExtractDataType.INVENTORY) {
            return client.getInventoryData(extractConfig.getParams());
        } else if (extractConfig.getDataType() == ExtractDataType.ORDERS) {
            return client.getOrderData(extractConfig.getParams());
        } else if (extractConfig.getDataType() == ExtractDataType.CUSTOMERS) {
            return client.getCustomerData(extractConfig.getParams());
        }

        return Collections.emptyList();
    }

    @Override
    public Integer loadData(IntegrationDataSourceEntity dataSource, List<Map<String, Object>> data, LoadConfig loadConfig) {
        // å¯¹äºERPç³»ç»Ÿï¼Œé€šå¸¸æ˜¯åŒå‘åŒæ­¥
        U8ApiClient client = createU8ApiClient(buildConnectionParams(dataSource));

        int successCount = 0;
        for (Map<String, Object> record : data) {
            try {
                if (loadConfig.getDataType() == LoadDataType.EMPLOYEES) {
                    client.syncEmployee(record);
                } else if (loadConfig.getDataType() == LoadDataType.DEPARTMENTS) {
                    client.syncDepartment(record);
                }
                successCount++;
            } catch (Exception e) {
                log.error("æ•°æ®åŒæ­¥å¤±è´¥", e);
            }
        }

        return successCount;
    }
}
```

#### 3.3.2 IntegrationDataSourceProcessoræ¥å£

```java
public interface IntegrationDataSourceProcessor {

    // 1. å‚æ•°å¤„ç†
    IntegrationDataSourceParamDTO castDataSourceParamDTO(String paramJson);
    void validateDataSourceParam(IntegrationDataSourceParamDTO dataSourceParam);
    IntegrationConnectionParam createConnectionParams(IntegrationDataSourceParamDTO dataSourceParam);

    // 2. è¿æ¥ç®¡ç†
    Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam);

    // 3. æ•°æ®æ“ä½œ
    List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig extractConfig);
    Integer loadData(IntegrationDataSourceEntity dataSource, List<Map<String, Object>> data, LoadConfig loadConfig);

    // 4. å…ƒæ•°æ®æ“ä½œ
    List<String> listAvailableDataTypes(IntegrationConnectionParam connectionParam);
    List<DataFieldInfo> listDataFields(IntegrationConnectionParam connectionParam, String dataType);

    // 5. é…ç½®ç”Ÿæˆ
    JSONObject buildExtractConfig(IntegrationConnectionParam connectionParam, String dataType);
    JSONObject buildLoadConfig(IntegrationConnectionParam connectionParam, String dataType);
}
```

### 3.4 IntegrationEngineï¼ˆæ‰§è¡Œå¼•æ“ï¼‰

#### 3.4.1 å¼•æ“æ¶æ„

```java
@Slf4j
@Component
public class IntegrationEngine {

    // å•ä¾‹æ¨¡å¼
    private static volatile IntegrationEngine instance;

    // ä»»åŠ¡å­˜å‚¨
    private final Map<String, TaskInfo> taskMap = new ConcurrentHashMap<>();

    // ä»»åŠ¡å†å²
    private final IntegrationTaskHistory taskHistory = IntegrationTaskHistory.getInstance();

    // çŠ¶æ€å›è°ƒ
    private final Map<String, IntegrationTaskStatusCallback> taskCallbacks = new ConcurrentHashMap<>();

    // çº¿ç¨‹æ± 
    private final ThreadPoolTaskExecutor taskExecutor;

    public static IntegrationEngine getInstance() {
        if (instance == null) {
            synchronized (IntegrationEngine.class) {
                if (instance == null) {
                    instance = new IntegrationEngine();
                }
            }
        }
        return instance;
    }

    public IntegrationEngine() {
        this.taskExecutor = createTaskExecutor();
    }

    private ThreadPoolTaskExecutor createTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(1000);
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("integration-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
}
```

#### 3.4.2 å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ

```java
public String startAsync(IntegrationTaskParam taskParam, String taskId,
                        IntegrationExecutionEntity execution,
                        IntegrationTaskStatusCallback callback) {

    // 1. åˆ›å»ºä»»åŠ¡ä¿¡æ¯
    TaskInfo taskInfo = new TaskInfo(taskId);
    taskInfo.setStartTime(System.currentTimeMillis());
    taskInfo.setStatus(TaskExecutionStatus.RUNNING);
    taskInfo.setTaskParam(taskParam);

    // 2. æ³¨å†Œåˆ°ä»»åŠ¡å†å²
    taskHistory.registerTask(taskId, TaskExecutionStatus.RUNNING);

    // 3. ä¿å­˜å›è°ƒ
    if (callback != null) {
        taskCallbacks.put(taskId, callback);
    }

    // 4. å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
    CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {
        try {
            // æ‰§è¡Œæ ¸å¿ƒé€»è¾‘
            executeIntegrationTask(taskParam, taskInfo, execution);

            // ä»»åŠ¡æˆåŠŸ
            taskInfo.setStatus(TaskExecutionStatus.COMPLETED);
            if (callback != null) {
                callback.onTaskCompleted(taskId);
            }
            taskHistory.updateTaskStatus(taskId, TaskExecutionStatus.COMPLETED);

        } catch (Exception e) {
            // ä»»åŠ¡å¤±è´¥
            taskInfo.setStatus(TaskExecutionStatus.FAILED);
            taskInfo.setError(e);
            if (callback != null) {
                callback.onTaskFailed(taskId, e);
            }
            taskHistory.updateTaskStatus(taskId, TaskExecutionStatus.FAILED);
            log.error("é›†æˆä»»åŠ¡ {} æ‰§è¡Œå¤±è´¥: {}", taskId, e.getMessage(), e);

        } finally {
            taskInfo.setEndTime(System.currentTimeMillis());
            taskCallbacks.remove(taskId);
        }
    }, taskExecutor);

    // 5. ä¿å­˜Future
    taskInfo.setFuture(future);
    taskMap.put(taskId, taskInfo);

    log.info("é›†æˆä»»åŠ¡ {} å¯åŠ¨æˆåŠŸ", taskId);
    return taskId;
}

private void executeIntegrationTask(IntegrationTaskParam taskParam, TaskInfo taskInfo, IntegrationExecutionEntity execution) {
    try {
        // 1. è§£æä»»åŠ¡å‚æ•°
        IntegrationTaskConfig config = IntegrationTaskConfig.parse(taskParam.getTaskConfigJson());

        // 2. æ‰§è¡Œæ•°æ®æå–
        List<Map<String, Object>> extractedData = extractDataFromSource(config.getSourceConfig());
        taskInfo.setExtractedCount(extractedData.size());

        // 3. æ‰§è¡Œæ•°æ®è½¬æ¢
        List<Map<String, Object>> transformedData = transformData(extractedData, config.getTransformConfig());
        taskInfo.setTransformedCount(transformedData.size());

        // 4. æ‰§è¡Œæ•°æ®åŠ è½½
        int loadedCount = loadDataToTarget(transformedData, config.getTargetConfig());
        taskInfo.setLoadedCount(loadedCount);

        // 5. å‘é€é€šçŸ¥
        sendIntegrationNotification(execution, taskInfo);

        log.info("é›†æˆä»»åŠ¡å®Œæˆ: æå– {} æ¡ï¼Œè½¬æ¢ {} æ¡ï¼ŒåŠ è½½ {} æ¡",
                extractedData.size(), transformedData.size(), loadedCount);

    } catch (Exception e) {
        log.error("é›†æˆä»»åŠ¡æ‰§è¡Œå¼‚å¸¸", e);
        throw new IntegrationException("é›†æˆä»»åŠ¡æ‰§è¡Œå¤±è´¥", e);
    }
}
```

---

## 4. æ•°æ®å¯¹æ¥æµç¨‹

### 4.1 å®Œæ•´é›†æˆæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æ“ä½œæµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ â‘  é…ç½®ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æº
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/v1/integration/data-source/create                â”‚
â”‚  {                                                           â”‚
â”‚    "systemName": "ç”¨å‹U8 ERP",                              â”‚
â”‚    "systemType": "ERP_U8",                                 â”‚
â”‚    "connectionParams": {                                    â”‚
â”‚      "apiUrl": "http://u8-server:8080/api",                â”‚
â”‚      "username": "admin",                                   â”‚
â”‚      "password": "******",                                 â”‚
â”‚      "database": "ufdata_001_2024"                         â”‚
â”‚    },                                                        â”‚
â”‚    "environment": "PROD"                                    â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ IntegrationDataSourceService.create()
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®æºåˆ›å»ºæµç¨‹ï¼š                                              â”‚
â”‚  1. buildDataSourceParam() - æ„å»ºå‚æ•°DTO                   â”‚
â”‚  2. validateDataSourceParam() - æ ¡éªŒå‚æ•°                    â”‚
â”‚  3. buildConnectionParams() - æ„å»ºè¿æ¥å‚æ•°                  â”‚
â”‚  4. save() - ä¿å­˜åˆ°integration_data_sourceè¡¨              â”‚
â”‚  5. cache() - ç¼“å­˜åˆ°Redis                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ â‘¡ æµ‹è¯•ç¬¬ä¸‰æ–¹ç³»ç»Ÿè¿æ¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/v1/integration/data-source/{id}/connect-test     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ IntegrationDataSourceService.connectionTest()
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿æ¥æµ‹è¯•æµç¨‹ï¼š                                                â”‚
â”‚  1. getById() - è·å–æ•°æ®æº                                  â”‚
â”‚  2. getDataSourceProcessor() - é€šè¿‡SPIè·å–Processor       â”‚
â”‚  3. checkSystemConnectivity() - æ‰§è¡Œè¿æ¥æµ‹è¯•              â”‚
â”‚  4. updateConnectionStatus() - æ›´æ–°è¿æ¥çŠ¶æ€                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ â‘¢ åˆ›å»ºé›†æˆä»»åŠ¡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/v1/integration/task/create                       â”‚
â”‚  {                                                           â”‚
â”‚    "taskName": "ç”¨å‹U8å‘˜å·¥æ•°æ®åŒæ­¥",                         â”‚
â”‚    "sourceDataSourceId": "erp_source_id",                   â”‚
â”‚    "targetDataSourceId": "hr_target_id",                   â”‚
â”‚    "taskType": "EMPLOYEE_SYNC",                            â”‚
â”‚    "extractConfig": {                                       â”‚
â”‚      "dataType": "EMPLOYEES",                              â”‚
â”‚      "fields": ["code", "name", "department", "position"], â”‚
â”‚      "filters": {"status": "active"}                       â”‚
â”‚    },                                                        â”‚
â”‚    "loadConfig": {                                          â”‚
â”‚      "dataType": "EMPLOYEES",                              â”‚
â”‚      "mode": "UPSERT"                                      â”‚
â”‚    }                                                         â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ IntegrationTaskService.create()
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»»åŠ¡åˆ›å»ºæµç¨‹ï¼š                                                â”‚
â”‚  1. validateTaskConfig() - éªŒè¯ä»»åŠ¡é…ç½®                    â”‚
â”‚  2. buildExtractConfig() - æ„å»ºæå–é…ç½®                    â”‚
â”‚  3. buildLoadConfig() - æ„å»ºåŠ è½½é…ç½®                      â”‚
â”‚  4. generateTaskParams() - ç”Ÿæˆå®Œæ•´ä»»åŠ¡å‚æ•°JSON           â”‚
â”‚  5. save() - ä¿å­˜åˆ°integration_taskè¡¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ â‘£ å¯åŠ¨é›†æˆä»»åŠ¡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/v1/integration/task/{taskId}/start              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ IntegrationTaskService.execute()
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IntegrationTaskManager.execute()                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. getById() - è·å–ä»»åŠ¡å®šä¹‰                             â”‚  â”‚
â”‚  â”‚ 2. createTaskExecution() - åˆ›å»ºæ‰§è¡Œè®°å½•                â”‚  â”‚
â”‚  â”‚ 3. createSagaTransaction() - åˆ›å»ºSAGAäº‹åŠ¡            â”‚  â”‚
â”‚  â”‚ 4. IntegrationEngine.startAsync() - å¼‚æ­¥å¯åŠ¨ä»»åŠ¡      â”‚  â”‚
â”‚  â”‚ 5. updateById() - æ›´æ–°æ‰§è¡ŒçŠ¶æ€ä¸ºRUNNING               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ IntegrationEngine.startAsync()
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼•æ“æ‰§è¡Œæµç¨‹ï¼š                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. åˆ›å»ºTaskInfo                                        â”‚  â”‚
â”‚  â”‚ 2. æäº¤åˆ°çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œ                                 â”‚  â”‚
â”‚  â”‚ 3. executeIntegrationTask() - æ ¸å¿ƒæ‰§è¡Œé€»è¾‘             â”‚  â”‚
â”‚  â”‚    â”œâ”€ extractDataFromSource() - ä»æºç³»ç»Ÿæå–æ•°æ®       â”‚  â”‚
â”‚  â”‚    â”œâ”€ transformData() - æ•°æ®è½¬æ¢å’Œæ¸…æ´—                  â”‚  â”‚
â”‚  â”‚    â”œâ”€ loadDataToTarget() - åŠ è½½åˆ°ç›®æ ‡ç³»ç»Ÿ              â”‚  â”‚
â”‚  â”‚    â””â”€ sendNotification() - å‘é€å®Œæˆé€šçŸ¥                â”‚  â”‚
â”‚  â”‚ 4. å›è°ƒonTaskCompleted/onTaskFailed                   â”‚  â”‚
â”‚  â”‚ 5. æ›´æ–°TaskInfoçŠ¶æ€                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SAGAåˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAGAæ­¥éª¤æ‰§è¡Œï¼š                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step1: validateSource() - éªŒè¯æºç³»ç»Ÿå¯ç”¨æ€§            â”‚  â”‚
â”‚  â”‚ Step2: extractData() - æå–æ•°æ®                        â”‚  â”‚
â”‚  â”‚ Step3: transformData() - è½¬æ¢æ•°æ®                      â”‚  â”‚
â”‚  â”‚ Step4: loadData() - åŠ è½½æ•°æ®                           â”‚  â”‚
â”‚  â”‚ Step5: notifyComplete() - é€šçŸ¥å®Œæˆ                     â”‚  â”‚
â”‚  â”‚ æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ â‘¤ ä»»åŠ¡å®Œæˆå›è°ƒ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IntegrationTaskStatusCallbackHandler.onTaskCompleted()    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. æ›´æ–°integration_executionçŠ¶æ€ä¸ºCOMPLETED          â”‚  â”‚
â”‚  â”‚ 2. è®¾ç½®end_time                                        â”‚  â”‚
â”‚  â”‚ 3. ä¿å­˜æ‰§è¡Œç»Ÿè®¡æŒ‡æ ‡                                     â”‚  â”‚
â”‚  â”‚ 4. å‘é€æˆåŠŸé€šçŸ¥                                       â”‚  â”‚
â”‚  â”‚ 5. æ›´æ–°ç›‘æ§æŒ‡æ ‡                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç¬¬ä¸‰æ–¹ç³»ç»Ÿé…ç½®JSONç¤ºä¾‹

**ç”¨å‹U8 ERPé›†æˆé…ç½®ï¼š**
```json
{
  "taskId": "task_u8_employee_sync_001",
  "taskName": "ç”¨å‹U8å‘˜å·¥æ•°æ®åŒæ­¥",
  "taskType": "EMPLOYEE_SYNC",
  "executionMode": "SCHEDULED",
  "schedule": {
    "cronExpression": "0 0 2 * * ?",
    "enabled": true
  },
  "source": {
    "systemType": "ERP_U8",
    "dataSourceId": "ds_u8_erp_001",
    "extractConfig": {
      "dataType": "EMPLOYEES",
      "apiEndpoint": "/api/v1/employees",
      "fields": [
        "cPersonCode",
        "cPersonName",
        "cDepName",
        "cPosition",
        "dHireDate",
        "cStatus"
      ],
      "filters": {
        "cStatus": "Y",
        "dHireDate": {
          "operator": ">=",
          "value": "2024-01-01"
        }
      },
      "pagination": {
        "pageSize": 1000,
        "maxPage": 100
      }
    }
  },
  "transform": {
    "rules": [
      {
        "sourceField": "cPersonCode",
        "targetField": "employeeCode",
        "type": "DIRECT_MAPPING"
      },
      {
        "sourceField": "cPersonName",
        "targetField": "employeeName",
        "type": "DIRECT_MAPPING"
      },
      {
        "sourceField": "cDepName",
        "targetField": "departmentName",
        "type": "LOOKUP_MAPPING",
        "lookupTable": "department_mapping"
      },
      {
        "sourceField": "dHireDate",
        "targetField": "hireDate",
        "type": "DATE_FORMAT",
        "format": "yyyy-MM-dd"
      }
    ],
    "filters": [
      {
        "condition": "employeeCode IS NOT NULL",
        "type": "REQUIRED_FIELD"
      }
    ]
  },
  "target": {
    "systemType": "INTERNAL_HR",
    "dataSourceId": "ds_internal_hr_001",
    "loadConfig": {
      "dataType": "EMPLOYEES",
      "apiEndpoint": "/api/v1/employees/batch-sync",
      "mode": "UPSERT",
      "batchSize": 500,
      "conflictStrategy": "SOURCE_WINS"
    }
  },
  "notification": {
    "enabled": true,
    "channels": ["EMAIL", "WEBHOOK"],
    "recipients": ["admin@company.com"],
    "webhookUrl": "https://webhook.company.com/integration"
  }
}
```

**åŒ—æ£®HRç³»ç»Ÿé›†æˆé…ç½®ï¼š**
```json
{
  "taskId": "task_beisen_employee_sync_002",
  "taskName": "åŒ—æ£®HRå‘˜å·¥æ•°æ®åŒæ­¥",
  "taskType": "EMPLOYEE_SYNC",
  "source": {
    "systemType": "HR_BEISEN",
    "dataSourceId": "ds_beisen_hr_001",
    "extractConfig": {
      "dataType": "EMPLOYEES",
      "apiEndpoint": "/api/v1/employees",
      "authType": "OAUTH2",
      "fields": ["employee_id", "name", "department", "position", "mobile", "email"],
      "filters": {
        "status": "active"
      }
    }
  },
  "transform": {
    "rules": [
      {
        "sourceField": "employee_id",
        "targetField": "employeeId",
        "type": "DIRECT_MAPPING"
      },
      {
        "sourceField": "name",
        "targetField": "employeeName",
        "type": "DIRECT_MAPPING"
      }
    ]
  },
  "target": {
    "systemType": "INTERNAL_IDENTITY",
    "dataSourceId": "ds_internal_identity_001",
    "loadConfig": {
      "dataType": "USERS",
      "apiEndpoint": "/api/v1/users/batch-create",
      "mode": "MERGE"
    }
  }
}
```

### 4.3 ç›‘æ§å‘Šè­¦æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç›‘æ§å‘Šè­¦æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ä»»åŠ¡æ‰§è¡Œä¸­
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IntegrationEngine.execute()                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. å®šæœŸæ›´æ–°æ‰§è¡Œè¿›åº¦                                     â”‚  â”‚
â”‚  â”‚ 2. æ”¶é›†æ€§èƒ½æŒ‡æ ‡                                         â”‚  â”‚
â”‚  â”‚ 3. æ£€æŸ¥å¼‚å¸¸æƒ…å†µ                                         â”‚  â”‚
â”‚  â”‚ 4. å‘é€å¿ƒè·³çŠ¶æ€                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ç›‘æ§æŒ‡æ ‡æ”¶é›†
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Micrometer + Prometheus                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ integration_task_total{status="completed"}             â”‚  â”‚
â”‚  â”‚ integration_task_duration_seconds                        â”‚  â”‚
â”‚  â”‚ integration_data_processed_total                         â”‚  â”‚
â”‚  â”‚ integration_system_connectivity_status                  â”‚  â”‚
â”‚  â”‚ integration_api_response_time_seconds                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ å‘Šè­¦è§„åˆ™æ£€æµ‹
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AlertManager + Grafana Alerting                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»»åŠ¡å¤±è´¥ç‡ > 10%                                       â”‚  â”‚
â”‚  â”‚ æ•°æ®åŒæ­¥å»¶è¿Ÿ > 30åˆ†é’Ÿ                                   â”‚  â”‚
â”‚  â”‚ ç¬¬ä¸‰æ–¹ç³»ç»Ÿè¿æ¥å¤±è´¥                                      â”‚  â”‚
â”‚  â”‚ APIå“åº”æ—¶é—´ > 5ç§’                                       â”‚  â”‚
â”‚  â”‚ æ•°æ®å¤„ç†é‡å¼‚å¸¸æ³¢åŠ¨                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ å‘Šè­¦é€šçŸ¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NotificationService                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é‚®ä»¶é€šçŸ¥ï¼šç®¡ç†å‘˜é‚®ç®±                                     â”‚  â”‚
â”‚  â”‚ çŸ­ä¿¡é€šçŸ¥ï¼šè¿ç»´äººå‘˜æ‰‹æœº                                   â”‚  â”‚
â”‚  â”‚ ä¼ä¸šå¾®ä¿¡ï¼šå·¥ä½œç¾¤é€šçŸ¥                                     â”‚  â”‚
â”‚  â”‚ é’‰é’‰æœºå™¨äººï¼šæŠ€æœ¯ç¾¤é€šçŸ¥                                   â”‚  â”‚
â”‚  â”‚ Webhookï¼šè‡ªå®šä¹‰ç³»ç»Ÿå›è°ƒ                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. IOE-DREAMæŠ€æœ¯æ ˆé€‚é…

### 5.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ç±»åˆ« | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | è¯´æ˜ |
|---------|---------|------|------|
| **æ¡†æ¶åŸºç¡€** | Spring Boot | 3.5.4 | ä¼ä¸šçº§å¾®æœåŠ¡æ¡†æ¶ |
| **å¾®æœåŠ¡æ²»ç†** | Spring Cloud | 2023.0.3 | å¾®æœåŠ¡ç”Ÿæ€ |
| **æœåŠ¡æ³¨å†Œ** | Nacos | 2.3.0 | æœåŠ¡å‘ç°ä¸é…ç½®ä¸­å¿ƒ |
| **APIç½‘å…³** | Spring Cloud Gateway | 4.1.0 | ç»Ÿä¸€å…¥å£ç½‘å…³ |
| **æ•°æ®è®¿é—®** | MyBatis Plus | 3.5.7 | ORMæ¡†æ¶ |
| **æ•°æ®åº“** | MySQL | 8.0.33 | ä¸»æ•°æ®åº“ |
| **ç¼“å­˜** | Redis | 6.0+ | å¤šçº§ç¼“å­˜æ”¯æŒ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RabbitMQ | 3.12+ | å¼‚æ­¥æ¶ˆæ¯å¤„ç† |
| **ä»»åŠ¡è°ƒåº¦** | Quartz + Nacos | 2.3+ | åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ |
| **ç›‘æ§** | Micrometer + Prometheus | 1.12+ | ç›‘æ§æŒ‡æ ‡æ”¶é›† |
| **æ–‡æ¡£** | Knife4j | 4.4+ | APIæ–‡æ¡£ç”Ÿæˆ |

### 5.2 Jakarta EE 3.0+ åŒ…åè§„èŒƒ

**å¼ºåˆ¶ä½¿ç”¨Jakarta EEåŒ…åï¼š**
```java
// âœ… æ­£ç¡®ç¤ºä¾‹
import jakarta.annotation.Resource;
import jakarta.validation.Valid;
import jakarta.persistence.Entity;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.transaction.Transactional;

// âŒ ç¦æ­¢ä½¿ç”¨
// import javax.annotation.Resource;
// import javax.validation.Valid;
```

### 5.3 å››å±‚æ¶æ„è§„èŒƒ

**ä¸¥æ ¼éµå¾ªController â†’ Service â†’ Manager â†’ DAOæ¶æ„ï¼š**

```java
// Controllerå±‚ - æ¥å£æ§åˆ¶å±‚
@RestController
@RequestMapping("/api/v1/integration")
public class IntegrationController {
    @Resource
    private IntegrationService integrationService;

    @PostMapping("/task/create")
    public ResponseDTO<IntegrationTaskVO> createTask(@Valid @RequestBody IntegrationTaskDTO dto) {
        IntegrationTaskVO result = integrationService.createTask(dto);
        return ResponseDTO.ok(result);
    }
}

// Serviceå±‚ - ä¸šåŠ¡é€»è¾‘å±‚
@Service
@Transactional(rollbackFor = Exception.class)
public class IntegrationServiceImpl implements IntegrationService {
    @Resource
    private IntegrationManager integrationManager;

    @Override
    public IntegrationTaskVO createTask(IntegrationTaskDTO dto) {
        // ä¸šåŠ¡è§„åˆ™éªŒè¯
        validateTaskConfig(dto);

        // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        return integrationManager.executeTaskCreation(dto);
    }
}

// Managerå±‚ - å¤æ‚æµç¨‹ç®¡ç†å±‚
@Component
public class IntegrationManagerImpl implements IntegrationManager {
    @Resource
    private IntegrationTaskDao taskDao;
    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    @Override
    @Transactional(rollbackFor = Exception.class)
    public IntegrationTaskVO executeTaskCreation(IntegrationTaskDTO dto) {
        // å¤æ‚ä¸šåŠ¡æµç¨‹
        // 1. æ•°æ®éªŒè¯
        // 2. ç¼“å­˜å¤„ç†
        // 3. äº‹åŠ¡åè°ƒ
        return result;
    }
}

// DAOå±‚ - æ•°æ®è®¿é—®å±‚
@Mapper
public interface IntegrationTaskDao extends BaseMapper<IntegrationTaskEntity> {
    @Transactional(readOnly = true)
    IntegrationTaskEntity selectByTaskName(@Param("taskName") String taskName);

    @Transactional(rollbackFor = Exception.class)
    int updateTaskStatus(@Param("taskId") String taskId, @Param("status") String status);
}
```

### 5.4 å¤šçº§ç¼“å­˜æ¶æ„

**ä¸‰çº§ç¼“å­˜ç­–ç•¥å®ç°ï¼š**

```java
@Component
public class IntegrationCacheManager {

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    // L1æœ¬åœ°ç¼“å­˜
    private final Cache<String, Object> localCache = Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(Duration.ofMinutes(5))
            .build();

    public <T> T getWithRefresh(String key, Supplier<T> loader, Duration ttl) {
        // L1æœ¬åœ°ç¼“å­˜
        T value = (T) localCache.getIfPresent(key);
        if (value != null) {
            return value;
        }

        // L2 Redisç¼“å­˜
        value = (T) redisTemplate.opsForValue().get(key);
        if (value != null) {
            localCache.put(key, value);
            return value;
        }

        // ä»æ•°æ®åº“åŠ è½½
        value = loader.get();
        if (value != null) {
            localCache.put(key, value);
            redisTemplate.opsForValue().set(key, value, ttl);
        }

        return value;
    }
}
```

### 5.5 SAGAåˆ†å¸ƒå¼äº‹åŠ¡

**åŸºäºSeataçš„SAGAäº‹åŠ¡å®ç°ï¼š**

```java
@Component
public class IntegrationSagaManager {

    @Resource
    private SagaManager sagaManager;

    public SagaTransaction createIntegrationSaga(String businessKey, String taskId) {
        return sagaManager.createSaga("integration", businessKey)
                .step("validateSourceSystem", this::validateSourceSystem, this::rollbackSourceValidation)
                .step("extractData", this::extractDataFromSource, this::rollbackDataExtraction)
                .step("transformData", this::transformData, this::rollbackDataTransformation)
                .step("loadDataToTarget", this::loadDataToTarget, this::rollbackDataLoading)
                .step("notifyCompletion", this::notifyIntegrationComplete, this::rollbackNotification)
                .build();
    }
}
```

---

## 6. å…³é”®æŠ€æœ¯å®ç°

### 6.1 SPIæ’ä»¶æœºåˆ¶å®ç°

**å®šä¹‰æ’ä»¶æ¥å£ï¼š**
```java
public interface IntegrationDataSourceProcessor {

    SystemType getSystemType();

    // è¿æ¥ç®¡ç†
    Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam);

    // æ•°æ®æ“ä½œ
    List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig config);
    Integer loadData(IntegrationDataSourceEntity dataSource, List<Map<String, Object>> data, LoadConfig config);

    // å…ƒæ•°æ®æŸ¥è¯¢
    List<String> listAvailableDataTypes(IntegrationConnectionParam connectionParam);
    List<DataFieldInfo> listDataFields(IntegrationConnectionParam connectionParam, String dataType);
}
```

**å…·ä½“æ’ä»¶å®ç°ï¼š**
```java
@AutoService(IntegrationDataSourceProcessor.class)
@Component
public class DingTalkDataSourceProcessor extends AbstractIntegrationDataSourceProcessor {

    @Override
    public SystemType getSystemType() {
        return SystemType.DINGTALK;
    }

    @Override
    public Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam) {
        try {
            DingTalkClient client = new DingTalkClient(connectionParam);
            return client.testConnection();
        } catch (Exception e) {
            log.error("é’‰é’‰è¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    @Override
    public List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig config) {
        DingTalkClient client = createDingTalkClient(dataSource);

        if (config.getDataType() == ExtractDataType.EMPLOYEES) {
            return client.getEmployees(config.getParams());
        } else if (config.getDataType() == ExtractDataType.DEPARTMENTS) {
            return client.getDepartments(config.getParams());
        }

        return Collections.emptyList();
    }
}
```

**SPIé…ç½®æ–‡ä»¶ï¼š**
```
META-INF/services/
â””â”€â”€ com.ioedream.integration.plugin.IntegrationDataSourceProcessor
    â”œâ”€â”€ com.ioedream.integration.plugin.erp.ErpU8DataSourceProcessor
    â”œâ”€â”€ com.ioedream.integration.plugin.hr.BeisenDataSourceProcessor
    â”œâ”€â”€ com.ioedream.integration.plugin.oa.DingTalkDataSourceProcessor
    â””â”€â”€ com.ioedream.integration.plugin.payment.AlipayDataSourceProcessor
```

### 6.2 å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸çŠ¶æ€ç®¡ç†

**ä»»åŠ¡çŠ¶æ€å®šä¹‰ï¼š**
```java
public enum IntegrationTaskStatus {
    CREATED,       // å·²åˆ›å»º
    STARTING,      // å¯åŠ¨ä¸­
    RUNNING,       // è¿è¡Œä¸­
    COMPLETED,     // å·²å®Œæˆ
    FAILED,        // æ‰§è¡Œå¤±è´¥
    CANCELLED,     // å·²å–æ¶ˆ
    TIMEOUT;       // è¶…æ—¶

    public boolean canTransitionTo(IntegrationTaskStatus target) {
        switch (this) {
            case CREATED:
                return target == STARTING || target == FAILED;
            case STARTING:
                return target == RUNNING || target == FAILED || target == CANCELLED;
            case RUNNING:
                return target == COMPLETED || target == FAILED || target == CANCELLED || target == TIMEOUT;
            default:
                return false;  // ç»ˆæ€ä¸å¯è½¬æ¢
        }
    }
}
```

**å¼‚æ­¥ä»»åŠ¡ç®¡ç†ï¼š**
```java
@Component
@Slf4j
public class IntegrationTaskManager {

    private final Map<String, CompletableFuture<Void>> runningTasks = new ConcurrentHashMap<>();
    private final Map<String, IntegrationTaskStatus> taskStatus = new ConcurrentHashMap<>();

    @Async("integrationTaskExecutor")
    public CompletableFuture<Void> executeTaskAsync(String taskId, IntegrationTaskParam taskParam) {
        return CompletableFuture.runAsync(() -> {
            try {
                updateTaskStatus(taskId, IntegrationTaskStatus.STARTING);

                // æ‰§è¡Œé›†æˆä»»åŠ¡
                executeIntegrationTask(taskId, taskParam);

                updateTaskStatus(taskId, IntegrationTaskStatus.COMPLETED);

            } catch (Exception e) {
                log.error("é›†æˆä»»åŠ¡ {} æ‰§è¡Œå¤±è´¥", taskId, e);
                updateTaskStatus(taskId, IntegrationTaskStatus.FAILED);
            }
        }, integrationTaskExecutor).whenComplete((result, throwable) -> {
            runningTasks.remove(taskId);
        });
    }

    public boolean cancelTask(String taskId) {
        CompletableFuture<Void> taskFuture = runningTasks.get(taskId);
        if (taskFuture != null && !taskFuture.isDone()) {
            boolean cancelled = taskFuture.cancel(true);
            if (cancelled) {
                updateTaskStatus(taskId, IntegrationTaskStatus.CANCELLED);
            }
            return cancelled;
        }
        return false;
    }
}
```

### 6.3 æ•°æ®è½¬æ¢å¼•æ“

**è½¬æ¢è§„åˆ™å¼•æ“ï¼š**
```java
@Component
public class IntegrationDataTransformer {

    public List<Map<String, Object>> transform(List<Map<String, Object>> sourceData, TransformConfig config) {
        List<Map<String, Object>> result = new ArrayList<>();

        for (Map<String, Object> record : sourceData) {
            Map<String, Object> transformedRecord = transformRecord(record, config);
            if (transformedRecord != null) {
                result.add(transformedRecord);
            }
        }

        return result;
    }

    private Map<String, Object> transformRecord(Map<String, Object> sourceRecord, TransformConfig config) {
        Map<String, Object> targetRecord = new HashMap<>();

        // åº”ç”¨è½¬æ¢è§„åˆ™
        for (TransformRule rule : config.getRules()) {
            Object sourceValue = sourceRecord.get(rule.getSourceField());
            Object targetValue = applyTransformRule(sourceValue, rule);

            if (targetValue != null) {
                targetRecord.put(rule.getTargetField(), targetValue);
            }
        }

        // åº”ç”¨è¿‡æ»¤è§„åˆ™
        for (FilterRule filter : config.getFilters()) {
            if (!applyFilterRule(targetRecord, filter)) {
                return null;  // è¿‡æ»¤æ‰æ­¤è®°å½•
            }
        }

        return targetRecord;
    }

    private Object applyTransformRule(Object sourceValue, TransformRule rule) {
        switch (rule.getType()) {
            case DIRECT_MAPPING:
                return sourceValue;
            case LOOKUP_MAPPING:
                return performLookup(sourceValue, rule.getLookupTable());
            case DATE_FORMAT:
                return formatDate(sourceValue, rule.getFormat());
            case NUMBER_FORMAT:
                return formatNumber(sourceValue, rule.getPattern());
            case CUSTOM_FUNCTION:
                return executeCustomFunction(sourceValue, rule.getFunctionName());
            default:
                return sourceValue;
        }
    }
}
```

### 6.4 ç›‘æ§æŒ‡æ ‡æ”¶é›†

**è‡ªå®šä¹‰æŒ‡æ ‡æ³¨å†Œï¼š**
```java
@Component
public class IntegrationMetrics {

    private final Counter taskCounter;
    private final Timer taskDuration;
    private final Gauge dataProcessed;
    private final Gauge systemConnectivity;

    public IntegrationMetrics(MeterRegistry meterRegistry) {
        this.taskCounter = Counter.builder("integration_task_total")
                .description("Total number of integration tasks")
                .tag("status", "unknown")
                .register(meterRegistry);

        this.taskDuration = Timer.builder("integration_task_duration_seconds")
                .description("Integration task execution duration")
                .register(meterRegistry);

        this.dataProcessed = Gauge.builder("integration_data_processed_total")
                .description("Total data records processed")
                .register(meterRegistry, this, IntegrationMetrics::getTotalProcessedData);

        this.systemConnectivity = Gauge.builder("integration_system_connectivity")
                .description("Third-party system connectivity status")
                .tag("system", "unknown")
                .register(meterRegistry, this, IntegrationMetrics::getSystemConnectivity);
    }

    public void recordTaskCompleted(String systemType, double duration) {
        taskCounter.increment(Tags.of("status", "completed", "system", systemType));
        taskDuration.record(duration, Tags.of("system", systemType));
    }

    public void recordTaskFailed(String systemType, String errorType) {
        taskCounter.increment(Tags.of("status", "failed", "system", systemType, "error_type", errorType));
    }

    private double getTotalProcessedData() {
        // è¿”å›å½“å‰å·²å¤„ç†çš„æ•°æ®æ€»é‡
        return dataProcessedCount.get();
    }
}
```

### 6.5 é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶

**é‡è¯•ç­–ç•¥å®ç°ï¼š**
```java
@Component
public class IntegrationRetryManager {

    @Retryable(
        value = {IntegrationException.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 1000, multiplier = 2)
    )
    public List<Map<String, Object>> extractDataWithRetry(IntegrationDataSourceEntity dataSource, ExtractConfig config) {
        try {
            IntegrationDataSourceProcessor processor = getProcessor(dataSource.getSystemType());
            return processor.extractData(dataSource, config);
        } catch (Exception e) {
            log.warn("æ•°æ®æå–å¤±è´¥ï¼Œå‡†å¤‡é‡è¯•", e);
            throw new IntegrationException("æ•°æ®æå–å¤±è´¥", e);
        }
    }

    @Recover
    public List<Map<String, Object>> recover(IntegrationException e, IntegrationDataSourceEntity dataSource, ExtractConfig config) {
        log.error("æ•°æ®æå–é‡è¯•æ¬¡æ•°å·²ç”¨å°½ï¼Œä»»åŠ¡å¤±è´¥", e);

        // è®°å½•å¤±è´¥ä¿¡æ¯
        recordFailure(dataSource.getId(), e.getMessage());

        // å‘é€å‘Šè­¦é€šçŸ¥
        sendFailureAlert(dataSource.getSystemName(), e.getMessage());

        return Collections.emptyList();
    }
}
```

---

## 7. å…·ä½“é›†æˆæ–¹æ¡ˆ

### 7.1 ERPç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

#### 7.1.1 ç”¨å‹U8 ERPé›†æˆ

**é›†æˆåœºæ™¯ï¼š**
- å‘˜å·¥ä¿¡æ¯åŒæ­¥ï¼šä»ERPåŒæ­¥å‘˜å·¥åŸºç¡€ä¿¡æ¯åˆ°IOE-DREAM
- éƒ¨é—¨ç»„ç»‡æ¶æ„åŒæ­¥ï¼šåŒæ­¥éƒ¨é—¨å±‚çº§ç»“æ„
- è€ƒå‹¤æ•°æ®å›å†™ï¼šå°†IOE-DREAMè€ƒå‹¤æ•°æ®å›å†™åˆ°ERP
- æ¶ˆè´¹æ•°æ®åŒæ­¥ï¼šåŒæ­¥æ¶ˆè´¹ç›¸å…³çš„åŸºç¡€æ•°æ®

**æŠ€æœ¯å®ç°ï¼š**

```java
@AutoService(IntegrationDataSourceProcessor.class)
@Component
public class U8IntegrationProcessor extends AbstractIntegrationDataSourceProcessor {

    @Override
    public SystemType getSystemType() {
        return SystemType.ERP_U8;
    }

    @Override
    public Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam) {
        try {
            U8ApiClient client = new U8ApiClient(connectionParam);

            // æµ‹è¯•æ•°æ®åº“è¿æ¥
            boolean dbConnected = client.testDatabaseConnection();

            // æµ‹è¯•APIè¿æ¥
            boolean apiConnected = client.testApiConnection();

            return dbConnected && apiConnected;
        } catch (Exception e) {
            log.error("U8ç³»ç»Ÿè¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    @Override
    public List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig config) {
        U8ApiClient client = createU8Client(dataSource);

        switch (config.getDataType()) {
            case EMPLOYEES:
                return extractEmployees(client, config);
            case DEPARTMENTS:
                return extractDepartments(client, config);
            case INVENTORY:
                return extractInventory(client, config);
            case ORDERS:
                return extractOrders(client, config);
            default:
                return Collections.emptyList();
        }
    }

    private List<Map<String, Object>> extractEmployees(U8ApiClient client, ExtractConfig config) {
        List<Map<String, Object>> employees = new ArrayList<>();

        // æ„å»ºæŸ¥è¯¢å‚æ•°
        U8QueryParams params = U8QueryParams.builder()
                .table("HR_HI_Person")
                .fields(config.getFields())
                .filters(config.getFilters())
                .pageSize(config.getPageSize())
                .build();

        // åˆ†é¡µæŸ¥è¯¢
        int page = 1;
        boolean hasMore = true;

        while (hasMore) {
            params.setPage(page);
            U8QueryResult result = client.query(params);

            if (result.getData() != null && !result.getData().isEmpty()) {
                employees.addAll(result.getData());
                hasMore = result.getData().size() == config.getPageSize();
            } else {
                hasMore = false;
            }

            page++;
        }

        return employees;
    }

    @Override
    public Integer loadData(IntegrationDataSourceEntity dataSource, List<Map<String, Object>> data, LoadConfig config) {
        U8ApiClient client = createU8Client(dataSource);

        switch (config.getDataType()) {
            case ATTENDANCE_RECORDS:
                return loadAttendanceRecords(client, data, config);
            case CONSUME_RECORDS:
                return loadConsumeRecords(client, data, config);
            case VISITOR_RECORDS:
                return loadVisitorRecords(client, data, config);
            default:
                return 0;
        }
    }

    private Integer loadAttendanceRecords(U8ApiClient client, List<Map<String, Object>> records, LoadConfig config) {
        int successCount = 0;

        // æ‰¹é‡å¤„ç†
        List<List<Map<String, Object>>> batches = partition(records, config.getBatchSize());

        for (List<Map<String, Object>> batch : batches) {
            try {
                // è½¬æ¢ä¸ºU8è€ƒå‹¤è®°å½•æ ¼å¼
                List<U8AttendanceRecord> u8Records = convertToU8AttendanceRecords(batch);

                // è°ƒç”¨U8 APIæ‰¹é‡å†™å…¥
                BatchWriteResult result = client.batchWriteAttendanceRecords(u8Records);

                successCount += result.getSuccessCount();

                if (result.hasFailures()) {
                    log.warn("éƒ¨åˆ†è€ƒå‹¤è®°å½•å†™å…¥å¤±è´¥: {}", result.getFailureDetails());
                }

            } catch (Exception e) {
                log.error("è€ƒå‹¤è®°å½•æ‰¹é‡å†™å…¥å¤±è´¥", e);
            }
        }

        return successCount;
    }
}
```

**é›†æˆä»»åŠ¡é…ç½®ç¤ºä¾‹ï¼š**
```json
{
  "taskId": "u8_employee_sync_001",
  "taskName": "ç”¨å‹U8å‘˜å·¥ä¿¡æ¯åŒæ­¥",
  "source": {
    "systemType": "ERP_U8",
    "extractConfig": {
      "dataType": "EMPLOYEES",
      "fields": ["cPersonCode", "cPersonName", "cDepName", "cPosition", "dHireDate"],
      "filters": {
        "cStatus": "Y"
      },
      "pageSize": 1000
    }
  },
  "transform": {
    "rules": [
      {
        "sourceField": "cPersonCode",
        "targetField": "employeeCode",
        "type": "DIRECT_MAPPING"
      },
      {
        "sourceField": "cDepName",
        "targetField": "departmentName",
        "type": "LOOKUP_MAPPING",
        "lookupTable": "department_mapping"
      }
    ]
  },
  "target": {
    "systemType": "INTERNAL_IDENTITY",
    "loadConfig": {
      "dataType": "EMPLOYEES",
      "mode": "UPSERT",
      "batchSize": 500
    }
  }
}
```

#### 7.1.2 é‡‘è¶K3 ERPé›†æˆ

**é›†æˆåœºæ™¯ï¼š**
- ä¾›åº”å•†ä¿¡æ¯åŒæ­¥
- å®¢æˆ·ä¿¡æ¯åŒæ­¥
- ç‰©æ–™ä¿¡æ¯åŒæ­¥
- é”€å”®è®¢å•åŒæ­¥

### 7.2 HRç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

#### 7.2.1 åŒ—æ£®HRç³»ç»Ÿé›†æˆ

**é›†æˆåœºæ™¯ï¼š**
- å‘˜å·¥ä¿¡æ¯åŒå‘åŒæ­¥
- ç»„ç»‡æ¶æ„åŒæ­¥
- è–ªèµ„æ•°æ®åŒæ­¥
- ç»©æ•ˆæ•°æ®åŒæ­¥

**æŠ€æœ¯å®ç°ï¼š**

```java
@AutoService(IntegrationDataSourceProcessor.class)
@Component
public class BeisenIntegrationProcessor extends AbstractIntegrationDataSourceProcessor {

    @Override
    public SystemType getSystemType() {
        return SystemType.HR_BEISEN;
    }

    @Override
    public Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam) {
        try {
            BeisenApiClient client = new BeisenApiClient(connectionParam);

            // æµ‹è¯•OAuthè®¤è¯
            String accessToken = client.getAccessToken();

            // æµ‹è¯•APIè°ƒç”¨
            return client.testApiCall(accessToken);
        } catch (Exception e) {
            log.error("åŒ—æ£®HRç³»ç»Ÿè¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    @Override
    public List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig config) {
        BeisenApiClient client = createBeisenClient(dataSource);

        switch (config.getDataType()) {
            case EMPLOYEES:
                return extractEmployees(client, config);
            case ORGANIZATION:
                return extractOrganization(client, config);
            case SALARY:
                return extractSalaryData(client, config);
            case PERFORMANCE:
                return extractPerformanceData(client, config);
            default:
                return Collections.emptyList();
        }
    }

    private List<Map<String, Object>> extractEmployees(BeisenApiClient client, ExtractConfig config) {
        List<Map<String, Object>> employees = new ArrayList<>();

        // åŒ—æ£®APIè°ƒç”¨
        BeisenApiRequest request = BeisenApiRequest.builder()
                .endpoint("/api/employee/v1/employees")
                .method("GET")
                .params(config.getParams())
                .build();

        BeisenApiResponse response = client.execute(request);

        if (response.isSuccess()) {
            employees = response.getData();
        } else {
            log.error("åŒ—æ£®å‘˜å·¥æ•°æ®æå–å¤±è´¥: {}", response.getMessage());
        }

        return employees;
    }
}
```

### 7.3 OAç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

#### 7.3.1 é’‰é’‰OAé›†æˆ

**é›†æˆåœºæ™¯ï¼š**
- å®¡æ‰¹æµç¨‹åŒæ­¥
- é€šè®¯å½•åŒæ­¥
- æ—¥ç¨‹å®‰æ’åŒæ­¥
- æ¶ˆæ¯é€šçŸ¥

**æŠ€æœ¯å®ç°ï¼š**

```java
@AutoService(IntegrationDataSourceProcessor.class)
@Component
public class DingTalkIntegrationProcessor extends AbstractIntegrationDataSourceProcessor {

    @Override
    public SystemType getSystemType() {
        return SystemType.OA_DINGTALK;
    }

    @Override
    public Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam) {
        try {
            DingTalkClient client = new DingTalkClient(connectionParam);

            // æµ‹è¯•access_tokenè·å–
            String accessToken = client.getAccessToken();

            // æµ‹è¯•ç”¨æˆ·ä¿¡æ¯è·å–
            JSONObject userInfo = client.getUserInfo("admin");

            return accessToken != null && userInfo != null;
        } catch (Exception e) {
            log.error("é’‰é’‰è¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    @Override
    public List<Map<String, Object>> extractData(IntegrationDataSourceEntity dataSource, ExtractConfig config) {
        DingTalkClient client = createDingTalkClient(dataSource);

        switch (config.getDataType()) {
            case EMPLOYEES:
                return extractEmployees(client, config);
            case DEPARTMENTS:
                return extractDepartments(client, config);
            case APPROVALS:
                return extractApprovals(client, config);
            case CALENDARS:
                return extractCalendars(client, config);
            default:
                return Collections.emptyList();
        }
    }

    @Override
    public Integer loadData(IntegrationDataSourceEntity dataSource, List<Map<String, Object>> data, LoadConfig config) {
        DingTalkClient client = createDingTalkClient(dataSource);

        switch (config.getDataType()) {
            case NOTIFICATIONS:
                return sendNotifications(client, data, config);
            case CALENDAR_EVENTS:
                return createCalendarEvents(client, data, config);
            case APPROVAL_INSTANCES:
                return createApprovalInstances(client, data, config);
            default:
                return 0;
        }
    }

    private Integer sendNotifications(DingTalkClient client, List<Map<String, Object>> notifications, LoadConfig config) {
        int successCount = 0;

        for (Map<String, Object> notification : notifications) {
            try {
                DingTalkMessage message = DingTalkMessage.builder()
                        .userIds((List<String>) notification.get("userIds"))
                        .deptIds((List<String>) notification.get("deptIds"))
                        .msgType((String) notification.get("msgType"))
                        .content((String) notification.get("content"))
                        .build();

                boolean result = client.sendMessage(message);
                if (result) {
                    successCount++;
                }
            } catch (Exception e) {
                log.error("å‘é€é’‰é’‰æ¶ˆæ¯å¤±è´¥", e);
            }
        }

        return successCount;
    }
}
```

### 7.4 æ”¯ä»˜ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

#### 7.4.1 å¾®ä¿¡æ”¯ä»˜é›†æˆ

**é›†æˆåœºæ™¯ï¼š**
- æ¶ˆè´¹è®°å½•æ”¯ä»˜
- é€€æ¬¾å¤„ç†
- å¯¹è´¦æ•°æ®åŒæ­¥

**æŠ€æœ¯å®ç°ï¼š**

```java
@AutoService(IntegrationDataSourceProcessor.class)
@Component
public class WechatPayIntegrationProcessor extends AbstractIntegrationDataSourceProcessor {

    @Override
    public SystemType getSystemType() {
        return SystemType.PAYMENT_WECHAT;
    }

    @Override
    public Boolean checkSystemConnectivity(IntegrationConnectionParam connectionParam) {
        try {
            WechatPayClient client = new WechatPayClient(connectionParam);

            // æµ‹è¯•å•†æˆ·ä¿¡æ¯æŸ¥è¯¢
            MerchantInfo merchantInfo = client.getMerchantInfo();

            return merchantInfo != null && merchantInfo.isValid();
        } catch (Exception e) {
            log.error("å¾®ä¿¡æ”¯ä»˜è¿æ¥æµ‹è¯•å¤±è´¥", e);
            return false;
        }
    }

    @Override
    public Integer loadData(IntegrationDataSourceEntity dataSource, List<Map<String, Object>> data, LoadConfig config) {
        WechatPayClient client = createWechatPayClient(dataSource);

        switch (config.getDataType()) {
            case PAYMENT_ORDERS:
                return createPaymentOrders(client, data, config);
            case REFUND_ORDERS:
                return createRefundOrders(client, data, config);
            default:
                return 0;
        }
    }

    private Integer createPaymentOrders(WechatPayClient client, List<Map<String, Object>> orders, LoadConfig config) {
        int successCount = 0;

        for (Map<String, Object> order : orders) {
            try {
                WechatPayOrderRequest request = WechatPayOrderRequest.builder()
                        .outTradeNo((String) order.get("outTradeNo"))
                        .description((String) order.get("description"))
                        .amount((Integer) order.get("amount"))
                        .openid((String) order.get("openid"))
                        .notifyUrl((String) order.get("notifyUrl"))
                        .build();

                WechatPayOrderResult result = client.createOrder(request);

                if (result.isSuccess()) {
                    successCount++;

                    // æ›´æ–°åŸå§‹æ•°æ®ä¸­çš„æ”¯ä»˜ä¿¡æ¯
                    order.put("prepayId", result.getPrepayId());
                    order.put("codeUrl", result.getCodeUrl());
                }
            } catch (Exception e) {
                log.error("åˆ›å»ºå¾®ä¿¡æ”¯ä»˜è®¢å•å¤±è´¥", e);
            }
        }

        return successCount;
    }
}
```

### 7.5 æ¶ˆæ¯ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

#### 7.5.1 ä¼ä¸šå¾®ä¿¡é›†æˆ

**é›†æˆåœºæ™¯ï¼š**
- æ¶ˆæ¯æ¨é€
- åº”ç”¨æ¶ˆæ¯
- ç¾¤æœºå™¨äººæ¶ˆæ¯
- æ–‡ä»¶ä¼ è¾“

---

## 8. éƒ¨ç½²å®æ–½æŒ‡å—

### 8.1 å¾®æœåŠ¡éƒ¨ç½²é…ç½®

#### 8.1.1 Dockeréƒ¨ç½²é…ç½®

**Dockerfileï¼š**
```dockerfile
FROM openjdk:17-jre-slim

LABEL maintainer="IOE-DREAM Team"
LABEL version="1.0.0"

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY target/ioedream-integration-service-1.0.0.jar app.jar

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# åˆ›å»ºæ—¥å¿—ç›®å½•
RUN mkdir -p /app/logs

# æš´éœ²ç«¯å£
EXPOSE 8098

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8098/actuator/health || exit 1

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom", "-jar", "app.jar"]
```

**Docker Composeé…ç½®ï¼š**
```yaml
version: '3.8'

services:
  ioedream-integration-service:
    build: .
    container_name: ioedream-integration-service
    ports:
      - "8098:8098"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - NACOS_SERVER_ADDR=nacos:8848
      - NACOS_NAMESPACE=production
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_DATABASE=ioedream_integration
    volumes:
      - ./logs:/app/logs
      - ./config:/app/config
    depends_on:
      - mysql
      - redis
      - nacos
    restart: unless-stopped
    networks:
      - ioedream-network

  mysql:
    image: mysql:8.0
    container_name: ioedream-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ioedream_integration
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - mysql_data:/var/lib/mysql
      - ./sql:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"
    restart: unless-stopped
    networks:
      - ioedream-network

  redis:
    image: redis:7-alpine
    container_name: ioedream-redis
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped
    networks:
      - ioedream-network

  nacos:
    image: nacos/nacos-server:v2.3.0
    container_name: ioedream-nacos
    environment:
      - MODE=standalone
      - SPRING_DATASOURCE_PLATFORM=mysql
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_USER=${MYSQL_USER}
      - MYSQL_SERVICE_PASSWORD=${MYSQL_PASSWORD}
    ports:
      - "8848:8848"
    depends_on:
      - mysql
    restart: unless-stopped
    networks:
      - ioedream-network

volumes:
  mysql_data:
  redis_data:

networks:
  ioedream-network:
    driver: bridge
```

#### 8.1.2 Kuberneteséƒ¨ç½²é…ç½®

**Namespaceï¼š**
```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: ioedream-integration
  labels:
    name: ioedream-integration
```

**Deploymentï¼š**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ioedream-integration-service
  namespace: ioedream-integration
  labels:
    app: ioedream-integration-service
spec:
  replicas: 2
  selector:
    matchLabels:
      app: ioedream-integration-service
  template:
    metadata:
      labels:
        app: ioedream-integration-service
    spec:
      containers:
      - name: ioedream-integration-service
        image: ioedream/integration-service:1.0.0
        ports:
        - containerPort: 8098
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        - name: NACOS_SERVER_ADDR
          value: "nacos-server:8848"
        - name: NACOS_NAMESPACE
          value: "production"
        - name: REDIS_HOST
          value: "redis-service"
        - name: MYSQL_HOST
          value: "mysql-service"
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8098
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8098
          initialDelaySeconds: 30
          periodSeconds: 10
        volumeMounts:
        - name: logs
          mountPath: /app/logs
      - name: filebeat
        image: docker.elastic.co/beats/filebeat:8.5.0
        volumeMounts:
        - name: logs
          mountPath: /app/logs
        - name: filebeat-config
          mountPath: /usr/share/filebeat/filebeat.yml
          subPath: filebeat.yml
      volumes:
      - name: logs
        emptyDir: {}
      - name: filebeat-config
        configMap:
          name: filebeat-config
```

**Serviceï¼š**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: ioedream-integration-service
  namespace: ioedream-integration
  labels:
    app: ioedream-integration-service
spec:
  type: ClusterIP
  ports:
  - port: 8098
    targetPort: 8098
    protocol: TCP
  selector:
    app: ioedream-integration-service
```

### 8.2 é…ç½®ç®¡ç†

#### 8.2.1 Nacosé…ç½®

**application.ymlï¼š**
```yaml
server:
  port: 8098

spring:
  application:
    name: ioedream-integration-service

  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: IOE-DREAM
        username: ${NACOS_USERNAME:nacos}
        password: ${NACOS_PASSWORD:nacos}
        enabled: true
        register-enabled: true
      config:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: IOE-DREAM
        file-extension: yaml
        refresh-enabled: true

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3306}/${MYSQL_DATABASE:ioedream_integration}?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:123456}
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false

  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: 0
    timeout: 3000
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0

  quartz:
    job-store-type: jdbc
    properties:
      org:
        quartz:
          scheduler:
            instanceName: ioedream-integration
            instanceId: AUTO
          threadPool:
            threadCount: 20
          jobStore:
            class: org.quartz.impl.jdbcjobstore.JobStoreTX
            driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate
            tablePrefix: QRTZ_
            isClustered: true
            clusterCheckinInterval: 20000

mybatis-plus:
  mapper-locations: classpath*:mapper/*.xml
  type-aliases-package: net.lab1024.sa.integration.domain.entity
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    call-setters-on-nulls: true
  global-config:
    db-config:
      id-type: assign_id
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    net.lab1024.sa.integration: DEBUG
    org.springframework.integration: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: /app/logs/ioedream-integration-service.log
    max-size: 100MB
    max-history: 30

integration:
  # ç¬¬ä¸‰æ–¹ç³»ç»Ÿé…ç½®
  systems:
    erp:
      u8:
        api-timeout: 30000
        retry-times: 3
        batch-size: 1000
    hr:
      beisen:
        api-timeout: 30000
        retry-times: 3
        oauth-cache-ttl: 3600
    oa:
      dingtalk:
        api-timeout: 15000
        retry-times: 3
        message-rate-limit: 100

  # ä»»åŠ¡æ‰§è¡Œé…ç½®
  task:
    thread-pool:
      core-size: 10
      max-size: 50
      queue-capacity: 1000
    timeout:
      default: 3600000  # 1å°æ—¶
      max: 7200000     # 2å°æ—¶

  # æ•°æ®å¤„ç†é…ç½®
  data:
    batch-size: 1000
    max-retry-times: 3
    error-tolerance-rate: 0.05

  # é€šçŸ¥é…ç½®
  notification:
    channels:
      - email
      - webhook
      - wechat
    email:
      smtp-host: smtp.company.com
      smtp-port: 587
      username: integration@company.com
      password: ${EMAIL_PASSWORD}
```

### 8.3 ç›‘æ§éƒ¨ç½²

#### 8.3.1 Prometheusé…ç½®

**prometheus.ymlï¼š**
```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'ioedream-integration-service'
    static_configs:
      - targets: ['ioedream-integration-service:8098']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s

rule_files:
  - "integration_alert_rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

**å‘Šè­¦è§„åˆ™é…ç½®ï¼š**
```yaml
groups:
  - name: integration.rules
    rules:
      - alert: IntegrationTaskHighFailureRate
        expr: rate(integration_task_total{status="failed"}[5m]) / rate(integration_task_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "é›†æˆä»»åŠ¡å¤±è´¥ç‡è¿‡é«˜"
          description: "é›†æˆä»»åŠ¡5åˆ†é’Ÿå†…å¤±è´¥ç‡è¶…è¿‡10%"

      - alert: IntegrationSystemConnectivityFailure
        expr: integration_system_connectivity < 1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ç¬¬ä¸‰æ–¹ç³»ç»Ÿè¿æ¥å¤±è´¥"
          description: "ç¬¬ä¸‰æ–¹ç³»ç»Ÿ {{ $labels.system }} è¿æ¥å¤±è´¥"

      - alert: IntegrationTaskTimeout
        expr: integration_task_duration_seconds > 3600
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "é›†æˆä»»åŠ¡æ‰§è¡Œè¶…æ—¶"
          description: "é›†æˆä»»åŠ¡ {{ $labels.task_id }} æ‰§è¡Œæ—¶é—´è¶…è¿‡1å°æ—¶"
```

### 8.4 æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

**integration_schema.sqlï¼š**
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS ioedream_integration
DEFAULT CHARACTER SET utf8mb4
DEFAULT COLLATE utf8mb4_unicode_ci;

USE ioedream_integration;

-- ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æºè¡¨
CREATE TABLE IF NOT EXISTS integration_data_source (
  id VARCHAR(50) NOT NULL COMMENT 'ä¸»é”®ID',
  system_name VARCHAR(100) NOT NULL COMMENT 'ç³»ç»Ÿåç§°',
  system_type VARCHAR(50) NOT NULL COMMENT 'ç³»ç»Ÿç±»å‹',
  environment VARCHAR(50) DEFAULT 'PROD' COMMENT 'ç¯å¢ƒ',
  connection_params TEXT COMMENT 'è¿æ¥å‚æ•°(JSONæ ¼å¼)',
  conn_status VARCHAR(20) DEFAULT 'NONE' COMMENT 'è¿æ¥çŠ¶æ€',
  last_connect_time DATETIME COMMENT 'æœ€åè¿æ¥æ—¶é—´',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  create_by VARCHAR(50) COMMENT 'åˆ›å»ºäºº',
  update_by VARCHAR(50) COMMENT 'æ›´æ–°äºº',
  deleted TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (id),
  UNIQUE KEY uk_system_name (system_name),
  KEY idx_system_type (system_type),
  KEY idx_conn_status (conn_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ•°æ®æºè¡¨';

-- é›†æˆä»»åŠ¡å®šä¹‰è¡¨
CREATE TABLE IF NOT EXISTS integration_task (
  id VARCHAR(50) NOT NULL COMMENT 'ä¸»é”®ID',
  task_name VARCHAR(200) NOT NULL COMMENT 'ä»»åŠ¡åç§°',
  task_type VARCHAR(50) NOT NULL COMMENT 'ä»»åŠ¡ç±»å‹',
  source_data_source_id VARCHAR(50) NOT NULL COMMENT 'æºæ•°æ®æºID',
  target_data_source_id VARCHAR(50) NOT NULL COMMENT 'ç›®æ ‡æ•°æ®æºID',
  extract_config TEXT COMMENT 'æå–é…ç½®(JSONæ ¼å¼)',
  transform_config TEXT COMMENT 'è½¬æ¢é…ç½®(JSONæ ¼å¼)',
  load_config TEXT COMMENT 'åŠ è½½é…ç½®(JSONæ ¼å¼)',
  schedule_config TEXT COMMENT 'è°ƒåº¦é…ç½®(JSONæ ¼å¼)',
  status VARCHAR(20) DEFAULT 'ENABLED' COMMENT 'çŠ¶æ€',
  version INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  create_by VARCHAR(50) COMMENT 'åˆ›å»ºäºº',
  update_by VARCHAR(50) COMMENT 'æ›´æ–°äºº',
  deleted TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤',
  PRIMARY KEY (id),
  UNIQUE KEY uk_task_name (task_name),
  KEY idx_task_type (task_type),
  KEY idx_source_data_source_id (source_data_source_id),
  KEY idx_target_data_source_id (target_data_source_id),
  FOREIGN KEY (source_data_source_id) REFERENCES integration_data_source(id),
  FOREIGN KEY (target_data_source_id) REFERENCES integration_data_source(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é›†æˆä»»åŠ¡å®šä¹‰è¡¨';

-- é›†æˆä»»åŠ¡æ‰§è¡Œè®°å½•è¡¨
CREATE TABLE IF NOT EXISTS integration_execution (
  id VARCHAR(50) NOT NULL COMMENT 'ä¸»é”®ID',
  task_id VARCHAR(50) NOT NULL COMMENT 'ä»»åŠ¡ID',
  task_name VARCHAR(200) COMMENT 'ä»»åŠ¡åç§°',
  execution_mode VARCHAR(20) DEFAULT 'MANUAL' COMMENT 'æ‰§è¡Œæ¨¡å¼',
  status VARCHAR(20) DEFAULT 'CREATED' COMMENT 'æ‰§è¡ŒçŠ¶æ€',
  start_time DATETIME COMMENT 'å¼€å§‹æ—¶é—´',
  end_time DATETIME COMMENT 'ç»“æŸæ—¶é—´',
  duration_ms BIGINT COMMENT 'æ‰§è¡Œæ—¶é•¿(æ¯«ç§’)',
  extracted_count INT DEFAULT 0 COMMENT 'æå–æ•°æ®é‡',
  transformed_count INT DEFAULT 0 COMMENT 'è½¬æ¢æ•°æ®é‡',
  loaded_count INT DEFAULT 0 COMMENT 'åŠ è½½æ•°æ®é‡',
  error_count INT DEFAULT 0 COMMENT 'é”™è¯¯æ•°é‡',
  error_message TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',
  log_path VARCHAR(500) COMMENT 'æ—¥å¿—è·¯å¾„',
  engine_task_id VARCHAR(100) COMMENT 'å¼•æ“ä»»åŠ¡ID',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (id),
  KEY idx_task_id (task_id),
  KEY idx_status (status),
  KEY idx_start_time (start_time),
  FOREIGN KEY (task_id) REFERENCES integration_task(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é›†æˆä»»åŠ¡æ‰§è¡Œè®°å½•è¡¨';

-- é›†æˆè°ƒåº¦é…ç½®è¡¨
CREATE TABLE IF NOT EXISTS integration_schedule (
  id VARCHAR(50) NOT NULL COMMENT 'ä¸»é”®ID',
  task_id VARCHAR(50) NOT NULL COMMENT 'ä»»åŠ¡ID',
  cron_expression VARCHAR(100) NOT NULL COMMENT 'Cronè¡¨è¾¾å¼',
  schedule_status VARCHAR(20) DEFAULT 'ENABLED' COMMENT 'è°ƒåº¦çŠ¶æ€',
  start_time DATETIME COMMENT 'è°ƒåº¦å¼€å§‹æ—¶é—´',
  end_time DATETIME COMMENT 'è°ƒåº¦ç»“æŸæ—¶é—´',
  last_execute_time DATETIME COMMENT 'æœ€åæ‰§è¡Œæ—¶é—´',
  next_execute_time DATETIME COMMENT 'ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (id),
  UNIQUE KEY uk_task_id (task_id),
  KEY idx_next_execute_time (next_execute_time),
  FOREIGN KEY (task_id) REFERENCES integration_task(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é›†æˆè°ƒåº¦é…ç½®è¡¨';

-- é›†æˆé”™è¯¯æ—¥å¿—è¡¨
CREATE TABLE IF NOT EXISTS integration_error_log (
  id VARCHAR(50) NOT NULL COMMENT 'ä¸»é”®ID',
  execution_id VARCHAR(50) NOT NULL COMMENT 'æ‰§è¡Œè®°å½•ID',
  task_id VARCHAR(50) NOT NULL COMMENT 'ä»»åŠ¡ID',
  error_type VARCHAR(50) NOT NULL COMMENT 'é”™è¯¯ç±»å‹',
  error_code VARCHAR(50) COMMENT 'é”™è¯¯ç ',
  error_message TEXT NOT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
  error_stack TEXT COMMENT 'é”™è¯¯å †æ ˆ',
  step_name VARCHAR(100) COMMENT 'å‡ºé”™æ­¥éª¤',
  retry_count INT DEFAULT 0 COMMENT 'é‡è¯•æ¬¡æ•°',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (id),
  KEY idx_execution_id (execution_id),
  KEY idx_task_id (task_id),
  KEY idx_error_type (error_type),
  KEY idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é›†æˆé”™è¯¯æ—¥å¿—è¡¨';

-- é›†æˆç»Ÿè®¡æŒ‡æ ‡è¡¨
CREATE TABLE IF NOT EXISTS integration_metrics (
  id VARCHAR(50) NOT NULL COMMENT 'ä¸»é”®ID',
  metric_date DATE NOT NULL COMMENT 'ç»Ÿè®¡æ—¥æœŸ',
  system_type VARCHAR(50) NOT NULL COMMENT 'ç³»ç»Ÿç±»å‹',
  task_type VARCHAR(50) NOT NULL COMMENT 'ä»»åŠ¡ç±»å‹',
  total_tasks INT DEFAULT 0 COMMENT 'æ€»ä»»åŠ¡æ•°',
  success_tasks INT DEFAULT 0 COMMENT 'æˆåŠŸä»»åŠ¡æ•°',
  failed_tasks INT DEFAULT 0 COMMENT 'å¤±è´¥ä»»åŠ¡æ•°',
  total_data_processed BIGINT DEFAULT 0 COMMENT 'æ€»å¤„ç†æ•°æ®é‡',
  avg_duration_seconds DECIMAL(10,2) DEFAULT 0 COMMENT 'å¹³å‡æ‰§è¡Œæ—¶é•¿(ç§’)',
  create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (id),
  UNIQUE KEY uk_metric_date_system_type_task_type (metric_date, system_type, task_type),
  KEY idx_metric_date (metric_date),
  KEY idx_system_type (system_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é›†æˆç»Ÿè®¡æŒ‡æ ‡è¡¨';

-- æ’å…¥åˆå§‹åŒ–æ•°æ®
INSERT INTO integration_data_source (id, system_name, system_type, environment, connection_params, conn_status, create_by) VALUES
('ds_internal_identity_001', 'IOE-DREAMèº«ä»½æœåŠ¡', 'INTERNAL_IDENTITY', 'PROD', '{"apiUrl":"http://localhost:8082/api/v1","apiKey":"internal-api-key"}', 'CONNECTED_SUCCESS', 'system'),
('ds_u8_erp_001', 'ç”¨å‹U8 ERPç³»ç»Ÿ', 'ERP_U8', 'PROD', '{"apiUrl":"http://u8-server:8080/api","database":"ufdata_001","username":"admin","password":"encrypted_password"}', 'CONNECTED_SUCCESS', 'admin');
```

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. **ä¼ä¸šçº§æ¶æ„**
   - ä¸¥æ ¼éµå¾ªIOE-DREAMå››å±‚æ¶æ„è§„èŒƒ
   - åŸºäºSpring Boot 3.5 + Spring Cloud 2023å¾®æœåŠ¡æ¶æ„
   - 100%ç¬¦åˆJakarta EE 3.0+åŒ…åè§„èŒƒ

2. **é«˜æ€§èƒ½è®¾è®¡**
   - å¤šçº§ç¼“å­˜æ¶æ„ï¼ˆL1æœ¬åœ° + L2Redis + L3ç½‘å…³ï¼‰
   - SAGAåˆ†å¸ƒå¼äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
   - å¼‚æ­¥ä»»åŠ¡å¤„ç† + æ‰¹é‡æ•°æ®æ“ä½œ

3. **æ’ä»¶åŒ–æ‰©å±•**
   - åŸºäºSPIæœºåˆ¶çš„æ’ä»¶ç³»ç»Ÿ
   - æ”¯æŒ15+ç§ç¬¬ä¸‰æ–¹ç³»ç»Ÿå¿«é€Ÿæ¥å…¥
   - æ¾è€¦åˆæ¶æ„ï¼Œæ˜“äºæ‰©å±•æ–°ç³»ç»Ÿ

4. **ä¼ä¸šçº§ç‰¹æ€§**
   - å®Œæ•´çš„ç›‘æ§å‘Šè­¦ä½“ç³»ï¼ˆPrometheus + Grafanaï¼‰
   - åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼ˆQuartz + Nacosï¼‰
   - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### æŠ€æœ¯äº®ç‚¹

| ç‰¹æ€§ | å®ç°æ–¹å¼ | ä¼˜åŠ¿ |
|------|---------|------|
| **å¾®æœåŠ¡æ¶æ„** | Spring Boot 3.5 + Spring Cloud | é«˜å¯ç”¨ã€æ˜“æ‰©å±• |
| **æ•°æ®åŒæ­¥** | SAGAäº‹åŠ¡ + å¤šçº§ç¼“å­˜ | æ•°æ®ä¸€è‡´æ€§ä¿è¯ |
| **æ’ä»¶æœºåˆ¶** | SPI + AutoService | çƒ­æ’æ‹”ã€æ˜“æ‰©å±• |
| **ä»»åŠ¡è°ƒåº¦** | Quartz + Nacosé›†ç¾¤ | é«˜å¯é ã€åˆ†å¸ƒå¼ |
| **ç›‘æ§ä½“ç³»** | Micrometer + Prometheus | å®æ—¶ç›‘æ§ã€å‘Šè­¦ |

### åº”ç”¨ä»·å€¼

- **æ•°æ®å­¤å²›æ‰“é€š**ï¼šè¿æ¥ä¼ä¸šå„ä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œå®ç°æ•°æ®æµé€š
- **ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–**ï¼šå‡å°‘äººå·¥æ“ä½œï¼Œæé«˜å·¥ä½œæ•ˆç‡
- **æ•°æ®ä¸€è‡´æ€§ä¿è¯**ï¼šç¡®ä¿å„ç³»ç»Ÿé—´æ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§
- **å®æ—¶ç›‘æ§å‘Šè­¦**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†é›†æˆå¼‚å¸¸
- **ä¼ä¸šçº§å¯é æ€§**ï¼šæ”¯æŒå¤§è§„æ¨¡ã€é«˜å¹¶å‘çš„æ•°æ®é›†æˆéœ€æ±‚

**è¯¥é›†æˆæ–¹æ¡ˆä¸ºIOE-DREAMæ™ºèƒ½ç®¡ç†ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆèƒ½åŠ›ï¼Œæ”¯æŒä¼ä¸šå¿«é€Ÿæ„å»ºæ•°å­—åŒ–çš„ä¸šåŠ¡ç”Ÿæ€ã€‚**

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-02
**é€‚ç”¨ç‰ˆæœ¬**: IOE-DREAM v2.0.0
**æŠ€æœ¯æ ˆ**: Spring Boot 3.5 + Spring Cloud 2023 + Jakarta EE 3.0+

---

*æœ¬æ–‡æ¡£åŸºäºLinkUpæ•°æ®å¯¹æ¥æµç¨‹åˆ†æï¼Œç»“åˆIOE-DREAMé¡¹ç›®æŠ€æœ¯æ ˆå’Œæ¶æ„è§„èŒƒï¼Œæä¾›äº†å®Œæ•´çš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆå®ç°æ–¹æ¡ˆã€‚*