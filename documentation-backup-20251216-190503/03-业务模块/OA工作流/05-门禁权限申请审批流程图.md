# é—¨ç¦æƒé™ç”³è¯·å®¡æ‰¹æµç¨‹å›¾

## ğŸ“‹ æµç¨‹æ¦‚è¿°

é—¨ç¦æƒé™ç”³è¯·å®¡æ‰¹æµç¨‹æ˜¯IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°ä¸­çš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹ä¹‹ä¸€ï¼Œç”¨äºå‘˜å·¥ã€è®¿å®¢ç­‰ç”¨æˆ·ç”³è¯·ç‰¹å®šåŒºåŸŸæˆ–è®¾å¤‡çš„é—¨ç¦è®¿é—®æƒé™ã€‚è¯¥æµç¨‹é€šè¿‡OAå·¥ä½œæµå¼•æ“ä¸é—¨ç¦ç®¡ç†ç³»ç»Ÿæ·±åº¦é›†æˆï¼Œå®ç°æƒé™ç”³è¯·ã€å®¡æ‰¹ã€æˆæƒã€ç›‘æ§çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

### ğŸ¯ ä¸šåŠ¡ç›®æ ‡

- **å®‰å…¨ç®¡æ§**: ç¡®ä¿åªæœ‰æˆæƒäººå‘˜æ‰èƒ½è®¿é—®ç‰¹å®šåŒºåŸŸ
- **æµç¨‹è§„èŒƒ**: å»ºç«‹æ ‡å‡†åŒ–çš„æƒé™ç”³è¯·å’Œå®¡æ‰¹æµç¨‹
- **æ•ˆç‡æå‡**: ç®€åŒ–æƒé™ç”³è¯·æµç¨‹ï¼Œæé«˜å®¡æ‰¹æ•ˆç‡
- **å®¡è®¡è¿½æº¯**: å®Œæ•´è®°å½•æƒé™ç”³è¯·å’Œå®¡æ‰¹è¿‡ç¨‹
- **é£é™©æ§åˆ¶**: å¤šçº§å®¡æ‰¹æœºåˆ¶é™ä½å®‰å…¨é£é™©

### ğŸ“Š æµç¨‹æŒ‡æ ‡

| æŒ‡æ ‡é¡¹ | ç›®æ ‡å€¼ | è¯´æ˜ |
|---------|--------|------|
| **ç”³è¯·å“åº”æ—¶é—´** | â‰¤ 2å°æ—¶ | ä»ç”³è¯·åˆ°é¦–æ¬¡å®¡æ‰¹å“åº” |
| **å®¡æ‰¹å®Œæˆæ—¶é—´** | â‰¤ 24å°æ—¶ | ä»ç”³è¯·åˆ°æœ€ç»ˆå®¡æ‰¹å®Œæˆ |
| **æˆæƒç”Ÿæ•ˆæ—¶é—´** | â‰¤ 5åˆ†é’Ÿ | å®¡æ‰¹é€šè¿‡åæƒé™ç”Ÿæ•ˆ |
| **æµç¨‹è‡ªåŠ¨åŒ–ç‡** | â‰¥ 90% | è‡ªåŠ¨åŒ–å¤„ç†æ¯”ä¾‹ |
| **ç”¨æˆ·æ»¡æ„åº¦** | â‰¥ 95% | ç”¨æˆ·ä½“éªŒè¯„åˆ† |

---

## ğŸ”„ è¯¦ç»†æµç¨‹å›¾

```mermaid
graph TD
    A[ç”¨æˆ·å‘èµ·ç”³è¯·] --> B{ç”³è¯·ç±»å‹åˆ¤æ–­}

    B -->|å‘˜å·¥ç”³è¯·| C[å‘˜å·¥æƒé™ç”³è¯·]
    B -->|è®¿å®¢ç”³è¯·| D[è®¿å®¢æƒé™ç”³è¯·]
    B -->|ä¸´æ—¶ç”³è¯·| E[ä¸´æ—¶æƒé™ç”³è¯·]

    C --> F[å¡«å†™ç”³è¯·è¡¨å•]
    D --> G[è®¿å®¢ä¿¡æ¯ç™»è®°]
    E --> H[ä¸´æ—¶äº‹ç”±è¯´æ˜]

    F --> I[é€‰æ‹©è®¿é—®åŒºåŸŸ]
    G --> J[é€‰æ‹©è®¿é—®åŒºåŸŸ]
    H --> K[é€‰æ‹©è®¿é—®åŒºåŸŸ]

    I --> L[è®¾ç½®è®¿é—®æ—¶é—´]
    J --> M[è®¾ç½®è®¿é—®æ—¶é—´]
    K --> N[è®¾ç½®è®¿é—®æ—¶é—´]

    L --> O[æäº¤ç”³è¯·]
    M --> O
    N --> O

    O --> P[è‡ªåŠ¨åˆå®¡]
    P --> Q{åˆå®¡ç»“æœ}

    Q -->|é€šè¿‡| R[åˆ†é…å®¡æ‰¹äºº]
    Q -->|ä¸é€šè¿‡| S[é©³å›ç”³è¯·]
    Q -->|éœ€è¡¥å……ææ–™| T[è¡¥å……ææ–™é€šçŸ¥]

    R --> U{æƒé™çº§åˆ«åˆ¤æ–­}

    U -->|æ™®é€šæƒé™| V[éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹]
    U -->|é‡è¦æƒé™| W[éƒ¨é—¨ä¸»ç®¡+å®‰å…¨ç®¡ç†]
    U -->|æ ¸å¿ƒæƒé™| X[å¤šéƒ¨é—¨è”åˆå®¡æ‰¹]

    V --> Y[éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹]
    W --> Z[å®‰å…¨ç®¡ç†å®¡æ‰¹]
    X --> AA[å¤šéƒ¨é—¨ä¼šç­¾]

    Y --> BB{å®¡æ‰¹ç»“æœ}
    Z --> BB
    AA --> CC{ä¼šç­¾ç»“æœ}

    BB -->|é€šè¿‡| DD[ç”Ÿæˆæƒé™æˆæƒ]
    BB -->|é©³å›| S
    BB -->|è½¬ä¸Šçº§| EE[ä¸Šçº§å®¡æ‰¹]

    CC -->|å…¨éƒ¨é€šè¿‡| DD
    CC -->|ä»»ä¸€é©³å›| S
    CC -->|éƒ¨åˆ†é€šè¿‡| FF[éƒ¨åˆ†æƒé™æˆæƒ]

    DD --> GG[åŒæ­¥åˆ°é—¨ç¦ç³»ç»Ÿ]
    FF --> GG
    EE --> GG

    GG --> HH[æƒé™ç”Ÿæ•ˆ]
    HH --> II[å‘é€é€šçŸ¥]

    II --> JJ[æƒé™ä½¿ç”¨ç›‘æ§]
    JJ --> KK[åˆ°æœŸè‡ªåŠ¨å›æ”¶]

    S --> LL[é€šçŸ¥ç”³è¯·äºº]
    T --> MM[è¡¥å……ææ–™]
    MM --> O

    style A fill:#e1f5fe
    style O fill:#fff3e0
    style DD fill:#e8f5e8
    style GG fill:#e8f5e8
    style HH fill:#e8f5e8
    style S fill:#ffebee
    style LL fill:#ffebee
```

---

## ğŸ“‹ æµç¨‹èŠ‚ç‚¹è¯¦ç»†è¯´æ˜

### 1. ç”³è¯·å‘èµ·é˜¶æ®µ

#### 1.1 ç”¨æˆ·å‘èµ·ç”³è¯·
- **è§¦å‘æ¡ä»¶**: ç”¨æˆ·éœ€è¦è®¿é—®é™åˆ¶åŒºåŸŸ
- **è¾“å…¥ä¿¡æ¯**: ç”¨æˆ·èº«ä»½è®¤è¯ä¿¡æ¯
- **å¤„ç†é€»è¾‘**:
  - éªŒè¯ç”¨æˆ·èº«ä»½
  - åˆ¤æ–­ç”³è¯·ç±»å‹ï¼ˆå‘˜å·¥/è®¿å®¢/ä¸´æ—¶ï¼‰
  - åŠ è½½å¯¹åº”ç”³è¯·è¡¨å•
- **è¾“å‡ºç»“æœ**: ç”³è¯·è¡¨å•ç•Œé¢

#### 1.2 ç”³è¯·ç±»å‹åˆ¤æ–­
| ç”³è¯·ç±»å‹ | é€‚ç”¨åœºæ™¯ | å®¡æ‰¹æµç¨‹ | æƒé™æœŸé™ |
|---------|---------|---------|---------|
| **å‘˜å·¥ç”³è¯·** | å†…éƒ¨å‘˜å·¥æ—¥å¸¸å·¥ä½œåŒºåŸŸ | éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹ | é•¿æœŸæœ‰æ•ˆ |
| **è®¿å®¢ç”³è¯·** | å¤–éƒ¨äººå‘˜è®¿é—® | å®¡æ‰¹+å®‰å…¨ç®¡ç† | æŒ‰è®¿é—®æ—¶é—´ |
| **ä¸´æ—¶ç”³è¯·** | ä¸´æ—¶æ€§è®¿é—®éœ€æ±‚ | ç®€åŒ–å®¡æ‰¹ | çŸ­æœŸæœ‰æ•ˆ |

### 2. ç”³è¯·ä¿¡æ¯å¡«å†™é˜¶æ®µ

#### 2.1 å‘˜å·¥æƒé™ç”³è¯·è¡¨å•
```json
{
  "applicantInfo": {
    "userId": "USER001",
    "userName": "å¼ ä¸‰",
    "department": "æŠ€æœ¯éƒ¨",
    "position": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
    "employeeId": "EMP2024001"
  },
  "accessRequest": {
    "targetAreas": [
      {
        "areaId": "A001",
        "areaName": "æœåŠ¡å™¨æœºæˆ¿",
        "accessLevel": "CORE",
        "reason": "è®¾å¤‡ç»´æŠ¤"
      }
    ],
    "timeRange": {
      "startDate": "2024-01-15",
      "endDate": "2024-12-31",
      "accessTimes": ["09:00-18:00"]
    },
    "specialRequirements": "éœ€è¦24å°æ—¶ç´§æ€¥è®¿é—®æƒé™"
  },
  "attachments": [
    "å·¥ä½œè¯æ˜.pdf",
    "ä¸Šçº§åŒæ„ä¹¦.pdf"
  ]
}
```

#### 2.2 è®¿å®¢æƒé™ç”³è¯·è¡¨å•
```json
{
  "visitorInfo": {
    "visitorName": "æå››",
    "idCard": "110101199001011234",
    "phone": "13800138000",
    "company": "ABCç§‘æŠ€å…¬å¸",
    "visitPurpose": "æŠ€æœ¯äº¤æµ"
  },
  "hostInfo": {
    "hostUserId": "USER002",
    "hostName": "ç‹äº”",
    "department": "æŠ€æœ¯éƒ¨"
  },
  "accessRequest": {
    "targetAreas": [
      {
        "areaId": "B001",
        "areaName": "åŠå…¬åŒºAæ ‹",
        "accessLevel": "NORMAL"
      }
    ],
    "timeRange": {
      "visitDate": "2024-01-20",
      "visitTime": "14:00-17:00"
    }
  }
}
```

### 3. è‡ªåŠ¨åˆå®¡é˜¶æ®µ

#### 3.1 åˆå®¡è§„åˆ™å¼•æ“
```java
@Component
public class AccessPermissionAutoReviewService {

    @Resource
    private AccessRuleEngine ruleEngine;

    @Resource
    private EmployeeDao employeeDao;

    @Resource
    private AreaDao areaDao;

    /**
     * æ‰§è¡Œè‡ªåŠ¨åˆå®¡
     */
    public AutoReviewResult executeAutoReview(AccessApplication application) {
        AutoReviewResult result = new AutoReviewResult();

        try {
            // 1. åŸºç¡€ä¿¡æ¯éªŒè¯
            validateBasicInfo(application, result);

            // 2. æƒé™çº§åˆ«æ£€æŸ¥
            checkAccessLevel(application, result);

            // 3. æ—¶é—´åˆç†æ€§éªŒè¯
            validateTimeRange(application, result);

            // 4. åŒºåŸŸå†²çªæ£€æŸ¥
            checkAreaConflict(application, result);

            // 5. ç”³è¯·äººèµ„è´¨éªŒè¯
            validateApplicantQualification(application, result);

            // 6. ç”Ÿæˆå®¡æ‰¹å»ºè®®
            generateApprovalSuggestion(application, result);

        } catch (Exception e) {
            result.setStatus("FAILED");
            result.setMessage("è‡ªåŠ¨åˆå®¡å¼‚å¸¸: " + e.getMessage());
        }

        return result;
    }

    private void validateBasicInfo(AccessApplication application, AutoReviewResult result) {
        if (StringUtils.isBlank(application.getApplicantId())) {
            result.addError("ç”³è¯·äººä¿¡æ¯ä¸èƒ½ä¸ºç©º");
        }

        if (CollectionUtils.isEmpty(application.getAccessAreas())) {
            result.addError("è®¿é—®åŒºåŸŸä¸èƒ½ä¸ºç©º");
        }

        if (application.getTimeRange() == null) {
            result.addError("è®¿é—®æ—¶é—´ä¸èƒ½ä¸ºç©º");
        }
    }

    private void checkAccessLevel(AccessApplication application, AutoReviewResult result) {
        for (AccessArea area : application.getAccessAreas()) {
            AreaEntity areaEntity = areaDao.selectById(area.getAreaId());

            if (areaEntity == null) {
                result.addError("è®¿é—®åŒºåŸŸä¸å­˜åœ¨: " + area.getAreaName());
                continue;
            }

            // æ£€æŸ¥ç”³è¯·æƒé™æ˜¯å¦è¶…è¿‡ç”¨æˆ·çº§åˆ«
            if (area.getRequiredAccessLevel() > getUserMaxAccessLevel(application.getApplicantId())) {
                result.addWarning("ç”³è¯·çš„æƒé™çº§åˆ«è¶…è¿‡ç”¨æˆ·å½“å‰çº§åˆ«");
            }
        }
    }

    private int getUserMaxAccessLevel(String userId) {
        EmployeeEntity employee = employeeDao.selectByUserId(userId);
        return employee != null ? employee.getAccessLevel() : 0;
    }
}
```

### 4. å®¡æ‰¹åˆ†é…é˜¶æ®µ

#### 4.1 å®¡æ‰¹äººåˆ†é…è§„åˆ™
```java
@Service
public class AccessApprovalAssignService {

    @Resource
    private EmployeeDao employeeDao;

    @Resource
    private DepartmentDao departmentDao;

    /**
     * åˆ†é…å®¡æ‰¹äºº
     */
    public List<String> assignApprovers(AccessApplication application) {
        List<String> approvers = new ArrayList<>();

        // 1. è·å–ç”³è¯·äººä¿¡æ¯
        EmployeeEntity applicant = employeeDao.selectByUserId(application.getApplicantId());

        // 2. æ ¹æ®æƒé™çº§åˆ«åˆ†é…å®¡æ‰¹äºº
        for (AccessArea area : application.getAccessAreas()) {
            List<String> areaApprovers = getApproversForArea(area, applicant);
            approvers.addAll(areaApprovers);
        }

        // 3. å»é‡å¹¶æ’åº
        return approvers.stream()
            .distinct()
            .sorted(this::compareApproverLevel)
            .collect(Collectors.toList());
    }

    private List<String> getApproversForArea(AccessArea area, EmployeeEntity applicant) {
        List<String> approvers = new ArrayList<>();

        switch (area.getRequiredAccessLevel()) {
            case 1: // æ™®é€šæƒé™
                // éƒ¨é—¨ä¸»ç®¡
                approvers.add(getDepartmentManager(applicant.getDepartmentId()));
                break;

            case 2: // é‡è¦æƒé™
                // éƒ¨é—¨ä¸»ç®¡ + å®‰å…¨ç®¡ç†å‘˜
                approvers.add(getDepartmentManager(applicant.getDepartmentId()));
                approvers.add(getSecurityManager());
                break;

            case 3: // æ ¸å¿ƒæƒé™
                // éƒ¨é—¨ä¸»ç®¡ + å®‰å…¨ç®¡ç†å‘˜ + åˆ†ç®¡é¢†å¯¼
                approvers.add(getDepartmentManager(applicant.getDepartmentId()));
                approvers.add(getSecurityManager());
                approvers.add(getDivisionDirector(applicant.getDepartmentId()));
                break;

            default:
                throw new IllegalArgumentException("æœªçŸ¥çš„æƒé™çº§åˆ«: " + area.getRequiredAccessLevel());
        }

        return approvers;
    }
}
```

### 5. å®¡æ‰¹æ‰§è¡Œé˜¶æ®µ

#### 5.1 å®¡æ‰¹å†³ç­–æœåŠ¡
```java
@Service
public class AccessApprovalDecisionService {

    @Resource
    private AccessApprovalAssignService assignService;

    @Resource
    private WorkflowEngine workflowEngine;

    /**
     * æ‰§è¡Œå®¡æ‰¹å†³ç­–
     */
    public ApprovalDecision executeApproval(ApprovalRequest request) {
        ApprovalDecision decision = new ApprovalDecision();

        try {
            // 1. éªŒè¯å®¡æ‰¹æƒé™
            validateApprovalPermission(request);

            // 2. è¯„ä¼°ç”³è¯·é£é™©
            RiskAssessment risk = assessApplicationRisk(request);
            decision.setRiskLevel(risk.getLevel());

            // 3. æ£€æŸ¥å†å²è®°å½•
            ApplicantHistory history = getApplicantHistory(request.getApplicantId());
            decision.setHistoryScore(history.getScore());

            // 4. ç»¼åˆå†³ç­–
            DecisionResult result = makeDecision(request, risk, history);
            decision.setResult(result);

            // 5. è®°å½•å®¡æ‰¹ç†ç”±
            decision.setReason(generateDecisionReason(request, result));

            // 6. å¤„ç†ä¼šç­¾
            if (needJointApproval(request)) {
                processJointApproval(request, decision);
            }

        } catch (Exception e) {
            decision.setResult(DecisionResult.REJECTED);
            decision.setReason("å®¡æ‰¹å¤„ç†å¼‚å¸¸: " + e.getMessage());
        }

        return decision;
    }

    private RiskAssessment assessApplicationRisk(ApprovalRequest request) {
        RiskAssessment assessment = new RiskAssessment();

        // é£é™©å› å­è¯„ä¼°
        int riskScore = 0;

        // 1. æ—¶é—´é£é™©
        if (isAfterHours(request.getTimeRange())) {
            riskScore += 10;
        }

        // 2. åŒºåŸŸé£é™©
        for (AccessArea area : request.getAccessAreas()) {
            riskScore += getAreaRiskScore(area.getAreaId());
        }

        // 3. ç”³è¯·äººé£é™©
        riskScore += getApplicantRiskScore(request.getApplicantId());

        // 4. å†å²é£é™©
        riskScore += getHistoricalRiskScore(request.getApplicantId());

        assessment.setScore(riskScore);

        if (riskScore >= 80) {
            assessment.setLevel(RiskLevel.HIGH);
        } else if (riskScore >= 50) {
            assessment.setLevel(RiskLevel.MEDIUM);
        } else {
            assessment.setLevel(RiskLevel.LOW);
        }

        return assessment;
    }
}
```

### 6. æƒé™æˆæƒé˜¶æ®µ

#### 6.1 æƒé™ç”Ÿæˆå’ŒåŒæ­¥æœåŠ¡
```java
@Service
public class AccessPermissionService {

    @Resource
    private AccessControlSystemClient accessControlClient;

    @Resource
    private PermissionDao permissionDao;

    /**
     * ç”Ÿæˆæƒé™æˆæƒ
     */
    public PermissionAuthorization generateAuthorization(ApprovedApplication application) {
        PermissionAuthorization authorization = new PermissionAuthorization();

        try {
            // 1. ç”Ÿæˆæˆæƒå‡­è¯
            String authCredential = generateAuthCredential(application);
            authorization.setCredential(authCredential);

            // 2. è®¾ç½®æƒé™èŒƒå›´
            authorization.setAccessAreas(application.getAccessAreas());
            authorization.setTimeRange(application.getTimeRange());

            // 3. æƒé™åŠ å¯†
            String encryptedAuth = encryptAuthorization(authorization);
            authorization.setEncryptedCredential(encryptedAuth);

            // 4. åŒæ­¥åˆ°é—¨ç¦ç³»ç»Ÿ
            syncToAccessControlSystem(authorization);

            // 5. ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
            saveAuthorization(authorization);

            // 6. è®¾ç½®ç”Ÿæ•ˆæ—¶é—´
            authorization.setEffectiveTime(LocalDateTime.now());

        } catch (Exception e) {
            throw new RuntimeException("æƒé™æˆæƒç”Ÿæˆå¤±è´¥", e);
        }

        return authorization;
    }

    private void syncToAccessControlSystem(PermissionAuthorization authorization) {
        AccessControlRequest request = AccessControlRequest.builder()
            .userId(authorization.getUserId())
            .credential(authorization.getCredential())
            .accessAreas(authorization.getAccessAreas())
            .validFrom(authorization.getTimeRange().getStart())
            .validTo(authorization.getTimeRange().getEnd())
            .build();

        // è°ƒç”¨é—¨ç¦ç³»ç»ŸAPI
        AccessControlResponse response = accessControlClient.grantAccess(request);

        if (!response.isSuccess()) {
            throw new RuntimeException("é—¨ç¦ç³»ç»Ÿæˆæƒå¤±è´¥: " + response.getErrorMessage());
        }
    }

    @Scheduled(cron = "0 0/5 * * * ?")
    public void checkAuthorizationStatus() {
        // å®šæœŸæ£€æŸ¥æˆæƒçŠ¶æ€
        List<PermissionAuthorization> expiringSoon = findExpiringSoon();

        for (PermissionAuthorization auth : expiringSoon) {
            // å‘é€åˆ°æœŸæé†’
            sendExpiryNotification(auth);
        }
    }
}
```

### 7. ç›‘æ§å’Œå›æ”¶é˜¶æ®µ

#### 7.1 æƒé™ç›‘æ§æœåŠ¡
```java
@Service
public class AccessMonitoringService {

    @Resource
    private AccessControlSystemClient accessControlClient;

    @Resource
    private AlertService alertService;

    /**
     * ç›‘æ§æƒé™ä½¿ç”¨æƒ…å†µ
     */
    @EventListener
    @Async
    public void monitorAccessUsage(AccessEvent event) {
        try {
            // 1. è®°å½•è®¿é—®æ—¥å¿—
            logAccessEvent(event);

            // 2. å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
            detectAbnormalBehavior(event);

            // 3. æƒé™ä½¿ç”¨ç»Ÿè®¡
            updateUsageStatistics(event);

            // 4. å®‰å…¨é£é™©è¯„ä¼°
            assessSecurityRisk(event);

        } catch (Exception e) {
            log.error("æƒé™ç›‘æ§å¼‚å¸¸", e);
        }
    }

    private void detectAbnormalBehavior(AccessEvent event) {
        // æ£€æµ‹å¼‚å¸¸è®¿é—®æ¨¡å¼
        if (isAbnormalTime(event.getAccessTime())) {
            alertService.sendAbnormalAccessAlert(event, "éæ­£å¸¸æ—¶é—´è®¿é—®");
        }

        if (isFrequentAccess(event.getUserId(), event.getAccessTime())) {
            alertService.sendAbnormalAccessAlert(event, "é¢‘ç¹è®¿é—®å¼‚å¸¸");
        }

        if (isUnauthorizedArea(event.getUserId(), event.getAreaId())) {
            alertService.sendSecurityAlert(event, "æœªæˆæƒåŒºåŸŸè®¿é—®å°è¯•");
        }
    }

    @Scheduled(cron = "0 0 2 * * ?")
    public void autoRevokeExpiredPermissions() {
        // è‡ªåŠ¨å›æ”¶è¿‡æœŸæƒé™
        List<PermissionAuthorization> expired = findExpiredPermissions();

        for (PermissionAuthorization auth : expired) {
            revokePermission(auth, "æƒé™è¿‡æœŸè‡ªåŠ¨å›æ”¶");
        }
    }
}
```

---

## ğŸ“± ç§»åŠ¨ç«¯å®¡æ‰¹æµç¨‹

### ç§»åŠ¨ç«¯ç•Œé¢è®¾è®¡
```vue
<template>
  <div class="access-approval-mobile">
    <van-nav-bar
      title="é—¨ç¦æƒé™ç”³è¯·"
      left-arrow
      @click-left="$router.go(-1)"
    />

    <!-- ç”³è¯·è¡¨å• -->
    <div class="application-form">
      <van-cell-group>
        <van-field
          v-model="formData.applicantName"
          label="ç”³è¯·äºº"
          readonly
        />

        <van-field
          v-model="formData.department"
          label="éƒ¨é—¨"
          readonly
        />

        <van-field
          label="è®¿é—®åŒºåŸŸ"
          readonly
          :value="selectedAreasText"
          @click="showAreaPicker = true"
        />

        <van-field
          label="è®¿é—®æ—¶é—´"
          readonly
          :value="timeRangeText"
          @click="showTimePicker = true"
        />

        <van-field
          v-model="formData.reason"
          label="ç”³è¯·åŸå› "
          type="textarea"
          placeholder="è¯·è¯¦ç»†è¯´æ˜ç”³è¯·åŸå› "
        />
      </van-cell-group>

      <!-- é™„ä»¶ä¸Šä¼  -->
      <van-cell-group title="ç›¸å…³é™„ä»¶">
        <van-uploader
          v-model="attachments"
          :after-read="handleAttachmentUpload"
          :max-count="5"
        />
      </van-cell-group>
    </div>

    <!-- åŒºåŸŸé€‰æ‹©å™¨ -->
    <van-popup v-model="showAreaPicker" position="bottom">
      <van-area
        :area-list="areaList"
        @confirm="onAreaConfirm"
        @cancel="showAreaPicker = false"
      />
    </van-popup>

    <!-- æ—¶é—´é€‰æ‹©å™¨ -->
    <van-popup v-model="showTimePicker" position="bottom">
      <van-datetime-picker
        v-model="selectedTime"
        type="datetime"
        @confirm="onTimeConfirm"
        @cancel="showTimePicker = false"
      />
    </van-popup>

    <!-- æäº¤æŒ‰é’® -->
    <div class="submit-section">
      <van-button
        type="primary"
        block
        :loading="submitting"
        @click="submitApplication"
      >
        æäº¤ç”³è¯·
      </van-button>
    </div>
  </div>
</template>

<script>
export default {
  name: 'AccessApprovalMobile',

  data() {
    return {
      formData: {
        applicantName: '',
        department: '',
        reason: ''
      },
      selectedAreas: [],
      selectedTime: null,
      attachments: [],
      showAreaPicker: false,
      showTimePicker: false,
      submitting: false
    }
  },

  computed: {
    selectedAreasText() {
      return this.selectedAreas.map(area => area.name).join(', ');
    },

    timeRangeText() {
      return this.selectedTime ? this.$dayjs(this.selectedTime).format('YYYY-MM-DD HH:mm') : '';
    }
  },

  async created() {
    await this.loadUserInfo();
    await this.loadAreaList();
  },

  methods: {
    async submitApplication() {
      if (!this.validateForm()) {
        return;
      }

      this.submitting = true;

      try {
        const application = {
          applicantId: this.$store.state.user.userId,
          accessAreas: this.selectedAreas,
          timeRange: {
            start: this.selectedTime,
            end: this.getEndTime()
          },
          reason: this.formData.reason,
          attachments: this.attachments
        };

        const response = await this.$http.post('/api/access/permission/apply', application);

        this.$toast.success('ç”³è¯·æäº¤æˆåŠŸ');
        this.$router.push('/access/approval/status/' + response.data.applicationId);

      } catch (error) {
        this.$toast.fail('æäº¤å¤±è´¥: ' + error.message);
      } finally {
        this.submitting = false;
      }
    },

    validateForm() {
      if (this.selectedAreas.length === 0) {
        this.$toast('è¯·é€‰æ‹©è®¿é—®åŒºåŸŸ');
        return false;
      }

      if (!this.selectedTime) {
        this.$toast('è¯·é€‰æ‹©è®¿é—®æ—¶é—´');
        return false;
      }

      if (!this.formData.reason.trim()) {
        this.$toast('è¯·å¡«å†™ç”³è¯·åŸå› ');
        return false;
      }

      return true;
    }
  }
}
</script>
```

---

## ğŸ”§ æŠ€æœ¯å®ç°æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾
```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[Webç®¡ç†ç«¯]
        B[ç§»åŠ¨å®¡æ‰¹ç«¯]
        C[é’‰é’‰å°ç¨‹åº]
    end

    subgraph "APIç½‘å…³å±‚"
        D[API Gateway]
        E[è®¤è¯æœåŠ¡]
        F[æƒé™æœåŠ¡]
    end

    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        G[OAå·¥ä½œæµæœåŠ¡]
        H[é—¨ç¦ç®¡ç†æœåŠ¡]
        I[å®¡æ‰¹æµç¨‹æœåŠ¡]
        J[æƒé™ç®¡ç†æœåŠ¡]
    end

    subgraph "å·¥ä½œæµå¼•æ“å±‚"
        K[Flowableå¼•æ“]
        L[è§„åˆ™å¼•æ“]
        M[å®¡æ‰¹å¼•æ“]
    end

    subgraph "æ•°æ®å±‚"
        N[MySQLæ•°æ®åº“]
        O[Redisç¼“å­˜]
        P[æ¶ˆæ¯é˜Ÿåˆ—]
    end

    subgraph "å¤–éƒ¨ç³»ç»Ÿ"
        Q[é—¨ç¦æ§åˆ¶å™¨]
        R[ç”Ÿç‰©è¯†åˆ«è®¾å¤‡]
        S[ç›‘æ§ç³»ç»Ÿ]
    end

    A --> D
    B --> D
    C --> D

    D --> E
    D --> F
    D --> G
    D --> H

    G --> I
    G --> J
    H --> I
    H --> J

    I --> K
    I --> L
    I --> M

    J --> N
    K --> N
    L --> N
    M --> N

    G --> O
    H --> O
    I --> P
    J --> P

    H --> Q
    H --> R
    I --> S
```

### æ ¸å¿ƒç»„ä»¶ä¾èµ–
```xml
<!-- pom.xml æ ¸å¿ƒä¾èµ– -->
<dependencies>
    <!-- å·¥ä½œæµå¼•æ“ -->
    <dependency>
        <groupId>org.flowable</groupId>
        <artifactId>flowable-spring-boot-starter</artifactId>
        <version>7.0.1</version>
    </dependency>

    <!-- è§„åˆ™å¼•æ“ -->
    <dependency>
        <groupId>org.drools</groupId>
        <artifactId>drools-core</artifactId>
        <version>8.44.0.Final</version>
    </dependency>

    <!-- æƒé™ç®¡ç† -->
    <dependency>
        <groupId>org.springframework.security</groupId>
        <artifactId>spring-security-core</artifactId>
    </dependency>

    <!-- æ•°æ®åº“è¿æ¥æ±  -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid-spring-boot-starter</artifactId>
        <version>1.2.20</version>
    </dependency>

    <!-- Redisç¼“å­˜ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>

    <!-- æ¶ˆæ¯é˜Ÿåˆ— -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-amqp</artifactId>
    </dependency>
</dependencies>
```

---

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### å…³é”®æ€§èƒ½æŒ‡æ ‡(KPI)
```java
@Component
public class AccessApprovalMetrics {

    @Resource
    private MeterRegistry meterRegistry;

    // ç”³è¯·æ•°é‡ç»Ÿè®¡
    public void recordApplication(String type) {
        meterRegistry.counter("access.applications",
            "type", type
        ).increment();
    }

    // å®¡æ‰¹æ—¶é—´ç»Ÿè®¡
    public void recordApprovalTime(String level, Duration duration) {
        meterRegistry.timer("access.approval.duration",
            "level", level
        ).record(duration);
    }

    // æƒé™ä½¿ç”¨ç»Ÿè®¡
    public void recordAccessUsage(String areaId) {
        meterRegistry.counter("access.usage",
            "area", areaId
        ).increment();
    }

    // å¼‚å¸¸è¡Œä¸ºç»Ÿè®¡
    public void recordAbnormalBehavior(String type) {
        meterRegistry.counter("access.abnormal",
            "type", type
        ).increment();
    }
}
```

### å®æ—¶ç›‘æ§é¢æ¿
```json
{
  "dashboard": {
    "title": "é—¨ç¦æƒé™å®¡æ‰¹ç›‘æ§",
    "panels": [
      {
        "title": "ç”³è¯·è¶‹åŠ¿",
        "type": "line-chart",
        "metrics": [
          "access.applications",
          "access.approvals.completed"
        ]
      },
      {
        "title": "å®¡æ‰¹æ•ˆç‡",
        "type": "gauge",
        "metrics": [
          "access.approval.duration"
        ]
      },
      {
        "title": "å¼‚å¸¸å‘Šè­¦",
        "type": "table",
        "metrics": [
          "access.abnormal"
        ]
      }
    ]
  }
}
```

---

## ğŸ“‹ ä¸šåŠ¡è§„åˆ™é…ç½®

### å®¡æ‰¹è§„åˆ™çŸ©é˜µ
```java
@Configuration
public class AccessApprovalRules {

    /**
     * æƒé™çº§åˆ«å¯¹åº”å®¡æ‰¹è§„åˆ™
     */
    public static final Map<Integer, ApprovalRule> APPROVAL_RULES = Map.of(
        1, new ApprovalRule("NORMAL", Arrays.asList("DEPARTMENT_MANAGER"), 1),
        2, new ApprovalRule("IMPORTANT", Arrays.asList("DEPARTMENT_MANAGER", "SECURITY_MANAGER"), 2),
        3, new ApprovalRule("CRITICAL", Arrays.asList("DEPARTMENT_MANAGER", "SECURITY_MANAGER", "DIVISION_DIRECTOR"), 3)
    );

    /**
     * æ—¶é—´é™åˆ¶è§„åˆ™
     */
    public static final Map<String, TimeRestriction> TIME_RESTRICTIONS = Map.of(
        "SERVER_ROOM", new TimeRestriction("08:00-18:00", false),
        "DATA_CENTER", new TimeRestriction("06:00-22:00", true),
        "LAB_AREA", new TimeRestriction("09:00-21:00", false)
    );

    /**
     * åŒºåŸŸäº’æ–¥è§„åˆ™
     */
    public static final Map<String, List<String>> MUTUALLY_EXCLUSIVE_AREAS = Map.of(
        "FINANCE_AREA", Arrays.asList("IT_SERVER_ROOM"),
        "RESEARCH_AREA", Arrays.asList("PUBLIC_AREA")
    );
}
```

---

## ğŸ¯ æ€»ç»“

é—¨ç¦æƒé™ç”³è¯·å®¡æ‰¹æµç¨‹æ˜¯IOE-DREAMæ™ºæ…§å›­åŒºå®‰å…¨ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œé€šè¿‡ï¼š

1. **æ™ºèƒ½åŒ–åˆå®¡** - è‡ªåŠ¨éªŒè¯ç”³è¯·ä¿¡æ¯ï¼Œæé«˜å®¡æ‰¹æ•ˆç‡
2. **åˆ†çº§å®¡æ‰¹** - æ ¹æ®æƒé™çº§åˆ«åˆ†é…ä¸åŒå®¡æ‰¹äºº
3. **å…¨ç¨‹ç›‘æ§** - æƒé™ä½¿ç”¨å…¨ç”Ÿå‘½å‘¨æœŸç›‘æ§
4. **è‡ªåŠ¨å›æ”¶** - æƒé™åˆ°æœŸè‡ªåŠ¨å›æ”¶ï¼Œä¿éšœå®‰å…¨
5. **ç§»åŠ¨å®¡æ‰¹** - æ”¯æŒç§»åŠ¨ç«¯å®¡æ‰¹ï¼Œæé«˜å“åº”é€Ÿåº¦

è¯¥æµç¨‹ç¡®ä¿äº†å›­åŒºé—¨ç¦å®‰å…¨ç®¡ç†çš„è§„èŒƒåŒ–ã€è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–ï¼Œä¸ºæ™ºæ…§å›­åŒºå»ºè®¾æä¾›äº†åšå®çš„å®‰å…¨ä¿éšœã€‚

---

**æµç¨‹å›¾çŠ¶æ€**: âœ… å·²å®Œæˆ
**é€‚ç”¨ç‰ˆæœ¬**: IOE-DREAM v2.0.0+
**ç»´æŠ¤è´£ä»»äºº**: å®‰å…¨ç®¡ç†å›¢é˜Ÿ + OAå·¥ä½œæµå›¢é˜Ÿ
**æœ€åå®¡æ ¸**: 2025-12-16