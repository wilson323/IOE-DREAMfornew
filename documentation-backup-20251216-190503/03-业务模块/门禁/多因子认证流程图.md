# 多因子认证流程图

## 流程概述

多因子认证（MFA）是IOE-DREAM智慧园区一卡通管理平台的核心安全功能，通过结合多种身份验证方式，确保门禁系统的安全性，满足国家三级等保要求。

## 核心流程图

### 1. 多因子认证主流程

```mermaid
flowchart TD
    A[用户身份验证请求] --> B{验证因子类型配置}
    B -->|人脸+指纹+卡片| C[三因子认证流程]
    B -->|人脸+卡片| D[双因子认证流程]
    B -->|单因子| E[单因子认证流程]

    C --> F{第一因子验证：人脸识别}
    F -->|成功| G{第二因子验证：指纹识别}
    F -->|失败| H[认证失败记录]
    G -->|成功| I{第三因子验证：IC卡验证}
    G -->|失败| H
    I -->|成功| J[认证成功]
    I -->|失败| H
    D --> K{第一因子验证：人脸识别}
    K -->|成功| L{第二因子验证：IC卡验证}
    K -->|失败| H
    L -->|成功| J
    L -->|失败| H
    E --> M{单因子验证}
    M -->|成功| J
    M -->|失败| H
```

### 2. 人脸识别详细流程

```mermaid
flowchart TD
    A[人脸识别请求] --> B[摄像头图像采集]
    B --> C[图像质量检测]
    C -->|质量合格| D[人脸检测]
    C -->|质量不合格| E[提示重新采集]

    D -->|检测到人脸| F[人脸对齐]
    F --> G[人脸特征提取]
    G --> H[活体检测]

    H -->|通过活体检测| I[特征比对]
    H -->|活体检测失败| J[拒绝访问]

    I --> K[与注册特征库比对]
    K -->|匹配度≥90%| L[认证成功]
    K -->|匹配度<90%| M[认证失败]

    E --> B
    J --> N[记录失败日志]
    M --> N
    L --> O[更新访问记录]
```

### 3. 指纹识别详细流程

```mermaid
flowchart TD
    A[指纹识别请求] --> B[指纹采集]
    B --> C[指纹质量检测]
    C -->|质量合格| D[指纹特征提取]
    C -->|质量不合格| E[提示重新采集]

    D --> F[活体指纹检测]
    F -->|活体检测通过| G[特征比对]
    F -->|活体检测失败| H[认证失败]

    G --> I[与注册指纹库比对]
    I -->|匹配成功| J[认证成功]
    I -->|匹配失败| K[认证失败]

    E --> B
    H --> L[记录失败日志]
    K --> L
    J --> M[更新访问记录]
```

### 4. IC卡验证详细流程

```mermaid
flowchart TD
    A[IC卡验证请求] --> B[读卡器读取卡片]
    B --> C[卡片有效性检查]

    C -->|卡片有效| D[卡片信息解析]
    C -->|卡片无效| E[认证失败]

    D --> F{卡片类型验证}
    F -->|员工卡| G[员工信息验证]
    F -->|访客卡| H[访客信息验证]
    F -->|临时卡| I[临时卡验证]

    G -->|信息有效| J[认证成功]
    G -->|信息无效| E

    H -->|信息有效| J
    H -->|信息无效| E

    I -->|时间有效| J
    I -->|时间过期| E

    E --> K[记录失败日志]
    J --> L[更新访问记录]
```

### 5. 活体检测流程

```mermaid
flowchart TD
    A[活体检测请求] --> B[多模态活体检测]

    B --> C[眨眼检测]
    C -->|检测通过| D[头部运动检测]
    C -->|检测失败| E[判断为照片攻击]

    D -->|检测通过| F[3D深度检测]
    D -->|检测失败| G[判断为视频攻击]

    F -->|检测通过| H[红外检测]
    F -->|检测失败| I[判断为面具攻击]

    H -->|检测通过| J[活体检测通过]
    H -->|检测失败| K[判断为假体攻击]

    E --> L[活体检测失败]
    G --> L
    I --> L
    K --> L

    J --> M[继续认证流程]
    L --> N[拒绝访问]
```

### 6. 认证失败处理流程

```mermaid
flowchart TD
    A[认证失败] --> B{失败次数检查}

    B -->|首次失败| C[记录失败日志]
    B -->|连续失败3次| D[触发临时锁定]
    B -->|连续失败5次| E[触发永久锁定]

    C --> F[提示用户重试]
    D --> G[发送告警通知]
    E --> H[发送安全告警]

    F --> I[等待下次验证]
    G --> J[临时锁定30分钟]
    H --> K[永久锁定需管理员解锁]

    I --> L[重新开始认证]
    J --> M[锁定到期后自动解锁]
    K --> N[管理员审核解锁]

    M --> L
    N --> O[解锁成功后恢复]
    O --> L
```

### 7. 认证成功处理流程

```mermaid
flowchart TD
    A[认证成功] --> B[更新用户状态]
    B --> C[记录访问日志]
    C --> D[更新设备状态]
    D --> E[发送开门指令]

    E --> F[设备执行开门]
    F -->|开门成功| G[记录开门成功]
    F -->|开门失败| H[记录开门失败]

    G --> I[更新访问统计]
    H --> J[触发设备告警]

    I --> K[发送访问通知]
    J --> L[发送故障通知]

    K --> M[访问完成]
    L --> N[设备维修处理]

    M --> O[结束认证流程]
    N --> O
```

## 安全策略

### 认证策略配置

1. **默认策略**：人脸识别 + IC卡验证
2. **高安全区域**：人脸识别 + 指纹识别 + IC卡验证
3. **普通区域**：人脸识别或IC卡验证
4. **紧急情况**：单一快速验证方式

### 风险控制措施

1. **连续失败锁定**：连续3次失败临时锁定30分钟
2. **高风险锁定**：连续5次失败永久锁定
3. **异常行为监控**：实时监控异常认证行为
4. **安全审计**：完整的认证过程审计日志

### 性能优化

1. **并行验证**：多因子可并行验证提高效率
2. **本地缓存**：常用特征本地缓存减少网络请求
3. **预加载**：常用用户特征预加载
4. **降级策略**：网络异常时的降级验证方案

## 系统集成

### 门禁设备集成

- **人脸识别终端**：支持多厂商设备接入
- **指纹识别器**：支持多种指纹技术
- **IC卡读卡器**：支持多种卡类型
- **门禁控制器**：标准协议对接

### 监控系统集成

- **实时监控**：认证过程视频联动
- **录像存储**：异常事件自动录像
- **告警推送**：安全事件实时告警
- **数据分析**：认证行为数据分析

### 第三方系统集成

- **HR系统**：员工信息同步
- **访客系统**：访客信息验证
- **安防系统**：统一安防管理
- **OA系统**：访问记录同步

## 业务价值

### 安全价值

1. **多重保护**：多因子验证提供多重安全保护
2. **防伪能力**：活体检测有效防止身份伪造
3. **审计能力**：完整的认证过程可追溯
4. **风险控制**：智能风险识别和控制

### 业务价值

1. **提高安全性**：显著提升园区安全水平
2. **提升体验**：无感认证提升用户体验
3. **降低风险**：减少安全事故风险
4. **合规要求**：满足等保合规要求

---

**文档版本**: v1.0.0
**创建日期**: 2025-12-16
**负责人**: IOE-DREAM架构团队
**审核人**: 安全团队、产品团队