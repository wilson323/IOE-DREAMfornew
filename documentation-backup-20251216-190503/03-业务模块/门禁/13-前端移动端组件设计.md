# é—¨ç¦æ¨¡å—å‰ç«¯ç§»åŠ¨ç«¯ç»„ä»¶è®¾è®¡

## ğŸ“± ç§»åŠ¨ç«¯æ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆé€‰æ‹©
- **å‰ç«¯æ¡†æ¶**: Vue 3 + TypeScript
- **ç§»åŠ¨ç«¯æ¡†æ¶**: Vant 4
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±ç®¡ç†**: Vue Router 4
- **HTTPå®¢æˆ·ç«¯**: Axios
- **WebSocket**: Socket.io-client
- **UIç»„ä»¶**: Vant 4 + è‡ªå®šä¹‰ç»„ä»¶
- **æ„å»ºå·¥å…·**: Vite
- **åŒ…ç®¡ç†**: npm/yarn

### é¡¹ç›®ç»“æ„
```
src/
â”œâ”€â”€ components/           # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ common/           # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ mobile/           # ç§»åŠ¨ç«¯ä¸“ç”¨ç»„ä»¶
â”‚   â””â”€â”€ access/           # é—¨ç¦ä¸“ç”¨ç»„ä»¶
â”œâ”€â”€ views/               # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ AccessMonitor/    # å®æ—¶ç›‘æ§
â”‚   â”œâ”€â”€ DeviceManage/     # è®¾å¤‡ç®¡ç†
â”‚   â”œâ”€â”€ AccessRecords/    # è®¿é—®è®°å½•
â”‚   â”œâ”€â”€ Approval/         # å®¡æ‰¹æµç¨‹
â”‚   â””â”€â”€ SystemConfig/     # ç³»ç»Ÿé…ç½®
â”œâ”€â”€ store/               # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ api/                 # APIæ¥å£
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â””â”€â”€ assets/              # é™æ€èµ„æº
```

## ğŸ¯ æ ¸å¿ƒé¡µé¢è®¾è®¡

### 1. å®æ—¶ç›‘æ§é¡µé¢ (AccessMonitor)

#### é¡µé¢å¸ƒå±€
```vue
<template>
  <div class="access-monitor">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <van-nav-bar
      title="é—¨ç¦ç›‘æ§"
      :fixed="true"
      :placeholder="false"
    >
      <template #right>
        <van-icon name="bell" @click="showAlerts" :badge="alertCount" />
      </template>
    </van-nav-bar>

    <!-- è®¾å¤‡çŠ¶æ€æ¦‚è§ˆ -->
    <div class="status-overview">
      <van-grid :column-num="2" :gutter="10">
        <van-grid-item v-for="item in statusData" :key="item.type">
          <div class="status-item">
            <div class="status-icon" :class="item.type">
              <van-icon :name="item.icon" />
            </div>
            <div class="status-info">
              <div class="status-value">{{ item.value }}</div>
              <div class="status-label">{{ item.label }}</div>
            </div>
          </div>
        </van-grid-item>
      </van-grid>
    </div>

    <!-- å®æ—¶ç›‘æ§åˆ—è¡¨ -->
    <div class="monitor-list">
      <van-list
        v-model:loading="loading"
        :finished="finished"
        finished-text="æ²¡æœ‰æ›´å¤šäº†"
        @load="onLoad"
      >
        <van-cell
          v-for="device in devices"
          :key="device.deviceId"
          :title="device.deviceName"
          :label="device.status"
          :value="device.location"
          @click="showDeviceDetail(device)"
        >
          <template #extra>
            <van-tag :type="device.statusType" size="small">
              {{ device.statusText }}
            </van-tag>
          </template>
        </van-cell>
      </van-list>
    </div>

    <!-- åº•éƒ¨å¿«æ·æ“ä½œ -->
    <div class="quick-actions">
      <van-grid :column-num="4" :gutter="10">
        <van-grid-item
          v-for="action in quickActions"
          :key="action.type"
          :icon="action.icon"
          :text="action.text"
          @click="handleQuickAction(action)"
        />
      </van-grid>
    </div>
  </div>
</template>
```

#### æ ¸å¿ƒåŠŸèƒ½
- **å®æ—¶çŠ¶æ€ç›‘æ§**: æ˜¾ç¤ºè®¾å¤‡åœ¨çº¿çŠ¶æ€å’Œè®¿é—®ç»Ÿè®¡
- **å¿«æ·æ“ä½œ**: ä¸€é”®å¼€é”ã€é‡å¯è®¾å¤‡
- **å‘Šè­¦æé†’**: å®æ—¶æ¨é€å‘Šè­¦ä¿¡æ¯
- **è®¾å¤‡å®šä½**: åœ°å›¾æ˜¾ç¤ºè®¾å¤‡ä½ç½®

### 2. è®¾å¤‡ç®¡ç†é¡µé¢ (DeviceManage)

#### é¡µé¢ç»„ä»¶
```vue
<template>
  <div class="device-manage">
    <van-nav-bar title="è®¾å¤‡ç®¡ç†" :fixed="true" />

    <!-- æœç´¢ç­›é€‰ -->
    <div class="search-section">
      <van-search
        v-model="searchKeyword"
        placeholder="æœç´¢è®¾å¤‡åç§°æˆ–ID"
        @search="handleSearch"
        @cancel="handleCancel"
      />
      <van-dropdown-menu>
        <van-dropdown-item v-model="filterType" :options="deviceTypes" />
        <van-dropdown-item v-model="filterStatus" :options="deviceStatuses" />
        <van-dropdown-item v-model="filterArea" :options="areas" />
      </van-dropdown-menu>
    </div>

    <!-- è®¾å¤‡åˆ—è¡¨ -->
    <van-list
      v-model:loading="loading"
      :finished="finished"
      @load="onLoad"
    >
      <device-card
        v-for="device in devices"
        :key="device.deviceId"
        :device="device"
        @control="handleDeviceControl"
        @detail="showDeviceDetail"
        @edit="showDeviceEdit"
        @delete="handleDeviceDelete"
      />
    </van-list>

    <!-- æ·»åŠ è®¾å¤‡æŒ‰é’® -->
    <van-fab
      type="primary"
      icon="plus"
      @click="showAddDevice"
    />
  </div>
</template>
```

#### è®¾å¤‡å¡ç‰‡ç»„ä»¶
```vue
<template>
  <van-card class="device-card">
    <div class="device-header">
      <div class="device-info">
        <h3 class="device-name">{{ device.deviceName }}</h3>
        <p class="device-location">{{ device.location }}</p>
      </div>
      <van-tag :type="statusType" size="small">
        {{ statusText }}
      </van-tag>
    </div>

    <div class="device-stats">
      <div class="stat-item">
        <span class="stat-label">ä»Šæ—¥è®¿é—®</span>
        <span class="stat-value">{{ device.todayAccess }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">åœ¨çº¿æ—¶é•¿</span>
        <span class="stat-value">{{ device.onlineDuration }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ç”µæ± ç”µé‡</span>
        <span class="stat-value">{{ device.battery }}%</span>
      </div>
    </div>

    <div class="device-actions">
      <van-button
        type="primary"
        size="small"
        :disabled="!device.canUnlock"
        @click="$emit('control', device, 'unlock')"
      >
        å¼€é”
      </van-button>
      <van-button
        type="info"
        size="small"
        @click="$emit('detail', device)"
      >
        è¯¦æƒ…
      </van-button>
    </div>
  </van-card>
</template>
```

### 3. è®¿é—®è®°å½•é¡µé¢ (AccessRecords)

#### ç­›é€‰ç»„ä»¶
```vue
<template>
  <div class="filter-section">
    <van-dropdown-menu v-model:show="showFilter">
      <van-dropdown-item
        v-model="filterDateRange"
        :options="dateRangeOptions"
        title="æ—¶é—´èŒƒå›´"
      />
      <van-dropdown-item
        v-model="filterEventType"
        :options="eventTypeOptions"
        title="äº‹ä»¶ç±»å‹"
      />
      <van-dropdown-item
        v-model="filterResult"
        :options="resultOptions"
        title="è®¿é—®ç»“æœ"
      />
    </van-dropdown-menu>

    <div class="filter-tags" v-if="hasActiveFilters">
      <van-tag
        v-for="filter in activeFilters"
        :key="filter.key"
        closable
        @close="removeFilter(filter)"
      >
        {{ filter.label }}
      </van-tag>
    </div>
  </div>
</template>
```

#### è®°å½•åˆ—è¡¨ç»„ä»¶
```vue
<template>
  <div class="access-records">
    <van-list
      v-model:loading="loading"
      :finished="finished"
      @load="onLoad"
    >
      <access-record-item
        v-for="record in records"
        :key="record.eventId"
        :record="record"
        @click="showRecordDetail(record)"
      />
    </van-list>
  </div>
</template>

<template>
  <div class="record-item">
    <div class="record-header">
      <div class="user-info">
        <van-image
          :src="record.userPhoto"
          :alt="record.userName"
          class="user-avatar"
          round
        />
        <div class="user-details">
          <div class="user-name">{{ record.userName }}</div>
          <div class="user-dept">{{ record.department }}</div>
        </div>
      </div>
      <div class="record-time">{{ formatTime(record.timestamp) }}</div>
    </div>

    <div class="record-content">
      <div class="access-info">
        <span class="device-name">{{ record.deviceName }}</span>
        <van-tag :type="record.resultType" size="small">
          {{ record.resultText }}
        </van-tag>
      </div>

      <div class="access-details" v-if="record.accessMethod">
        <span class="method-label">éªŒè¯æ–¹å¼:</span>
        <span class="method-value">{{ record.accessMethodText }}</span>
      </div>
    </div>

    <div class="record-footer" v-if="record.photoUrl">
      <van-image
        :src="record.photoUrl"
        :alt="è®¿é—®ç…§ç‰‡"
        class="access-photo"
        fit="cover"
        @click="previewPhoto(record.photoUrl)"
      />
    </div>
  </div>
</template>
```

### 4. å®¡æ‰¹æµç¨‹é¡µé¢ (Approval)

#### å®¡æ‰¹ç”³è¯·è¡¨å•
```vue
<template>
  <div class="approval-form">
    <van-form @submit="onSubmit">
      <van-field
        v-model="form.requestType"
        name="requestType"
        label="ç”³è¯·ç±»å‹"
        placeholder="è¯·é€‰æ‹©ç”³è¯·ç±»å‹"
        :rules="[{ required: true, message: 'è¯·é€‰æ‹©ç”³è¯·ç±»å‹' }]"
      >
        <template #input>
          <van-picker
            v-model="form.requestType"
            :columns="requestTypeOptions"
            @confirm="onRequestTypeConfirm"
          />
        </template>
      </van-field>

      <van-field
        v-model="form.targetAreas"
        name="targetAreas"
        label="ç›®æ ‡åŒºåŸŸ"
        placeholder="è¯·é€‰æ‹©ç›®æ ‡åŒºåŸŸ"
        :rules="[{ required: true, message: 'è¯·é€‰æ‹©ç›®æ ‡åŒºåŸŸ' }]"
      >
        <template #input>
          <van-area
            v-model="form.targetAreas"
            :area-list="areaList"
            @confirm="onAreaConfirm"
          />
        </template>
      </van-field>

      <van-field
        v-model="form.accessPurpose"
        name="accessPurpose"
        label="è®¿é—®äº‹ç”±"
        placeholder="è¯·è¾“å…¥è®¿é—®äº‹ç”±"
        :rules="[{ required: true, message: 'è¯·è¾“å…¥è®¿é—®äº‹ç”±' }]"
      />

      <van-field
        v-model="form.startTime"
        name="startTime"
        label="å¼€å§‹æ—¶é—´"
        placeholder="è¯·é€‰æ‹©å¼€å§‹æ—¶é—´"
        :rules="[{ required: true, message: 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´' }]"
      >
        <template #input>
          <van-datetime-picker
            v-model="form.startTime"
            type="datetime"
            @confirm="onStartTimeConfirm"
          />
        </template>
      </van-field>

      <van-field
        v-model="form.endTime"
        name="endTime"
        label="ç»“æŸæ—¶é—´"
        placeholder="è¯·é€‰æ‹©ç»“æŸæ—¶é—´"
        :rules="[{ required: true, message: 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´' }]"
      >
        <template #input>
          <van-datetime-picker
            v-model="form.endTime"
            type="datetime"
            @confirm="onEndTimeConfirm"
          />
        </template>
      </van-field>

      <!-- é™„ä»¶ä¸Šä¼  -->
      <van-field name="attachments" label="é™„ä»¶ä¸Šä¼ ">
        <template #input>
          <van-uploader
            v-model="form.attachments"
            :after-read="afterReadFile"
            :max-count="3"
          />
        </template>
      </van-field>

      <div class="form-actions">
        <van-button
          type="primary"
          size="large"
          :loading="submitting"
          native-type="submit"
        >
          æäº¤ç”³è¯·
        </van-button>
        <van-button
          size="large"
          @click="onCancel"
        >
          å–æ¶ˆ
        </van-button>
      </div>
    </van-form>
  </div>
</template>
```

#### å®¡æ‰¹åˆ—è¡¨ç»„ä»¶
```vue
<template>
  <div class="approval-list">
    <van-tabs v-model:active="activeTab" sticky>
      <van-tab title="å¾…å®¡æ‰¹" name="pending">
        <approval-list
          :requests="pendingRequests"
          :loading="pendingLoading"
          type="pending"
          @approve="handleApprove"
          @reject="handleReject"
          @detail="showRequestDetail"
        />
      </van-tab>

      <van-tab title="å·²å®¡æ‰¹" name="approved">
        <approval-list
          :requests="approvedRequests"
          :loading="approvedLoading"
          type="approved"
          @detail="showRequestDetail"
          @revoke="handleRevoke"
        />
      </van-tab>

      <van-tab title="æˆ‘ç”³è¯·çš„" name="my-requests">
        <approval-list
          :requests="myRequests"
          :loading="myLoading"
          type="my"
          @detail="showRequestDetail"
          @cancel="handleCancel"
        />
      </van-tab>
    </van-tabs>
  </div>
</template>
```

## ğŸ¨ ç§»åŠ¨ç«¯ä¸“ç”¨ç»„ä»¶
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 1. å®æ—¶çŠ¶æ€ç»„ä»¶
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼
```vue
<template>
  <div class="realtime-status">
    <van-row gutter="10">
      <van-col span="6">
        <div class="status-card online">
          <div class="status-icon">
            <van-icon name="wifi" />
          </div>
          <div class="status-content">
            <div class="status-value">{{ onlineDevices }}</div>
            <div class="status-label">åœ¨çº¿è®¾å¤‡</div>
          </div>
        </div>
      </van-col>

      <van-col span="6">
        <div class="status-card offline">
          <div class="status-icon">
            <van-icon name="wifi-o" />
          </div>
          <div class="status-content">
            <div class="status-value">{{ offlineDevices }}</div>
            <div class="status-label">ç¦»çº¿è®¾å¤‡</div>
          </div>
        </div>
      </van-col>
    </van-row>

    <van-row gutter="10">
      <van-col span="6">
        <div class="status-card today-access">
          <div class="status-icon">
            <van-icon name="logistics" />
          </div>
          <div class="status-content">
            <div class="status-value">{{ todayAccess }}</div>
            <div class="status-label">ä»Šæ—¥è®¿é—®</div>
          </div>
        </div>
      </van-col>

      <van-col span="6">
        <div class="status-card alerts">
          <div class="status-icon">
            <van-icon name="warning" />
          </div>
          <div class="status-content">
            <div class="status-value">{{ alertCount }}</div>
            <div class="status-label">å¾…å¤„ç†å‘Šè­¦</div>
          </div>
        </div>
      </van-col>
    </van-row>
  </div>
</template>
```

### 2. æŒ‡çº¹è¯†åˆ«ç»„ä»¶
```vue
<template>
  <div class="fingerprint-auth">
    <div class="auth-header">
      <h3>æŒ‡çº¹éªŒè¯</h3>
      <p>è¯·å°†æ‰‹æŒ‡æ”¾åœ¨æŒ‡çº¹è¯†åˆ«å™¨ä¸Š</p>
    </div>

    <div class="fingerprint-scanner">
      <div class="scanner-ring" :class="{ active: isScanning }">
        <van-icon name="finger-print" />
      </div>
      <div class="scanner-text">
        {{ scanText }}
      </div>
    </div>

    <div class="auth-actions">
      <van-button @click="startScan">å¼€å§‹æ‰«æ</van-button>
      <van-button @click="cancelScan" plain>å–æ¶ˆ</van-button>
    </div>
  </div>
</template>
```

### 3. äººè„¸è¯†åˆ«ç»„ä»¶
```vue
<template>
  <div class="face-recognition">
    <div class="camera-view">
      <video
        ref="camera"
        :width="cameraWidth"
        :height="cameraHeight"
        autoplay
        muted
        playsinline
      />
      <canvas
        ref="canvas"
        :width="cameraWidth"
        :height="cameraHeight"
        style="display: none;"
      />

      <div class="camera-overlay" v-if="showOverlay">
        <div class="overlay-content">
          <div class="face-frame">
            <div class="frame-corner top-left"></div>
            <div class="frame-corner top-right"></div>
            <div class="frame-corner bottom-left"></div>
            <div class="frame-corner bottom-right"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="recognition-status">
      <div class="status-text">{{ statusText }}</div>
      <div class="progress-bar" v-if="isProcessing">
        <van-progress :percentage="progress" />
      </div>
    </div>
  </div>
</template>
```

### 4. äºŒç»´ç æ‰«æç»„ä»¶
```vue
<template>
  <div class="qr-scanner">
    <div class="scanner-view">
      <video
        ref="scanner"
        :width="scannerSize"
        :height="scannerSize"
        autoplay
        muted
      />
      <canvas
        ref="canvas"
        :width="scannerSize"
        :height="scannerSize"
        style="display: none;"
      />
    </div>

    <div class="scanner-result" v-if="scanResult">
      <div class="result-content">
        <h4>æ‰«æç»“æœ</h4>
        <p>{{ scanResult }}</p>
        <van-button @click="acceptResult" type="primary">
          ç¡®è®¤
        </van-button>
        <van-button @click="rescan" plain>
          é‡æ–°æ‰«æ
        </van-button>
      </div>
    </div>

    <div class="scanner-tips">
      <p>è¯·å°†äºŒç»´ç å¯¹å‡†æ‰«ææ¡†</p>
      <p>ä¿æŒè·ç¦»10-15cm</p>
    </div>
  </div>
</template>
```

## ğŸ”” WebSocket å®æ—¶é€šä¿¡

### WebSocket æœåŠ¡å°è£…
```typescript
// src/services/websocket.ts
export class WebSocketService {
  private ws: WebSocket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;
  private reconnectDelay = 3000;

  constructor(private store: any) {
    this.connect();
  }

  connect() {
    try {
      this.ws = new WebSocket('ws://api.ioedream.com/access/v1/ws');

      this.ws.onopen = this.onOpen.bind(this);
      this.ws.onmessage = this.onMessage.bind(this);
      this.ws.onclose = this.onClose.bind(this);
      this.ws.onerror = this.onError.bind(this);
    } catch (error) {
      console.error('WebSocketè¿æ¥å¤±è´¥:', error);
      this.reconnect();
    }
  }

  onOpen() {
    console.log('WebSocketè¿æ¥æˆåŠŸ');
    this.reconnectAttempts = 0;

    // å‘é€è®¤è¯ä¿¡æ¯
    this.send({
      type: 'AUTH',
      token: this.store.state.token
    });

    // è®¢é˜…å®æ—¶æ•°æ®
    this.subscribe(['device-status', 'access-events', 'alerts']);
  }

  onMessage(event: MessageEvent) {
    try {
      const data = JSON.parse(event.data);

      switch (data.type) {
        case 'DEVICE_STATUS':
          this.store.dispatch('access/updateDeviceStatus', data.data);
          break;
        case 'ACCESS_EVENT':
          this.store.dispatch('access/addAccessEvent', data.data);
          this.showNotification('è®¿é—®äº‹ä»¶', data.data);
          break;
        case 'ALERT':
          this.store.dispatch('access/addAlert', data.data);
          this.showNotification('å‘Šè­¦æé†’', data.data, 'error');
          break;
      }
    } catch (error) {
      console.error('WebSocketæ¶ˆæ¯è§£æå¤±è´¥:', error);
    }
  }

  onClose() {
    console.log('WebSocketè¿æ¥å…³é—­');
    this.reconnect();
  }

  onError() {
    console.error('WebSocketè¿æ¥é”™è¯¯');
  }

  send(data: any) {
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(data));
    }
  }

  subscribe(channels: string[]) {
    this.send({
      type: 'SUBSCRIBE',
      channels
    });
  }

  reconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      setTimeout(() => {
        this.reconnectAttempts++;
        this.connect();
      }, this.reconnectDelay * this.reconnectAttempts);
    }
  }
}
```

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

### å“åº”å¼è®¾è®¡
```scss
// ç§»åŠ¨ç«¯æ–­ç‚¹
@media (max-width: 768px) {
  .access-monitor {
    .status-overview {
      .status-item {
        padding: 8px;
      }
    }

    .monitor-list {
      .van-cell {
        padding: 12px;
      }
    }
  }
}

// æ¨ªç«–å±é€‚é…
@media (orientation: landscape) {
  .access-monitor {
    .quick-actions {
      .van-grid-item {
        margin-bottom: 0;
      }
    }
  }
}
```

### æ‰‹åŠ¿æ“ä½œæ”¯æŒ
```vue
<template>
  <div
    class="swipe-container"
    @swipeleft="onSwipeLeft"
    @swiperight="onSwipeRight"
  >
    <van-swipe
      v-model="activeIndex"
      :width="width"
      :height="height"
    >
      <van-swipe-item v-for="(page, index) in pages" :key="index">
        <page-component :page="page" />
      </van-swipe-item>
    </van-swipe>
  </div>
</template>
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### 1. å›¾ç‰‡æ‡’åŠ è½½
```vue
<template>
  <van-image
    :src="image.url"
    :lazy-load="true"
    :loading="loadingSlot"
    :error="errorSlot"
  >
    <template #loading>
      <van-loading type="spinner" size="20" />
    </template>
    <template #error>
      <van-icon name="photo-fail" size="20" />
    </template>
  </van-image>
</template>
```

### 2. è™šæ‹Ÿæ»šåŠ¨
```vue
<template>
  <van-list
    v-model:loading="loading"
    :finished="finished"
    finished-text="æ²¡æœ‰æ›´å¤šäº†"
    @load="onLoad"
    :immediate-check="false"
  >
    <!-- åˆ—è¡¨é¡¹ -->
  </van-list>
</template>
```

### 3. ç¼“å­˜ç­–ç•¥
```typescript
// å›¾ç‰‡ç¼“å­˜é…ç½®
const imageCache = {
  max: 100,
  name: 'access-images',
  expire: 7 * 24 * 60 * 60 * 1000, // 7å¤©
  storeTo: 'localStorage'
};
```

## ğŸ” å®‰å…¨å®ç°

### 1. ç”Ÿç‰©è¯†åˆ«å®‰å…¨
```typescript
// ç”Ÿç‰©è¯†åˆ«æ•°æ®åŠ å¯†
export class BiometricSecurity {
  encrypt(data: string): string {
    // ä½¿ç”¨AESåŠ å¯†
    return CryptoJS.AES.encrypt(data, this.getSecretKey()).toString();
  }

  decrypt(encryptedData: string): string {
    // ä½¿ç”¨AESè§£å¯†
    const bytes = CryptoJS.AES.decrypt(encryptedData, this.getSecretKey());
    return bytes.toString(CryptoJS.enc.Utf8);
  }

  getSecretKey(): string {
    // ä»å®‰å…¨å­˜å‚¨è·å–å¯†é’¥
    return localStorage.getItem('biometric-key') || '';
  }
}
```

### 2. è®¾å¤‡æƒé™éªŒè¯
```typescript
// è®¾å¤‡æƒé™éªŒè¯
export class DevicePermission {
  static checkAccess(
    userId: number,
    deviceId: string,
    operation: string
  ): Promise<boolean> {
    return api.post('/security/check-access', {
      userId,
      deviceId,
      operation
    }).then(response => {
      return response.data.success;
    });
  }
}
```

## ğŸ“± ç§»åŠ¨ç«¯ç‰¹æœ‰åŠŸèƒ½

### 1. æ¨é€é€šçŸ¥
```typescript
// æ¨é€é€šçŸ¥é…ç½®
const pushNotification = {
  requestPermission(): Promise<boolean> {
    return new Promise((resolve, reject) => {
      Notification.requestPermission()
        .then(permission => {
          resolve(permission === 'granted');
        })
        .catch(reject);
    });
  },

  subscribe(topic: string, callback: Function) {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.ready.then(registration => {
        registration.pushManager.subscribe({
          topic,
          callback
        });
      });
    }
  }
};
```

### 2. åœ°ç†ä½ç½®
```typescript
// åœ°ç†ä½ç½®è·å–
export class LocationService {
  getCurrentPosition(): Promise<GeolocationPosition> {
    return new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(
        position => resolve(position),
        error => reject(error)
      );
    });
  }

  watchPosition(callback: Function): number {
    return navigator.geolocation.watchPosition(callback, callback);
  }
}
```

### 3. ç›¸æœºè°ƒç”¨
```typescript
// ç›¸æœºåŠŸèƒ½
export class CameraService {
  async capturePhoto(): Promise<string> {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: 'environment'
      }
    });

    const video = document.createElement('video');
    video.srcObject = stream;
    video.play();

    return new Promise((resolve) => {
      video.addEventListener('loadeddata', () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);

        const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
        resolve(dataUrl);
      });
    });
  }
}
```

---

## ğŸ“‹ ç›¸å…³æ–‡æ¡£

- [å‰ç«¯APIæ¥å£è®¾è®¡](./12-å‰ç«¯APIæ¥å£è®¾è®¡.md)
- [ç§»åŠ¨ç«¯è®¾è®¡è§„èŒƒ](./ç§»åŠ¨ç«¯è®¾è®¡è§„èŒƒ.md)
- [ç»„ä»¶å¼€å‘æŒ‡å—](./ç»„ä»¶å¼€å‘æŒ‡å—.md)
- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md)

---

*æœ¬æ–‡æ¡£ä¸¥æ ¼éµå¾ªç§»åŠ¨ç«¯å¼€å‘è§„èŒƒï¼Œç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„æœ€ä½³ç”¨æˆ·ä½“éªŒã€‚*