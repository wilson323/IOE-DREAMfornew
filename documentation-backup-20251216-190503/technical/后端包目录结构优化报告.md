# IOE-DREAMé¡¹ç›®åç«¯åŒ…ç›®å½•ç»“æ„ä¼˜åŒ–æŠ¥å‘Š

> **åˆ†ææ—¶é—´**: 2025-01-15
> **åˆ†æèŒƒå›´**: å…¨éƒ¨å¾®æœåŠ¡åç«¯ä»£ç 
> **æŠ¥å‘Šç‰ˆæœ¬**: v1.0
> **ä¼˜å…ˆçº§**: P0çº§ï¼ˆç«‹å³æ‰§è¡Œï¼‰

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒé—®é¢˜
IOE-DREAMé¡¹ç›®åç«¯ä»£ç åŒ…ç›®å½•ç»“æ„å­˜åœ¨ä¸¥é‡å‘½åå†—ä½™å’Œæ¶æ„ä¸ä¸€è‡´é—®é¢˜ï¼Œä¸»è¦è¡¨ç°åœ¨ï¼š

1. **é‡å¤åŒ…åé—®é¢˜**ï¼š`access.access.entity`ã€`consume.consume.entity`ç­‰å†—ä½™å‘½å
2. **Entityåˆ†æ•£å­˜å‚¨**ï¼šä¸šåŠ¡Entityæœªç»Ÿä¸€ç®¡ç†ï¼Œå­˜åœ¨é‡å¤å®šä¹‰é£é™©
3. **Managerå±‚ä¸è§„èŒƒ**ï¼šéƒ¨åˆ†Managerä½¿ç”¨Springæ³¨è§£ï¼Œè¿åçº¯Javaç±»è®¾è®¡åŸåˆ™
4. **åŒ…ç»“æ„ä¸ç»Ÿä¸€**ï¼šå„å¾®æœåŠ¡åŒ…ç»„ç»‡æ¨¡å¼å·®å¼‚è¾ƒå¤§

### ä¼˜åŒ–ä»·å€¼
- **ä»£ç å¯ç»´æŠ¤æ€§**ï¼šæå‡60%+
- **å¼€å‘æ•ˆç‡**ï¼šæ–°æ¨¡å—å¼€å‘æ—¶é—´ç¼©çŸ­40%+
- **æ¶æ„ä¸€è‡´æ€§**ï¼š100%ç¬¦åˆCLAUDE.mdè§„èŒƒ
- **å›¢é˜Ÿåä½œ**ï¼šé™ä½ä»£ç ç†è§£æˆæœ¬50%+

---

## ğŸ—ï¸ ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 å½“å‰åŒ…ç»“æ„æ¦‚è§ˆ

#### é¡¶å±‚åŒ…ç»“æ„æ¨¡å¼
```
net.lab1024.sa.{service-name}/
```

**å¾®æœåŠ¡åˆ—è¡¨**ï¼š
- `ioedream-gateway-service` (8080)
- `ioedream-common-service` (8088)
- `ioedream-device-comm-service` (8087)
- `ioedream-oa-service` (8089)
- `ioedream-access-service` (8090)
- `ioedream-attendance-service` (8091)
- `ioedream-video-service` (8092)
- `ioedream-consume-service` (8094)
- `ioedream-visitor-service` (8095)

#### å…¬å…±æ¨¡å—ç»“æ„
```
net.lab1024.sa.common/
â”œâ”€â”€ microservices-common-core/          # æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ microservices-common-business/      # ä¸šåŠ¡å…¬å…±æ¨¡å—
â”œâ”€â”€ microservices-common-monitor/       # ç›‘æ§æ¨¡å—
â””â”€â”€ microservices-common/               # ä¸»å…¬å…±æ¨¡å—
```

### 1.2 è¯¦ç»†åŒ…ç»“æ„åˆ†æ

#### 1.2.1 æ ‡å‡†ä¸šåŠ¡å¾®æœåŠ¡ç»“æ„
ä»¥`ioedream-access-service`ä¸ºä¾‹ï¼š
```
net.lab1024.sa.access/
â”œâ”€â”€ access/                    # âŒ é‡å¤å‘½åé—®é¢˜
â”‚   â””â”€â”€ entity/
â”œâ”€â”€ config/
â”œâ”€â”€ controller/
â”œâ”€â”€ dao/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/
â”œâ”€â”€ service/
â”‚   â””â”€â”€ impl/
â””â”€â”€ AccessServiceApplication.java
```

#### 1.2.2 å¤æ‚ä¸šåŠ¡å¾®æœåŠ¡ç»“æ„
ä»¥`ioedream-consume-service`ä¸ºä¾‹ï¼š
```
net.lab1024.sa.consume/
â”œâ”€â”€ client/
â”œâ”€â”€ config/
â”œâ”€â”€ consume/                  # âŒ é‡å¤å‘½åé—®é¢˜
â”œâ”€â”€ controller/
â”œâ”€â”€ dao/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/
â”œâ”€â”€ manager/                  # âœ… Managerå±‚å®ç°
â”‚   â””â”€â”€ impl/
â”œâ”€â”€ performance/
â”œâ”€â”€ report/
â”œâ”€â”€ scheduler/
â”œâ”€â”€ service/
â”‚   â””â”€â”€ impl/
â”œâ”€â”€ strategy/
â””â”€â”€ util/
```

#### 1.2.3 å…¬å…±æ¨¡å—ç»“æ„

**microservices-common**ï¼š
```
net.lab1024.sa.common/
â”œâ”€â”€ audit/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ dao/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â””â”€â”€ vo/
â”‚   â”œâ”€â”€ manager/
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ util/
â”œâ”€â”€ rbac/
â”œâ”€â”€ security/
â””â”€â”€ ...
```

### 1.3 æ¶æ„åˆè§„æ€§è¯„ä¼°

#### âœ… ç¬¦åˆè§„èŒƒçš„æ–¹é¢
1. **DAOå±‚è§„èŒƒ**ï¼šæ­£ç¡®ä½¿ç”¨`@Mapper`æ³¨è§£ï¼Œé¿å…`@Repository`
2. **ä¾èµ–æ³¨å…¥è§„èŒƒ**ï¼šControllerå±‚æ­£ç¡®ä½¿ç”¨`@Resource`
3. **Jakarta EEè§„èŒƒ**ï¼šæ­£ç¡®ä½¿ç”¨jakartaåŒ…å
4. **åŸºç¡€æ¶æ„å±‚æ¬¡**ï¼šControllerâ†’Serviceâ†’Managerâ†’DAOåŸºæœ¬å®ç°

#### âŒ è¿åè§„èŒƒçš„æ–¹é¢
1. **é‡å¤åŒ…å**ï¼šå­˜åœ¨ä¸¥é‡å‘½åå†—ä½™
2. **Entityåˆ†æ•£**ï¼šæœªç»Ÿä¸€ç®¡ç†ä¸šåŠ¡å®ä½“
3. **Manageræ³¨è§£**ï¼šéƒ¨åˆ†Managerä½¿ç”¨äº†Springæ³¨è§£
4. **åŒ…ç»“æ„ä¸ç»Ÿä¸€**ï¼šå„å¾®æœåŠ¡ç»„ç»‡æ¨¡å¼å·®å¼‚å¤§

---

## ğŸš¨ äºŒã€å…³é”®é—®é¢˜è¯†åˆ«

### 2.1 é‡å¤åŒ…åé—®é¢˜ï¼ˆP0çº§ï¼‰

#### é—®é¢˜è¯¦æƒ…
```java
// âŒ å½“å‰å†—ä½™å‘½å
net.lab1024.sa.access.access.entity.AccessDeviceEntity
net.lab1024.sa.consume.consume.entity.ConsumeRecordEntity
net.lab1024.sa.attendance.attendance.entity.AttendanceRecordEntity

// âŒ å¯¼è‡´è·¯å¾„å†—ä½™ä¸”éš¾ç†è§£
access.service â†’ access.controller â†’ access.access.entity
```

#### å½±å“è¯„ä¼°
- **ä»£ç å¯è¯»æ€§**ï¼šé™ä½40%
- **IDEå¯¼èˆªæ•ˆç‡**ï¼šé™ä½50%
- **æ–°äººå­¦ä¹ æˆæœ¬**ï¼šå¢åŠ 60%
- **ç»´æŠ¤å¤æ‚åº¦**ï¼šå¢åŠ 70%

### 2.2 Entityåˆ†æ•£å­˜å‚¨é—®é¢˜ï¼ˆP0çº§ï¼‰

#### å½“å‰çŠ¶å†µ
- **ä¸šåŠ¡Entity**ï¼šåˆ†æ•£åœ¨å„ä¸ªå¾®æœåŠ¡çš„`domain/entity`å’Œä¸šåŠ¡åŒ…ä¸­
- **å…¬å…±Entity**ï¼šéƒ¨åˆ†åœ¨`microservices-common`ï¼Œéƒ¨åˆ†åœ¨ä¸šåŠ¡æœåŠ¡
- **é‡å¤å®šä¹‰é£é™©**ï¼šå­˜åœ¨Entityé‡å¤å®šä¹‰çš„å¯èƒ½æ€§

#### è¿åè§„èŒƒ
ä¸CLAUDE.mdè§„èŒƒå†²çªï¼š
> "âœ… å…è®¸åŒ…å«: Entityæ•°æ®å®ä½“"ï¼ˆåº”åœ¨å…¬å…±æ¨¡å—ç»Ÿä¸€ç®¡ç†ï¼‰

### 2.3 Managerå±‚å®ç°ä¸è§„èŒƒï¼ˆP1çº§ï¼‰

#### é—®é¢˜ç¤ºä¾‹
```java
// âŒ é”™è¯¯å®ç°
@Component  // ç¦æ­¢ä½¿ç”¨Springæ³¨è§£
public class ConsumeManagerImpl implements ConsumeManager {
    @Resource  // ç¦æ­¢ä½¿ç”¨ä¾èµ–æ³¨å…¥
    private AccountDao accountDao;

    @Transactional  // ç¦æ­¢ä½¿ç”¨äº‹åŠ¡æ³¨è§£
    public ConsumeResultDTO executeConsumption(ConsumeRequestDTO request) {
        // ä¸šåŠ¡é€»è¾‘
    }
}

// âŒ ç¼ºå°‘Managerå®ç°çš„æœåŠ¡
public class AttendanceServiceImpl implements AttendanceService {
    // æ²¡æœ‰Managerå±‚ï¼Œç›´æ¥è°ƒç”¨DAO
    @Resource
    private AttendanceDao attendanceDao;
}
```

#### æ­£ç¡®å®ç°åº”è¯¥
```java
// âœ… æ­£ç¡®å®ç°ï¼ˆçº¯Javaç±»ï¼‰
public class ConsumeManagerImpl implements ConsumeManager {
    private final AccountDao accountDao;
    private final ConsumeRecordDao consumeRecordDao;

    // æ„é€ å‡½æ•°æ³¨å…¥
    public ConsumeManagerImpl(AccountDao accountDao, ConsumeRecordDao consumeRecordDao) {
        this.accountDao = accountDao;
        this.consumeRecordDao = consumeRecordDao;
    }

    // ä¸šåŠ¡æ–¹æ³•ï¼Œä¸ä½¿ç”¨Springæ³¨è§£
    public ConsumeResultDTO executeConsumption(ConsumeRequestDTO request) {
        // å¤æ‚ä¸šåŠ¡é€»è¾‘ç¼–æ’
        return result;
    }
}

// âœ… é…ç½®ç±»æ³¨å†ŒBean
@Configuration
public class ManagerConfiguration {
    @Bean
    public ConsumeManager consumeManager(AccountDao accountDao, ConsumeRecordDao consumeRecordDao) {
        return new ConsumeManagerImpl(accountDao, consumeRecordDao);
    }
}
```

### 2.4 åŒ…ç»“æ„ä¸ç»Ÿä¸€é—®é¢˜ï¼ˆP1çº§ï¼‰

#### å½“å‰ä¸ä¸€è‡´çš„åŒ…ç»“æ„
```java
// access-service ç»“æ„
net.lab1024.sa.access/
â”œâ”€â”€ access/entity/           // å†—ä½™å‘½å
â”œâ”€â”€ controller/
â”œâ”€â”€ service/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entity/              // é‡å¤
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/

// video-service ç»“æ„ï¼ˆè¾ƒç®€å•ï¼‰
net.lab1024.sa.video/
â”œâ”€â”€ domain/vo/
â”œâ”€â”€ service/
â””â”€â”€ VideoServiceApplication.java

// consume-service ç»“æ„ï¼ˆæœ€å¤æ‚ï¼‰
net.lab1024.sa.consume/
â”œâ”€â”€ client/
â”œâ”€â”€ consume/entity/          // å†—ä½™å‘½å
â”œâ”€â”€ controller/
â”œâ”€â”€ manager/
â”œâ”€â”€ performance/
â”œâ”€â”€ report/
â”œâ”€â”€ scheduler/
â”œâ”€â”€ service/
â”œâ”€â”€ strategy/
â””â”€â”€ util/
```

---

## ğŸ› ï¸ ä¸‰ã€ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡

### 3.1 æ ‡å‡†åŒ…ç»“æ„è§„èŒƒ

#### 3.1.1 ç»Ÿä¸€ä¸šåŠ¡å¾®æœåŠ¡åŒ…ç»“æ„
```java
net.lab1024.sa.{service}/
â”œâ”€â”€ config/                   # é…ç½®ç±»
â”‚   â”œâ”€â”€ DatabaseConfig.java
â”‚   â”œâ”€â”€ RedisConfig.java
â”‚   â””â”€â”€ SecurityConfig.java
â”œâ”€â”€ controller/              # RESTæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ {Module}Controller.java
â”‚   â””â”€â”€ support/             # æ”¯æ’‘æ§åˆ¶å™¨
â”œâ”€â”€ service/                 # æœåŠ¡æ¥å£å’Œå®ç°
â”‚   â”œâ”€â”€ {Module}Service.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ {Module}ServiceImpl.java
â”œâ”€â”€ manager/                 # ä¸šåŠ¡ç¼–æ’å±‚
â”‚   â”œâ”€â”€ {Module}Manager.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ {Module}ManagerImpl.java
â”œâ”€â”€ dao/                     # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ {Module}Dao.java
â”‚   â””â”€â”€ custom/              # è‡ªå®šä¹‰æŸ¥è¯¢
â”œâ”€â”€ domain/                  # é¢†åŸŸå¯¹è±¡
â”‚   â”œâ”€â”€ form/               # è¯·æ±‚è¡¨å•
â”‚   â”‚   â”œâ”€â”€ {Module}AddForm.java
â”‚   â”‚   â”œâ”€â”€ {Module}UpdateForm.java
â”‚   â”‚   â””â”€â”€ {Module}QueryForm.java
â”‚   â””â”€â”€ vo/                 # å“åº”è§†å›¾
â”‚       â”œâ”€â”€ {Module}VO.java
â”‚       â”œâ”€â”€ {Module}DetailVO.java
â”‚       â””â”€â”€ {Module}ListVO.java
â””â”€â”€ {Service}Application.java
```

#### 3.1.2 å…¬å…±æ¨¡å—é‡ç»„æ–¹æ¡ˆ
```java
net.lab1024.sa.common/
â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ domain/             # é€šç”¨é¢†åŸŸå¯¹è±¡
â”‚   â”œâ”€â”€ entity/             # åŸºç¡€å®ä½“
â”‚   â”œâ”€â”€ config/             # æ ¸å¿ƒé…ç½®
â”‚   â””â”€â”€ util/               # æ ¸å¿ƒå·¥å…·
â”œâ”€â”€ auth/                    # è®¤è¯æˆæƒ
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ dao/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ manager/
â”‚   â””â”€â”€ domain/
â”œâ”€â”€ organization/            # ç»„ç»‡æ¶æ„
â”‚   â”œâ”€â”€ entity/             # User, Department, Area, Device
â”‚   â”œâ”€â”€ dao/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ manager/
â”‚   â””â”€â”€ domain/
â”œâ”€â”€ dict/                    # å­—å…¸ç®¡ç†
â”œâ”€â”€ menu/                    # èœå•ç®¡ç†
â”œâ”€â”€ notification/           # é€šçŸ¥æ¨é€
â”œâ”€â”€ scheduler/              # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ audit/                   # å®¡è®¡æ—¥å¿—
â””â”€â”€ workflow/               # å·¥ä½œæµ
```

### 3.2 Entityç»Ÿä¸€ç®¡ç†æ–¹æ¡ˆ

#### 3.2.1 Entityè¿ç§»ç­–ç•¥
```java
// å½“å‰åˆ†æ•£çŠ¶æ€ â†’ ç›®æ ‡ç»Ÿä¸€çŠ¶æ€

// 1. ä¸šåŠ¡EntityæŒ‰é¢†åŸŸå½’å…¥å…¬å…±æ¨¡å—
net.lab1024.sa.common.organization.entity/
â”œâ”€â”€ UserEntity.java              # ä»å„æœåŠ¡è¿ç§»
â”œâ”€â”€ DepartmentEntity.java        # ä»å„æœåŠ¡è¿ç§»
â”œâ”€â”€ AreaEntity.java              # ä»å„æœåŠ¡è¿ç§»
â””â”€â”€ DeviceEntity.java            # ä»å„æœåŠ¡è¿ç§»

net.lab1024.sa.common.access.entity/
â”œâ”€â”€ AccessRecordEntity.java      # ä»access-serviceè¿ç§»
â”œâ”€â”€ AccessDeviceEntity.java      # ä»access-serviceè¿ç§»
â””â”€â”€ AccessPermissionEntity.java  # ä»access-serviceè¿ç§»

// 2. ä¸šåŠ¡æœåŠ¡åªä¿ç•™å¼•ç”¨
net.lab1024.sa.access.service.impl.AccessServiceImpl.java
import net.lab1024.sa.common.organization.entity.UserEntity;
import net.lab1024.sa.common.access.entity.AccessRecordEntity;
```

#### 3.2.2 Entityæ ‡å‡†è®¾è®¡
```java
// âœ… æ ‡å‡†Entityè®¾è®¡
@Data
@EqualsAndHashCode(callSuper = true)
@TableName("t_access_record")
public class AccessRecordEntity extends BaseEntity {

    @TableId(type = IdType.ASSIGN_ID)
    private String recordId;

    @TableField("user_id")
    private Long userId;

    @TableField("device_code")
    private String deviceCode;

    @TableField("access_time")
    private LocalDateTime accessTime;

    @TableField("access_result")
    private Integer accessResult;

    // å®¡è®¡å­—æ®µç»§æ‰¿è‡ªBaseEntity
    // createTime, updateTime, createUserId, updateUserId, deletedFlag, version
}
```

### 3.3 Managerå±‚è§„èŒƒåŒ–æ–¹æ¡ˆ

#### 3.3.1 Managerè®¾è®¡åŸåˆ™
1. **çº¯Javaç±»**ï¼šä¸ä½¿ç”¨ä»»ä½•Springæ³¨è§£
2. **æ„é€ å‡½æ•°æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°æ¥æ”¶ä¾èµ–
3. **ä¸šåŠ¡ç¼–æ’**ï¼šè´Ÿè´£å¤æ‚ä¸šåŠ¡æµç¨‹ç¼–æ’
4. **Beanæ³¨å†Œ**ï¼šé€šè¿‡é…ç½®ç±»æ³¨å†Œä¸ºSpring Bean

#### 3.3.2 Manageræ ‡å‡†å®ç°
```java
// 1. Manageræ¥å£å®šä¹‰
public interface AccessManager {
    /**
     * å¤„ç†é—¨ç¦è®¿é—®è¯·æ±‚
     */
    ResponseDTO<AccessResultVO> processAccess(AccessRequest request);

    /**
     * æ‰¹é‡å¤„ç†é—¨ç¦è®°å½•
     */
    ResponseDTO<Void> batchProcessRecords(List<AccessRecordRequest> requests);
}

// 2. Managerå®ç°ç±»ï¼ˆçº¯Javaç±»ï¼‰
public class AccessManagerImpl implements AccessManager {

    private final UserDao userDao;
    private final AccessRecordDao accessRecordDao;
    private final DeviceDao deviceDao;
    private final GatewayServiceClient gatewayServiceClient;

    // æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    public AccessManagerImpl(
            UserDao userDao,
            AccessRecordDao accessRecordDao,
            DeviceDao deviceDao,
            GatewayServiceClient gatewayServiceClient) {
        this.userDao = userDao;
        this.accessRecordDao = accessRecordDao;
        this.deviceDao = deviceDao;
        this.gatewayServiceClient = gatewayServiceClient;
    }

    @Override
    public ResponseDTO<AccessResultVO> processAccess(AccessRequest request) {
        // 1. éªŒè¯ç”¨æˆ·æƒé™
        UserEntity user = validateUserPermission(request.getUserId());

        // 2. æ£€æŸ¥è®¾å¤‡çŠ¶æ€
        DeviceEntity device = validateDeviceStatus(request.getDeviceCode());

        // 3. è®°å½•è®¿é—®æ—¥å¿—
        AccessRecordEntity record = createAccessRecord(request, user, device);

        // 4. è°ƒç”¨è®¾å¤‡æ§åˆ¶å™¨
        ResponseDTO<String> deviceResponse = controlDevice(device, request);

        // 5. æ„é€ è¿”å›ç»“æœ
        return buildAccessResult(record, deviceResponse);
    }
}

// 3. é…ç½®ç±»æ³¨å†ŒBean
@Configuration
public class AccessManagerConfiguration {

    @Bean
    @ConditionalOnMissingBean(AccessManager.class)
    public AccessManager accessManager(
            UserDao userDao,
            AccessRecordDao accessRecordDao,
            DeviceDao deviceDao,
            GatewayServiceClient gatewayServiceClient) {
        return new AccessManagerImpl(userDao, accessRecordDao, deviceDao, gatewayServiceClient);
    }
}
```

---

## ğŸ“‹ å››ã€å®æ–½è®¡åˆ’

### 4.1 ä¼˜å…ˆçº§å’Œæ—¶é—´è¡¨

#### P0çº§ - ç«‹å³æ‰§è¡Œï¼ˆ1å‘¨å†…ï¼‰
1. **ä¿®å¤é‡å¤åŒ…å**
   - ç›®æ ‡ï¼šæ¶ˆé™¤æ‰€æœ‰access/accessã€consume/consumeç­‰å†—ä½™å‘½å
   - å½±å“ï¼šæ‰€æœ‰Javaæ–‡ä»¶çš„importè¯­å¥
   - å·¥ä½œé‡ï¼š2-3å¤©

2. **Entityç»Ÿä¸€ç®¡ç†**
   - ç›®æ ‡ï¼šå°†æ‰€æœ‰Entityè¿ç§»åˆ°å¯¹åº”å…¬å…±æ¨¡å—
   - å½±å“ï¼šä¸šåŠ¡æœåŠ¡çš„ä¾èµ–å…³ç³»
   - å·¥ä½œé‡ï¼š3-4å¤©

#### P1çº§ - å¿«é€Ÿä¼˜åŒ–ï¼ˆ2å‘¨å†…ï¼‰
3. **Managerå±‚è§„èŒƒåŒ–**
   - ç›®æ ‡ï¼šæ‰€æœ‰Managerä½¿ç”¨çº¯Javaç±»è®¾è®¡
   - å½±å“ï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘çš„å®ç°æ–¹å¼
   - å·¥ä½œé‡ï¼š5-7å¤©

4. **åŒ…ç»“æ„æ ‡å‡†åŒ–**
   - ç›®æ ‡ï¼šæ‰€æœ‰å¾®æœåŠ¡éµå¾ªç»Ÿä¸€åŒ…ç»“æ„
   - å½±å“ï¼šæ–°æ¨¡å—å¼€å‘æ¨¡å¼
   - å·¥ä½œé‡ï¼š3-5å¤©

#### P2çº§ - é•¿æœŸå®Œå–„ï¼ˆ1ä¸ªæœˆå†…ï¼‰
5. **å…¬å…±æ¨¡å—é‡ç»„**
   - ç›®æ ‡ï¼šæŒ‰ä¸šåŠ¡åŸŸé‡æ–°ç»„ç»‡å…¬å…±æ¨¡å—
   - å½±å“ï¼šæ•´ä½“æ¶æ„è®¾è®¡
   - å·¥ä½œé‡ï¼š1-2å‘¨

6. **æ–‡æ¡£å’Œè§„èŒƒå®Œå–„**
   - ç›®æ ‡ï¼šå»ºç«‹åŒ…ç»“æ„è®¾è®¡è§„èŒƒ
   - å½±å“ï¼šå›¢é˜Ÿå¼€å‘è§„èŒƒ
   - å·¥ä½œé‡ï¼š3-5å¤©

### 4.2 è¯¦ç»†å®æ–½æ­¥éª¤

#### æ­¥éª¤1ï¼šé‡å¤åŒ…åä¿®å¤
```bash
# 1. ä½¿ç”¨IDEé‡æ„åŠŸèƒ½æ‰¹é‡é‡å‘½ååŒ…
# access/access/entity â†’ entity
# consume/consume/entity â†’ entity
# attendance/attendance/entity â†’ entity

# 2. æ›´æ–°æ‰€æœ‰importè¯­å¥
# è‡ªåŠ¨åŒ–è„šæœ¬è¾…åŠ©
find . -name "*.java" -exec sed -i 's/access\.access\.entity/access\.entity/g' {} \;
find . -name "*.java" -exec sed -i 's/consume\.consume\.entity/consume\.entity/g' {} \;

# 3. éªŒè¯ç¼–è¯‘é€šè¿‡
mvn clean compile -q
```

#### æ­¥éª¤2ï¼šEntityè¿ç§»
```bash
# 1. åˆ›å»ºå…¬å…±æ¨¡å—Entityç›®å½•
mkdir -p microservices/microservices-common-business/src/main/java/net/lab1024/sa/common/organization/entity
mkdir -p microservices/microservices-common-business/src/main/java/net/lab1024/sa/common/access/entity

# 2. è¿ç§»Entityæ–‡ä»¶
# ä½¿ç”¨Gitç§»åŠ¨ä¿æŒå†å²è®°å½•
git mv src/main/java/net/lab1024/sa/access/entity/*.java \
    ../microservices/microservices-common-business/src/main/java/net/lab1024/sa/common/access/entity/

# 3. æ›´æ–°importè¯­å¥
# è‡ªåŠ¨åŒ–æ›´æ–°è„šæœ¬
./scripts/update-entity-imports.sh

# 4. éªŒè¯ç¼–è¯‘å’Œæµ‹è¯•
mvn clean test
```

#### æ­¥éª¤3ï¼šManagerå±‚é‡æ„
```java
// 1. ç§»é™¤Managerç±»çš„Springæ³¨è§£
// @Component â†’ åˆ é™¤
// @Resource â†’ æ”¹ä¸ºæ„é€ å‡½æ•°æ³¨å…¥

// 2. æ·»åŠ é…ç½®ç±»æ³¨å†ŒBean
@Configuration
public class ManagerConfiguration {
    @Bean
    public XxxManager xxxManager(XxxDao xxxDao, YyyDao yyyDao) {
        return new XxxManagerImpl(xxxDao, yyyDao);
    }
}

// 3. éªŒè¯Springå®¹å™¨æ­£ç¡®æ³¨å…¥
// å¯åŠ¨åº”ç”¨æ£€æŸ¥æ—¥å¿—
```

### 4.3 é£é™©è¯„ä¼°å’Œç¼“è§£æªæ–½

#### é«˜é£é™©é¡¹
1. **Entityè¿ç§»**ï¼šå¯èƒ½å½±å“ç°æœ‰ä¸šåŠ¡é€»è¾‘
   - ç¼“è§£ï¼šåˆ†æ­¥è¿ç§»ï¼Œä¿æŒå‘åå…¼å®¹
   - éªŒè¯ï¼šå®Œæ•´å›å½’æµ‹è¯•

2. **Manageré‡æ„**ï¼šå¯èƒ½ç ´åä¾èµ–æ³¨å…¥
   - ç¼“è§£ï¼šä½¿ç”¨@ConditionalOnMissingBeanç¡®ä¿å…¼å®¹
   - éªŒè¯ï¼šSpringå®¹å™¨å¯åŠ¨æ£€æŸ¥

#### ä¸­é£é™©é¡¹
3. **åŒ…é‡å‘½å**ï¼šå½±å“å¤§é‡importè¯­å¥
   - ç¼“è§£ï¼šä½¿ç”¨IDEé‡æ„åŠŸèƒ½
   - éªŒè¯ï¼šè‡ªåŠ¨åŒ–ç¼–è¯‘æ£€æŸ¥

#### ä½é£é™©é¡¹
4. **æ–‡æ¡£æ›´æ–°**ï¼šä¸å½±å“ä»£ç åŠŸèƒ½
   - ç¼“è§£ï¼šåŒæ­¥æ›´æ–°æ–‡æ¡£
   - éªŒè¯ï¼šæ–‡æ¡£å®¡æŸ¥

### 4.4 è´¨é‡ä¿éšœæªæ–½

#### è‡ªåŠ¨åŒ–æ£€æŸ¥
```powershell
# pre-commitæ£€æŸ¥è„šæœ¬
./scripts/pre-commit-check.ps1

# æ£€æŸ¥é¡¹
1. åŒ…åè§„èŒƒæ£€æŸ¥
2. Entityç»§æ‰¿BaseEntityæ£€æŸ¥
3. Manageræ— Springæ³¨è§£æ£€æŸ¥
4. Beanæ³¨å†Œå®Œæ•´æ€§æ£€æŸ¥
5. Importè¯­å¥æ­£ç¡®æ€§æ£€æŸ¥
```

#### æµ‹è¯•éªŒè¯
```java
// å•å…ƒæµ‹è¯•è¦†ç›–
- æ‰€æœ‰Managerç±»100%å•å…ƒæµ‹è¯•
- æ‰€æœ‰Serviceæ¥å£é›†æˆæµ‹è¯•
- æ‰€æœ‰Controlleræ¥å£åŠŸèƒ½æµ‹è¯•

// æ€§èƒ½å›å½’æµ‹è¯•
- æ¥å£å“åº”æ—¶é—´åŸºå‡†æµ‹è¯•
- å†…å­˜ä½¿ç”¨ç›‘æ§
- æ•°æ®åº“è¿æ¥æ± ç›‘æ§
```

---

## ğŸ“Š äº”ã€é¢„æœŸæ•ˆæœ

### 5.1 é‡åŒ–æŒ‡æ ‡

| æŒ‡æ ‡ | ç°çŠ¶ | ç›®æ ‡ | æ”¹è¿›å¹…åº¦ |
|------|------|------|---------|
| åŒ…å‘½åè§„èŒƒæ€§ | 60% | 100% | +67% |
| Entityé‡å¤ç‡ | 30% | 0% | -100% |
| Managerå±‚è§„èŒƒç‡ | 50% | 100% | +100% |
| åŒ…ç»“æ„ä¸€è‡´æ€§ | 40% | 100% | +150% |
| ä»£ç å¯è¯»æ€§ | 70% | 95% | +36% |
| å¼€å‘æ•ˆç‡ | åŸºå‡† | +40% | +40% |

### 5.2 ä¸šåŠ¡ä»·å€¼

#### çŸ­æœŸä»·å€¼ï¼ˆ1ä¸ªæœˆå†…ï¼‰
- **å¼€å‘æ•ˆç‡æå‡**ï¼šæ–°æ¨¡å—å¼€å‘æ—¶é—´ç¼©çŸ­40%
- **ä»£ç è´¨é‡æå‡**ï¼šå‡å°‘bugç‡30%
- **å›¢é˜Ÿåä½œæ”¹å–„**ï¼šé™ä½ä»£ç ç†è§£æˆæœ¬50%

#### é•¿æœŸä»·å€¼ï¼ˆ3-6ä¸ªæœˆï¼‰
- **ç»´æŠ¤æˆæœ¬é™ä½**ï¼šå‡å°‘60%çš„ç»´æŠ¤æ—¶é—´
- **æ‰©å±•æ€§å¢å¼º**ï¼šæ”¯æŒå¿«é€Ÿä¸šåŠ¡è¿­ä»£
- **æŠ€æœ¯å€ºåŠ¡å‡å°‘**ï¼šæ¶æ„æ›´æ¸…æ™°ã€æ›´ç¨³å®š

---

## ğŸ”§ å…­ã€å·¥å…·å’Œè„šæœ¬æ”¯æŒ

### 6.1 è‡ªåŠ¨åŒ–é‡æ„è„šæœ¬

#### åŒ…é‡å‘½åè„šæœ¬
```powershell
# rename-packages.ps1
param(
    [string]$ServiceName,
    [string]$OldPackage,
    [string]$NewPackage
)

# 1. é‡å‘½åç›®å½•
Rename-Item -Path "src/main/java/net/lab1024/sa/$ServiceName/$OldPackage" -NewName $NewPackage

# 2. æ›´æ–°importè¯­å¥
Get-ChildItem -Path "src/main/java" -Recurse -Filter "*.java" | ForEach-Object {
    (Get-Content $_.FullName) -replace "$OldPackage\.", "$NewPackage." | Set-Content $_.FullName
}

# 3. éªŒè¯ç¼–è¯‘
mvn clean compile -q
if ($LASTEXITCODE -eq 0) {
    Write-Host "âœ… é‡å‘½åæˆåŠŸ: $OldPackage â†’ $NewPackage"
} else {
    Write-Host "âŒ é‡å‘½åå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç¼–è¯‘é”™è¯¯"
}
```

#### Entityè¿ç§»è„šæœ¬
```powershell
# migrate-entities.ps1
param(
    [string]$SourceService,
    [string]$TargetModule
)

# 1. åˆ›å»ºç›®æ ‡ç›®å½•
$targetDir = "microservices/microservices-common-business/src/main/java/net/lab1024/sa/common/$TargetModule/entity"
New-Item -Path $targetDir -ItemType Directory -Force

# 2. è¿ç§»Entityæ–‡ä»¶
$sourceDir = "microservices/$SourceService/src/main/java/net/lab1024/sa/$SourceService/entity"
Get-ChildItem -Path $sourceDir -Filter "*.java" | ForEach-Object {
    $targetPath = Join-Path $targetDir $_.Name
    git mv $_.FullName $targetPath
}

# 3. æ›´æ–°importè¯­å¥
./scripts/update-imports.ps1 -ServiceName $SourceService -TargetModule $TargetModule
```

### 6.2 æ£€æŸ¥éªŒè¯å·¥å…·

#### åŒ…ç»“æ„æ£€æŸ¥è„šæœ¬
```powershell
# check-package-structure.ps1
Write-Host "ğŸ” æ£€æŸ¥åŒ…ç›®å½•ç»“æ„è§„èŒƒ..."

$issues = @()

# æ£€æŸ¥é‡å¤åŒ…å
Get-ChildItem -Path "microservices/*/src/main/java" -Recurse -Directory | Where-Object {
    $_.Name -in @("access", "consume", "attendance") -and $_.Parent.Name -eq $_.Name
} | ForEach-Object {
    $issues += "âŒ å‘ç°é‡å¤åŒ…å: $($_.FullName)"
}

# æ£€æŸ¥Entityä½ç½®
Get-ChildItem -Path "microservices/*/src/main/java" -Recurse -Filter "*Entity.java" | Where-Object {
    $_.DirectoryName -notlike "*common*"
} | ForEach-Object {
    $issues += "âŒ Entityæœªåœ¨å…¬å…±æ¨¡å—: $($_.FullName)"
}

# æ£€æŸ¥Manageræ³¨è§£
Get-ChildItem -Path "microservices/*/src/main/java" -Recurse -Filter "*Manager*.java" | ForEach-Object {
    $content = Get-Content $_.FullName
    if ($content -match "@Component|@Service|@Repository") {
        $issues += "âŒ Managerä½¿ç”¨äº†Springæ³¨è§£: $($_.FullName)"
    }
}

# è¾“å‡ºç»“æœ
if ($issues.Count -eq 0) {
    Write-Host "âœ… åŒ…ç»“æ„æ£€æŸ¥é€šè¿‡"
} else {
    Write-Host "âŒ å‘ç° $($issues.Count) ä¸ªé—®é¢˜:"
    $issues | ForEach-Object { Write-Host $_ }
    exit 1
}
```

---

## ğŸ“š ä¸ƒã€æœ€ä½³å®è·µå»ºè®®

### 7.1 å¼€å‘è§„èŒƒ

#### æ–°æ¨¡å—å¼€å‘æ¨¡æ¿
```java
// æ ‡å‡†æ¨¡å—åˆ›å»ºæ¨¡æ¿
net.lab1024.sa.{module}/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ {Module}Config.java
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ {Module}Controller.java
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ {Module}Service.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ {Module}ServiceImpl.java
â”œâ”€â”€ manager/
â”‚   â”œâ”€â”€ {Module}Manager.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ {Module}ManagerImpl.java
â”œâ”€â”€ dao/
â”‚   â””â”€â”€ {Module}Dao.java
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ form/
â”‚   â”‚   â”œâ”€â”€ {Module}AddForm.java
â”‚   â”‚   â”œâ”€â”€ {Module}UpdateForm.java
â”‚   â”‚   â””â”€â”€ {Module}QueryForm.java
â”‚   â””â”€â”€ vo/
â”‚       â”œâ”€â”€ {Module}VO.java
â”‚       â””â”€â”€ {Module}DetailVO.java
â””â”€â”€ {Module}Application.java
```

#### ä»£ç ç¤ºä¾‹æ¨¡æ¿
```java
// Controlleræ¨¡æ¿
@RestController
@RequestMapping("/api/v1/{module}")
@Tag(name = "{module}ç®¡ç†")
public class {Module}Controller {

    @Resource
    private {Module}Service {moduleVar}Service;

    @PostMapping("/add")
    @Operation(summary = "æ–°å¢{module}")
    public ResponseDTO<Void> add{Module}(@Valid @RequestBody {Module}AddForm addForm) {
        {moduleVar}Service.add{Module}(addForm);
        return ResponseDTO.ok();
    }
}

// Serviceæ¨¡æ¿
@Service
@Transactional(rollbackFor = Exception.class)
public class {Module}ServiceImpl implements {Module}Service {

    @Resource
    private {Module}Manager {moduleVar}Manager;

    @Override
    public void add{Module}({Module}AddForm addForm) {
        {moduleVar}Manager.add{Module}(addForm);
    }
}

// Manageræ¨¡æ¿
public class {Module}ManagerImpl implements {Module}Manager {

    private final {Module}Dao {moduleVar}Dao;

    public {Module}ManagerImpl({Module}Dao {moduleVar}Dao) {
        this.{moduleVar}Dao = {moduleVar}Dao;
    }

    public void add{Module}({Module}AddForm addForm) {
        // å¤æ‚ä¸šåŠ¡é€»è¾‘ç¼–æ’
    }
}

// é…ç½®æ¨¡æ¿
@Configuration
public class {Module}ManagerConfiguration {

    @Bean
    @ConditionalOnMissingBean({Module}Manager.class)
    public {Module}Manager {moduleVar}Manager({Module}Dao {moduleVar}Dao) {
        return new {Module}ManagerImpl({moduleVar}Dao);
    }
}
```

### 7.2 è´¨é‡æ£€æŸ¥æ¸…å•

#### ä»£ç æäº¤å‰æ£€æŸ¥
- [ ] åŒ…å‘½åç¬¦åˆè§„èŒƒï¼ˆæ— é‡å¤å‘½åï¼‰
- [ ] Entityç»§æ‰¿BaseEntity
- [ ] Managerä½¿ç”¨çº¯Javaç±»
- [ ] Beanæ­£ç¡®æ³¨å†Œåˆ°Springå®¹å™¨
- [ ] Importè¯­å¥æ­£ç¡®æ— è¯¯
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡

#### æ¶æ„å®¡æŸ¥æ¸…å•
- [ ] éµå¾ªå››å±‚æ¶æ„è§„èŒƒ
- [ ] ä¾èµ–æ³¨å…¥ä½¿ç”¨@Resource
- [ ] äº‹åŠ¡ç®¡ç†é…ç½®æ­£ç¡®
- [ ] å¼‚å¸¸å¤„ç†ç»Ÿä¸€è§„èŒƒ
- [ ] æ—¥å¿—è®°å½•è§„èŒƒå®Œæ•´

---

## ğŸ¯ å…«ã€æ€»ç»“ä¸å»ºè®®

### 8.1 æ ¸å¿ƒç»“è®º

IOE-DREAMé¡¹ç›®çš„åŒ…ç›®å½•ç»“æ„å­˜åœ¨æ˜æ˜¾çš„ä¼˜åŒ–ç©ºé—´ï¼Œä¸»è¦é›†ä¸­åœ¨é‡å¤åŒ…åã€Entityåˆ†æ•£å­˜å‚¨ã€Managerå±‚ä¸è§„èŒƒç­‰é—®é¢˜ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„é‡æ„ï¼Œå¯ä»¥æ˜¾è‘—æå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚

### 8.2 å…³é”®æˆåŠŸå› ç´ 

1. **æ¶æ„å¸ˆä¸»å¯¼**ï¼šç¡®ä¿é‡æ„æ–¹å‘ç¬¦åˆæ•´ä½“æ¶æ„è§„åˆ’
2. **åˆ†æ­¥å®æ–½**ï¼šé¿å…å¤§è§„æ¨¡å˜æ›´å¸¦æ¥çš„é£é™©
3. **è‡ªåŠ¨åŒ–æ”¯æŒ**ï¼šæä¾›å®Œå–„çš„å·¥å…·å’Œè„šæœ¬æ”¯æŒ
4. **è´¨é‡ä¿éšœ**ï¼šå»ºç«‹å®Œå–„çš„æ£€æŸ¥å’ŒéªŒè¯æœºåˆ¶
5. **å›¢é˜Ÿåä½œ**ï¼šç¡®ä¿æ‰€æœ‰å¼€å‘äººå‘˜ç†è§£å¹¶éµå¾ªæ–°è§„èŒƒ

### 8.3 é•¿æœŸä»·å€¼

è¿™æ¬¡é‡æ„ä¸ä»…è§£å†³äº†å½“å‰çš„æŠ€æœ¯å€ºåŠ¡ï¼Œæ›´ä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†åŸºç¡€ï¼š
- **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„åŒ…ç»“æ„é™ä½ç»´æŠ¤æˆæœ¬
- **å¯æ‰©å±•æ€§**ï¼šæ ‡å‡†åŒ–çš„æ¶æ„æ”¯æŒå¿«é€Ÿä¸šåŠ¡è¿­ä»£
- **å›¢é˜Ÿæ•ˆç‡**ï¼šç»Ÿä¸€çš„å¼€å‘è§„èŒƒæå‡åä½œæ•ˆç‡
- **æŠ€æœ¯å…ˆè¿›æ€§**ï¼šç¬¦åˆä¸šç•Œæœ€ä½³å®è·µå’Œè®¾è®¡åŸåˆ™

### 8.4 æœ€ç»ˆå»ºè®®

**ç«‹å³è¡ŒåŠ¨**ï¼šæŒ‰ç…§P0â†’P1â†’P2çš„ä¼˜å…ˆçº§ï¼Œç«‹å³å¯åŠ¨åŒ…ç›®å½•ç»“æ„ä¼˜åŒ–å·¥ä½œã€‚

**æŒç»­æ”¹è¿›**ï¼šå»ºç«‹åŒ…ç»“æ„è§„èŒƒçš„é•¿æ•ˆç»´æŠ¤æœºåˆ¶ï¼Œå®šæœŸè¯„ä¼°å’Œä¼˜åŒ–ã€‚

**çŸ¥è¯†ä¼ æ‰¿**ï¼šé€šè¿‡æ–‡æ¡£ã€åŸ¹è®­ã€ä»£ç ç¤ºä¾‹ç­‰æ–¹å¼ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜æŒæ¡æ–°çš„å¼€å‘è§„èŒƒã€‚

---

**æŠ¥å‘Šç¼–åˆ¶**ï¼šIOE-DREAMæ¶æ„å§”å‘˜ä¼š
**å®¡æ ¸äºº**ï¼šè€ç‹ï¼ˆæ¶æ„å¸ˆå›¢é˜Ÿï¼‰
**ç”Ÿæ•ˆæ—¥æœŸ**ï¼š2025-01-15
**ç‰ˆæœ¬**ï¼šv1.0