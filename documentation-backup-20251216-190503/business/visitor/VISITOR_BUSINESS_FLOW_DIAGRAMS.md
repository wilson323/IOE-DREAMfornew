# IOE-DREAM 访客管理业务流程图

> **文档版本**: v1.0.0
> **创建日期**: 2025-12-16
> **业务模块**: 访客管理
> **流程类型**: 核心业务流程
> **关联系统**: 门禁、考勤、视频、OA

---

## 📋 流程图总览

| 流程名称 | 状态 | 优先级 | 关联模块 |
|---------|------|--------|---------|
| 访客预约流程 | ✅ 已实现 | P0 | 门禁、OA |
| 访客登记流程 | ⚠️ 部分实现 | P0 | 身份验证 |
| 访客通行流程 | ✅ 已实现 | P0 | 门禁、视频 |
| 访客权限管理流程 | ⚠️ 部分实现 | P0 | 门禁、考勤 |
| 访客黑名单流程 | ✅ 已实现 | P0 | 安全系统 |
| 访客轨迹追踪流程 | ❌ 未实现 | P1 | 视频、门禁 |

---

## 🔄 1. 访客预约流程图

### 1.1 流程概述
**流程名称**: 访客预约申请审批流程
**流程类型**: 核心业务流程
**预计时长**: 5-30分钟
**涉及角色**: 访客、被访者、审批人、前台管理员

### 1.2 详细流程图

```mermaid
flowchart TD
    A[访客发起预约] --> B{填写预约信息}
    B --> C[选择被访者]
    C --> D[选择访问时间]
    D --> E[选择访问区域]
    E --> F[上传访客证件]
    F --> G{验证信息完整性}

    G -->|不完整| H[返回修改]
    H --> B

    G -->|完整| I[提交预约申请]
    I --> J[系统自动验证]

    J --> K{验证通过?}
    K -->|失败| L[显示错误信息]
    L --> B

    K -->|成功| M[生成预约单号]
    M --> N[发送通知给被访者]

    N --> O{需要审批?}
    O -->|否| P[预约自动通过]
    O -->|是| Q[分配给审批人]

    Q --> R[审批人审核]
    R --> S{审批结果}

    S -->|通过| T[预约通过]
    S -->|拒绝| U[预约拒绝]
    S -->|转办| V[转交给其他审批人]

    T --> W[发送通过通知]
    U --> X[发送拒绝通知]
    V --> R

    W --> Y[生成访问凭证]
    X --> Z[结束]
    Y --> Z
```

### 1.3 流程节点说明

| 节点 | 处理人 | 处理内容 | 系统操作 |
|------|--------|----------|----------|
| 填写预约信息 | 访客 | 访客姓名、电话、身份证号、来访事由 | 表单验证 |
| 选择被访者 | 访客 | 搜索/选择内部员工 | 员工信息查询 |
| 选择访问时间 | 访客 | 预约时间段选择 | 时间冲突检查 |
| 选择访问区域 | 访客 | 访问目的区域选择 | 权限验证 |
| 上传访客证件 | 访客 | 身份证照片、人脸照片 | 文件上传存储 |
| 信息验证 | 系统 | 表单数据完整性检查 | 自动验证 |
| 审批人审核 | 审批人 | 访客信息真实性确认 | 审批记录 |
| 生成访问凭证 | 系统 | 二维码、临时卡片 | 凭证生成 |

### 1.4 异常处理流程

```mermaid
flowchart TD
    A[异常发生] --> B{异常类型}
    B -->|时间冲突| C[显示可用时间段]
    B -->|权限不足| D[提示联系管理员]
    B -->|信息错误| E[高亮错误字段]
    B -->|系统错误| F[记录错误日志]

    C --> G[用户重新选择]
    D --> H[客服介入]
    E --> I[用户修正信息]
    F --> J[技术支持处理]

    G --> K[继续流程]
    H --> L[手动处理]
    I --> K
    J --> K
```

---

## 👤 2. 访客登记流程图

### 2.1 流程概述
**流程名称**: 访客现场登记核验流程
**流程类型**: 核心操作流程
**预计时长**: 2-10分钟
**涉及角色**: 前台管理员、访客、被访者

### 2.2 详细流程图

```mermaid
flowchart TD
    A[访客到达前台] --> B[出示预约二维码]
    B --> C[前台扫描二维码]

    C --> D{预约有效?}
    D -->|无效| E[检查是否有预约记录]
    E --> F[手动查找预约]
    F --> G{找到预约?}
    G -->|无| H[引导访客现场预约]
    G -->|有| I[显示预约信息]

    D -->|有效| I
    H --> I

    I --> J[核实访客身份]
    J --> K[比对身份证件]
    K --> L[人脸识别验证]

    L --> M{身份匹配?}
    M -->|不匹配| N[拒绝访问]
    M -->|匹配| O[确认访问权限]

    O --> P[生成临时通行证]
    P --> Q[发放访客卡片]
    Q --> R[记录访客信息]
    R --> S[通知被访者]

    S --> T[访客通行]
    T --> U[结束]

    N --> V[记录异常]
    V --> U
```

### 2.3 身份验证详细子流程

```mermaid
flowchart TD
    A[开始身份验证] --> B[OCR识别身份证]
    B --> C[提取身份信息]
    C --> D[人脸检测]
    D --> E[特征提取]

    E --> F{证件照片质量}
    F -->|低质量| G[提示重新拍摄]
    F -->|高质量| H[活体检测]

    G --> I[重新拍摄]
    I --> D

    H --> J{活体检测通过}
    J -->|失败| K[拒绝访问]
    J -->|通过| L[与预留照片比对]

    L --> M{相似度 >= 85%?}
    M -->|不匹配| K
    M -->|匹配| N[验证通过]
```

### 2.4 现场预约子流程

```mermaid
flowchart TD
    A[启动现场预约] --> B[收集访客信息]
    B --> C[收集被访者信息]
    C --> D[收集访问事由]
    D --> E[收集访问时间]
    E --> F[快速审批流程]

    F --> G[联系被访者确认]
    G --> H{被访者确认?}
    H -->|同意| I[立即通过预约]
    H -->|拒绝| J[拒绝预约]
    H -->|无人接听| K[联系部门主管]

    I --> L[生成临时权限]
    J --> M[记录拒绝原因]
    K --> N{主管确认?}

    N -->|同意| I
    N -->|拒绝| M
```

---

## 🚪 3. 访客通行流程图

### 3.1 流程概述
**流程名称**: 访客门禁通行验证流程
**流程类型**: 核心操作流程
**预计时长**: 5-15秒
**涉及角色**: 访客、门禁系统、监控系统

### 3.2 详细流程图

```mermaid
flowchart TD
    A[访客到达门禁] --> B[刷卡/扫码/人脸识别]

    B --> C{验证方式}
    C -->|刷卡| D[读取卡片信息]
    C -->|扫码| E[扫描二维码]
    C -->|人脸| F[人脸识别]

    D --> G[验证卡片有效性]
    E --> H[验证二维码有效性]
    F --> I[验证人脸特征]

    G --> J{卡片有效?}
    H --> K{二维码有效?}
    I --> L{人脸匹配?}

    J -->|无效| M[拒绝通行]
    K -->|无效| M
    L -->|不匹配| M

    J -->|有效| N[检查访问权限]
    K -->|有效| N
    L -->|匹配| N

    N --> O{权限验证}
    O -->|无权限| M
    O -->|权限有效| P[检查时间限制]

    P --> Q{时间有效?}
    Q -->|已过期| M
    Q -->|有效| R[检查区域权限]

    R --> S{区域权限}
    S -->|无权限| M
    S -->|权限足够| T[执行开门动作]

    T --> U[记录通行事件]
    U --> V[联动视频录像]
    V --> W[更新访问次数]
    W --> X[发送通行通知]
    X --> Y[访客进入]
    Y --> Z[结束]

    M --> AA[拒绝事件处理]
    AA --> AB[记录拒绝原因]
    AB --> AC[发送异常通知]
    AC --> Z
```

### 3.3 多级权限验证流程

```mermaid
flowchart TD
    A[开始权限验证] --> B[基础权限检查]
    B --> C{基础权限通过?}
    C -->|失败| D[拒绝访问]

    C -->|通过| E[区域权限检查]
    E --> F{区域权限通过?}
    F -->|失败| D

    F -->|通过| G[时间权限检查]
    G --> H{时间权限有效?}
    H -->|无效| D

    H -->|有效| I[次数权限检查]
    I --> J{次数限制有效?}
    J -->|超限| D

    J -->|有效| K[反潜回检查]
    K --> L{反潜回通过?}
    L -->|触发| M[反潜回处理]

    L -->|通过| N[多因子验证]
    N --> O{多因子通过?}
    O -->|失败| D

    O -->|通过| P[权限验证通过]
    M --> Q[权限拒绝]
```

### 3.4 异常处理流程

```mermaid
flowchart TD
    A[检测到异常] --> B{异常类型}
    B -->|设备故障| C[启用备用验证方式]
    B -->|网络异常| D[使用本地缓存验证]
    B -->|权限异常| E[记录安全事件]
    B -->|系统异常| F[启用紧急通行模式]

    C --> G[人工验证处理]
    D --> H[网络恢复后同步]
    E --> I[安全事件上报]
    F --> J[紧急日志记录]

    G --> K[验证结果处理]
    H --> L[数据同步处理]
    I --> M[安全事件处理]
    J --> N[系统恢复处理]

    K --> O[继续或拒绝]
    L --> O
    M --> O
    N --> O
```

---

## 🔐 4. 访客权限管理流程图

### 4.1 流程概述
**流程名称**: 访客权限动态管理流程
**流程类型**: 管理流程
**预计时长**: 实时
**涉及角色**: 管理员、被访者、访客

### 4.2 详细流程图

```mermaid
flowchart TD
    A[权限管理请求] --> B{权限类型}

    B -->|新增权限| C[创建权限策略]
    B -->|修改权限| D[更新权限策略]
    B -->|撤销权限| E[立即撤销权限]
    B -->|延期权限| F[延长权限期限]

    C --> G[设置权限参数]
    D --> G
    E --> H[权限失效处理]
    F --> I[期限延期处理]

    G --> J[权限规则验证]
    H --> K[清理相关数据]
    I --> L[更新有效期]

    J --> M{验证通过?}
    K --> N[通知相关人员]
    L --> N

    M -->|失败| O[返回错误信息]
    M -->|通过| P[执行权限操作]

    P --> Q[更新权限数据库]
    Q --> R[更新缓存数据]
    R --> S[同步到门禁设备]
    S --> T[记录操作日志]
    T --> U[发送权限通知]
    U --> V[权限操作完成]

    O --> W[结束]
    N --> W
    V --> W
```

### 4.3 权限参数配置流程

```mermaid
flowchart TD
    A[权限参数配置] --> B[访问区域选择]
    B --> C[时间范围设置]
    C --> D[访问次数限制]
    D --> E[权限级别设置]
    E --> F[安全策略配置]

    F --> G[多因子验证要求]
    G --> H[反潜回规则]
    H --> I[联动规则设置]
    I --> J[监控告警配置]

    J --> K[参数验证]
    K --> L{参数有效?}
    L -->|无效| M[显示错误提示]
    L -->|有效| N[保存配置]

    M --> O[修正参数]
    O --> A
    N --> P[应用权限策略]
    P --> Q[配置完成]
```

---

## 🚨 5. 访客黑名单流程图

### 5.1 流程概述
**流程名称**: 访客黑名单管理流程
**流程类型**: 安全管理流程
**预计时长**: 实时
**涉及角色**: 安全员、管理员、系统

### 5.2 详细流程图

```mermaid
flowchart TD
    A[黑名单管理请求] --> B{操作类型}

    B -->|添加黑名单| C[黑名单信息录入]
    B -->|查询黑名单| D[黑名单状态查询]
    B -->|移除黑名单| E[黑名单移除处理]
    B -->|批量检查| F[批量状态检查]

    C --> G[身份信息验证]
    G --> H[黑名单原因录入]
    H --> I[黑名单类型选择]
    I --> J[生效时间设置]

    J --> K[规则验证]
    K --> L{验证通过?}
    L -->|失败| M[返回错误信息]
    L -->|通过| N[添加到黑名单]

    N --> O[通知相关系统]
    O --> P[记录操作日志]
    P --> Q[更新黑名单状态]

    D --> R[输入查询条件]
    R --> S[黑名单匹配查询]
    S --> T[返回查询结果]

    E --> U[移除原因录入]
    U --> V[权限验证]
    V --> W{权限验证通过?}
    W -->|失败| X[拒绝操作]
    W -->|通过| Y[执行移除操作]

    Y --> Z[清理相关数据]
    Z --> AA[发送移除通知]

    F --> BB[批量条件验证]
    BB --> CC[并行查询处理]
    CC --> DD[返回批量结果]

    Q --> EE[操作完成]
    T --> EE
    AA --> EE
    DD --> EE
    X --> EE
    M --> FF[结束]
```

### 5.3 黑名单类型决策流程

```mermaid
flowchart TD
    A[确定黑名单类型] --> B{违规严重程度}

    B -->|轻微违规| C[警告名单]
    B -->|一般违规| D[临时黑名单]
    B -->|严重违规| E[永久黑名单]

    C --> F[设置警告期]
    F --> G[自动监控]
    G --> H[警告通知]

    D --> I[设置临时期限]
    I --> J[到期自动移除]
    J --> K[临时权限限制]

    E --> L[永久权限限制]
    L --> M[高级安全监控]
    M --> N[多系统联动]

    H --> O[结束决策]
    K --> O
    N --> O
```

---

## 📍 6. 访客轨迹追踪流程图

### 6.1 流程概述
**流程名称**: 访客全程轨迹追踪流程
**流程类型**: 监控分析流程
**预计时长**: 实时
**涉及角色**: 安保人员、监控系统、分析引擎

### 6.2 详细流程图

```mermaid
flowchart TD
    A[访客进入园区] --> B[开始轨迹追踪]
    B --> C[采集通行记录]
    C --> D[记录进入时间地点]
    D --> E[启动视频追踪]

    E --> F[多摄像头联动]
    F --> G[实时人脸识别]
    G --> H[轨迹点记录]

    H --> I{访客移动?}
    I -->|静止| J[检查超时]
    I -->|移动| K[轨迹更新]

    J --> L{超时告警?}
    L -->|是| M[发送超时告警]
    L -->|否| N[继续监控]

    K --> O[更新位置信息]
    O --> P[计算移动路径]
    P --> Q[区域权限检查]

    Q --> R{权限违规?}
    R -->|是| S[发送违规告警]
    R -->|否| T[正常追踪]

    S --> U[紧急响应]
    T --> V[继续监控]

    U --> W[记录事件]
    V --> X[结束监控]

    M --> Y[记录告警]
    N --> Z{访客离开?}

    Y --> Z
    Z -->|否| I
    Z -->|是| AA[结束追踪]

    W --> BB[轨迹报告生成]
    AA --> BB
    X --> CC[生成追踪报告]
    BB --> DD[数据存储]
    CC --> DD
    DD --> EE[结束]
```

### 6.3 智能分析流程

```mermaid
flowchart TD
    A[轨迹数据分析] --> B[行为模式识别]
    B --> C[异常行为检测]
    C --> D[风险评估计算]

    D --> E{风险等级}
    E -->|低风险| F[正常监控]
    E -->|中风险| G[重点监控]
    E -->|高风险| H[紧急响应]

    F --> I[数据记录]
    G --> J[预警通知]
    H --> K[告警处理]

    I --> L[分析完成]
    J --> M[持续观察]
    K --> N[应急处理]

    L --> O[生成分析报告]
    M --> O
    N --> O
```

---

## 📊 7. 流程图使用说明

### 7.1 流程图符号说明

| 符号 | 含义 | 说明 |
|------|------|------|
| ⭕️ | 开始/结束 | 流程的起点或终点 |
| ▢ | 操作步骤 | 具体的业务操作 |
| 🔶 | 判断条件 | 需要决策的节点 |
| ⬆ | 数据流向 | 流程执行方向 |
| 🔴 | 异常/错误 | 异常情况处理 |
| 🟡 | 警告/提示 | 需要关注的事件 |

### 7.2 颜色说明

| 颜色 | 状态 | 含义 |
|------|------|------|
| 🟢 | 已实现 | 功能已完成开发 |
| 🟡 | 部分实现 | 功能部分完成 |
| 🔴 | 未实现 | 功能尚未实现 |
| 🔵 | 计划中 | 计划后续实现 |

### 7.3 使用建议

1. **流程执行顺序**: 按照优先级顺序执行相关流程
2. **异常处理**: 每个流程都包含完整的异常处理机制
3. **系统集成**: 注意流程间的数据传递和状态同步
4. **性能优化**: 关键节点需要考虑性能和并发处理
5. **安全防护**: 所有身份验证环节都需要多重防护

---

## 🔗 8. 集成关系图

### 8.1 系统间集成

```mermaid
graph TB
    subgraph "访客管理"
        A1[访客预约]
        A2[访客登记]
        A3[访客通行]
        A4[权限管理]
        A5[黑名单]
        A6[轨迹追踪]
    end

    subgraph "门禁系统"
        B1[权限验证]
        B2[开门控制]
        B3[通行记录]
        B4[反潜回]
    end

    subgraph "考勤系统"
        C1[考勤记录]
        C2[排班管理]
        C3[统计报表]
    end

    subgraph "视频系统"
        D1[实时监控]
        D2[录像回放]
        D3[人脸识别]
        D4[AI分析]
    end

    subgraph "OA系统"
        E1[审批流程]
        E2[组织架构]
        E3[权限管理]
    end

    A3 --> B1
    A4 --> B2
    A3 --> B3
    A6 --> D1
    A6 --> D2
    A3 --> C1
    A1 --> E1
    A2 --> E2
    A4 --> E3
```

### 8.2 数据流向

```mermaid
flowchart LR
    A[访客信息] --> B[身份验证]
    B --> C[权限分配]
    C --> D[通行验证]
    D --> E[轨迹记录]
    E --> F[数据分析]

    G[设备数据] --> H[状态同步]
    H --> I[权限检查]
    I --> D

    J[视频数据] --> K[人脸识别]
    K --> L[行为分析]
    L --> E
```

---

## 📝 9. 文档维护

### 9.1 版本控制

- **当前版本**: v1.0.0
- **维护责任**: 访客模块团队
- **审核周期**: 每月一次
- **更新触发**: 业务流程变更时

### 9.2 更新日志

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| v1.0.0 | 2025-12-16 | 初始版本创建 | Claude AI |

### 9.3 相关文档

- [访客模块架构设计](./VISITOR_ARCHITECTURE_DESIGN.md)
- [访客数据库设计](./VISITOR_DATABASE_DESIGN.md)
- [访客API接口文档](./VISITOR_API_DOCUMENTATION.md)
- [访客前端设计规范](./VISITOR_FRONTEND_DESIGN.md)

---

**📞 技术支持**: IOE-DREAM开发团队
**📧 邮件地址**: support@ioedream.com
**🌐 项目地址**: https://github.com/IOE-DREAM/visitor-service