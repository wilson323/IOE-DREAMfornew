# 联动配置管理页面功能与布局文档

## 页面概述
联动配置管理页面是智能视频监控系统中的核心功能模块，用于配置和管理设备之间的联动关系。该页面实现了当特定触发条件满足时，自动执行相应的联动动作（如录像、抓拍、推送、报警等）。页面基于SmartAdmin前端框架构建，采用Vue3 + Ant Design Vue技术栈，提供完整的联动规则配置、触发条件设置、执行动作定义、规则测试等功能。支持多种触发类型（告警触发、设备状态变化、时间触发）和多种执行动作（视频录像、图片抓拍、消息推送、声光报警、云台预置位调用等）。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **图表库**: Chart.js（用于联动统计报表）

### 项目文件组织结构
```
src/views/business/smart-video/
├── linkage-config.vue               # 联动配置主页面
├── components/
│   ├── LinkageForm.vue             # 联动规则表单组件（新增/编辑）
│   ├── TriggerConditionTree.vue   # 触发条件树形选择器
│   ├── InputPointSelector.vue     # 输入点选择器
│   ├── OutputActionConfig.vue     # 联动输出动作配置组件
│   ├── PersonSelector.vue         # 人员选择器
│   ├── LinkageStatistics.vue      # 联动统计图表组件
│   └── LinkageTestModal.vue       # 规则测试弹窗
├── mock/
│   └── linkage-mock-data.js        # 模拟数据
└── api/
    └── linkage-api.js               # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/linkage-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const linkageApi = {
  // 查询联动条件列表
  queryLinkageList: (params) => postRequest('/linkage/query', params),

  // 添加联动条件
  addLinkage: (params) => postRequest('/linkage/add', params),

  // 更新联动条件
  updateLinkage: (params) => postRequest('/linkage/update', params),

  // 删除联动条件
  deleteLinkage: (id) => getRequest(`/linkage/delete/${id}`),

  // 批量删除联动条件
  batchDeleteLinkage: (ids) => postRequest('/linkage/batch/delete', ids),

  // 启用/禁用联动
  toggleLinkageStatus: (params) => postRequest('/linkage/toggle-status', params),

  // 获取设备类型的触发条件树
  getTriggerConditions: (deviceType) => getRequest(`/linkage/trigger-conditions/${deviceType}`),

  // 获取输入点列表
  getInputPoints: (params) => postRequest('/linkage/input-points', params),

  // 查询人员列表
  queryPersonList: (params) => postRequest('/person/query', params),

  // 获取联动关联人员
  getLinkagePersons: (linkageId) => getRequest(`/linkage/persons/${linkageId}`),

  // 添加关联人员
  addLinkagePersons: (params) => postRequest('/linkage/persons/add', params),

  // 移除关联人员
  removeLinkagePerson: (params) => postRequest('/linkage/persons/remove', params),

  // 获取联动统计数据
  getLinkageStatistics: () => getRequest('/linkage/statistics'),

  // 测试联动规则
  testLinkageRule: (params) => postRequest('/linkage/test', params),

  // 获取联动执行历史
  getLinkageHistory: (params) => postRequest('/linkage/history', params),

  // 获取视频设备列表（用于视频联动）
  getVideoDeviceList: (params) => postRequest('/device/video/list', params),

  // 获取门禁设备列表（用于门禁联动）
  getAccessDeviceList: (params) => postRequest('/device/access/list', params),

  // 获取电梯设备列表（用于电梯联动）
  getElevatorDeviceList: (params) => postRequest('/device/elevator/list', params),

  // 获取报警设备列表（用于报警联动）
  getAlarmDeviceList: (params) => postRequest('/device/alarm/list', params),

  // 获取电视墙列表（用于电视墙联动）
  getTvWallList: (params) => postRequest('/device/tvwall/list', params),
};
```

## ⚠️ 开发注意事项与常见错误避免

### 1. Vue 3 组件开发注意事项

#### ❌ 错误用法：在 props 上使用 v-model
```vue
<!-- 错误：不能在props上使用v-model -->
<template>
  <a-modal v-model:open="visible" title="联动配置">
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean  // props是只读的，不能直接绑定v-model
});
</script>
```

#### ✅ 正确用法：使用 :open 绑定和事件
```vue
<!-- 正确：使用属性绑定和事件监听 -->
<template>
  <a-modal
    :open="visible"
    title="联动配置"
    @update:open="handleUpdateVisible"
    @cancel="handleCancel"
  >
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean
});

const emit = defineEmits(['update:visible', 'cancel', 'confirm']);

const handleUpdateVisible = (value) => {
  emit('update:visible', value);
};

const handleCancel = () => {
  emit('update:visible', false);
  emit('cancel');
};
</script>
```

### 2. 图标导入注意事项

#### ❌ 错误：使用不存在的图标
```vue
<!-- 错误：某些图标可能不存在 -->
<script setup>
import { LinkageOutlined } from '@ant-design/icons-vue';  // ❌ 不存在
import { TriggerOutlined } from '@ant-design/icons-vue';  // ❌ 不存在
</script>
```

#### ✅ 正确：使用存在的图标
```vue
<!-- 正确：使用实际存在的图标 -->
<script setup>
import {
  LinkOutlined,              // ✅ 链接（联动）
  ApiOutlined,               // ✅ 接口/联动
  ThunderboltOutlined,       // ✅ 触发/闪电
  BellOutlined,              // ✅ 告警/通知
  VideoCameraOutlined,       // ✅ 视频
  CameraOutlined,            // ✅ 抓拍
  ReconciliationOutlined,    // ✅ 录像/记录
  UserOutlined,              // ✅ 用户/人员
  TeamOutlined,              // ✅ 团队/多人
  SearchOutlined,            // ✅ 搜索
  PlusOutlined,              // ✅ 新增
  EditOutlined,              // ✅ 编辑
  DeleteOutlined,            // ✅ 删除
  ReloadOutlined,            // ✅ 刷新
  BarChartOutlined,          // ✅ 图表
  UnorderedListOutlined,     // ✅ 列表
  SettingOutlined,           // ✅ 设置
  CheckCircleOutlined,       // ✅ 成功/启用
  CloseCircleOutlined,       // ✅ 失败/禁用
  ExclamationCircleOutlined, // ✅ 警告
  ClockCircleOutlined,       // ✅ 时间
  EnvironmentOutlined,       // ✅ 位置
  RightOutlined,             // ✅ 展开箭头
  DownOutlined,              // ✅ 折叠箭头
  CaretRightOutlined,        // ✅ 小箭头
  PlayCircleOutlined,        // ✅ 播放/测试
  StopOutlined,              // ✅ 停止
} from '@ant-design/icons-vue';
</script>
```

### 3. 联动条件配置注意事项

#### ✅ 触发条件数据结构
```javascript
// 触发条件树形结构
const triggerConditionTree = {
  // 一级分类
  category: '移动侦测',
  // 二级分类
  subCategories: [
    {
      name: '入侵检测',
      // 三级具体条件
      items: [
        { value: 'intrusion_region', label: '区域入侵' },
        { value: 'cross_line', label: '越界检测' },
        { value: 'enter_region', label: '进入区域' },
        { value: 'leave_region', label: '离开区域' },
      ]
    }
  ]
};
```

#### ✅ 联动规则数据结构
```javascript
const linkageRule = {
  id: 'link001',
  name: '周界入侵联动',
  description: '检测到移动时触发录像和报警',
  status: 'enabled', // enabled | disabled
  deviceType: 'IVS1800',

  // 触发条件配置
  triggerConditions: [
    {
      conditionType: 'intrusion_region',
      conditionName: '区域入侵',
      params: {
        sensitivity: 80,
        minTargetSize: 100,
      }
    }
  ],

  // 条件逻辑
  conditionLogic: 'AND', // AND | OR

  // 输入点配置
  inputPoints: [
    { id: 'input001', name: '前门输入点', type: 'sensor' }
  ],

  // 输出动作配置
  outputActions: {
    // 视频联动
    video: {
      enabled: true,
      popupVideo: true,      // 弹出视频
      startRecording: true,  // 开始录像
      captureImage: true,    // 抓拍图片
      recordDuration: 30,    // 录像时长(秒)
      captureCount: 3,       // 抓拍次数
      devices: ['cam001', 'cam002'], // 关联摄像头
    },
    // 门禁联动
    access: {
      enabled: false,
      action: 'open', // open | close | lock | unlock
      devices: [],
    },
    // 电梯联动
    elevator: {
      enabled: false,
      action: 'call', // call | stop | emergency
      devices: [],
    },
    // 报警联动
    alarm: {
      enabled: true,
      soundAlarm: true,      // 声音报警
      lightAlarm: true,      // 灯光报警
      pushNotification: true, // 推送通知
      devices: ['alarm001'],
    },
    // 电视墙联动
    tvWall: {
      enabled: false,
      wallId: '',
      windowId: '',
      displayDuration: 60,
    },
  },

  // 关联人员
  linkedPersons: ['person001', 'person002'],

  // 规则生效时间
  effectiveTime: {
    enabled: true,
    startTime: '00:00:00',
    endTime: '23:59:59',
    weekDays: [1, 2, 3, 4, 5, 6, 7], // 1-7 表示周一到周日
  },

  createTime: '2024-01-15 10:30:25',
  updateTime: '2024-01-30 14:35:12',
};
```

### 4. 表单验证规则

#### ✅ 完整的表单验证
```javascript
const formRules = {
  name: [
    { required: true, message: '请输入联动名称', trigger: 'blur' },
    { min: 2, max: 50, message: '联动名称长度应在2-50字符之间', trigger: 'blur' },
  ],
  deviceType: [
    { required: true, message: '请选择设备类型', trigger: 'change' },
  ],
  triggerConditions: [
    {
      validator: (rule, value) => {
        if (!value || value.length === 0) {
          return Promise.reject('请选择至少一个触发条件');
        }
        return Promise.resolve();
      },
      trigger: 'change',
    },
  ],
  outputActions: [
    {
      validator: (rule, value) => {
        const hasEnabled = Object.values(value).some(action => action.enabled);
        if (!hasEnabled) {
          return Promise.reject('请至少启用一个联动输出');
        }
        return Promise.resolve();
      },
      trigger: 'change',
    },
  ],
};
```

## 核心功能模块

### 1. 页面布局架构

**页面采用双栏布局**:
- **左侧面板**: 联动条件列表（可切换为统计图表视图）
- **右侧面板**: 关联人员列表

**技术实现**:
```vue
<template>
  <div class="linkage-config-page">
    <!-- 页面标题栏 -->
    <div class="page-header">
      <h2 class="page-title">
        <LinkOutlined class="title-icon" />
        联动设置
      </h2>

      <a-space class="header-actions">
        <!-- 视图切换 -->
        <a-radio-group v-model:value="viewMode" button-style="solid">
          <a-radio-button value="list">
            <UnorderedListOutlined />
            列表
          </a-radio-button>
          <a-radio-button value="chart">
            <BarChartOutlined />
            图表
          </a-radio-button>
        </a-radio-group>

        <!-- 刷新按钮 -->
        <a-button @click="refreshData">
          <template #icon><ReloadOutlined /></template>
          刷新
        </a-button>
      </a-space>
    </div>

    <!-- 双栏布局主体 -->
    <div class="page-content">
      <!-- 左侧：联动条件列表/图表 -->
      <a-card class="left-panel">
        <template #title>
          <SettingOutlined />
          联动条件
        </template>
        <template #extra>
          <a-button type="primary" size="small" @click="handleAddLinkage">
            <template #icon><PlusOutlined /></template>
            新增联动
          </a-button>
        </template>

        <!-- 列表视图 -->
        <div v-if="viewMode === 'list'" class="list-view">
          <!-- 搜索栏 -->
          <div class="search-bar">
            <a-input-search
              v-model:value="searchKeyword"
              placeholder="搜索联动名称..."
              allow-clear
              @search="handleSearch"
            >
              <template #enterButton>
                <a-button>
                  <template #icon><SearchOutlined /></template>
                </a-button>
              </template>
            </a-input-search>
          </div>

          <!-- 联动列表表格 -->
          <a-table
            :columns="linkageColumns"
            :data-source="linkageList"
            :loading="tableLoading"
            :pagination="false"
            :scroll="{ y: 'calc(100vh - 400px)' }"
            row-key="id"
            :custom-row="customRow"
            :row-class-name="getRowClassName"
          >
            <template #bodyCell="{ column, record }">
              <!-- 联动名称 -->
              <template v-if="column.dataIndex === 'name'">
                <div class="linkage-name">
                  <div class="name-text">{{ record.name }}</div>
                  <div class="description-text">{{ record.description }}</div>
                </div>
              </template>

              <!-- 触发条件 -->
              <template v-else-if="column.dataIndex === 'triggerCondition'">
                <a-tag color="blue">{{ record.triggerCondition }}</a-tag>
              </template>

              <!-- 状态 -->
              <template v-else-if="column.dataIndex === 'status'">
                <a-tag :color="record.status === 'enabled' ? 'success' : 'default'">
                  <template #icon>
                    <CheckCircleOutlined v-if="record.status === 'enabled'" />
                    <CloseCircleOutlined v-else />
                  </template>
                  {{ record.status === 'enabled' ? '启用' : '禁用' }}
                </a-tag>
              </template>

              <!-- 操作 -->
              <template v-else-if="column.dataIndex === 'action'">
                <div class="action-buttons">
                  <a-button type="link" size="small" @click.stop="handleEdit(record)">
                    <EditOutlined />
                    编辑
                  </a-button>
                  <a-popconfirm
                    title="确定要删除该联动条件吗？"
                    @confirm="handleDelete(record.id)"
                  >
                    <a-button type="link" size="small" danger @click.stop>
                      <DeleteOutlined />
                      删除
                    </a-button>
                  </a-popconfirm>
                </div>
              </template>
            </template>
          </a-table>
        </div>

        <!-- 图表视图 -->
        <LinkageStatistics v-else :statistics-data="statisticsData" />
      </a-card>

      <!-- 右侧：关联人员列表 -->
      <a-card class="right-panel">
        <template #title>
          <TeamOutlined />
          关联人员
          <span class="selected-linkage-name">
            {{ selectedLinkage ? `(${selectedLinkage.name})` : '(请选择联动条件)' }}
          </span>
        </template>
        <template #extra>
          <a-button
            type="primary"
            size="small"
            :disabled="!selectedLinkage"
            @click="handleAddPerson"
          >
            <template #icon><PlusOutlined /></template>
            添加人员
          </a-button>
        </template>

        <!-- 人员搜索 -->
        <div class="search-bar">
          <a-space>
            <a-input
              v-model:value="personSearch.pin"
              placeholder="工号..."
              style="width: 150px"
            />
            <a-input
              v-model:value="personSearch.name"
              placeholder="姓名..."
              style="width: 150px"
            />
            <a-button @click="handleSearchPersons">
              <template #icon><SearchOutlined /></template>
            </a-button>
          </a-space>
        </div>

        <!-- 人员列表 -->
        <a-table
          :columns="personColumns"
          :data-source="linkedPersonList"
          :loading="personLoading"
          :pagination="false"
          :scroll="{ y: 'calc(100vh - 400px)' }"
          row-key="id"
        >
          <template #bodyCell="{ column, record }">
            <template v-if="column.dataIndex === 'action'">
              <a-button
                type="link"
                size="small"
                danger
                @click="handleRemovePerson(record.id)"
              >
                <template #icon><DeleteOutlined /></template>
                移除
              </a-button>
            </template>
          </template>
        </a-table>
      </a-card>
    </div>

    <!-- 联动配置弹窗 -->
    <LinkageForm
      v-model:visible="linkageFormVisible"
      :is-edit="isEdit"
      :linkage-data="currentLinkage"
      @success="handleFormSuccess"
      @cancel="handleFormCancel"
    />

    <!-- 人员选择弹窗 -->
    <PersonSelector
      v-model:visible="personSelectorVisible"
      :selected-person-ids="selectedPersonIds"
      @confirm="handlePersonSelected"
      @cancel="personSelectorVisible = false"
    />
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  LinkOutlined,
  UnorderedListOutlined,
  BarChartOutlined,
  ReloadOutlined,
  SettingOutlined,
  PlusOutlined,
  SearchOutlined,
  EditOutlined,
  DeleteOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  TeamOutlined,
} from '@ant-design/icons-vue';
import LinkageForm from './components/LinkageForm.vue';
import PersonSelector from './components/PersonSelector.vue';
import LinkageStatistics from './components/LinkageStatistics.vue';
import { linkageApi } from '/@/api/business/smart-video/linkage-api';

// 视图模式
const viewMode = ref('list');

// 搜索关键词
const searchKeyword = ref('');

// 联动列表
const linkageList = ref([]);
const tableLoading = ref(false);
const selectedLinkage = ref(null);

// 表格列定义
const linkageColumns = [
  {
    title: '联动名称',
    dataIndex: 'name',
    key: 'name',
    width: 250,
  },
  {
    title: '触发条件',
    dataIndex: 'triggerCondition',
    key: 'triggerCondition',
    width: 120,
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    width: 100,
  },
  {
    title: '操作',
    dataIndex: 'action',
    key: 'action',
    width: 150,
  },
];

// 人员列表
const linkedPersonList = ref([]);
const personLoading = ref(false);
const personSearch = reactive({
  pin: '',
  name: '',
});

const personColumns = [
  { title: '工号', dataIndex: 'pin', key: 'pin', width: 120 },
  { title: '姓名', dataIndex: 'name', key: 'name', width: 120 },
  { title: '部门', dataIndex: 'department', key: 'department', width: 150 },
  { title: '操作', dataIndex: 'action', key: 'action', width: 100 },
];

// 弹窗控制
const linkageFormVisible = ref(false);
const personSelectorVisible = ref(false);
const isEdit = ref(false);
const currentLinkage = ref(null);

// 统计数据
const statisticsData = ref({});

// 已选择的人员ID
const selectedPersonIds = computed(() => {
  return linkedPersonList.value.map(p => p.id);
});

// 页面初始化
onMounted(() => {
  loadLinkageList();
  loadStatistics();
});

// 加载联动列表
const loadLinkageList = async () => {
  tableLoading.value = true;
  try {
    const response = await linkageApi.queryLinkageList({
      keyword: searchKeyword.value,
    });
    if (response.code === 1) {
      linkageList.value = response.data;
    }
  } catch (error) {
    message.error('加载联动列表失败');
  } finally {
    tableLoading.value = false;
  }
};

// 加载统计数据
const loadStatistics = async () => {
  try {
    const response = await linkageApi.getLinkageStatistics();
    if (response.code === 1) {
      statisticsData.value = response.data;
    }
  } catch (error) {
    console.error('加载统计数据失败:', error);
  }
};

// 行点击事件
const customRow = (record) => {
  return {
    onClick: () => {
      selectedLinkage.value = record;
      loadLinkagePersons(record.id);
    },
  };
};

// 行样式
const getRowClassName = (record) => {
  return selectedLinkage.value?.id === record.id ? 'selected-row' : '';
};

// 加载关联人员
const loadLinkagePersons = async (linkageId) => {
  personLoading.value = true;
  try {
    const response = await linkageApi.getLinkagePersons(linkageId);
    if (response.code === 1) {
      linkedPersonList.value = response.data;
    }
  } catch (error) {
    message.error('加载关联人员失败');
  } finally {
    personLoading.value = false;
  }
};

// 搜索
const handleSearch = () => {
  loadLinkageList();
};

// 刷新数据
const refreshData = () => {
  loadLinkageList();
  loadStatistics();
  if (selectedLinkage.value) {
    loadLinkagePersons(selectedLinkage.value.id);
  }
  message.success('数据刷新成功');
};

// 新增联动
const handleAddLinkage = () => {
  isEdit.value = false;
  currentLinkage.value = null;
  linkageFormVisible.value = true;
};

// 编辑联动
const handleEdit = (record) => {
  isEdit.value = true;
  currentLinkage.value = { ...record };
  linkageFormVisible.value = true;
};

// 删除联动
const handleDelete = async (id) => {
  try {
    const response = await linkageApi.deleteLinkage(id);
    if (response.code === 1) {
      message.success('删除成功');
      loadLinkageList();
      if (selectedLinkage.value?.id === id) {
        selectedLinkage.value = null;
        linkedPersonList.value = [];
      }
    } else {
      message.error(response.msg || '删除失败');
    }
  } catch (error) {
    message.error('删除失败');
  }
};

// 表单提交成功
const handleFormSuccess = () => {
  loadLinkageList();
  loadStatistics();
};

// 表单取消
const handleFormCancel = () => {
  linkageFormVisible.value = false;
};

// 添加人员
const handleAddPerson = () => {
  if (!selectedLinkage.value) {
    message.warning('请先选择联动条件');
    return;
  }
  personSelectorVisible.value = true;
};

// 人员选择确认
const handlePersonSelected = async (selectedPersons) => {
  try {
    const response = await linkageApi.addLinkagePersons({
      linkageId: selectedLinkage.value.id,
      personIds: selectedPersons.map(p => p.id),
    });
    if (response.code === 1) {
      message.success(`成功添加 ${selectedPersons.length} 个人员`);
      loadLinkagePersons(selectedLinkage.value.id);
      personSelectorVisible.value = false;
    } else {
      message.error(response.msg || '添加失败');
    }
  } catch (error) {
    message.error('添加人员失败');
  }
};

// 移除人员
const handleRemovePerson = async (personId) => {
  try {
    const response = await linkageApi.removeLinkagePerson({
      linkageId: selectedLinkage.value.id,
      personId,
    });
    if (response.code === 1) {
      message.success('人员移除成功');
      loadLinkagePersons(selectedLinkage.value.id);
    } else {
      message.error(response.msg || '移除失败');
    }
  } catch (error) {
    message.error('移除人员失败');
  }
};

// 搜索人员
const handleSearchPersons = () => {
  if (!selectedLinkage.value) {
    message.warning('请先选择联动条件');
    return;
  }
  // 根据搜索条件过滤人员列表
  loadLinkagePersons(selectedLinkage.value.id);
};
</script>

<style lang="less" scoped>
.linkage-config-page {
  padding: 24px;
  height: 100%;
  display: flex;
  flex-direction: column;

  .page-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;

    .page-title {
      font-size: 24px;
      font-weight: bold;
      margin: 0;

      .title-icon {
        margin-right: 12px;
        color: #ff6b00;
      }
    }
  }

  .page-content {
    display: flex;
    gap: 24px;
    flex: 1;
    overflow: hidden;

    .left-panel,
    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;

      :deep(.ant-card-body) {
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
    }

    .search-bar {
      margin-bottom: 16px;
    }

    .linkage-name {
      .name-text {
        font-weight: 500;
        color: #262626;
      }

      .description-text {
        font-size: 12px;
        color: #8c8c8c;
        margin-top: 4px;
      }
    }

    .selected-linkage-name {
      margin-left: 8px;
      font-size: 14px;
      color: #8c8c8c;
      font-weight: normal;
    }
  }

  :deep(.selected-row) {
    background-color: #f0f5ff;
    border-left: 4px solid #1890ff;
  }
}
</style>
```

### 2. 联动规则表单组件（核心）

**组件路径**: `src/views/business/smart-video/components/LinkageForm.vue`

**技术实现**:
```vue
<template>
  <a-modal
    :open="visible"
    :title="isEdit ? '编辑联动条件' : '新增联动条件'"
    width="1000px"
    :confirm-loading="loading"
    :mask-closable="false"
    @ok="handleSubmit"
    @cancel="handleCancel"
  >
    <a-form
      ref="formRef"
      :model="formData"
      :rules="formRules"
      :label-col="{ span: 6 }"
      :wrapper-col="{ span: 18 }"
    >
      <!-- 基本信息 -->
      <a-divider orientation="left">基本信息</a-divider>

      <a-row :gutter="16">
        <a-col :span="12">
          <a-form-item label="联动名称" name="name">
            <a-input
              v-model:value="formData.name"
              placeholder="请输入联动名称"
            />
          </a-form-item>
        </a-col>

        <a-col :span="12">
          <a-form-item label="描述" name="description">
            <a-input
              v-model:value="formData.description"
              placeholder="请输入描述"
            />
          </a-form-item>
        </a-col>
      </a-row>

      <!-- 触发条件 -->
      <a-divider orientation="left">触发条件</a-divider>

      <a-row :gutter="16">
        <a-col :span="12">
          <a-form-item label="设备类型" name="deviceType">
            <a-select
              v-model:value="formData.deviceType"
              placeholder="请选择设备类型"
              @change="handleDeviceTypeChange"
            >
              <a-select-option value="NVR800">NVR800</a-select-option>
              <a-select-option value="IVS1800">IVS1800</a-select-option>
              <a-select-option value="ZKNVR">ZKNVR</a-select-option>
              <a-select-option value="AIBox1">AIBox1</a-select-option>
              <a-select-option value="AIBox2">AIBox2</a-select-option>
            </a-select>
          </a-form-item>
        </a-col>

        <a-col :span="12">
          <a-form-item label="条件逻辑" name="conditionLogic">
            <a-radio-group v-model:value="formData.conditionLogic">
              <a-radio value="AND">与(AND)</a-radio>
              <a-radio value="OR">或(OR)</a-radio>
            </a-radio-group>
          </a-form-item>
        </a-col>
      </a-row>

      <a-form-item label="触发条件" name="triggerConditions">
        <div class="condition-select-wrapper">
          <a-button @click="showTriggerConditionModal">
            <template #icon><ThunderboltOutlined /></template>
            选择触发条件
          </a-button>

          <div v-if="selectedTriggerConditions.length > 0" class="selected-conditions">
            <a-tag
              v-for="condition in selectedTriggerConditions"
              :key="condition.value"
              closable
              color="blue"
              @close="removeTriggerCondition(condition.value)"
            >
              {{ condition.label }}
            </a-tag>
          </div>
          <div v-else class="empty-hint">
            请选择触发条件
          </div>
        </div>
      </a-form-item>

      <!-- 输入点 -->
      <a-divider orientation="left">输入点配置</a-divider>

      <a-form-item label="输入点" name="inputPoints">
        <div class="input-point-wrapper">
          <a-button @click="showInputPointModal">
            <template #icon><ApiOutlined /></template>
            选择输入点
          </a-button>

          <div v-if="selectedInputPoints.length > 0" class="selected-points">
            <a-tag
              v-for="point in selectedInputPoints"
              :key="point.id"
              closable
              color="cyan"
              @close="removeInputPoint(point.id)"
            >
              {{ point.name }}
            </a-tag>
          </div>
          <div v-else class="empty-hint">
            请选择输入点
          </div>
        </div>
      </a-form-item>

      <!-- 联动输出 -->
      <a-divider orientation="left">联动输出</a-divider>

      <a-tabs v-model:activeKey="activeOutputTab" type="card">
        <!-- 视频联动 -->
        <a-tab-pane key="video" tab="视频联动">
          <a-form-item label="启用视频联动" name="videoEnabled">
            <a-switch v-model:checked="formData.outputActions.video.enabled" />
          </a-form-item>

          <template v-if="formData.outputActions.video.enabled">
            <a-form-item label="联动动作">
              <a-space direction="vertical" style="width: 100%">
                <a-checkbox v-model:checked="formData.outputActions.video.popupVideo">
                  弹出视频
                </a-checkbox>
                <a-checkbox v-model:checked="formData.outputActions.video.startRecording">
                  开始录像
                </a-checkbox>
                <a-checkbox v-model:checked="formData.outputActions.video.captureImage">
                  抓拍图片
                </a-checkbox>
              </a-space>
            </a-form-item>

            <a-row :gutter="16">
              <a-col :span="12">
                <a-form-item label="录像时长(秒)">
                  <a-input-number
                    v-model:value="formData.outputActions.video.recordDuration"
                    :min="10"
                    :max="180"
                    style="width: 100%"
                  />
                </a-form-item>
              </a-col>

              <a-col :span="12">
                <a-form-item label="抓拍次数">
                  <a-input-number
                    v-model:value="formData.outputActions.video.captureCount"
                    :min="1"
                    :max="10"
                    style="width: 100%"
                  />
                </a-form-item>
              </a-col>
            </a-row>

            <a-form-item label="关联摄像头">
              <a-select
                v-model:value="formData.outputActions.video.devices"
                mode="multiple"
                placeholder="请选择关联摄像头"
                style="width: 100%"
              >
                <a-select-option value="cam001">前门摄像头-001</a-select-option>
                <a-select-option value="cam002">大厅摄像头-002</a-select-option>
                <a-select-option value="cam003">走廊摄像头-003</a-select-option>
              </a-select>
            </a-form-item>
          </template>
        </a-tab-pane>

        <!-- 门禁联动 -->
        <a-tab-pane key="access" tab="门禁联动">
          <a-form-item label="启用门禁联动" name="accessEnabled">
            <a-switch v-model:checked="formData.outputActions.access.enabled" />
          </a-form-item>

          <template v-if="formData.outputActions.access.enabled">
            <a-form-item label="联动动作">
              <a-radio-group v-model:value="formData.outputActions.access.action">
                <a-radio value="open">开门</a-radio>
                <a-radio value="close">关门</a-radio>
                <a-radio value="lock">上锁</a-radio>
                <a-radio value="unlock">解锁</a-radio>
              </a-radio-group>
            </a-form-item>

            <a-form-item label="关联门禁">
              <a-select
                v-model:value="formData.outputActions.access.devices"
                mode="multiple"
                placeholder="请选择关联门禁"
                style="width: 100%"
              >
                <a-select-option value="access001">前门门禁</a-select-option>
                <a-select-option value="access002">后门门禁</a-select-option>
              </a-select>
            </a-form-item>
          </template>
        </a-tab-pane>

        <!-- 电梯联动 -->
        <a-tab-pane key="elevator" tab="电梯联动">
          <a-form-item label="启用电梯联动" name="elevatorEnabled">
            <a-switch v-model:checked="formData.outputActions.elevator.enabled" />
          </a-form-item>

          <template v-if="formData.outputActions.elevator.enabled">
            <a-form-item label="联动动作">
              <a-radio-group v-model:value="formData.outputActions.elevator.action">
                <a-radio value="call">呼叫</a-radio>
                <a-radio value="stop">停止</a-radio>
                <a-radio value="emergency">紧急停止</a-radio>
              </a-radio-group>
            </a-form-item>

            <a-form-item label="关联电梯">
              <a-select
                v-model:value="formData.outputActions.elevator.devices"
                mode="multiple"
                placeholder="请选择关联电梯"
                style="width: 100%"
              >
                <a-select-option value="elevator001">1号电梯</a-select-option>
                <a-select-option value="elevator002">2号电梯</a-select-option>
              </a-select>
            </a-form-item>
          </template>
        </a-tab-pane>

        <!-- 报警联动 -->
        <a-tab-pane key="alarm" tab="报警联动">
          <a-form-item label="启用报警联动" name="alarmEnabled">
            <a-switch v-model:checked="formData.outputActions.alarm.enabled" />
          </a-form-item>

          <template v-if="formData.outputActions.alarm.enabled">
            <a-form-item label="报警方式">
              <a-space direction="vertical" style="width: 100%">
                <a-checkbox v-model:checked="formData.outputActions.alarm.soundAlarm">
                  声音报警
                </a-checkbox>
                <a-checkbox v-model:checked="formData.outputActions.alarm.lightAlarm">
                  灯光报警
                </a-checkbox>
                <a-checkbox v-model:checked="formData.outputActions.alarm.pushNotification">
                  推送通知
                </a-checkbox>
              </a-space>
            </a-form-item>

            <a-form-item label="关联报警设备">
              <a-select
                v-model:value="formData.outputActions.alarm.devices"
                mode="multiple"
                placeholder="请选择关联报警设备"
                style="width: 100%"
              >
                <a-select-option value="alarm001">声光报警器-001</a-select-option>
                <a-select-option value="alarm002">声光报警器-002</a-select-option>
              </a-select>
            </a-form-item>
          </template>
        </a-tab-pane>

        <!-- 电视墙联动 -->
        <a-tab-pane key="tvWall" tab="电视墙联动">
          <a-form-item label="启用电视墙联动" name="tvWallEnabled">
            <a-switch v-model:checked="formData.outputActions.tvWall.enabled" />
          </a-form-item>

          <template v-if="formData.outputActions.tvWall.enabled">
            <a-row :gutter="16">
              <a-col :span="12">
                <a-form-item label="电视墙">
                  <a-select
                    v-model:value="formData.outputActions.tvWall.wallId"
                    placeholder="请选择电视墙"
                  >
                    <a-select-option value="wall001">电视墙-1</a-select-option>
                    <a-select-option value="wall002">电视墙-2</a-select-option>
                  </a-select>
                </a-form-item>
              </a-col>

              <a-col :span="12">
                <a-form-item label="显示窗口">
                  <a-select
                    v-model:value="formData.outputActions.tvWall.windowId"
                    placeholder="请选择显示窗口"
                  >
                    <a-select-option value="window1">窗口1</a-select-option>
                    <a-select-option value="window2">窗口2</a-select-option>
                  </a-select>
                </a-form-item>
              </a-col>
            </a-row>

            <a-form-item label="显示时长(秒)">
              <a-input-number
                v-model:value="formData.outputActions.tvWall.displayDuration"
                :min="10"
                :max="300"
                style="width: 100%"
              />
            </a-form-item>
          </template>
        </a-tab-pane>
      </a-tabs>

      <!-- 生效时间 -->
      <a-divider orientation="left">生效时间</a-divider>

      <a-form-item label="启用时间限制" name="effectiveTimeEnabled">
        <a-switch v-model:checked="formData.effectiveTime.enabled" />
      </a-form-item>

      <template v-if="formData.effectiveTime.enabled">
        <a-row :gutter="16">
          <a-col :span="12">
            <a-form-item label="开始时间">
              <a-time-picker
                v-model:value="formData.effectiveTime.startTime"
                value-format="HH:mm:ss"
                style="width: 100%"
              />
            </a-form-item>
          </a-col>

          <a-col :span="12">
            <a-form-item label="结束时间">
              <a-time-picker
                v-model:value="formData.effectiveTime.endTime"
                value-format="HH:mm:ss"
                style="width: 100%"
              />
            </a-form-item>
          </a-col>
        </a-row>

        <a-form-item label="生效日期">
          <a-checkbox-group v-model:value="formData.effectiveTime.weekDays">
            <a-checkbox :value="1">周一</a-checkbox>
            <a-checkbox :value="2">周二</a-checkbox>
            <a-checkbox :value="3">周三</a-checkbox>
            <a-checkbox :value="4">周四</a-checkbox>
            <a-checkbox :value="5">周五</a-checkbox>
            <a-checkbox :value="6">周六</a-checkbox>
            <a-checkbox :value="7">周日</a-checkbox>
          </a-checkbox-group>
        </a-form-item>
      </template>
    </a-form>

    <!-- 触发条件选择弹窗 -->
    <TriggerConditionTree
      v-model:visible="triggerConditionVisible"
      :device-type="formData.deviceType"
      :selected-conditions="selectedTriggerConditions"
      @confirm="handleTriggerConditionConfirm"
    />

    <!-- 输入点选择弹窗 -->
    <InputPointSelector
      v-model:visible="inputPointVisible"
      :selected-points="selectedInputPoints"
      @confirm="handleInputPointConfirm"
    />
  </a-modal>
</template>

<script setup>
import { ref, reactive, watch } from 'vue';
import { message } from 'ant-design-vue';
import {
  ThunderboltOutlined,
  ApiOutlined,
} from '@ant-design/icons-vue';
import TriggerConditionTree from './TriggerConditionTree.vue';
import InputPointSelector from './InputPointSelector.vue';
import { linkageApi } from '/@/api/business/smart-video/linkage-api';

const props = defineProps({
  visible: {
    type: Boolean,
    default: false,
  },
  isEdit: {
    type: Boolean,
    default: false,
  },
  linkageData: {
    type: Object,
    default: () => ({}),
  },
});

const emit = defineEmits(['update:visible', 'success', 'cancel']);

const formRef = ref();
const loading = ref(false);
const activeOutputTab = ref('video');
const triggerConditionVisible = ref(false);
const inputPointVisible = ref(false);

// 表单数据
const formData = reactive({
  name: '',
  description: '',
  deviceType: '',
  conditionLogic: 'AND',
  triggerConditions: [],
  inputPoints: [],
  outputActions: {
    video: {
      enabled: false,
      popupVideo: false,
      startRecording: false,
      captureImage: false,
      recordDuration: 30,
      captureCount: 3,
      devices: [],
    },
    access: {
      enabled: false,
      action: 'open',
      devices: [],
    },
    elevator: {
      enabled: false,
      action: 'call',
      devices: [],
    },
    alarm: {
      enabled: false,
      soundAlarm: false,
      lightAlarm: false,
      pushNotification: false,
      devices: [],
    },
    tvWall: {
      enabled: false,
      wallId: '',
      windowId: '',
      displayDuration: 60,
    },
  },
  effectiveTime: {
    enabled: false,
    startTime: '00:00:00',
    endTime: '23:59:59',
    weekDays: [1, 2, 3, 4, 5, 6, 7],
  },
});

// 选中的触发条件
const selectedTriggerConditions = ref([]);

// 选中的输入点
const selectedInputPoints = ref([]);

// 表单验证规则
const formRules = {
  name: [
    { required: true, message: '请输入联动名称', trigger: 'blur' },
    { min: 2, max: 50, message: '联动名称长度应在2-50字符之间', trigger: 'blur' },
  ],
  deviceType: [
    { required: true, message: '请选择设备类型', trigger: 'change' },
  ],
};

// 监听编辑数据变化
watch(
  () => props.linkageData,
  (newVal) => {
    if (newVal && Object.keys(newVal).length > 0) {
      Object.assign(formData, newVal);
      selectedTriggerConditions.value = newVal.triggerConditions || [];
      selectedInputPoints.value = newVal.inputPoints || [];
    }
  },
  { immediate: true, deep: true }
);

// 设备类型变化
const handleDeviceTypeChange = () => {
  // 清空已选择的触发条件
  selectedTriggerConditions.value = [];
};

// 显示触发条件弹窗
const showTriggerConditionModal = () => {
  if (!formData.deviceType) {
    message.warning('请先选择设备类型');
    return;
  }
  triggerConditionVisible.value = true;
};

// 触发条件确认
const handleTriggerConditionConfirm = (conditions) => {
  selectedTriggerConditions.value = conditions;
  formData.triggerConditions = conditions;
};

// 移除触发条件
const removeTriggerCondition = (value) => {
  selectedTriggerConditions.value = selectedTriggerConditions.value.filter(
    c => c.value !== value
  );
  formData.triggerConditions = selectedTriggerConditions.value;
};

// 显示输入点弹窗
const showInputPointModal = () => {
  inputPointVisible.value = true;
};

// 输入点确认
const handleInputPointConfirm = (points) => {
  selectedInputPoints.value = points;
  formData.inputPoints = points;
};

// 移除输入点
const removeInputPoint = (id) => {
  selectedInputPoints.value = selectedInputPoints.value.filter(p => p.id !== id);
  formData.inputPoints = selectedInputPoints.value;
};

// 提交表单
const handleSubmit = async () => {
  try {
    await formRef.value.validate();

    // 验证至少选择一个触发条件
    if (selectedTriggerConditions.value.length === 0) {
      message.warning('请选择至少一个触发条件');
      return;
    }

    // 验证至少启用一个联动输出
    const hasEnabledOutput = Object.values(formData.outputActions).some(
      action => action.enabled
    );
    if (!hasEnabledOutput) {
      message.warning('请至少启用一个联动输出');
      return;
    }

    loading.value = true;

    const apiMethod = props.isEdit ? linkageApi.updateLinkage : linkageApi.addLinkage;
    const response = await apiMethod(formData);

    if (response.code === 1) {
      message.success(props.isEdit ? '编辑成功' : '新增成功');
      emit('success');
      handleCancel();
    } else {
      message.error(response.msg || '操作失败');
    }
  } catch (error) {
    console.error('表单提交失败:', error);
  } finally {
    loading.value = false;
  }
};

// 取消
const handleCancel = () => {
  formRef.value?.resetFields();
  selectedTriggerConditions.value = [];
  selectedInputPoints.value = [];
  emit('update:visible', false);
  emit('cancel');
};
</script>

<style lang="less" scoped>
.condition-select-wrapper,
.input-point-wrapper {
  .selected-conditions,
  .selected-points {
    margin-top: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .empty-hint {
    margin-top: 8px;
    color: #8c8c8c;
    font-size: 14px;
  }
}
</style>
```

### 3. 触发条件树形选择器

**组件路径**: `src/views/business/smart-video/components/TriggerConditionTree.vue`

**技术实现**:
```vue
<template>
  <a-modal
    :open="visible"
    title="选择触发条件"
    width="600px"
    @ok="handleConfirm"
    @cancel="handleCancel"
  >
    <div class="trigger-tree-container">
      <a-tree
        v-model:checkedKeys="checkedKeys"
        checkable
        :tree-data="treeData"
        :expanded-keys="expandedKeys"
        :auto-expand-parent="autoExpandParent"
        @expand="handleExpand"
        @check="handleCheck"
      >
        <template #title="{ title, key, dataRef }">
          <span :class="{ 'tree-leaf': !dataRef.children }">
            {{ title }}
          </span>
        </template>
      </a-tree>
    </div>
  </a-modal>
</template>

<script setup>
import { ref, watch, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import { linkageApi } from '/@/api/business/smart-video/linkage-api';

const props = defineProps({
  visible: {
    type: Boolean,
    default: false,
  },
  deviceType: {
    type: String,
    default: '',
  },
  selectedConditions: {
    type: Array,
    default: () => [],
  },
});

const emit = defineEmits(['update:visible', 'confirm']);

const treeData = ref([]);
const checkedKeys = ref([]);
const expandedKeys = ref([]);
const autoExpandParent = ref(true);

// 监听设备类型变化，加载对应的触发条件树
watch(
  () => props.deviceType,
  (newType) => {
    if (newType) {
      loadTriggerConditions(newType);
    }
  },
  { immediate: true }
);

// 监听已选择条件变化
watch(
  () => props.selectedConditions,
  (newConditions) => {
    checkedKeys.value = newConditions.map(c => c.value);
  },
  { immediate: true }
);

// 加载触发条件树
const loadTriggerConditions = async (deviceType) => {
  try {
    const response = await linkageApi.getTriggerConditions(deviceType);
    if (response.code === 1) {
      treeData.value = buildTreeData(response.data);
      // 默认展开所有一级节点
      expandedKeys.value = treeData.value.map(item => item.key);
    }
  } catch (error) {
    console.error('加载触发条件失败:', error);
    // 使用默认数据
    treeData.value = getDefaultTreeData();
    expandedKeys.value = treeData.value.map(item => item.key);
  }
};

// 构建树形数据
const buildTreeData = (data) => {
  return Object.entries(data).map(([category, subCategories], index) => ({
    title: category,
    key: `category-${index}`,
    selectable: false,
    children: Object.entries(subCategories).map(([subCategory, items], subIndex) => ({
      title: subCategory,
      key: `subcategory-${index}-${subIndex}`,
      selectable: false,
      children: items.map((item, itemIndex) => ({
        title: item,
        key: `${category}-${subCategory}-${item}`,
        value: item,
        isLeaf: true,
      })),
    })),
  }));
};

// 获取默认树形数据
const getDefaultTreeData = () => {
  return [
    {
      title: '移动侦测',
      key: 'motion-detection',
      children: [
        {
          title: '入侵检测',
          key: 'intrusion',
          children: [
            { title: '区域入侵', key: 'intrusion-region', value: 'intrusion_region', isLeaf: true },
            { title: '越界检测', key: 'cross-line', value: 'cross_line', isLeaf: true },
            { title: '进入区域', key: 'enter-region', value: 'enter_region', isLeaf: true },
            { title: '离开区域', key: 'leave-region', value: 'leave_region', isLeaf: true },
          ],
        },
        {
          title: '行为分析',
          key: 'behavior',
          children: [
            { title: '徘徊检测', key: 'loitering', value: 'loitering', isLeaf: true },
            { title: '快速移动', key: 'fast-moving', value: 'fast_moving', isLeaf: true },
            { title: '人员聚集', key: 'crowd', value: 'crowd', isLeaf: true },
            { title: '倒地检测', key: 'fall-down', value: 'fall_down', isLeaf: true },
          ],
        },
      ],
    },
    {
      title: '智能分析',
      key: 'smart-analysis',
      children: [
        {
          title: '人脸检测',
          key: 'face',
          children: [
            { title: '陌生人检测', key: 'stranger', value: 'stranger', isLeaf: true },
            { title: '黑名单比对', key: 'blacklist', value: 'blacklist', isLeaf: true },
            { title: '白名单识别', key: 'whitelist', value: 'whitelist', isLeaf: true },
          ],
        },
        {
          title: '车辆检测',
          key: 'vehicle',
          children: [
            { title: '车牌识别', key: 'plate', value: 'plate', isLeaf: true },
            { title: '违章停车', key: 'illegal-parking', value: 'illegal_parking', isLeaf: true },
            { title: '异常行驶', key: 'abnormal-driving', value: 'abnormal_driving', isLeaf: true },
          ],
        },
      ],
    },
    {
      title: '设备状态',
      key: 'device-status',
      children: [
        {
          title: '设备异常',
          key: 'device-error',
          children: [
            { title: '视频丢失', key: 'video-loss', value: 'video_loss', isLeaf: true },
            { title: '设备离线', key: 'device-offline', value: 'device_offline', isLeaf: true },
            { title: '存储异常', key: 'storage-error', value: 'storage_error', isLeaf: true },
          ],
        },
        {
          title: '网络异常',
          key: 'network-error',
          children: [
            { title: '网络断开', key: 'network-disconnect', value: 'network_disconnect', isLeaf: true },
            { title: '带宽不足', key: 'bandwidth-low', value: 'bandwidth_low', isLeaf: true },
          ],
        },
      ],
    },
  ];
};

// 展开/折叠节点
const handleExpand = (keys) => {
  expandedKeys.value = keys;
  autoExpandParent.value = false;
};

// 选择节点
const handleCheck = (keys, event) => {
  checkedKeys.value = keys.checked || keys;
};

// 确认选择
const handleConfirm = () => {
  if (checkedKeys.value.length === 0) {
    message.warning('请选择至少一个触发条件');
    return;
  }

  // 获取选中的叶子节点
  const selectedConditions = [];
  const findLeafNodes = (nodes) => {
    nodes.forEach(node => {
      if (node.isLeaf && checkedKeys.value.includes(node.key)) {
        selectedConditions.push({
          value: node.value,
          label: node.title,
          key: node.key,
        });
      }
      if (node.children) {
        findLeafNodes(node.children);
      }
    });
  };
  findLeafNodes(treeData.value);

  emit('confirm', selectedConditions);
  emit('update:visible', false);
};

// 取消
const handleCancel = () => {
  emit('update:visible', false);
};

onMounted(() => {
  if (props.deviceType) {
    loadTriggerConditions(props.deviceType);
  }
});
</script>

<style lang="less" scoped>
.trigger-tree-container {
  max-height: 500px;
  overflow-y: auto;
  padding: 16px;
  border: 1px solid #f0f0f0;
  border-radius: 4px;

  .tree-leaf {
    color: #1890ff;
  }
}
</style>
```

### 4. 联动统计图表组件

**组件路径**: `src/views/business/smart-video/components/LinkageStatistics.vue`

**技术实现**:
```vue
<template>
  <div class="linkage-statistics">
    <!-- 统计卡片 -->
    <div class="statistics-cards">
      <a-card class="stat-card total">
        <a-statistic
          title="总联动数"
          :value="statisticsData.total || 0"
        >
          <template #prefix>
            <LinkOutlined />
          </template>
        </a-statistic>
      </a-card>

      <a-card class="stat-card enabled">
        <a-statistic
          title="启用联动"
          :value="statisticsData.enabled || 0"
          value-style="color: #52c41a"
        >
          <template #prefix>
            <CheckCircleOutlined />
          </template>
        </a-statistic>
      </a-card>

      <a-card class="stat-card disabled">
        <a-statistic
          title="禁用联动"
          :value="statisticsData.disabled || 0"
          value-style="color: #ff4d4f"
        >
          <template #prefix>
            <CloseCircleOutlined />
          </template>
        </a-statistic>
      </a-card>

      <a-card class="stat-card persons">
        <a-statistic
          title="关联人员"
          :value="statisticsData.linkedPersons || 0"
          value-style="color: #722ed1"
        >
          <template #prefix>
            <TeamOutlined />
          </template>
        </a-statistic>
      </a-card>
    </div>

    <!-- 图表区域 -->
    <div class="charts-container">
      <a-card title="联动类型分布" class="chart-card">
        <canvas ref="typeChartRef"></canvas>
      </a-card>

      <a-card title="联动状态统计" class="chart-card">
        <canvas ref="statusChartRef"></canvas>
      </a-card>

      <a-card title="设备类型分布" class="chart-card">
        <canvas ref="deviceChartRef"></canvas>
      </a-card>

      <a-card title="部门人员分布" class="chart-card">
        <canvas ref="departmentChartRef"></canvas>
      </a-card>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, onMounted, onUnmounted } from 'vue';
import {
  LinkOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  TeamOutlined,
} from '@ant-design/icons-vue';
import Chart from 'chart.js/auto';

const props = defineProps({
  statisticsData: {
    type: Object,
    default: () => ({}),
  },
});

const typeChartRef = ref();
const statusChartRef = ref();
const deviceChartRef = ref();
const departmentChartRef = ref();

let typeChart = null;
let statusChart = null;
let deviceChart = null;
let departmentChart = null;

// 监听统计数据变化
watch(
  () => props.statisticsData,
  (newData) => {
    if (Object.keys(newData).length > 0) {
      initCharts(newData);
    }
  },
  { deep: true }
);

// 初始化图表
const initCharts = (data) => {
  // 销毁已存在的图表
  destroyCharts();

  // 联动类型分布（饼图）
  if (typeChartRef.value) {
    const ctx = typeChartRef.value.getContext('2d');
    typeChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(data.typeDistribution || {}),
        datasets: [{
          data: Object.values(data.typeDistribution || {}),
          backgroundColor: [
            '#1890ff',
            '#722ed1',
            '#eb2f96',
            '#fa8c16',
            '#52c41a',
          ],
          borderWidth: 2,
          borderColor: '#fff',
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            position: 'bottom',
          },
        },
      },
    });
  }

  // 联动状态统计（饼图）
  if (statusChartRef.value) {
    const ctx = statusChartRef.value.getContext('2d');
    statusChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['启用', '禁用'],
        datasets: [{
          data: [data.enabled || 0, data.disabled || 0],
          backgroundColor: ['#52c41a', '#ff4d4f'],
          borderWidth: 2,
          borderColor: '#fff',
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            position: 'bottom',
          },
        },
      },
    });
  }

  // 设备类型分布（柱状图）
  if (deviceChartRef.value) {
    const ctx = deviceChartRef.value.getContext('2d');
    deviceChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(data.deviceTypeDistribution || {}),
        datasets: [{
          label: '联动数量',
          data: Object.values(data.deviceTypeDistribution || {}),
          backgroundColor: '#1890ff',
          borderRadius: 5,
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false,
          },
        },
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      },
    });
  }

  // 部门人员分布（柱状图）
  if (departmentChartRef.value) {
    const ctx = departmentChartRef.value.getContext('2d');
    departmentChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(data.departmentDistribution || {}),
        datasets: [{
          label: '人员数量',
          data: Object.values(data.departmentDistribution || {}),
          backgroundColor: ['#722ed1', '#eb2f96', '#fa8c16'],
          borderRadius: 5,
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false,
          },
        },
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      },
    });
  }
};

// 销毁图表
const destroyCharts = () => {
  if (typeChart) {
    typeChart.destroy();
    typeChart = null;
  }
  if (statusChart) {
    statusChart.destroy();
    statusChart = null;
  }
  if (deviceChart) {
    deviceChart.destroy();
    deviceChart = null;
  }
  if (departmentChart) {
    departmentChart.destroy();
    departmentChart = null;
  }
};

onMounted(() => {
  if (Object.keys(props.statisticsData).length > 0) {
    initCharts(props.statisticsData);
  }
});

onUnmounted(() => {
  destroyCharts();
});
</script>

<style lang="less" scoped>
.linkage-statistics {
  display: flex;
  flex-direction: column;
  gap: 24px;
  height: 100%;
  overflow-y: auto;

  .statistics-cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;

    .stat-card {
      &.total :deep(.ant-statistic-content) {
        color: #1890ff;
      }

      &.enabled :deep(.ant-statistic-content) {
        color: #52c41a;
      }

      &.disabled :deep(.ant-statistic-content) {
        color: #ff4d4f;
      }

      &.persons :deep(.ant-statistic-content) {
        color: #722ed1;
      }
    }
  }

  .charts-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;

    .chart-card {
      height: 300px;

      :deep(.ant-card-body) {
        height: calc(100% - 57px);
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
  }
}
</style>
```

## Mock数据示例

```javascript
// src/views/business/smart-video/mock/linkage-mock-data.js

export const mockLinkageList = [
  {
    id: 'link001',
    name: '周界入侵联动',
    triggerCondition: '移动侦测',
    status: 'enabled',
    description: '检测到移动时触发录像和报警',
    type: '入侵检测',
    deviceType: 'IVS1800',
    conditionLogic: 'AND',
    triggerConditions: [
      { value: 'intrusion_region', label: '区域入侵' },
    ],
    inputPoints: [
      { id: 'input001', name: '前门输入点', type: 'sensor' },
    ],
    outputActions: {
      video: {
        enabled: true,
        popupVideo: true,
        startRecording: true,
        captureImage: true,
        recordDuration: 30,
        captureCount: 3,
        devices: ['cam001', 'cam002'],
      },
      access: { enabled: false },
      elevator: { enabled: false },
      alarm: {
        enabled: true,
        soundAlarm: true,
        lightAlarm: true,
        pushNotification: true,
        devices: ['alarm001'],
      },
      tvWall: { enabled: false },
    },
    effectiveTime: {
      enabled: true,
      startTime: '00:00:00',
      endTime: '23:59:59',
      weekDays: [1, 2, 3, 4, 5, 6, 7],
    },
    linkedPersons: ['person001', 'person002'],
    createTime: '2024-01-15 10:30:25',
    updateTime: '2024-01-30 14:35:12',
  },
  {
    id: 'link002',
    name: '人脸识别联动',
    triggerCondition: '人脸检测',
    status: 'enabled',
    description: '识别到人脸时抓拍并记录',
    type: '人脸识别',
    deviceType: 'AIBox1',
    conditionLogic: 'OR',
    triggerConditions: [
      { value: 'stranger', label: '陌生人检测' },
      { value: 'blacklist', label: '黑名单比对' },
    ],
    inputPoints: [],
    outputActions: {
      video: {
        enabled: true,
        popupVideo: false,
        startRecording: false,
        captureImage: true,
        recordDuration: 0,
        captureCount: 5,
        devices: ['cam001'],
      },
      access: { enabled: false },
      elevator: { enabled: false },
      alarm: {
        enabled: true,
        soundAlarm: false,
        lightAlarm: false,
        pushNotification: true,
        devices: [],
      },
      tvWall: { enabled: false },
    },
    effectiveTime: {
      enabled: false,
    },
    linkedPersons: ['person001', 'person003', 'person005'],
    createTime: '2024-01-16 09:15:30',
    updateTime: '2024-01-28 16:20:45',
  },
  {
    id: 'link003',
    name: '门禁异常联动',
    triggerCondition: '门禁异常',
    status: 'disabled',
    description: '门禁异常时触发视频录像',
    type: '设备异常',
    deviceType: 'NVR800',
    conditionLogic: 'AND',
    triggerConditions: [
      { value: 'device_offline', label: '设备离线' },
    ],
    inputPoints: [
      { id: 'input002', name: '门禁输入点', type: 'access' },
    ],
    outputActions: {
      video: {
        enabled: true,
        popupVideo: true,
        startRecording: true,
        captureImage: false,
        recordDuration: 60,
        captureCount: 0,
        devices: ['cam001', 'cam003'],
      },
      access: { enabled: false },
      elevator: { enabled: false },
      alarm: { enabled: false },
      tvWall: { enabled: false },
    },
    effectiveTime: {
      enabled: true,
      startTime: '08:00:00',
      endTime: '18:00:00',
      weekDays: [1, 2, 3, 4, 5],
    },
    linkedPersons: ['person002'],
    createTime: '2024-01-17 14:20:15',
    updateTime: '2024-01-29 11:30:00',
  },
  {
    id: 'link004',
    name: '车牌识别联动',
    triggerCondition: '车牌检测',
    status: 'enabled',
    description: '识别到车牌时记录并报警',
    type: '车牌识别',
    deviceType: 'AIBox2',
    conditionLogic: 'OR',
    triggerConditions: [
      { value: 'plate', label: '车牌识别' },
      { value: 'illegal_parking', label: '违章停车' },
    ],
    inputPoints: [],
    outputActions: {
      video: {
        enabled: true,
        popupVideo: true,
        startRecording: true,
        captureImage: true,
        recordDuration: 30,
        captureCount: 3,
        devices: ['cam002'],
      },
      access: {
        enabled: true,
        action: 'open',
        devices: ['access001'],
      },
      elevator: { enabled: false },
      alarm: {
        enabled: true,
        soundAlarm: true,
        lightAlarm: false,
        pushNotification: true,
        devices: ['alarm002'],
      },
      tvWall: { enabled: false },
    },
    effectiveTime: {
      enabled: false,
    },
    linkedPersons: ['person001', 'person004'],
    createTime: '2024-01-18 10:45:20',
    updateTime: '2024-01-30 09:15:30',
  },
  {
    id: 'link005',
    name: '烟雾报警联动',
    triggerCondition: '烟雾检测',
    status: 'disabled',
    description: '检测到烟雾时触发报警',
    type: '安全检测',
    deviceType: 'IVS1800',
    conditionLogic: 'AND',
    triggerConditions: [
      { value: 'smoke_detection', label: '烟雾检测' },
    ],
    inputPoints: [
      { id: 'input003', name: '烟雾传感器', type: 'sensor' },
    ],
    outputActions: {
      video: {
        enabled: true,
        popupVideo: true,
        startRecording: true,
        captureImage: true,
        recordDuration: 120,
        captureCount: 10,
        devices: ['cam001', 'cam002', 'cam003'],
      },
      access: { enabled: false },
      elevator: {
        enabled: true,
        action: 'emergency',
        devices: ['elevator001', 'elevator002'],
      },
      alarm: {
        enabled: true,
        soundAlarm: true,
        lightAlarm: true,
        pushNotification: true,
        devices: ['alarm001', 'alarm002'],
      },
      tvWall: {
        enabled: true,
        wallId: 'wall001',
        windowId: 'window1',
        displayDuration: 120,
      },
    },
    effectiveTime: {
      enabled: true,
      startTime: '00:00:00',
      endTime: '23:59:59',
      weekDays: [1, 2, 3, 4, 5, 6, 7],
    },
    linkedPersons: ['person002', 'person003'],
    createTime: '2024-01-19 16:30:10',
    updateTime: '2024-01-29 14:20:25',
  },
];

export const mockPersonList = [
  {
    id: 'person001',
    pin: 'EMP001',
    name: '张三',
    department: '安保部',
    phone: '13800138001',
    email: 'zhangsan@example.com',
  },
  {
    id: 'person002',
    pin: 'EMP002',
    name: '李四',
    department: '行政部',
    phone: '13800138002',
    email: 'lisi@example.com',
  },
  {
    id: 'person003',
    pin: 'EMP003',
    name: '王五',
    department: '技术部',
    phone: '13800138003',
    email: 'wangwu@example.com',
  },
  {
    id: 'person004',
    pin: 'EMP004',
    name: '赵六',
    department: '安保部',
    phone: '13800138004',
    email: 'zhaoliu@example.com',
  },
  {
    id: 'person005',
    pin: 'EMP005',
    name: '孙七',
    department: '技术部',
    phone: '13800138005',
    email: 'sunqi@example.com',
  },
];

export const mockStatisticsData = {
  total: 5,
  enabled: 3,
  disabled: 2,
  linkedPersons: 12,
  typeDistribution: {
    '入侵检测': 1,
    '人脸识别': 1,
    '设备异常': 1,
    '车牌识别': 1,
    '安全检测': 1,
  },
  deviceTypeDistribution: {
    'IVS1800': 2,
    'AIBox1': 1,
    'AIBox2': 1,
    'NVR800': 1,
  },
  departmentDistribution: {
    '安保部': 2,
    '行政部': 1,
    '技术部': 2,
  },
};

// Mock API实现
export default {
  // 查询联动列表
  mockQueryLinkageList: (params) => {
    let list = [...mockLinkageList];

    // 搜索过滤
    if (params.keyword) {
      list = list.filter(item =>
        item.name.includes(params.keyword) ||
        item.description.includes(params.keyword)
      );
    }

    return {
      code: 1,
      msg: '查询成功',
      data: list,
    };
  },

  // 获取联动关联人员
  mockGetLinkagePersons: (linkageId) => {
    const linkage = mockLinkageList.find(l => l.id === linkageId);
    if (!linkage) {
      return {
        code: 0,
        msg: '联动不存在',
        data: [],
      };
    }

    const persons = mockPersonList.filter(p =>
      linkage.linkedPersons.includes(p.id)
    );

    return {
      code: 1,
      msg: '查询成功',
      data: persons,
    };
  },

  // 获取统计数据
  mockGetStatistics: () => {
    return {
      code: 1,
      msg: '查询成功',
      data: mockStatisticsData,
    };
  },

  // 查询人员列表
  mockQueryPersonList: (params) => {
    let list = [...mockPersonList];

    if (params.pin) {
      list = list.filter(p => p.pin.includes(params.pin));
    }

    if (params.name) {
      list = list.filter(p => p.name.includes(params.name));
    }

    return {
      code: 1,
      msg: '查询成功',
      data: list,
    };
  },
};
```

## 路由配置

### ✅ 正确的路由配置
```javascript
// src/router/business/smart-video.js
import SmartLayout from '/@/layout/index.vue';
import { MENU_TYPE_ENUM } from '/@/constants/system/menu-const';

export const smartVideoRouters = [
  {
    path: '/',
    component: SmartLayout,
    children: [
      {
        path: '/business/smart-video/linkage-config',
        name: 'SmartVideoLinkageConfig',
        component: () => import('/@/views/business/smart-video/linkage-config.vue'),
        meta: {
          title: '智能视频 - 联动配置',
          menuType: MENU_TYPE_ENUM.MENU.value,
          icon: 'LinkOutlined',
          hideInMenu: false,
          keepAlive: true,
        },
      },
    ],
  },
];
```

## 菜单配置

### ✅ 动态菜单注入
```javascript
// src/store/modules/system/user.js
function addLinkageConfigMenu(menuList, parentId) {
  const maxMenuId = Math.max(...menuList.map(item => item.menuId || 0));

  // 联动配置菜单
  const linkageConfigMenu = {
    menuId: maxMenuId + 1,
    menuName: '联动配置',
    menuTitle: '联动配置',
    menuType: MENU_TYPE_ENUM.MENU.value,
    parentId: parentId, // 智能视频父菜单ID
    path: '/business/smart-video/linkage-config',
    component: '/business/smart-video/linkage-config.vue',
    icon: 'LinkOutlined',
    visibleFlag: true,
    disabledFlag: false,
    cacheFlag: true,
    frameFlag: false,
    frameUrl: '',
    sort: 3,
    updateTime: new Date().toISOString(),
  };

  menuList.push(linkageConfigMenu);
  return linkageConfigMenu.menuId;
}
```

## Pinia Store状态管理

```javascript
// src/store/modules/business/linkage.js
import { defineStore } from 'pinia';
import { message } from 'ant-design-vue';
import { linkageApi } from '/@/api/business/smart-video/linkage-api';

export const useLinkageStore = defineStore('linkage', {
  state: () => ({
    linkageList: [],
    statisticsData: {},
    loading: false,
    currentLinkage: null,
  }),

  getters: {
    enabledLinkageCount(state) {
      return state.linkageList.filter(l => l.status === 'enabled').length;
    },

    disabledLinkageCount(state) {
      return state.linkageList.filter(l => l.status === 'disabled').length;
    },

    linkageTypeStats(state) {
      const stats = {};
      state.linkageList.forEach(linkage => {
        stats[linkage.type] = (stats[linkage.type] || 0) + 1;
      });
      return stats;
    },
  },

  actions: {
    async fetchLinkageList(params = {}, useMock = true) {
      this.loading = true;
      try {
        let response;
        if (useMock) {
          const linkageMockData = await import('/@/views/business/smart-video/mock/linkage-mock-data');
          response = linkageMockData.default.mockQueryLinkageList(params);
        } else {
          response = await linkageApi.queryLinkageList(params);
        }

        if (response.code === 1) {
          this.linkageList = response.data;
          return response.data;
        } else {
          message.error(response.msg || '获取数据失败');
          return null;
        }
      } catch (error) {
        console.error('获取联动列表失败:', error);
        message.error('获取数据失败');
        return null;
      } finally {
        this.loading = false;
      }
    },

    async fetchStatistics(useMock = true) {
      try {
        let response;
        if (useMock) {
          const linkageMockData = await import('/@/views/business/smart-video/mock/linkage-mock-data');
          response = linkageMockData.default.mockGetStatistics();
        } else {
          response = await linkageApi.getLinkageStatistics();
        }

        if (response.code === 1) {
          this.statisticsData = response.data;
          return response.data;
        }
      } catch (error) {
        console.error('获取统计数据失败:', error);
        return {};
      }
    },

    async addLinkage(linkageData) {
      try {
        const response = await linkageApi.addLinkage(linkageData);
        if (response.code === 1) {
          message.success('添加联动成功');
          return true;
        } else {
          message.error(response.msg || '添加联动失败');
          return false;
        }
      } catch (error) {
        console.error('添加联动失败:', error);
        message.error('添加联动失败');
        return false;
      }
    },

    async updateLinkage(linkageData) {
      try {
        const response = await linkageApi.updateLinkage(linkageData);
        if (response.code === 1) {
          message.success('更新联动成功');
          return true;
        } else {
          message.error(response.msg || '更新联动失败');
          return false;
        }
      } catch (error) {
        console.error('更新联动失败:', error);
        message.error('更新联动失败');
        return false;
      }
    },

    async deleteLinkage(linkageId) {
      try {
        const response = await linkageApi.deleteLinkage(linkageId);
        if (response.code === 1) {
          message.success('删除联动成功');
          return true;
        } else {
          message.error(response.msg || '删除联动失败');
          return false;
        }
      } catch (error) {
        console.error('删除联动失败:', error);
        message.error('删除联动失败');
        return false;
      }
    },

    async toggleLinkageStatus(linkageId, status) {
      try {
        const response = await linkageApi.toggleLinkageStatus({
          linkageId,
          status,
        });
        if (response.code === 1) {
          message.success(`已${status === 'enabled' ? '启用' : '禁用'}联动`);
          return true;
        } else {
          message.error(response.msg || '操作失败');
          return false;
        }
      } catch (error) {
        console.error('切换联动状态失败:', error);
        message.error('操作失败');
        return false;
      }
    },

    setCurrentLinkage(linkage) {
      this.currentLinkage = linkage;
    },
  },
});
```

## 常见错误排查清单

### 1. 控制台报错排查
- [ ] 图标导入错误：检查 `@ant-design/icons-vue` 中是否存在该图标
- [ ] API导入错误：确认导入路径是否为 `/@/lib/axios`
- [ ] v-model错误：检查是否在props上使用了v-model
- [ ] 树形选择器错误：确保tree-data数据格式正确
- [ ] Chart.js错误：确认Chart.js已正确安装和导入

### 2. 页面无法访问排查
- [ ] 路由配置：检查路由是否正确添加到 `routerArray`
- [ ] 菜单配置：检查菜单是否正确注入到菜单列表
- [ ] 组件路径：确认组件路径是否正确
- [ ] 文件存在：确认所有引用的组件文件都存在

### 3. 功能异常排查
- [ ] Store状态：检查Pinia store是否正确定义和使用
- [ ] API调用：确认API接口路径和参数是否正确
- [ ] 数据格式：检查mock数据格式是否符合预期
- [ ] 事件绑定：确认事件监听器是否正确绑定
- [ ] 表单验证：确保表单规则配置正确

### 4. 联动配置相关排查
- [ ] 触发条件：确保设备类型选择后才能选择触发条件
- [ ] 联动输出：至少启用一个联动输出动作
- [ ] 人员关联：确认联动已选中才能添加人员
- [ ] 图表渲染：确保Canvas元素已挂载再初始化图表
- [ ] 生效时间：确认时间格式和星期选择正确

## 最佳实践总结

### ✅ 推荐的开发流程
1. **先创建基础组件** - 确保每个组件可以独立运行
2. **逐步集成功能** - 从简单到复杂，逐步添加功能
3. **Mock数据优先** - 先用mock数据开发，后期对接真实API
4. **及时测试验证** - 每添加一个功能就进行测试
5. **遵循项目规范** - 使用项目既定的命名和结构规范

### ✅ 代码质量保证
1. **使用TypeScript类型检查**（如果项目支持）
2. **遵循ESLint和Prettier规范**
3. **编写单元测试**（重要功能）
4. **添加适当的注释**，特别是复杂逻辑
5. **保持组件单一职责**，避免过度复杂

### ✅ 性能优化建议
1. **使用懒加载**：路由和组件按需加载
2. **合理使用computed和watch**
3. **避免不必要的重新渲染**
4. **图表销毁**：组件卸载时及时销毁Chart实例
5. **添加防抖和节流**优化用户交互

### ✅ 安全性建议
1. **联动规则验证**：确保规则配置合理有效
2. **权限控制**：敏感操作需要权限验证
3. **数据加密**：敏感数据加密传输
4. **防止误操作**：重要操作添加二次确认
5. **日志记录**：记录联动执行历史便于追溯

## 特殊功能实现说明

### 1. 联动规则测试功能
```javascript
// 测试联动规则是否配置正确
const testLinkageRule = async (linkageData) => {
  try {
    const response = await linkageApi.testLinkageRule(linkageData);
    if (response.code === 1) {
      Modal.success({
        title: '规则测试成功',
        content: `
          触发条件: ${response.data.triggerConditions.join(', ')}
          联动动作: ${response.data.actions.join(', ')}
          预计执行时间: ${response.data.estimatedTime}ms
        `,
      });
    } else {
      Modal.error({
        title: '规则测试失败',
        content: response.msg || '规则配置有误',
      });
    }
  } catch (error) {
    message.error('测试失败');
  }
};
```

### 2. 联动执行历史查询
```javascript
// 查询联动执行历史记录
const queryLinkageHistory = async (linkageId) => {
  try {
    const response = await linkageApi.getLinkageHistory({
      linkageId,
      pageNum: 1,
      pageSize: 20,
    });
    if (response.code === 1) {
      // 显示历史记录列表
      showHistoryModal(response.data);
    }
  } catch (error) {
    message.error('获取历史记录失败');
  }
};
```

### 3. 批量导入联动规则
```javascript
// 从Excel导入联动规则
const importLinkageRules = async (file) => {
  const formData = new FormData();
  formData.append('file', file);

  message.loading('正在导入联动规则...', 0);

  try {
    const response = await linkageApi.importLinkageRules(formData);
    message.destroy();
    if (response.code === 1) {
      message.success(`成功导入 ${response.data.successCount} 条规则`);
      loadLinkageList();
    } else {
      message.error(response.msg || '导入失败');
    }
  } catch (error) {
    message.destroy();
    message.error('导入失败');
  }
};
```

### 4. 联动规则导出
```javascript
// 导出联动规则为Excel
const exportLinkageRules = async () => {
  try {
    const response = await linkageApi.exportLinkageRules({
      linkageIds: selectedRowKeys.value,
    });
    if (response.code === 1) {
      // 下载导出的文件
      window.open(response.data.downloadUrl);
      message.success('导出成功');
    } else {
      message.error(response.msg || '导出失败');
    }
  } catch (error) {
    message.error('导出失败');
  }
};
```

## 总结

通过遵循本文档的技术规范和注意事项，可以有效避免开发过程中的常见错误，确保联动配置管理页面能够顺利开发和部署。

关键要点：
- ✅ **避免在props上使用v-model**，改用属性绑定和事件监听
- ✅ **验证图标存在性**，使用实际存在于`@ant-design/icons-vue`中的图标
- ✅ **使用正确的API导入路径**：`/@/lib/axios`
- ✅ **完善的触发条件树**，支持三级分类和多选
- ✅ **多种联动输出类型**，支持视频、门禁、电梯、报警、电视墙联动
- ✅ **条件逻辑组合**，支持AND/OR逻辑组合
- ✅ **生效时间控制**，支持按时间段和星期设置
- ✅ **人员关联管理**，支持批量添加和移除人员
- ✅ **统计图表展示**，直观展示联动配置统计信息
- ✅ **规则测试功能**，验证联动配置是否正确
- ✅ **执行历史记录**，便于问题追溯和分析

通过这些规范和最佳实践，可以确保开发过程顺利进行，减少调试时间，提高开发效率。联动配置功能是智能视频监控系统的核心功能之一，合理的配置和管理能够极大提升系统的自动化水平和响应速度。
