# 单路回放页面功能与布局文档

## 页面概述
单路回放页面是智能视频监控系统中的核心回放功能界面，专注于单个视频流的历史录像查看与管理。该页面基于SmartAdmin前端框架构建，采用Vue3 + Ant Design Vue技术栈，提供设备选择、时间段查询、视频回放控制、时间轴导航、视频下载、剪辑、书签等专业功能。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **视频播放器**: Video.js 8.x 或 西瓜播放器(XGPlayer) 3.x

### 项目文件组织结构
```
src/views/business/smart-video/
├── single-playback.vue               # 单路回放主页面
├── components/
│   ├── SingleVideoPlayer.vue         # 单路视频播放器组件
│   ├── PlaybackTimeline.vue          # 回放时间轴组件
│   ├── DeviceSelector.vue            # 设备选择器组件
│   ├── PlaybackControls.vue          # 播放控制组件
│   ├── VideoClipModal.vue            # 视频剪辑弹窗
│   └── BookmarkPanel.vue             # 书签面板组件
├── mock/
│   └── single-playback-mock.js       # 模拟数据
└── api/
    └── single-playback-api.js        # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/single-playback-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const singlePlaybackApi = {
  // 查询设备列表
  getDeviceList: () => getRequest('/device/list'),

  // 获取设备录像时间轴
  getRecordingTimeline: (params) => postRequest('/recording/timeline', params),

  // 获取录像播放地址
  getPlaybackUrl: (params) => postRequest('/recording/playback-url', params),

  // 下载录像
  downloadRecording: (params) => postRequest('/recording/download', params),

  // 创建剪辑任务
  createClipTask: (params) => postRequest('/recording/clip', params),

  // 书签管理
  addBookmark: (params) => postRequest('/recording/bookmark/add', params),
  getBookmarkList: (params) => postRequest('/recording/bookmark/list', params),
  deleteBookmark: (id) => getRequest(`/recording/bookmark/delete/${id}`),

  // 截图保存
  saveSnapshot: (params) => postRequest('/recording/snapshot', params),
};
```

## 开发注意事项与常见错误避免

### 1. 图标使用规范

#### 正确使用存在的图标
```vue
<script setup>
import {
  SearchOutlined,        // 搜索
  PlayCircleOutlined,    // 播放
  PauseCircleOutlined,   // 暂停
  StepBackwardOutlined,  // 上一帧
  StepForwardOutlined,   // 下一帧
  FastBackwardOutlined,  // 快退
  FastForwardOutlined,   // 快进
  SoundOutlined,         // 音量开
  MutedOutlined,         // 静音
  DownloadOutlined,      // 下载
  ScissorOutlined,       // 剪辑
  CameraOutlined,        // 截图
  ExpandOutlined,        // 全屏
  CompressOutlined,      // 退出全屏
  ZoomInOutlined,        // 放大
  BookOutlined,          // 书签
  StopOutlined,          // 停止
  VideoCameraOutlined,   // 摄像机
  CalendarOutlined,      // 日历
  ClockCircleOutlined,   // 时钟
} from '@ant-design/icons-vue';
</script>
```

### 2. 日期时间选择器正确用法

```vue
<template>
  <!-- 日期选择 -->
  <a-date-picker
    v-model:value="playbackDate"
    placeholder="选择日期"
    format="YYYY-MM-DD"
    :disabled-date="disabledDate"
  />

  <!-- 时间段选择 -->
  <a-select v-model:value="timePeriod" placeholder="选择时间段">
    <a-select-option value="all">全天</a-select-option>
    <a-select-option value="morning">上午 (06:00-12:00)</a-select-option>
    <a-select-option value="afternoon">下午 (12:00-18:00)</a-select-option>
    <a-select-option value="evening">晚上 (18:00-24:00)</a-select-option>
    <a-select-option value="night">深夜 (00:00-06:00)</a-select-option>
    <a-select-option value="custom">自定义</a-select-option>
  </a-select>

  <!-- 自定义时间范围 -->
  <a-time-picker
    v-if="timePeriod === 'custom'"
    v-model:value="startTime"
    format="HH:mm:ss"
    placeholder="开始时间"
  />
  <a-time-picker
    v-if="timePeriod === 'custom'"
    v-model:value="endTime"
    format="HH:mm:ss"
    placeholder="结束时间"
  />
</template>

<script setup>
import { ref } from 'vue';
import dayjs from 'dayjs';

const playbackDate = ref(dayjs());
const timePeriod = ref('all');
const startTime = ref(null);
const endTime = ref(null);

// 禁用未来日期
const disabledDate = (current) => {
  return current && current > dayjs().endOf('day');
};
</script>
```

### 3. 视频播放器集成方案

```vue
<template>
  <div class="single-video-player">
    <video
      ref="videoRef"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
    >
      <source :src="playbackUrl" type="application/x-mpegURL" />
    </video>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted, watch } from 'vue';
import videojs from 'video.js';
import 'video.js/dist/video-js.css';

const props = defineProps({
  playbackUrl: String,
  autoplay: { type: Boolean, default: false },
});

const emit = defineEmits(['timeupdate', 'play', 'pause', 'ended']);

const videoRef = ref(null);
let player = null;

onMounted(() => {
  if (videoRef.value) {
    player = videojs(videoRef.value, {
      controls: true,
      autoplay: props.autoplay,
      preload: 'auto',
      fluid: true,
      playbackRates: [0.25, 0.5, 1, 2, 4, 8, 16],
    });

    player.on('timeupdate', () => {
      emit('timeupdate', player.currentTime());
    });

    player.on('play', () => emit('play'));
    player.on('pause', () => emit('pause'));
    player.on('ended', () => emit('ended'));
  }
});

onUnmounted(() => {
  if (player) {
    player.dispose();
  }
});

// 播放控制方法
const play = () => player?.play();
const pause = () => player?.pause();
const seek = (time) => player?.currentTime(time);
const setPlaybackRate = (rate) => player?.playbackRate(rate);

defineExpose({ play, pause, seek, setPlaybackRate });
</script>
```

## 页面布局结构

### 布局说明
页面采用上中下三栏布局：
- **顶部工具栏**: 设备选择、日期时间选择、加载录像按钮、播放控制
- **主内容区**: 左侧时间轴 + 右侧视频播放器
  - 左侧时间轴：展示24小时录像分布、事件标记、当前播放位置
  - 右侧播放器：视频显示、播放控制、进度条、剪辑工具

### 核心组件开发

#### 1. 主页面组件 (single-playback.vue)

```vue
<template>
  <div class="single-playback-page">
    <!-- 顶部工具栏 -->
    <a-card class="toolbar-card" :bordered="false">
      <a-row :gutter="16" align="middle">
        <a-col :span="4">
          <a-select
            v-model:value="selectedDevice"
            placeholder="选择设备"
            style="width: 100%"
            @change="handleDeviceChange"
          >
            <a-select-option
              v-for="device in deviceList"
              :key="device.id"
              :value="device.id"
            >
              {{ device.name }}
            </a-select-option>
          </a-select>
        </a-col>

        <a-col :span="3">
          <a-date-picker
            v-model:value="playbackDate"
            placeholder="选择日期"
            format="YYYY-MM-DD"
            :disabled-date="disabledDate"
            style="width: 100%"
            @change="handleDateChange"
          />
        </a-col>

        <a-col :span="4">
          <a-select
            v-model:value="timePeriod"
            placeholder="时间段"
            style="width: 100%"
          >
            <a-select-option value="all">全天</a-select-option>
            <a-select-option value="morning">上午 (06:00-12:00)</a-select-option>
            <a-select-option value="afternoon">下午 (12:00-18:00)</a-select-option>
            <a-select-option value="evening">晚上 (18:00-24:00)</a-select-option>
            <a-select-option value="night">深夜 (00:00-06:00)</a-select-option>
            <a-select-option value="custom">自定义</a-select-option>
          </a-select>
        </a-col>

        <a-col v-if="timePeriod === 'custom'" :span="5">
          <a-time-picker
            v-model:value="startTime"
            format="HH:mm:ss"
            placeholder="开始时间"
          />
          <span class="mx-2">至</span>
          <a-time-picker
            v-model:value="endTime"
            format="HH:mm:ss"
            placeholder="结束时间"
          />
        </a-col>

        <a-col :span="4">
          <a-button type="primary" @click="loadRecordings">
            <template #icon><SearchOutlined /></template>
            加载录像
          </a-button>
        </a-col>

        <a-col :span="4" style="text-align: right">
          <a-space>
            <a-button type="primary" @click="togglePlay">
              <template #icon>
                <PlayCircleOutlined v-if="!isPlaying" />
                <PauseCircleOutlined v-else />
              </template>
              {{ isPlaying ? '暂停' : '播放' }}
            </a-button>
            <a-button danger @click="stopPlayback">
              <template #icon><StopOutlined /></template>
              停止
            </a-button>
          </a-space>
        </a-col>
      </a-row>
    </a-card>

    <!-- 主内容区 -->
    <a-row :gutter="16" class="main-content">
      <!-- 左侧时间轴 -->
      <a-col :span="6">
        <PlaybackTimeline
          :date="playbackDate"
          :timeline-data="timelineData"
          :current-time="currentTime"
          @seek="handleSeek"
        />
      </a-col>

      <!-- 右侧视频播放器 -->
      <a-col :span="18">
        <a-card :bordered="false" class="player-card">
          <template #title>
            <div class="player-header">
              <h3>{{ currentDevice?.name || '未选择设备' }}</h3>
              <span class="playback-time">
                播放时间: {{ formatTime(currentTime) }}
              </span>
            </div>
          </template>

          <template #extra>
            <PlaybackControls
              :is-playing="isPlaying"
              :is-muted="isMuted"
              :volume="volume"
              :playback-rate="playbackRate"
              :quality="videoQuality"
              @play="play"
              @pause="pause"
              @stop="stopPlayback"
              @previous-frame="previousFrame"
              @next-frame="nextFrame"
              @backward="backward10Sec"
              @forward="forward10Sec"
              @toggle-mute="toggleMute"
              @volume-change="handleVolumeChange"
              @rate-change="handleRateChange"
              @quality-change="handleQualityChange"
              @snapshot="takeSnapshot"
              @clip="startClip"
              @download="downloadVideo"
              @zoom="toggleZoom"
              @fullscreen="toggleFullscreen"
            />
          </template>

          <!-- 视频播放器 -->
          <SingleVideoPlayer
            ref="playerRef"
            :playback-url="playbackUrl"
            :autoplay="false"
            @timeupdate="handleTimeUpdate"
            @play="isPlaying = true"
            @pause="isPlaying = false"
            @ended="handlePlaybackEnded"
          />

          <!-- 进度条和剪辑控制 -->
          <div class="progress-section">
            <a-slider
              v-model:value="progress"
              :min="0"
              :max="totalDuration"
              :step="1"
              :tooltip-visible="false"
              @change="handleProgressChange"
            />
            <div class="time-info">
              <span>{{ formatTime(currentTime) }}</span>
              <span>{{ formatTime(totalDuration) }}</span>
            </div>
          </div>

          <!-- 剪辑选择器 -->
          <div v-if="isClipping" class="clip-selector">
            <a-space>
              <span>剪辑范围:</span>
              <a-time-picker v-model:value="clipStart" format="HH:mm:ss" />
              <span>-</span>
              <a-time-picker v-model:value="clipEnd" format="HH:mm:ss" />
              <span>时长: {{ clipDuration }}</span>
              <a-button type="primary" size="small" @click="saveClip">
                保存剪辑
              </a-button>
              <a-button size="small" @click="cancelClip">取消</a-button>
            </a-space>
          </div>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import dayjs from 'dayjs';
import {
  SearchOutlined,
  PlayCircleOutlined,
  PauseCircleOutlined,
  StopOutlined,
} from '@ant-design/icons-vue';
import PlaybackTimeline from './components/PlaybackTimeline.vue';
import SingleVideoPlayer from './components/SingleVideoPlayer.vue';
import PlaybackControls from './components/PlaybackControls.vue';
import { singlePlaybackApi } from './api/single-playback-api';

// 响应式数据
const selectedDevice = ref(null);
const deviceList = ref([]);
const playbackDate = ref(dayjs());
const timePeriod = ref('all');
const startTime = ref(null);
const endTime = ref(null);

const isPlaying = ref(false);
const isMuted = ref(false);
const volume = ref(80);
const playbackRate = ref(1);
const videoQuality = ref('medium');

const currentTime = ref(0);
const totalDuration = ref(0);
const progress = ref(0);

const timelineData = ref([]);
const playbackUrl = ref('');

const isClipping = ref(false);
const clipStart = ref(null);
const clipEnd = ref(null);

const playerRef = ref(null);

// 计算属性
const currentDevice = computed(() => {
  return deviceList.value.find(d => d.id === selectedDevice.value);
});

const clipDuration = computed(() => {
  if (clipStart.value && clipEnd.value) {
    const diff = clipEnd.value.diff(clipStart.value, 'second');
    return formatDuration(diff);
  }
  return '00:00:00';
});

// 方法
const disabledDate = (current) => {
  return current && current > dayjs().endOf('day');
};

const loadDeviceList = async () => {
  try {
    const res = await singlePlaybackApi.getDeviceList();
    deviceList.value = res.data;
  } catch (error) {
    message.error('加载设备列表失败');
  }
};

const loadRecordings = async () => {
  if (!selectedDevice.value) {
    message.warning('请选择设备');
    return;
  }

  try {
    message.loading('正在加载录像...', 0);
    const params = {
      deviceId: selectedDevice.value,
      date: playbackDate.value.format('YYYY-MM-DD'),
      timePeriod: timePeriod.value,
      startTime: startTime.value?.format('HH:mm:ss'),
      endTime: endTime.value?.format('HH:mm:ss'),
    };

    const res = await singlePlaybackApi.getRecordingTimeline(params);
    timelineData.value = res.data;
    message.destroy();
    message.success('录像加载完成');
  } catch (error) {
    message.destroy();
    message.error('加载录像失败');
  }
};

const handleDeviceChange = () => {
  timelineData.value = [];
  playbackUrl.value = '';
};

const handleDateChange = () => {
  timelineData.value = [];
};

const handleSeek = (time) => {
  playerRef.value?.seek(time);
  currentTime.value = time;
};

const togglePlay = () => {
  if (isPlaying.value) {
    playerRef.value?.pause();
  } else {
    playerRef.value?.play();
  }
};

const play = () => playerRef.value?.play();
const pause = () => playerRef.value?.pause();

const stopPlayback = () => {
  playerRef.value?.pause();
  playerRef.value?.seek(0);
  currentTime.value = 0;
  progress.value = 0;
  isPlaying.value = false;
};

const previousFrame = () => {
  const newTime = Math.max(0, currentTime.value - 0.04); // 假设25fps
  handleSeek(newTime);
};

const nextFrame = () => {
  const newTime = Math.min(totalDuration.value, currentTime.value + 0.04);
  handleSeek(newTime);
};

const backward10Sec = () => {
  const newTime = Math.max(0, currentTime.value - 10);
  handleSeek(newTime);
};

const forward10Sec = () => {
  const newTime = Math.min(totalDuration.value, currentTime.value + 10);
  handleSeek(newTime);
};

const toggleMute = () => {
  isMuted.value = !isMuted.value;
};

const handleVolumeChange = (val) => {
  volume.value = val;
};

const handleRateChange = (rate) => {
  playbackRate.value = rate;
  playerRef.value?.setPlaybackRate(rate);
};

const handleQualityChange = (quality) => {
  videoQuality.value = quality;
  message.info(`切换到${quality}画质`);
};

const takeSnapshot = async () => {
  try {
    message.success('截图已保存');
  } catch (error) {
    message.error('截图失败');
  }
};

const startClip = () => {
  isClipping.value = true;
  clipStart.value = dayjs().startOf('day').add(currentTime.value, 'second');
  clipEnd.value = clipStart.value.add(60, 'second');
};

const saveClip = async () => {
  try {
    const params = {
      deviceId: selectedDevice.value,
      startTime: clipStart.value.format('HH:mm:ss'),
      endTime: clipEnd.value.format('HH:mm:ss'),
    };
    await singlePlaybackApi.createClipTask(params);
    message.success('剪辑任务已创建');
    isClipping.value = false;
  } catch (error) {
    message.error('创建剪辑任务失败');
  }
};

const cancelClip = () => {
  isClipping.value = false;
};

const downloadVideo = async () => {
  try {
    message.info('开始下载视频');
  } catch (error) {
    message.error('下载失败');
  }
};

const toggleZoom = () => {
  message.info('数字放大功能');
};

const toggleFullscreen = () => {
  // 全屏逻辑
};

const handleTimeUpdate = (time) => {
  currentTime.value = time;
  progress.value = time;
};

const handleProgressChange = (val) => {
  handleSeek(val);
};

const handlePlaybackEnded = () => {
  isPlaying.value = false;
  message.info('播放结束');
};

const formatTime = (seconds) => {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = Math.floor(seconds % 60);
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
};

const formatDuration = (seconds) => {
  return formatTime(seconds);
};

// 生命周期
onMounted(() => {
  loadDeviceList();
});
</script>

<style lang="less" scoped>
.single-playback-page {
  padding: 16px;
  height: 100%;
  display: flex;
  flex-direction: column;

  .toolbar-card {
    margin-bottom: 16px;
  }

  .main-content {
    flex: 1;
    overflow: hidden;
  }

  .player-card {
    height: 100%;

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;

      h3 {
        margin: 0;
      }

      .playback-time {
        font-size: 14px;
        color: #666;
      }
    }
  }

  .progress-section {
    margin-top: 16px;

    .time-info {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #666;
    }
  }

  .clip-selector {
    margin-top: 12px;
    padding: 12px;
    background: #f5f5f5;
    border-radius: 4px;
  }
}
</style>
```

#### 2. 时间轴组件 (PlaybackTimeline.vue)

```vue
<template>
  <a-card :bordered="false" class="timeline-card">
    <template #title>
      <div>
        <h4>时间轴</h4>
        <p class="timeline-date">{{ formattedDate }}</p>
      </div>
    </template>

    <div class="timeline-container">
      <!-- 24小时时间轴 -->
      <div
        v-for="hour in 24"
        :key="hour"
        class="timeline-hour"
        @click="handleHourClick(hour - 1)"
      >
        <div class="hour-label">
          <span class="hour-text">{{ formatHour(hour - 1) }}:00</span>
          <span class="period-text">{{ getPeriodLabel(hour - 1) }}</span>
        </div>

        <div class="hour-bar">
          <!-- 录像段 -->
          <div
            v-for="segment in getHourSegments(hour - 1)"
            :key="segment.id"
            class="recording-segment"
            :class="`segment-${segment.type}`"
            :style="{
              left: segment.startPercent + '%',
              width: segment.durationPercent + '%',
            }"
          />

          <!-- 事件标记 -->
          <div
            v-for="event in getHourEvents(hour - 1)"
            :key="event.id"
            class="event-marker"
            :class="`event-${event.type}`"
            :style="{ left: event.positionPercent + '%' }"
            :title="event.description"
          />
        </div>
      </div>

      <!-- 当前播放位置指示器 -->
      <div
        class="playback-indicator"
        :style="{ top: currentPositionPercent + '%' }"
      >
        <div class="indicator-dot" />
      </div>

      <!-- 图例 -->
      <div class="timeline-legend">
        <div class="legend-title">图例</div>
        <div class="legend-item">
          <span class="legend-color segment-scheduled" />
          <span>定时录像</span>
        </div>
        <div class="legend-item">
          <span class="legend-color segment-motion" />
          <span>移动侦测</span>
        </div>
        <div class="legend-item">
          <span class="legend-color segment-alarm" />
          <span>告警录像</span>
        </div>
        <div class="legend-item">
          <span class="legend-color segment-manual" />
          <span>手动录像</span>
        </div>
      </div>
    </div>
  </a-card>
</template>

<script setup>
import { computed } from 'vue';
import dayjs from 'dayjs';

const props = defineProps({
  date: {
    type: Object, // dayjs对象
    required: true,
  },
  timelineData: {
    type: Array,
    default: () => [],
  },
  currentTime: {
    type: Number,
    default: 0,
  },
});

const emit = defineEmits(['seek']);

const formattedDate = computed(() => {
  return props.date.format('YYYY-MM-DD');
});

const currentPositionPercent = computed(() => {
  const totalSeconds = 24 * 3600;
  return (props.currentTime / totalSeconds) * 100;
});

const formatHour = (hour) => {
  return hour.toString().padStart(2, '0');
};

const getPeriodLabel = (hour) => {
  if (hour >= 0 && hour < 6) return '深夜';
  if (hour >= 6 && hour < 12) return '上午';
  if (hour >= 12 && hour < 18) return '下午';
  return '晚上';
};

const getHourSegments = (hour) => {
  // 从timelineData中筛选该小时的录像段
  return props.timelineData
    .filter(item => {
      const itemHour = dayjs(item.startTime).hour();
      return itemHour === hour;
    })
    .map(item => {
      const start = dayjs(item.startTime);
      const end = dayjs(item.endTime);
      const hourStart = start.startOf('hour');

      const startMinute = start.diff(hourStart, 'minute');
      const duration = end.diff(start, 'minute');

      return {
        id: item.id,
        type: item.type,
        startPercent: (startMinute / 60) * 100,
        durationPercent: (duration / 60) * 100,
      };
    });
};

const getHourEvents = (hour) => {
  // 获取该小时的事件标记
  return [];
};

const handleHourClick = (hour) => {
  const seekTime = hour * 3600;
  emit('seek', seekTime);
};
</script>

<style lang="less" scoped>
.timeline-card {
  height: 100%;

  .timeline-date {
    font-size: 12px;
    color: #999;
    margin: 4px 0 0;
  }
}

.timeline-container {
  position: relative;
  height: 100%;
  overflow-y: auto;
}

.timeline-hour {
  margin-bottom: 8px;
  cursor: pointer;

  &:hover {
    .hour-bar {
      background: #f0f0f0;
    }
  }

  .hour-label {
    display: flex;
    align-items: center;
    margin-bottom: 4px;

    .hour-text {
      font-size: 12px;
      font-weight: 500;
      color: #333;
    }

    .period-text {
      font-size: 10px;
      color: #999;
      margin-left: 8px;
    }
  }

  .hour-bar {
    position: relative;
    height: 32px;
    background: #e8e8e8;
    border-radius: 4px;
    overflow: hidden;

    .recording-segment {
      position: absolute;
      top: 0;
      height: 100%;
      opacity: 0.7;
      transition: opacity 0.2s;

      &:hover {
        opacity: 1;
      }

      &.segment-scheduled {
        background: #52c41a;
      }

      &.segment-motion {
        background: #1890ff;
      }

      &.segment-alarm {
        background: #ff4d4f;
      }

      &.segment-manual {
        background: #faad14;
      }
    }

    .event-marker {
      position: absolute;
      top: 4px;
      width: 8px;
      height: 8px;
      border-radius: 50%;

      &.event-alarm {
        background: #ff4d4f;
      }

      &.event-motion {
        background: #faad14;
      }

      &.event-manual {
        background: #1890ff;
      }
    }
  }
}

.playback-indicator {
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;
  background: #ff4d4f;
  pointer-events: none;

  .indicator-dot {
    position: absolute;
    left: -4px;
    top: -3px;
    width: 8px;
    height: 8px;
    background: #ff4d4f;
    border-radius: 50%;
  }
}

.timeline-legend {
  margin-top: 16px;
  padding: 12px;
  background: #fafafa;
  border-radius: 4px;

  .legend-title {
    font-size: 12px;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    font-size: 12px;
    margin-bottom: 4px;

    .legend-color {
      display: inline-block;
      width: 16px;
      height: 8px;
      border-radius: 2px;
      margin-right: 8px;
      opacity: 0.7;
    }
  }
}
</style>
```

#### 3. 播放控制组件 (PlaybackControls.vue)

```vue
<template>
  <a-space :size="8">
    <!-- 帧控制 -->
    <a-tooltip title="上一帧">
      <a-button size="small" @click="emit('previous-frame')">
        <template #icon><StepBackwardOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="后退10秒">
      <a-button size="small" @click="emit('backward')">
        <template #icon><FastBackwardOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip :title="isPlaying ? '暂停' : '播放'">
      <a-button
        type="primary"
        size="small"
        @click="isPlaying ? emit('pause') : emit('play')"
      >
        <template #icon>
          <PlayCircleOutlined v-if="!isPlaying" />
          <PauseCircleOutlined v-else />
        </template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="前进10秒">
      <a-button size="small" @click="emit('forward')">
        <template #icon><FastForwardOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="下一帧">
      <a-button size="small" @click="emit('next-frame')">
        <template #icon><StepForwardOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-divider type="vertical" />

    <!-- 音量控制 -->
    <a-tooltip :title="isMuted ? '取消静音' : '静音'">
      <a-button size="small" @click="emit('toggle-mute')">
        <template #icon>
          <SoundOutlined v-if="!isMuted" />
          <MutedOutlined v-else />
        </template>
      </a-button>
    </a-tooltip>

    <a-slider
      :value="volume"
      :min="0"
      :max="100"
      style="width: 80px"
      @change="emit('volume-change', $event)"
    />

    <a-divider type="vertical" />

    <!-- 播放速度 -->
    <a-select
      :value="playbackRate"
      size="small"
      style="width: 80px"
      @change="emit('rate-change', $event)"
    >
      <a-select-option :value="0.25">0.25x</a-select-option>
      <a-select-option :value="0.5">0.5x</a-select-option>
      <a-select-option :value="1">1x</a-select-option>
      <a-select-option :value="2">2x</a-select-option>
      <a-select-option :value="4">4x</a-select-option>
      <a-select-option :value="8">8x</a-select-option>
      <a-select-option :value="16">16x</a-select-option>
    </a-select>

    <!-- 画质选择 -->
    <a-select
      :value="quality"
      size="small"
      style="width: 80px"
      @change="emit('quality-change', $event)"
    >
      <a-select-option value="original">原始</a-select-option>
      <a-select-option value="high">高清</a-select-option>
      <a-select-option value="medium">标清</a-select-option>
      <a-select-option value="low">流畅</a-select-option>
    </a-select>

    <a-divider type="vertical" />

    <!-- 操作按钮 -->
    <a-tooltip title="截图">
      <a-button type="primary" size="small" @click="emit('snapshot')">
        <template #icon><CameraOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="剪辑">
      <a-button type="primary" size="small" @click="emit('clip')">
        <template #icon><ScissorOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="下载">
      <a-button type="primary" size="small" @click="emit('download')">
        <template #icon><DownloadOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="数字放大">
      <a-button size="small" @click="emit('zoom')">
        <template #icon><ZoomInOutlined /></template>
      </a-button>
    </a-tooltip>

    <a-tooltip title="全屏">
      <a-button size="small" @click="emit('fullscreen')">
        <template #icon><ExpandOutlined /></template>
      </a-button>
    </a-tooltip>
  </a-space>
</template>

<script setup>
import {
  PlayCircleOutlined,
  PauseCircleOutlined,
  StepBackwardOutlined,
  StepForwardOutlined,
  FastBackwardOutlined,
  FastForwardOutlined,
  SoundOutlined,
  MutedOutlined,
  CameraOutlined,
  ScissorOutlined,
  DownloadOutlined,
  ZoomInOutlined,
  ExpandOutlined,
} from '@ant-design/icons-vue';

defineProps({
  isPlaying: Boolean,
  isMuted: Boolean,
  volume: Number,
  playbackRate: Number,
  quality: String,
});

const emit = defineEmits([
  'play',
  'pause',
  'stop',
  'previous-frame',
  'next-frame',
  'backward',
  'forward',
  'toggle-mute',
  'volume-change',
  'rate-change',
  'quality-change',
  'snapshot',
  'clip',
  'download',
  'zoom',
  'fullscreen',
]);
</script>
```

## 路由配置

```javascript
// src/router/business/smart-video-router.js
export const smartVideoRouter = {
  path: '/smart-video',
  name: 'SmartVideo',
  component: () => import('/@/layout/index.vue'),
  meta: { title: '智能视频', icon: 'VideoCameraOutlined' },
  children: [
    {
      path: 'single-playback',
      name: 'SinglePlayback',
      component: () => import('/@/views/business/smart-video/single-playback.vue'),
      meta: {
        title: '单路回放',
        icon: 'PlayCircleOutlined',
      },
    },
  ],
};
```

## 菜单配置

```javascript
// 菜单配置示例
{
  menuName: '单路回放',
  menuType: 1,
  path: '/smart-video/single-playback',
  component: '/business/smart-video/single-playback',
  icon: 'PlayCircleOutlined',
  parentId: 0, // 智能视频菜单的ID
  sort: 2,
  perms: 'smart-video:playback:view',
}
```

## Mock数据

```javascript
// src/views/business/smart-video/mock/single-playback-mock.js
export const mockDeviceList = [
  { id: 'CAM001', name: 'CAM001 - 办公区域前门', ip: '192.168.1.101' },
  { id: 'CAM002', name: 'CAM002 - 大厅中央', ip: '192.168.1.102' },
  { id: 'CAM003', name: 'CAM003 - 走廊东侧', ip: '192.168.1.103' },
  { id: 'CAM004', name: 'CAM004 - 会议室001', ip: '192.168.1.104' },
  { id: 'CAM005', name: 'CAM005 - 电梯前厅', ip: '192.168.1.105' },
];

export const mockTimelineData = [
  {
    id: '1',
    deviceId: 'CAM001',
    startTime: '2024-01-30 00:00:00',
    endTime: '2024-01-30 04:30:00',
    type: 'scheduled', // 定时录像
    fileSize: 5242880,
  },
  {
    id: '2',
    deviceId: 'CAM001',
    startTime: '2024-01-30 06:00:00',
    endTime: '2024-01-30 12:00:00',
    type: 'scheduled',
    fileSize: 10485760,
  },
  {
    id: '3',
    deviceId: 'CAM001',
    startTime: '2024-01-30 08:23:15',
    endTime: '2024-01-30 08:28:15',
    type: 'alarm', // 告警录像
    fileSize: 1048576,
    eventType: '入侵检测',
  },
  {
    id: '4',
    deviceId: 'CAM001',
    startTime: '2024-01-30 12:00:00',
    endTime: '2024-01-30 18:00:00',
    type: 'scheduled',
    fileSize: 10485760,
  },
  {
    id: '5',
    deviceId: 'CAM001',
    startTime: '2024-01-30 18:00:00',
    endTime: '2024-01-30 22:00:00',
    type: 'scheduled',
    fileSize: 7340032,
  },
];
```

## 开发检查清单

- [ ] 确认使用Vue 3 Composition API语法
- [ ] 确认所有图标从@ant-design/icons-vue正确导入
- [ ] 确认使用Ant Design Vue组件
- [ ] 确认API接口使用SmartAdmin的请求封装
- [ ] 确认路由配置符合SmartAdmin规范
- [ ] 确认视频播放器正确集成和销毁
- [ ] 确认日期时间选择器使用dayjs
- [ ] 确认响应式数据使用ref/reactive
- [ ] 确认组件间通信使用emit
- [ ] 确认添加必要的错误处理和用户提示

---

**文档版本**: v1.0
**创建日期**: 2025-01-05
**适用框架**: SmartAdmin (Vue 3.4.27 + Ant Design Vue 4.2.5)
