# 电视墙管理页面功能与布局文档

## 页面概述
电视墙管理页面是智能视频监控系统的核心功能模块，用于管理大屏展示系统的矩阵配置、解码器绑定和窗口分割预案。基于SmartAdmin框架，采用Vue3 + Ant Design Vue技术栈，支持电视墙的全生命周期管理。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/smart-video/
├── tv-wall-management.vue          # 电视墙管理主页面
├── components/
│   ├── TvWallForm.vue             # 电视墙表单组件
│   ├── MatrixGrid.vue             # 矩阵可视化组件
│   └── WindowSplit.vue            # 窗口分割组件
├── mock/
│   └── tv-wall-mock-data.js       # 模拟数据
└── api/
    └── tv-wall-api.js             # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/tv-wall-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const tvWallApi = {
  // 查询电视墙列表
  queryTvWallList: (params) => postRequest('/tv-wall/query', params),
  // 添加电视墙
  addTvWall: (params) => postRequest('/tv-wall/add', params),
  // 更新电视墙
  updateTvWall: (params) => postRequest('/tv-wall/update', params),
  // 删除电视墙
  deleteTvWall: (id) => getRequest(`/tv-wall/delete/${id}`),
  // 批量删除
  batchDeleteTvWall: (ids) => postRequest('/tv-wall/batch-delete', ids),
  // 获取矩阵配置
  getMatrixConfig: (id) => getRequest(`/tv-wall/matrix/${id}`),
  // 保存窗口分割预案
  saveWindowPlan: (params) => postRequest('/tv-wall/window-plan/save', params),
  // 获取窗口分割预案
  getWindowPlans: (tvWallId) => getRequest(`/tv-wall/window-plan/${tvWallId}`),
  // 绑定解码器
  bindDecoder: (params) => postRequest('/tv-wall/bind-decoder', params),
};
```

## ⚠️ 开发注意事项

### 1. 图标使用规范

#### ✅ 正确：使用实际存在的图标
```vue
<script setup>
import {
  DesktopOutlined,      // 电视墙图标
  AppstoreOutlined,     // 矩阵图标
  SplitCellsOutlined,   // 分割图标
  SaveOutlined,         // 保存图标
  EditOutlined,         // 编辑图标
  DeleteOutlined,       // 删除图标
  PlusOutlined,         // 添加图标
  SearchOutlined,       // 搜索图标
  CheckCircleOutlined,  // 在线状态
  CloseCircleOutlined,  // 离线状态
} from '@ant-design/icons-vue';
</script>
```

### 2. Vue 3 组件开发规范

#### ✅ 正确的弹窗使用方式
```vue
<template>
  <a-modal
    :open="visible"
    title="新增电视墙"
    @cancel="handleCancel"
    @ok="handleOk"
  >
    <a-form :model="formState" :label-col="{ span: 6 }">
      <a-form-item label="电视墙名称" required>
        <a-input v-model:value="formState.name" placeholder="请输入名称" />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive } from 'vue';

const props = defineProps({
  visible: Boolean
});

const emit = defineEmits(['update:visible', 'ok']);

const formState = reactive({
  name: '',
  matrixRows: 3,
  matrixCols: 3,
  resolution: '1920x1080'
});

const handleCancel = () => {
  emit('update:visible', false);
};

const handleOk = () => {
  emit('ok', formState);
};
</script>
```

### 3. API导入路径
```javascript
// ✅ 正确
import { postRequest, getRequest } from '/@/lib/axios';

// ❌ 错误
import { postRequest, getRequest } from '/@/lib/smart-request';
```

## 核心功能实现

### 1. 电视墙列表主页面
```vue
<template>
  <div class="tv-wall-management">
    <!-- 页面头部 -->
    <div class="page-header">
      <a-page-header title="电视墙管理" />
      <a-button type="primary" @click="openAddModal">
        <template #icon><PlusOutlined /></template>
        新增电视墙
      </a-button>
    </div>

    <!-- 搜索栏 -->
    <div class="search-bar">
      <a-input-search
        v-model:value="searchKeyword"
        placeholder="搜索电视墙名称"
        style="width: 300px"
        @search="handleSearch"
      >
        <template #prefix><SearchOutlined /></template>
      </a-input-search>

      <a-button danger @click="handleBatchDelete">
        <template #icon><DeleteOutlined /></template>
        删除选中
      </a-button>
    </div>

    <!-- 数据表格 -->
    <a-table
      :columns="columns"
      :data-source="dataSource"
      :row-selection="rowSelection"
      :loading="loading"
      :pagination="pagination"
      @change="handleTableChange"
    >
      <!-- 状态列 -->
      <template #status="{ record }">
        <a-tag :color="record.status === 'online' ? 'success' : 'error'">
          <template #icon>
            <CheckCircleOutlined v-if="record.status === 'online'" />
            <CloseCircleOutlined v-else />
          </template>
          {{ record.status === 'online' ? '在线' : '离线' }}
        </a-tag>
      </template>

      <!-- 操作列 -->
      <template #action="{ record }">
        <a-space>
          <a-button type="link" @click="handleEdit(record)">
            <EditOutlined /> 编辑
          </a-button>
          <a-button type="link" danger @click="handleDelete(record)">
            <DeleteOutlined /> 删除
          </a-button>
        </a-space>
      </template>
    </a-table>

    <!-- 新增/编辑弹窗 -->
    <TvWallForm
      :visible="formVisible"
      :form-data="currentRecord"
      @update:visible="formVisible = $event"
      @ok="handleFormOk"
    />
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  PlusOutlined,
  SearchOutlined,
  EditOutlined,
  DeleteOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons-vue';
import { tvWallApi } from '/@/api/business/smart-video/tv-wall-api';
import TvWallForm from './components/TvWallForm.vue';

// 表格列配置
const columns = [
  { title: '电视墙名称', dataIndex: 'name', key: 'name' },
  { title: '矩阵配置', dataIndex: 'matrix', key: 'matrix' },
  { title: '分辨率', dataIndex: 'resolution', key: 'resolution' },
  { title: '状态', dataIndex: 'status', key: 'status', slots: { customRender: 'status' } },
  { title: '创建时间', dataIndex: 'createTime', key: 'createTime' },
  { title: '操作', key: 'action', slots: { customRender: 'action' } }
];

// 数据源
const dataSource = ref([]);
const loading = ref(false);
const searchKeyword = ref('');
const formVisible = ref(false);
const currentRecord = ref(null);

// 行选择
const selectedRowKeys = ref([]);
const rowSelection = {
  selectedRowKeys: selectedRowKeys,
  onChange: (keys) => {
    selectedRowKeys.value = keys;
  }
};

// 分页配置
const pagination = reactive({
  current: 1,
  pageSize: 10,
  total: 0,
  showSizeChanger: true,
  showTotal: (total) => `共 ${total} 条`
});

// 加载数据
const loadData = async () => {
  loading.value = true;
  try {
    const params = {
      pageNum: pagination.current,
      pageSize: pagination.pageSize,
      searchKeyword: searchKeyword.value
    };
    const res = await tvWallApi.queryTvWallList(params);
    if (res.data.code === 1) {
      dataSource.value = res.data.data.list;
      pagination.total = res.data.data.total;
    }
  } catch (error) {
    message.error('数据加载失败');
  } finally {
    loading.value = false;
  }
};

// 打开新增弹窗
const openAddModal = () => {
  currentRecord.value = null;
  formVisible.value = true;
};

// 编辑
const handleEdit = (record) => {
  currentRecord.value = { ...record };
  formVisible.value = true;
};

// 删除
const handleDelete = async (record) => {
  try {
    const res = await tvWallApi.deleteTvWall(record.id);
    if (res.data.code === 1) {
      message.success('删除成功');
      loadData();
    }
  } catch (error) {
    message.error('删除失败');
  }
};

// 批量删除
const handleBatchDelete = async () => {
  if (selectedRowKeys.value.length === 0) {
    message.warning('请先选择要删除的电视墙');
    return;
  }
  try {
    const res = await tvWallApi.batchDeleteTvWall(selectedRowKeys.value);
    if (res.data.code === 1) {
      message.success('删除成功');
      selectedRowKeys.value = [];
      loadData();
    }
  } catch (error) {
    message.error('删除失败');
  }
};

// 表单提交
const handleFormOk = () => {
  formVisible.value = false;
  loadData();
};

// 搜索
const handleSearch = () => {
  pagination.current = 1;
  loadData();
};

// 表格变化
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadData();
};

onMounted(() => {
  loadData();
});
</script>

<style scoped lang="less">
.tv-wall-management {
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .search-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 16px;
  }
}
</style>
```

### 2. 电视墙表单组件
```vue
<template>
  <a-modal
    :open="visible"
    :title="formData ? '编辑电视墙' : '新增电视墙'"
    width="720px"
    @cancel="handleCancel"
    @ok="handleOk"
  >
    <a-form
      ref="formRef"
      :model="formState"
      :rules="rules"
      :label-col="{ span: 6 }"
    >
      <!-- 电视墙名称 -->
      <a-form-item label="电视墙名称" name="name">
        <a-input v-model:value="formState.name" placeholder="请输入名称" />
      </a-form-item>

      <!-- 矩阵配置 -->
      <a-form-item label="矩阵配置">
        <a-row :gutter="16">
          <a-col :span="12">
            <a-select v-model:value="formState.matrixRows" @change="updateMatrix">
              <a-select-option v-for="i in 9" :key="i" :value="i">{{ i }} 行</a-select-option>
            </a-select>
          </a-col>
          <a-col :span="12">
            <a-select v-model:value="formState.matrixCols" @change="updateMatrix">
              <a-select-option v-for="i in 9" :key="i" :value="i">{{ i }} 列</a-select-option>
            </a-select>
          </a-col>
        </a-row>
      </a-form-item>

      <!-- 矩阵可视化 -->
      <a-form-item label="矩阵预览">
        <div class="matrix-grid" :style="gridStyle">
          <div
            v-for="(cell, index) in matrixCells"
            :key="index"
            class="matrix-cell"
          >
            {{ cell }}
          </div>
        </div>
      </a-form-item>

      <!-- 分辨率 -->
      <a-form-item label="分辨率" name="resolution">
        <a-select v-model:value="formState.resolution">
          <a-select-option value="1920x1080">1920×1080 (Full HD)</a-select-option>
          <a-select-option value="2560x1440">2560×1440 (2K)</a-select-option>
          <a-select-option value="3840x2160">3840×2160 (4K)</a-select-option>
          <a-select-option value="7680x4320">7680×4320 (8K)</a-select-option>
        </a-select>
      </a-form-item>

      <!-- 备注 -->
      <a-form-item label="备注">
        <a-textarea v-model:value="formState.remarks" :rows="3" placeholder="请输入备注" />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive, computed, watch } from 'vue';
import { message } from 'ant-design-vue';
import { tvWallApi } from '/@/api/business/smart-video/tv-wall-api';

const props = defineProps({
  visible: Boolean,
  formData: Object
});

const emit = defineEmits(['update:visible', 'ok']);

const formRef = ref();
const formState = reactive({
  name: '',
  matrixRows: 3,
  matrixCols: 3,
  resolution: '1920x1080',
  remarks: ''
});

const rules = {
  name: [{ required: true, message: '请输入电视墙名称', trigger: 'blur' }],
  resolution: [{ required: true, message: '请选择分辨率', trigger: 'change' }]
};

// 矩阵网格样式
const gridStyle = computed(() => ({
  display: 'grid',
  gridTemplateColumns: `repeat(${formState.matrixCols}, 1fr)`,
  gap: '4px',
  padding: '8px',
  background: '#f0f0f0',
  borderRadius: '4px'
}));

// 矩阵单元格
const matrixCells = computed(() => {
  const cells = [];
  const total = formState.matrixRows * formState.matrixCols;
  for (let i = 0; i < total; i++) {
    const row = Math.floor(i / formState.matrixCols) + 1;
    const col = (i % formState.matrixCols) + 1;
    cells.push(`${row}-${col}`);
  }
  return cells;
});

// 更新矩阵
const updateMatrix = () => {
  // 矩阵变化时的逻辑
};

// 取消
const handleCancel = () => {
  formRef.value?.resetFields();
  emit('update:visible', false);
};

// 确定
const handleOk = async () => {
  try {
    await formRef.value?.validate();
    const apiMethod = props.formData ? tvWallApi.updateTvWall : tvWallApi.addTvWall;
    const res = await apiMethod(formState);
    if (res.data.code === 1) {
      message.success(props.formData ? '更新成功' : '添加成功');
      emit('ok');
      handleCancel();
    }
  } catch (error) {
    console.error('表单验证失败', error);
  }
};

// 监听formData变化
watch(() => props.formData, (newVal) => {
  if (newVal) {
    Object.assign(formState, newVal);
  } else {
    formRef.value?.resetFields();
  }
}, { immediate: true });
</script>

<style scoped lang="less">
.matrix-grid {
  .matrix-cell {
    aspect-ratio: 1;
    background: white;
    border: 2px solid #d9d9d9;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: #666;
    transition: all 0.2s;

    &:hover {
      border-color: #1890ff;
      background: #e6f7ff;
    }
  }
}
</style>
```

## 路由配置

```javascript
// src/router/modules/business/smart-video.js
export default {
  path: '/smart-video',
  name: 'SmartVideo',
  component: () => import('/@/layout/base-layout.vue'),
  meta: { title: '智能视频', icon: 'VideoCameraOutlined' },
  children: [
    {
      path: 'tv-wall',
      name: 'TvWallManagement',
      component: () => import('/@/views/business/smart-video/tv-wall-management.vue'),
      meta: {
        title: '电视墙管理',
        icon: 'DesktopOutlined',
        requireAuth: true
      }
    }
  ]
};
```

## 菜单配置

```javascript
// src/constants/menu-type-enum.js 或后端菜单配置
{
  menuName: '电视墙管理',
  menuType: 'MENU',
  path: '/smart-video/tv-wall',
  component: '/business/smart-video/tv-wall-management',
  icon: 'DesktopOutlined',
  parentId: 'smart-video-parent-id',
  sortValue: 30,
  perms: 'smart-video:tv-wall:query'
}
```

## Mock数据示例

```javascript
// src/mock/business/tv-wall-mock-data.js

export const mockTvWallList = [
  {
    id: 1,
    name: '监控中心电视墙',
    matrix: '3×3',
    matrixRows: 3,
    matrixCols: 3,
    resolution: '1920x1080',
    status: 'online',
    createTime: '2024-01-15 10:30:00',
    remarks: '主监控中心大屏'
  },
  {
    id: 2,
    name: '大厅展示墙',
    matrix: '2×2',
    matrixRows: 2,
    matrixCols: 2,
    resolution: '2560x1440',
    status: 'online',
    createTime: '2024-01-16 14:20:00',
    remarks: ''
  },
  {
    id: 3,
    name: '会议室电视墙',
    matrix: '4×4',
    matrixRows: 4,
    matrixCols: 4,
    resolution: '3840x2160',
    status: 'offline',
    createTime: '2024-01-17 09:15:00',
    remarks: '临时维护中'
  }
];

// 窗口分割模式
export const WINDOW_SPLIT_MODES = [
  { label: '1分割', value: 1, rows: 1, cols: 1 },
  { label: '4分割', value: 4, rows: 2, cols: 2 },
  { label: '6分割', value: 6, rows: 2, cols: 3 },
  { label: '8分割', value: 8, rows: 2, cols: 4 },
  { label: '9分割', value: 9, rows: 3, cols: 3 },
  { label: '16分割', value: 16, rows: 4, cols: 4 }
];

// 分辨率选项
export const RESOLUTION_OPTIONS = [
  { label: '1920×1080 (Full HD)', value: '1920x1080' },
  { label: '2560×1440 (2K)', value: '2560x1440' },
  { label: '3840×2160 (4K)', value: '3840x2160' },
  { label: '7680×4320 (8K)', value: '7680x4320' }
];

export default {
  mockTvWallList,
  WINDOW_SPLIT_MODES,
  RESOLUTION_OPTIONS
};
```

## Pinia Store配置

```javascript
// src/store/modules/business/tv-wall.js
import { defineStore } from 'pinia';
import { message } from 'ant-design-vue';
import { tvWallApi } from '/@/api/business/smart-video/tv-wall-api';

export const useTvWallStore = defineStore('tvWall', {
  state: () => ({
    tvWallList: [],
    currentTvWall: null,
    windowPlans: [],
    loading: false
  }),

  getters: {
    onlineTvWalls: (state) => state.tvWallList.filter(wall => wall.status === 'online'),
    getTvWallById: (state) => (id) => state.tvWallList.find(wall => wall.id === id)
  },

  actions: {
    // 获取电视墙列表
    async fetchTvWallList(params) {
      this.loading = true;
      try {
        const res = await tvWallApi.queryTvWallList(params);
        if (res.data.code === 1) {
          this.tvWallList = res.data.data.list;
          return res.data.data;
        }
      } catch (error) {
        message.error('获取电视墙列表失败');
      } finally {
        this.loading = false;
      }
    },

    // 添加电视墙
    async addTvWall(data) {
      try {
        const res = await tvWallApi.addTvWall(data);
        if (res.data.code === 1) {
          message.success('添加成功');
          return true;
        }
      } catch (error) {
        message.error('添加失败');
        return false;
      }
    },

    // 更新电视墙
    async updateTvWall(data) {
      try {
        const res = await tvWallApi.updateTvWall(data);
        if (res.data.code === 1) {
          message.success('更新成功');
          return true;
        }
      } catch (error) {
        message.error('更新失败');
        return false;
      }
    },

    // 删除电视墙
    async deleteTvWall(id) {
      try {
        const res = await tvWallApi.deleteTvWall(id);
        if (res.data.code === 1) {
          message.success('删除成功');
          return true;
        }
      } catch (error) {
        message.error('删除失败');
        return false;
      }
    },

    // 保存窗口分割预案
    async saveWindowPlan(data) {
      try {
        const res = await tvWallApi.saveWindowPlan(data);
        if (res.data.code === 1) {
          message.success('保存预案成功');
          return true;
        }
      } catch (error) {
        message.error('保存预案失败');
        return false;
      }
    }
  }
});
```

## 权限配置

```javascript
// 权限标识
export const TV_WALL_PERMISSIONS = {
  QUERY: 'smart-video:tv-wall:query',       // 查询
  ADD: 'smart-video:tv-wall:add',           // 添加
  UPDATE: 'smart-video:tv-wall:update',     // 更新
  DELETE: 'smart-video:tv-wall:delete',     // 删除
  BIND_DECODER: 'smart-video:tv-wall:bind', // 绑定解码器
  SAVE_PLAN: 'smart-video:tv-wall:plan'     // 保存预案
};
```

## 核心功能清单

### 1. 电视墙管理
- ✅ 电视墙列表查询（分页、搜索）
- ✅ 新增电视墙（名称、矩阵、分辨率）
- ✅ 编辑电视墙配置
- ✅ 删除电视墙（单个/批量）
- ✅ 电视墙状态监控（在线/离线）

### 2. 矩阵配置
- ✅ 行列数配置（1-9行×1-9列）
- ✅ 矩阵可视化预览
- ✅ 单元格位置编号
- ✅ 分辨率选择（Full HD/2K/4K/8K）

### 3. 窗口分割
- ✅ 预设分割模式（1/4/6/8/9/16分割）
- ✅ 自定义分割配置
- ✅ 分割预案保存
- ✅ 预案快速切换

### 4. 解码器绑定
- ✅ 解码器选择绑定
- ✅ 解码器通道分配
- ✅ 绑定关系管理

## 开发检查清单

### 代码规范
- [ ] 组件使用 Vue 3 Composition API
- [ ] 图标从 @ant-design/icons-vue 导入
- [ ] API路径使用 /@/lib/axios
- [ ] 组件文件使用 PascalCase 命名
- [ ] 样式使用 Less 预处理器

### 功能完整性
- [ ] 列表查询、分页功能正常
- [ ] 新增、编辑、删除功能正常
- [ ] 搜索过滤功能正常
- [ ] 批量操作功能正常
- [ ] 状态展示正常

### 用户体验
- [ ] 加载状态提示
- [ ] 操作成功/失败提示
- [ ] 表单验证提示
- [ ] 确认对话框
- [ ] 响应式布局

### 性能优化
- [ ] 合理使用 computed 和 watch
- [ ] 避免不必要的重复渲染
- [ ] 图片/资源懒加载
- [ ] 分页加载优化

---

**文档版本**: v1.0
**最后更新**: 2025-01-05
**适用项目**: SmartAdmin (Vue 3.4.27 + Ant Design Vue 4.2.5)
