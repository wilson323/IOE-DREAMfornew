<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>离线消费管理 - 消费管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="../js/menu.js" defer></script>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        .split-container {
            display: flex;
            gap: var(--space-lg);
            height: calc(100vh - 180px);
            overflow: hidden;
        }

        /* 左侧面板 */
        .left-panel {
            width: 320px;
            min-width: 280px;
            max-width: 400px;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .panel-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: var(--space-sm) var(--space-sm) var(--space-sm) var(--space-xl);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md);
        }

        /* 部门树 */
        .dept-tree {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dept-item {
            margin-bottom: var(--space-xs);
        }

        .dept-header {
            display: flex;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: background var(--transition);
        }

        .dept-header:hover {
            background: var(--gray-50);
        }

        .dept-header.active {
            background: var(--primary-50);
            color: var(--primary-600);
        }

        .dept-toggle {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: var(--space-xs);
            color: var(--gray-400);
        }

        .dept-toggle i {
            transition: transform var(--transition);
            font-size: var(--text-xs);
        }

        .dept-item.expanded .dept-toggle i {
            transform: rotate(90deg);
        }

        .dept-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-100);
            color: var(--primary-600);
            border-radius: var(--radius-md);
            margin-right: var(--space-sm);
            font-size: var(--text-sm);
        }

        .dept-name {
            flex: 1;
            font-weight: 500;
            font-size: var(--text-sm);
        }

        .dept-count {
            font-size: var(--text-xs);
            color: var(--gray-500);
            background: var(--gray-100);
            padding: 2px 8px;
            border-radius: var(--radius-full);
        }

        .dept-count.has-pending {
            background: var(--error-light);
            color: var(--error);
            font-weight: 600;
        }

        .user-list {
            display: none;
            margin-left: var(--space-xl);
            margin-top: var(--space-xs);
        }

        .dept-item.expanded .user-list {
            display: block;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: background var(--transition);
            margin-bottom: var(--space-xs);
        }

        .user-item:hover {
            background: var(--gray-50);
        }

        .user-item.active {
            background: var(--primary-50);
            border-left: 3px solid var(--primary-600);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--success-light);
            color: var(--success);
            border-radius: 50%;
            margin-right: var(--space-sm);
            font-size: var(--text-xs);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 500;
            font-size: var(--text-sm);
            color: var(--gray-900);
        }

        .user-id {
            font-size: var(--text-xs);
            color: var(--gray-500);
        }

        .user-badge {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--error);
            color: white;
            border-radius: 50%;
            font-size: 10px;
            font-weight: 600;
        }

        /* 右侧面板 */
        .right-panel {
            flex: 1;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-header {
            padding: var(--space-lg) var(--space-xl);
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .detail-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-detail {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .user-detail-avatar {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-100);
            color: var(--primary-600);
            border-radius: 50%;
            font-size: var(--text-lg);
        }

        .user-detail-info h3 {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0 0 var(--space-xs) 0;
        }

        .user-detail-meta {
            display: flex;
            gap: var(--space-lg);
            font-size: var(--text-xs);
            color: var(--gray-500);
        }

        .detail-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .detail-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-xl);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--gray-400);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: var(--space-lg);
        }

        .empty-state p {
            font-size: var(--text-lg);
        }

        /* 记录卡片 */
        .record-card {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            border: 1px solid var(--gray-200);
            transition: all var(--transition);
        }

        .record-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-300);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .record-time {
            font-weight: 600;
            color: var(--gray-900);
        }

        .record-status {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        .status-pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .status-synced {
            background: var(--success-light);
            color: var(--success);
        }

        .record-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: var(--text-xs);
            color: var(--gray-500);
        }

        .info-value {
            font-size: var(--text-sm);
            color: var(--gray-900);
            font-weight: 500;
        }

        .record-actions {
            display: flex;
            gap: var(--space-sm);
            padding-top: var(--space-md);
            border-top: 1px solid var(--gray-200);
        }

        .batch-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) var(--space-xl);
            background: var(--warning-light);
            border-bottom: 1px solid var(--warning);
        }

        .batch-info {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            color: var(--warning-dark);
            font-weight: 500;
        }

        .batch-actions {
            display: flex;
            gap: var(--space-sm);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-utensils fa-lg"></i>
                <div>
                    <div class="sidebar-title">消费管理系统</div>
                    <div class="sidebar-subtitle">Consumption Hub</div>
                </div>
            </div>
            <div class="sidebar-menu">
                <!-- 菜单将由 menu.js 自动生成 -->
            </div>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 顶部导航栏 -->
            <header class="header">
                <h1>离线消费管理</h1>
                <div class="header-actions">
                    <button class="btn btn-outline">
                        <i class="fas fa-bell"></i>
                        通知
                    </button>
                    <div class="user-info">
                        <div>
                            <div style="font-weight: 600;">系统管理员</div>
                            <div style="font-size: 12px; color: var(--gray-500);">在线</div>
                        </div>
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 主要内容 -->
            <div class="content">
                <div class="split-container">
                    <!-- 左侧：部门和人员 -->
                    <div class="left-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">部门与人员</h2>
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="搜索部门或人员..." id="searchInput" oninput="searchUser()">
                            </div>
                        </div>
                        <div class="panel-body">
                            <ul class="dept-tree" id="deptTree">
                                <!-- 部门和人员数据 -->
                                <li class="dept-item">
                                    <div class="dept-header" onclick="toggleDept(this)">
                                        <div class="dept-toggle"><i class="fas fa-chevron-right"></i></div>
                                        <div class="dept-icon"><i class="fas fa-building"></i></div>
                                        <div class="dept-name">技术部</div>
                                        <span class="dept-count has-pending">23</span>
                                    </div>
                                    <ul class="user-list">
                                        <li class="user-item" onclick="selectUser(this, '001')">
                                            <div class="user-avatar">张</div>
                                            <div class="user-info">
                                                <div class="user-name">张三</div>
                                                <div class="user-id">工号: T001</div>
                                            </div>
                                            <span class="user-badge">5</span>
                                        </li>
                                        <li class="user-item" onclick="selectUser(this, '002')">
                                            <div class="user-avatar">李</div>
                                            <div class="user-info">
                                                <div class="user-name">李四</div>
                                                <div class="user-id">工号: T002</div>
                                            </div>
                                            <span class="user-badge">3</span>
                                        </li>
                                        <li class="user-item" onclick="selectUser(this, '003')">
                                            <div class="user-avatar">王</div>
                                            <div class="user-info">
                                                <div class="user-name">王五</div>
                                                <div class="user-id">工号: T003</div>
                                            </div>
                                            <span class="user-badge">2</span>
                                        </li>
                                    </ul>
                                </li>

                                <li class="dept-item">
                                    <div class="dept-header" onclick="toggleDept(this)">
                                        <div class="dept-toggle"><i class="fas fa-chevron-right"></i></div>
                                        <div class="dept-icon"><i class="fas fa-users"></i></div>
                                        <div class="dept-name">市场部</div>
                                        <span class="dept-count has-pending">15</span>
                                    </div>
                                    <ul class="user-list">
                                        <li class="user-item" onclick="selectUser(this, '101')">
                                            <div class="user-avatar">赵</div>
                                            <div class="user-info">
                                                <div class="user-name">赵六</div>
                                                <div class="user-id">工号: M001</div>
                                            </div>
                                            <span class="user-badge">4</span>
                                        </li>
                                        <li class="user-item" onclick="selectUser(this, '102')">
                                            <div class="user-avatar">钱</div>
                                            <div class="user-info">
                                                <div class="user-name">钱七</div>
                                                <div class="user-id">工号: M002</div>
                                            </div>
                                            <span class="user-badge">1</span>
                                        </li>
                                    </ul>
                                </li>

                                <li class="dept-item">
                                    <div class="dept-header" onclick="toggleDept(this)">
                                        <div class="dept-toggle"><i class="fas fa-chevron-right"></i></div>
                                        <div class="dept-icon"><i class="fas fa-chart-line"></i></div>
                                        <div class="dept-name">财务部</div>
                                        <span class="dept-count">8</span>
                                    </div>
                                    <ul class="user-list">
                                        <li class="user-item" onclick="selectUser(this, '201')">
                                            <div class="user-avatar">孙</div>
                                            <div class="user-info">
                                                <div class="user-name">孙八</div>
                                                <div class="user-id">工号: F001</div>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- 右侧：离线记录详情 -->
                    <div class="right-panel">
                        <div class="detail-header">
                            <div class="detail-title">
                                <div class="user-detail" id="userDetail" style="display: none;">
                                    <div class="user-detail-avatar">张</div>
                                    <div class="user-detail-info">
                                        <h3 id="userName">张三</h3>
                                        <div class="user-detail-meta">
                                            <span><i class="fas fa-id-badge"></i> 工号: <span id="userNo">T001</span></span>
                                            <span><i class="fas fa-building"></i> 部门: <span id="userDept">技术部</span></span>
                                            <span><i class="fas fa-exclamation-circle"></i> 待审批: <span id="pendingCount" style="color: var(--error); font-weight: 600;">5</span> 条</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="detail-actions" id="detailActions" style="display: none;">
                                    <button class="btn btn-sm btn-primary" onclick="approveAll()">
                                        <i class="fas fa-check-double"></i>
                                        全部通过
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="refreshRecords()">
                                        <i class="fas fa-sync-alt"></i>
                                        刷新
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="detail-body" id="detailBody">
                            <!-- 空状态 -->
                            <div class="empty-state" id="emptyState">
                                <i class="fas fa-hand-pointer"></i>
                                <p>请从左侧选择人员查看离线记录</p>
                            </div>

                            <!-- 记录列表 -->
                            <div id="recordsList" style="display: none;">
                                <!-- 记录将由JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('离线消费管理页面加载完成');
        });

        // 展开/收起部门
        function toggleDept(element) {
            const deptItem = element.closest('.dept-item');
            deptItem.classList.toggle('expanded');
        }

        // 选择用户
        function selectUser(element, userId) {
            // 更新选中状态
            document.querySelectorAll('.user-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');

            // 显示用户详情
            document.getElementById('userDetail').style.display = 'flex';
            document.getElementById('detailActions').style.display = 'flex';
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('recordsList').style.display = 'block';

            // 加载用户的离线记录
            loadUserRecords(userId);
        }

        // 加载用户的离线记录
        function loadUserRecords(userId) {
            // 模拟数据
            const records = [
                {
                    id: 1,
                    time: '2024-03-15 12:30:45',
                    device: '设备001',
                    location: '第一食堂',
                    amount: '15.50',
                    type: '午餐',
                    status: 'pending'
                },
                {
                    id: 2,
                    time: '2024-03-15 08:15:20',
                    device: '设备001',
                    location: '第一食堂',
                    amount: '8.00',
                    type: '早餐',
                    status: 'pending'
                },
                {
                    id: 3,
                    time: '2024-03-14 18:20:10',
                    device: '设备002',
                    location: '第二食堂',
                    amount: '22.50',
                    type: '晚餐',
                    status: 'pending'
                },
                {
                    id: 4,
                    time: '2024-03-14 12:10:35',
                    device: '设备002',
                    location: '第二食堂',
                    amount: '18.00',
                    type: '午餐',
                    status: 'pending'
                },
                {
                    id: 5,
                    time: '2024-03-14 07:50:15',
                    device: '设备001',
                    location: '第一食堂',
                    amount: '6.50',
                    type: '早餐',
                    status: 'pending'
                }
            ];

            // 渲染记录列表
            const recordsList = document.getElementById('recordsList');
            recordsList.innerHTML = records.map(record => `
                <div class="record-card">
                    <div class="record-header">
                        <div class="record-time">${record.time}</div>
                        <div class="record-status ${record.status === 'pending' ? 'status-pending' : 'status-synced'}">
                            <i class="fas ${record.status === 'pending' ? 'fa-clock' : 'fa-check'}"></i>
                            ${record.status === 'pending' ? '待审批' : '已同步'}
                        </div>
                    </div>
                    <div class="record-info">
                        <div class="info-item">
                            <div class="info-label">消费地点</div>
                            <div class="info-value">${record.location}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">消费类型</div>
                            <div class="info-value">${record.type}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">设备编号</div>
                            <div class="info-value">${record.device}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">消费金额</div>
                            <div class="info-value" style="color: var(--primary-600); font-size: var(--text-lg);">¥${record.amount}</div>
                        </div>
                    </div>
                    ${record.status === 'pending' ? `
                        <div class="record-actions">
                            <button class="btn btn-sm btn-primary" onclick="approveRecord(${record.id})">
                                <i class="fas fa-check"></i>
                                通过审批
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="rejectRecord(${record.id})">
                                <i class="fas fa-times"></i>
                                拒绝
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // 审批单条记录
        function approveRecord(recordId) {
            if (confirm('确定要通过这条离线消费记录吗？')) {
                console.log('审批通过记录:', recordId);
                alert('离线消费记录已审批通过！');
                // 实际应用中，这里应该调用API
                // 然后重新加载记录列表
            }
        }

        // 拒绝单条记录
        function rejectRecord(recordId) {
            const reason = prompt('请输入拒绝原因：');
            if (reason) {
                console.log('拒绝记录:', recordId, '原因:', reason);
                alert('离线消费记录已拒绝！');
                // 实际应用中，这里应该调用API
            }
        }

        // 全部通过
        function approveAll() {
            if (confirm('确定要通过该用户所有待审批的离线消费记录吗？')) {
                console.log('全部通过');
                alert('所有离线消费记录已审批通过！');
                // 实际应用中，这里应该调用API
            }
        }

        // 刷新记录
        function refreshRecords() {
            console.log('刷新记录');
            alert('记录已刷新！');
            // 实际应用中，这里应该重新调用API加载数据
        }

        // 搜索用户
        function searchUser() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const userItems = document.querySelectorAll('.user-item');
            
            userItems.forEach(item => {
                const userName = item.querySelector('.user-name').textContent.toLowerCase();
                const userId = item.querySelector('.user-id').textContent.toLowerCase();
                
                if (userName.includes(keyword) || userId.includes(keyword)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
