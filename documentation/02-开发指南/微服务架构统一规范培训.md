# IOE-DREAM å¾®æœåŠ¡æ¶æ„ç»Ÿä¸€è§„èŒƒåŸ¹è®­

> **åŸ¹è®­ç›®æ ‡**: ç¡®ä¿æ‰€æœ‰å¼€å‘å›¢é˜ŸæŒæ¡å¹¶éµå¾ªç»Ÿä¸€å¾®æœåŠ¡æ¶æ„è§„èŒƒ
> **åŸ¹è®­ç‰ˆæœ¬**: v2.0.0 (åŸºäº UNIFIED_MICROSERVICES_STANDARDS.md)
> **åŸ¹è®­å¯¹è±¡**: å…¨ä½“å¼€å‘äººå‘˜ã€æ¶æ„å¸ˆã€æŠ€æœ¯è´Ÿè´£äºº
> **åŸ¹è®­æ—¶é•¿**: 4å°æ—¶ (ç†è®º2å°æ—¶ + å®è·µ2å°æ—¶)

---

## ğŸ“‹ åŸ¹è®­å¤§çº²

### **ç¬¬ä¸€éƒ¨åˆ†: ç†è®ºåŸ¹è®­ (2å°æ—¶)**

#### **1.1 ç»Ÿä¸€å¾®æœåŠ¡æ¶æ„æ¦‚è¿° (30åˆ†é’Ÿ)**
- ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æ¶æ„è§„èŒƒï¼Ÿ
- é¿å…"æŠŠå¾®æœåŠ¡å’Œå•ä½“æ¶æ„çš„ä»£ç æ··äº†"çš„é‡è¦æ€§
- ç»Ÿä¸€æ¶æ„å¸¦æ¥çš„å¥½å¤„
- è¿åè§„èŒƒçš„åæœ

#### **1.2 æ ¸å¿ƒæŠ€æœ¯æ ˆç»Ÿä¸€ (45åˆ†é’Ÿ)**
- **æœåŠ¡æ³¨å†Œå‘ç°**: Nacos (ç«¯å£8848) å¼ºåˆ¶ä½¿ç”¨
- **APIç½‘å…³**: Spring Cloud Gateway (ç«¯å£8080) ç»Ÿä¸€å…¥å£
- **æœåŠ¡é—´é€šä¿¡**: æ··åˆæ¨¡å¼ï¼ˆé»˜è®¤ GatewayServiceClient ç»ç½‘å…³ï¼›åŒåŸŸé«˜é¢‘çƒ­è·¯å¾„ç™½åå•å¯ç”¨ç»Ÿä¸€ç›´è¿ Clientï¼‰
- **ä¾èµ–æ³¨å…¥**: @Resource å¼ºåˆ¶ä½¿ç”¨
- **DAOå±‚**: @Mapper + Dao åç¼€ + @MapperScan ç»Ÿä¸€è§„èŒƒ

#### **1.3 ç¦æ­¢ä½¿ç”¨çš„è¿‡æ—¶æŠ€æœ¯ (30åˆ†é’Ÿ)**
- âŒ FeignClient éç™½åå•ç›´è¿ â†’ âœ… GatewayServiceClient æˆ–ç»Ÿä¸€ç›´è¿ Clientï¼ˆç™½åå•çƒ­è·¯å¾„ï¼‰
- âŒ @Autowired â†’ âœ… @Resource
- âŒ Consul/Eureka â†’ âœ… Nacos
- âŒ HikariCP â†’ âœ… Druid
- âŒ javax.* â†’ âœ… jakarta.*
- âŒ @Repository å’Œ @Mapper æ··ç”¨

#### **1.4 é…ç½®ç®¡ç†ç»Ÿä¸€ (15åˆ†é’Ÿ)**
- ç»Ÿä¸€ bootstrap.yml é…ç½®æ¨¡æ¿
- ç»Ÿä¸€ç«¯å£åˆ†é…è§„èŒƒ
- ç»Ÿä¸€ç¯å¢ƒå˜é‡ç®¡ç†

### **ç¬¬äºŒéƒ¨åˆ†: å®è·µåŸ¹è®­ (2å°æ—¶)**

#### **2.1 æ ‡å‡†å¾®æœåŠ¡åˆ›å»º (60åˆ†é’Ÿ)**

**æ¼”ç¤º1: åˆ›å»ºæ ‡å‡†çš„å¾®æœåŠ¡**
```bash
# 1. åˆ›å»ºå¾®æœåŠ¡ç›®å½•
mkdir microservices/ioedream-example-service

# 2. åˆ›å»ºæ ‡å‡†é…ç½®æ–‡ä»¶
cat > microservices/ioedream-example-service/src/main/resources/bootstrap.yml << 'EOF'
spring:
  application:
    name: ${SERVICE_NAME:ioedream-example-service}
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        enabled: true
        register-enabled: true
      config:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        file-extension: yaml

server:
  port: ${SERVER_PORT:8099}
EOF
```

**æ¼”ç¤º2: æ ‡å‡†å¯åŠ¨ç±»**
```java
@SpringBootApplication
@EnableDiscoveryClient
@MapperScan("net.lab1024.sa.example.repository")
public class ExampleServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(ExampleServiceApplication.class, args);
        log.info("[ExampleServiceApplication] æœåŠ¡å¯åŠ¨å®Œæˆï¼Œå·²æ³¨å†Œåˆ°Nacos");
    }
}
```

**æ¼”ç¤º3: æ ‡å‡†DAOå±‚**
```java
@Mapper
public interface ExampleDao extends BaseMapper<ExampleEntity> {

    @Transactional(readOnly = true)
    List<ExampleEntity> selectByStatus(String status);

    @Transactional
    int insertExample(ExampleEntity entity);
}
```

**æ¼”ç¤º4: æ ‡å‡†æœåŠ¡ç±»**
```java
@Service
public class ExampleServiceImpl implements ExampleService {

    @Resource
    private ExampleDao exampleDao;

    @Resource
    private GatewayServiceClient gatewayServiceClient;

    public void processExample(ExampleDTO dto) {
        // ä¸šåŠ¡é€»è¾‘å¤„ç†
        ExampleEntity entity = buildEntity(dto);
        exampleDao.insertExample(entity);

        // é€šè¿‡ç½‘å…³è°ƒç”¨å…¶ä»–æœåŠ¡
        OtherServiceResult result = gatewayServiceClient.callOtherService(
            "/api/v1/other/process", dto, OtherServiceResult.class);
    }
}
```

#### **2.2 æœåŠ¡é—´è°ƒç”¨ï¼ˆé»˜è®¤ç»ç½‘å…³ï¼Œçƒ­è·¯å¾„ç™½åå•ç›´è¿ï¼‰ (30åˆ†é’Ÿ)**

**æ¼”ç¤º: ç»Ÿä¸€æœåŠ¡è°ƒç”¨**
```java
@Component
public class ExampleServiceClient {

    @Resource
    private GatewayServiceClient gatewayServiceClient;

    public ResultVO callAuthService(String path, Object request) {
        return gatewayServiceClient.callAuthService(path, request, ResultVO.class);
    }

    public DeviceVO getDeviceInfo(Long deviceId) {
        return gatewayServiceClient.callDeviceService(
            "/api/v1/devices/" + deviceId, null, DeviceVO.class);
    }
}
```

#### **2.3 é”™è¯¯ä¿®æ­£ç»ƒä¹  (30åˆ†é’Ÿ)**

**ç»ƒä¹ 1: ä¿®æ­£è¿‡æ—¶çš„æœåŠ¡è°ƒç”¨**
```java
// âŒ è¿‡æ—¶çš„ä»£ç  - éç™½åå•ç›´è¿ï¼Œéœ€è¦å­¦å‘˜ä¿®æ­£
@FeignClient(name = "auth-service")
public interface AuthServiceClient {
    @GetMapping("/api/users/{id}")
    UserVO getUser(@PathVariable Long id);
}

// âœ… æ­£ç¡®çš„ä»£ç  - é»˜è®¤ç»ç½‘å…³çš„è°ƒç”¨æ–¹å¼
@Component
public class AuthClient {

    @Resource
    private GatewayServiceClient gatewayServiceClient;

    public UserVO getUser(Long userId) {
        return gatewayServiceClient.callAuthService(
            "/api/v1/users/" + userId, null, UserVO.class);
    }
}
```

**ç»ƒä¹ 2: ä¿®æ­£ä¾èµ–æ³¨å…¥**
```java
// âŒ è¿‡æ—¶çš„ä»£ç 
@Autowired
private UserService userService;

// âœ… æ­£ç¡®çš„ä»£ç  - å­¦å‘˜ç»ƒä¹ ä¿®æ­£
@Resource
private UserService userService;
```

---

## ğŸ“ åŸ¹è®­è€ƒæ ¸

### **ç†è®ºè€ƒæ ¸ (30åˆ†é’Ÿ)**
1. IOE-DREAMé¡¹ç›®å¼ºåˆ¶ä½¿ç”¨ä»€ä¹ˆä½œä¸ºæœåŠ¡æ³¨å†Œå‘ç°ä¸­å¿ƒï¼Ÿ
2. æœåŠ¡é—´è°ƒç”¨åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ–¹å¼ï¼Ÿ
3. Repositoryå±‚åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ³¨è§£ï¼Ÿ
4. ä¾èµ–æ³¨å…¥åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ³¨è§£ï¼Ÿ
5. æ•°æ®åº“è¿æ¥æ± åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯ï¼Ÿ

### **å®è·µè€ƒæ ¸ (30åˆ†é’Ÿ)**
1. åˆ›å»ºä¸€ä¸ªç¬¦åˆè§„èŒƒçš„å¾®æœåŠ¡
2. å®ç°GatewayServiceClientè°ƒç”¨
3. ä¿®æ­£ç»™å®šçš„è¿‡æ—¶ä»£ç ç¤ºä¾‹

---

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### **IDEA é…ç½®**
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼
- **ä»£ç æ¨¡æ¿**: é…ç½®GatewayServiceClientä½¿ç”¨æ¨¡æ¿
- **å®æ—¶æ£€æŸ¥**: é…ç½®è¿‡æ—¶è§„èŒƒå®æ—¶æé†’
- **ä»£ç æ ¼å¼åŒ–**: ç»Ÿä¸€ä»£ç æ ¼å¼è§„èŒƒ

### **Git Hook é…ç½®**
```bash
#!/bin/bash
# .git/hooks/pre-commit
# æäº¤å‰æ£€æŸ¥

# æ£€æŸ¥è¿‡æ—¶è§„èŒƒ
if grep -r "@Autowired\|javax\.\|FeignClient\|consul:\|eureka:\|hikari:" src/main/java; then
    echo "âŒ å‘ç°è¿‡æ—¶è§„èŒƒï¼Œè¯·å…ˆä¿®æ­£"
    exit 1
fi
```

### **Gradle æ’ä»¶é…ç½®**
```gradle
// æ¶æ„åˆè§„æ€§æ£€æŸ¥æ’ä»¶
task architectureComplianceCheck(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'com.ioedream.architecture.ComplianceChecker'
}
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

1. **UNIFIED_MICROSERVICES_STANDARDS.md** - ç»Ÿä¸€å¾®æœåŠ¡æ¶æ„è§„èŒƒ
2. **é—¨ç¦æœåŠ¡æ¶æ„æ··åˆé—®é¢˜è¯†åˆ«æŠ¥å‘Š.md** - æ¶æ„é—®é¢˜åˆ†æ
3. **é—¨ç¦æœåŠ¡å¾®æœåŠ¡æ‹†åˆ†å®æ–½æ–¹æ¡ˆ.md** - å®æ–½æ–¹æ¡ˆ
4. **ä»£ç è´¨é‡é“è¡€å†›è§„.md** - ä»£ç è´¨é‡æ ‡å‡†

---

## ğŸ¯ åŸ¹è®­è¦æ±‚

### **å‡ºå‹¤è¦æ±‚**
- å…¨ä½“å¼€å‘äººå‘˜å¿…é¡»å‚åŠ 
- ç†è®ºå’Œå®è·µè¯¾ç¨‹éƒ½éœ€è¦å®Œæˆ
- è€ƒæ ¸å¿…é¡»é€šè¿‡

### **è€ƒæ ¸æ ‡å‡†**
- ç†è®ºè€ƒæ ¸: 80åˆ†ä»¥ä¸Š
- å®è·µè€ƒæ ¸: 100%ç¬¦åˆè§„èŒƒ
- ä»£ç å®¡æŸ¥: æ— è¿‡æ—¶è§„èŒƒä½¿ç”¨

### **æŒç»­è·Ÿè¿›**
- æ¯å‘¨ä»£ç å®¡æŸ¥æ£€æŸ¥è§„èŒƒéµå¾ªæƒ…å†µ
- CI/CDè‡ªåŠ¨æ£€æŸ¥è¿è§„ä½¿ç”¨
- æœˆåº¦æ¶æ„åˆè§„æ€§æŠ¥å‘Š

---

**åŸ¹è®­è´Ÿè´£äºº**: æ¶æ„ç»„
**æŠ€æœ¯æ”¯æŒ**: DevOpså›¢é˜Ÿ
**åŸ¹è®­æ—¶é—´**: 2025-12-01 å¼€å§‹
