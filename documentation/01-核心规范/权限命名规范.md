# 权限命名规范

## 📋 文档说明

本文档规定SmartAdmin项目中所有权限的统一命名格式，确保前后端权限配置一致性。

**强制执行**：所有新开发功能、修改现有功能时，必须严格遵守本规范。

---

## 🎯 统一格式

### 标准格式
```
{domain}:{module}:{action}
```

- **domain**：业务域/系统域
- **module**：模块名称
- **action**：操作动作

### 格式说明
- 全部使用**小写字母**
- 使用**冒号(:)**分隔
- 使用**英文单词**，禁止拼音

---

## 📚 标准示例
## 📋 IOE-DREAM七微服务架构

**核心架构组成**:
- **Gateway Service (8080)**: API网关
- **Common Service (8088)**: 公共模块微服务
- **DeviceComm Service (8087)**: 设备通讯微服务
- **OA Service (8089)**: OA微服务
- **Access Service (8090)**: 门禁服务
- **Attendance Service (8091)**: 考勤服务
- **Video Service (8092)**: 视频服务
- **Consume Service (8094)**: 消费服务
- **Visitor Service (8095)**: 访客服务

**架构特点**:
- 基于Spring Boot 3.5.8 + Java 17
- 严格遵循企业级微服务规范
- 支持高并发、高可用、水平扩展

**技术栈标准**:
- **数据库**: MySQL 8.0 + Druid连接池
- **缓存**: Redis + Caffeine多级缓存
- **注册中心**: Nacos
- **配置中心**: Nacos Config
- **认证授权**: Sa-Token

## 🏗️ 四层架构规范

**标准架构模式**:
```
Controller (接口控制层)
    ↓
Service (核心业务层)
    ↓
Manager (流程管理层)
    ↓
DAO (数据访问层)
```

**层级职责**:
- **Controller层**: HTTP请求处理、参数验证、权限控制
- **Service层**: 核心业务逻辑、事务管理、业务规则验证
- **Manager层**: 复杂流程编排、多数据组装、第三方服务集成
- **DAO层**: 数据库CRUD操作、SQL查询实现、数据访问边界

**严格禁止跨层访问**: Controller不能直接调用Manager/DAO！
### 系统模块（system域）
## ⚠️ IOE-DREAM零容忍规则（强制执行）

**必须遵守的架构规则**:
- ✅ **必须使用 @Resource 注入依赖**
- ✅ **必须使用 @Mapper 注解** (禁止@Repository)
- ✅ **必须使用 Dao 后缀** (禁止Repository)
- ✅ **必须使用 @RestController 注解**
- ✅ **必须使用 @Valid 参数校验**
- ✅ **必须返回统一ResponseDTO格式**
- ✅ **必须遵循四层架构边界**

**严格禁止事项**:
- ❌ **禁止使用 @Autowired 注入**
- ❌ **禁止使用 @Repository 注解**
- ❌ **禁止使用 Repository 后缀命名**
- ❌ **禁止跨层访问**
- ❌ **禁止在Controller中包含业务逻辑**
- ❌ **禁止直接访问数据库**

**违规后果**: P0级问题，立即修复，禁止合并！

| 功能模块 | 权限标识 | 说明 |
|---------|---------|------|
| 菜单管理 | `system:menu:add` | 新增菜单 |
| 菜单管理 | `system:menu:update` | 编辑菜单 |
| 菜单管理 | `system:menu:delete` | 删除菜单 |
| 菜单管理 | `system:menu:batchDelete` | 批量删除菜单 |
| 员工管理 | `system:employee:add` | 新增员工 |
| 员工管理 | `system:employee:update` | 编辑员工 |
| 员工管理 | `system:employee:delete` | 删除员工 |
| 员工管理 | `system:employee:query` | 查询员工 |
| 角色管理 | `system:role:add` | 新增角色 |
| 角色管理 | `system:role:update` | 编辑角色 |
| 部门管理 | `system:department:add` | 新增部门 |
| 部门管理 | `system:department:update` | 编辑部门 |
| 区域管理 | `system:area:add` | 新增区域 |
| 区域管理 | `system:area:update` | 编辑区域 |
| 区域管理 | `system:area:delete` | 删除区域 |
| 区域管理 | `system:area:query` | 查询区域 |

### 支持模块（support域）

| 功能模块 | 权限标识 | 说明 |
|---------|---------|------|
| 数据字典 | `support:dict:add` | 新增字典 |
| 数据字典 | `support:dict:update` | 编辑字典 |
| 数据字典 | `support:dict:delete` | 删除字典 |
| 参数配置 | `support:config:add` | 新增配置 |
| 参数配置 | `support:config:update` | 编辑配置 |
| 文件管理 | `support:file:upload` | 上传文件 |
| 文件管理 | `support:file:delete` | 删除文件 |

### 业务模块（business域）

| 功能模块 | 权限标识 | 说明 |
|---------|---------|------|
| 商品管理 | `business:goods:add` | 新增商品 |
| 商品管理 | `business:goods:update` | 编辑商品 |
| 订单管理 | `business:order:query` | 查询订单 |
| 订单管理 | `business:order:export` | 导出订单 |

---

## 🔑 权限Action标准词汇

### 查询类操作

| Action | 说明 | 使用场景 |
|--------|------|---------|
| `query` | 查询/搜索 | 列表查询、条件搜索 |
| `list` | 列表查询 | 简单列表获取 |
| `detail` | 详情查询 | 获取单条记录详情 |
| `tree` | 树形查询 | 获取树形结构数据 |
| `page` | 分页查询 | 分页列表查询（不推荐，建议用query） |

### 写入类操作

| Action | 说明 | 使用场景 |
|--------|------|---------|
| `add` | 新增 | 创建新记录（推荐） |
| `create` | 创建 | 创建新记录（备选） |
| `save` | 保存 | 保存记录（不推荐，语义不明确） |
| `insert` | 插入 | 插入记录（不推荐，太底层） |

### 更新类操作

| Action | 说明 | 使用场景 |
|--------|------|---------|
| `update` | 更新 | 修改记录（推荐） |
| `edit` | 编辑 | 修改记录（备选） |
| `modify` | 修改 | 修改记录（不推荐） |

### 删除类操作

| Action | 说明 | 使用场景 |
|--------|------|---------|
| `delete` | 删除 | 删除单条记录（推荐） |
| `batchDelete` | 批量删除 | 删除多条记录 |
| `remove` | 移除 | 删除记录（备选） |

### 其他操作

| Action | 说明 | 使用场景 |
|--------|------|---------|
| `export` | 导出 | 导出数据（Excel、PDF等） |
| `import` | 导入 | 导入数据 |
| `upload` | 上传 | 上传文件 |
| `download` | 下载 | 下载文件 |
| `enable` | 启用 | 启用记录 |
| `disable` | 禁用 | 禁用记录 |
| `audit` | 审核 | 审核操作 |
| `approve` | 审批 | 审批操作 |

---

## 💻 前后端一致性要求

### 后端Controller
```java
@RestController
@RequestMapping("/area")
@SaCheckLogin
public class AreaController {

    @PostMapping("/query")
    @SaCheckPermission("system:area:query")  // ✅ 正确格式
    public ResponseDTO<PageResult<AreaVO>> queryPage(@RequestBody AreaQueryForm form) {
        // ...
    }

    @PostMapping("/add")
    @SaCheckPermission("system:area:add")  // ✅ 正确格式
    public ResponseDTO<Long> add(@RequestBody AreaAddForm form) {
        // ...
    }
}
```

### 前端组件
```vue
<template>
  <!-- ✅ 正确：权限指令格式 -->
  <a-button type="primary" v-privilege="'system:area:add'">新增</a-button>

  <!-- ✅ 正确：权限指令格式 -->
  <a-button v-privilege="'system:area:update'">编辑</a-button>

  <!-- ✅ 正确：权限指令格式 -->
  <a-button v-privilege="'system:area:delete'">删除</a-button>

  <!-- ❌ 错误：缺少domain前缀 -->
  <a-button v-privilege="'area:add'">新增</a-button>

  <!-- ❌ 错误：使用了中文 -->
  <a-button v-privilege="'system:区域:新增'">新增</a-button>
</template>
```

### 数据库菜单配置
```sql
-- ✅ 正确：t_menu表权限配置
INSERT INTO t_menu (menu_name, api_perms, web_perms, ...) VALUES
('新增', 'system:area:add', 'system:area:add', ...),
('编辑', 'system:area:update', 'system:area:update', ...),
('删除', 'system:area:delete', 'system:area:delete', ...),
('查询', 'system:area:query', 'system:area:query', ...);
```

---

## ⚠️ 常见错误示例

### ❌ 错误1：缺少domain前缀
```java
// ❌ 错误
@SaCheckPermission("area:add")

// ✅ 正确
@SaCheckPermission("system:area:add")
```

### ❌ 错误2：使用中文或拼音
```java
// ❌ 错误
@SaCheckPermission("system:quyu:xinzeng")

// ✅ 正确
@SaCheckPermission("system:area:add")
```

### ❌ 错误3：Action不规范
```java
// ❌ 错误：使用了save，语义不清
@SaCheckPermission("system:area:save")

// ✅ 正确：使用add或update
@SaCheckPermission("system:area:add")
@SaCheckPermission("system:area:update")
```

### ❌ 错误4：前后端不一致
```java
// 后端
@SaCheckPermission("system:area:add")

// 前端 ❌ 错误
<a-button v-privilege="'area:add'">

// 前端 ✅ 正确
<a-button v-privilege="'system:area:add'">
```

---

## 🔍 开发检查清单

在开发新功能或修改权限时，请逐项检查：

- [ ] 权限格式符合`{domain}:{module}:{action}`
- [ ] domain使用正确（system/support/business）
- [ ] module使用英文单词
- [ ] action使用标准词汇表中的词汇
- [ ] 后端@SaCheckPermission与前端v-privilege一致
- [ ] 数据库t_menu表的api_perms和web_perms一致
- [ ] 所有字母使用小写
- [ ] 使用冒号分隔，不使用下划线或连字符

---

## 📝 新模块权限定义流程

1. **确定domain**：判断属于system/support/business
2. **确定module**：使用简洁的英文单词
3. **列出功能清单**：列出所有需要权限控制的功能
4. **定义action**：从标准词汇表中选择合适的action
5. **生成权限标识**：组合成完整的权限标识
6. **同步到三端**：后端Controller、前端组件、数据库配置

### 示例：新增"考勤管理"模块

```markdown
1. domain: system（属于系统管理类）
2. module: attendance（考勤）
3. 功能清单：
   - 查询考勤记录
   - 新增考勤记录
   - 编辑考勤记录
   - 删除考勤记录
   - 导出考勤报表

4. 权限定义：
   - system:attendance:query
   - system:attendance:add
   - system:attendance:update
   - system:attendance:delete
   - system:attendance:export
```

---

## 🎓 最佳实践建议

1. **优先使用标准词汇**：从标准action词汇表中选择，保持一致性
2. **避免过度细化**：不要为每个小功能都创建权限，合理归类
3. **语义清晰明确**：权限名称应该让人一看就懂
4. **保持简洁**：module和action尽量使用简短的单词
5. **定期审查**：定期检查权限配置，清理无用权限

---

## 📖 相关文档

- [API路径规范](./API路径规范.md)
- [前端组件开发规范](./前端组件开发规范.md)
- [AI辅助开发检查清单](../AI_DEV_CHECKLIST.md)

---

**版本**：v1.0
**更新时间**：2025-11-11
**维护人**：开发团队
