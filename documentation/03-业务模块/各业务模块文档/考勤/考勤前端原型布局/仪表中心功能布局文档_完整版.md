# 仪表中心功能布局文档 - 完整版

## 功能概述

仪表中心是考勤管理系统的核心数据展示和快速操作入口，提供多维度的考勤数据可视化展示，支持个人、部门、企业三个层级的实时监控和统计分析。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **图表库**: ECharts 5.4.3
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/attendance/dashboard/
├── index.vue                        # 仪表中心主页面
├── components/
│   ├── OverviewCards.vue           # 概览卡片组件
│   ├── AttendanceChart.vue         # 考勤趋势图表
│   ├── HeatmapChart.vue            # 热力图组件
│   ├── QuickActions.vue            # 快速操作组件
│   ├── PersonalDashboard.vue       # 个人看板
│   ├── DepartmentDashboard.vue     # 部门看板
│   └── EnterpriseDashboard.vue     # 企业看板
├── mock/
│   └── dashboard-mock.js           # 模拟数据
├── api/
│   └── dashboard-api.js            # API接口定义
└── utils/
    ├── chart-utils.js              # 图表工具函数
    └── data-format.js              # 数据格式化工具
```

### API接口设计
```javascript
// src/api/business/attendance/dashboard-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const dashboardApi = {
  // 获取首页概览数据
  getOverviewData: (params) => getRequest('/attendance/dashboard/overview', params),

  // 获取个人看板数据
  getPersonalDashboard: (userId, params) => getRequest(`/attendance/dashboard/personal/${userId}`, params),

  // 获取部门看板数据
  getDepartmentDashboard: (deptId, params) => getRequest(`/attendance/dashboard/department/${deptId}`, params),

  // 获取企业看板数据
  getEnterpriseDashboard: (params) => getRequest('/attendance/dashboard/enterprise', params),

  // 获取考勤趋势数据
  getAttendanceTrend: (params) => getRequest('/attendance/dashboard/trend', params),

  // 获取部门考勤热力图数据
  getDepartmentHeatmap: (params) => getRequest('/attendance/dashboard/heatmap', params),

  // 获取实时统计数据
  getRealTimeStats: (params) => getRequest('/attendance/dashboard/realtime', params),

  // 获取快速操作权限
  getQuickActions: (userId) => getRequest(`/attendance/dashboard/quick-actions/${userId}`),

  // 刷新看板数据
  refreshDashboard: (dashboardType, params) => postRequest('/attendance/dashboard/refresh', { dashboardType, ...params }),
};
```

## 开发注意事项

### 1. Vue 3 组件开发规范

#### 响应式数据管理
```vue
<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue';
import { useStore } from 'pinia';
import { dashboardApi } from '/@/api/business/attendance/dashboard-api';

const store = useStore();
const loading = ref(false);
const overviewData = ref({});
const trendData = ref([]);
const heatmapData = ref([]);
const refreshInterval = ref(null);

// 计算属性
const attendanceRate = computed(() => {
  if (!overviewData.value.totalEmployees) return 0;
  return ((overviewData.value.presentEmployees / overviewData.value.totalEmployees) * 100).toFixed(1);
});

// 数据加载
const loadOverviewData = async () => {
  loading.value = true;
  try {
    const response = await dashboardApi.getOverviewData();
    overviewData.value = response.data;
  } catch (error) {
    console.error('加载概览数据失败:', error);
  } finally {
    loading.value = false;
  }
};

// 自动刷新
const startAutoRefresh = () => {
  refreshInterval.value = setInterval(() => {
    loadOverviewData();
  }, 30000); // 30秒刷新一次
};

onMounted(() => {
  loadOverviewData();
  startAutoRefresh();
});

onUnmounted(() => {
  if (refreshInterval.value) {
    clearInterval(refreshInterval.value);
  }
});
</script>
```

### 2. 图表使用规范

#### ECharts 配置
```javascript
// src/utils/chart-utils.js
export const chartConfigs = {
  // 考勤趋势折线图
  trendChart: {
    title: {
      text: '考勤趋势',
      left: 'center',
      textStyle: {
        color: '#333',
        fontSize: 16,
        fontWeight: 'normal'
      }
    },
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'cross'
      }
    },
    legend: {
      data: ['出勤人数', '迟到人数', '早退人数'],
      bottom: 0
    },
    xAxis: {
      type: 'category',
      data: []
    },
    yAxis: {
      type: 'value'
    },
    series: [
      {
        name: '出勤人数',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#52c41a' }
      },
      {
        name: '迟到人数',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#faad14' }
      },
      {
        name: '早退人数',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#ff4d4f' }
      }
    ]
  },

  // 部门考勤热力图
  heatmapChart: {
    title: {
      text: '部门考勤热力图',
      left: 'center'
    },
    tooltip: {
      position: 'top',
      formatter: function (params) {
        return `${params.name}<br/>考勤率: ${params.value[2]}%`;
      }
    },
    grid: {
      height: '60%',
      top: '10%'
    },
    xAxis: {
      type: 'category',
      data: [],
      splitArea: {
        show: true
      }
    },
    yAxis: {
      type: 'category',
      data: [],
      splitArea: {
        show: true
      }
    },
    visualMap: {
      min: 0,
      max: 100,
      calculable: true,
      orient: 'horizontal',
      left: 'center',
      bottom: '5%',
      inRange: {
        color: ['#ebedf0', '#c6e48b', '#7bc96f', '#239a3b', '#196127']
      }
    },
    series: [{
      name: '考勤率',
      type: 'heatmap',
      data: [],
      label: {
        show: true,
        formatter: function (params) {
          return params.value[2] + '%';
        }
      },
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }]
  }
};
```

## 核心功能模块

### 1. 概览卡片组件

```vue
<!-- src/views/business/attendance/dashboard/components/OverviewCards.vue -->
<template>
  <div class="overview-cards">
    <a-row :gutter="16">
      <a-col :span="6" v-for="(card, index) in cards" :key="index">
        <a-card :bordered="false" class="overview-card">
          <a-statistic
            :title="card.title"
            :value="card.value"
            :precision="card.precision || 0"
            :value-style="{ color: card.color }"
            :prefix="card.prefix"
          >
            <template #suffix>
              <span class="suffix-text">{{ card.suffix }}</span>
            </template>
          </a-statistic>

          <div class="card-trend" v-if="card.trend">
            <component :is="card.trend > 0 ? 'ArrowUpOutlined' : 'ArrowDownOutlined'"
                      :style="{ color: card.trend > 0 ? '#52c41a' : '#ff4d4f' }" />
            <span>{{ Math.abs(card.trend) }}%</span>
            <span class="trend-text">较昨日</span>
          </div>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons-vue';

const props = defineProps({
  overviewData: {
    type: Object,
    default: () => ({})
  }
});

const cards = computed(() => [
  {
    title: '今日出勤',
    value: props.overviewData.todayAttendance || 0,
    suffix: '人',
    color: '#52c41a',
    prefix: 'UserOutlined',
    trend: props.overviewData.todayTrend || 0
  },
  {
    title: '本周出勤',
    value: props.overviewData.weekAttendance || 0,
    suffix: '人',
    color: '#1890ff',
    prefix: 'CalendarOutlined',
    trend: props.overviewData.weekTrend || 0
  },
  {
    title: '异常预警',
    value: props.overviewData.exceptionCount || 0,
    suffix: '项',
    color: '#faad14',
    prefix: 'WarningOutlined',
    trend: props.overviewData.exceptionTrend || 0
  },
  {
    title: '待办事项',
    value: props.overviewData.pendingCount || 0,
    suffix: '项',
    color: '#ff4d4f',
    prefix: 'ClockCircleOutlined',
    trend: props.overviewData.pendingTrend || 0
  }
]);
</script>

<style scoped lang="less">
.overview-cards {
  margin-bottom: 24px;

  .overview-card {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s;

    &:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    .card-trend {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;

      .trend-text {
        color: #999;
      }
    }

    .suffix-text {
      font-size: 14px;
      color: #666;
      margin-left: 4px;
    }
  }
}
</style>
```

### 2. 考勤趋势图表组件

```vue
<!-- src/views/business/attendance/dashboard/components/AttendanceChart.vue -->
<template>
  <div class="attendance-chart">
    <a-card :bordered="false" title="考勤趋势分析">
      <template #extra>
        <a-radio-group v-model:value="timeRange" size="small" @change="handleTimeRangeChange">
          <a-radio-button value="7">近7天</a-radio-button>
          <a-radio-button value="30">近30天</a-radio-button>
          <a-radio-button value="90">近90天</a-radio-button>
        </a-radio-group>
      </template>

      <div ref="chartRef" class="chart-container" v-loading="loading"></div>
    </a-card>
  </div>
</template>

<script setup>
import { ref, onMounted, watch, nextTick } from 'vue';
import * as echarts from 'echarts';
import { chartConfigs } from '/@/utils/chart-utils';
import { dashboardApi } from '/@/api/business/attendance/dashboard-api';

const props = defineProps({
  refreshTrigger: {
    type: Number,
    default: 0
  }
});

const chartRef = ref(null);
const loading = ref(false);
const timeRange = ref('7');
let chartInstance = null;

const initChart = () => {
  if (chartRef.value) {
    chartInstance = echarts.init(chartRef.value);
    const option = JSON.parse(JSON.stringify(chartConfigs.trendChart));
    chartInstance.setOption(option);
  }
};

const loadTrendData = async () => {
  loading.value = true;
  try {
    const response = await dashboardApi.getAttendanceTrend({ days: timeRange.value });
    const data = response.data;

    if (chartInstance) {
      chartInstance.setOption({
        xAxis: {
          data: data.dates
        },
        series: [
          { data: data.attendance },
          { data: data.late },
          { data: data.earlyLeave }
        ]
      });
    }
  } catch (error) {
    console.error('加载趋势数据失败:', error);
  } finally {
    loading.value = false;
  }
};

const handleTimeRangeChange = () => {
  loadTrendData();
};

const resizeChart = () => {
  if (chartInstance) {
    chartInstance.resize();
  }
};

onMounted(() => {
  nextTick(() => {
    initChart();
    loadTrendData();
    window.addEventListener('resize', resizeChart);
  });
});

watch(() => props.refreshTrigger, () => {
  loadTrendData();
});

// 清理
onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
  }
  window.removeEventListener('resize', resizeChart);
});
</script>

<style scoped lang="less">
.attendance-chart {
  .chart-container {
    height: 300px;
    width: 100%;
  }
}
</style>
```

### 3. 快速操作组件

```vue
<!-- src/views/business/attendance/dashboard/components/QuickActions.vue -->
<template>
  <div class="quick-actions">
    <a-card :bordered="false" title="快速操作">
      <div class="actions-grid">
        <div
          v-for="action in availableActions"
          :key="action.key"
          class="action-item"
          @click="handleActionClick(action)"
        >
          <div class="action-icon">
            <component :is="action.icon" />
          </div>
          <div class="action-title">{{ action.title }}</div>
        </div>
      </div>
    </a-card>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { useRouter } from 'vue-router';
import {
  EnvironmentOutlined,
  FormOutlined,
  CalendarOutlined,
  BarChartOutlined,
  SettingOutlined,
  NotificationOutlined
} from '@ant-design/icons-vue';

const router = useRouter();
const props = defineProps({
  userRole: {
    type: String,
    default: 'employee'
  }
});

const allActions = [
  {
    key: 'clock',
    title: '打卡',
    icon: 'EnvironmentOutlined',
    path: '/attendance/clock',
    roles: ['employee', 'manager', 'hr', 'admin']
  },
  {
    key: 'apply',
    title: '申请',
    icon: 'FormOutlined',
    path: '/attendance/apply',
    roles: ['employee', 'manager', 'hr', 'admin']
  },
  {
    key: 'schedule',
    title: '排班',
    icon: 'CalendarOutlined',
    path: '/attendance/schedule',
    roles: ['manager', 'hr', 'admin']
  },
  {
    key: 'report',
    title: '报表',
    icon: 'BarChartOutlined',
    path: '/attendance/report',
    roles: ['manager', 'hr', 'admin']
  },
  {
    key: 'settings',
    title: '设置',
    icon: 'SettingOutlined',
    path: '/attendance/settings',
    roles: ['hr', 'admin']
  },
  {
    key: 'notification',
    title: '通知',
    icon: 'NotificationOutlined',
    path: '/attendance/notification',
    roles: ['employee', 'manager', 'hr', 'admin']
  }
];

const availableActions = computed(() => {
  return allActions.filter(action => action.roles.includes(props.userRole));
});

const handleActionClick = (action) => {
  router.push(action.path);
};
</script>

<style scoped lang="less">
.quick-actions {
  .actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 16px;

    .action-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      border-radius: 8px;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.3s;

      &:hover {
        background: #e6f7ff;
        transform: translateY(-2px);
      }

      .action-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: #1890ff;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;

        .anticon {
          font-size: 24px;
          color: #fff;
        }
      }

      .action-title {
        font-size: 14px;
        color: #333;
        font-weight: 500;
      }
    }
  }
}
</style>
```

### 4. 主页面集成

```vue
<!-- src/views/business/attendance/dashboard/index.vue -->
<template>
  <div class="dashboard-page">
    <!-- 页面标题 -->
    <div class="page-header">
      <h1>仪表中心</h1>
      <div class="header-actions">
        <a-button @click="handleRefresh" :loading="refreshing">
          <template #icon><ReloadOutlined /></template>
          刷新数据
        </a-button>
        <a-button type="primary" @click="handleExport">
          <template #icon><DownloadOutlined /></template>
          导出报表
        </a-button>
      </div>
    </div>

    <!-- 标签页切换 -->
    <a-tabs v-model:activeKey="activeTab" @change="handleTabChange">
      <a-tab-pane key="overview" tab="首页概览">
        <OverviewCards :overview-data="overviewData" />
        <a-row :gutter="16">
          <a-col :span="16">
            <AttendanceChart :refresh-trigger="refreshTrigger" />
          </a-col>
          <a-col :span="8">
            <HeatmapChart :heatmap-data="heatmapData" />
          </a-col>
        </a-row>
        <QuickActions :user-role="userRole" />
      </a-tab-pane>

      <a-tab-pane key="personal" tab="个人看板" v-if="showPersonalTab">
        <PersonalDashboard :user-id="currentUserId" />
      </a-tab-pane>

      <a-tab-pane key="department" tab="部门看板" v-if="showDepartmentTab">
        <DepartmentDashboard :dept-id="currentDeptId" />
      </a-tab-pane>

      <a-tab-pane key="enterprise" tab="企业看板" v-if="showEnterpriseTab">
        <EnterpriseDashboard />
      </a-tab-pane>
    </a-tabs>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';
import { useStore } from 'pinia';
import { message } from 'ant-design-vue';
import { ReloadOutlined, DownloadOutlined } from '@ant-design/icons-vue';
import OverviewCards from './components/OverviewCards.vue';
import AttendanceChart from './components/AttendanceChart.vue';
import HeatmapChart from './components/HeatmapChart.vue';
import QuickActions from './components/QuickActions.vue';
import PersonalDashboard from './components/PersonalDashboard.vue';
import DepartmentDashboard from './components/DepartmentDashboard.vue';
import EnterpriseDashboard from './components/EnterpriseDashboard.vue';
import { dashboardApi } from '/@/api/business/attendance/dashboard-api';

const store = useStore();
const activeTab = ref('overview');
const refreshing = ref(false);
const refreshTrigger = ref(0);
const overviewData = ref({});
const heatmapData = ref({});

// 用户信息
const currentUserId = computed(() => store.state.user.userId);
const userRole = computed(() => store.state.user.role);
const currentDeptId = computed(() => store.state.user.deptId);

// 标签页权限控制
const showPersonalTab = computed(() => true); // 所有用户都可查看
const showDepartmentTab = computed(() => ['manager', 'hr', 'admin'].includes(userRole.value));
const showEnterpriseTab = computed(() => ['hr', 'admin'].includes(userRole.value));

// 加载概览数据
const loadOverviewData = async () => {
  try {
    const response = await dashboardApi.getOverviewData();
    overviewData.value = response.data;
  } catch (error) {
    console.error('加载概览数据失败:', error);
    message.error('加载概览数据失败');
  }
};

// 加载热力图数据
const loadHeatmapData = async () => {
  try {
    const response = await dashboardApi.getDepartmentHeatmap();
    heatmapData.value = response.data;
  } catch (error) {
    console.error('加载热力图数据失败:', error);
  }
};

// 刷新数据
const handleRefresh = async () => {
  refreshing.value = true;
  try {
    await Promise.all([
      loadOverviewData(),
      loadHeatmapData()
    ]);
    refreshTrigger.value += 1;
    message.success('数据刷新成功');
  } catch (error) {
    message.error('数据刷新失败');
  } finally {
    refreshing.value = false;
  }
};

// 导出报表
const handleExport = () => {
  message.info('导出功能开发中...');
};

// 标签页切换
const handleTabChange = (key) => {
  console.log('切换到标签页:', key);
};

onMounted(() => {
  loadOverviewData();
  loadHeatmapData();
});
</script>

<style scoped lang="less">
.dashboard-page {
  padding: 24px;
  background: #f0f2f5;
  min-height: 100vh;

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;

    h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      color: #262626;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }
  }

  :deep(.ant-tabs-content-holder) {
    background: #fff;
    border-radius: 8px;
    padding: 24px;
  }

  :deep(.ant-tabs-nav) {
    background: #fff;
    border-radius: 8px 8px 0 0;
    padding: 0 24px;
  }
}
</style>
```

## Mock数据示例

```javascript
// src/mock/dashboard-mock.js
export const mockOverviewData = {
  todayAttendance: 1234,
  weekAttendance: 6156,
  exceptionCount: 23,
  pendingCount: 8,
  todayTrend: 2.5,
  weekTrend: -1.2,
  exceptionTrend: 15.3,
  pendingTrend: -8.7,
  totalEmployees: 1500,
  presentEmployees: 1234
};

export const mockTrendData = {
  dates: ['2024-01-08', '2024-01-09', '2024-01-10', '2024-01-11', '2024-01-12', '2024-01-13', '2024-01-14'],
  attendance: [1200, 1234, 1198, 1245, 1220, 1180, 1234],
  late: [45, 38, 52, 41, 48, 55, 42],
  earlyLeave: [23, 18, 28, 15, 20, 32, 19]
};

export const mockHeatmapData = [
  [0, 0, 95.2], [0, 1, 88.7], [0, 2, 92.1], [0, 3, 85.3], [0, 4, 90.8],
  [1, 0, 91.5], [1, 1, 89.2], [1, 2, 94.6], [1, 3, 87.9], [1, 4, 92.3],
  [2, 0, 88.3], [2, 1, 91.7], [2, 2, 86.5], [2, 3, 93.2], [2, 4, 89.8],
  [3, 0, 94.1], [3, 1, 87.6], [3, 2, 90.4], [3, 3, 88.9], [3, 4, 91.3],
  [4, 0, 89.7], [4, 1, 92.8], [4, 2, 85.9], [4, 3, 90.1], [4, 4, 87.4]
];

export default {
  mockOverviewData,
  mockTrendData,
  mockHeatmapData
};
```

## 路由配置

```javascript
// src/router/business/attendance.js
export const attendanceRouters = [
  {
    path: '/business/attendance/dashboard',
    name: 'AttendanceDashboard',
    component: () => import('/@/views/business/attendance/dashboard/index.vue'),
    meta: {
      title: '考勤管理 - 仪表中心',
      menuType: MENU_TYPE_ENUM.MENU.value,
      icon: 'DashboardOutlined',
      hideInMenu: false,
      keepAlive: true,
      requireAuth: true
    }
  }
];
```

## 开发注意事项总结

### 核心功能要点
1. **多层级看板** - 个人、部门、企业三个层级的数据展示
2. **实时数据更新** - 支持自动刷新和手动刷新
3. **可视化图表** - 趋势图、热力图等多种图表展示
4. **快速操作入口** - 常用功能的快捷访问
5. **权限控制** - 不同角色显示不同功能模块
6. **响应式设计** - 适配不同屏幕尺寸

### 性能优化建议
1. 使用防抖和节流控制刷新频率
2. 图表数据懒加载，避免同时加载过多数据
3. 合理使用缓存，减少不必要的API调用
4. 组件按需加载，优化首屏加载速度

### 用户体验优化
1. 提供清晰的数据趋势展示
2. 友好的加载状态和错误提示
3. 支持数据导出功能
4. 快速操作入口一目了然

## 总结

仪表中心作为考勤系统的核心展示界面，需要重点关注：

- 数据的实时性和准确性
- 可视化效果的直观性
- 操作的便捷性
- 权限控制的精确性
- 响应式布局的适配性

通过遵循本文档的技术规范，可以开发出功能完善、性能优良的仪表中心模块。