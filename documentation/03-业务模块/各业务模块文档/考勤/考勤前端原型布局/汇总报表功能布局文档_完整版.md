# 汇总报表功能布局文档 - 完整版

## 功能概述

汇总报表模块是考勤系统的数据分析和报表中心，包含个人汇总、部门统计、考勤结果表、报表模板等功能。该模块提供丰富的数据可视化图表、灵活的报表定制功能、多维度数据分析能力，支持报表导出、打印、定时生成等，为企业决策提供全面的数据支撑。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **图表组件**: ECharts 5.x / D3.js
- **报表组件**: VxeTable + Print.js
- **拖拽组件**: Vue.Draggable
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/attendance/reports/
├── index.vue                        # 汇总报表主页面
├── personal/
│   ├── index.vue                   # 个人汇总页面
│   ├── components/
│   │   ├── PersonalSummary.vue     # 个人汇总组件
│   │   ├── MonthlyReport.vue       # 月度报告组件
│   │   ├── AnnualReport.vue        # 年度报告组件
│   │   └── TrendAnalysis.vue       # 趋势分析组件
│   └── api/
│       └── personal-api.js         # 个人汇总API
├── department/
│   ├── index.vue                   # 部门统计页面
│   ├── components/
│   │   ├── DeptStatistics.vue      # 部门统计组件
│   │   ├── ComparisonAnalysis.vue  # 对比分析组件
│   │   ├── TrendChart.vue          # 趋势图表组件
│   │   └── PerformanceMetrics.vue  # 绩效指标组件
│   └── api/
│       └── department-api.js       # 部门统计API
├── results-table/
│   ├── index.vue                   # 考勤结果表页面
│   ├── components/
│   │   ├── TableDesigner.vue       # 表格设计器
│   │   ├── CustomColumns.vue       # 自定义列组件
│   │   ├── DataExport.vue          # 数据导出组件
│   │   └── PrintPreview.vue        # 打印预览组件
│   └── api/
│       └── results-table-api.js    # 考勤结果表API
├── templates/
│   ├── index.vue                   # 报表模板页面
│   ├── components/
│   │   ├── TemplateDesigner.vue    # 模板设计器
│   │   ├── TemplateLibrary.vue     # 模板库管理
│   │   ├── CustomReport.vue        # 自定义报表
│   │   └── ReportGenerator.vue     # 报表生成器
│   └── api/
│       └── templates-api.js        # 模板API
├── mock/
│   └── reports-mock.js             # 模拟数据
├── api/
│   └── reports-api.js              # 统一API接口
└── utils/
    ├── chart-utils.js              # 图表工具函数
    ├── export-utils.js             # 导出工具函数
    └── report-generator.js         # 报表生成工具
```

### API接口设计
```javascript
// src/api/business/attendance/reports/personal-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const personalApi = {
  // 个人汇总
  getPersonalSummary: (params) => getRequest('/attendance/reports/personal/summary', params),
  getMonthlyReport: (employeeId, params) => getRequest(`/attendance/reports/personal/monthly/${employeeId}`, params),
  getAnnualReport: (employeeId, params) => getRequest(`/attendance/reports/personal/annual/${employeeId}`, params),
  getTrendAnalysis: (employeeId, params) => getRequest(`/attendance/reports/personal/trend/${employeeId}`, params),

  // 个人统计
  getAttendanceStatistics: (employeeId, params) => getRequest(`/attendance/reports/personal/statistics/${employeeId}`, params),
  getExceptionHistory: (employeeId, params) => getRequest(`/attendance/reports/personal/exceptions/${employeeId}`, params),

  // 导出
  exportPersonalReport: (params) => postRequest('/attendance/reports/personal/export', params),
};

// src/api/business/attendance/reports/department-api.js
export const departmentApi = {
  // 部门统计
  getDepartmentStatistics: (params) => getRequest('/attendance/reports/department/statistics', params),
  getComparisonAnalysis: (params) => getRequest('/attendance/reports/department/comparison', params),
  getTrendChart: (params) => getRequest('/attendance/reports/department/trend', params),
  getPerformanceMetrics: (params) => getRequest('/attendance/reports/department/performance', params),

  // 部门对比
  getDepartmentComparison: (params) => getRequest('/attendance/reports/department/comparison', params),
  getRankingReport: (params) => getRequest('/attendance/reports/department/ranking', params),

  // 导出
  exportDepartmentReport: (params) => postRequest('/attendance/reports/department/export', params),
};

// src/api/business/attendance/reports/results-table-api.js
export const resultsTableApi = {
  // 结果表配置
  getTableConfigs: () => getRequest('/attendance/reports/results-table/configs'),
  saveTableConfig: (params) => postRequest('/attendance/reports/results-table/config/save', params),
  deleteTableConfig: (id) => deleteRequest(`/attendance/reports/results-table/config/${id}`),

  // 数据查询
  getTableData: (configId, params) => getRequest(`/attendance/reports/results-table/data/${configId}`, params),

  // 列配置
  getCustomColumns: (tableId) => getRequest(`/attendance/reports/results-table/columns/${tableId}`),
  saveCustomColumns: (tableId, params) => postRequest(`/attendance/reports/results-table/columns/${tableId}`, params),

  // 导出打印
  exportTableData: (params) => postRequest('/attendance/reports/results-table/export', params),
  printTableData: (params) => postRequest('/attendance/reports/results-table/print', params),
};
```

## 核心功能模块

### 1. 报表设计器

```vue
<!-- src/views/business/attendance/reports/templates/components/TemplateDesigner.vue -->
<template>
  <div class="template-designer">
    <div class="designer-header">
      <h3>报表模板设计器</h3>
      <div class="designer-actions">
        <a-button @click="saveTemplate" :loading="saving">
          <template #icon><SaveOutlined /></template>
          保存模板
        </a-button>
        <a-button @click="previewTemplate">
          <template #icon><EyeOutlined /></template>
          预览
        </a-button>
        <a-button type="primary" @click="generateReport">
          <template #icon><FileTextOutlined /></template>
          生成报表
        </a-button>
      </div>
    </div>

    <!-- 设计器主体 -->
    <div class="designer-body">
      <!-- 左侧组件面板 -->
      <div class="component-panel">
        <a-card title="组件库" :bordered="false" size="small">
          <a-collapse v-model:activeKey="activeComponentKeys" size="small">
            <a-collapse-panel key="charts" header="图表组件">
              <div class="component-list">
                <div
                  v-for="component in chartComponents"
                  :key="component.type"
                  class="component-item"
                  draggable="true"
                  @dragstart="handleDragStart($event, component)"
                >
                  <component :is="component.icon" />
                  <span>{{ component.name }}</span>
                </div>
              </div>
            </a-collapse-panel>
            <a-collapse-panel key="tables" header="表格组件">
              <div class="component-list">
                <div
                  v-for="component in tableComponents"
                  :key="component.type"
                  class="component-item"
                  draggable="true"
                  @dragstart="handleDragStart($event, component)"
                >
                  <component :is="component.icon" />
                  <span>{{ component.name }}</span>
                </div>
              </div>
            </a-collapse-panel>
            <a-collapse-panel key="basic" header="基础组件">
              <div class="component-list">
                <div
                  v-for="component in basicComponents"
                  :key="component.type"
                  class="component-item"
                  draggable="true"
                  @dragstart="handleDragStart($event, component)"
                >
                  <component :is="component.icon" />
                  <span>{{ component.name }}</span>
                </div>
              </div>
            </a-collapse-panel>
          </a-collapse>
        </a-card>
      </div>

      <!-- 中间设计画布 -->
      <div class="design-canvas">
        <div class="canvas-toolbar">
          <a-space>
            <a-button size="small" @click="undo">
              <template #icon><UndoOutlined /></template>
              撤销
            </a-button>
            <a-button size="small" @click="redo">
              <template #icon><RedoOutlined /></template>
              重做
            </a-button>
            <a-divider type="vertical" />
            <a-button size="small" @click="clearCanvas">
              <template #icon><ClearOutlined /></template>
              清空
            </a-button>
            <a-button size="small" @click="toggleGrid">
              <template #icon><BorderOutlined /></template>
              网格
            </a-button>
          </a-space>
        </div>

        <div
          ref="canvasRef"
          class="canvas-area"
          :class="{ 'show-grid': showGrid }"
          @drop="handleDrop"
          @dragover.prevent
          @click="clearSelection"
        >
          <div
            v-for="(component, index) in canvasComponents"
            :key="component.id"
            class="canvas-component"
            :class="{ selected: selectedComponentId === component.id }"
            :style="getComponentStyle(component)"
            @click.stop="selectComponent(component)"
            @mousedown="handleComponentMouseDown($event, component)"
          >
            <!-- 渲染组件 -->
            <component
              :is="getComponentRenderer(component.type)"
              :config="component.config"
              :data="component.data"
              @config-change="handleComponentConfigChange"
            />

            <!-- 组件操作按钮 -->
            <div class="component-actions" v-if="selectedComponentId === component.id">
              <a-button-group size="small">
                <a-button @click.stop="editComponent(component)">
                  <template #icon><EditOutlined /></template>
                </a-button>
                <a-button @click.stop="copyComponent(component)">
                  <template #icon><CopyOutlined /></template>
                </a-button>
                <a-button @click.stop="deleteComponent(component)">
                  <template #icon><DeleteOutlined /></template>
                </a-button>
              </a-button-group>
            </div>

            <!-- 调整大小手柄 -->
            <div
              v-if="selectedComponentId === component.id && component.resizable"
              class="resize-handles"
            >
              <div class="handle handle-nw" @mousedown.stop="startResize($event, component, 'nw')"></div>
              <div class="handle handle-ne" @mousedown.stop="startResize($event, component, 'ne')"></div>
              <div class="handle handle-sw" @mousedown.stop="startResize($event, component, 'sw')"></div>
              <div class="handle handle-se" @mousedown.stop="startResize($event, component, 'se')"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 右侧属性面板 -->
      <div class="properties-panel">
        <a-card title="属性设置" :bordered="false" size="small">
          <div v-if="selectedComponent">
            <component
              :is="getPropertiesEditor(selectedComponent.type)"
              :config="selectedComponent.config"
              @change="handlePropertyChange"
            />
          </div>
          <div v-else class="no-selection">
            <a-empty description="请选择一个组件" />
          </div>
        </a-card>

        <!-- 模板属性 -->
        <a-card title="模板属性" :bordered="false" size="small" style="margin-top: 8px;">
          <a-form layout="vertical" size="small">
            <a-form-item label="模板名称">
              <a-input v-model:value="templateInfo.name" placeholder="请输入模板名称" />
            </a-form-item>
            <a-form-item label="模板描述">
              <a-textarea v-model:value="templateInfo.description" :rows="3" placeholder="请输入模板描述" />
            </a-form-item>
            <a-form-item label="页面设置">
              <a-checkbox-group v-model:value="templateInfo.pageSettings">
                <a-checkbox value="landscape">横向</a-checkbox>
                <a-checkbox value="showHeader">显示页眉</a-checkbox>
                <a-checkbox value="showFooter">显示页脚</a-checkbox>
              </a-checkbox-group>
            </a-form-item>
          </a-form>
        </a-card>
      </div>
    </div>

    <!-- 组件编辑弹窗 -->
    <a-modal
      v-model:open="editModalVisible"
      title="编辑组件"
      @ok="handleEditConfirm"
      @cancel="editModalVisible = false"
      width="800px"
    >
      <component
        :is="getComponentEditor(editingComponent?.type)"
        v-if="editingComponent"
        :config="editingComponent.config"
        @change="handleEditorChange"
      />
    </a-modal>

    <!-- 预览弹窗 -->
    <a-modal
      v-model:open="previewVisible"
      title="报表预览"
      :footer="null"
      width="1200px"
    >
      <ReportPreview
        :template="currentTemplate"
        :data="previewData"
      />
    </a-modal>
  </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue';
import { message } from 'ant-design-vue';
import {
  SaveOutlined,
  EyeOutlined,
  FileTextOutlined,
  UndoOutlined,
  RedoOutlined,
  ClearOutlined,
  BorderOutlined,
  EditOutlined,
  CopyOutlined,
  DeleteOutlined,
  BarChartOutlined,
  LineChartOutlined,
  PieChartOutlined,
  TableOutlined,
  TitleOutlined,
  TextOutlined
} from '@ant-design/icons-vue';

const emit = defineEmits(['save', 'generate']);

const canvasRef = ref();
const saving = ref(false);
const previewVisible = ref(false);
const editModalVisible = ref(false);
const showGrid = ref(true);

const activeComponentKeys = ref(['charts', 'tables', 'basic']);
const selectedComponentId = ref(null);
const editingComponent = ref(null);

const canvasComponents = ref([]);
const previewData = ref({});

const templateInfo = reactive({
  name: '',
  description: '',
  pageSettings: ['landscape', 'showHeader']
});

// 组件库定义
const chartComponents = [
  { type: 'bar-chart', name: '柱状图', icon: 'BarChartOutlined' },
  { type: 'line-chart', name: '折线图', icon: 'LineChartOutlined' },
  { type: 'pie-chart', name: '饼图', icon: 'PieChartOutlined' },
  { type: 'gauge-chart', name: '仪表盘', icon: 'DashboardOutlined' },
  { type: 'scatter-chart', name: '散点图', icon: 'DotChartOutlined' }
];

const tableComponents = [
  { type: 'data-table', name: '数据表格', icon: 'TableOutlined' },
  { type: 'summary-table', name: '汇总表格', icon: 'TableOutlined' },
  { type: 'comparison-table', name: '对比表格', icon: 'TableOutlined' }
];

const basicComponents = [
  { type: 'title', name: '标题', icon: 'TitleOutlined' },
  { type: 'text', name: '文本', icon: 'TextOutlined' },
  { type: 'divider', name: '分割线', icon: 'MinusOutlined' },
  { type: 'image', name: '图片', icon: 'PictureOutlined' },
  { type: 'spacer', name: '占位符', icon: 'BorderOutlined' }
];

// 当前选中的组件
const selectedComponent = computed(() => {
  return canvasComponents.value.find(c => c.id === selectedComponentId.value);
});

// 当前模板
const currentTemplate = computed(() => ({
  name: templateInfo.name,
  description: templateInfo.description,
  pageSettings: templateInfo.pageSettings,
  components: canvasComponents.value
}));

// 拖拽开始
const handleDragStart = (event, component) => {
  event.dataTransfer.setData('component', JSON.stringify(component));
};

// 放置组件
const handleDrop = (event) => {
  event.preventDefault();
  const componentData = JSON.parse(event.dataTransfer.getData('component'));

  const rect = canvasRef.value.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;

  const newComponent = {
    id: `component-${Date.now()}`,
    type: componentData.type,
    name: componentData.name,
    x: x,
    y: y,
    width: 200,
    height: 150,
    config: getDefaultConfig(componentData.type),
    data: null,
    resizable: true
  };

  canvasComponents.value.push(newComponent);
};

// 获取默认配置
const getDefaultConfig = (type) => {
  const defaultConfigs = {
    'bar-chart': {
      title: '柱状图',
      xAxis: 'category',
      yAxis: 'value',
      colors: ['#1890ff', '#52c41a', '#faad14']
    },
    'line-chart': {
      title: '折线图',
      xAxis: 'time',
      yAxis: 'value',
      smooth: true
    },
    'data-table': {
      title: '数据表格',
      showPagination: true,
      pageSize: 10,
      columns: []
    },
    'title': {
      text: '标题',
      fontSize: 24,
      fontWeight: 'bold',
      align: 'center'
    },
    'text': {
      text: '文本内容',
      fontSize: 14,
      color: '#000000'
    }
  };

  return defaultConfigs[type] || {};
};

// 获取组件样式
const getComponentStyle = (component) => {
  return {
    position: 'absolute',
    left: `${component.x}px`,
    top: `${component.y}px`,
    width: `${component.width}px`,
    height: `${component.height}px`,
    border: selectedComponentId.value === component.id ? '2px solid #1890ff' : '1px solid #d9d9d9'
  };
};

// 获取组件渲染器
const getComponentRenderer = (type) => {
  // 这里返回对应的组件渲染器
  return 'div'; // 简化示例
};

// 获取属性编辑器
const getPropertiesEditor = (type) => {
  // 这里返回对应的属性编辑器
  return 'div'; // 简化示例
};

// 获取组件编辑器
const getComponentEditor = (type) => {
  // 这里返回对应的组件编辑器
  return 'div'; // 简化示例
};

// 选择组件
const selectComponent = (component) => {
  selectedComponentId.value = component.id;
};

// 清除选择
const clearSelection = () => {
  selectedComponentId.value = null;
};

// 编辑组件
const editComponent = (component) => {
  editingComponent.value = { ...component };
  editModalVisible.value = true;
};

// 复制组件
const copyComponent = (component) => {
  const newComponent = {
    ...component,
    id: `component-${Date.now()}`,
    x: component.x + 20,
    y: component.y + 20
  };
  canvasComponents.value.push(newComponent);
};

// 删除组件
const deleteComponent = (component) => {
  const index = canvasComponents.value.findIndex(c => c.id === component.id);
  if (index > -1) {
    canvasComponents.value.splice(index, 1);
    if (selectedComponentId.value === component.id) {
      selectedComponentId.value = null;
    }
  }
};

// 组件配置变化
const handleComponentConfigChange = (componentId, config) => {
  const component = canvasComponents.value.find(c => c.id === componentId);
  if (component) {
    component.config = { ...component.config, ...config };
  }
};

// 属性变化
const handlePropertyChange = (config) => {
  if (selectedComponent.value) {
    selectedComponent.value.config = { ...selectedComponent.value.config, ...config };
  }
};

// 编辑器变化
const handleEditorChange = (config) => {
  if (editingComponent.value) {
    editingComponent.value.config = config;
  }
};

// 编辑确认
const handleEditConfirm = () => {
  if (editingComponent.value) {
    const component = canvasComponents.value.find(c => c.id === editingComponent.value.id);
    if (component) {
      component.config = editingComponent.value.config;
    }
  }
  editModalVisible.value = false;
};

// 撤销
const undo = () => {
  // 实现撤销逻辑
};

// 重做
const redo = () => {
  // 实现重做逻辑
};

// 清空画布
const clearCanvas = () => {
  canvasComponents.value = [];
  selectedComponentId.value = null;
};

// 切换网格
const toggleGrid = () => {
  showGrid.value = !showGrid.value;
};

// 保存模板
const saveTemplate = async () => {
  if (!templateInfo.name) {
    message.warning('请输入模板名称');
    return;
  }

  saving.value = true;
  try {
    const templateData = {
      ...templateInfo,
      components: canvasComponents.value
    };

    // 这里应该调用保存API
    console.log('保存模板:', templateData);

    message.success('模板保存成功');
    emit('save', templateData);
  } catch (error) {
    message.error('模板保存失败');
  } finally {
    saving.value = false;
  }
};

// 预览模板
const previewTemplate = async () => {
  try {
    // 获取预览数据
    previewData.value = await getPreviewData();
    previewVisible.value = true;
  } catch (error) {
    message.error('获取预览数据失败');
  }
};

// 生成报表
const generateReport = () => {
  emit('generate', currentTemplate.value);
};

// 获取预览数据
const getPreviewData = async () => {
  // 模拟获取预览数据
  return {
    charts: [
      { type: 'bar', data: [120, 200, 150, 80, 70, 110, 130] },
      { type: 'line', data: [820, 932, 901, 934, 1290, 1330, 1320] }
    ],
    tables: [
      {
        headers: ['姓名', '部门', '出勤天数', '迟到次数', '早退次数'],
        rows: [
          ['张三', '技术部', 22, 2, 1],
          ['李四', '人事部', 23, 0, 0]
        ]
      }
    ]
  };
};

// 组件鼠标按下事件（用于拖拽移动）
const handleComponentMouseDown = (event, component) => {
  const startX = event.clientX;
  const startY = event.clientY;
  const originalX = component.x;
  const originalY = component.y;

  const handleMouseMove = (e) => {
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    component.x = originalX + deltaX;
    component.y = originalY + deltaY;
  };

  const handleMouseUp = () => {
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mouseup', handleMouseUp);
  };

  document.addEventListener('mousemove', handleMouseMove);
  document.addEventListener('mouseup', handleMouseUp);
};

// 开始调整大小
const startResize = (event, component, handle) => {
  event.preventDefault();
  event.stopPropagation();

  const startX = event.clientX;
  const startY = event.clientY;
  const originalWidth = component.width;
  const originalHeight = component.height;

  const handleMouseMove = (e) => {
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;

    switch (handle) {
      case 'se':
        component.width = Math.max(100, originalWidth + deltaX);
        component.height = Math.max(80, originalHeight + deltaY);
        break;
      case 'sw':
        component.width = Math.max(100, originalWidth - deltaX);
        component.height = Math.max(80, originalHeight + deltaY);
        component.x = component.x + deltaX;
        break;
      // 其他方向的调整逻辑
    }
  };

  const handleMouseUp = () => {
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mouseup', handleMouseUp);
  };

  document.addEventListener('mousemove', handleMouseMove);
  document.addEventListener('mouseup', handleMouseUp);
};
</script>

<style scoped lang="less">
.template-designer {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f5f5f5;

  .designer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    background: #fff;
    border-bottom: 1px solid #f0f0f0;

    h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
  }

  .designer-body {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  .component-panel {
    width: 280px;
    background: #fff;
    border-right: 1px solid #f0f0f0;
    overflow-y: auto;

    .component-list {
      .component-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        margin: 4px;
        border: 1px solid #f0f0f0;
        border-radius: 4px;
        cursor: move;
        transition: all 0.3s;

        &:hover {
          border-color: #1890ff;
          background: #f0f8ff;
        }
      }
    }
  }

  .design-canvas {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #fff;

    .canvas-toolbar {
      padding: 8px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .canvas-area {
      flex: 1;
      position: relative;
      overflow: auto;
      margin: 16px;
      background: #fff;
      border: 1px solid #f0f0f0;

      &.show-grid {
        background-image:
          linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 20px 20px;
      }

      .canvas-component {
        cursor: move;

        &.selected {
          box-shadow: 0 0 0 2px #1890ff;
        }

        &:hover {
          box-shadow: 0 0 0 1px #40a9ff;
        }

        .component-actions {
          position: absolute;
          top: -35px;
          right: 0;
          background: #fff;
          border: 1px solid #d9d9d9;
          border-radius: 4px;
          padding: 2px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .resize-handles {
          position: absolute;
          width: 100%;
          height: 100%;

          .handle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #1890ff;
            border: 1px solid #fff;

            &.handle-nw { top: -4px; left: -4px; cursor: nw-resize; }
            &.handle-ne { top: -4px; right: -4px; cursor: ne-resize; }
            &.handle-sw { bottom: -4px; left: -4px; cursor: sw-resize; }
            &.handle-se { bottom: -4px; right: -4px; cursor: se-resize; }
          }
        }
      }
    }
  }

  .properties-panel {
    width: 320px;
    background: #fff;
    border-left: 1px solid #f0f0f0;
    overflow-y: auto;

    .no-selection {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
    }
  }
}
</style>
```

### 2. 部门对比分析

```vue
<!-- src/views/business/attendance/reports/department/components/ComparisonAnalysis.vue -->
<template>
  <div class="comparison-analysis">
    <!-- 分析配置 -->
    <div class="analysis-config">
      <a-card title="对比分析配置" :bordered="false">
        <a-form layout="inline" :model="configForm">
          <a-form-item label="对比维度">
            <a-select
              v-model:value="configForm.dimension"
              placeholder="选择对比维度"
              style="width: 150px"
              @change="handleDimensionChange"
            >
              <a-select-option value="department">部门对比</a-select-option>
              <a-select-option value="time">时间对比</a-select-option>
              <a-select-option value="type">类型对比</a-select-option>
            </a-select>
          </a-form-item>

          <a-form-item label="对比指标">
            <a-select
              v-model:value="configForm.metrics"
              mode="multiple"
              placeholder="选择指标"
              style="width: 200px"
            >
              <a-select-option value="attendance_rate">出勤率</a-select-option>
              <a-select-option value="late_rate">迟到率</a-select-option>
              <a-select-option value="overtime_hours">加班时长</a-select-option>
              <a-select-option value="leave_days">请假天数</a-select-option>
            </a-select>
          </a-form-item>

          <a-form-item label="时间范围">
            <a-range-picker
              v-model:value="configForm.dateRange"
              :shortcuts="dateShortcuts"
              style="width: 240px"
            />
          </a-form-item>

          <a-form-item>
            <a-button type="primary" @click="executeAnalysis" :loading="analyzing">
              <template #icon><BarChartOutlined /></template>
              开始分析
            </a-button>
          </a-form-item>
        </a-form>
      </a-card>
    </div>

    <!-- 分析结果 -->
    <div class="analysis-results" v-if="analysisResults">
      <!-- 总览统计 -->
      <div class="overview-stats">
        <a-row :gutter="16">
          <a-col :span="6" v-for="(stat, index) in overviewStats" :key="index">
            <a-card :bordered="false">
              <a-statistic
                :title="stat.title"
                :value="stat.value"
                :suffix="stat.suffix"
                :value-style="{ color: stat.color }"
                :prefix="stat.prefix"
              />
              <div class="stat-trend" v-if="stat.trend">
                <component :is="stat.trend > 0 ? 'ArrowUpOutlined' : 'ArrowDownOutlined'"
                          :style="{ color: stat.trend > 0 ? '#52c41a' : '#ff4d4f' }" />
                <span>{{ Math.abs(stat.trend) }}%</span>
                <span class="trend-text">较上期</span>
              </div>
            </a-card>
          </a-col>
        </a-row>
      </div>

      <!-- 图表展示 -->
      <div class="charts-container">
        <a-row :gutter="16">
          <a-col :span="12">
            <a-card title="对比图表" :bordered="false">
              <ComparisonChart
                :data="analysisResults.chartData"
                :type="configForm.dimension"
                :metrics="configForm.metrics"
              />
            </a-card>
          </a-col>
          <a-col :span="12">
            <a-card title="排名分析" :bordered="false">
              <RankingChart
                :data="analysisResults.rankingData"
                :metric="configForm.metrics[0]"
              />
            </a-card>
          </a-col>
        </a-row>

        <a-row :gutter="16" style="margin-top: 16px;">
          <a-col :span="24">
            <a-card title="详细对比表" :bordered="false">
              <ComparisonTable
                :data="analysisResults.tableData"
                :metrics="configForm.metrics"
                :dimension="configForm.dimension"
              />
            </a-card>
          </a-col>
        </a-row>
      </div>

      <!-- 分析结论 -->
      <div class="analysis-conclusions">
        <a-card title="分析结论" :bordered="false">
          <div class="conclusions-content">
            <div v-for="(conclusion, index) in analysisResults.conclusions" :key="index" class="conclusion-item">
              <div class="conclusion-header">
                <a-tag :color="getConclusionColor(conclusion.type)">
                  {{ getConclusionTypeText(conclusion.type) }}
                </a-tag>
                <h4>{{ conclusion.title }}</h4>
              </div>
              <div class="conclusion-content">
                <p>{{ conclusion.description }}</p>
                <div v-if="conclusion.suggestions" class="suggestions">
                  <h5>改进建议：</h5>
                  <ul>
                    <li v-for="(suggestion, idx) in conclusion.suggestions" :key="idx">
                      {{ suggestion }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </a-card>
      </div>
    </div>

    <!-- 导出配置 -->
    <div class="export-actions" v-if="analysisResults">
      <a-space>
        <a-button @click="exportReport">
          <template #icon><ExportOutlined /></template>
          导出报告
        </a-button>
        <a-button @click="saveAnalysis">
          <template #icon><SaveOutlined /></template>
          保存分析
        </a-button>
        <a-button @click="shareAnalysis">
          <template #icon><ShareAltOutlined /></template>
          分享分析
        </a-button>
      </a-space>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  BarChartOutlined,
  ArrowUpOutlined,
  ArrowDownOutlined,
  ExportOutlined,
  SaveOutlined,
  ShareAltOutlined
} from '@ant-design/icons-vue';
import { departmentApi } from '/@/api/business/attendance/reports/department-api';
import dayjs from 'dayjs';
import ComparisonChart from './ComparisonChart.vue';
import RankingChart from './RankingChart.vue';
import ComparisonTable from './ComparisonTable.vue';

const emit = defineEmits(['export', 'save', 'share']);

const analyzing = ref(false);
const analysisResults = ref(null);

const configForm = reactive({
  dimension: 'department',
  metrics: ['attendance_rate'],
  dateRange: [
    dayjs().subtract(30, 'day'),
    dayjs()
  ]
});

const dateShortcuts = [
  {
    text: '最近7天',
    value: () => [dayjs().subtract(7, 'day'), dayjs()],
  },
  {
    text: '最近30天',
    value: () => [dayjs().subtract(30, 'day'), dayjs()],
  },
  {
    text: '本月',
    value: () => [dayjs().startOf('month'), dayjs().endOf('month')],
  }
];

// 总览统计数据
const overviewStats = computed(() => {
  if (!analysisResults.value) return [];

  const data = analysisResults.value.overview;
  return [
    {
      title: '平均出勤率',
      value: data.avgAttendanceRate,
      suffix: '%',
      color: '#52c41a',
      trend: data.attendanceRateTrend
    },
    {
      title: '平均迟到率',
      value: data.avgLateRate,
      suffix: '%',
      color: '#faad14',
      trend: data.lateRateTrend
    },
    {
      title: '总加班时长',
      value: data.totalOvertimeHours,
      suffix: '小时',
      color: '#1890ff',
      trend: data.overtimeTrend
    },
    {
      title: '异常总数',
      value: data.totalExceptions,
      color: '#ff4d4f',
      trend: data.exceptionTrend
    }
  ];
});

// 执行分析
const executeAnalysis = async () => {
  if (!validateConfig()) {
    return;
  }

  analyzing.value = true;
  try {
    const params = {
      ...configForm,
      startDate: configForm.dateRange[0].format('YYYY-MM-DD'),
      endDate: configForm.dateRange[1].format('YYYY-MM-DD')
    };

    const response = await departmentApi.getComparisonAnalysis(params);
    analysisResults.value = response.data;

    message.success('对比分析完成');
  } catch (error) {
    console.error('分析失败:', error);
    message.error('分析失败');
  } finally {
    analyzing.value = false;
  }
};

// 验证配置
const validateConfig = () => {
  if (!configForm.metrics || configForm.metrics.length === 0) {
    message.warning('请选择至少一个对比指标');
    return false;
  }

  if (!configForm.dateRange || configForm.dateRange.length !== 2) {
    message.warning('请选择时间范围');
    return false;
  }

  return true;
};

// 维度变化
const handleDimensionChange = () => {
  // 根据维度调整可用指标
  console.log('维度变化:', configForm.dimension);
};

// 获取结论颜色
const getConclusionColor = (type) => {
  const colorMap = {
    positive: 'green',
    warning: 'orange',
    negative: 'red',
    info: 'blue'
  };
  return colorMap[type] || 'default';
};

// 获取结论类型文本
const getConclusionTypeText = (type) => {
  const textMap = {
    positive: '优势',
    warning: '警告',
    negative: '问题',
    info: '信息'
  };
  return textMap[type] || '未知';
};

// 导出报告
const exportReport = () => {
  emit('export', {
    type: 'comparison',
    data: analysisResults.value,
    config: configForm
  });
};

// 保存分析
const saveAnalysis = () => {
  emit('save', {
    type: 'comparison',
    data: analysisResults.value,
    config: configForm
  });
};

// 分享分析
const shareAnalysis = () => {
  emit('share', {
    type: 'comparison',
    data: analysisResults.value,
    config: configForm
  });
};

onMounted(() => {
  // 初始化
});
</script>

<style scoped lang="less">
.comparison-analysis {
  .analysis-config {
    margin-bottom: 24px;
  }

  .overview-stats {
    margin-bottom: 24px;

    .stat-trend {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;

      .trend-text {
        color: #999;
        margin-left: 4px;
      }
    }
  }

  .charts-container {
    margin-bottom: 24px;
  }

  .analysis-conclusions {
    margin-bottom: 24px;

    .conclusions-content {
      .conclusion-item {
        margin-bottom: 24px;
        padding: 16px;
        background: #fafafa;
        border-radius: 8px;

        .conclusion-header {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 12px;

          h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
          }
        }

        .conclusion-content {
          p {
            margin-bottom: 12px;
            line-height: 1.6;
          }

          .suggestions {
            h5 {
              margin-bottom: 8px;
              font-weight: 600;
            }

            ul {
              margin: 0;
              padding-left: 20px;

              li {
                margin-bottom: 4px;
              }
            }
          }
        }
      }
    }
  }

  .export-actions {
    text-align: center;
    padding: 16px 0;
    border-top: 1px solid #f0f0f0;
  }
}
</style>
```

## Mock数据示例

```javascript
// src/mock/reports-mock.js
export const mockPersonalSummary = {
  employeeId: 'emp001',
  employeeName: '张三',
  department: '技术部',
  position: '高级工程师',
  monthSummary: {
    totalDays: 22,
    workDays: 20,
    leaveDays: 2,
    attendanceRate: 95.5,
    lateCount: 3,
    earlyCount: 1,
    overtimeHours: 12.5
  },
  trendData: [
    { month: '2024-01', attendanceRate: 95.5, overtimeHours: 12.5 },
    { month: '2024-02', attendanceRate: 98.2, overtimeHours: 8.0 }
  ]
};

export const mockDepartmentStatistics = {
  totalDepartments: 10,
  totalEmployees: 500,
  avgAttendanceRate: 96.2,
  avgOvertimeHours: 15.3,
  comparisonData: [
    { department: '技术部', attendanceRate: 95.5, overtimeHours: 18.2 },
    { department: '人事部', attendanceRate: 98.2, overtimeHours: 8.5 }
  ]
};

export const mockReportTemplates = [
  {
    id: 'tpl001',
    name: '月度考勤汇总报表',
    description: '月度员工考勤情况汇总',
    type: 'monthly',
    category: 'summary',
    components: [
      {
        id: 'comp001',
        type: 'title',
        config: { text: '月度考勤汇总', fontSize: 24, align: 'center' }
      }
    ]
  }
];

export default {
  mockPersonalSummary,
  mockDepartmentStatistics,
  mockReportTemplates
};
```

## 开发注意事项总结

### 核心功能要点
1. **可视化设计** - 直观的报表设计器界面
2. **拖拽操作** - 组件化的拖拽式设计
3. **多维分析** - 多维度的数据分析能力
4. **模板系统** - 可复用的报表模板
5. **实时预览** - 设计过程中的实时预览
6. **灵活导出** - 多种格式的导出支持

### 性能优化建议
1. 大数据量的虚拟滚动
2. 图表渲染的性能优化
3. 模板数据的缓存机制
4. 异步的数据加载

### 用户体验优化
1. 直观的设计界面
2. 丰富的组件库
3. 实时的预览反馈
4. 便捷的操作方式

## 总结

汇总报表模块作为考勤系统的数据分析中心，需要重点关注：

- 报表设计的灵活性和易用性
- 数据可视化的直观性和美观性
- 分析功能的深度和准确性
- 导出功能的完整性和多样性
- 模板系统的可扩展性

通过遵循本文档的技术规范，可以构建出功能完善、用户友好的汇总报表模块。