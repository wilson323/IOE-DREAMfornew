# 考勤管理功能布局文档 - 完整版

## 功能概述

考勤管理模块是系统的核心功能之一，负责管理考勤区域、设备配置、设备监控等功能。该模块提供完整的考勤设备生命周期管理，包括设备注册、配置、监控、维护等，支持多种考勤方式（人脸识别、指纹、IC卡、二维码、GPS等），确保考勤数据的准确采集和实时监控。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **WebSocket**: Socket.io-client 4.x (实时监控)
- **地图组件**: 高德地图/百度地图
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/attendance/management/
├── index.vue                        # 考勤管理主页面
├── area/
│   ├── index.vue                   # 考勤区域管理页面
│   ├── components/
│   │   ├── AreaMap.vue            # 区域地图组件
│   │   ├── AreaForm.vue           # 区域表单组件
│   │   ├── AreaPermission.vue     # 区域权限组件
│   │   └── AreaMonitor.vue        # 区域监控组件
│   └── api/
│       └── area-api.js             # 区域管理API
├── device/
│   ├── index.vue                   # 设备管理页面
│   ├── components/
│   │   ├── DeviceTable.vue        # 设备表格组件
│   │   ├── DeviceForm.vue         # 设备表单组件
│   │   ├── DeviceConfig.vue       # 设备配置组件
│   │   ├── DeviceAssociate.vue    # 设备关联组件
│   │   └── DeviceMaintenance.vue  # 设备维护组件
│   └── api/
│       └── device-api.js           # 设备管理API
├── monitor/
│   ├── index.vue                   # 设备监控页面
│   ├── components/
│   │   ├── RealTimeMonitor.vue    # 实时监控组件
│   │   ├── DeviceStatus.vue       # 设备状态组件
│   │   ├── AlertList.vue          # 告警列表组件
│   │   └── MonitoringChart.vue    # 监控图表组件
│   └── api/
│       └── monitor-api.js          # 监控API
├── mock/
│   └── management-mock.js          # 模拟数据
├── api/
│   └── management-api.js            # 统一API接口
└── utils/
    ├── map-utils.js                # 地图工具函数
    ├── device-utils.js             # 设备工具函数
    └── websocket-manager.js        # WebSocket管理
```

### API接口设计
```javascript
// src/api/business/attendance/management/area-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const areaApi = {
  // 区域管理
  getAreaList: (params) => getRequest('/attendance/area/list', params),
  getAreaById: (id) => getRequest(`/attendance/area/${id}`),
  createArea: (params) => postRequest('/attendance/area/create', params),
  updateArea: (id, params) => putRequest(`/attendance/area/update/${id}`, params),
  deleteArea: (id) => deleteRequest(`/attendance/area/delete/${id}`),

  // 区域权限
  getAreaPermissions: (areaId) => getRequest(`/attendance/area/${areaId}/permissions`),
  updateAreaPermissions: (areaId, params) => putRequest(`/attendance/area/${areaId}/permissions`, params),

  // 区域监控
  getAreaMonitoringData: (areaId) => getRequest(`/attendance/area/${areaId}/monitoring`),
  getAreaAttendanceRecords: (areaId, params) => getRequest(`/attendance/area/${areaId}/records`, params),
};

// src/api/business/attendance/management/device-api.js
export const deviceApi = {
  // 设备管理
  getDeviceList: (params) => getRequest('/attendance/device/list', params),
  getDeviceById: (id) => getRequest(`/attendance/device/${id}`),
  createDevice: (params) => postRequest('/attendance/device/create', params),
  updateDevice: (id, params) => putRequest(`/attendance/device/update/${id}`, params),
  deleteDevice: (id) => deleteRequest(`/attendance/device/delete/${id}`),

  // 设备配置
  getDeviceConfig: (deviceId) => getRequest(`/attendance/device/${deviceId}/config`),
  updateDeviceConfig: (deviceId, params) => putRequest(`/attendance/device/${deviceId}/config`, params),

  // 设备关联
  getDeviceAssociations: (deviceId) => getRequest(`/attendance/device/${deviceId}/associations`),
  updateDeviceAssociations: (deviceId, params) => putRequest(`/attendance/device/${deviceId}/associations`, params),

  // 设备维护
  getDeviceMaintenanceRecords: (deviceId, params) => getRequest(`/attendance/device/${deviceId}/maintenance`, params),
  createMaintenanceRecord: (deviceId, params) => postRequest(`/attendance/device/${deviceId}/maintenance`, params),

  // 设备操作
  restartDevice: (deviceId) => postRequest(`/attendance/device/${deviceId}/restart`),
  syncDeviceTime: (deviceId) => postRequest(`/attendance/device/${deviceId}/sync-time`),
  testDevice: (deviceId) => postRequest(`/attendance/device/${deviceId}/test`),
};

// src/api/business/attendance/management/monitor-api.js
export const monitorApi = {
  // 实时监控
  getRealTimeStatus: () => getRequest('/attendance/monitor/realtime'),
  getDeviceStatusList: (params) => getRequest('/attendance/monitor/device-status', params),

  // 告警管理
  getAlertList: (params) => getRequest('/attendance/monitor/alerts', params),
  updateAlertStatus: (alertId, status) => putRequest(`/attendance/monitor/alerts/${alertId}/status`, { status }),

  // 统计数据
  getMonitoringStatistics: (params) => getRequest('/attendance/monitor/statistics', params),
  getDeviceUptimeReport: (params) => getRequest('/attendance/monitor/uptime-report', params),
};
```

## 核心功能模块

### 1. 考勤区域管理

#### 区域地图组件
```vue
<!-- src/views/business/attendance/management/area/components/AreaMap.vue -->
<template>
  <div class="area-map">
    <div class="map-header">
      <h3>考勤区域地图</h3>
      <div class="map-controls">
        <a-button-group size="small">
          <a-button :type="mapMode === 'view' ? 'primary' : 'default'" @click="setMapMode('view')">
            <template #icon><EyeOutlined /></template>
            查看
          </a-button>
          <a-button :type="mapMode === 'edit' ? 'primary' : 'default'" @click="setMapMode('edit')">
            <template #icon><EditOutlined /></template>
            编辑
          </a-button>
        </a-button-group>
        <a-button size="small" @click="centerMap">
          <template #icon><AimOutlined /></template>
          居中
        </a-button>
      </div>
    </div>

    <!-- 地图容器 -->
    <div id="areaMapContainer" class="map-container"></div>

    <!-- 区域信息面板 -->
    <div class="area-info-panel" v-if="selectedArea">
      <a-card size="small" :title="selectedArea.name">
        <template #extra>
          <a-button type="text" size="small" @click="clearSelection">
            <template #icon><CloseOutlined /></template>
          </a-button>
        </template>

        <div class="area-details">
          <div class="detail-item">
            <span class="label">区域类型:</span>
            <span class="value">{{ getAreaTypeText(selectedArea.type) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">覆盖范围:</span>
            <span class="value">{{ selectedArea.radius }}米</span>
          </div>
          <div class="detail-item">
            <span class="label">关联设备:</span>
            <span class="value">{{ selectedArea.deviceCount }}台</span>
          </div>
          <div class="detail-item">
            <span class="label">状态:</span>
            <a-badge :status="selectedArea.status === 'active' ? 'success' : 'error'"
                     :text="selectedArea.status === 'active' ? '启用' : '禁用'" />
          </div>
        </div>

        <div class="area-actions">
          <a-button type="primary" size="small" @click="handleEditArea">
            <template #icon><EditOutlined /></template>
            编辑
          </a-button>
          <a-button size="small" @click="handleViewDevices">
            <template #icon><DesktopOutlined /></template>
            查看设备
          </a-button>
        </div>
      </a-card>
    </div>

    <!-- 添加区域浮窗 -->
    <div class="add-area-float" v-if="mapMode === 'edit'">
      <a-button type="primary" shape="circle" size="large" @click="showAddAreaModal">
        <template #icon><PlusOutlined /></template>
      </a-button>
      <div class="float-tip">点击地图添加区域</div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted, nextTick } from 'vue';
import { message } from 'ant-design-vue';
import {
  EyeOutlined,
  EditOutlined,
  AimOutlined,
  CloseOutlined,
  DesktopOutlined,
  PlusOutlined
} from '@ant-design/icons-vue';
import { areaApi } from '/@/api/business/attendance/management/area-api';

const emit = defineEmits(['area-select', 'area-edit', 'area-add', 'view-devices']);

const mapMode = ref('view');
const selectedArea = ref(null);
let map = null;
let markers = [];
let circles = [];

// 初始化地图
const initMap = () => {
  nextTick(() => {
    // 这里以高德地图为例
    map = new AMap.Map('areaMapContainer', {
      zoom: 15,
      center: [116.397428, 39.90923], // 北京天安门
      mapStyle: 'amap://styles/normal'
    });

    // 添加地图点击事件
    if (mapMode.value === 'edit') {
      map.on('click', handleMapClick);
    }

    // 加载区域数据
    loadAreas();
  });
};

// 加载区域数据
const loadAreas = async () => {
  try {
    const response = await areaApi.getAreaList();
    response.data.forEach(area => {
      addAreaToMap(area);
    });
  } catch (error) {
    console.error('加载区域数据失败:', error);
  }
};

// 添加区域到地图
const addAreaToMap = (area) => {
  // 创建标记点
  const marker = new AMap.Marker({
    position: [area.longitude, area.latitude],
    title: area.name,
    icon: new AMap.Icon({
      image: getAreaIcon(area.type),
      size: new AMap.Size(32, 32)
    })
  });

  // 创建圆形覆盖区域
  const circle = new AMap.Circle({
    center: [area.longitude, area.latitude],
    radius: area.radius,
    strokeColor: area.status === 'active' ? '#52c41a' : '#ff4d4f',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: area.status === 'active' ? '#52c41a' : '#ff4d4f',
    fillOpacity: 0.2
  });

  // 添加点击事件
  marker.on('click', () => {
    selectArea(area);
  });

  map.add(marker);
  map.add(circle);

  markers.push(marker);
  circles.push(circle);
};

// 选择区域
const selectArea = (area) => {
  selectedArea.value = area;
  emit('area-select', area);
};

// 清除选择
const clearSelection = () => {
  selectedArea.value = null;
};

// 地图点击事件
const handleMapClick = (e) => {
  if (mapMode.value === 'edit') {
    const lnglat = e.lnglat;
    emit('area-add', {
      longitude: lnglat.lng,
      latitude: lnglat.lat
    });
  }
};

// 设置地图模式
const setMapMode = (mode) => {
  mapMode.value = mode;
  if (map) {
    if (mode === 'edit') {
      map.on('click', handleMapClick);
    } else {
      map.off('click', handleMapClick);
    }
  }
};

// 居中地图
const centerMap = () => {
  if (map && selectedArea.value) {
    map.setCenter([selectedArea.value.longitude, selectedArea.value.latitude]);
  }
};

// 获取区域图标
const getAreaIcon = (type) => {
  const iconMap = {
    'office': '/images/area-office.png',
    'factory': '/images/area-factory.png',
    'warehouse': '/images/area-warehouse.png',
    'outdoor': '/images/area-outdoor.png'
  };
  return iconMap[type] || '/images/area-default.png';
};

// 获取区域类型文本
const getAreaTypeText = (type) => {
  const typeMap = {
    'office': '办公区',
    'factory': '工厂',
    'warehouse': '仓库',
    'outdoor': '户外'
  };
  return typeMap[type] || '未知';
};

// 编辑区域
const handleEditArea = () => {
  emit('area-edit', selectedArea.value);
};

// 查看设备
const handleViewDevices = () => {
  emit('view-devices', selectedArea.value);
};

// 显示添加区域弹窗
const showAddAreaModal = () => {
  message.info('请在地图上点击选择位置');
};

onMounted(() => {
  // 加载高德地图API
  if (window.AMap) {
    initMap();
  } else {
    const script = document.createElement('script');
    script.src = 'https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY';
    script.onload = initMap;
    document.head.appendChild(script);
  }
});

onUnmounted(() => {
  // 清理地图资源
  if (map) {
    map.destroy();
  }
});
</script>

<style scoped lang="less">
.area-map {
  position: relative;
  height: 600px;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;

  .map-header {
    position: absolute;
    top: 16px;
    left: 16px;
    right: 16px;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 16px;
    border-radius: 8px;
    backdrop-filter: blur(10px);

    h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .map-controls {
      display: flex;
      gap: 8px;
    }
  }

  .map-container {
    width: 100%;
    height: 100%;
  }

  .area-info-panel {
    position: absolute;
    right: 16px;
    top: 80px;
    width: 280px;
    z-index: 100;

    .area-details {
      .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;

        .label {
          color: #666;
          font-size: 14px;
        }

        .value {
          font-weight: 500;
          font-size: 14px;
        }
      }
    }

    .area-actions {
      margin-top: 12px;
      display: flex;
      gap: 8px;
    }
  }

  .add-area-float {
    position: absolute;
    bottom: 24px;
    right: 24px;
    z-index: 100;
    text-align: center;

    .float-tip {
      margin-top: 8px;
      font-size: 12px;
      color: #666;
      background: rgba(255, 255, 255, 0.9);
      padding: 4px 8px;
      border-radius: 4px;
    }
  }
}
</style>
```

### 2. 设备管理

#### 设备表格组件
```vue
<!-- src/views/business/attendance/management/device/components/DeviceTable.vue -->
<template>
  <div class="device-table">
    <!-- 搜索工具栏 -->
    <div class="table-toolbar">
      <a-form layout="inline" :model="searchForm" @finish="handleSearch">
        <a-form-item label="设备名称">
          <a-input v-model:value="searchForm.name" placeholder="请输入设备名称" allow-clear />
        </a-form-item>
        <a-form-item label="设备编号">
          <a-input v-model:value="searchForm.deviceNo" placeholder="请输入设备编号" allow-clear />
        </a-form-item>
        <a-form-item label="设备类型">
          <a-select v-model:value="searchForm.type" placeholder="请选择设备类型" allow-clear>
            <a-select-option value="fingerprint">指纹机</a-select-option>
            <a-select-option value="face">人脸识别</a-select-option>
            <a-select-option value="ic">IC卡机</a-select-option>
            <a-select-option value="qr">二维码</a-select-option>
            <a-select-option value="mobile">移动端</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item label="状态">
          <a-select v-model:value="searchForm.status" placeholder="请选择状态" allow-clear>
            <a-select-option value="online">在线</a-select-option>
            <a-select-option value="offline">离线</a-select-option>
            <a-select-option value="maintenance">维护中</a-select-option>
            <a-select-option value="error">故障</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item>
          <a-button type="primary" html-type="submit" :loading="loading">
            <template #icon><SearchOutlined /></template>
            搜索
          </a-button>
          <a-button @click="handleReset">
            <template #icon><ReloadOutlined /></template>
            重置
          </a-button>
        </a-form-item>
      </a-form>
    </div>

    <!-- 操作工具栏 -->
    <div class="table-actions">
      <div class="actions-left">
        <a-button type="primary" @click="handleAdd">
          <template #icon><PlusOutlined /></template>
          新增设备
        </a-button>
        <a-button @click="handleBatchImport">
          <template #icon><UploadOutlined /></template>
          批量导入
        </a-button>
        <a-button @click="handleBatchOperation" :disabled="selectedRowKeys.length === 0">
          <template #icon><AppstoreOutlined /></template>
          批量操作
        </a-button>
      </div>
      <div class="actions-right">
        <a-button @click="handleRefresh" :loading="loading">
          <template #icon><ReloadOutlined /></template>
          刷新
        </a-button>
        <a-button @click="handleExport">
          <template #icon><ExportOutlined /></template>
          导出
        </a-button>
      </div>
    </div>

    <!-- 数据表格 -->
    <a-table
      :columns="columns"
      :data-source="dataSource"
      :loading="loading"
      :pagination="pagination"
      :row-selection="rowSelection"
      row-key="id"
      @change="handleTableChange"
    >
      <template #bodyCell="{ column, record }">
        <template v-if="column.key === 'status'">
          <a-badge :status="getStatusBadge(record.status)" :text="getStatusText(record.status)" />
        </template>

        <template v-else-if="column.key === 'type'">
          <a-tag :color="getTypeColor(record.type)">{{ getTypeText(record.type) }}</a-tag>
        </template>

        <template v-else-if="column.key === 'lastOnline'">
          <span v-if="record.lastOnline">{{ formatDateTime(record.lastOnline) }}</span>
          <span v-else class="text-muted">从未在线</span>
        </template>

        <template v-else-if="column.key === 'action'">
          <a-space>
            <a-button type="link" size="small" @click="handleView(record)">查看</a-button>
            <a-button type="link" size="small" @click="handleEdit(record)">编辑</a-button>
            <a-dropdown>
              <template #overlay>
                <a-menu @click="({ key }) => handleMenuClick(key, record)">
                  <a-menu-item key="config">
                    <SettingOutlined />
                    配置
                  </a-menu-item>
                  <a-menu-item key="associate">
                    <LinkOutlined />
                    关联
                  </a-menu-item>
                  <a-menu-item key="maintenance">
                    <ToolOutlined />
                    维护
                  </a-menu-item>
                  <a-menu-divider />
                  <a-menu-item key="restart">
                    <ReloadOutlined />
                    重启
                  </a-menu-item>
                  <a-menu-item key="test">
                    <PlayCircleOutlined />
                    测试
                  </a-menu-item>
                </a-menu>
              </template>
              <a-button type="link" size="small">
                更多 <DownOutlined />
              </a-button>
            </a-dropdown>
          </a-space>
        </template>
      </template>
    </a-table>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  SearchOutlined,
  ReloadOutlined,
  PlusOutlined,
  UploadOutlined,
  AppstoreOutlined,
  ExportOutlined,
  SettingOutlined,
  LinkOutlined,
  ToolOutlined,
  PlayCircleOutlined,
  DownOutlined
} from '@ant-design/icons-vue';
import { deviceApi } from '/@/api/business/attendance/management/device-api';

const emit = defineEmits(['add', 'edit', 'view', 'config', 'associate', 'maintenance']);

const loading = ref(false);
const dataSource = ref([]);
const selectedRowKeys = ref([]);

const searchForm = reactive({
  name: '',
  deviceNo: '',
  type: '',
  status: '',
});

const pagination = reactive({
  current: 1,
  pageSize: 20,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `共 ${total} 条记录`,
});

const columns = [
  {
    title: '设备名称',
    dataIndex: 'name',
    key: 'name',
    width: 150,
  },
  {
    title: '设备编号',
    dataIndex: 'deviceNo',
    key: 'deviceNo',
    width: 120,
  },
  {
    title: '设备类型',
    dataIndex: 'type',
    key: 'type',
    width: 100,
  },
  {
    title: '所在区域',
    dataIndex: 'areaName',
    key: 'areaName',
    width: 120,
  },
  {
    title: 'IP地址',
    dataIndex: 'ipAddress',
    key: 'ipAddress',
    width: 120,
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    width: 80,
  },
  {
    title: '最后在线',
    dataIndex: 'lastOnline',
    key: 'lastOnline',
    width: 150,
  },
  {
    title: '操作',
    key: 'action',
    width: 200,
    fixed: 'right',
  },
];

const rowSelection = {
  selectedRowKeys: selectedRowKeys,
  onChange: (keys) => {
    selectedRowKeys.value = keys;
  },
};

// 获取状态徽标
const getStatusBadge = (status) => {
  const statusMap = {
    online: 'success',
    offline: 'default',
    maintenance: 'warning',
    error: 'error',
  };
  return statusMap[status] || 'default';
};

// 获取状态文本
const getStatusText = (status) => {
  const statusMap = {
    online: '在线',
    offline: '离线',
    maintenance: '维护中',
    error: '故障',
  };
  return statusMap[status] || '未知';
};

// 获取类型颜色
const getTypeColor = (type) => {
  const colorMap = {
    fingerprint: 'blue',
    face: 'green',
    ic: 'orange',
    qr: 'purple',
    mobile: 'cyan',
  };
  return colorMap[type] || 'default';
};

// 获取类型文本
const getTypeText = (type) => {
  const typeMap = {
    fingerprint: '指纹机',
    face: '人脸识别',
    ic: 'IC卡机',
    qr: '二维码',
    mobile: '移动端',
  };
  return typeMap[type] || '未知';
};

// 格式化日期时间
const formatDateTime = (dateTime) => {
  if (!dateTime) return '';
  return new Date(dateTime).toLocaleString('zh-CN');
};

// 加载设备数据
const loadDeviceData = async () => {
  loading.value = true;
  try {
    const params = {
      ...searchForm,
      page: pagination.current,
      pageSize: pagination.pageSize,
    };
    const response = await deviceApi.getDeviceList(params);
    dataSource.value = response.data.records;
    pagination.total = response.data.total;
  } catch (error) {
    console.error('加载设备数据失败:', error);
    message.error('加载设备数据失败');
  } finally {
    loading.value = false;
  }
};

// 搜索
const handleSearch = () => {
  pagination.current = 1;
  loadDeviceData();
};

// 重置
const handleReset = () => {
  Object.assign(searchForm, {
    name: '',
    deviceNo: '',
    type: '',
    status: '',
  });
  pagination.current = 1;
  loadDeviceData();
};

// 表格变化
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadDeviceData();
};

// 新增设备
const handleAdd = () => {
  emit('add');
};

// 编辑设备
const handleEdit = (record) => {
  emit('edit', record);
};

// 查看设备
const handleView = (record) => {
  emit('view', record);
};

// 菜单点击
const handleMenuClick = (key, record) => {
  switch (key) {
    case 'config':
      emit('config', record);
      break;
    case 'associate':
      emit('associate', record);
      break;
    case 'maintenance':
      emit('maintenance', record);
      break;
    case 'restart':
      handleRestart(record);
      break;
    case 'test':
      handleTest(record);
      break;
  }
};

// 重启设备
const handleRestart = (record) => {
  Modal.confirm({
    title: '确认重启',
    content: `确定要重启设备"${record.name}"吗？`,
    onOk: async () => {
      try {
        await deviceApi.restartDevice(record.id);
        message.success('设备重启指令已发送');
      } catch (error) {
        message.error('设备重启失败');
      }
    },
  });
};

// 测试设备
const handleTest = async (record) => {
  try {
    const response = await deviceApi.testDevice(record.id);
    if (response.data.success) {
      message.success('设备测试通过');
    } else {
      message.error(`设备测试失败: ${response.data.message}`);
    }
  } catch (error) {
    message.error('设备测试失败');
  }
};

// 批量导入
const handleBatchImport = () => {
  message.info('批量导入功能开发中...');
};

// 批量操作
const handleBatchOperation = () => {
  message.info('批量操作功能开发中...');
};

// 导出
const handleExport = () => {
  message.info('导出功能开发中...');
};

// 刷新
const handleRefresh = () => {
  loadDeviceData();
};

onMounted(() => {
  loadDeviceData();
});
</script>

<style scoped lang="less">
.device-table {
  background: #fff;
  border-radius: 8px;
  padding: 16px;

  .table-toolbar {
    margin-bottom: 16px;
    padding: 16px;
    background: #fafafa;
    border-radius: 4px;
  }

  .table-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;

    .actions-left,
    .actions-right {
      display: flex;
      gap: 8px;
    }
  }

  .text-muted {
    color: #999;
    font-style: italic;
  }
}
</style>
```

### 3. 设备监控

#### 实时监控组件
```vue
<!-- src/views/business/attendance/management/monitor/components/RealTimeMonitor.vue -->
<template>
  <div class="realtime-monitor">
    <!-- 监控头部 -->
    <div class="monitor-header">
      <div class="header-left">
        <h3>实时监控</h3>
        <a-space>
          <a-tag :color="connectionStatus === 'connected' ? 'success' : 'error'">
            <a-badge :status="connectionStatus === 'connected' ? 'success' : 'error'" />
            {{ connectionStatus === 'connected' ? '已连接' : '连接断开' }}
          </a-tag>
          <span class="update-time">更新时间: {{ lastUpdateTime }}</span>
        </a-space>
      </div>
      <div class="header-right">
        <a-button @click="handleRefresh" :loading="refreshing">
          <template #icon><ReloadOutlined /></template>
          刷新
        </a-button>
        <a-button @click="handleAutoRefresh">
          <template #icon>
            <PlayCircleOutlined v-if="!autoRefresh" />
            <PauseCircleOutlined v-else />
          </template>
          {{ autoRefresh ? '停止' : '开始' }}自动刷新
        </a-button>
      </div>
    </div>

    <!-- 统计卡片 -->
    <div class="stats-cards">
      <a-row :gutter="16">
        <a-col :span="6" v-for="(stat, index) in statsData" :key="index">
          <a-card :bordered="false" class="stat-card">
            <a-statistic
              :title="stat.title"
              :value="stat.value"
              :value-style="{ color: stat.color }"
              :prefix="stat.prefix"
            >
              <template #suffix>
                <span class="stat-suffix">{{ stat.suffix }}</span>
              </template>
            </a-statistic>
            <div class="stat-trend" v-if="stat.trend">
              <component :is="stat.trend > 0 ? 'ArrowUpOutlined' : 'ArrowDownOutlined'"
                        :style="{ color: stat.trend > 0 ? '#52c41a' : '#ff4d4f' }" />
              <span>{{ Math.abs(stat.trend) }}%</span>
            </div>
          </a-card>
        </a-col>
      </a-row>
    </div>

    <!-- 设备状态列表 -->
    <div class="device-status-list">
      <a-card title="设备状态" :bordered="false">
        <template #extra>
          <a-radio-group v-model:value="statusFilter" size="small" @change="filterDevices">
            <a-radio-button value="all">全部</a-radio-button>
            <a-radio-button value="online">在线</a-radio-button>
            <a-radio-button value="offline">离线</a-radio-button>
            <a-radio-button value="error">故障</a-radio-button>
          </a-radio-group>
        </template>

        <div class="device-grid">
          <div
            v-for="device in filteredDevices"
            :key="device.id"
            class="device-card"
            :class="getDeviceCardClass(device.status)"
            @click="handleDeviceClick(device)"
          >
            <div class="device-header">
              <div class="device-info">
                <h4>{{ device.name }}</h4>
                <span class="device-no">{{ device.deviceNo }}</span>
              </div>
              <div class="device-status">
                <a-badge :status="getStatusBadge(device.status)" />
                <span class="status-text">{{ getStatusText(device.status) }}</span>
              </div>
            </div>

            <div class="device-details">
              <div class="detail-item">
                <span class="label">类型:</span>
                <span class="value">{{ getTypeText(device.type) }}</span>
              </div>
              <div class="detail-item">
                <span class="label">位置:</span>
                <span class="value">{{ device.location }}</span>
              </div>
              <div class="detail-item">
                <span class="label">今日打卡:</span>
                <span class="value highlight">{{ device.todayCount || 0 }}次</span>
              </div>
              <div class="detail-item">
                <span class="label">最后心跳:</span>
                <span class="value">{{ formatTime(device.lastHeartbeat) }}</span>
              </div>
            </div>

            <div class="device-actions">
              <a-button type="text" size="small" @click.stop="handleViewDetail(device)">
                详情
              </a-button>
              <a-button type="text" size="small" @click.stop="handleRestart(device)" v-if="device.status !== 'offline'">
                重启
              </a-button>
              <a-button type="text" size="small" @click.stop="handleMaintenance(device)">
                维护
              </a-button>
            </div>
          </div>
        </div>
      </a-card>
    </div>

    <!-- 实时告警 -->
    <div class="realtime-alerts">
      <a-card title="实时告警" :bordered="false">
        <template #extra>
          <a-button type="link" @click="viewAllAlerts">查看全部</a-button>
        </template>

        <a-list :data-source="recentAlerts" :loading="alertsLoading">
          <template #renderItem="{ item }">
            <a-list-item>
              <a-list-item-meta>
                <template #avatar>
                  <a-badge :status="getAlertBadge(item.level)" />
                </template>
                <template #title>
                  <span :style="{ color: getAlertColor(item.level) }">{{ item.title }}</span>
                </template>
                <template #description>
                  {{ item.description }}
                </template>
              </a-list-item-meta>
              <div class="alert-time">{{ formatTime(item.createdAt) }}</div>
            </a-list-item>
          </template>
        </a-list>
      </a-card>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted, onUnmounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  ReloadOutlined,
  PlayCircleOutlined,
  PauseCircleOutlined,
  ArrowUpOutlined,
  ArrowDownOutlined
} from '@ant-design/icons-vue';
import { monitorApi } from '/@/api/business/attendance/management/monitor-api';
import { WebSocketManager } from '/@/utils/websocket-manager';

const emit = defineEmits(['device-click', 'view-detail', 'view-alerts']);

const refreshing = ref(false);
const autoRefresh = ref(false);
const connectionStatus = ref('disconnected');
const lastUpdateTime = ref('');
const statusFilter = ref('all');
const alertsLoading = ref(false);

const statsData = ref([
  {
    title: '设备总数',
    value: 0,
    suffix: '台',
    color: '#1890ff',
    prefix: 'DesktopOutlined',
    trend: 0
  },
  {
    title: '在线设备',
    value: 0,
    suffix: '台',
    color: '#52c41a',
    prefix: 'CheckCircleOutlined',
    trend: 0
  },
  {
    title: '今日打卡',
    value: 0,
    suffix: '次',
    color: '#faad14',
    prefix: 'ClockCircleOutlined',
    trend: 0
  },
  {
    title: '异常告警',
    value: 0,
    suffix: '条',
    color: '#ff4d4f',
    prefix: 'ExclamationCircleOutlined',
    trend: 0
  }
]);

const devices = ref([]);
const recentAlerts = ref([]);

let refreshTimer = null;
let wsManager = null;

// 过滤后的设备列表
const filteredDevices = computed(() => {
  if (statusFilter.value === 'all') {
    return devices.value;
  }
  return devices.value.filter(device => device.status === statusFilter.value);
});

// 加载监控数据
const loadMonitorData = async () => {
  try {
    const [statusResponse, statsResponse, alertsResponse] = await Promise.all([
      monitorApi.getDeviceStatusList(),
      monitorApi.getMonitoringStatistics(),
      monitorApi.getAlertList({ limit: 10 })
    ]);

    devices.value = statusResponse.data;
    updateStatsData(statsResponse.data);
    recentAlerts.value = alertsResponse.data;
    lastUpdateTime.value = new Date().toLocaleTimeString('zh-CN');
  } catch (error) {
    console.error('加载监控数据失败:', error);
  }
};

// 更新统计数据
const updateStatsData = (data) => {
  statsData.value[0].value = data.totalDevices;
  statsData.value[1].value = data.onlineDevices;
  statsData.value[2].value = data.todayCheckins;
  statsData.value[3].value = data.activeAlerts;

  // 计算趋势（示例）
  statsData.value.forEach(stat => {
    stat.trend = Math.floor(Math.random() * 20 - 10); // 模拟趋势数据
  });
};

// 刷新
const handleRefresh = async () => {
  refreshing.value = true;
  await loadMonitorData();
  refreshing.value = false;
};

// 自动刷新
const handleAutoRefresh = () => {
  autoRefresh.value = !autoRefresh.value;

  if (autoRefresh.value) {
    refreshTimer = setInterval(() => {
      loadMonitorData();
    }, 30000); // 30秒刷新一次
    message.success('已开启自动刷新');
  } else {
    if (refreshTimer) {
      clearInterval(refreshTimer);
      refreshTimer = null;
    }
    message.info('已停止自动刷新');
  }
};

// 过滤设备
const filterDevices = () => {
  // 过滤逻辑已在computed中实现
};

// 获取设备卡片样式
const getDeviceCardClass = (status) => {
  return {
    'device-online': status === 'online',
    'device-offline': status === 'offline',
    'device-error': status === 'error',
    'device-maintenance': status === 'maintenance'
  };
};

// 获取状态徽标
const getStatusBadge = (status) => {
  const statusMap = {
    online: 'success',
    offline: 'default',
    maintenance: 'warning',
    error: 'error',
  };
  return statusMap[status] || 'default';
};

// 获取状态文本
const getStatusText = (status) => {
  const statusMap = {
    online: '在线',
    offline: '离线',
    maintenance: '维护中',
    error: '故障',
  };
  return statusMap[status] || '未知';
};

// 获取类型文本
const getTypeText = (type) => {
  const typeMap = {
    fingerprint: '指纹机',
    face: '人脸识别',
    ic: 'IC卡机',
    qr: '二维码',
    mobile: '移动端',
  };
  return typeMap[type] || '未知';
};

// 获取告警徽标
const getAlertBadge = (level) => {
  const levelMap = {
    low: 'default',
    medium: 'warning',
    high: 'error',
    critical: 'error',
  };
  return levelMap[level] || 'default';
};

// 获取告警颜色
const getAlertColor = (level) => {
  const colorMap = {
    low: '#666',
    medium: '#faad14',
    high: '#ff7a45',
    critical: '#ff4d4f',
  };
  return colorMap[level] || '#666';
};

// 格式化时间
const formatTime = (time) => {
  if (!time) return '--';
  return new Date(time).toLocaleTimeString('zh-CN');
};

// 设备点击
const handleDeviceClick = (device) => {
  emit('device-click', device);
};

// 查看详情
const handleViewDetail = (device) => {
  emit('view-detail', device);
};

// 重启设备
const handleRestart = async (device) => {
  try {
    await deviceApi.restartDevice(device.id);
    message.success('重启指令已发送');
  } catch (error) {
    message.error('重启失败');
  }
};

// 维护设备
const handleMaintenance = (device) => {
  message.info('维护功能开发中...');
};

// 查看所有告警
const viewAllAlerts = () => {
  emit('view-alerts');
};

// WebSocket连接
const initWebSocket = () => {
  wsManager = new WebSocketManager('/attendance/monitor');

  wsManager.on('open', () => {
    connectionStatus.value = 'connected';
    message.success('实时连接已建立');
  });

  wsManager.on('close', () => {
    connectionStatus.value = 'disconnected';
  });

  wsManager.on('message', (data) => {
    handleWebSocketMessage(data);
  });

  wsManager.connect();
};

// 处理WebSocket消息
const handleWebSocketMessage = (data) => {
  switch (data.type) {
    case 'device_status':
      updateDeviceStatus(data.payload);
      break;
    case 'new_alert':
      addNewAlert(data.payload);
      break;
    case 'statistics':
      updateStatsData(data.payload);
      break;
  }
};

// 更新设备状态
const updateDeviceStatus = (payload) => {
  const device = devices.value.find(d => d.id === payload.deviceId);
  if (device) {
    Object.assign(device, payload);
  }
};

// 添加新告警
const addNewAlert = (alert) => {
  recentAlerts.value.unshift(alert);
  if (recentAlerts.value.length > 10) {
    recentAlerts.value.pop();
  }
};

onMounted(() => {
  loadMonitorData();
  initWebSocket();
});

onUnmounted(() => {
  if (refreshTimer) {
    clearInterval(refreshTimer);
  }
  if (wsManager) {
    wsManager.disconnect();
  }
});
</script>

<style scoped lang="less">
.realtime-monitor {
  .monitor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;

      h3 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
      }

      .update-time {
        color: #666;
        font-size: 14px;
      }
    }

    .header-right {
      display: flex;
      gap: 8px;
    }
  }

  .stats-cards {
    margin-bottom: 24px;

    .stat-card {
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;

      &:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }

      .stat-suffix {
        font-size: 14px;
        color: #666;
        margin-left: 4px;
      }

      .stat-trend {
        margin-top: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 12px;
      }
    }
  }

  .device-status-list {
    margin-bottom: 24px;

    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;

      .device-card {
        border: 1px solid #f0f0f0;
        border-radius: 8px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.3s;

        &:hover {
          border-color: #1890ff;
          box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);
        }

        &.device-online {
          border-left: 4px solid #52c41a;
        }

        &.device-offline {
          border-left: 4px solid #d9d9d9;
        }

        &.device-error {
          border-left: 4px solid #ff4d4f;
        }

        &.device-maintenance {
          border-left: 4px solid #faad14;
        }

        .device-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 12px;

          .device-info {
            h4 {
              margin: 0 0 4px 0;
              font-size: 16px;
              font-weight: 600;
            }

            .device-no {
              color: #666;
              font-size: 12px;
            }
          }

          .device-status {
            display: flex;
            align-items: center;
            gap: 4px;

            .status-text {
              font-size: 12px;
            }
          }
        }

        .device-details {
          margin-bottom: 12px;

          .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 14px;

            .label {
              color: #666;
            }

            .value {
              font-weight: 500;

              &.highlight {
                color: #1890ff;
                font-weight: 600;
              }
            }
          }
        }

        .device-actions {
          display: flex;
          justify-content: space-between;
          border-top: 1px solid #f0f0f0;
          padding-top: 8px;
        }
      }
    }
  }

  .realtime-alerts {
    .alert-time {
      color: #666;
      font-size: 12px;
    }
  }
}
</style>
```

## Mock数据示例

```javascript
// src/mock/management-mock.js
export const mockAreaList = [
  {
    id: 'area001',
    name: '总部办公区',
    code: 'HQ_OFFICE',
    type: 'office',
    longitude: 116.397428,
    latitude: 39.90923,
    radius: 200,
    address: '北京市朝阳区xxx街道xxx号',
    status: 'active',
    deviceCount: 5,
    createdAt: '2024-01-01T00:00:00Z'
  },
  {
    id: 'area002',
    name: '工厂车间',
    code: 'FACTORY',
    type: 'factory',
    longitude: 116.407428,
    latitude: 39.91923,
    radius: 500,
    address: '北京市海淀区xxx路xxx号',
    status: 'active',
    deviceCount: 8,
    createdAt: '2024-01-01T00:00:00Z'
  }
];

export const mockDeviceList = {
  records: [
    {
      id: 'dev001',
      name: '前门人脸识别机',
      deviceNo: 'FACE001',
      type: 'face',
      areaId: 'area001',
      areaName: '总部办公区',
      ipAddress: '192.168.1.100',
      status: 'online',
      lastOnline: '2024-01-15T10:30:00Z',
      todayCount: 45,
      location: '前门入口'
    },
    {
      id: 'dev002',
      name: '后门指纹机',
      deviceNo: 'FP001',
      type: 'fingerprint',
      areaId: 'area001',
      areaName: '总部办公区',
      ipAddress: '192.168.1.101',
      status: 'offline',
      lastOnline: '2024-01-15T08:00:00Z',
      todayCount: 0,
      location: '后门出口'
    }
  ],
  total: 50,
  current: 1,
  pageSize: 20
};

export const mockMonitoringData = {
  statistics: {
    totalDevices: 50,
    onlineDevices: 45,
    offlineDevices: 5,
    todayCheckins: 1250,
    activeAlerts: 3
  },
  deviceStatus: [
    {
      id: 'dev001',
      name: '前门人脸识别机',
      deviceNo: 'FACE001',
      type: 'face',
      status: 'online',
      location: '前门入口',
      todayCount: 45,
      lastHeartbeat: '2024-01-15T10:30:00Z'
    }
  ],
  alerts: [
    {
      id: 'alert001',
      title: '设备离线告警',
      description: '设备"后门指纹机"已离线超过10分钟',
      level: 'medium',
      deviceId: 'dev002',
      createdAt: '2024-01-15T10:20:00Z'
    }
  ]
};

export default {
  mockAreaList,
  mockDeviceList,
  mockMonitoringData
};
```

## 开发注意事项总结

### 核心功能要点
1. **考勤区域管理** - 地图化的区域配置和管理
2. **设备生命周期管理** - 从注册到维护的完整流程
3. **实时监控** - WebSocket实现的设备状态实时监控
4. **多类型设备支持** - 支持各种考勤设备类型
5. **告警机制** - 设备异常实时告警和处理
6. **数据可视化** - 丰富的图表和状态展示

### 性能优化建议
1. 使用WebSocket减少轮询开销
2. 地图数据采用分层加载
3. 设备状态数据合理缓存
4. 实时数据采用增量更新

### 用户体验优化
1. 提供直观的地图操作界面
2. 实时状态更新和反馈
3. 丰富的设备操作功能
4. 及时的异常告警提醒

## 总结

考勤管理模块作为系统的基础设施，需要重点关注：

- 设备状态的实时性和准确性
- 地图操作的流畅性和直观性
- 告警机制的及时性和有效性
- 设备管理的便捷性和完整性
- 数据监控的全面性和可视化

通过遵循本文档的技术规范，可以构建出功能完善、性能优良的考勤管理模块。