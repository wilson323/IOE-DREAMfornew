# ä»ªè¡¨ä¸­å¿ƒåŠŸèƒ½å¸ƒå±€æ–‡æ¡£ - å®Œæ•´ç‰ˆ

## åŠŸèƒ½æ¦‚è¿°

ä»ªè¡¨ä¸­å¿ƒæ˜¯è€ƒå‹¤ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®å±•ç¤ºå’Œå¿«é€Ÿæ“ä½œå…¥å£ï¼Œæä¾›å¤šç»´åº¦çš„è€ƒå‹¤æ•°æ®å¯è§†åŒ–å±•ç¤ºï¼Œæ”¯æŒä¸ªäººã€éƒ¨é—¨ã€ä¼ä¸šä¸‰ä¸ªå±‚çº§çš„å®æ—¶ç›‘æ§å’Œç»Ÿè®¡åˆ†æã€‚

## æŠ€æœ¯æ¶æ„è§„èŒƒ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶**: Vue 3.4.27 (Composition API)
- **UIç»„ä»¶åº“**: Ant Design Vue 4.2.5
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1.7
- **è·¯ç”±ç®¡ç†**: Vue Router 4.3.2
- **HTTPå®¢æˆ·ç«¯**: Axios 1.6.8
- **å›¾è¡¨åº“**: ECharts 5.4.3
- **æ ·å¼é¢„å¤„ç†å™¨**: Less 4.2.0
- **å›¾æ ‡åº“**: @ant-design/icons-vue

### é¡¹ç›®æ–‡ä»¶ç»„ç»‡ç»“æ„
```
src/views/business/attendance/dashboard/
â”œâ”€â”€ index.vue                        # ä»ªè¡¨ä¸­å¿ƒä¸»é¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ OverviewCards.vue           # æ¦‚è§ˆå¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ AttendanceChart.vue         # è€ƒå‹¤è¶‹åŠ¿å›¾è¡¨
â”‚   â”œâ”€â”€ HeatmapChart.vue            # çƒ­åŠ›å›¾ç»„ä»¶
â”‚   â”œâ”€â”€ QuickActions.vue            # å¿«é€Ÿæ“ä½œç»„ä»¶
â”‚   â”œâ”€â”€ PersonalDashboard.vue       # ä¸ªäººçœ‹æ¿
â”‚   â”œâ”€â”€ DepartmentDashboard.vue     # éƒ¨é—¨çœ‹æ¿
â”‚   â””â”€â”€ EnterpriseDashboard.vue     # ä¼ä¸šçœ‹æ¿
â”œâ”€â”€ mock/
â”‚   â””â”€â”€ dashboard-mock.js           # æ¨¡æ‹Ÿæ•°æ®
â”œâ”€â”€ api/
â”‚   â””â”€â”€ dashboard-api.js            # APIæ¥å£å®šä¹‰
â””â”€â”€ utils/
    â”œâ”€â”€ chart-utils.js              # å›¾è¡¨å·¥å…·å‡½æ•°
    â””â”€â”€ data-format.js              # æ•°æ®æ ¼å¼åŒ–å·¥å…·
```

### APIæ¥å£è®¾è®¡
```javascript
// src/api/business/attendance/dashboard-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const dashboardApi = {
  // è·å–é¦–é¡µæ¦‚è§ˆæ•°æ®
  getOverviewData: (params) => getRequest('/attendance/dashboard/overview', params),

  // è·å–ä¸ªäººçœ‹æ¿æ•°æ®
  getPersonalDashboard: (userId, params) => getRequest(`/attendance/dashboard/personal/${userId}`, params),

  // è·å–éƒ¨é—¨çœ‹æ¿æ•°æ®
  getDepartmentDashboard: (deptId, params) => getRequest(`/attendance/dashboard/department/${deptId}`, params),

  // è·å–ä¼ä¸šçœ‹æ¿æ•°æ®
  getEnterpriseDashboard: (params) => getRequest('/attendance/dashboard/enterprise', params),

  // è·å–è€ƒå‹¤è¶‹åŠ¿æ•°æ®
  getAttendanceTrend: (params) => getRequest('/attendance/dashboard/trend', params),

  // è·å–éƒ¨é—¨è€ƒå‹¤çƒ­åŠ›å›¾æ•°æ®
  getDepartmentHeatmap: (params) => getRequest('/attendance/dashboard/heatmap', params),

  // è·å–å®æ—¶ç»Ÿè®¡æ•°æ®
  getRealTimeStats: (params) => getRequest('/attendance/dashboard/realtime', params),

  // è·å–å¿«é€Ÿæ“ä½œæƒé™
  getQuickActions: (userId) => getRequest(`/attendance/dashboard/quick-actions/${userId}`),

  // åˆ·æ–°çœ‹æ¿æ•°æ®
  refreshDashboard: (dashboardType, params) => postRequest('/attendance/dashboard/refresh', { dashboardType, ...params }),
};
```

## å¼€å‘æ³¨æ„äº‹é¡¹
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 1. Vue 3 ç»„ä»¶å¼€å‘è§„èŒƒ
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

#### å“åº”å¼æ•°æ®ç®¡ç†
```vue
<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue';
import { useStore } from 'pinia';
import { dashboardApi } from '/@/api/business/attendance/dashboard-api';

const store = useStore();
const loading = ref(false);
const overviewData = ref({});
const trendData = ref([]);
const heatmapData = ref([]);
const refreshInterval = ref(null);

// è®¡ç®—å±æ€§
const attendanceRate = computed(() => {
  if (!overviewData.value.totalEmployees) return 0;
  return ((overviewData.value.presentEmployees / overviewData.value.totalEmployees) * 100).toFixed(1);
});

// æ•°æ®åŠ è½½
const loadOverviewData = async () => {
  loading.value = true;
  try {
    const response = await dashboardApi.getOverviewData();
    overviewData.value = response.data;
  } catch (error) {
    console.error('åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

// è‡ªåŠ¨åˆ·æ–°
const startAutoRefresh = () => {
  refreshInterval.value = setInterval(() => {
    loadOverviewData();
  }, 30000); // 30ç§’åˆ·æ–°ä¸€æ¬¡
};

onMounted(() => {
  loadOverviewData();
  startAutoRefresh();
});

onUnmounted(() => {
  if (refreshInterval.value) {
    clearInterval(refreshInterval.value);
  }
});
</script>
```

### 2. å›¾è¡¨ä½¿ç”¨è§„èŒƒ

#### ECharts é…ç½®
```javascript
// src/utils/chart-utils.js
export const chartConfigs = {
  // è€ƒå‹¤è¶‹åŠ¿æŠ˜çº¿å›¾
  trendChart: {
    title: {
      text: 'è€ƒå‹¤è¶‹åŠ¿',
      left: 'center',
      textStyle: {
        color: '#333',
        fontSize: 16,
        fontWeight: 'normal'
      }
    },
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'cross'
      }
    },
    legend: {
      data: ['å‡ºå‹¤äººæ•°', 'è¿Ÿåˆ°äººæ•°', 'æ—©é€€äººæ•°'],
      bottom: 0
    },
    xAxis: {
      type: 'category',
      data: []
    },
    yAxis: {
      type: 'value'
    },
    series: [
      {
        name: 'å‡ºå‹¤äººæ•°',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#52c41a' }
      },
      {
        name: 'è¿Ÿåˆ°äººæ•°',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#faad14' }
      },
      {
        name: 'æ—©é€€äººæ•°',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#ff4d4f' }
      }
    ]
  },

  // éƒ¨é—¨è€ƒå‹¤çƒ­åŠ›å›¾
  heatmapChart: {
    title: {
      text: 'éƒ¨é—¨è€ƒå‹¤çƒ­åŠ›å›¾',
      left: 'center'
    },
    tooltip: {
      position: 'top',
      formatter: function (params) {
        return `${params.name}<br/>è€ƒå‹¤ç‡: ${params.value[2]}%`;
      }
    },
    grid: {
      height: '60%',
      top: '10%'
    },
    xAxis: {
      type: 'category',
      data: [],
      splitArea: {
        show: true
      }
    },
    yAxis: {
      type: 'category',
      data: [],
      splitArea: {
        show: true
      }
    },
    visualMap: {
      min: 0,
      max: 100,
      calculable: true,
      orient: 'horizontal',
      left: 'center',
      bottom: '5%',
      inRange: {
        color: ['#ebedf0', '#c6e48b', '#7bc96f', '#239a3b', '#196127']
      }
    },
    series: [{
      name: 'è€ƒå‹¤ç‡',
      type: 'heatmap',
      data: [],
      label: {
        show: true,
        formatter: function (params) {
          return params.value[2] + '%';
        }
      },
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }]
  }
};
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ¦‚è§ˆå¡ç‰‡ç»„ä»¶

```vue
<!-- src/views/business/attendance/dashboard/components/OverviewCards.vue -->
<template>
  <div class="overview-cards">
    <a-row :gutter="16">
      <a-col :span="6" v-for="(card, index) in cards" :key="index">
        <a-card :bordered="false" class="overview-card">
          <a-statistic
            :title="card.title"
            :value="card.value"
            :precision="card.precision || 0"
            :value-style="{ color: card.color }"
            :prefix="card.prefix"
          >
            <template #suffix>
              <span class="suffix-text">{{ card.suffix }}</span>
            </template>
          </a-statistic>

          <div class="card-trend" v-if="card.trend">
            <component :is="card.trend > 0 ? 'ArrowUpOutlined' : 'ArrowDownOutlined'"
                      :style="{ color: card.trend > 0 ? '#52c41a' : '#ff4d4f' }" />
            <span>{{ Math.abs(card.trend) }}%</span>
            <span class="trend-text">è¾ƒæ˜¨æ—¥</span>
          </div>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons-vue';

const props = defineProps({
  overviewData: {
    type: Object,
    default: () => ({})
  }
});

const cards = computed(() => [
  {
    title: 'ä»Šæ—¥å‡ºå‹¤',
    value: props.overviewData.todayAttendance || 0,
    suffix: 'äºº',
    color: '#52c41a',
    prefix: 'UserOutlined',
    trend: props.overviewData.todayTrend || 0
  },
  {
    title: 'æœ¬å‘¨å‡ºå‹¤',
    value: props.overviewData.weekAttendance || 0,
    suffix: 'äºº',
    color: '#1890ff',
    prefix: 'CalendarOutlined',
    trend: props.overviewData.weekTrend || 0
  },
  {
    title: 'å¼‚å¸¸é¢„è­¦',
    value: props.overviewData.exceptionCount || 0,
    suffix: 'é¡¹',
    color: '#faad14',
    prefix: 'WarningOutlined',
    trend: props.overviewData.exceptionTrend || 0
  },
  {
    title: 'å¾…åŠäº‹é¡¹',
    value: props.overviewData.pendingCount || 0,
    suffix: 'é¡¹',
    color: '#ff4d4f',
    prefix: 'ClockCircleOutlined',
    trend: props.overviewData.pendingTrend || 0
  }
]);
</script>

<style scoped lang="less">
.overview-cards {
  margin-bottom: 24px;

  .overview-card {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s;

    &:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    .card-trend {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;

      .trend-text {
        color: #999;
      }
    }

    .suffix-text {
      font-size: 14px;
      color: #666;
      margin-left: 4px;
    }
  }
}
</style>
```

### 2. è€ƒå‹¤è¶‹åŠ¿å›¾è¡¨ç»„ä»¶

```vue
<!-- src/views/business/attendance/dashboard/components/AttendanceChart.vue -->
<template>
  <div class="attendance-chart">
    <a-card :bordered="false" title="è€ƒå‹¤è¶‹åŠ¿åˆ†æ">
      <template #extra>
        <a-radio-group v-model:value="timeRange" size="small" @change="handleTimeRangeChange">
          <a-radio-button value="7">è¿‘7å¤©</a-radio-button>
          <a-radio-button value="30">è¿‘30å¤©</a-radio-button>
          <a-radio-button value="90">è¿‘90å¤©</a-radio-button>
        </a-radio-group>
      </template>

      <div ref="chartRef" class="chart-container" v-loading="loading"></div>
    </a-card>
  </div>
</template>

<script setup>
import { ref, onMounted, watch, nextTick } from 'vue';
import * as echarts from 'echarts';
import { chartConfigs } from '/@/utils/chart-utils';
import { dashboardApi } from '/@/api/business/attendance/dashboard-api';

const props = defineProps({
  refreshTrigger: {
    type: Number,
    default: 0
  }
});

const chartRef = ref(null);
const loading = ref(false);
const timeRange = ref('7');
let chartInstance = null;

const initChart = () => {
  if (chartRef.value) {
    chartInstance = echarts.init(chartRef.value);
    const option = JSON.parse(JSON.stringify(chartConfigs.trendChart));
    chartInstance.setOption(option);
  }
};

const loadTrendData = async () => {
  loading.value = true;
  try {
    const response = await dashboardApi.getAttendanceTrend({ days: timeRange.value });
    const data = response.data;

    if (chartInstance) {
      chartInstance.setOption({
        xAxis: {
          data: data.dates
        },
        series: [
          { data: data.attendance },
          { data: data.late },
          { data: data.earlyLeave }
        ]
      });
    }
  } catch (error) {
    console.error('åŠ è½½è¶‹åŠ¿æ•°æ®å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

const handleTimeRangeChange = () => {
  loadTrendData();
};

const resizeChart = () => {
  if (chartInstance) {
    chartInstance.resize();
  }
};

onMounted(() => {
  nextTick(() => {
    initChart();
    loadTrendData();
    window.addEventListener('resize', resizeChart);
  });
});

watch(() => props.refreshTrigger, () => {
  loadTrendData();
});

// æ¸…ç†
onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
  }
  window.removeEventListener('resize', resizeChart);
});
</script>

<style scoped lang="less">
.attendance-chart {
  .chart-container {
    height: 300px;
    width: 100%;
  }
}
</style>
```

### 3. å¿«é€Ÿæ“ä½œç»„ä»¶

```vue
<!-- src/views/business/attendance/dashboard/components/QuickActions.vue -->
<template>
  <div class="quick-actions">
    <a-card :bordered="false" title="å¿«é€Ÿæ“ä½œ">
      <div class="actions-grid">
        <div
          v-for="action in availableActions"
          :key="action.key"
          class="action-item"
          @click="handleActionClick(action)"
        >
          <div class="action-icon">
            <component :is="action.icon" />
          </div>
          <div class="action-title">{{ action.title }}</div>
        </div>
      </div>
    </a-card>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { useRouter } from 'vue-router';
import {
  EnvironmentOutlined,
  FormOutlined,
  CalendarOutlined,
  BarChartOutlined,
  SettingOutlined,
  NotificationOutlined
} from '@ant-design/icons-vue';

const router = useRouter();
const props = defineProps({
  userRole: {
    type: String,
    default: 'employee'
  }
});

const allActions = [
  {
    key: 'clock',
    title: 'æ‰“å¡',
    icon: 'EnvironmentOutlined',
    path: '/attendance/clock',
    roles: ['employee', 'manager', 'hr', 'admin']
  },
  {
    key: 'apply',
    title: 'ç”³è¯·',
    icon: 'FormOutlined',
    path: '/attendance/apply',
    roles: ['employee', 'manager', 'hr', 'admin']
  },
  {
    key: 'schedule',
    title: 'æ’ç­',
    icon: 'CalendarOutlined',
    path: '/attendance/schedule',
    roles: ['manager', 'hr', 'admin']
  },
  {
    key: 'report',
    title: 'æŠ¥è¡¨',
    icon: 'BarChartOutlined',
    path: '/attendance/report',
    roles: ['manager', 'hr', 'admin']
  },
  {
    key: 'settings',
    title: 'è®¾ç½®',
    icon: 'SettingOutlined',
    path: '/attendance/settings',
    roles: ['hr', 'admin']
  },
  {
    key: 'notification',
    title: 'é€šçŸ¥',
    icon: 'NotificationOutlined',
    path: '/attendance/notification',
    roles: ['employee', 'manager', 'hr', 'admin']
  }
];

const availableActions = computed(() => {
  return allActions.filter(action => action.roles.includes(props.userRole));
});

const handleActionClick = (action) => {
  router.push(action.path);
};
</script>

<style scoped lang="less">
.quick-actions {
  .actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 16px;

    .action-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      border-radius: 8px;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.3s;

      &:hover {
        background: #e6f7ff;
        transform: translateY(-2px);
      }

      .action-icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: #1890ff;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;

        .anticon {
          font-size: 24px;
          color: #fff;
        }
      }

      .action-title {
        font-size: 14px;
        color: #333;
        font-weight: 500;
      }
    }
  }
}
</style>
```

### 4. ä¸»é¡µé¢é›†æˆ

```vue
<!-- src/views/business/attendance/dashboard/index.vue -->
<template>
  <div class="dashboard-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
      <h1>ä»ªè¡¨ä¸­å¿ƒ</h1>
      <div class="header-actions">
        <a-button @click="handleRefresh" :loading="refreshing">
          <template #icon><ReloadOutlined /></template>
          åˆ·æ–°æ•°æ®
        </a-button>
        <a-button type="primary" @click="handleExport">
          <template #icon><DownloadOutlined /></template>
          å¯¼å‡ºæŠ¥è¡¨
        </a-button>
      </div>
    </div>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <a-tabs v-model:activeKey="activeTab" @change="handleTabChange">
      <a-tab-pane key="overview" tab="é¦–é¡µæ¦‚è§ˆ">
        <OverviewCards :overview-data="overviewData" />
        <a-row :gutter="16">
          <a-col :span="16">
            <AttendanceChart :refresh-trigger="refreshTrigger" />
          </a-col>
          <a-col :span="8">
            <HeatmapChart :heatmap-data="heatmapData" />
          </a-col>
        </a-row>
        <QuickActions :user-role="userRole" />
      </a-tab-pane>

      <a-tab-pane key="personal" tab="ä¸ªäººçœ‹æ¿" v-if="showPersonalTab">
        <PersonalDashboard :user-id="currentUserId" />
      </a-tab-pane>

      <a-tab-pane key="department" tab="éƒ¨é—¨çœ‹æ¿" v-if="showDepartmentTab">
        <DepartmentDashboard :dept-id="currentDeptId" />
      </a-tab-pane>

      <a-tab-pane key="enterprise" tab="ä¼ä¸šçœ‹æ¿" v-if="showEnterpriseTab">
        <EnterpriseDashboard />
      </a-tab-pane>
    </a-tabs>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';
import { useStore } from 'pinia';
import { message } from 'ant-design-vue';
import { ReloadOutlined, DownloadOutlined } from '@ant-design/icons-vue';
import OverviewCards from './components/OverviewCards.vue';
import AttendanceChart from './components/AttendanceChart.vue';
import HeatmapChart from './components/HeatmapChart.vue';
import QuickActions from './components/QuickActions.vue';
import PersonalDashboard from './components/PersonalDashboard.vue';
import DepartmentDashboard from './components/DepartmentDashboard.vue';
import EnterpriseDashboard from './components/EnterpriseDashboard.vue';
import { dashboardApi } from '/@/api/business/attendance/dashboard-api';

const store = useStore();
const activeTab = ref('overview');
const refreshing = ref(false);
const refreshTrigger = ref(0);
const overviewData = ref({});
const heatmapData = ref({});

// ç”¨æˆ·ä¿¡æ¯
const currentUserId = computed(() => store.state.user.userId);
const userRole = computed(() => store.state.user.role);
const currentDeptId = computed(() => store.state.user.deptId);

// æ ‡ç­¾é¡µæƒé™æ§åˆ¶
const showPersonalTab = computed(() => true); // æ‰€æœ‰ç”¨æˆ·éƒ½å¯æŸ¥çœ‹
const showDepartmentTab = computed(() => ['manager', 'hr', 'admin'].includes(userRole.value));
const showEnterpriseTab = computed(() => ['hr', 'admin'].includes(userRole.value));

// åŠ è½½æ¦‚è§ˆæ•°æ®
const loadOverviewData = async () => {
  try {
    const response = await dashboardApi.getOverviewData();
    overviewData.value = response.data;
  } catch (error) {
    console.error('åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥:', error);
    message.error('åŠ è½½æ¦‚è§ˆæ•°æ®å¤±è´¥');
  }
};

// åŠ è½½çƒ­åŠ›å›¾æ•°æ®
const loadHeatmapData = async () => {
  try {
    const response = await dashboardApi.getDepartmentHeatmap();
    heatmapData.value = response.data;
  } catch (error) {
    console.error('åŠ è½½çƒ­åŠ›å›¾æ•°æ®å¤±è´¥:', error);
  }
};

// åˆ·æ–°æ•°æ®
const handleRefresh = async () => {
  refreshing.value = true;
  try {
    await Promise.all([
      loadOverviewData(),
      loadHeatmapData()
    ]);
    refreshTrigger.value += 1;
    message.success('æ•°æ®åˆ·æ–°æˆåŠŸ');
  } catch (error) {
    message.error('æ•°æ®åˆ·æ–°å¤±è´¥');
  } finally {
    refreshing.value = false;
  }
};

// å¯¼å‡ºæŠ¥è¡¨
const handleExport = () => {
  message.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
};

// æ ‡ç­¾é¡µåˆ‡æ¢
const handleTabChange = (key) => {
  console.log('åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ:', key);
};

onMounted(() => {
  loadOverviewData();
  loadHeatmapData();
});
</script>

<style scoped lang="less">
.dashboard-page {
  padding: 24px;
  background: #f0f2f5;
  min-height: 100vh;

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;

    h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      color: #262626;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }
  }

  :deep(.ant-tabs-content-holder) {
    background: #fff;
    border-radius: 8px;
    padding: 24px;
  }

  :deep(.ant-tabs-nav) {
    background: #fff;
    border-radius: 8px 8px 0 0;
    padding: 0 24px;
  }
}
</style>
```

## Mockæ•°æ®ç¤ºä¾‹

```javascript
// src/mock/dashboard-mock.js
export const mockOverviewData = {
  todayAttendance: 1234,
  weekAttendance: 6156,
  exceptionCount: 23,
  pendingCount: 8,
  todayTrend: 2.5,
  weekTrend: -1.2,
  exceptionTrend: 15.3,
  pendingTrend: -8.7,
  totalEmployees: 1500,
  presentEmployees: 1234
};

export const mockTrendData = {
  dates: ['2024-01-08', '2024-01-09', '2024-01-10', '2024-01-11', '2024-01-12', '2024-01-13', '2024-01-14'],
  attendance: [1200, 1234, 1198, 1245, 1220, 1180, 1234],
  late: [45, 38, 52, 41, 48, 55, 42],
  earlyLeave: [23, 18, 28, 15, 20, 32, 19]
};

export const mockHeatmapData = [
  [0, 0, 95.2], [0, 1, 88.7], [0, 2, 92.1], [0, 3, 85.3], [0, 4, 90.8],
  [1, 0, 91.5], [1, 1, 89.2], [1, 2, 94.6], [1, 3, 87.9], [1, 4, 92.3],
  [2, 0, 88.3], [2, 1, 91.7], [2, 2, 86.5], [2, 3, 93.2], [2, 4, 89.8],
  [3, 0, 94.1], [3, 1, 87.6], [3, 2, 90.4], [3, 3, 88.9], [3, 4, 91.3],
  [4, 0, 89.7], [4, 1, 92.8], [4, 2, 85.9], [4, 3, 90.1], [4, 4, 87.4]
];

export default {
  mockOverviewData,
  mockTrendData,
  mockHeatmapData
};
```

## è·¯ç”±é…ç½®

```javascript
// src/router/business/attendance.js
export const attendanceRouters = [
  {
    path: '/business/attendance/dashboard',
    name: 'AttendanceDashboard',
    component: () => import('/@/views/business/attendance/dashboard/index.vue'),
    meta: {
      title: 'è€ƒå‹¤ç®¡ç† - ä»ªè¡¨ä¸­å¿ƒ',
      menuType: MENU_TYPE_ENUM.MENU.value,
      icon: 'DashboardOutlined',
      hideInMenu: false,
      keepAlive: true,
      requireAuth: true
    }
  }
];
```

## å¼€å‘æ³¨æ„äº‹é¡¹æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½è¦ç‚¹
1. **å¤šå±‚çº§çœ‹æ¿** - ä¸ªäººã€éƒ¨é—¨ã€ä¼ä¸šä¸‰ä¸ªå±‚çº§çš„æ•°æ®å±•ç¤º
2. **å®æ—¶æ•°æ®æ›´æ–°** - æ”¯æŒè‡ªåŠ¨åˆ·æ–°å’Œæ‰‹åŠ¨åˆ·æ–°
3. **å¯è§†åŒ–å›¾è¡¨** - è¶‹åŠ¿å›¾ã€çƒ­åŠ›å›¾ç­‰å¤šç§å›¾è¡¨å±•ç¤º
4. **å¿«é€Ÿæ“ä½œå…¥å£** - å¸¸ç”¨åŠŸèƒ½çš„å¿«æ·è®¿é—®
5. **æƒé™æ§åˆ¶** - ä¸åŒè§’è‰²æ˜¾ç¤ºä¸åŒåŠŸèƒ½æ¨¡å—
6. **å“åº”å¼è®¾è®¡** - é€‚é…ä¸åŒå±å¹•å°ºå¯¸

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµæ§åˆ¶åˆ·æ–°é¢‘ç‡
2. å›¾è¡¨æ•°æ®æ‡’åŠ è½½ï¼Œé¿å…åŒæ—¶åŠ è½½è¿‡å¤šæ•°æ®
3. åˆç†ä½¿ç”¨ç¼“å­˜ï¼Œå‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨
4. ç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Œä¼˜åŒ–é¦–å±åŠ è½½é€Ÿåº¦

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. æä¾›æ¸…æ™°çš„æ•°æ®è¶‹åŠ¿å±•ç¤º
2. å‹å¥½çš„åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º
3. æ”¯æŒæ•°æ®å¯¼å‡ºåŠŸèƒ½
4. å¿«é€Ÿæ“ä½œå…¥å£ä¸€ç›®äº†ç„¶

## æ€»ç»“

ä»ªè¡¨ä¸­å¿ƒä½œä¸ºè€ƒå‹¤ç³»ç»Ÿçš„æ ¸å¿ƒå±•ç¤ºç•Œé¢ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š

- æ•°æ®çš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§
- å¯è§†åŒ–æ•ˆæœçš„ç›´è§‚æ€§
- æ“ä½œçš„ä¾¿æ·æ€§
- æƒé™æ§åˆ¶çš„ç²¾ç¡®æ€§
- å“åº”å¼å¸ƒå±€çš„é€‚é…æ€§

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æŠ€æœ¯è§„èŒƒï¼Œå¯ä»¥å¼€å‘å‡ºåŠŸèƒ½å®Œå–„ã€æ€§èƒ½ä¼˜è‰¯çš„ä»ªè¡¨ä¸­å¿ƒæ¨¡å—ã€‚