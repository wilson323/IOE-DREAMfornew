# è€ƒå‹¤ç®¡ç†åŠŸèƒ½å¸ƒå±€æ–‡æ¡£ - å®Œæ•´ç‰ˆ

## åŠŸèƒ½æ¦‚è¿°

è€ƒå‹¤ç®¡ç†æ¨¡å—æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œè´Ÿè´£ç®¡ç†è€ƒå‹¤åŒºåŸŸã€è®¾å¤‡é…ç½®ã€è®¾å¤‡ç›‘æ§ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—æä¾›å®Œæ•´çš„è€ƒå‹¤è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬è®¾å¤‡æ³¨å†Œã€é…ç½®ã€ç›‘æ§ã€ç»´æŠ¤ç­‰ï¼Œæ”¯æŒå¤šç§è€ƒå‹¤æ–¹å¼ï¼ˆäººè„¸è¯†åˆ«ã€æŒ‡çº¹ã€ICå¡ã€äºŒç»´ç ã€GPSç­‰ï¼‰ï¼Œç¡®ä¿è€ƒå‹¤æ•°æ®çš„å‡†ç¡®é‡‡é›†å’Œå®æ—¶ç›‘æ§ã€‚

## æŠ€æœ¯æ¶æ„è§„èŒƒ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶**: Vue 3.4.27 (Composition API)
- **UIç»„ä»¶åº“**: Ant Design Vue 4.2.5
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1.7
- **è·¯ç”±ç®¡ç†**: Vue Router 4.3.2
- **HTTPå®¢æˆ·ç«¯**: Axios 1.6.8
- **WebSocket**: Socket.io-client 4.x (å®æ—¶ç›‘æ§)
- **åœ°å›¾ç»„ä»¶**: é«˜å¾·åœ°å›¾/ç™¾åº¦åœ°å›¾
- **æ ·å¼é¢„å¤„ç†å™¨**: Less 4.2.0
- **å›¾æ ‡åº“**: @ant-design/icons-vue

### é¡¹ç›®æ–‡ä»¶ç»„ç»‡ç»“æ„
```
src/views/business/attendance/management/
â”œâ”€â”€ index.vue                        # è€ƒå‹¤ç®¡ç†ä¸»é¡µé¢
â”œâ”€â”€ area/
â”‚   â”œâ”€â”€ index.vue                   # è€ƒå‹¤åŒºåŸŸç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AreaMap.vue            # åŒºåŸŸåœ°å›¾ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AreaForm.vue           # åŒºåŸŸè¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AreaPermission.vue     # åŒºåŸŸæƒé™ç»„ä»¶
â”‚   â”‚   â””â”€â”€ AreaMonitor.vue        # åŒºåŸŸç›‘æ§ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ area-api.js             # åŒºåŸŸç®¡ç†API
â”œâ”€â”€ device/
â”‚   â”œâ”€â”€ index.vue                   # è®¾å¤‡ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ DeviceTable.vue        # è®¾å¤‡è¡¨æ ¼ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DeviceForm.vue         # è®¾å¤‡è¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DeviceConfig.vue       # è®¾å¤‡é…ç½®ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DeviceAssociate.vue    # è®¾å¤‡å…³è”ç»„ä»¶
â”‚   â”‚   â””â”€â”€ DeviceMaintenance.vue  # è®¾å¤‡ç»´æŠ¤ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ device-api.js           # è®¾å¤‡ç®¡ç†API
â”œâ”€â”€ monitor/
â”‚   â”œâ”€â”€ index.vue                   # è®¾å¤‡ç›‘æ§é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ RealTimeMonitor.vue    # å®æ—¶ç›‘æ§ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DeviceStatus.vue       # è®¾å¤‡çŠ¶æ€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AlertList.vue          # å‘Šè­¦åˆ—è¡¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ MonitoringChart.vue    # ç›‘æ§å›¾è¡¨ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ monitor-api.js          # ç›‘æ§API
â”œâ”€â”€ mock/
â”‚   â””â”€â”€ management-mock.js          # æ¨¡æ‹Ÿæ•°æ®
â”œâ”€â”€ api/
â”‚   â””â”€â”€ management-api.js            # ç»Ÿä¸€APIæ¥å£
â””â”€â”€ utils/
    â”œâ”€â”€ map-utils.js                # åœ°å›¾å·¥å…·å‡½æ•°
    â”œâ”€â”€ device-utils.js             # è®¾å¤‡å·¥å…·å‡½æ•°
    â””â”€â”€ websocket-manager.js        # WebSocketç®¡ç†
```

### APIæ¥å£è®¾è®¡
```javascript
// src/api/business/attendance/management/area-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const areaApi = {
  // åŒºåŸŸç®¡ç†
  getAreaList: (params) => getRequest('/attendance/area/list', params),
  getAreaById: (id) => getRequest(`/attendance/area/${id}`),
  createArea: (params) => postRequest('/attendance/area/create', params),
  updateArea: (id, params) => putRequest(`/attendance/area/update/${id}`, params),
  deleteArea: (id) => deleteRequest(`/attendance/area/delete/${id}`),

  // åŒºåŸŸæƒé™
  getAreaPermissions: (areaId) => getRequest(`/attendance/area/${areaId}/permissions`),
  updateAreaPermissions: (areaId, params) => putRequest(`/attendance/area/${areaId}/permissions`, params),

  // åŒºåŸŸç›‘æ§
  getAreaMonitoringData: (areaId) => getRequest(`/attendance/area/${areaId}/monitoring`),
  getAreaAttendanceRecords: (areaId, params) => getRequest(`/attendance/area/${areaId}/records`, params),
};

// src/api/business/attendance/management/device-api.js
export const deviceApi = {
  // è®¾å¤‡ç®¡ç†
  getDeviceList: (params) => getRequest('/attendance/device/list', params),
  getDeviceById: (id) => getRequest(`/attendance/device/${id}`),
  createDevice: (params) => postRequest('/attendance/device/create', params),
  updateDevice: (id, params) => putRequest(`/attendance/device/update/${id}`, params),
  deleteDevice: (id) => deleteRequest(`/attendance/device/delete/${id}`),

  // è®¾å¤‡é…ç½®
  getDeviceConfig: (deviceId) => getRequest(`/attendance/device/${deviceId}/config`),
  updateDeviceConfig: (deviceId, params) => putRequest(`/attendance/device/${deviceId}/config`, params),

  // è®¾å¤‡å…³è”
  getDeviceAssociations: (deviceId) => getRequest(`/attendance/device/${deviceId}/associations`),
  updateDeviceAssociations: (deviceId, params) => putRequest(`/attendance/device/${deviceId}/associations`, params),

  // è®¾å¤‡ç»´æŠ¤
  getDeviceMaintenanceRecords: (deviceId, params) => getRequest(`/attendance/device/${deviceId}/maintenance`, params),
  createMaintenanceRecord: (deviceId, params) => postRequest(`/attendance/device/${deviceId}/maintenance`, params),

  // è®¾å¤‡æ“ä½œ
  restartDevice: (deviceId) => postRequest(`/attendance/device/${deviceId}/restart`),
  syncDeviceTime: (deviceId) => postRequest(`/attendance/device/${deviceId}/sync-time`),
  testDevice: (deviceId) => postRequest(`/attendance/device/${deviceId}/test`),
};

// src/api/business/attendance/management/monitor-api.js
export const monitorApi = {
  // å®æ—¶ç›‘æ§
  getRealTimeStatus: () => getRequest('/attendance/monitor/realtime'),
  getDeviceStatusList: (params) => getRequest('/attendance/monitor/device-status', params),

  // å‘Šè­¦ç®¡ç†
  getAlertList: (params) => getRequest('/attendance/monitor/alerts', params),
  updateAlertStatus: (alertId, status) => putRequest(`/attendance/monitor/alerts/${alertId}/status`, { status }),

  // ç»Ÿè®¡æ•°æ®
  getMonitoringStatistics: (params) => getRequest('/attendance/monitor/statistics', params),
  getDeviceUptimeReport: (params) => getRequest('/attendance/monitor/uptime-report', params),
};
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 1. è€ƒå‹¤åŒºåŸŸç®¡ç†
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

#### åŒºåŸŸåœ°å›¾ç»„ä»¶
```vue
<!-- src/views/business/attendance/management/area/components/AreaMap.vue -->
<template>
  <div class="area-map">
    <div class="map-header">
      <h3>è€ƒå‹¤åŒºåŸŸåœ°å›¾</h3>
      <div class="map-controls">
        <a-button-group size="small">
          <a-button :type="mapMode === 'view' ? 'primary' : 'default'" @click="setMapMode('view')">
            <template #icon><EyeOutlined /></template>
            æŸ¥çœ‹
          </a-button>
          <a-button :type="mapMode === 'edit' ? 'primary' : 'default'" @click="setMapMode('edit')">
            <template #icon><EditOutlined /></template>
            ç¼–è¾‘
          </a-button>
        </a-button-group>
        <a-button size="small" @click="centerMap">
          <template #icon><AimOutlined /></template>
          å±…ä¸­
        </a-button>
      </div>
    </div>

    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="areaMapContainer" class="map-container"></div>

    <!-- åŒºåŸŸä¿¡æ¯é¢æ¿ -->
    <div class="area-info-panel" v-if="selectedArea">
      <a-card size="small" :title="selectedArea.name">
        <template #extra>
          <a-button type="text" size="small" @click="clearSelection">
            <template #icon><CloseOutlined /></template>
          </a-button>
        </template>

        <div class="area-details">
          <div class="detail-item">
            <span class="label">åŒºåŸŸç±»å‹:</span>
            <span class="value">{{ getAreaTypeText(selectedArea.type) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">è¦†ç›–èŒƒå›´:</span>
            <span class="value">{{ selectedArea.radius }}ç±³</span>
          </div>
          <div class="detail-item">
            <span class="label">å…³è”è®¾å¤‡:</span>
            <span class="value">{{ selectedArea.deviceCount }}å°</span>
          </div>
          <div class="detail-item">
            <span class="label">çŠ¶æ€:</span>
            <a-badge :status="selectedArea.status === 'active' ? 'success' : 'error'"
                     :text="selectedArea.status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨'" />
          </div>
        </div>

        <div class="area-actions">
          <a-button type="primary" size="small" @click="handleEditArea">
            <template #icon><EditOutlined /></template>
            ç¼–è¾‘
          </a-button>
          <a-button size="small" @click="handleViewDevices">
            <template #icon><DesktopOutlined /></template>
            æŸ¥çœ‹è®¾å¤‡
          </a-button>
        </div>
      </a-card>
    </div>

    <!-- æ·»åŠ åŒºåŸŸæµ®çª— -->
    <div class="add-area-float" v-if="mapMode === 'edit'">
      <a-button type="primary" shape="circle" size="large" @click="showAddAreaModal">
        <template #icon><PlusOutlined /></template>
      </a-button>
      <div class="float-tip">ç‚¹å‡»åœ°å›¾æ·»åŠ åŒºåŸŸ</div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted, nextTick } from 'vue';
import { message } from 'ant-design-vue';
import {
  EyeOutlined,
  EditOutlined,
  AimOutlined,
  CloseOutlined,
  DesktopOutlined,
  PlusOutlined
} from '@ant-design/icons-vue';
import { areaApi } from '/@/api/business/attendance/management/area-api';

const emit = defineEmits(['area-select', 'area-edit', 'area-add', 'view-devices']);

const mapMode = ref('view');
const selectedArea = ref(null);
let map = null;
let markers = [];
let circles = [];

// åˆå§‹åŒ–åœ°å›¾
const initMap = () => {
  nextTick(() => {
    // è¿™é‡Œä»¥é«˜å¾·åœ°å›¾ä¸ºä¾‹
    map = new AMap.Map('areaMapContainer', {
      zoom: 15,
      center: [116.397428, 39.90923], // åŒ—äº¬å¤©å®‰é—¨
      mapStyle: 'amap://styles/normal'
    });

    // æ·»åŠ åœ°å›¾ç‚¹å‡»äº‹ä»¶
    if (mapMode.value === 'edit') {
      map.on('click', handleMapClick);
    }

    // åŠ è½½åŒºåŸŸæ•°æ®
    loadAreas();
  });
};

// åŠ è½½åŒºåŸŸæ•°æ®
const loadAreas = async () => {
  try {
    const response = await areaApi.getAreaList();
    response.data.forEach(area => {
      addAreaToMap(area);
    });
  } catch (error) {
    console.error('åŠ è½½åŒºåŸŸæ•°æ®å¤±è´¥:', error);
  }
};

// æ·»åŠ åŒºåŸŸåˆ°åœ°å›¾
const addAreaToMap = (area) => {
  // åˆ›å»ºæ ‡è®°ç‚¹
  const marker = new AMap.Marker({
    position: [area.longitude, area.latitude],
    title: area.name,
    icon: new AMap.Icon({
      image: getAreaIcon(area.type),
      size: new AMap.Size(32, 32)
    })
  });

  // åˆ›å»ºåœ†å½¢è¦†ç›–åŒºåŸŸ
  const circle = new AMap.Circle({
    center: [area.longitude, area.latitude],
    radius: area.radius,
    strokeColor: area.status === 'active' ? '#52c41a' : '#ff4d4f',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: area.status === 'active' ? '#52c41a' : '#ff4d4f',
    fillOpacity: 0.2
  });

  // æ·»åŠ ç‚¹å‡»äº‹ä»¶
  marker.on('click', () => {
    selectArea(area);
  });

  map.add(marker);
  map.add(circle);

  markers.push(marker);
  circles.push(circle);
};

// é€‰æ‹©åŒºåŸŸ
const selectArea = (area) => {
  selectedArea.value = area;
  emit('area-select', area);
};

// æ¸…é™¤é€‰æ‹©
const clearSelection = () => {
  selectedArea.value = null;
};

// åœ°å›¾ç‚¹å‡»äº‹ä»¶
const handleMapClick = (e) => {
  if (mapMode.value === 'edit') {
    const lnglat = e.lnglat;
    emit('area-add', {
      longitude: lnglat.lng,
      latitude: lnglat.lat
    });
  }
};

// è®¾ç½®åœ°å›¾æ¨¡å¼
const setMapMode = (mode) => {
  mapMode.value = mode;
  if (map) {
    if (mode === 'edit') {
      map.on('click', handleMapClick);
    } else {
      map.off('click', handleMapClick);
    }
  }
};

// å±…ä¸­åœ°å›¾
const centerMap = () => {
  if (map && selectedArea.value) {
    map.setCenter([selectedArea.value.longitude, selectedArea.value.latitude]);
  }
};

// è·å–åŒºåŸŸå›¾æ ‡
const getAreaIcon = (type) => {
  const iconMap = {
    'office': '/images/area-office.png',
    'factory': '/images/area-factory.png',
    'warehouse': '/images/area-warehouse.png',
    'outdoor': '/images/area-outdoor.png'
  };
  return iconMap[type] || '/images/area-default.png';
};

// è·å–åŒºåŸŸç±»å‹æ–‡æœ¬
const getAreaTypeText = (type) => {
  const typeMap = {
    'office': 'åŠå…¬åŒº',
    'factory': 'å·¥å‚',
    'warehouse': 'ä»“åº“',
    'outdoor': 'æˆ·å¤–'
  };
  return typeMap[type] || 'æœªçŸ¥';
};

// ç¼–è¾‘åŒºåŸŸ
const handleEditArea = () => {
  emit('area-edit', selectedArea.value);
};

// æŸ¥çœ‹è®¾å¤‡
const handleViewDevices = () => {
  emit('view-devices', selectedArea.value);
};

// æ˜¾ç¤ºæ·»åŠ åŒºåŸŸå¼¹çª—
const showAddAreaModal = () => {
  message.info('è¯·åœ¨åœ°å›¾ä¸Šç‚¹å‡»é€‰æ‹©ä½ç½®');
};

onMounted(() => {
  // åŠ è½½é«˜å¾·åœ°å›¾API
  if (window.AMap) {
    initMap();
  } else {
    const script = document.createElement('script');
    script.src = 'https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY';
    script.onload = initMap;
    document.head.appendChild(script);
  }
});

onUnmounted(() => {
  // æ¸…ç†åœ°å›¾èµ„æº
  if (map) {
    map.destroy();
  }
});
</script>

<style scoped lang="less">
.area-map {
  position: relative;
  height: 600px;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;

  .map-header {
    position: absolute;
    top: 16px;
    left: 16px;
    right: 16px;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 16px;
    border-radius: 8px;
    backdrop-filter: blur(10px);

    h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .map-controls {
      display: flex;
      gap: 8px;
    }
  }

  .map-container {
    width: 100%;
    height: 100%;
  }

  .area-info-panel {
    position: absolute;
    right: 16px;
    top: 80px;
    width: 280px;
    z-index: 100;

    .area-details {
      .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;

        .label {
          color: #666;
          font-size: 14px;
        }

        .value {
          font-weight: 500;
          font-size: 14px;
        }
      }
    }

    .area-actions {
      margin-top: 12px;
      display: flex;
      gap: 8px;
    }
  }

  .add-area-float {
    position: absolute;
    bottom: 24px;
    right: 24px;
    z-index: 100;
    text-align: center;

    .float-tip {
      margin-top: 8px;
      font-size: 12px;
      color: #666;
      background: rgba(255, 255, 255, 0.9);
      padding: 4px 8px;
      border-radius: 4px;
    }
  }
}
</style>
```

### 2. è®¾å¤‡ç®¡ç†

#### è®¾å¤‡è¡¨æ ¼ç»„ä»¶
```vue
<!-- src/views/business/attendance/management/device/components/DeviceTable.vue -->
<template>
  <div class="device-table">
    <!-- æœç´¢å·¥å…·æ  -->
    <div class="table-toolbar">
      <a-form layout="inline" :model="searchForm" @finish="handleSearch">
        <a-form-item label="è®¾å¤‡åç§°">
          <a-input v-model:value="searchForm.name" placeholder="è¯·è¾“å…¥è®¾å¤‡åç§°" allow-clear />
        </a-form-item>
        <a-form-item label="è®¾å¤‡ç¼–å·">
          <a-input v-model:value="searchForm.deviceNo" placeholder="è¯·è¾“å…¥è®¾å¤‡ç¼–å·" allow-clear />
        </a-form-item>
        <a-form-item label="è®¾å¤‡ç±»å‹">
          <a-select v-model:value="searchForm.type" placeholder="è¯·é€‰æ‹©è®¾å¤‡ç±»å‹" allow-clear>
            <a-select-option value="fingerprint">æŒ‡çº¹æœº</a-select-option>
            <a-select-option value="face">äººè„¸è¯†åˆ«</a-select-option>
            <a-select-option value="ic">ICå¡æœº</a-select-option>
            <a-select-option value="qr">äºŒç»´ç </a-select-option>
            <a-select-option value="mobile">ç§»åŠ¨ç«¯</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item label="çŠ¶æ€">
          <a-select v-model:value="searchForm.status" placeholder="è¯·é€‰æ‹©çŠ¶æ€" allow-clear>
            <a-select-option value="online">åœ¨çº¿</a-select-option>
            <a-select-option value="offline">ç¦»çº¿</a-select-option>
            <a-select-option value="maintenance">ç»´æŠ¤ä¸­</a-select-option>
            <a-select-option value="error">æ•…éšœ</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item>
          <a-button type="primary" html-type="submit" :loading="loading">
            <template #icon><SearchOutlined /></template>
            æœç´¢
          </a-button>
          <a-button @click="handleReset">
            <template #icon><ReloadOutlined /></template>
            é‡ç½®
          </a-button>
        </a-form-item>
      </a-form>
    </div>

    <!-- æ“ä½œå·¥å…·æ  -->
    <div class="table-actions">
      <div class="actions-left">
        <a-button type="primary" @click="handleAdd">
          <template #icon><PlusOutlined /></template>
          æ–°å¢è®¾å¤‡
        </a-button>
        <a-button @click="handleBatchImport">
          <template #icon><UploadOutlined /></template>
          æ‰¹é‡å¯¼å…¥
        </a-button>
        <a-button @click="handleBatchOperation" :disabled="selectedRowKeys.length === 0">
          <template #icon><AppstoreOutlined /></template>
          æ‰¹é‡æ“ä½œ
        </a-button>
      </div>
      <div class="actions-right">
        <a-button @click="handleRefresh" :loading="loading">
          <template #icon><ReloadOutlined /></template>
          åˆ·æ–°
        </a-button>
        <a-button @click="handleExport">
          <template #icon><ExportOutlined /></template>
          å¯¼å‡º
        </a-button>
      </div>
    </div>

    <!-- æ•°æ®è¡¨æ ¼ -->
    <a-table
      :columns="columns"
      :data-source="dataSource"
      :loading="loading"
      :pagination="pagination"
      :row-selection="rowSelection"
      row-key="id"
      @change="handleTableChange"
    >
      <template #bodyCell="{ column, record }">
        <template v-if="column.key === 'status'">
          <a-badge :status="getStatusBadge(record.status)" :text="getStatusText(record.status)" />
        </template>

        <template v-else-if="column.key === 'type'">
          <a-tag :color="getTypeColor(record.type)">{{ getTypeText(record.type) }}</a-tag>
        </template>

        <template v-else-if="column.key === 'lastOnline'">
          <span v-if="record.lastOnline">{{ formatDateTime(record.lastOnline) }}</span>
          <span v-else class="text-muted">ä»æœªåœ¨çº¿</span>
        </template>

        <template v-else-if="column.key === 'action'">
          <a-space>
            <a-button type="link" size="small" @click="handleView(record)">æŸ¥çœ‹</a-button>
            <a-button type="link" size="small" @click="handleEdit(record)">ç¼–è¾‘</a-button>
            <a-dropdown>
              <template #overlay>
                <a-menu @click="({ key }) => handleMenuClick(key, record)">
                  <a-menu-item key="config">
                    <SettingOutlined />
                    é…ç½®
                  </a-menu-item>
                  <a-menu-item key="associate">
                    <LinkOutlined />
                    å…³è”
                  </a-menu-item>
                  <a-menu-item key="maintenance">
                    <ToolOutlined />
                    ç»´æŠ¤
                  </a-menu-item>
                  <a-menu-divider />
                  <a-menu-item key="restart">
                    <ReloadOutlined />
                    é‡å¯
                  </a-menu-item>
                  <a-menu-item key="test">
                    <PlayCircleOutlined />
                    æµ‹è¯•
                  </a-menu-item>
                </a-menu>
              </template>
              <a-button type="link" size="small">
                æ›´å¤š <DownOutlined />
              </a-button>
            </a-dropdown>
          </a-space>
        </template>
      </template>
    </a-table>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  SearchOutlined,
  ReloadOutlined,
  PlusOutlined,
  UploadOutlined,
  AppstoreOutlined,
  ExportOutlined,
  SettingOutlined,
  LinkOutlined,
  ToolOutlined,
  PlayCircleOutlined,
  DownOutlined
} from '@ant-design/icons-vue';
import { deviceApi } from '/@/api/business/attendance/management/device-api';

const emit = defineEmits(['add', 'edit', 'view', 'config', 'associate', 'maintenance']);

const loading = ref(false);
const dataSource = ref([]);
const selectedRowKeys = ref([]);

const searchForm = reactive({
  name: '',
  deviceNo: '',
  type: '',
  status: '',
});

const pagination = reactive({
  current: 1,
  pageSize: 20,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `å…± ${total} æ¡è®°å½•`,
});

const columns = [
  {
    title: 'è®¾å¤‡åç§°',
    dataIndex: 'name',
    key: 'name',
    width: 150,
  },
  {
    title: 'è®¾å¤‡ç¼–å·',
    dataIndex: 'deviceNo',
    key: 'deviceNo',
    width: 120,
  },
  {
    title: 'è®¾å¤‡ç±»å‹',
    dataIndex: 'type',
    key: 'type',
    width: 100,
  },
  {
    title: 'æ‰€åœ¨åŒºåŸŸ',
    dataIndex: 'areaName',
    key: 'areaName',
    width: 120,
  },
  {
    title: 'IPåœ°å€',
    dataIndex: 'ipAddress',
    key: 'ipAddress',
    width: 120,
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    key: 'status',
    width: 80,
  },
  {
    title: 'æœ€ååœ¨çº¿',
    dataIndex: 'lastOnline',
    key: 'lastOnline',
    width: 150,
  },
  {
    title: 'æ“ä½œ',
    key: 'action',
    width: 200,
    fixed: 'right',
  },
];

const rowSelection = {
  selectedRowKeys: selectedRowKeys,
  onChange: (keys) => {
    selectedRowKeys.value = keys;
  },
};

// è·å–çŠ¶æ€å¾½æ ‡
const getStatusBadge = (status) => {
  const statusMap = {
    online: 'success',
    offline: 'default',
    maintenance: 'warning',
    error: 'error',
  };
  return statusMap[status] || 'default';
};

// è·å–çŠ¶æ€æ–‡æœ¬
const getStatusText = (status) => {
  const statusMap = {
    online: 'åœ¨çº¿',
    offline: 'ç¦»çº¿',
    maintenance: 'ç»´æŠ¤ä¸­',
    error: 'æ•…éšœ',
  };
  return statusMap[status] || 'æœªçŸ¥';
};

// è·å–ç±»å‹é¢œè‰²
const getTypeColor = (type) => {
  const colorMap = {
    fingerprint: 'blue',
    face: 'green',
    ic: 'orange',
    qr: 'purple',
    mobile: 'cyan',
  };
  return colorMap[type] || 'default';
};

// è·å–ç±»å‹æ–‡æœ¬
const getTypeText = (type) => {
  const typeMap = {
    fingerprint: 'æŒ‡çº¹æœº',
    face: 'äººè„¸è¯†åˆ«',
    ic: 'ICå¡æœº',
    qr: 'äºŒç»´ç ',
    mobile: 'ç§»åŠ¨ç«¯',
  };
  return typeMap[type] || 'æœªçŸ¥';
};

// æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
const formatDateTime = (dateTime) => {
  if (!dateTime) return '';
  return new Date(dateTime).toLocaleString('zh-CN');
};

// åŠ è½½è®¾å¤‡æ•°æ®
const loadDeviceData = async () => {
  loading.value = true;
  try {
    const params = {
      ...searchForm,
      page: pagination.current,
      pageSize: pagination.pageSize,
    };
    const response = await deviceApi.getDeviceList(params);
    dataSource.value = response.data.records;
    pagination.total = response.data.total;
  } catch (error) {
    console.error('åŠ è½½è®¾å¤‡æ•°æ®å¤±è´¥:', error);
    message.error('åŠ è½½è®¾å¤‡æ•°æ®å¤±è´¥');
  } finally {
    loading.value = false;
  }
};

// æœç´¢
const handleSearch = () => {
  pagination.current = 1;
  loadDeviceData();
};

// é‡ç½®
const handleReset = () => {
  Object.assign(searchForm, {
    name: '',
    deviceNo: '',
    type: '',
    status: '',
  });
  pagination.current = 1;
  loadDeviceData();
};

// è¡¨æ ¼å˜åŒ–
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadDeviceData();
};

// æ–°å¢è®¾å¤‡
const handleAdd = () => {
  emit('add');
};

// ç¼–è¾‘è®¾å¤‡
const handleEdit = (record) => {
  emit('edit', record);
};

// æŸ¥çœ‹è®¾å¤‡
const handleView = (record) => {
  emit('view', record);
};

// èœå•ç‚¹å‡»
const handleMenuClick = (key, record) => {
  switch (key) {
    case 'config':
      emit('config', record);
      break;
    case 'associate':
      emit('associate', record);
      break;
    case 'maintenance':
      emit('maintenance', record);
      break;
    case 'restart':
      handleRestart(record);
      break;
    case 'test':
      handleTest(record);
      break;
  }
};

// é‡å¯è®¾å¤‡
const handleRestart = (record) => {
  Modal.confirm({
    title: 'ç¡®è®¤é‡å¯',
    content: `ç¡®å®šè¦é‡å¯è®¾å¤‡"${record.name}"å—ï¼Ÿ`,
    onOk: async () => {
      try {
        await deviceApi.restartDevice(record.id);
        message.success('è®¾å¤‡é‡å¯æŒ‡ä»¤å·²å‘é€');
      } catch (error) {
        message.error('è®¾å¤‡é‡å¯å¤±è´¥');
      }
    },
  });
};

// æµ‹è¯•è®¾å¤‡
const handleTest = async (record) => {
  try {
    const response = await deviceApi.testDevice(record.id);
    if (response.data.success) {
      message.success('è®¾å¤‡æµ‹è¯•é€šè¿‡');
    } else {
      message.error(`è®¾å¤‡æµ‹è¯•å¤±è´¥: ${response.data.message}`);
    }
  } catch (error) {
    message.error('è®¾å¤‡æµ‹è¯•å¤±è´¥');
  }
};

// æ‰¹é‡å¯¼å…¥
const handleBatchImport = () => {
  message.info('æ‰¹é‡å¯¼å…¥åŠŸèƒ½å¼€å‘ä¸­...');
};

// æ‰¹é‡æ“ä½œ
const handleBatchOperation = () => {
  message.info('æ‰¹é‡æ“ä½œåŠŸèƒ½å¼€å‘ä¸­...');
};

// å¯¼å‡º
const handleExport = () => {
  message.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
};

// åˆ·æ–°
const handleRefresh = () => {
  loadDeviceData();
};

onMounted(() => {
  loadDeviceData();
});
</script>

<style scoped lang="less">
.device-table {
  background: #fff;
  border-radius: 8px;
  padding: 16px;

  .table-toolbar {
    margin-bottom: 16px;
    padding: 16px;
    background: #fafafa;
    border-radius: 4px;
  }

  .table-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;

    .actions-left,
    .actions-right {
      display: flex;
      gap: 8px;
    }
  }

  .text-muted {
    color: #999;
    font-style: italic;
  }
}
</style>
```

### 3. è®¾å¤‡ç›‘æ§

#### å®æ—¶ç›‘æ§ç»„ä»¶
```vue
<!-- src/views/business/attendance/management/monitor/components/RealTimeMonitor.vue -->
<template>
  <div class="realtime-monitor">
    <!-- ç›‘æ§å¤´éƒ¨ -->
    <div class="monitor-header">
      <div class="header-left">
        <h3>å®æ—¶ç›‘æ§</h3>
        <a-space>
          <a-tag :color="connectionStatus === 'connected' ? 'success' : 'error'">
            <a-badge :status="connectionStatus === 'connected' ? 'success' : 'error'" />
            {{ connectionStatus === 'connected' ? 'å·²è¿æ¥' : 'è¿æ¥æ–­å¼€' }}
          </a-tag>
          <span class="update-time">æ›´æ–°æ—¶é—´: {{ lastUpdateTime }}</span>
        </a-space>
      </div>
      <div class="header-right">
        <a-button @click="handleRefresh" :loading="refreshing">
          <template #icon><ReloadOutlined /></template>
          åˆ·æ–°
        </a-button>
        <a-button @click="handleAutoRefresh">
          <template #icon>
            <PlayCircleOutlined v-if="!autoRefresh" />
            <PauseCircleOutlined v-else />
          </template>
          {{ autoRefresh ? 'åœæ­¢' : 'å¼€å§‹' }}è‡ªåŠ¨åˆ·æ–°
        </a-button>
      </div>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
      <a-row :gutter="16">
        <a-col :span="6" v-for="(stat, index) in statsData" :key="index">
          <a-card :bordered="false" class="stat-card">
            <a-statistic
              :title="stat.title"
              :value="stat.value"
              :value-style="{ color: stat.color }"
              :prefix="stat.prefix"
            >
              <template #suffix>
                <span class="stat-suffix">{{ stat.suffix }}</span>
              </template>
            </a-statistic>
            <div class="stat-trend" v-if="stat.trend">
              <component :is="stat.trend > 0 ? 'ArrowUpOutlined' : 'ArrowDownOutlined'"
                        :style="{ color: stat.trend > 0 ? '#52c41a' : '#ff4d4f' }" />
              <span>{{ Math.abs(stat.trend) }}%</span>
            </div>
          </a-card>
        </a-col>
      </a-row>
    </div>

    <!-- è®¾å¤‡çŠ¶æ€åˆ—è¡¨ -->
    <div class="device-status-list">
      <a-card title="è®¾å¤‡çŠ¶æ€" :bordered="false">
        <template #extra>
          <a-radio-group v-model:value="statusFilter" size="small" @change="filterDevices">
            <a-radio-button value="all">å…¨éƒ¨</a-radio-button>
            <a-radio-button value="online">åœ¨çº¿</a-radio-button>
            <a-radio-button value="offline">ç¦»çº¿</a-radio-button>
            <a-radio-button value="error">æ•…éšœ</a-radio-button>
          </a-radio-group>
        </template>

        <div class="device-grid">
          <div
            v-for="device in filteredDevices"
            :key="device.id"
            class="device-card"
            :class="getDeviceCardClass(device.status)"
            @click="handleDeviceClick(device)"
          >
            <div class="device-header">
              <div class="device-info">
                <h4>{{ device.name }}</h4>
                <span class="device-no">{{ device.deviceNo }}</span>
              </div>
              <div class="device-status">
                <a-badge :status="getStatusBadge(device.status)" />
                <span class="status-text">{{ getStatusText(device.status) }}</span>
              </div>
            </div>

            <div class="device-details">
              <div class="detail-item">
                <span class="label">ç±»å‹:</span>
                <span class="value">{{ getTypeText(device.type) }}</span>
              </div>
              <div class="detail-item">
                <span class="label">ä½ç½®:</span>
                <span class="value">{{ device.location }}</span>
              </div>
              <div class="detail-item">
                <span class="label">ä»Šæ—¥æ‰“å¡:</span>
                <span class="value highlight">{{ device.todayCount || 0 }}æ¬¡</span>
              </div>
              <div class="detail-item">
                <span class="label">æœ€åå¿ƒè·³:</span>
                <span class="value">{{ formatTime(device.lastHeartbeat) }}</span>
              </div>
            </div>

            <div class="device-actions">
              <a-button type="text" size="small" @click.stop="handleViewDetail(device)">
                è¯¦æƒ…
              </a-button>
              <a-button type="text" size="small" @click.stop="handleRestart(device)" v-if="device.status !== 'offline'">
                é‡å¯
              </a-button>
              <a-button type="text" size="small" @click.stop="handleMaintenance(device)">
                ç»´æŠ¤
              </a-button>
            </div>
          </div>
        </div>
      </a-card>
    </div>

    <!-- å®æ—¶å‘Šè­¦ -->
    <div class="realtime-alerts">
      <a-card title="å®æ—¶å‘Šè­¦" :bordered="false">
        <template #extra>
          <a-button type="link" @click="viewAllAlerts">æŸ¥çœ‹å…¨éƒ¨</a-button>
        </template>

        <a-list :data-source="recentAlerts" :loading="alertsLoading">
          <template #renderItem="{ item }">
            <a-list-item>
              <a-list-item-meta>
                <template #avatar>
                  <a-badge :status="getAlertBadge(item.level)" />
                </template>
                <template #title>
                  <span :style="{ color: getAlertColor(item.level) }">{{ item.title }}</span>
                </template>
                <template #description>
                  {{ item.description }}
                </template>
              </a-list-item-meta>
              <div class="alert-time">{{ formatTime(item.createdAt) }}</div>
            </a-list-item>
          </template>
        </a-list>
      </a-card>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted, onUnmounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  ReloadOutlined,
  PlayCircleOutlined,
  PauseCircleOutlined,
  ArrowUpOutlined,
  ArrowDownOutlined
} from '@ant-design/icons-vue';
import { monitorApi } from '/@/api/business/attendance/management/monitor-api';
import { WebSocketManager } from '/@/utils/websocket-manager';

const emit = defineEmits(['device-click', 'view-detail', 'view-alerts']);

const refreshing = ref(false);
const autoRefresh = ref(false);
const connectionStatus = ref('disconnected');
const lastUpdateTime = ref('');
const statusFilter = ref('all');
const alertsLoading = ref(false);

const statsData = ref([
  {
    title: 'è®¾å¤‡æ€»æ•°',
    value: 0,
    suffix: 'å°',
    color: '#1890ff',
    prefix: 'DesktopOutlined',
    trend: 0
  },
  {
    title: 'åœ¨çº¿è®¾å¤‡',
    value: 0,
    suffix: 'å°',
    color: '#52c41a',
    prefix: 'CheckCircleOutlined',
    trend: 0
  },
  {
    title: 'ä»Šæ—¥æ‰“å¡',
    value: 0,
    suffix: 'æ¬¡',
    color: '#faad14',
    prefix: 'ClockCircleOutlined',
    trend: 0
  },
  {
    title: 'å¼‚å¸¸å‘Šè­¦',
    value: 0,
    suffix: 'æ¡',
    color: '#ff4d4f',
    prefix: 'ExclamationCircleOutlined',
    trend: 0
  }
]);

const devices = ref([]);
const recentAlerts = ref([]);

let refreshTimer = null;
let wsManager = null;

// è¿‡æ»¤åçš„è®¾å¤‡åˆ—è¡¨
const filteredDevices = computed(() => {
  if (statusFilter.value === 'all') {
    return devices.value;
  }
  return devices.value.filter(device => device.status === statusFilter.value);
});

// åŠ è½½ç›‘æ§æ•°æ®
const loadMonitorData = async () => {
  try {
    const [statusResponse, statsResponse, alertsResponse] = await Promise.all([
      monitorApi.getDeviceStatusList(),
      monitorApi.getMonitoringStatistics(),
      monitorApi.getAlertList({ limit: 10 })
    ]);

    devices.value = statusResponse.data;
    updateStatsData(statsResponse.data);
    recentAlerts.value = alertsResponse.data;
    lastUpdateTime.value = new Date().toLocaleTimeString('zh-CN');
  } catch (error) {
    console.error('åŠ è½½ç›‘æ§æ•°æ®å¤±è´¥:', error);
  }
};

// æ›´æ–°ç»Ÿè®¡æ•°æ®
const updateStatsData = (data) => {
  statsData.value[0].value = data.totalDevices;
  statsData.value[1].value = data.onlineDevices;
  statsData.value[2].value = data.todayCheckins;
  statsData.value[3].value = data.activeAlerts;

  // è®¡ç®—è¶‹åŠ¿ï¼ˆç¤ºä¾‹ï¼‰
  statsData.value.forEach(stat => {
    stat.trend = Math.floor(Math.random() * 20 - 10); // æ¨¡æ‹Ÿè¶‹åŠ¿æ•°æ®
  });
};

// åˆ·æ–°
const handleRefresh = async () => {
  refreshing.value = true;
  await loadMonitorData();
  refreshing.value = false;
};

// è‡ªåŠ¨åˆ·æ–°
const handleAutoRefresh = () => {
  autoRefresh.value = !autoRefresh.value;

  if (autoRefresh.value) {
    refreshTimer = setInterval(() => {
      loadMonitorData();
    }, 30000); // 30ç§’åˆ·æ–°ä¸€æ¬¡
    message.success('å·²å¼€å¯è‡ªåŠ¨åˆ·æ–°');
  } else {
    if (refreshTimer) {
      clearInterval(refreshTimer);
      refreshTimer = null;
    }
    message.info('å·²åœæ­¢è‡ªåŠ¨åˆ·æ–°');
  }
};

// è¿‡æ»¤è®¾å¤‡
const filterDevices = () => {
  // è¿‡æ»¤é€»è¾‘å·²åœ¨computedä¸­å®ç°
};

// è·å–è®¾å¤‡å¡ç‰‡æ ·å¼
const getDeviceCardClass = (status) => {
  return {
    'device-online': status === 'online',
    'device-offline': status === 'offline',
    'device-error': status === 'error',
    'device-maintenance': status === 'maintenance'
  };
};

// è·å–çŠ¶æ€å¾½æ ‡
const getStatusBadge = (status) => {
  const statusMap = {
    online: 'success',
    offline: 'default',
    maintenance: 'warning',
    error: 'error',
  };
  return statusMap[status] || 'default';
};

// è·å–çŠ¶æ€æ–‡æœ¬
const getStatusText = (status) => {
  const statusMap = {
    online: 'åœ¨çº¿',
    offline: 'ç¦»çº¿',
    maintenance: 'ç»´æŠ¤ä¸­',
    error: 'æ•…éšœ',
  };
  return statusMap[status] || 'æœªçŸ¥';
};

// è·å–ç±»å‹æ–‡æœ¬
const getTypeText = (type) => {
  const typeMap = {
    fingerprint: 'æŒ‡çº¹æœº',
    face: 'äººè„¸è¯†åˆ«',
    ic: 'ICå¡æœº',
    qr: 'äºŒç»´ç ',
    mobile: 'ç§»åŠ¨ç«¯',
  };
  return typeMap[type] || 'æœªçŸ¥';
};

// è·å–å‘Šè­¦å¾½æ ‡
const getAlertBadge = (level) => {
  const levelMap = {
    low: 'default',
    medium: 'warning',
    high: 'error',
    critical: 'error',
  };
  return levelMap[level] || 'default';
};

// è·å–å‘Šè­¦é¢œè‰²
const getAlertColor = (level) => {
  const colorMap = {
    low: '#666',
    medium: '#faad14',
    high: '#ff7a45',
    critical: '#ff4d4f',
  };
  return colorMap[level] || '#666';
};

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (time) => {
  if (!time) return '--';
  return new Date(time).toLocaleTimeString('zh-CN');
};

// è®¾å¤‡ç‚¹å‡»
const handleDeviceClick = (device) => {
  emit('device-click', device);
};

// æŸ¥çœ‹è¯¦æƒ…
const handleViewDetail = (device) => {
  emit('view-detail', device);
};

// é‡å¯è®¾å¤‡
const handleRestart = async (device) => {
  try {
    await deviceApi.restartDevice(device.id);
    message.success('é‡å¯æŒ‡ä»¤å·²å‘é€');
  } catch (error) {
    message.error('é‡å¯å¤±è´¥');
  }
};

// ç»´æŠ¤è®¾å¤‡
const handleMaintenance = (device) => {
  message.info('ç»´æŠ¤åŠŸèƒ½å¼€å‘ä¸­...');
};

// æŸ¥çœ‹æ‰€æœ‰å‘Šè­¦
const viewAllAlerts = () => {
  emit('view-alerts');
};

// WebSocketè¿æ¥
const initWebSocket = () => {
  wsManager = new WebSocketManager('/attendance/monitor');

  wsManager.on('open', () => {
    connectionStatus.value = 'connected';
    message.success('å®æ—¶è¿æ¥å·²å»ºç«‹');
  });

  wsManager.on('close', () => {
    connectionStatus.value = 'disconnected';
  });

  wsManager.on('message', (data) => {
    handleWebSocketMessage(data);
  });

  wsManager.connect();
};

// å¤„ç†WebSocketæ¶ˆæ¯
const handleWebSocketMessage = (data) => {
  switch (data.type) {
    case 'device_status':
      updateDeviceStatus(data.payload);
      break;
    case 'new_alert':
      addNewAlert(data.payload);
      break;
    case 'statistics':
      updateStatsData(data.payload);
      break;
  }
};

// æ›´æ–°è®¾å¤‡çŠ¶æ€
const updateDeviceStatus = (payload) => {
  const device = devices.value.find(d => d.id === payload.deviceId);
  if (device) {
    Object.assign(device, payload);
  }
};

// æ·»åŠ æ–°å‘Šè­¦
const addNewAlert = (alert) => {
  recentAlerts.value.unshift(alert);
  if (recentAlerts.value.length > 10) {
    recentAlerts.value.pop();
  }
};

onMounted(() => {
  loadMonitorData();
  initWebSocket();
});

onUnmounted(() => {
  if (refreshTimer) {
    clearInterval(refreshTimer);
  }
  if (wsManager) {
    wsManager.disconnect();
  }
});
</script>

<style scoped lang="less">
.realtime-monitor {
  .monitor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;

      h3 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
      }

      .update-time {
        color: #666;
        font-size: 14px;
      }
    }

    .header-right {
      display: flex;
      gap: 8px;
    }
  }

  .stats-cards {
    margin-bottom: 24px;

    .stat-card {
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;

      &:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }

      .stat-suffix {
        font-size: 14px;
        color: #666;
        margin-left: 4px;
      }

      .stat-trend {
        margin-top: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 12px;
      }
    }
  }

  .device-status-list {
    margin-bottom: 24px;

    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;

      .device-card {
        border: 1px solid #f0f0f0;
        border-radius: 8px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.3s;

        &:hover {
          border-color: #1890ff;
          box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);
        }

        &.device-online {
          border-left: 4px solid #52c41a;
        }

        &.device-offline {
          border-left: 4px solid #d9d9d9;
        }

        &.device-error {
          border-left: 4px solid #ff4d4f;
        }

        &.device-maintenance {
          border-left: 4px solid #faad14;
        }

        .device-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 12px;

          .device-info {
            h4 {
              margin: 0 0 4px 0;
              font-size: 16px;
              font-weight: 600;
            }

            .device-no {
              color: #666;
              font-size: 12px;
            }
          }

          .device-status {
            display: flex;
            align-items: center;
            gap: 4px;

            .status-text {
              font-size: 12px;
            }
          }
        }

        .device-details {
          margin-bottom: 12px;

          .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 14px;

            .label {
              color: #666;
            }

            .value {
              font-weight: 500;

              &.highlight {
                color: #1890ff;
                font-weight: 600;
              }
            }
          }
        }

        .device-actions {
          display: flex;
          justify-content: space-between;
          border-top: 1px solid #f0f0f0;
          padding-top: 8px;
        }
      }
    }
  }

  .realtime-alerts {
    .alert-time {
      color: #666;
      font-size: 12px;
    }
  }
}
</style>
```

## Mockæ•°æ®ç¤ºä¾‹

```javascript
// src/mock/management-mock.js
export const mockAreaList = [
  {
    id: 'area001',
    name: 'æ€»éƒ¨åŠå…¬åŒº',
    code: 'HQ_OFFICE',
    type: 'office',
    longitude: 116.397428,
    latitude: 39.90923,
    radius: 200,
    address: 'åŒ—äº¬å¸‚æœé˜³åŒºxxxè¡—é“xxxå·',
    status: 'active',
    deviceCount: 5,
    createdAt: '2024-01-01T00:00:00Z'
  },
  {
    id: 'area002',
    name: 'å·¥å‚è½¦é—´',
    code: 'FACTORY',
    type: 'factory',
    longitude: 116.407428,
    latitude: 39.91923,
    radius: 500,
    address: 'åŒ—äº¬å¸‚æµ·æ·€åŒºxxxè·¯xxxå·',
    status: 'active',
    deviceCount: 8,
    createdAt: '2024-01-01T00:00:00Z'
  }
];

export const mockDeviceList = {
  records: [
    {
      id: 'dev001',
      name: 'å‰é—¨äººè„¸è¯†åˆ«æœº',
      deviceNo: 'FACE001',
      type: 'face',
      areaId: 'area001',
      areaName: 'æ€»éƒ¨åŠå…¬åŒº',
      ipAddress: '192.168.1.100',
      status: 'online',
      lastOnline: '2024-01-15T10:30:00Z',
      todayCount: 45,
      location: 'å‰é—¨å…¥å£'
    },
    {
      id: 'dev002',
      name: 'åé—¨æŒ‡çº¹æœº',
      deviceNo: 'FP001',
      type: 'fingerprint',
      areaId: 'area001',
      areaName: 'æ€»éƒ¨åŠå…¬åŒº',
      ipAddress: '192.168.1.101',
      status: 'offline',
      lastOnline: '2024-01-15T08:00:00Z',
      todayCount: 0,
      location: 'åé—¨å‡ºå£'
    }
  ],
  total: 50,
  current: 1,
  pageSize: 20
};

export const mockMonitoringData = {
  statistics: {
    totalDevices: 50,
    onlineDevices: 45,
    offlineDevices: 5,
    todayCheckins: 1250,
    activeAlerts: 3
  },
  deviceStatus: [
    {
      id: 'dev001',
      name: 'å‰é—¨äººè„¸è¯†åˆ«æœº',
      deviceNo: 'FACE001',
      type: 'face',
      status: 'online',
      location: 'å‰é—¨å…¥å£',
      todayCount: 45,
      lastHeartbeat: '2024-01-15T10:30:00Z'
    }
  ],
  alerts: [
    {
      id: 'alert001',
      title: 'è®¾å¤‡ç¦»çº¿å‘Šè­¦',
      description: 'è®¾å¤‡"åé—¨æŒ‡çº¹æœº"å·²ç¦»çº¿è¶…è¿‡10åˆ†é’Ÿ',
      level: 'medium',
      deviceId: 'dev002',
      createdAt: '2024-01-15T10:20:00Z'
    }
  ]
};

export default {
  mockAreaList,
  mockDeviceList,
  mockMonitoringData
};
```

## å¼€å‘æ³¨æ„äº‹é¡¹æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½è¦ç‚¹
1. **è€ƒå‹¤åŒºåŸŸç®¡ç†** - åœ°å›¾åŒ–çš„åŒºåŸŸé…ç½®å’Œç®¡ç†
2. **è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†** - ä»æ³¨å†Œåˆ°ç»´æŠ¤çš„å®Œæ•´æµç¨‹
3. **å®æ—¶ç›‘æ§** - WebSocketå®ç°çš„è®¾å¤‡çŠ¶æ€å®æ—¶ç›‘æ§
4. **å¤šç±»å‹è®¾å¤‡æ”¯æŒ** - æ”¯æŒå„ç§è€ƒå‹¤è®¾å¤‡ç±»å‹
5. **å‘Šè­¦æœºåˆ¶** - è®¾å¤‡å¼‚å¸¸å®æ—¶å‘Šè­¦å’Œå¤„ç†
6. **æ•°æ®å¯è§†åŒ–** - ä¸°å¯Œçš„å›¾è¡¨å’ŒçŠ¶æ€å±•ç¤º

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. ä½¿ç”¨WebSocketå‡å°‘è½®è¯¢å¼€é”€
2. åœ°å›¾æ•°æ®é‡‡ç”¨åˆ†å±‚åŠ è½½
3. è®¾å¤‡çŠ¶æ€æ•°æ®åˆç†ç¼“å­˜
4. å®æ—¶æ•°æ®é‡‡ç”¨å¢é‡æ›´æ–°

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. æä¾›ç›´è§‚çš„åœ°å›¾æ“ä½œç•Œé¢
2. å®æ—¶çŠ¶æ€æ›´æ–°å’Œåé¦ˆ
3. ä¸°å¯Œçš„è®¾å¤‡æ“ä½œåŠŸèƒ½
4. åŠæ—¶çš„å¼‚å¸¸å‘Šè­¦æé†’

## æ€»ç»“

è€ƒå‹¤ç®¡ç†æ¨¡å—ä½œä¸ºç³»ç»Ÿçš„åŸºç¡€è®¾æ–½ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š

- è®¾å¤‡çŠ¶æ€çš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§
- åœ°å›¾æ“ä½œçš„æµç•…æ€§å’Œç›´è§‚æ€§
- å‘Šè­¦æœºåˆ¶çš„åŠæ—¶æ€§å’Œæœ‰æ•ˆæ€§
- è®¾å¤‡ç®¡ç†çš„ä¾¿æ·æ€§å’Œå®Œæ•´æ€§
- æ•°æ®ç›‘æ§çš„å…¨é¢æ€§å’Œå¯è§†åŒ–

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æŠ€æœ¯è§„èŒƒï¼Œå¯ä»¥æ„å»ºå‡ºåŠŸèƒ½å®Œå–„ã€æ€§èƒ½ä¼˜è‰¯çš„è€ƒå‹¤ç®¡ç†æ¨¡å—ã€‚