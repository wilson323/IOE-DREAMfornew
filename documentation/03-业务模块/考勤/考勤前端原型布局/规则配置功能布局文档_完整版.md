# è§„åˆ™é…ç½®åŠŸèƒ½å¸ƒå±€æ–‡æ¡£ - å®Œæ•´ç‰ˆ

## åŠŸèƒ½æ¦‚è¿°

è§„åˆ™é…ç½®æ¨¡å—æ˜¯è€ƒå‹¤ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒé…ç½®ä¸­å¿ƒï¼Œè´Ÿè´£å®šä¹‰å’Œç®¡ç†å„ç±»è€ƒå‹¤è§„åˆ™ã€é¢„è­¦è§„åˆ™ã€ç§»åŠ¨ç«¯è§„åˆ™ã€é€šçŸ¥è§„åˆ™ç­‰ã€‚è¯¥æ¨¡å—æä¾›çµæ´»çš„è§„åˆ™å¼•æ“ï¼Œæ”¯æŒå¤šç§æ¡ä»¶ç»„åˆå’Œè‡ªå®šä¹‰é…ç½®ï¼Œç¡®ä¿è€ƒå‹¤ç³»ç»Ÿèƒ½å¤Ÿé€‚åº”ä¸åŒä¼ä¸šçš„ç®¡ç†éœ€æ±‚ï¼Œå®ç°ç²¾å‡†çš„è€ƒå‹¤è®¡ç®—å’Œå¼‚å¸¸æ£€æµ‹ã€‚

## æŠ€æœ¯æ¶æ„è§„èŒƒ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒæ¡†æ¶**: Vue 3.4.27 (Composition API)
- **UIç»„ä»¶åº“**: Ant Design Vue 4.2.5
- **çŠ¶æ€ç®¡ç†**: Pinia 2.1.7
- **è·¯ç”±ç®¡ç†**: Vue Router 4.3.2
- **HTTPå®¢æˆ·ç«¯**: Axios 1.6.8
- **è¡¨å•æ„å»ºå™¨**: FormCreate 1.x (åŠ¨æ€è¡¨å•)
- **ä»£ç ç¼–è¾‘å™¨**: Monaco Editor (è§„åˆ™è„šæœ¬ç¼–è¾‘)
- **æ ·å¼é¢„å¤„ç†å™¨**: Less 4.2.0
- **å›¾æ ‡åº“**: @ant-design/icons-vue

### é¡¹ç›®æ–‡ä»¶ç»„ç»‡ç»“æ„
```
src/views/business/attendance/rules/
â”œâ”€â”€ index.vue                        # è§„åˆ™é…ç½®ä¸»é¡µé¢
â”œâ”€â”€ attendance/
â”‚   â”œâ”€â”€ index.vue                   # è€ƒå‹¤è§„åˆ™é…ç½®é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ WorkTimeRule.vue        # å·¥ä½œæ—¶é—´è§„åˆ™ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ExceptionRule.vue       # å¼‚å¸¸åˆ¤å®šè§„åˆ™ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ OvertimeRule.vue        # åŠ ç­è§„åˆ™ç»„ä»¶
â”‚   â”‚   â””â”€â”€ SpecialRule.vue         # ç‰¹æ®Šè§„åˆ™ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ attendance-rules-api.js # è€ƒå‹¤è§„åˆ™API
â”œâ”€â”€ alert/
â”‚   â”œâ”€â”€ index.vue                   # é¢„è­¦è§„åˆ™é…ç½®é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ RealTimeAlert.vue       # å®æ—¶é¢„è­¦ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ StatisticsAlert.vue     # ç»Ÿè®¡é¢„è­¦ç»„ä»¶
â”‚   â”‚   â””â”€â”€ AlertProcessor.vue      # é¢„è­¦å¤„ç†ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ alert-rules-api.js      # é¢„è­¦è§„åˆ™API
â”œâ”€â”€ mobile/
â”‚   â”œâ”€â”€ index.vue                   # ç§»åŠ¨ç«¯è§„åˆ™é…ç½®é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ClockInRule.vue         # æ‰“å¡è§„åˆ™ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ SecurityRule.vue        # å®‰å…¨è§„åˆ™ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ConvenienceRule.vue     # ä¾¿æ·è§„åˆ™ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ mobile-rules-api.js     # ç§»åŠ¨ç«¯è§„åˆ™API
â”œâ”€â”€ notification/
â”‚   â”œâ”€â”€ index.vue                   # é€šçŸ¥è§„åˆ™é…ç½®é¡µé¢
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ChannelConfig.vue       # é€šçŸ¥æ¸ é“ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ SceneConfig.vue         # é€šçŸ¥åœºæ™¯ç»„ä»¶
â”‚   â”‚   â””â”€â”€ TemplateEditor.vue      # æ¨¡æ¿ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ notification-rules-api.js # é€šçŸ¥è§„åˆ™API
â”œâ”€â”€ mock/
â”‚   â””â”€â”€ rules-mock.js               # æ¨¡æ‹Ÿæ•°æ®
â”œâ”€â”€ api/
â”‚   â””â”€â”€ rules-api.js                # ç»Ÿä¸€APIæ¥å£
â””â”€â”€ utils/
    â”œâ”€â”€ rule-engine.js              # è§„åˆ™å¼•æ“å·¥å…·
    â”œâ”€â”€ form-builder.js             # åŠ¨æ€è¡¨å•æ„å»ºå™¨
    â””â”€â”€ rule-validator.js           # è§„åˆ™éªŒè¯å™¨
```

### APIæ¥å£è®¾è®¡
```javascript
// src/api/business/attendance/rules/attendance-rules-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const attendanceRulesApi = {
  // å·¥ä½œæ—¶é—´è§„åˆ™
  getWorkTimeRules: (params) => getRequest('/attendance/rules/work-time/list', params),
  createWorkTimeRule: (params) => postRequest('/attendance/rules/work-time/create', params),
  updateWorkTimeRule: (id, params) => putRequest(`/attendance/rules/work-time/update/${id}`, params),
  deleteWorkTimeRule: (id) => deleteRequest(`/attendance/rules/work-time/delete/${id}`),
  testWorkTimeRule: (params) => postRequest('/attendance/rules/work-time/test', params),

  // å¼‚å¸¸åˆ¤å®šè§„åˆ™
  getExceptionRules: (params) => getRequest('/attendance/rules/exception/list', params),
  createExceptionRule: (params) => postRequest('/attendance/rules/exception/create', params),
  updateExceptionRule: (id, params) => putRequest(`/attendance/rules/exception/update/${id}`, params),
  deleteExceptionRule: (id) => deleteRequest(`/attendance/rules/exception/delete/${id}`),

  // åŠ ç­è§„åˆ™
  getOvertimeRules: (params) => getRequest('/attendance/rules/overtime/list', params),
  createOvertimeRule: (params) => postRequest('/attendance/rules/overtime/create', params),
  updateOvertimeRule: (id, params) => putRequest(`/attendance/rules/overtime/update/${id}`, params),
  deleteOvertimeRule: (id) => deleteRequest(`/attendance/rules/overtime/delete/${id}`),

  // ç‰¹æ®Šè§„åˆ™
  getSpecialRules: (params) => getRequest('/attendance/rules/special/list', params),
  createSpecialRule: (params) => postRequest('/attendance/rules/special/create', params),
  updateSpecialRule: (id, params) => putRequest(`/attendance/rules/special/update/${id}`, params),
  deleteSpecialRule: (id) => deleteRequest(`/attendance/rules/special/delete/${id}`),
};

// src/api/business/attendance/rules/alert-rules-api.js
export const alertRulesApi = {
  // å®æ—¶é¢„è­¦è§„åˆ™
  getRealTimeAlertRules: (params) => getRequest('/attendance/rules/alert/realtime/list', params),
  createRealTimeAlertRule: (params) => postRequest('/attendance/rules/alert/realtime/create', params),
  updateRealTimeAlertRule: (id, params) => putRequest(`/attendance/rules/alert/realtime/update/${id}`, params),
  deleteRealTimeAlertRule: (id) => deleteRequest(`/attendance/rules/alert/realtime/delete/${id}`),

  // ç»Ÿè®¡é¢„è­¦è§„åˆ™
  getStatisticsAlertRules: (params) => getRequest('/attendance/rules/alert/statistics/list', params),
  createStatisticsAlertRule: (params) => postRequest('/attendance/rules/alert/statistics/create', params),
  updateStatisticsAlertRule: (id, params) => putRequest(`/attendance/rules/alert/statistics/update/${id}`, params),

  // é¢„è­¦å¤„ç†
  getAlertProcessors: () => getRequest('/attendance/rules/alert/processors'),
  updateAlertProcessor: (ruleId, processorId, params) => putRequest(`/attendance/rules/alert/${ruleId}/processor/${processorId}`, params),
};

// src/api/business/attendance/rules/notification-rules-api.js
export const notificationRulesApi = {
  // é€šçŸ¥æ¸ é“
  getNotificationChannels: () => getRequest('/attendance/rules/notification/channels'),
  updateNotificationChannel: (channelId, params) => putRequest(`/attendance/rules/notification/channel/${channelId}`, params),
  testNotificationChannel: (channelId, params) => postRequest(`/attendance/rules/notification/channel/${channelId}/test`, params),

  // é€šçŸ¥åœºæ™¯
  getNotificationScenes: (params) => getRequest('/attendance/rules/notification/scenes', params),
  createNotificationScene: (params) => postRequest('/attendance/rules/notification/scene/create', params),
  updateNotificationScene: (id, params) => putRequest(`/attendance/rules/notification/scene/update/${id}`, params),
  deleteNotificationScene: (id) => deleteRequest(`/attendance/rules/notification/scene/delete/${id}`),

  // é€šçŸ¥æ¨¡æ¿
  getNotificationTemplates: (sceneId) => getRequest(`/attendance/rules/notification/templates/${sceneId}`),
  updateNotificationTemplate: (templateId, params) => putRequest(`/attendance/rules/notification/template/${templateId}`, params),
  previewNotificationTemplate: (params) => postRequest('/attendance/rules/notification/template/preview', params),
};
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 1. å·¥ä½œæ—¶é—´è§„åˆ™é…ç½®
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

#### å·¥ä½œæ—¶é—´è§„åˆ™ç»„ä»¶
```vue
<!-- src/views/business/attendance/rules/attendance/components/WorkTimeRule.vue -->
<template>
  <div class="work-time-rule">
    <div class="rule-header">
      <h3>å·¥ä½œæ—¶é—´è§„åˆ™</h3>
      <div class="header-actions">
        <a-button type="primary" @click="handleAddRule">
          <template #icon><PlusOutlined /></template>
          æ–°å¢è§„åˆ™
        </a-button>
      </div>
    </div>

    <!-- è§„åˆ™åˆ—è¡¨ -->
    <div class="rule-list">
      <div
        v-for="rule in rules"
        :key="rule.id"
        class="rule-item"
        :class="{ active: selectedRuleId === rule.id }"
        @click="selectRule(rule)"
      >
        <div class="rule-info">
          <div class="rule-title">
            <h4>{{ rule.name }}</h4>
            <a-tag :color="getRuleStatusColor(rule.status)">{{ getRuleStatusText(rule.status) }}</a-tag>
          </div>
          <div class="rule-description">{{ rule.description }}</div>
          <div class="rule-meta">
            <span class="meta-item">
              <ClockCircleOutlined />
              {{ formatWorkTime(rule.workTime) }}
            </span>
            <span class="meta-item">
              <CalendarOutlined />
              {{ getWeekdaysText(rule.weekdays) }}
            </span>
            <span class="meta-item">
              <TeamOutlined />
              é€‚ç”¨: {{ rule.applicableCount }}ä¸ªéƒ¨é—¨
            </span>
          </div>
        </div>

        <div class="rule-actions">
          <a-button type="text" size="small" @click.stop="handleEditRule(rule)">
            <template #icon><EditOutlined /></template>
            ç¼–è¾‘
          </a-button>
          <a-button type="text" size="small" @click.stop="handleCopyRule(rule)">
            <template #icon><CopyOutlined /></template>
            å¤åˆ¶
          </a-button>
          <a-dropdown>
            <template #overlay>
              <a-menu @click="({ key }) => handleMenuClick(key, rule)">
                <a-menu-item key="test">
                  <PlayCircleOutlined />
                  æµ‹è¯•
                </a-menu-item>
                <a-menu-item key="enable" v-if="rule.status !== 'active'">
                  <CheckCircleOutlined />
                  å¯ç”¨
                </a-menu-item>
                <a-menu-item key="disable" v-if="rule.status === 'active'">
                  <StopOutlined />
                  ç¦ç”¨
                </a-menu-item>
                <a-menu-divider />
                <a-menu-item key="delete" class="danger">
                  <DeleteOutlined />
                  åˆ é™¤
                </a-menu-item>
              </a-menu>
            </template>
            <a-button type="text" size="small">
              <MoreOutlined />
            </a-button>
          </a-dropdown>
        </div>
      </div>
    </div>

    <!-- è§„åˆ™é…ç½®é¢æ¿ -->
    <div class="rule-config-panel" v-if="selectedRule">
      <a-card :title="isEditing ? 'ç¼–è¾‘è§„åˆ™' : 'æŸ¥çœ‹è§„åˆ™'" :bordered="false">
        <template #extra>
          <a-button type="text" @click="closeConfig">
            <template #icon><CloseOutlined /></template>
          </a-button>
        </template>

        <a-form
          ref="formRef"
          :model="formData"
          :rules="formRules"
          :label-col="{ span: 6 }"
          :wrapper-col="{ span: 18 }"
        >
          <a-form-item label="è§„åˆ™åç§°" name="name">
            <a-input v-model:value="formData.name" placeholder="è¯·è¾“å…¥è§„åˆ™åç§°" />
          </a-form-item>

          <a-form-item label="è§„åˆ™æè¿°" name="description">
            <a-textarea v-model:value="formData.description" placeholder="è¯·è¾“å…¥è§„åˆ™æè¿°" :rows="2" />
          </a-form-item>

          <a-form-item label="å·¥ä½œæ—¶æ®µ" name="workTime">
            <a-time-range-picker
              v-model:value="formData.workTime"
              format="HH:mm"
              placeholder="['å¼€å§‹æ—¶é—´', 'ç»“æŸæ—¶é—´']"
            />
          </a-form-item>

          <a-form-item label="ä¼‘æ¯æ—¶æ®µ" name="breakTime">
            <a-time-range-picker
              v-model:value="formData.breakTime"
              format="HH:mm"
              placeholder="['ä¼‘æ¯å¼€å§‹', 'ä¼‘æ¯ç»“æŸ']"
            />
          </a-form-item>

          <a-form-item label="å·¥ä½œæ—¥" name="weekdays">
            <a-checkbox-group v-model:value="formData.weekdays">
              <a-checkbox v-for="day in weekdays" :key="day.value" :value="day.value">
                {{ day.label }}
              </a-checkbox>
            </a-checkbox-group>
          </a-form-item>

          <a-form-item label="å¼¹æ€§æ—¶é—´" name="flexibleTime">
            <a-input-group compact>
              <a-input-number
                v-model:value="formData.flexibleTime.start"
                :min="0"
                :max="60"
                placeholder="è¿Ÿåˆ°"
                style="width: 100px"
              />
              <a-input
                style="width: 30px; text-align: center; border-left: 0; pointer-events: none"
                placeholder="~"
                disabled
              />
              <a-input-number
                v-model:value="formData.flexibleTime.end"
                :min="0"
                :max="60"
                placeholder="æ—©é€€"
                style="width: 100px; border-left: 0"
              />
              <span style="margin-left: 8px; color: #666;">åˆ†é’Ÿ</span>
            </a-input-group>
          </a-form-item>

          <a-form-item label="é€‚ç”¨èŒƒå›´" name="scope">
            <a-radio-group v-model:value="formData.scope.type">
              <a-radio value="all">å…¨éƒ¨å‘˜å·¥</a-radio>
              <a-radio value="department">æŒ‡å®šéƒ¨é—¨</a-radio>
              <a-radio value="position">æŒ‡å®šå²—ä½</a-radio>
              <a-radio value="individual">æŒ‡å®šå‘˜å·¥</a-radio>
            </a-radio-group>
          </a-form-item>

          <a-form-item name="scope" v-if="formData.scope.type !== 'all'">
            <a-select
              v-model:value="formData.scope.targets"
              mode="multiple"
              :placeholder="getScopePlaceholder(formData.scope.type)"
              style="width: 100%"
            >
              <a-select-option
                v-for="item in scopeOptions"
                :key="item.id"
                :value="item.id"
              >
                {{ item.name }}
              </a-select-option>
            </a-select>
          </a-form-item>

          <a-form-item label="çŠ¶æ€" name="status">
            <a-radio-group v-model:value="formData.status">
              <a-radio value="active">å¯ç”¨</a-radio>
              <a-radio value="inactive">ç¦ç”¨</a-radio>
            </a-radio-group>
          </a-form-item>

          <a-form-item :wrapper-col="{ offset: 6, span: 18 }">
            <a-space>
              <a-button type="primary" @click="handleSaveRule" :loading="saving">
                ä¿å­˜
              </a-button>
              <a-button @click="handleTestRule" :loading="testing">
                æµ‹è¯•
              </a-button>
              <a-button @click="closeConfig">å–æ¶ˆ</a-button>
            </a-space>
          </a-form-item>
        </a-form>
      </a-card>
    </div>

    <!-- æµ‹è¯•ç»“æœå¼¹çª— -->
    <a-modal
      v-model:open="testResultVisible"
      title="è§„åˆ™æµ‹è¯•ç»“æœ"
      :footer="null"
      width="800px"
    >
      <div class="test-result">
        <a-descriptions :column="2" bordered>
          <a-descriptions-item label="æµ‹è¯•æ—¶é—´">{{ testResult.testTime }}</a-descriptions-item>
          <a-descriptions-item label="æµ‹è¯•å‘˜å·¥">{{ testResult.employeeName }}</a-descriptions-item>
          <a-descriptions-item label="æ‰“å¡æ—¶é—´">{{ testResult.clockTime }}</a-descriptions-item>
          <a-descriptions-item label="åˆ¤å®šç»“æœ">
            <a-tag :color="testResult.result === 'normal' ? 'success' : 'error'">
              {{ testResult.result === 'normal' ? 'æ­£å¸¸' : 'å¼‚å¸¸' }}
            </a-tag>
          </a-descriptions-item>
          <a-descriptions-item label="åŒ¹é…è§„åˆ™" :span="2">{{ testResult.ruleName }}</a-descriptions-item>
          <a-descriptions-item label="è¯¦ç»†è¯´æ˜" :span="2">{{ testResult.explanation }}</a-descriptions-item>
        </a-descriptions>
      </div>
    </a-modal>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  PlusOutlined,
  EditOutlined,
  CopyOutlined,
  PlayCircleOutlined,
  CheckCircleOutlined,
  StopOutlined,
  DeleteOutlined,
  MoreOutlined,
  CloseOutlined,
  ClockCircleOutlined,
  CalendarOutlined,
  TeamOutlined
} from '@ant-design/icons-vue';
import { attendanceRulesApi } from '/@/api/business/attendance/rules/attendance-rules-api';
import dayjs from 'dayjs';

const emit = defineEmits(['rule-change']);

const rules = ref([]);
const selectedRuleId = ref(null);
const selectedRule = computed(() => rules.value.find(r => r.id === selectedRuleId.value));
const isEditing = ref(false);
const saving = ref(false);
const testing = ref(false);
const testResultVisible = ref(false);
const testResult = ref({});

const formRef = ref();
const formData = reactive({
  name: '',
  description: '',
  workTime: [],
  breakTime: [],
  weekdays: [1, 2, 3, 4, 5],
  flexibleTime: {
    start: 0,
    end: 0
  },
  scope: {
    type: 'all',
    targets: []
  },
  status: 'active'
});

const weekdays = [
  { label: 'å‘¨ä¸€', value: 1 },
  { label: 'å‘¨äºŒ', value: 2 },
  { label: 'å‘¨ä¸‰', value: 3 },
  { label: 'å‘¨å››', value: 4 },
  { label: 'å‘¨äº”', value: 5 },
  { label: 'å‘¨å…­', value: 6 },
  { label: 'å‘¨æ—¥', value: 7 }
];

const scopeOptions = ref([]);

const formRules = {
  name: [
    { required: true, message: 'è¯·è¾“å…¥è§„åˆ™åç§°', trigger: 'blur' }
  ],
  workTime: [
    { required: true, message: 'è¯·é€‰æ‹©å·¥ä½œæ—¶æ®µ', trigger: 'change' }
  ],
  weekdays: [
    { required: true, message: 'è¯·é€‰æ‹©å·¥ä½œæ—¥', trigger: 'change' }
  ]
};

// åŠ è½½è§„åˆ™åˆ—è¡¨
const loadRules = async () => {
  try {
    const response = await attendanceRulesApi.getWorkTimeRules();
    rules.value = response.data;
  } catch (error) {
    console.error('åŠ è½½è§„åˆ™å¤±è´¥:', error);
    message.error('åŠ è½½è§„åˆ™å¤±è´¥');
  }
};

// é€‰æ‹©è§„åˆ™
const selectRule = (rule) => {
  selectedRuleId.value = rule.id;
  isEditing.value = false;
  Object.assign(formData, rule);
  formData.workTime = [dayjs(rule.startTime, 'HH:mm'), dayjs(rule.endTime, 'HH:mm')];
  if (rule.breakStartTime && rule.breakEndTime) {
    formData.breakTime = [dayjs(rule.breakStartTime, 'HH:mm'), dayjs(rule.breakEndTime, 'HH:mm')];
  }
};

// æ–°å¢è§„åˆ™
const handleAddRule = () => {
  resetForm();
  selectedRuleId.value = null;
  isEditing.value = true;
};

// ç¼–è¾‘è§„åˆ™
const handleEditRule = (rule) => {
  selectRule(rule);
  isEditing.value = true;
};

// å¤åˆ¶è§„åˆ™
const handleCopyRule = async (rule) => {
  try {
    const copyData = {
      ...rule,
      name: `${rule.name}_å‰¯æœ¬`,
      status: 'inactive'
    };
    delete copyData.id;
    delete copyData.createdAt;
    delete copyData.updatedAt;

    await attendanceRulesApi.createWorkTimeRule(copyData);
    message.success('è§„åˆ™å¤åˆ¶æˆåŠŸ');
    loadRules();
  } catch (error) {
    message.error('è§„åˆ™å¤åˆ¶å¤±è´¥');
  }
};

// èœå•ç‚¹å‡»
const handleMenuClick = async (key, rule) => {
  switch (key) {
    case 'test':
      await handleTestRule(rule);
      break;
    case 'enable':
      await handleToggleRuleStatus(rule, 'active');
      break;
    case 'disable':
      await handleToggleRuleStatus(rule, 'inactive');
      break;
    case 'delete':
      await handleDeleteRule(rule);
      break;
  }
};

// æµ‹è¯•è§„åˆ™
const handleTestRule = async (rule) => {
  testing.value = true;
  try {
    const testRule = rule || formData;
    const response = await attendanceRulesApi.testWorkTimeRule({
      ruleId: testRule.id,
      testDate: dayjs().format('YYYY-MM-DD'),
      testTime: dayjs().format('HH:mm:ss'),
      employeeId: 'test_employee'
    });

    testResult.value = response.data;
    testResultVisible.value = true;
  } catch (error) {
    message.error('è§„åˆ™æµ‹è¯•å¤±è´¥');
  } finally {
    testing.value = false;
  }
};

// åˆ‡æ¢è§„åˆ™çŠ¶æ€
const handleToggleRuleStatus = async (rule, status) => {
  try {
    await attendanceRulesApi.updateWorkTimeRule(rule.id, { ...rule, status });
    message.success(`è§„åˆ™å·²${status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
    loadRules();
  } catch (error) {
    message.error('æ“ä½œå¤±è´¥');
  }
};

// åˆ é™¤è§„åˆ™
const handleDeleteRule = (rule) => {
  Modal.confirm({
    title: 'ç¡®è®¤åˆ é™¤',
    content: `ç¡®å®šè¦åˆ é™¤è§„åˆ™"${rule.name}"å—ï¼Ÿ`,
    onOk: async () => {
      try {
        await attendanceRulesApi.deleteWorkTimeRule(rule.id);
        message.success('è§„åˆ™åˆ é™¤æˆåŠŸ');
        if (selectedRuleId.value === rule.id) {
          closeConfig();
        }
        loadRules();
      } catch (error) {
        message.error('è§„åˆ™åˆ é™¤å¤±è´¥');
      }
    },
  });
};

// ä¿å­˜è§„åˆ™
const handleSaveRule = async () => {
  try {
    await formRef.value.validate();
    saving.value = true;

    const saveData = {
      ...formData,
      startTime: formData.workTime[0].format('HH:mm'),
      endTime: formData.workTime[1].format('HH:mm'),
      breakStartTime: formData.breakTime.length > 0 ? formData.breakTime[0].format('HH:mm') : null,
      breakEndTime: formData.breakTime.length > 0 ? formData.breakTime[1].format('HH:mm') : null
    };

    if (selectedRuleId.value) {
      await attendanceRulesApi.updateWorkTimeRule(selectedRuleId.value, saveData);
      message.success('è§„åˆ™æ›´æ–°æˆåŠŸ');
    } else {
      await attendanceRulesApi.createWorkTimeRule(saveData);
      message.success('è§„åˆ™åˆ›å»ºæˆåŠŸ');
    }

    emit('rule-change');
    closeConfig();
    loadRules();
  } catch (error) {
    if (error.errorFields) {
      message.error('è¯·æ£€æŸ¥è¡¨å•å¡«å†™æ˜¯å¦æ­£ç¡®');
    } else {
      message.error('ä¿å­˜å¤±è´¥');
    }
  } finally {
    saving.value = false;
  }
};

// å…³é—­é…ç½®é¢æ¿
const closeConfig = () => {
  selectedRuleId.value = null;
  isEditing.value = false;
  formRef.value?.resetFields();
};

// é‡ç½®è¡¨å•
const resetForm = () => {
  Object.assign(formData, {
    name: '',
    description: '',
    workTime: [],
    breakTime: [],
    weekdays: [1, 2, 3, 4, 5],
    flexibleTime: {
      start: 0,
      end: 0
    },
    scope: {
      type: 'all',
      targets: []
    },
    status: 'active'
  });
};

// è·å–è§„åˆ™çŠ¶æ€é¢œè‰²
const getRuleStatusColor = (status) => {
  return status === 'active' ? 'success' : 'default';
};

// è·å–è§„åˆ™çŠ¶æ€æ–‡æœ¬
const getRuleStatusText = (status) => {
  return status === 'active' ? 'å¯ç”¨' : 'ç¦ç”¨';
};

// æ ¼å¼åŒ–å·¥ä½œæ—¶é—´
const formatWorkTime = (rule) => {
  return `${rule.startTime} - ${rule.endTime}`;
};

// è·å–å·¥ä½œæ—¥æ–‡æœ¬
const getWeekdaysText = (weekdays) => {
  const dayNames = ['', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
  return weekdays.map(day => dayNames[day]).join('ã€');
};

// è·å–é€‚ç”¨èŒƒå›´å ä½ç¬¦
const getScopePlaceholder = (type) => {
  const placeholders = {
    department: 'è¯·é€‰æ‹©é€‚ç”¨éƒ¨é—¨',
    position: 'è¯·é€‰æ‹©é€‚ç”¨å²—ä½',
    individual: 'è¯·é€‰æ‹©é€‚ç”¨å‘˜å·¥'
  };
  return placeholders[type] || 'è¯·é€‰æ‹©';
};

onMounted(() => {
  loadRules();
});
</script>

<style scoped lang="less">
.work-time-rule {
  display: flex;
  height: 600px;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;

  .rule-header {
    padding: 16px 24px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;

    h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }
  }

  .rule-list {
    width: 400px;
    border-right: 1px solid #f0f0f0;
    overflow-y: auto;
    padding: 16px;

    .rule-item {
      padding: 16px;
      border: 1px solid #f0f0f0;
      border-radius: 8px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s;

      &:hover {
        border-color: #1890ff;
        box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);
      }

      &.active {
        border-color: #1890ff;
        background: #f0f8ff;
      }

      .rule-info {
        .rule-title {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;

          h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
          }
        }

        .rule-description {
          color: #666;
          font-size: 12px;
          margin-bottom: 8px;
          line-height: 1.4;
        }

        .rule-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 12px;

          .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: #999;
          }
        }
      }

      .rule-actions {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
        gap: 4px;
      }
    }
  }

  .rule-config-panel {
    flex: 1;
    overflow-y: auto;
    padding: 16px;

    .test-result {
      :deep(.ant-descriptions-item-label) {
        font-weight: 600;
      }
    }
  }
}
</style>
```

### 2. å¼‚å¸¸åˆ¤å®šè§„åˆ™

```vue
<!-- src/views/business/attendance/rules/attendance/components/ExceptionRule.vue -->
<template>
  <div class="exception-rule">
    <div class="rule-header">
      <h3>å¼‚å¸¸åˆ¤å®šè§„åˆ™</h3>
      <a-button type="primary" @click="showAddModal">
        <template #icon><PlusOutlined /></template>
        æ–°å¢å¼‚å¸¸è§„åˆ™
      </a-button>
    </div>

    <!-- è§„åˆ™åˆ†ç±»æ ‡ç­¾ -->
    <div class="rule-categories">
      <a-tabs v-model:activeKey="activeCategory" @change="handleCategoryChange">
        <a-tab-pane key="late" tab="è¿Ÿåˆ°è§„åˆ™">
          <RuleTable
            :rules="lateRules"
            rule-type="late"
            @edit="handleEditRule"
            @delete="handleDeleteRule"
            @test="handleTestRule"
          />
        </a-tab-pane>
        <a-tab-pane key="early" tab="æ—©é€€è§„åˆ™">
          <RuleTable
            :rules="earlyRules"
            rule-type="early"
            @edit="handleEditRule"
            @delete="handleDeleteRule"
            @test="handleTestRule"
          />
        </a-tab-pane>
        <a-tab-pane key="absent" tab="ç¼ºå‹¤è§„åˆ™">
          <RuleTable
            :rules="absentRules"
            rule-type="absent"
            @edit="handleEditRule"
            @delete="handleDeleteRule"
            @test="handleTestRule"
          />
        </a-tab-pane>
        <a-tab-pane key="forgot" tab="å¿˜æ‰“å¡è§„åˆ™">
          <RuleTable
            :rules="forgotRules"
            rule-type="forgot"
            @edit="handleEditRule"
            @delete="handleDeleteRule"
            @test="handleTestRule"
          />
        </a-tab-pane>
      </a-tabs>
    </div>

    <!-- è§„åˆ™é…ç½®å¼¹çª— -->
    <a-modal
      v-model:open="modalVisible"
      :title="isEditing ? 'ç¼–è¾‘å¼‚å¸¸è§„åˆ™' : 'æ–°å¢å¼‚å¸¸è§„åˆ™'"
      @ok="handleSaveRule"
      @cancel="handleCancelModal"
      :confirm-loading="saving"
      width="800px"
    >
      <ExceptionRuleForm
        ref="ruleFormRef"
        :rule-data="currentRule"
        :rule-type="activeCategory"
      />
    </a-modal>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import { PlusOutlined } from '@ant-design/icons-vue';
import { attendanceRulesApi } from '/@/api/business/attendance/rules/attendance-rules-api';
import RuleTable from './components/RuleTable.vue';
import ExceptionRuleForm from './components/ExceptionRuleForm.vue';

const activeCategory = ref('late');
const modalVisible = ref(false);
const isEditing = ref(false);
const saving = ref(false);
const currentRule = ref(null);
const ruleFormRef = ref();

const lateRules = ref([]);
const earlyRules = ref([]);
const absentRules = ref([]);
const forgotRules = ref([]);

// åŠ è½½è§„åˆ™æ•°æ®
const loadRules = async () => {
  try {
    const response = await attendanceRulesApi.getExceptionRules();
    const rules = response.data;

    lateRules.value = rules.filter(rule => rule.type === 'late');
    earlyRules.value = rules.filter(rule => rule.type === 'early');
    absentRules.value = rules.filter(rule => rule.type === 'absent');
    forgotRules.value = rules.filter(rule => rule.type === 'forgot');
  } catch (error) {
    console.error('åŠ è½½å¼‚å¸¸è§„åˆ™å¤±è´¥:', error);
    message.error('åŠ è½½å¼‚å¸¸è§„åˆ™å¤±è´¥');
  }
};

// åˆ†ç±»åˆ‡æ¢
const handleCategoryChange = (category) => {
  activeCategory.value = category;
};

// æ˜¾ç¤ºæ–°å¢å¼¹çª—
const showAddModal = () => {
  currentRule.value = null;
  isEditing.value = false;
  modalVisible.value = true;
};

// ç¼–è¾‘è§„åˆ™
const handleEditRule = (rule) => {
  currentRule.value = rule;
  isEditing.value = true;
  modalVisible.value = true;
};

// åˆ é™¤è§„åˆ™
const handleDeleteRule = async (rule) => {
  try {
    await attendanceRulesApi.deleteExceptionRule(rule.id);
    message.success('è§„åˆ™åˆ é™¤æˆåŠŸ');
    loadRules();
  } catch (error) {
    message.error('è§„åˆ™åˆ é™¤å¤±è´¥');
  }
};

// æµ‹è¯•è§„åˆ™
const handleTestRule = async (rule) => {
  try {
    const response = await attendanceRulesApi.testExceptionRule({
      ruleId: rule.id,
      testScenarios: ['late_5min', 'late_30min', 'early_10min']
    });
    // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
    message.info('è§„åˆ™æµ‹è¯•å®Œæˆ');
  } catch (error) {
    message.error('è§„åˆ™æµ‹è¯•å¤±è´¥');
  }
};

// ä¿å­˜è§„åˆ™
const handleSaveRule = async () => {
  try {
    const formData = await ruleFormRef.value.getFormData();
    saving.value = true;

    if (isEditing.value) {
      await attendanceRulesApi.updateExceptionRule(currentRule.value.id, formData);
      message.success('è§„åˆ™æ›´æ–°æˆåŠŸ');
    } else {
      await attendanceRulesApi.createExceptionRule({
        ...formData,
        type: activeCategory.value
      });
      message.success('è§„åˆ™åˆ›å»ºæˆåŠŸ');
    }

    modalVisible.value = false;
    loadRules();
  } catch (error) {
    message.error('ä¿å­˜å¤±è´¥');
  } finally {
    saving.value = false;
  }
};

// å–æ¶ˆå¼¹çª—
const handleCancelModal = () => {
  modalVisible.value = false;
  currentRule.value = null;
};

onMounted(() => {
  loadRules();
});
</script>

<style scoped lang="less">
.exception-rule {
  background: #fff;
  border-radius: 8px;
  padding: 16px;

  .rule-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;

    h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }
  }

  .rule-categories {
    :deep(.ant-tabs-content-holder) {
      padding: 16px 0;
    }
  }
}
</style>
```

### 3. é€šçŸ¥è§„åˆ™é…ç½®

```vue
<!-- src/views/business/attendance/rules/notification/components/TemplateEditor.vue -->
<template>
  <div class="template-editor">
    <div class="editor-header">
      <h4>é€šçŸ¥æ¨¡æ¿ç¼–è¾‘å™¨</h4>
      <div class="editor-actions">
        <a-button @click="handlePreview" :loading="previewing">
          <template #icon><EyeOutlined /></template>
          é¢„è§ˆ
        </a-button>
        <a-button type="primary" @click="handleSave" :loading="saving">
          <template #icon><SaveOutlined /></template>
          ä¿å­˜
        </a-button>
      </div>
    </div>

    <div class="editor-content">
      <div class="template-form">
        <a-form layout="vertical">
          <a-form-item label="æ¨¡æ¿åç§°">
            <a-input v-model:value="templateData.name" placeholder="è¯·è¾“å…¥æ¨¡æ¿åç§°" />
          </a-form-item>

          <a-form-item label="æ¨¡æ¿æ ‡é¢˜">
            <a-input v-model:value="templateData.title" placeholder="è¯·è¾“å…¥é€šçŸ¥æ ‡é¢˜" />
          </a-form-item>

          <a-form-item label="é€šçŸ¥æ¸ é“">
            <a-checkbox-group v-model:value="templateData.channels">
              <a-checkbox value="email">é‚®ä»¶</a-checkbox>
              <a-checkbox value="sms">çŸ­ä¿¡</a-checkbox>
              <a-checkbox value="app">APPæ¨é€</a-checkbox>
              <a-checkbox value="wechat">å¾®ä¿¡</a-checkbox>
              <a-checkbox value="dingtalk">é’‰é’‰</a-checkbox>
            </a-checkbox-group>
          </a-form-item>
        </a-form>
      </div>

      <div class="template-editor-main">
        <div class="editor-toolbar">
          <a-space>
            <a-button size="small" @click="insertVariable('employeeName')">
              å‘˜å·¥å§“å
            </a-button>
            <a-button size="small" @click="insertVariable('department')">
              éƒ¨é—¨åç§°
            </a-button>
            <a-button size="small" @click="insertVariable('date')">
              æ—¥æœŸ
            </a-button>
            <a-button size="small" @click="insertVariable('time')">
              æ—¶é—´
            </a-button>
            <a-button size="small" @click="insertVariable('rule')">
              è§„åˆ™åç§°
            </a-button>
            <a-button size="small" @click="insertVariable('reason')">
              å¼‚å¸¸åŸå› 
            </a-button>
          </a-space>
        </div>

        <div class="editor-area">
          <a-textarea
            v-model:value="templateData.content"
            placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹ï¼Œæ”¯æŒå˜é‡æ›¿æ¢"
            :rows="10"
            @input="handleContentChange"
          />
        </div>

        <div class="variable-hint">
          <h5>å¯ç”¨å˜é‡ï¼š</h5>
          <div class="variable-list">
            <a-tag
              v-for="variable in availableVariables"
              :key="variable.key"
              @click="insertVariable(variable.key)"
              style="cursor: pointer; margin: 2px;"
            >
              {{ variable.key }} - {{ variable.description }}
            </a-tag>
          </div>
        </div>
      </div>
    </div>

    <!-- é¢„è§ˆå¼¹çª— -->
    <a-modal
      v-model:open="previewVisible"
      title="æ¨¡æ¿é¢„è§ˆ"
      :footer="null"
      width="600px"
    >
      <div class="preview-content">
        <div class="preview-item">
          <h5>æ ‡é¢˜ï¼š</h5>
          <div class="preview-title">{{ previewData.title }}</div>
        </div>
        <div class="preview-item">
          <h5>å†…å®¹ï¼š</h5>
          <div class="preview-body" v-html="previewData.content"></div>
        </div>
      </div>
    </a-modal>
  </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue';
import { message } from 'ant-design-vue';
import { EyeOutlined, SaveOutlined } from '@ant-design/icons-vue';
import { notificationRulesApi } from '/@/api/business/attendance/rules/notification-rules-api';

const props = defineProps({
  templateId: String,
  sceneId: String
});

const emit = defineEmits(['save']);

const saving = ref(false);
const previewing = ref(false);
const previewVisible = ref(false);

const templateData = reactive({
  name: '',
  title: '',
  content: '',
  channels: []
});

const previewData = reactive({
  title: '',
  content: ''
});

const availableVariables = [
  { key: '${employeeName}', description: 'å‘˜å·¥å§“å' },
  { key: '${employeeNo}', description: 'å‘˜å·¥å·¥å·' },
  { key: '${department}', description: 'éƒ¨é—¨åç§°' },
  { key: '${position}', description: 'å²—ä½åç§°' },
  { key: '${date}', description: 'æ—¥æœŸ' },
  { key: '${time}', description: 'æ—¶é—´' },
  { key: '${rule}', description: 'è§„åˆ™åç§°' },
  { key: '${reason}', description: 'å¼‚å¸¸åŸå› ' },
  { key: '${location}', description: 'æ‰“å¡åœ°ç‚¹' },
  { key: '${device}', description: 'è®¾å¤‡åç§°' }
];

// æ’å…¥å˜é‡
const insertVariable = (variable) => {
  const textarea = document.querySelector('.editor-area textarea');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const text = templateData.content;

  templateData.content = text.substring(0, start) + variable + text.substring(end);

  // é‡æ–°è®¾ç½®å…‰æ ‡ä½ç½®
  setTimeout(() => {
    textarea.focus();
    textarea.setSelectionRange(start + variable.length, start + variable.length);
  }, 0);
};

// å†…å®¹å˜åŒ–å¤„ç†
const handleContentChange = () => {
  // å®æ—¶å­—æ•°ç»Ÿè®¡æˆ–å…¶ä»–å¤„ç†
};

// é¢„è§ˆæ¨¡æ¿
const handlePreview = async () => {
  if (!templateData.title || !templateData.content) {
    message.warning('è¯·å…ˆå¡«å†™æ¨¡æ¿æ ‡é¢˜å’Œå†…å®¹');
    return;
  }

  previewing.value = true;
  try {
    const response = await notificationRulesApi.previewNotificationTemplate({
      title: templateData.title,
      content: templateData.content,
      testData: {
        employeeName: 'å¼ ä¸‰',
        employeeNo: 'EMP001',
        department: 'æŠ€æœ¯éƒ¨',
        position: 'é«˜çº§å·¥ç¨‹å¸ˆ',
        date: '2024-01-15',
        time: '09:15',
        rule: 'è¿Ÿåˆ°åˆ¤å®šè§„åˆ™',
        reason: 'è¶…è¿‡ä¸Šç­æ—¶é—´15åˆ†é’Ÿ',
        location: 'å…¬å¸å‰é—¨',
        device: 'å‰é—¨äººè„¸è¯†åˆ«æœº'
      }
    });

    previewData.title = response.data.title;
    previewData.content = response.data.content;
    previewVisible.value = true;
  } catch (error) {
    message.error('é¢„è§ˆå¤±è´¥');
  } finally {
    previewing.value = false;
  }
};

// ä¿å­˜æ¨¡æ¿
const handleSave = async () => {
  if (!templateData.name || !templateData.title || !templateData.content) {
    message.warning('è¯·å¡«å†™å®Œæ•´çš„æ¨¡æ¿ä¿¡æ¯');
    return;
  }

  saving.value = true;
  try {
    await notificationRulesApi.updateNotificationTemplate(props.templateId, templateData);
    message.success('æ¨¡æ¿ä¿å­˜æˆåŠŸ');
    emit('save', templateData);
  } catch (error) {
    message.error('æ¨¡æ¿ä¿å­˜å¤±è´¥');
  } finally {
    saving.value = false;
  }
};
</script>

<style scoped lang="less">
.template-editor {
  .editor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;

    h4 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }
  }

  .editor-content {
    display: flex;
    gap: 16px;

    .template-form {
      width: 300px;
      flex-shrink: 0;
    }

    .template-editor-main {
      flex: 1;

      .editor-toolbar {
        margin-bottom: 12px;
        padding: 8px;
        background: #f5f5f5;
        border-radius: 4px;
      }

      .editor-area {
        margin-bottom: 16px;

        :deep(.ant-input) {
          font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
      }

      .variable-hint {
        h5 {
          margin-bottom: 8px;
          font-size: 14px;
        }

        .variable-list {
          border: 1px solid #f0f0f0;
          border-radius: 4px;
          padding: 8px;
          background: #fafafa;
        }
      }
    }
  }

  .preview-content {
    .preview-item {
      margin-bottom: 16px;

      h5 {
        margin-bottom: 8px;
        font-weight: 600;
      }

      .preview-title {
        padding: 8px 12px;
        background: #f0f8ff;
        border-left: 3px solid #1890ff;
        font-weight: 600;
      }

      .preview-body {
        padding: 12px;
        background: #fafafa;
        border-radius: 4px;
        line-height: 1.6;
        white-space: pre-wrap;
      }
    }
  }
}
</style>
```

## Mockæ•°æ®ç¤ºä¾‹

```javascript
// src/mock/rules-mock.js
export const mockWorkTimeRules = [
  {
    id: 'rule001',
    name: 'æ ‡å‡†å·¥ä½œæ—¶é—´',
    description: 'å‘¨ä¸€è‡³å‘¨äº”ï¼Œ9:00-18:00ï¼Œåˆä¼‘12:00-13:00',
    startTime: '09:00',
    endTime: '18:00',
    breakStartTime: '12:00',
    breakEndTime: '13:00',
    weekdays: [1, 2, 3, 4, 5],
    flexibleTime: { start: 10, end: 10 },
    scope: { type: 'all', targets: [] },
    status: 'active',
    applicableCount: 1500
  },
  {
    id: 'rule002',
    name: 'ç ”å‘å¼¹æ€§å·¥ä½œæ—¶é—´',
    description: 'ç ”å‘éƒ¨é—¨å¼¹æ€§å·¥ä½œåˆ¶ï¼Œæ ¸å¿ƒå·¥ä½œæ—¶é—´10:00-16:00',
    startTime: '09:30',
    endTime: '19:00',
    breakStartTime: '12:30',
    breakEndTime: '13:30',
    weekdays: [1, 2, 3, 4, 5],
    flexibleTime: { start: 30, end: 30 },
    scope: { type: 'department', targets: ['dept001', 'dept002'] },
    status: 'active',
    applicableCount: 200
  }
];

export const mockExceptionRules = {
  late: [
    {
      id: 'late001',
      name: 'è¿Ÿåˆ°5åˆ†é’Ÿå†…',
      type: 'late',
      condition: 'minutes > 0 AND minutes <= 5',
      action: 'warning',
      message: 'è¿Ÿåˆ°${minutes}åˆ†é’Ÿï¼Œè¯·æ³¨æ„æ—¶é—´',
      status: 'active'
    },
    {
      id: 'late002',
      name: 'è¿Ÿåˆ°30åˆ†é’Ÿå†…',
      type: 'late',
      condition: 'minutes > 5 AND minutes <= 30',
      action: 'record',
      message: 'è¿Ÿåˆ°${minutes}åˆ†é’Ÿï¼Œå·²è®°å½•è€ƒå‹¤å¼‚å¸¸',
      status: 'active'
    }
  ],
  early: [
    {
      id: 'early001',
      name: 'æ—©é€€10åˆ†é’Ÿå†…',
      type: 'early',
      condition: 'minutes > 0 AND minutes <= 10',
      action: 'warning',
      message: 'æ—©é€€${minutes}åˆ†é’Ÿï¼Œè¯·æ³¨æ„å·¥ä½œæ—¶é—´',
      status: 'active'
    }
  ]
};

export const mockNotificationTemplates = [
  {
    id: 'tpl001',
    name: 'è¿Ÿåˆ°é€šçŸ¥æ¨¡æ¿',
    title: 'è€ƒå‹¤å¼‚å¸¸æé†’ - è¿Ÿåˆ°',
    content: 'å°Šæ•¬çš„${employeeName}ï¼Œæ‚¨ä»Šå¤©${time}æ‰“å¡ï¼Œå·²è¿Ÿåˆ°${minutes}åˆ†é’Ÿï¼Œè¯·å‡†æ—¶å‡ºå‹¤ã€‚',
    channels: ['app', 'email'],
    sceneId: 'late'
  },
  {
    id: 'tpl002',
    name: 'ç¼ºå‹¤é€šçŸ¥æ¨¡æ¿',
    title: 'è€ƒå‹¤å¼‚å¸¸æé†’ - ç¼ºå‹¤',
    content: 'å°Šæ•¬çš„${employeeName}ï¼Œæ‚¨ä»Šå¤©æœªæ‰“å¡ï¼Œè¯·åŠæ—¶è”ç³»éƒ¨é—¨ä¸»ç®¡è¯´æ˜æƒ…å†µã€‚',
    channels: ['app', 'sms'],
    sceneId: 'absent'
  }
];

export default {
  mockWorkTimeRules,
  mockExceptionRules,
  mockNotificationTemplates
};
```

## å¼€å‘æ³¨æ„äº‹é¡¹æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½è¦ç‚¹
1. **è§„åˆ™å¼•æ“** - çµæ´»çš„æ¡ä»¶é…ç½®å’Œæ‰§è¡Œé€»è¾‘
2. **åŠ¨æ€è¡¨å•** - æ ¹æ®è§„åˆ™ç±»å‹åŠ¨æ€ç”Ÿæˆé…ç½®è¡¨å•
3. **è§„åˆ™æµ‹è¯•** - å®æ—¶æµ‹è¯•è§„åˆ™æ•ˆæœå’Œå‡†ç¡®æ€§
4. **æ¨¡æ¿ç³»ç»Ÿ** - å¯é…ç½®çš„é€šçŸ¥æ¶ˆæ¯æ¨¡æ¿
5. **æƒé™æ§åˆ¶** - ä¸åŒè§’è‰²çš„è§„åˆ™ç®¡ç†æƒé™
6. **ç‰ˆæœ¬ç®¡ç†** - è§„åˆ™å˜æ›´çš„ç‰ˆæœ¬è¿½è¸ª

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. è§„åˆ™è§£æé‡‡ç”¨ç¼“å­˜æœºåˆ¶
2. æ‰¹é‡è§„åˆ™å¤„ç†ä¼˜åŒ–
3. åŠ¨æ€è¡¨å•ç»„ä»¶æ‡’åŠ è½½
4. è§„åˆ™æµ‹è¯•å¼‚æ­¥æ‰§è¡Œ

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. æä¾›è§„åˆ™å‘å¯¼å’Œæ¨¡æ¿
2. å®æ—¶é¢„è§ˆè§„åˆ™æ•ˆæœ
3. æ™ºèƒ½æç¤ºå’ŒéªŒè¯
4. å¯è§†åŒ–çš„è§„åˆ™é…ç½®

## æ€»ç»“

è§„åˆ™é…ç½®æ¨¡å—ä½œä¸ºç³»ç»Ÿçš„é…ç½®æ ¸å¿ƒï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š

- è§„åˆ™å®šä¹‰çš„çµæ´»æ€§å’Œæ‰©å±•æ€§
- é…ç½®ç•Œé¢çš„æ˜“ç”¨æ€§å’Œç›´è§‚æ€§
- è§„åˆ™æµ‹è¯•çš„å‡†ç¡®æ€§å’Œå®æ—¶æ€§
- æ¨¡æ¿ç³»ç»Ÿçš„å¯é…ç½®æ€§
- è§„åˆ™æ‰§è¡Œçš„æ•ˆç‡å’Œæ€§èƒ½

é€šè¿‡éµå¾ªæœ¬æ–‡æ¡£çš„æŠ€æœ¯è§„èŒƒï¼Œå¯ä»¥æ„å»ºå‡ºåŠŸèƒ½å®Œå–„ã€çµæ´»å¯æ‰©å±•çš„è§„åˆ™é…ç½®æ¨¡å—ã€‚