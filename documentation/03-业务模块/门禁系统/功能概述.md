# IOE-DREAMæ™ºèƒ½é—¨ç¦ç³»ç»Ÿ

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**
- [AccessControlController.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/controller/AccessControlController.java)
- [AccessControlService.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/service/AccessControlService.java)
- [DeviceService.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/service/DeviceService.java)
- [AreaService.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/service/AreaService.java)
- [AccessLogEntity.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/domain/entity/AccessLogEntity.java)
- [AccessDeviceEntity.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/domain/entity/AccessDeviceEntity.java)
- [access-control-api.js](file://smart-admin-web-javascript/src/api/business/security/access/access-control-api.js)
- [device-management.vue](file://smart-admin-web-javascript/src/views/business/security/access/device-management.vue)
- [area-management.vue](file://smart-admin-web-javascript/src/views/business/security/access/area-management.vue)
- [real-time-monitor.vue](file://smart-admin-web-javascript/src/views/business/security/access/real-time-monitor.vue)
- [access-const.js](file://smart-admin-web-javascript/src/constants/business/security/access-const.js)
</cite>

## ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
4. [è®¾å¤‡ç®¡ç†](#è®¾å¤‡ç®¡ç†)
5. [åŒºåŸŸæƒé™ç®¡ç†](#åŒºåŸŸæƒé™ç®¡ç†)
6. [å®æ—¶ç›‘æ§](#å®æ—¶ç›‘æ§)
7. [å¤šæ¨¡æ€è®¤è¯](#å¤šæ¨¡æ€è®¤è¯)
8. [è®¿é—®æ§åˆ¶æµç¨‹](#è®¿é—®æ§åˆ¶æµç¨‹)
9. [äº‹ä»¶è®°å½•ä¸å®¡è®¡](#äº‹ä»¶è®°å½•ä¸å®¡è®¡)
10. [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
11. [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)
12. [APIæ¥å£è®¾è®¡](#apiæ¥å£è®¾è®¡)
13. [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
14. [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)

## ç³»ç»Ÿæ¦‚è¿°

IOE-DREAMæ™ºèƒ½é—¨ç¦ç³»ç»Ÿæ˜¯æ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œé›†æˆå¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«æŠ€æœ¯ï¼Œæä¾›å…¨æ–¹ä½çš„å›­åŒºé—¨ç¦è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆã€‚ç³»ç»Ÿæ”¯æŒäººè„¸ã€æŒ‡çº¹ã€æŒçº¹ã€è™¹è†œç­‰å¤šç§è¯†åˆ«æ–¹å¼ï¼Œä¸ä¸€å¡é€šç®¡ç†æ·±åº¦èåˆï¼Œå®ç°æ— æ„Ÿé€šè¡Œã€æ™ºèƒ½ç®¡æ§ã€å®‰å…¨é¢„è­¦ç­‰åŠŸèƒ½ã€‚

### ç³»ç»Ÿç‰¹ç‚¹
- **å¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«**ï¼šé›†æˆäººè„¸ã€æŒ‡çº¹ã€æŒçº¹ã€è™¹è†œç­‰å¤šç§è¯†åˆ«æŠ€æœ¯
- **ä¸€å¡é€šæ·±åº¦èåˆ**ï¼šæ”¯æŒå¡ç‰‡ã€äººè„¸ã€æ‰‹æœºNFCç­‰å¤šç§é€šè¡Œæ–¹å¼
- **å®æ—¶ç›‘æ§é¢„è­¦**ï¼š24å°æ—¶å®æ—¶ç›‘æ§ï¼Œå¼‚å¸¸è¡Œä¸ºæ™ºèƒ½é¢„è­¦
- **çµæ´»æƒé™ç®¡ç†**ï¼šåŸºäºè§’è‰²ã€æ—¶é—´ã€åŒºåŸŸçš„ç²¾ç»†åŒ–æƒé™æ§åˆ¶
- **é«˜å¯é æ€§**ï¼šåˆ†å¸ƒå¼æ¶æ„ï¼Œæ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Œ99.99%å¯ç”¨æ€§
- **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒå¤§è§„æ¨¡éƒ¨ç½²ï¼Œè½»æ¾æ‰©å±•åˆ°æ•°ä¸‡é—¨ç¦ç‚¹

## ç³»ç»Ÿæ¶æ„
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### æ•´ä½“æ¶æ„å›¾
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼
```mermaid
graph TB
subgraph "IOE-DREAMæ™ºèƒ½é—¨ç¦ç³»ç»Ÿæ¶æ„"
A[ç”¨æˆ·å±‚] --> B[åº”ç”¨å±‚]
B --> C[ä¸šåŠ¡å±‚]
C --> D[æ•°æ®å±‚]
D --> E[è®¾å¤‡å±‚]

A --> A1[Webç®¡ç†ç«¯]
A --> A2[ç§»åŠ¨App]
A --> A3[é—¨ç¦ç»ˆç«¯]
A --> A4[è‡ªåŠ©æœåŠ¡æœº]

B --> B1[é—¨ç¦ç®¡ç†æœåŠ¡]
B --> B2[è®¾å¤‡ç®¡ç†æœåŠ¡]
B --> B3[æƒé™ç®¡ç†æœåŠ¡]
B --> B4[ç›‘æ§æœåŠ¡]
B --> B5[æŠ¥è¡¨æœåŠ¡]

C --> C1[è®¿é—®æ§åˆ¶å¼•æ“]
C --> C2[ç”Ÿç‰©è¯†åˆ«å¼•æ“]
C --> C3[è§„åˆ™å¼•æ“]
C --> C4[æŠ¥è­¦å¼•æ“]
C --> C5[æ—¥å¿—å®¡è®¡å¼•æ“]

D --> D1[ç”¨æˆ·æ•°æ®åº“]
D --> D2[è®¾å¤‡æ•°æ®åº“]
D --> D3[æƒé™æ•°æ®åº“]
D --> D4[æ—¥å¿—æ•°æ®åº“]
D --> D5[æ–‡ä»¶å­˜å‚¨]

E --> E1[æ™ºèƒ½é—¨ç¦æœº]
E --> E2[äººè„¸è¯†åˆ«ç»ˆç«¯]
E --> E3[æŒ‡çº¹è¯†åˆ«å™¨]
E --> E4[æŒçº¹è¯†åˆ«å™¨]
E --> E5[è™¹è†œè¯†åˆ«å™¨]
E --> E6[NFCè¯»å¡å™¨]
E --> E7[æ‘„åƒå¤´]
E --> E8[é—¨é”æ§åˆ¶å™¨]
end
```

### ä¸šåŠ¡æµç¨‹æ¶æ„
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant D as é—¨ç¦è®¾å¤‡
    participant S as è®¿é—®æ§åˆ¶æœåŠ¡
    participant B as ç”Ÿç‰©è¯†åˆ«æœåŠ¡
    participant P as æƒé™ç®¡ç†æœåŠ¡
    participant M as ç›‘æ§æœåŠ¡
    participant L as æ—¥å¿—æœåŠ¡

    U->>D: æ¥è¿‘é—¨ç¦
    D->>S: è®¤è¯è¯·æ±‚
    S->>B: ç”Ÿç‰©ç‰¹å¾é‡‡é›†
    B->>B: ç‰¹å¾æ¯”å¯¹
    B-->>S: è®¤è¯ç»“æœ
    S->>P: æƒé™éªŒè¯
    P-->>S: æƒé™çŠ¶æ€
    S->>M: çŠ¶æ€æ›´æ–°
    M-->>S: æ›´æ–°ç¡®è®¤
    S-->>D: å¼€é—¨æŒ‡ä»¤
    D->>U: é—¨ç¦å¼€å¯
    S->>L: è®°å½•è®¿é—®æ—¥å¿—
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### åŠŸèƒ½æ¨¡å—æ¶æ„
```mermaid
graph TB
subgraph "æ™ºèƒ½é—¨ç¦ç³»ç»ŸåŠŸèƒ½æ¨¡å—"
A[è®¾å¤‡ç®¡ç†æ¨¡å—] --> A1[é—¨ç¦è®¾å¤‡ç®¡ç†]
A --> A2[ç”Ÿç‰©è¯†åˆ«è®¾å¤‡]
A --> A3[è¾…åŠ©è®¾å¤‡]
A --> A4[è®¾å¤‡çŠ¶æ€ç›‘æ§]

B[åŒºåŸŸæƒé™æ¨¡å—] --> B1[åŒºåŸŸç®¡ç†]
B --> B2[æƒé™åˆ†é…]
B --> B3[æ—¶é—´æƒé™]
B --> B4[è®¿å®¢æƒé™]

C[å®æ—¶ç›‘æ§æ¨¡å—] --> C1[å®æ—¶çŠ¶æ€ç›‘æ§]
C --> C2[å¼‚å¸¸æŠ¥è­¦]
C --> C3[è§†é¢‘è”åŠ¨]
C --> C4[äººå‘˜è¿½è¸ª]

D[è®¿é—®æ§åˆ¶æ¨¡å—] --> D1[å¤šæ¨¡æ€è®¤è¯]
D --> D2[é€šè¡Œç­–ç•¥]
D --> D3[åæ½œè§„åˆ™]
D --> D4[è”åŠ¨æ§åˆ¶]

E[äº‹ä»¶è®°å½•æ¨¡å—] --> E1[è®¿é—®æ—¥å¿—]
E --> E2[å¼‚å¸¸äº‹ä»¶]
E --> E3[ç»Ÿè®¡æŠ¥è¡¨]
E --> E4[æ•°æ®å¤‡ä»½]

F[ç³»ç»Ÿç®¡ç†æ¨¡å—] --> F1[ç”¨æˆ·ç®¡ç†]
F --> F2[å‚æ•°é…ç½®]
F --> F3[ç³»ç»Ÿç›‘æ§]
F --> F4[å¤‡ä»½æ¢å¤]
end
```

## è®¾å¤‡ç®¡ç†

### è®¾å¤‡ç±»å‹ç®¡ç†
```mermaid
graph LR
subgraph "é—¨ç¦è®¾å¤‡ç±»å‹"
A[é—¨ç¦æ§åˆ¶å™¨] --> A1[å•é—¨æ§åˆ¶å™¨]
A --> A2[åŒé—¨æ§åˆ¶å™¨]
A --> A3[å››é—¨æ§åˆ¶å™¨]
A --> A4[ç½‘ç»œæ§åˆ¶å™¨]

B[è¯†åˆ«è®¾å¤‡] --> B1[äººè„¸è¯†åˆ«ç»ˆç«¯]
B --> B2[æŒ‡çº¹è¯†åˆ«å™¨]
B --> B3[æŒçº¹è¯†åˆ«å™¨]
B --> B4[è™¹è†œè¯†åˆ«å™¨]
B --> B5[NFCè¯»å¡å™¨]

C[è¾“å‡ºè®¾å¤‡] --> C1[ç”µé”]
C --> C2[é—¨ç£]
C --> C3[å‡ºé—¨æŒ‰é’®]
C --> C4[å£°å…‰æŠ¥è­¦å™¨]

D[è¾…åŠ©è®¾å¤‡] --> D1[æ‘„åƒå¤´]
D --> D2[çº¢å¤–æ¢æµ‹å™¨]
D --> D3[çƒŸé›¾ä¼ æ„Ÿå™¨]
D --> D4[æ¸©åº¦ä¼ æ„Ÿå™¨]
end
```

### è®¾å¤‡ç®¡ç†åŠŸèƒ½
#### 1. è®¾å¤‡æ³¨å†Œä¸é…ç½®
```java
public class DeviceManagementService {

    // è®¾å¤‡æ³¨å†Œ
    public DeviceRegistrationResult registerDevice(DeviceRegistrationRequest request) {
        // 1. éªŒè¯è®¾å¤‡å”¯ä¸€æ€§
        if (deviceRepository.existsByDeviceId(request.getDeviceId())) {
            throw new DeviceAlreadyExistsException();
        }

        // 2. åˆ›å»ºè®¾å¤‡è®°å½•
        AccessDeviceEntity device = new AccessDeviceEntity();
        device.setDeviceId(request.getDeviceId());
        device.setDeviceName(request.getDeviceName());
        device.setDeviceType(request.getDeviceType());
        device.setLocation(request.getLocation());
        device.setStatus(DeviceStatus.OFFLINE);

        // 3. åˆ†é…ç½‘ç»œé…ç½®
        NetworkConfig networkConfig = allocateNetworkConfig(request.getDeviceType());
        device.setNetworkConfig(networkConfig);

        // 4. ç”Ÿæˆå®‰å…¨å¯†é’¥
        SecurityKey securityKey = generateSecurityKey();
        device.setSecurityKey(securityKey);

        // 5. ä¿å­˜è®¾å¤‡ä¿¡æ¯
        deviceRepository.save(device);

        // 6. ä¸‹å‘é…ç½®åˆ°è®¾å¤‡
        deviceConfigService.pushConfigToDevice(device);

        return DeviceRegistrationResult.success(device.getId());
    }

    // è®¾å¤‡çŠ¶æ€ç›‘æ§
    public void monitorDeviceStatus() {
        List<AccessDeviceEntity> devices = deviceRepository.findAll();

        for (AccessDeviceEntity device : devices) {
            try {
                // å‘é€å¿ƒè·³æ£€æµ‹
                DeviceHeartbeatResponse heartbeat = deviceCommunicationService.sendHeartbeat(device);

                // æ›´æ–°è®¾å¤‡çŠ¶æ€
                updateDeviceStatus(device.getId(), heartbeat.getStatus());

                // æ£€æŸ¥è®¾å¤‡å¥åº·çŠ¶æ€
                if (heartbeat.getStatus() == DeviceStatus.OFFLINE &&
                    device.getOfflineDuration() > MAX_OFFLINE_DURATION) {
                    alarmService.sendDeviceOfflineAlarm(device);
                }

            } catch (Exception e) {
                log.error("è®¾å¤‡çŠ¶æ€ç›‘æ§å¤±è´¥: {}", device.getDeviceId(), e);
                updateDeviceStatus(device.getId(), DeviceStatus.ERROR);
            }
        }
    }
}
```

#### 2. è®¾å¤‡é…ç½®ç®¡ç†
```yaml
# è®¾å¤‡é…ç½®ç¤ºä¾‹
device_config:
  device_id: "ACCESS_001"
  device_name: "ä¸»æ¥¼å‰é—¨"
  device_type: "FACE_RECOGNITION_TERMINAL"
  location: "ä¸»æ¥¼1å±‚å¤§å…"

  network_config:
    ip_address: "192.168.1.100"
    subnet_mask: "255.255.255.0"
    gateway: "192.168.1.1"
    port: 8080

  security_config:
    encryption_key: "generated_key_here"
    authentication_method: "multi_factor"
    timeout_seconds: 30

  recognition_config:
    face_recognition:
      enabled: true
      threshold: 0.8
      liveness_check: true
    fingerprint_recognition:
      enabled: true
      threshold: 0.85
    card_reading:
      enabled: true
      card_types: ["IC_CARD", "CPU_CARD", "NFC_CARD"]

  access_control:
    default_action: "DENY"
    relay_duration: 5000  # å¼€é—¨æ—¶é•¿(æ¯«ç§’)
    door_sensor_monitoring: true
    anti_passback: true
```

### è®¾å¤‡è¿ç»´ç®¡ç†
#### è®¾å¤‡ç›‘æ§æŒ‡æ ‡
```mermaid
graph TB
subgraph "è®¾å¤‡ç›‘æ§æŒ‡æ ‡ä½“ç³»"
A[è®¾å¤‡çŠ¶æ€ç›‘æ§] --> A1[åœ¨çº¿/ç¦»çº¿çŠ¶æ€]
A --> A2[è®¾å¤‡å¥åº·åº¦]
A --> A3[ç½‘ç»œè¿æ¥è´¨é‡]
A --> A4[ç”µæºçŠ¶æ€]

B[æ€§èƒ½ç›‘æ§] --> B1[å“åº”æ—¶é—´]
B --> B2[è¯†åˆ«å‡†ç¡®ç‡]
B --> B3[å¤„ç†å¹¶å‘æ•°]
B --> B4[é”™è¯¯ç‡]

C[ä¸šåŠ¡ç›‘æ§] --> C1[é€šè¡ŒæˆåŠŸç‡]
C --> C2[å¼‚å¸¸é€šè¡Œæ¬¡æ•°]
C --> C3[å¹³å‡é€šè¡Œæ—¶é—´]
C --> C4[é«˜å³°æœŸå¤„ç†èƒ½åŠ›]

D[ç¯å¢ƒç›‘æ§] --> D1[æ¸©åº¦]
D --> D2[æ¹¿åº¦]
D --> D3[å…‰ç…§æ¡ä»¶]
D --> D4[ç”µç£å¹²æ‰°]
end
```

## åŒºåŸŸæƒé™ç®¡ç†

### åŒºåŸŸç®¡ç†æ¶æ„
```mermaid
graph TB
subgraph "åŒºåŸŸæƒé™ç®¡ç†ä½“ç³»"
A[å›­åŒºçº§] --> B[æ¥¼æ ‹çº§]
B --> C[æ¥¼å±‚çº§]
C --> D[åŒºåŸŸçº§]
D --> E[é—¨ç¦ç‚¹çº§]

A --> A1[æ•´ä½“å›­åŒº]
B --> B1[åŠå…¬æ¥¼A]
B --> B2[åŠå…¬æ¥¼B]
B --> B3[ç”Ÿäº§è½¦é—´]
C --> C1[1æ¥¼]
C --> C2[2æ¥¼]
C --> C3[3æ¥¼]
D --> D1[ç ”å‘åŒº]
D --> D2[åŠå…¬åŒº]
D --> D3[ä¼šè®®åŒº]
D --> D4[æœºæˆ¿]
E --> E1[å‰é—¨]
E --> E2[ä¾§é—¨]
E --> E3[åé—¨]
E --> E4[æ¶ˆé˜²é€šé“]
```

### æƒé™ç®¡ç†æ¨¡å‹
```java
public class PermissionManagementService {

    // æƒé™åˆ†é…
    public void assignUserPermission(AssignPermissionRequest request) {
        // 1. éªŒè¯ç”¨æˆ·å’ŒåŒºåŸŸæœ‰æ•ˆæ€§
        UserEntity user = userRepository.findById(request.getUserId());
        AreaEntity area = areaRepository.findById(request.getAreaId());

        // 2. æ£€æŸ¥æƒé™å†²çª
        if (hasPermissionConflict(user, area, request.getPermission())) {
            throw new PermissionConflictException();
        }

        // 3. åˆ›å»ºæƒé™è®°å½•
        UserPermissionEntity permission = new UserPermissionEntity();
        permission.setUserId(request.getUserId());
        permission.setAreaId(request.getAreaId());
        permission.setPermissionType(request.getPermissionType());
        permission.setStartTime(request.getStartTime());
        permission.setEndTime(request.getEndTime());
        permission.setValidDays(request.getValidDays());
        permission.setTimeSlots(request.getTimeSlots());

        // 4. åº”ç”¨åæ½œè§„åˆ™
        if (request.isAntiPassback()) {
            enableAntiPassback(user.getId(), area.getId());
        }

        // 5. æ›´æ–°ç¼“å­˜
        permissionCache.updateUserPermission(user.getId(), permission);

        // 6. ä¸‹å‘æƒé™åˆ°è®¾å¤‡
        devicePermissionService.pushPermissionToDevices(area.getDeviceIds(), permission);
    }

    // æƒé™éªŒè¯
    public PermissionVerificationResult verifyPermission(String userId, String areaId) {
        // 1. è·å–ç”¨æˆ·æƒé™
        List<UserPermissionEntity> permissions = getValidPermissions(userId, areaId);

        // 2. æ£€æŸ¥æ—¶é—´æœ‰æ•ˆæ€§
        LocalDateTime now = LocalDateTime.now();
        for (UserPermissionEntity permission : permissions) {
            if (isTimeValid(permission, now) && isDayValid(permission, now)) {
                return PermissionVerificationResult.granted(permission);
            }
        }

        // 3. æ£€æŸ¥ç‰¹æ®Šæƒé™ï¼ˆä¸´æ—¶æƒé™ã€ç´§æ€¥æƒé™ç­‰ï¼‰
        SpecialPermission specialPermission = checkSpecialPermission(userId, areaId);
        if (specialPermission != null) {
            return PermissionVerificationResult.granted(specialPermission);
        }

        return PermissionVerificationResult.denied("æ— æœ‰æ•ˆæƒé™");
    }
}
```

### æ—¶é—´æƒé™é…ç½®
```mermaid
graph TB
subgraph "æ—¶é—´æƒé™é…ç½®"
A[åŸºç¡€æ—¶é—´æƒé™] --> A1[å·¥ä½œæ—¥æƒé™]
A --> A2[å‘¨æœ«æƒé™]
A --> A3[èŠ‚å‡æ—¥æƒé™]

B[æ—¶é—´æ®µæƒé™] --> B1[ä¸Šåˆæ—¶æ®µ]
B --> B2[ä¸‹åˆæ—¶æ®µ]
B --> B3[å¤œé—´æ—¶æ®µ]
B --> B4[ç‰¹æ®Šæ—¶æ®µ]

C[ä¸´æ—¶æƒé™] --> C1[ä¸´æ—¶è®¿å®¢æƒé™]
C --> C2[ç´§æ€¥é€šè¡Œæƒé™]
C --> C3[ç»´æŠ¤æƒé™]

D[æƒé™ç»„åˆ] --> D1[å¤šæ—¶é—´æ®µç»„åˆ]
D --> D2[å¤šåŒºåŸŸç»„åˆ]
D --> D3[æƒé™ç»§æ‰¿]
end
```

#### æ—¶é—´æƒé™å®ç°ç¤ºä¾‹
```java
public class TimePermissionService {

    public boolean isTimeValid(UserPermissionEntity permission, LocalDateTime currentTime) {
        // 1. æ£€æŸ¥æœ‰æ•ˆæœŸèŒƒå›´
        if (currentTime.isBefore(permission.getStartTime()) ||
            currentTime.isAfter(permission.getEndTime())) {
            return false;
        }

        // 2. æ£€æŸ¥æ˜ŸæœŸæƒé™
        DayOfWeek currentDay = currentTime.getDayOfWeek();
        if (!permission.getValidDays().contains(currentDay.getValue())) {
            return false;
        }

        // 3. æ£€æŸ¥æ—¶é—´æ®µæƒé™
        LocalTime currentTimeOnly = currentTime.toLocalTime();
        for (TimeSlot timeSlot : permission.getTimeSlots()) {
            if (currentTimeOnly.isAfter(timeSlot.getStartTime()) &&
                currentTimeOnly.isBefore(timeSlot.getEndTime())) {
                return true;
            }
        }

        return false;
    }

    // åŠ¨æ€æƒé™è°ƒæ•´
    public void adjustDynamicPermissions() {
        LocalDateTime now = LocalDateTime.now();

        // é«˜å³°æœŸæƒé™è°ƒæ•´
        if (isPeakHours(now)) {
            adjustPeakHourPermissions(now);
        }

        // ç‰¹æ®Šäº‹ä»¶æƒé™è°ƒæ•´
        SpecialEvent currentEvent = getCurrentSpecialEvent();
        if (currentEvent != null) {
            applySpecialEventPermissions(currentEvent);
        }

        // ç´§æ€¥æƒ…å†µæƒé™è°ƒæ•´
        EmergencyStatus emergencyStatus = getEmergencyStatus();
        if (emergencyStatus.isActive()) {
            applyEmergencyPermissions(emergencyStatus);
        }
    }
}
```

## å®æ—¶ç›‘æ§

### å®æ—¶ç›‘æ§æ¶æ„
```mermaid
graph TB
subgraph "å®æ—¶ç›‘æ§ç³»ç»Ÿæ¶æ„"
A[æ•°æ®é‡‡é›†å±‚] --> B[æ•°æ®å¤„ç†å±‚]
B --> C[ç›‘æ§å±•ç¤ºå±‚]
C --> D[å‘Šè­¦å¤„ç†å±‚]

A --> A1[è®¾å¤‡çŠ¶æ€é‡‡é›†]
A --> A2[é€šè¡Œäº‹ä»¶é‡‡é›†]
A --> A3[å¼‚å¸¸äº‹ä»¶é‡‡é›†]
A --> A4[ç¯å¢ƒæ•°æ®é‡‡é›†]

B --> B1[äº‹ä»¶è¿‡æ»¤]
B --> B2[æ•°æ®èšåˆ]
B --> B3[è§„åˆ™å¼•æ“]
B --> B4[çŠ¶æ€è®¡ç®—]

C --> C1[å®æ—¶çŠ¶æ€å¤§å±]
C --> C2[è®¾å¤‡çŠ¶æ€å›¾è¡¨]
C --> C3[é€šè¡Œæµé‡ç»Ÿè®¡]
C --> C4[å¼‚å¸¸äº‹ä»¶å±•ç¤º]

D --> D1[å®æ—¶å‘Šè­¦]
D --> D2[å‘Šè­¦å‡çº§]
D --> D3[å‘Šè­¦é€šçŸ¥]
D --> D4[å‘Šè­¦å¤„ç†]
end
```

### ç›‘æ§åŠŸèƒ½å®ç°
```java
@Service
public class RealTimeMonitoringService {

    @EventListener
    @Async
    public void handleAccessEvent(AccessEvent event) {
        // 1. å®æ—¶æ›´æ–°è®¾å¤‡çŠ¶æ€
        deviceStatusService.updateDeviceStatus(event.getDeviceId(), event.getStatus());

        // 2. æ›´æ–°åŒºåŸŸå ç”¨çŠ¶æ€
        areaOccupancyService.updateAreaOccupancy(event.getAreaId(), event.getAccessType());

        // 3. æ£€æŸ¥å¼‚å¸¸æƒ…å†µ
        checkForAnomalies(event);

        // 4. æ¨é€å®æ—¶æ•°æ®åˆ°å‰ç«¯
        websocketService.pushAccessEvent(event);

        // 5. è§¦å‘è”åŠ¨æ§åˆ¶
        triggerLinkedControls(event);
    }

    private void checkForAnomalies(AccessEvent event) {
        // æ£€æŸ¥é‡å¤é€šè¡Œ
        if (isDuplicateAccess(event)) {
            alarmService.sendAlarm(AlarmType.DUPLICATE_ACCESS, event);
        }

        // æ£€æŸ¥å¼‚å¸¸æ—¶é—´æ®µé€šè¡Œ
        if (isAbnormalTimeAccess(event)) {
            alarmService.sendAlarm(AlarmType.ABNORMAL_TIME_ACCESS, event);
        }

        // æ£€æŸ¥æƒé™å¼‚å¸¸
        if (isPermissionAnomaly(event)) {
            alarmService.sendAlarm(AlarmType.PERMISSION_ANOMALY, event);
        }

        // æ£€æŸ¥è®¾å¤‡å¼‚å¸¸
        if (isDeviceAnomaly(event)) {
            alarmService.sendAlarm(AlarmType.DEVICE_ANOMALY, event);
        }
    }
}
```

### ç›‘æ§å¤§å±å±•ç¤º
```mermaid
graph TB
subgraph "å®æ—¶ç›‘æ§å¤§å±å¸ƒå±€"
A[é¡¶éƒ¨æ ‡é¢˜åŒº] --> A1[ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ]
A --> A2[å½“å‰æ—¶é—´]
A --> A3[å¤©æ°”ä¿¡æ¯]

B[å·¦ä¾§çŠ¶æ€åŒº] --> B1[è®¾å¤‡åœ¨çº¿ç‡]
B --> B2[ä»Šæ—¥é€šè¡Œç»Ÿè®¡]
B --> B3[å¼‚å¸¸äº‹ä»¶ç»Ÿè®¡]
B --> B4[ç³»ç»Ÿå‘Šè­¦ä¿¡æ¯]

C[ä¸­å¤®åœ°å›¾åŒº] --> C1[å›­åŒºå¹³é¢å›¾]
C --> C2[è®¾å¤‡åˆ†å¸ƒå›¾]
C --> C3[å®æ—¶äººå‘˜ä½ç½®]
C --> C4[é€šè¡Œçƒ­åŠ›å›¾]

D[å³ä¾§è¯¦æƒ…åŒº] --> D1[å®æ—¶é€šè¡Œè®°å½•]
D --> D2[è®¾å¤‡çŠ¶æ€åˆ—è¡¨]
D --> D3[ç›‘æ§è§†é¢‘ç”»é¢]
D --> D4[äº‹ä»¶å¤„ç†çŠ¶æ€]

E[åº•éƒ¨å›¾è¡¨åŒº] --> E1[é€šè¡Œæµé‡è¶‹åŠ¿]
E --> E2[åŒºåŸŸå ç”¨ç»Ÿè®¡]
E --> E3[è®¾å¤‡æ€§èƒ½æŒ‡æ ‡]
E --> E4[æƒé™ä½¿ç”¨ç»Ÿè®¡]
end
```

## å¤šæ¨¡æ€è®¤è¯

### è®¤è¯æµç¨‹è®¾è®¡
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant T as ç»ˆç«¯è®¾å¤‡
    participant R as è®¤è¯è·¯ç”±å™¨
    participant F as äººè„¸è¯†åˆ«
    participant G as æŒ‡çº¹è¯†åˆ«
    participant C as å¡ç‰‡è¯»å–
    participant P as æƒé™éªŒè¯
    participant A as è®¿é—®æ§åˆ¶

    U->>T: æ¥è¿‘ç»ˆç«¯
    T->>R: å¯åŠ¨è®¤è¯
    R->>T: é‡‡é›†äººè„¸
    T->>F: å‘é€äººè„¸æ•°æ®
    F-->>R: äººè„¸è¯†åˆ«ç»“æœ
    alt äººè„¸è¯†åˆ«æˆåŠŸ
        R->>P: éªŒè¯æƒé™
        P-->>R: æƒé™éªŒè¯ç»“æœ
        alt æƒé™éªŒè¯æˆåŠŸ
            R-->>T: è®¤è¯æˆåŠŸ
            T->>A: å¼€é—¨æŒ‡ä»¤
            A-->>U: é—¨ç¦å¼€å¯
        else æƒé™éªŒè¯å¤±è´¥
            R->>G: è¦æ±‚äºŒæ¬¡è®¤è¯
            T->>G: é‡‡é›†æŒ‡çº¹
            G-->>R: æŒ‡çº¹è¯†åˆ«ç»“æœ
            alt æŒ‡çº¹è¯†åˆ«æˆåŠŸ
                R->>P: éªŒè¯æƒé™
                P-->>R: æƒé™éªŒè¯ç»“æœ
                alt æƒé™éªŒè¯æˆåŠŸ
                    R-->>T: è®¤è¯æˆåŠŸ
                    T->>A: å¼€é—¨æŒ‡ä»¤
                    A-->>U: é—¨ç¦å¼€å¯
                else æƒé™éªŒè¯å¤±è´¥
                    R-->>T: è®¤è¯å¤±è´¥
                    T-->>U: æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯
                end
            else æŒ‡çº¹è¯†åˆ«å¤±è´¥
                R->>C: è¦æ±‚åˆ·å¡è®¤è¯
                T->>C: è¯»å–å¡ç‰‡
                C-->>R: å¡ç‰‡ä¿¡æ¯
                R->>P: éªŒè¯æƒé™
                P-->>R: æƒé™éªŒè¯ç»“æœ
                alt æƒé™éªŒè¯æˆåŠŸ
                    R-->>T: è®¤è¯æˆåŠŸ
                    T->>A: å¼€é—¨æŒ‡ä»¤
                    A-->>U: é—¨ç¦å¼€å¯
                else æƒé™éªŒè¯å¤±è´¥
                    R-->>T: è®¤è¯å¤±è´¥
                    T-->>U: æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯
                end
            end
        end
    else äººè„¸è¯†åˆ«å¤±è´¥
        R->>G: å¯åŠ¨æŒ‡çº¹è®¤è¯
        T->>G: é‡‡é›†æŒ‡çº¹
        G-->>R: æŒ‡çº¹è¯†åˆ«ç»“æœ
        alt æŒ‡çº¹è¯†åˆ«æˆåŠŸ
            R->>P: éªŒè¯æƒé™
            P-->>R: æƒé™éªŒè¯ç»“æœ
            alt æƒé™éªŒè¯æˆåŠŸ
                R-->>T: è®¤è¯æˆåŠŸ
                T->>A: å¼€é—¨æŒ‡ä»¤
                A-->>U: é—¨ç¦å¼€å¯
            else æƒé™éªŒè¯å¤±è´¥
                R->>C: è¦æ±‚åˆ·å¡è®¤è¯
                T->>C: è¯»å–å¡ç‰‡
                C-->>R: å¡ç‰‡ä¿¡æ¯
                R->>P: éªŒè¯æƒé™
                P-->>R: æƒé™éªŒè¯ç»“æœ
                alt æƒé™éªŒè¯æˆåŠŸ
                    R-->>T: è®¤è¯æˆåŠŸ
                    T->>A: å¼€é—¨æŒ‡ä»¤
                    A-->>U: é—¨ç¦å¼€å¯
                else æƒé™éªŒè¯å¤±è´¥
                    R-->>T: è®¤è¯å¤±è´¥
                    T-->>U: æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯
                end
            end
        else æŒ‡çº¹è¯†åˆ«å¤±è´¥
            R->>C: å¯åŠ¨åˆ·å¡è®¤è¯
            T->>C: è¯»å–å¡ç‰‡
            C-->>R: å¡ç‰‡ä¿¡æ¯
            R->>P: éªŒè¯æƒé™
            P-->>R: æƒé™éªŒè¯ç»“æœ
            alt æƒé™éªŒè¯æˆåŠŸ
                R-->>T: è®¤è¯æˆåŠŸ
                T->>A: å¼€é—¨æŒ‡ä»¤
                A-->>U: é—¨ç¦å¼€å¯
            else æƒé™éªŒè¯å¤±è´¥
                R-->>T: è®¤è¯å¤±è´¥
                T-->>U: æ˜¾ç¤ºå¤±è´¥ä¿¡æ¯
            end
        end
    end
```

### è®¤è¯ç­–ç•¥é…ç½®
```java
public class AuthenticationStrategyService {

    // æ ¹æ®åŒºåŸŸå®‰å…¨çº§åˆ«ç¡®å®šè®¤è¯ç­–ç•¥
    public AuthenticationStrategy getAuthenticationStrategy(String areaId) {
        AreaSecurityLevel securityLevel = areaService.getSecurityLevel(areaId);

        AuthenticationStrategy strategy = new AuthenticationStrategy();

        switch (securityLevel) {
            case LOW:
                strategy.setRequiredMethods(Arrays.asList(AuthenticationMethod.CARD));
                strategy.setFallbackEnabled(false);
                break;

            case MEDIUM:
                strategy.setRequiredMethods(Arrays.asList(AuthenticationMethod.CARD));
                strategy.setOptionalMethods(Arrays.asList(AuthenticationMethod.FACE));
                strategy.setFallbackEnabled(true);
                break;

            case HIGH:
                strategy.setRequiredMethods(Arrays.asList(AuthenticationMethod.FACE));
                strategy.setOptionalMethods(Arrays.asList(AuthenticationMethod.FINGERPRINT));
                strategy.setFallbackEnabled(true);
                strategy.setLivenessCheckRequired(true);
                break;

            case CRITICAL:
                strategy.setRequiredMethods(Arrays.asList(AuthenticationMethod.FACE, AuthenticationMethod.FINGERPRINT));
                strategy.setOptionalMethods(Arrays.asList(AuthenticationMethod.IRIS));
                strategy.setFallbackEnabled(false);
                strategy.setLivenessCheckRequired(true);
                strategy.setAntiPassbackRequired(true);
                break;
        }

        return strategy;
    }

    // å¤šæ¨¡æ€èåˆè®¤è¯
    public AuthenticationResult performMultiModalAuthentication(MultiModalAuthRequest request) {
        List<AuthenticationScore> scores = new ArrayList<>();

        // 1. æ‰§è¡Œå„ç§è®¤è¯æ–¹å¼
        for (AuthenticationMethod method : request.getMethods()) {
            AuthenticationResult result = authenticate(method, request.getData(method));
            if (result.isSuccess()) {
                scores.add(new AuthenticationScore(method, result.getConfidence()));
            } else if (isRequiredMethod(method)) {
                return AuthenticationResult.failure("å¿…éœ€è®¤è¯å¤±è´¥: " + method);
            }
        }

        // 2. èåˆè®¤è¯ç»“æœ
        double fusedScore = fusionEngine.fuseScores(scores);
        if (fusedScore >= getAuthenticationThreshold()) {
            return AuthenticationResult.success(fusedScore);
        } else {
            return AuthenticationResult.failure("èåˆè®¤è¯åˆ†æ•°ä¸è¶³: " + fusedScore);
        }
    }
}
```

## è®¿é—®æ§åˆ¶æµç¨‹

### æ ‡å‡†è®¿é—®æµç¨‹
```mermaid
graph TB
subgraph "æ ‡å‡†è®¿é—®æ§åˆ¶æµç¨‹"
A[ç”¨æˆ·æ¥è¿‘] --> B[èº«ä»½é‡‡é›†]
B --> C{è®¤è¯æ–¹å¼é€‰æ‹©}
C --> |äººè„¸è¯†åˆ«| D[äººè„¸è®¤è¯]
C --> |æŒ‡çº¹è¯†åˆ«| E[æŒ‡çº¹è®¤è¯]
C --> |åˆ·å¡è®¤è¯| F[å¡ç‰‡è®¤è¯]
C --> |å¤šæ¨¡æ€| G[å¤šæ¨¡æ€è®¤è¯]

D --> H{è®¤è¯ç»“æœ}
E --> H
F --> H
G --> H

H --> |æˆåŠŸ| I[æƒé™éªŒè¯]
H --> |å¤±è´¥| J[æ‹’ç»è®¿é—®]

I --> K{æƒé™æ£€æŸ¥}
K --> |æœ‰æƒé™| L[å¼€é—¨æŒ‡ä»¤]
K --> |æ— æƒé™| J

L --> M[é—¨ç¦å¼€å¯]
M --> N[è®°å½•æ—¥å¿—]
N --> O[çŠ¶æ€æ›´æ–°]
end
```

### è®¿é—®æ§åˆ¶ç®—æ³•å®ç°
```java
@Service
public class AccessControlService {

    public AccessControlResult processAccess(AccessRequest request) {
        try {
            // 1. èº«ä»½è®¤è¯
            AuthenticationResult authResult = authenticationService.authenticate(request);
            if (!authResult.isSuccess()) {
                return AccessControlResult.denied("è®¤è¯å¤±è´¥: " + authResult.getReason());
            }

            // 2. æƒé™éªŒè¯
            PermissionVerificationResult permissionResult = permissionService.verifyPermission(
                authResult.getUserId(),
                request.getAreaId()
            );

            if (!permissionResult.isGranted()) {
                return AccessControlResult.denied("æƒé™ä¸è¶³: " + permissionResult.getReason());
            }

            // 3. åæ½œæ£€æŸ¥
            if (isAntiPassbackEnabled(request.getAreaId())) {
                if (antiPassbackService.checkViolation(authResult.getUserId(), request.getAreaId())) {
                    return AccessControlResult.denied("åæ½œè§„åˆ™è¿å");
                }
            }

            // 4. å®¹é‡æ§åˆ¶
            if (isCapacityControlEnabled(request.getAreaId())) {
                if (!capacityControlService.checkCapacity(request.getAreaId())) {
                    return AccessControlResult.denied("åŒºåŸŸäººå‘˜å·²æ»¡");
                }
            }

            // 5. æ‰§è¡Œå¼€é—¨æ“ä½œ
            boolean doorOpened = doorControllerService.openDoor(request.getDeviceId());
            if (!doorOpened) {
                return AccessControlResult.denied("å¼€é—¨å¤±è´¥");
            }

            // 6. è®°å½•æˆåŠŸè®¿é—®
            accessLogService.logSuccessfulAccess(request, authResult);

            return AccessControlResult.granted();

        } catch (Exception e) {
            log.error("è®¿é—®æ§åˆ¶å¤„ç†å¼‚å¸¸", e);
            accessLogService.logFailedAccess(request, e.getMessage());
            return AccessControlResult.denied("ç³»ç»Ÿå¼‚å¸¸");
        }
    }
}
```

### å¼‚å¸¸å¤„ç†æœºåˆ¶
```mermaid
graph TB
subgraph "å¼‚å¸¸å¤„ç†æœºåˆ¶"
A[å¼‚å¸¸æ£€æµ‹] --> B{å¼‚å¸¸ç±»å‹}
B --> |è®¾å¤‡å¼‚å¸¸| C[è®¾å¤‡æ•…éšœå¤„ç†]
B --> |è®¤è¯å¼‚å¸¸| D[è®¤è¯å¤±è´¥å¤„ç†]
B --> |æƒé™å¼‚å¸¸| E[æƒé™å¼‚å¸¸å¤„ç†]
B --> |ç½‘ç»œå¼‚å¸¸| F[ç½‘ç»œæ•…éšœå¤„ç†]
B --> |ç³»ç»Ÿå¼‚å¸¸| G[ç³»ç»Ÿå¼‚å¸¸å¤„ç†]

C --> C1[è®¾å¤‡çŠ¶æ€æ›´æ–°]
C --> C2[åˆ‡æ¢å¤‡ç”¨è®¾å¤‡]
C --> C3[é€šçŸ¥ç»´æŠ¤äººå‘˜]

D --> D1[è®°å½•å¤±è´¥æ—¥å¿—]
D --> D2[å¯åŠ¨å¤‡ç”¨è®¤è¯]
D --> D3[äººå·¥ä»‹å…¥å¤„ç†]

E --> E1[æƒé™å®¡æ ¸]
E --> E2[ä¸´æ—¶æƒé™åˆ†é…]
E --> E3[ç®¡ç†å‘˜ç¡®è®¤]

F --> F1[ç¦»çº¿æ¨¡å¼å¯ç”¨]
F --> F2[æœ¬åœ°æƒé™éªŒè¯]
F --> F3[æ•°æ®åŒæ­¥å¾…å¤„ç†]

G --> G1[é”™è¯¯è®°å½•]
G --> G2[æœåŠ¡é‡å¯]
G --> G3[é™çº§æœåŠ¡]
end
```

## äº‹ä»¶è®°å½•ä¸å®¡è®¡

### äº‹ä»¶è®°å½•ä½“ç³»
```mermaid
graph TB
subgraph "äº‹ä»¶è®°å½•ä¸å®¡è®¡ä½“ç³»"
A[äº‹ä»¶é‡‡é›†] --> B[äº‹ä»¶åˆ†ç±»]
B --> C[äº‹ä»¶å­˜å‚¨]
C --> D[äº‹ä»¶åˆ†æ]
D --> E[æŠ¥è¡¨ç”Ÿæˆ]

A --> A1[é€šè¡Œäº‹ä»¶]
A --> A2[å¼‚å¸¸äº‹ä»¶]
A --> A3[è®¾å¤‡äº‹ä»¶]
A --> A4[ç”¨æˆ·äº‹ä»¶]

B --> B1[æˆåŠŸé€šè¡Œ]
B --> B2[å¤±è´¥é€šè¡Œ]
B --> B3[æƒé™å¼‚å¸¸]
B --> B4[ç³»ç»Ÿå¼‚å¸¸]

C --> C1[å®æ—¶æ•°æ®åº“]
C --> C2[å†å²æ•°æ®åº“]
C --> C3[å¤‡ä»½å­˜å‚¨]
C --> C4[å½’æ¡£å­˜å‚¨]

D --> D1[ç»Ÿè®¡åˆ†æ]
D --> D2[è¶‹åŠ¿åˆ†æ]
D --> D3[å¼‚å¸¸æ£€æµ‹]
D --> D4[é£é™©è¯„ä¼°]

E --> E1[é€šè¡ŒæŠ¥è¡¨]
E --> E2[å¼‚å¸¸æŠ¥è¡¨]
E --> E3[ç»Ÿè®¡æŠ¥è¡¨]
E --> E4[å®¡è®¡æŠ¥è¡¨]
end
```

### å®¡è®¡æ—¥å¿—å®ç°
```java
@Entity
@Table(name = "t_access_audit_log")
public class AccessAuditLogEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "log_id", length = 64, unique = true, nullable = false)
    private String logId;

    @Column(name = "event_type", nullable = false)
    private String eventType;

    @Column(name = "user_id")
    private Long userId;

    @Column(name = "device_id", nullable = false)
    private String deviceId;

    @Column(name = "area_id")
    private String areaId;

    @Column(name = "authentication_method")
    private String authenticationMethod;

    @Column(name = "access_result", nullable = false)
    private String accessResult;

    @Column(name = "failure_reason", length = 500)
    private String failureReason;

    @Column(name = "biometric_confidence", precision = 5, scale = 4)
    private BigDecimal biometricConfidence;

    @Column(name = "processing_time", nullable = false)
    private LocalDateTime processingTime;

    @Column(name = "response_time_ms")
    private Integer responseTimeMs;

    @Column(name = "client_ip", length = 45)
    private String clientIp;

    @Column(name = "user_agent", length = 500)
    private String userAgent;

    @Column(name = "additional_data", columnDefinition = "TEXT")
    private String additionalData;

    @Column(name = "create_time", nullable = false)
    private LocalDateTime createTime;
}

@Service
public class AccessAuditService {

    public void logAccessEvent(AccessEvent event) {
        AccessAuditLogEntity auditLog = new AccessAuditLogEntity();
        auditLog.setLogId(generateLogId());
        auditLog.setEventType(event.getEventType());
        auditLog.setUserId(event.getUserId());
        auditLog.setDeviceId(event.getDeviceId());
        auditLog.setAreaId(event.getAreaId());
        auditLog.setAuthenticationMethod(event.getAuthenticationMethod());
        auditLog.setAccessResult(event.getAccessResult());
        auditLog.setFailureReason(event.getFailureReason());
        auditLog.setBiometricConfidence(event.getBiometricConfidence());
        auditLog.setProcessingTime(LocalDateTime.now());
        auditLog.setResponseTimeMs(event.getResponseTimeMs());
        auditLog.setClientIp(event.getClientIp());
        auditLog.setAdditionalData(event.getAdditionalData());

        auditLogRepository.save(auditLog);

        // å¼‚æ­¥å¤„ç†å®¡è®¡åˆ†æ
        asyncAuditAnalysis(auditLog);
    }

    @Async
    private void asyncAuditAnalysis(AccessAuditLogEntity auditLog) {
        // 1. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateStatistics(auditLog);

        // 2. æ£€æŸ¥å¼‚å¸¸æ¨¡å¼
        checkAnomalyPatterns(auditLog);

        // 3. é£é™©è¯„ä¼°
        performRiskAssessment(auditLog);

        // 4. ç”Ÿæˆå®æ—¶æŠ¥å‘Š
        generateRealTimeReport(auditLog);
    }
}
```

## é«˜çº§åŠŸèƒ½

### åæ½œå›æ§åˆ¶
```java
@Service
public class AntiPassbackService {

    public boolean checkAntiPassbackViolation(String userId, String areaId) {
        // è·å–ç”¨æˆ·æœ€è¿‘çš„é€šè¡Œè®°å½•
        List<AccessRecord> recentRecords = accessRecordRepository.findRecentRecords(userId, 24);

        // æ£€æŸ¥æ˜¯å¦è¿ååæ½œå›è§„åˆ™
        for (AccessRecord record : recentRecords) {
            if (isAntiPassbackViolation(userId, areaId, record)) {
                return true;
            }
        }

        return false;
    }

    private boolean isAntiPassbackViolation(String userId, String areaId, AccessRecord lastRecord) {
        AntiPassbackRule rule = antiPassbackRuleRepository.getRuleByArea(areaId);

        switch (rule.getType()) {
            case SOFT:
                return checkSoftAntiPassback(userId, areaId, lastRecord, rule);
            case HARD:
                return checkHardAntiPassback(userId, areaId, lastRecord, rule);
            case TIMED:
                return checkTimedAntiPassback(userId, areaId, lastRecord, rule);
            default:
                return false;
        }
    }
}
```

### åŒºåŸŸå®¹é‡æ§åˆ¶
```mermaid
graph TB
subgraph "åŒºåŸŸå®¹é‡æ§åˆ¶æµç¨‹"
A[äººå‘˜è¿›å…¥] --> B[æ£€æŸ¥å½“å‰äººæ•°]
B --> C{å®¹é‡æ£€æŸ¥}
C --> |æœªæ»¡| D[å…è®¸è¿›å…¥]
C --> |å·²æ»¡| E[æ‹’ç»è¿›å…¥]
D --> F[æ›´æ–°è®¡æ•°]
E --> G[ç­‰å¾…æç¤º]
F --> H[è®°å½•äº‹ä»¶]
G --> I[æ’é˜Ÿå¤„ç†]
H --> J[æ›´æ–°æ˜¾ç¤º]
I --> K[å®¹é‡æ£€æŸ¥]
end
```

### å…¨å±€è”åŠ¨æ§åˆ¶
```java
@Service
public class GlobalLinkageService {

    @EventListener
    public void handleAlarmEvent(AlarmEvent event) {
        // è·å–è”åŠ¨è§„åˆ™
        List<LinkageRule> rules = linkageRuleRepository.findByAlarmType(event.getAlarmType());

        for (LinkageRule rule : rules) {
            executeLinkageActions(rule, event);
        }
    }

    private void executeLinkageActions(LinkageRule rule, AlarmEvent event) {
        for (LinkageAction action : rule.getActions()) {
            switch (action.getType()) {
                case LOCK_ALL_DOORS:
                    lockAllDoorsInArea(action.getTargetAreaId());
                    break;
                case TRIGGER_ALARM:
                    triggerAlarm(action.getAlarmConfigId());
                    break;
                case START_VIDEO_RECORDING:
                    startVideoRecording(action.getCameraIds());
                    break;
                case SEND_NOTIFICATION:
                    sendNotification(action.getNotificationConfigId());
                    break;
                case TRIGGER_EMERGENCY_MODE:
                    triggerEmergencyMode(action.getEmergencyModeId());
                    break;
            }
        }
    }
}
```

## å®‰å…¨æœºåˆ¶

### å¤šå±‚å®‰å…¨é˜²æŠ¤
```mermaid
graph TB
subgraph "å¤šå±‚å®‰å…¨é˜²æŠ¤ä½“ç³»"
A[ç‰©ç†å®‰å…¨å±‚] --> A1[è®¾å¤‡é˜²æ‹†]
A --> A2[ç¯å¢ƒç›‘æ§]
A --> A3[é—¨ç¦æ§åˆ¶]

B[ç½‘ç»œå®‰å…¨å±‚] --> B1[æ•°æ®åŠ å¯†ä¼ è¾“]
B --> B2[è®¿é—®æ§åˆ¶]
B --> B3[å…¥ä¾µæ£€æµ‹]

C[åº”ç”¨å®‰å…¨å±‚] --> C1[èº«ä»½è®¤è¯]
C --> C2[æƒé™æ§åˆ¶]
C --> C3[æ•°æ®è„±æ•]

D[æ•°æ®å®‰å…¨å±‚] --> D1[æ•°æ®åŠ å¯†å­˜å‚¨]
D --> D2[è®¿é—®å®¡è®¡]
D --> D3[å¤‡ä»½æ¢å¤]
end
```

### å®‰å…¨ç­–ç•¥é…ç½®
```yaml
security_config:
  authentication:
    multi_factor_required: true
    liveness_check_enabled: true
    biometric_threshold: 0.85
    session_timeout: 300  # ç§’

  encryption:
    data_transmission: "TLS_1_3"
    data_storage: "AES_256_GCM"
    key_management: "HSM"

  access_control:
    max_failed_attempts: 3
    lockout_duration: 900  # ç§’
    emergency_access_enabled: true

  audit:
    log_all_events: true
    log_retention_days: 2555  # 7å¹´
    real_time_monitoring: true

  network_security:
    firewall_enabled: true
    intrusion_detection: true
    ddos_protection: true
```

## APIæ¥å£è®¾è®¡

### é—¨ç¦æ§åˆ¶æ¥å£
```http
# è®¿é—®è®¤è¯
POST /api/access/authenticate
Content-Type: application/json

{
    "deviceId": "ACCESS_001",
    "authenticationMethods": ["FACE"],
    "biometricData": {
        "FACE": "base64äººè„¸æ•°æ®"
    },
    "cardData": null
}

Response:
{
    "code": 200,
    "message": "è®¤è¯æˆåŠŸ",
    "data": {
        "authenticated": true,
        "userId": "U001",
        "confidence": 0.95,
        "authenticationTime": 150
    }
}

# æƒé™éªŒè¯
POST /api/access/verify-permission
Content-Type: application/json

{
    "userId": "U001",
    "areaId": "AREA_001",
    "deviceId": "ACCESS_001"
}

Response:
{
    "code": 200,
    "message": "éªŒè¯æˆåŠŸ",
    "data": {
        "permitted": true,
        "permissionType": "FULL_ACCESS",
        "validUntil": "2024-01-01T18:00:00Z"
    }
}

# å¼€é—¨æ§åˆ¶
POST /api/access/open-door
Content-Type: application/json

{
    "deviceId": "ACCESS_001",
    "userId": "U001",
    "areaId": "AREA_001",
    "duration": 5000
}

Response:
{
    "code": 200,
    "message": "å¼€é—¨æˆåŠŸ",
    "data": {
        "doorOpened": true,
        "duration": 5000,
        "operationTime": "2024-01-01T10:00:00Z"
    }
}
```

### è®¾å¤‡ç®¡ç†æ¥å£
```http
# è®¾å¤‡çŠ¶æ€æŸ¥è¯¢
GET /api/device/{deviceId}/status

Response:
{
    "code": 200,
    "message": "æŸ¥è¯¢æˆåŠŸ",
    "data": {
        "deviceId": "ACCESS_001",
        "deviceName": "ä¸»æ¥¼å‰é—¨",
        "status": "ONLINE",
        "lastHeartbeat": "2024-01-01T09:59:30Z",
        "cpuUsage": 15.2,
        "memoryUsage": 32.5,
        "storageUsage": 45.8
    }
}

# è®¾å¤‡è¿œç¨‹æ§åˆ¶
POST /api/device/{deviceId}/control
Content-Type: application/json

{
    "action": "RESTART",
    "parameters": {}
}

Response:
{
    "code": 200,
    "message": "æ§åˆ¶å‘½ä»¤å·²å‘é€",
    "data": {
        "commandId": "CMD_001",
        "expectedCompletionTime": "2024-01-01T10:01:00Z"
    }
}
```

## æ€§èƒ½æŒ‡æ ‡

### ç³»ç»Ÿæ€§èƒ½è¦æ±‚
| æŒ‡æ ‡é¡¹ | è¦æ±‚å€¼ | æµ‹è¯•æ¡ä»¶ |
|--------|--------|----------|
| è®¤è¯å“åº”æ—¶é—´ | â‰¤500ms | æ­£å¸¸è´Ÿè½½ |
| å¹¶å‘è®¤è¯èƒ½åŠ› | â‰¥10000 TPS | æ··åˆè®¤è¯ |
| ç³»ç»Ÿå¯ç”¨æ€§ | â‰¥99.99% | 7Ã—24å°æ—¶ |
| è®¾å¤‡è¿æ¥æˆåŠŸç‡ | â‰¥99.5% | æ­£å¸¸ç½‘ç»œ |
| äº‹ä»¶å¤„ç†å»¶è¿Ÿ | â‰¤100ms | å®æ—¶å¤„ç† |

### ä¸åŒè®¤è¯æ–¹å¼æ€§èƒ½
| è®¤è¯æ–¹å¼ | å¹³å‡å“åº”æ—¶é—´ | å‡†ç¡®ç‡ | æ”¯æŒå¹¶å‘ | é€‚ç”¨åœºæ™¯ |
|----------|--------------|--------|----------|----------|
| äººè„¸è¯†åˆ« | <300ms | 99.99% | 5000 TPS | ä¸»è¦å‡ºå…¥å£ |
| æŒ‡çº¹è¯†åˆ« | <200ms | 99.9% | 8000 TPS | é«˜å®‰å…¨åŒºåŸŸ |
| æŒçº¹è¯†åˆ« | <400ms | 99.95% | 3000 TPS | ç‰¹æ®ŠåŒºåŸŸ |
| è™¹è†œè¯†åˆ« | <800ms | 99.999% | 1000 TPS | æ ¸å¿ƒåŒºåŸŸ |
| å¡ç‰‡è¯†åˆ« | <100ms | 100% | 10000 TPS | é€šç”¨è®¤è¯ |
| å¤šæ¨¡æ€è®¤è¯ | <600ms | 99.999% | 2000 TPS | æœ€é«˜å®‰å…¨åŒºåŸŸ |

## åº”ç”¨åœºæ™¯

### å›­åŒºåº”ç”¨åœºæ™¯
- **ä¸»å‡ºå…¥å£**ï¼šäººè„¸è¯†åˆ« + å¡ç‰‡è®¤è¯
- **åŠå…¬åŒºåŸŸ**ï¼šæŒ‡çº¹ + é—¨ç¦å¡
- **ç ”å‘ä¸­å¿ƒ**ï¼šäººè„¸ + æŒ‡çº¹ + è™¹è†œä¸‰é‡è®¤è¯
- **ç”Ÿäº§è½¦é—´**ï¼šå·¥ç‰Œ + äººè„¸è¯†åˆ«
- **æ•°æ®ä¸­å¿ƒ**ï¼šå¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«
- **è®¿å®¢åŒºåŸŸ**ï¼šä¸´æ—¶å¡ç‰‡ + äººè„¸ç™»è®°

### ç‰¹æ®Šåœºæ™¯åº”ç”¨
- **ç´§æ€¥ç–æ•£**ï¼šä¸€é”®å¼€å¯æ‰€æœ‰é—¨ç¦
- **æ¶ˆé˜²è”åŠ¨**ï¼šç«ç¾è‡ªåŠ¨è§£é”
- **å®‰å…¨å¨èƒ**ï¼šè‡ªåŠ¨é”å®šç›¸å…³åŒºåŸŸ
- **é«˜å³°æ—¶æ®µ**ï¼šå¿«é€Ÿé€šé“æ¨¡å¼
- **å¤œé—´æ¨¡å¼**ï¼šå¢å¼ºå®‰å…¨æ£€æŸ¥

**Section sources**
- [AccessControlController.java](file://smart-admin-api-java17-springboot3/sa-admin/src/main/java/net/lab1024/sa/admin/module/business/security/access/controller/AccessControlController.java#L1-120)
- [access-control-api.js](file://smart-admin-web-javascript/src/api/business/security/access/access-control-api.js#L1-60)
- [device-management.vue](file://smart-admin-web-javascript/src/views/business/security/access/device-management.vue#L1-200)
- [real-time-monitor.vue](file://smart-admin-web-javascript/src/views/business/security/access/real-time-monitor.vue#L1-150)