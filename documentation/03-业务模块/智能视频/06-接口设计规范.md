# æ¥å£è®¾è®¡è§„èŒƒæ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†æ™ºèƒ½è§†é¢‘æ¨¡å—çš„APIæ¥å£è§„èŒƒï¼ŒåŒ…æ‹¬RESTfulæ¥å£è®¾è®¡ã€å‚æ•°å®šä¹‰ã€è¿”å›æ ¼å¼ã€é”™è¯¯å¤„ç†ã€å®‰å…¨è®¤è¯ç­‰å†…å®¹ã€‚æ‰€æœ‰æ¥å£å‡æ”¯æŒ5çº§å®‰å…¨ä½“ç³»æƒé™æ§åˆ¶ã€‚

---

## 1. æ¥å£è®¾è®¡åŸåˆ™

### 1.1 åŸºæœ¬åŸåˆ™

1. **RESTfulè®¾è®¡**ï¼šéµå¾ªRESTæ¶æ„é£æ ¼ï¼Œä½¿ç”¨æ ‡å‡†HTTPæ–¹æ³•
2. **ç»Ÿä¸€æ ¼å¼**ï¼šè¯·æ±‚å’Œå“åº”ä½¿ç”¨ç»Ÿä¸€çš„JSONæ ¼å¼
3. **ç‰ˆæœ¬ç®¡ç†**ï¼šé€šè¿‡URLè·¯å¾„è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¦‚ `/api/v1/`
4. **å®‰å…¨è®¤è¯**ï¼šé‡‡ç”¨JWT Tokenè®¤è¯
5. **æƒé™æ§åˆ¶**ï¼šé›†æˆ5çº§å®‰å…¨ä½“ç³»ï¼Œæ”¯æŒç»†ç²’åº¦æƒé™
6. **çŠ¶æ€ç è§„èŒƒ**ï¼šä½¿ç”¨æ ‡å‡†HTTPçŠ¶æ€ç 
7. **åˆ†é¡µæŸ¥è¯¢**ï¼šåˆ—è¡¨æŸ¥è¯¢æ”¯æŒåˆ†é¡µå’Œæ’åº
8. **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**ï¼šä¸€è‡´çš„é”™è¯¯å“åº”æ ¼å¼

### 1.2 URLè§„èŒƒ

```
https://api.example.com/ivs/{version}/{module}/{resource}/{id}

ç¤ºä¾‹ï¼š
https://api.example.com/ivs/v1/device/123
https://api.example.com/ivs/v1/monitor/stream
https://api.example.com/ivs/v1/record/search
```

### 1.3 HTTPæ–¹æ³•è§„èŒƒ

| æ–¹æ³•  | ç”¨é€”                  | è¯´æ˜                     |
|-------|-----------------------|--------------------------|
| GET   | æŸ¥è¯¢èµ„æº              | è·å–æ•°æ®ï¼Œä¸æ”¹å˜æœåŠ¡ç«¯çŠ¶æ€|
| POST  | åˆ›å»ºèµ„æº              | åˆ›å»ºæ–°çš„èµ„æº             |
| PUT   | æ•´ä½“æ›´æ–°èµ„æº          | æ›´æ–°èµ„æºçš„å…¨éƒ¨å±æ€§       |
| PATCH | éƒ¨åˆ†æ›´æ–°èµ„æº          | æ›´æ–°èµ„æºçš„éƒ¨åˆ†å±æ€§       |
| DELETE| åˆ é™¤èµ„æº              | åˆ é™¤æŒ‡å®šèµ„æº             |

---

## 2. é€šç”¨å“åº”æ ¼å¼
## ğŸ“‹ IOE-DREAMä¸ƒå¾®æœåŠ¡æ¶æ„

**æ ¸å¿ƒæ¶æ„ç»„æˆ**:
- **Gateway Service (8080)**: APIç½‘å…³
- **Common Service (8088)**: å…¬å…±æ¨¡å—å¾®æœåŠ¡
- **DeviceComm Service (8087)**: è®¾å¤‡é€šè®¯å¾®æœåŠ¡
- **OA Service (8089)**: OAå¾®æœåŠ¡
- **Access Service (8090)**: é—¨ç¦æœåŠ¡
- **Attendance Service (8091)**: è€ƒå‹¤æœåŠ¡
- **Video Service (8092)**: è§†é¢‘æœåŠ¡
- **Consume Service (8094)**: æ¶ˆè´¹æœåŠ¡
- **Visitor Service (8095)**: è®¿å®¢æœåŠ¡

**æ¶æ„ç‰¹ç‚¹**:
- åŸºäºSpring Boot 3.5.8 + Java 17
- ä¸¥æ ¼éµå¾ªä¼ä¸šçº§å¾®æœåŠ¡è§„èŒƒ
- æ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•

**æŠ€æœ¯æ ˆæ ‡å‡†**:
- **æ•°æ®åº“**: MySQL 8.0 + Druidè¿æ¥æ± 
- **ç¼“å­˜**: Redis + Caffeineå¤šçº§ç¼“å­˜
- **æ³¨å†Œä¸­å¿ƒ**: Nacos
- **é…ç½®ä¸­å¿ƒ**: Nacos Config
- **è®¤è¯æˆæƒ**: Sa-Token

## ğŸ—ï¸ å››å±‚æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¶æ„æ¨¡å¼**:
```
Controller (æ¥å£æ§åˆ¶å±‚)
    â†“
Service (æ ¸å¿ƒä¸šåŠ¡å±‚)
    â†“
Manager (æµç¨‹ç®¡ç†å±‚)
    â†“
DAO (æ•°æ®è®¿é—®å±‚)
```

**å±‚çº§èŒè´£**:
- **Controllerå±‚**: HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€æƒé™æ§åˆ¶
- **Serviceå±‚**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Managerå±‚**: å¤æ‚æµç¨‹ç¼–æ’ã€å¤šæ•°æ®ç»„è£…ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
- **DAOå±‚**: æ•°æ®åº“CRUDæ“ä½œã€SQLæŸ¥è¯¢å®ç°ã€æ•°æ®è®¿é—®è¾¹ç•Œ

**ä¸¥æ ¼ç¦æ­¢è·¨å±‚è®¿é—®**: Controllerä¸èƒ½ç›´æ¥è°ƒç”¨Manager/DAOï¼
### 2.1 æˆåŠŸå“åº”æ ¼å¼
## âš ï¸ IOE-DREAMé›¶å®¹å¿è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**å¿…é¡»éµå®ˆçš„æ¶æ„è§„åˆ™**:
- âœ… **å¿…é¡»ä½¿ç”¨ @Resource æ³¨å…¥ä¾èµ–**
- âœ… **å¿…é¡»ä½¿ç”¨ @Mapper æ³¨è§£** (ç¦æ­¢@Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ Dao åç¼€** (ç¦æ­¢Repository)
- âœ… **å¿…é¡»ä½¿ç”¨ @RestController æ³¨è§£**
- âœ… **å¿…é¡»ä½¿ç”¨ @Valid å‚æ•°æ ¡éªŒ**
- âœ… **å¿…é¡»è¿”å›ç»Ÿä¸€ResponseDTOæ ¼å¼**
- âœ… **å¿…é¡»éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ**

**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**:
- âŒ **ç¦æ­¢ä½¿ç”¨ @Autowired æ³¨å…¥**
- âŒ **ç¦æ­¢ä½¿ç”¨ @Repository æ³¨è§£**
- âŒ **ç¦æ­¢ä½¿ç”¨ Repository åç¼€å‘½å**
- âŒ **ç¦æ­¢è·¨å±‚è®¿é—®**
- âŒ **ç¦æ­¢åœ¨Controllerä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âŒ **ç¦æ­¢ç›´æ¥è®¿é—®æ•°æ®åº“**

**è¿è§„åæœ**: P0çº§é—®é¢˜ï¼Œç«‹å³ä¿®å¤ï¼Œç¦æ­¢åˆå¹¶ï¼

```json
{
    "code": 200,
    "message": "success",
    "data": {
        // å®é™…æ•°æ®
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "abc123def456"
}
```

### 2.2 åˆ†é¡µå“åº”æ ¼å¼

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            // æ•°æ®åˆ—è¡¨
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 100,
            "totalPages": 5
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "abc123def456"
}
```

### 2.3 é”™è¯¯å“åº”æ ¼å¼

```json
{
    "code": 400,
    "message": "å‚æ•°é”™è¯¯",
    "error": {
        "type": "VALIDATION_ERROR",
        "details": [
            {
                "field": "deviceName",
                "message": "è®¾å¤‡åç§°ä¸èƒ½ä¸ºç©º"
            }
        ]
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "abc123def456"
}
```

### 2.4 çŠ¶æ€ç å®šä¹‰

| çŠ¶æ€ç  | è¯´æ˜                  | åœºæ™¯                     |
|--------|-----------------------|--------------------------|
| 200    | OK                    | è¯·æ±‚æˆåŠŸ                 |
| 201    | Created               | åˆ›å»ºæˆåŠŸ                 |
| 204    | No Content            | åˆ é™¤æˆåŠŸ                 |
| 400    | Bad Request           | è¯·æ±‚å‚æ•°é”™è¯¯             |
| 401    | Unauthorized          | æœªè®¤è¯                   |
| 403    | Forbidden             | æ— æƒé™                   |
| 404    | Not Found             | èµ„æºä¸å­˜åœ¨               |
| 409    | Conflict              | èµ„æºå†²çª                 |
| 429    | Too Many Requests     | è¯·æ±‚é¢‘ç‡é™åˆ¶             |
| 500    | Internal Server Error | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯           |

---

## 3. è®¾å¤‡ç®¡ç†æ¥å£

### 3.1 è®¾å¤‡åˆ—è¡¨æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/device`

**æ¥å£æè¿°**ï¼šè·å–è®¾å¤‡åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æ’åº

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "pageNum": 1,
    "pageSize": 20,
    "deviceName": "æ‘„åƒå¤´",
    "deviceType": "IPC",
    "status": "online",
    "regionId": 1,
    "groupId": 1,
    "sortBy": "createTime",
    "sortOrder": "desc"
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ        | ç±»å‹    | å¿…å¡« | è¯´æ˜                     |
|-------------|---------|------|--------------------------|
| pageNum     | Integer | å¦   | é¡µç ï¼Œé»˜è®¤1              |
| pageSize    | Integer | å¦   | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100|
| deviceName  | String  | å¦   | è®¾å¤‡åç§°æ¨¡ç³ŠæŸ¥è¯¢         |
| deviceType  | String  | å¦   | è®¾å¤‡ç±»å‹ï¼šIPC/NVR/DVR    |
| status      | String  | å¦   | çŠ¶æ€ï¼šonline/offline     |
| regionId    | Long    | å¦   | åŒºåŸŸID                   |
| groupId     | Long    | å¦   | åˆ†ç»„ID                   |
| sortBy      | String  | å¦   | æ’åºå­—æ®µ                 |
| sortOrder   | String  | å¦   | æ’åºæ–¹å‘ï¼šasc/desc       |

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "id": 1,
                "deviceCode": "DEV-202401001",
                "deviceName": "æ‘„åƒå¤´001",
                "deviceType": "IPC",
                "manufacturer": "æµ·åº·å¨è§†",
                "model": "DS-2CD3T85",
                "ipAddress": "192.168.1.101",
                "port": 554,
                "status": "online",
                "location": "ä¸€æ¥¼å¤§å…",
                "regionId": 1,
                "regionName": "ä¸€æ¥¼",
                "groupId": 1,
                "groupName": "ç›‘æ§ç»„1",
                "lastHeartbeat": "2024-01-15T10:30:00Z",
                "onlineDuration": 86400,
                "createTime": "2024-01-01T10:00:00Z"
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 100,
            "totalPages": 5
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 3.2 è®¾å¤‡è¯¦æƒ…æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/device/{id}`

**æ¥å£æè¿°**ï¼šè·å–è®¾å¤‡è¯¦æƒ…ä¿¡æ¯

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "deviceCode": "DEV-202401001",
        "deviceName": "æ‘„åƒå¤´001",
        "deviceType": "IPC",
        "manufacturer": "æµ·åº·å¨è§†",
        "model": "DS-2CD3T85",
        "serialNumber": "ABC123456789",
        "firmwareVersion": "v3.4.2",
        "ipAddress": "192.168.1.101",
        "port": 554,
        "protocol": "RTSP",
        "username": "admin",
        "macAddress": "00:11:22:33:44:55",
        "location": "ä¸€æ¥¼å¤§å…",
        "latitude": 23.1234567,
        "longitude": 113.1234567,
        "regionId": 1,
        "regionName": "ä¸€æ¥¼",
        "groupId": 1,
        "groupName": "ç›‘æ§ç»„1",
        "status": "online",
        "lastHeartbeat": "2024-01-15T10:30:00Z",
        "onlineDuration": 86400,
        "cpuUsage": 45,
        "memoryUsage": 60,
        "diskUsage": 40,
        "networkStatus": "normal",
        "videoSignal": "normal",
        "recordStatus": "recording",
        "temperature": 45,
        "humidity": 65,
        "createTime": "2024-01-01T10:00:00Z",
        "updateTime": "2024-01-15T10:30:25Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 3.3 æ–°å¢è®¾å¤‡æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/device`

**æ¥å£æè¿°**ï¼šæ–°å¢è®¾å¤‡

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "deviceName": "æ‘„åƒå¤´001",
    "deviceType": "IPC",
    "manufacturer": "æµ·åº·å¨è§†",
    "model": "DS-2CD3T85",
    "ipAddress": "192.168.1.101",
    "port": 554,
    "protocol": "RTSP",
    "username": "admin",
    "password": "admin123",
    "location": "ä¸€æ¥¼å¤§å…",
    "latitude": 23.1234567,
    "longitude": 113.1234567,
    "regionId": 1,
    "groupId": 1,
    "remark": "å¤§é—¨å£ä¸»ç›‘æ§ç‚¹"
}
```

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 201,
    "message": "create success",
    "data": {
        "id": 101,
        "deviceCode": "DEV-202401101"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 3.4 æ›´æ–°è®¾å¤‡æ¥å£

**æ¥å£åœ°å€**ï¼š`PUT /ivs/v1/device/{id}`

**æ¥å£æè¿°**ï¼šæ›´æ–°è®¾å¤‡ä¿¡æ¯

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "deviceName": "æ‘„åƒå¤´001-æ›´æ–°",
    "location": "ä¸€æ¥¼å¤§å…ä¸œä¾§",
    "remark": "å¤§é—¨å£ä¸»ç›‘æ§ç‚¹-å·²æ›´æ–°"
}
```

### 3.5 åˆ é™¤è®¾å¤‡æ¥å£

**æ¥å£åœ°å€**ï¼š`DELETE /ivs/v1/device/{id}`

**æ¥å£æè¿°**ï¼šåˆ é™¤è®¾å¤‡

**æƒé™è¦æ±‚**ï¼šLevel 5ï¼ˆç»å¯†çº§ï¼‰

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 204,
    "message": "delete success",
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 3.6 è®¾å¤‡é‡å¯æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/device/{id}/reboot`

**æ¥å£æè¿°**ï¼šè¿œç¨‹é‡å¯è®¾å¤‡

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "reboot success",
    "data": {
        "taskId": "task-123456"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## 4. å®æ—¶ç›‘æ§æ¥å£

### 4.1 è·å–è§†é¢‘æµåœ°å€

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/monitor/stream/{deviceId}`

**æ¥å£æè¿°**ï¼šè·å–è®¾å¤‡çš„è§†é¢‘æµåœ°å€

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "streamType": "main",
    "protocol": "rtsp"
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ       | ç±»å‹   | å¿…å¡« | è¯´æ˜                  |
|------------|--------|------|-----------------------|
| streamType | String | å¦   | æµç±»å‹ï¼šmain/sub/event|
| protocol   | String | å¦   | åè®®ï¼šrtsp/rtmp/hls   |

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "streamUrl": "rtsp://192.168.1.101:554/Streaming/Channels/101",
        "playUrl": "rtsp://192.168.1.101:554/Streaming/Channels/101?transportmode=unicast&profile=Profile_1",
        "webRtcUrl": "webrtc://192.168.1.101:8080/live/101",
        "expireTime": "2024-01-15T11:30:25Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 4.2 äº‘å°æ§åˆ¶æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/monitor/ptz/{deviceId}/control`

**æ¥å£æè¿°**ï¼šæ§åˆ¶äº‘å°PTZ

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "action": "move",
    "direction": "up",
    "speed": 5,
    "duration": 1000
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ     | ç±»å‹   | å¿…å¡« | è¯´æ˜                                   |
|----------|--------|------|----------------------------------------|
| action   | String | æ˜¯   | åŠ¨ä½œï¼šmove/zoom/preset/cruise          |
| direction| String | å¦   | æ–¹å‘ï¼šup/down/left/right/leftupç­‰       |
| speed    | Integer| å¦   | é€Ÿåº¦ï¼š1-10                              |
| duration | Integer| å¦   | æŒç»­æ—¶é—´(æ¯«ç§’)                         |
| zoomType | String | å¦   | å˜ç„¦ç±»å‹ï¼šin/out                        |
| presetId | Long   | å¦   | é¢„ç½®ä½ID                                |
| cruiseId | Long   | å¦   | å·¡èˆªID                                  |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "control success",
    "data": {
        "taskId": "task-123456",
        "status": "executing"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 4.3 æˆªå›¾æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/monitor/snapshot/{deviceId}`

**æ¥å£æè¿°**ï¼šå®æ—¶æˆªå›¾

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "channelId": 101,
    "format": "jpg",
    "quality": 80
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "snapshot success",
    "data": {
        "imageId": "img-123456",
        "imageUrl": "https://storage.example.com/snapshots/2024-01-15/img-123456.jpg",
        "fileSize": 102400,
        "width": 1920,
        "height": 1080,
        "createTime": "2024-01-15T10:30:25Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 4.4 å½•åƒæ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/monitor/record/{deviceId}`

**æ¥å£æè¿°**ï¼šå¼€å§‹/åœæ­¢å½•åƒ

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "action": "start",
    "recordType": "manual",
    "duration": 300,
    "streamType": "main"
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ       | ç±»å‹   | å¿…å¡« | è¯´æ˜                  |
|------------|--------|------|-----------------------|
| action     | String | æ˜¯   | åŠ¨ä½œï¼šstart/stop      |
| recordType | String | å¦   | å½•åƒç±»å‹ï¼šmanual/schedule/alarm|
| duration   | Integer| å¦   | å½•åƒæ—¶é•¿(ç§’)         |
| streamType | String | å¦   | æµç±»å‹ï¼šmain/sub      |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "record start success",
    "data": {
        "recordId": "rec-123456",
        "startTime": "2024-01-15T10:30:25Z",
        "status": "recording"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## 5. å½•åƒå›æ”¾æ¥å£

### 5.1 å½•åƒæŸ¥è¯¢æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/record/search`

**æ¥å£æè¿°**ï¼šæŸ¥è¯¢å½•åƒè®°å½•

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "deviceId": 1,
    "startTime": "2024-01-15T00:00:00Z",
    "endTime": "2024-01-15T23:59:59Z",
    "recordType": "all",
    "pageNum": 1,
    "pageSize": 20
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ       | ç±»å‹    | å¿…å¡« | è¯´æ˜                          |
|------------|---------|------|-------------------------------|
| deviceId   | Long    | å¦   | è®¾å¤‡ID                        |
| channelId  | Long    | å¦   | é€šé“ID                        |
| startTime  | String  | å¦   | å¼€å§‹æ—¶é—´(ISO 8601æ ¼å¼)       |
| endTime    | String  | å¦   | ç»“æŸæ—¶é—´(ISO 8601æ ¼å¼)       |
| recordType | String  | å¦   | å½•åƒç±»å‹ï¼šmanual/schedule/alarm/all|
| pageNum    | Integer | å¦   | é¡µç                           |
| pageSize   | Integer | å¦   | æ¯é¡µæ•°é‡                      |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "id": 1001,
                "deviceId": 1,
                "deviceName": "æ‘„åƒå¤´001",
                "channelId": 101,
                "recordType": "manual",
                "startTime": "2024-01-15T10:00:00Z",
                "endTime": "2024-01-15T10:30:15Z",
                "duration": 1815,
                "filePath": "/storage/records/2024-01-15/rec-1001.mp4",
                "fileSize": 1258291200,
                "resolution": "1920x1080",
                "bitrate": 2048,
                "fps": 25,
                "status": "completed"
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 120,
            "totalPages": 6
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 5.2 è·å–å›æ”¾æµåœ°å€

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/record/{recordId}/stream`

**æ¥å£æè¿°**ï¼šè·å–å½•åƒå›æ”¾æµåœ°å€

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "streamUrl": "rtsp://192.168.1.100:554/Playback/Channels/101?starttime=20240115T020000Z&stoptime=20240115T023015Z",
        "hlsUrl": "https://stream.example.com/hls/rec-1001.m3u8",
        "mp4Url": "https://storage.example.com/records/rec-1001.mp4",
        "expireTime": "2024-01-15T11:30:25Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 5.3 å½•åƒä¸‹è½½æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/record/download`

**æ¥å£æè¿°**ï¼šåˆ›å»ºå½•åƒä¸‹è½½ä»»åŠ¡

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "recordId": 1001,
    "format": "mp4",
    "resolution": "original",
    "quality": "high",
    "watermark": {
        "timestamp": true,
        "deviceInfo": true
    }
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "download task created",
    "data": {
        "taskId": "task-123456",
        "status": "pending",
        "estimatedSize": 1258291200,
        "estimatedDuration": 1815
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 5.4 ä¸‹è½½ä»»åŠ¡æŸ¥è¯¢æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/record/download/tasks`

**æ¥å£æè¿°**ï¼šæŸ¥è¯¢ä¸‹è½½ä»»åŠ¡åˆ—è¡¨

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "taskId": "task-123456",
                "recordId": 1001,
                "status": "downloading",
                "progress": 65,
                "downloadSpeed": 10485760,
                "downloadedSize": 818375680,
                "totalSize": 1258291200,
                "createTime": "2024-01-15T10:30:25Z",
                "completeTime": null,
                "downloadUrl": null,
                "errorMessage": null
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 5,
            "totalPages": 1
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## 6. å‘Šè­¦ç®¡ç†æ¥å£

### 6.1 å®æ—¶å‘Šè­¦æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/alarm/realtime`

**æ¥å£æè¿°**ï¼šè·å–å®æ—¶å‘Šè­¦åˆ—è¡¨

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "pageNum": 1,
    "pageSize": 20,
    "alarmLevel": "all",
    "status": "unprocessed"
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ       | ç±»å‹   | å¿…å¡« | è¯´æ˜                              |
|------------|--------|------|-----------------------------------|
| alarmLevel | String | å¦   | å‘Šè­¦çº§åˆ«ï¼šinfo/warning/error/critical/all|
| status     | String | å¦   | çŠ¶æ€ï¼šunprocessed/processing/processed/all|

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "id": 5001,
                "deviceId": 1,
                "deviceName": "æ‘„åƒå¤´001",
                "alarmType": "motion",
                "alarmLevel": "warning",
                "alarmTime": "2024-01-15T10:30:25Z",
                "title": "æ£€æµ‹åˆ°äººå‘˜å¾˜å¾Š",
                "description": "åœ¨å¤§å…å…¥å£åŒºåŸŸæ£€æµ‹åˆ°äººå‘˜å¾˜å¾Šè¶…è¿‡5åˆ†é’Ÿ",
                "status": "unprocessed",
                "imageUrl": "https://storage.example.com/alarms/img-5001.jpg",
                "videoUrl": "https://storage.example.com/alarms/rec-5001.mp4",
                "regionId": 1,
                "regionName": "ä¸€æ¥¼å¤§å…"
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 156,
            "totalPages": 8
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 6.2 å‘Šè­¦ç¡®è®¤æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/alarm/{alarmId}/confirm`

**æ¥å£æè¿°**ï¼šç¡®è®¤å‘Šè­¦

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "note": "ç¡®è®¤å‘Šè­¦ï¼Œå·²æ´¾äººå¤„ç†"
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "confirm success",
    "data": {
        "alarmId": 5001,
        "status": "processing",
        "confirmTime": "2024-01-15T10:30:25Z",
        "confirmUserId": 1001
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 6.3 å‘Šè­¦å¤„ç†æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/alarm/{alarmId}/process`

**æ¥å£æè¿°**ï¼šå¤„ç†å‘Šè­¦

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "processResult": "resolved",
    "note": "å·²ç¡®è®¤æ˜¯å·¥ä½œäººå‘˜æ­£å¸¸å·¡é€»ï¼Œå·²å¤„ç†å®Œæ¯•"
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ          | ç±»å‹   | å¿…å¡« | è¯´æ˜                          |
|---------------|--------|------|-------------------------------|
| processResult | String | æ˜¯   | å¤„ç†ç»“æœï¼šresolved/false_alarm/transfer|
| note          | String | å¦   | å¤„ç†å¤‡æ³¨                      |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "process success",
    "data": {
        "alarmId": 5001,
        "status": "processed",
        "processTime": "2024-01-15T10:35:25Z",
        "processUserId": 1001
    },
    "timestamp": "2024-01-15T10:35:25Z",
    "requestId": "req-123456"
}
```

### 6.4 å‘Šè­¦è§„åˆ™é…ç½®æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/alarm/rule`

**æ¥å£æè¿°**ï¼šåˆ›å»ºå‘Šè­¦è§„åˆ™

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "ruleName": "åŒºåŸŸå…¥ä¾µæ£€æµ‹",
    "ruleType": "motion",
    "deviceId": 1,
    "detectionArea": {
        "points": [
            {"x": 100, "y": 100},
            {"x": 500, "y": 100},
            {"x": 500, "y": 400},
            {"x": 100, "y": 400}
        ]
    },
    "detectionParams": {
        "sensitivity": 5,
        "minDuration": 10,
        "scheduleType": "all"
    },
    "linkageActions": [
        {
            "type": "record",
            "params": {
                "duration": 300
            }
        },
        {
            "type": "snapshot",
            "params": {}
        },
        {
            "type": "notification",
            "params": {
                "channels": ["app", "email"]
            }
        }
    ],
    "alarmLevel": "warning",
    "enabled": true
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 201,
    "message": "create success",
    "data": {
        "ruleId": 2001,
        "ruleName": "åŒºåŸŸå…¥ä¾µæ£€æµ‹"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## 7. æ™ºèƒ½åˆ†ææ¥å£

### 7.1 å®æ—¶åˆ†æç»“æœæ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/analysis/realtime/{deviceId}`

**æ¥å£æè¿°**ï¼šè·å–è®¾å¤‡å®æ—¶åˆ†æç»“æœ

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "deviceId": 1,
        "algorithmType": "face_recognition",
        "results": [
            {
                "resultId": "res-123456",
                "targetType": "face",
                "targetId": "face-001",
                "confidence": 95.6,
                "position": {
                    "x": 100,
                    "y": 100,
                    "width": 200,
                    "height": 200
                },
                "attributes": {
                    "gender": "male",
                    "age": 30,
                    "mask": false
                },
                "recognizedPerson": {
                    "personId": "p-001",
                    "personName": "å¼ ä¸‰",
                    "similarity": 98.5
                },
                "analysisTime": "2024-01-15T10:30:25Z"
            }
        ]
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 7.2 åˆ†æç»“æœæŸ¥è¯¢æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/analysis/search`

**æ¥å£æè¿°**ï¼šæŸ¥è¯¢å†å²åˆ†æç»“æœ

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "deviceId": 1,
    "algorithmType": "face_recognition",
    "resultType": "face",
    "startTime": "2024-01-15T00:00:00Z",
    "endTime": "2024-01-15T23:59:59Z",
    "personId": "p-001",
    "confidenceMin": 80,
    "pageNum": 1,
    "pageSize": 20
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "id": 3001,
                "deviceId": 1,
                "algorithmId": 1,
                "algorithmName": "äººè„¸è¯†åˆ«",
                "resultType": "face",
                "resultData": {
                    "targetId": "face-001",
                    "confidence": 95.6,
                    "attributes": {
                        "gender": "male",
                        "age": 30
                    },
                    "recognizedPerson": {
                        "personId": "p-001",
                        "personName": "å¼ ä¸‰"
                    }
                },
                "confidence": 95.6,
                "analysisTime": "2024-01-15T10:30:25Z",
                "imageUrl": "https://storage.example.com/analysis/img-3001.jpg",
                "status": "confirmed"
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 156,
            "totalPages": 8
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 7.3 åˆ†æè§„åˆ™é…ç½®æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/analysis/rule`

**æ¥å£æè¿°**ï¼šåˆ›å»ºåˆ†æè§„åˆ™

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "ruleName": "äººè„¸è¯†åˆ«è§„åˆ™",
    "deviceId": 1,
    "algorithmId": 1,
    "detectionArea": {
        "type": "polygon",
        "points": [
            {"x": 100, "y": 100},
            {"x": 500, "y": 100},
            {"x": 500, "y": 400},
            {"x": 100, "y": 400}
        ]
    },
    "threshold": 80,
    "minDuration": 5,
    "scheduleType": "all",
    "enabled": true
}
```

---

## 8. è§£ç ä¸Šå¢™æ¥å£

### 8.1 ä¸Šå¢™ä»»åŠ¡æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/wall/{wallId}/display`

**æ¥å£æè¿°**ï¼šåˆ›å»ºæ˜¾ç¤ºä»»åŠ¡

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "taskName": "å®æ—¶ç›‘æ§ä¸Šå¢™",
    "taskType": "real_time",
    "sourceDeviceId": 1,
    "displayArea": {
        "x": 0,
        "y": 0,
        "width": 1920,
        "height": 1080
    },
    "zIndex": 1,
    "duration": null
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ            | ç±»å‹   | å¿…å¡« | è¯´æ˜                          |
|-----------------|--------|------|-------------------------------|
| taskName        | String | æ˜¯   | ä»»åŠ¡åç§°                      |
| taskType        | String | æ˜¯   | ä»»åŠ¡ç±»å‹ï¼šreal_time/playback/image/text|
| sourceDeviceId  | Long   | å¦   | æºè®¾å¤‡ID(å®æ—¶è§†é¢‘)           |
| sourceRecordId  | Long   | å¦   | æºå½•åƒID(å›æ”¾)              |
| sourceUrl       | String | å¦   | æºåœ°å€(å›¾ç‰‡/æ–‡å­—)           |
| displayArea     | Object | æ˜¯   | æ˜¾ç¤ºåŒºåŸŸåæ ‡                  |
| zIndex          | Integer| å¦   | æ˜¾ç¤ºå±‚çº§                      |
| duration        | Integer| å¦   | æ˜¾ç¤ºæ—¶é•¿(ç§’),nullè¡¨ç¤ºæŒç»­   |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "display task created",
    "data": {
        "taskId": "task-123456",
        "wallId": 1,
        "status": "displaying",
        "startTime": "2024-01-15T10:30:25Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 8.2 åœæ­¢ä¸Šå¢™ä»»åŠ¡æ¥å£

**æ¥å£åœ°å€**ï¼š`DELETE /ivs/v1/wall/task/{taskId}`

**æ¥å£æè¿°**ï¼šåœæ­¢æ˜¾ç¤ºä»»åŠ¡

**æƒé™è¦æ±‚**ï¼šLevel 2ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "task stopped",
    "data": {
        "taskId": "task-123456",
        "endTime": "2024-01-15T10:35:25Z"
    },
    "timestamp": "2024-01-15T10:35:25Z",
    "requestId": "req-123456"
}
```

---

## 9. æ¶ˆæ¯ä¸­å¿ƒæ¥å£

### 9.1 åˆ›å»ºè®¢é˜…æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/message/subscription`

**æ¥å£æè¿°**ï¼šåˆ›å»ºæ¶ˆæ¯è®¢é˜…

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "subscriptionName": "è®¾å¤‡å‘Šè­¦è®¢é˜…",
    "eventTypes": ["device_offline", "alarm_triggered"],
    "filterConditions": {
        "deviceIds": [1, 2, 3],
        "alarmLevels": ["warning", "critical"]
    },
    "notificationChannels": ["app", "email"],
    "templateId": 1
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 201,
    "message": "create success",
    "data": {
        "subscriptionId": 1001,
        "subscriptionName": "è®¾å¤‡å‘Šè­¦è®¢é˜…"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 9.2 æ¶ˆæ¯åˆ—è¡¨æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/message`

**æ¥å£æè¿°**ï¼šè·å–æ¶ˆæ¯åˆ—è¡¨

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "pageNum": 1,
    "pageSize": 20,
    "eventType": "alarm_triggered",
    "status": "unread",
    "channel": "app"
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "id": 2001,
                "title": "è®¾å¤‡å‘Šè­¦é€šçŸ¥",
                "content": "æ‘„åƒå¤´001æ£€æµ‹åˆ°äººå‘˜å¾˜å¾Š",
                "eventType": "alarm_triggered",
                "channel": "app",
                "sendStatus": "sent",
                "readStatus": "unread",
                "priority": 3,
                "createTime": "2024-01-15T10:30:25Z",
                "readTime": null
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 156,
            "totalPages": 8
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 9.3 æ ‡è®°å·²è¯»æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/message/{messageId}/read`

**æ¥å£æè¿°**ï¼šæ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "read success",
    "data": {
        "messageId": 2001,
        "readTime": "2024-01-15T10:30:25Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## 10. ç³»ç»Ÿç®¡ç†æ¥å£

### 10.1 ç”¨æˆ·åˆ—è¡¨æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/system/user`

**æ¥å£æè¿°**ï¼šè·å–ç”¨æˆ·åˆ—è¡¨

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "list": [
            {
                "id": 1,
                "username": "admin",
                "realName": "ç³»ç»Ÿç®¡ç†å‘˜",
                "email": "admin@company.com",
                "phone": "13800138000",
                "deptId": 1,
                "deptName": "ç³»ç»Ÿéƒ¨",
                "status": 1,
                "securityLevel": {
                    "levelValue": 5,
                    "levelName": "ç»å¯†çº§"
                },
                "lastLoginTime": "2024-01-15T10:00:00Z",
                "createTime": "2024-01-01T10:00:00Z"
            }
        ],
        "pagination": {
            "currentPage": 1,
            "pageSize": 20,
            "total": 50,
            "totalPages": 3
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 10.2 è®¾ç½®ç”¨æˆ·å®‰å…¨çº§åˆ«æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/system/user/{userId}/security-level`

**æ¥å£æè¿°**ï¼šè®¾ç½®ç”¨æˆ·å®‰å…¨çº§åˆ«

**æƒé™è¦æ±‚**ï¼šLevel 5ï¼ˆç»å¯†çº§ï¼‰

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "securityLevelId": 2,
    "effectiveTime": "2024-01-15T00:00:00Z",
    "expireTime": "2024-12-31T23:59:59Z"
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "set security level success",
    "data": {
        "userId": 1001,
        "securityLevelId": 2,
        "effectiveTime": "2024-01-15T00:00:00Z"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 10.3 åˆ†é…è®¾å¤‡æƒé™æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /ivs/v1/system/user/{userId}/device-permission`

**æ¥å£æè¿°**ï¼šåˆ†é…ç”¨æˆ·è®¾å¤‡è®¿é—®æƒé™

**æƒé™è¦æ±‚**ï¼šLevel 3ä»¥ä¸Š

**è¯·æ±‚å‚æ•°**ï¼š

```json
{
    "deviceIds": [1, 2, 3],
    "permissionType": "WRITE"
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å­—æ®µ          | ç±»å‹   | å¿…å¡« | è¯´æ˜                          |
|---------------|--------|------|-------------------------------|
| deviceIds     | Array  | æ˜¯   | è®¾å¤‡IDåˆ—è¡¨                    |
| permissionType| String | æ˜¯   | æƒé™ç±»å‹ï¼šVIEW/READ/WRITE/ALL |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "assign device permission success",
    "data": {
        "userId": 1001,
        "assignedDevices": [1, 2, 3],
        "permissionType": "WRITE"
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## 11. é€šç”¨æ¥å£

### 11.1 ç³»ç»Ÿæ¦‚è§ˆæ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/system/overview`

**æ¥å£æè¿°**ï¼šè·å–ç³»ç»Ÿæ¦‚è§ˆä¿¡æ¯

**æƒé™è¦æ±‚**ï¼šLevel 1ä»¥ä¸Š

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "success",
    "data": {
        "deviceStats": {
            "total": 100,
            "online": 85,
            "offline": 15,
            "alarm": 3
        },
        "recordStats": {
            "todayCount": 1200,
            "totalSize": 107374182400,
            "storageUsage": 45.6
        },
        "alarmStats": {
            "todayCount": 23,
            "unprocessed": 12,
            "processed": 11
        },
        "userStats": {
            "totalUsers": 50,
            "onlineUsers": 25
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

### 11.2 å¥åº·æ£€æŸ¥æ¥å£

**æ¥å£åœ°å€**ï¼š`GET /ivs/v1/health`

**æ¥å£æè¿°**ï¼šç³»ç»Ÿå¥åº·æ£€æŸ¥

**æƒé™è¦æ±‚**ï¼šæ— éœ€è®¤è¯

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
    "code": 200,
    "message": "healthy",
    "data": {
        "status": "UP",
        "timestamp": "2024-01-15T10:30:25Z",
        "version": "1.0.0",
        "components": {
            "database": "UP",
            "redis": "UP",
            "storage": "UP"
        }
    },
    "timestamp": "2024-01-15T10:30:25Z",
    "requestId": "req-123456"
}
```

---

## ğŸ“ æ€»ç»“

æœ¬æ¥å£è®¾è®¡è§„èŒƒæ–‡æ¡£å…¨é¢å®šä¹‰äº†æ™ºèƒ½è§†é¢‘æ¨¡å—çš„APIæ¥å£ï¼š

### æ ¸å¿ƒç‰¹æ€§
- **RESTfulè®¾è®¡**ï¼šæ ‡å‡†RESTæ¶æ„é£æ ¼
- **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šä¸€è‡´çš„JSONå“åº”ç»“æ„
- **æƒé™æ§åˆ¶**ï¼š5çº§å®‰å…¨ä½“ç³»é›†æˆ
- **åˆ†é¡µæŸ¥è¯¢**ï¼šæ‰€æœ‰åˆ—è¡¨æ¥å£æ”¯æŒåˆ†é¡µ
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

### æ¥å£æ¨¡å—
1. **è®¾å¤‡ç®¡ç†**ï¼šCRUDæ“ä½œã€è®¾å¤‡æ“ä½œ
2. **å®æ—¶ç›‘æ§**ï¼šè§†é¢‘æµã€äº‘å°æ§åˆ¶ã€æˆªå›¾å½•åƒ
3. **å½•åƒå›æ”¾**ï¼šæŸ¥è¯¢ã€å›æ”¾ã€ä¸‹è½½
4. **å‘Šè­¦ç®¡ç†**ï¼šå®æ—¶å‘Šè­¦ã€å‘Šè­¦å¤„ç†ã€è§„åˆ™é…ç½®
5. **æ™ºèƒ½åˆ†æ**ï¼šå®æ—¶ç»“æœã€å†å²æŸ¥è¯¢ã€è§„åˆ™é…ç½®
6. **è§£ç ä¸Šå¢™**ï¼šæ˜¾ç¤ºä»»åŠ¡ç®¡ç†
7. **æ¶ˆæ¯ä¸­å¿ƒ**ï¼šè®¢é˜…ç®¡ç†ã€æ¶ˆæ¯åˆ—è¡¨
8. **ç³»ç»Ÿç®¡ç†**ï¼šç”¨æˆ·ç®¡ç†ã€æƒé™åˆ†é…

**ä¸‹ä¸€æ­¥**ï¼šåˆ›å»ºé¡¹ç›®æ€»ç»“æ–‡æ¡£ã€‚

---

*æœ¬æ–‡æ¡£è¯¦ç»†å®šä¹‰äº†æ™ºèƒ½è§†é¢‘æ¨¡å—çš„æ‰€æœ‰APIæ¥å£è§„èŒƒï¼ŒåŒ…æ‹¬è¯·æ±‚å‚æ•°ã€å“åº”æ ¼å¼ã€æƒé™è¦æ±‚ç­‰å†…å®¹ã€‚*
