# ZKBioSecurity-ACC门禁系统 - 区域空间管理模块流程图

## 区域空间管理模块概述

基于公共区域模块统一维护，门禁系统的区域管理模块主要负责：
- 区域信息查询和修改
- 区域内门禁管理
- 区域内人员权限管理
- 区域权限自动分配
- 区域通行监控

## 区域空间管理模块流程图

```mermaid
graph TB
    subgraph 区域空间管理模块
        AreaStart(区域管理开始) --> AreaChoose{选择操作类型}

        AreaChoose -->|区域信息管理| AreaManage
        AreaChoose -->|门管理| DoorManage
        AreaChoose -->|人员管理| PersonManage
        AreaChoose -->|权限管理| AuthManage
        AreaChoose -->|区域监控| AreaMonitor

        subgraph 区域信息管理流程
            AreaManage --> SelectArea[选择区域]
            SelectArea --> AreaInfo{区域信息操作}
            AreaInfo -->|查询| AreaQuery[查询区域信息]
            AreaInfo -->|修改| AreaEdit[修改区域信息]
            AreaQuery --> AreaSummary[查看区域概览]
            AreaEdit --> AreaSummary
            AreaSummary --> AreaEnd[区域信息管理完成]
        end

        subgraph 门管理流程
            DoorManage --> SelectDoorArea[选择区域]
            SelectDoorArea --> CheckAreaDevice{检查区域设备}
            CheckAreaDevice -->|无设备| DoorNoDevice[提示：请先在设备管理中添加设备到区域]
            CheckAreaDevice -->|有设备| ViewAreaDoors[查看区域门列表]
            ViewAreaDoors --> DoorOperation{门操作类型}
            DoorOperation -->|新增门| AddDoor[新增门]
            DoorOperation -->|编辑门| EditDoor[编辑门信息]
            DoorOperation -->|删除门| DeleteDoor[删除门]
            AddDoor --> DoorConfig[配置门参数]
            DoorConfig --> AutoAuthPerson[自动分配权限给区域人员]
            AutoAuthPerson --> SaveDoor[保存门信息]
            SaveDoor --> DoorEnd[门管理完成]
            EditDoor --> DoorEnd
            DeleteDoor --> DoorEnd
            DoorNoDevice --> DoorEnd
        end

        subgraph 人员管理流程
            PersonManage --> SelectPersonArea[选择区域]
            SelectPersonArea --> ViewAreaPersons[查看区域人员列表]
            ViewAreaPersons --> PersonOperation{人员操作类型}
            PersonOperation -->|新增人员| AddPerson[新增人员到区域]
            PersonOperation -->|编辑人员| EditPerson[编辑人员信息]
            PersonOperation -->|移除人员| RemovePerson[移除人员]
            AddPerson --> PersonConfig[配置人员信息]
            PersonConfig --> AutoAuthDoor[自动分配区域所有门权限]
            AutoAuthDoor --> SavePerson[保存人员信息]
            SavePerson --> PersonEnd[人员管理完成]
            EditPerson --> PersonEnd
            RemovePerson --> PersonEnd
        end

        subgraph 权限管理流程
            AuthManage --> SelectAuthArea[选择区域]
            SelectAuthArea --> AuthView{权限查看}
            AuthView --> PersonDoorAuth[人员-门权限关系]
            AuthView --> ViewAreaDoors2[查看区域门列表]
            AuthView --> ViewAreaPersons2[查看区域人员列表]
            PersonDoorAuth --> AuthOperation{权限操作}
            AuthOperation -->|权限调整| AdjustAuth[调整人员门权限]
            AuthOperation -->|权限回收| RevokeAuth[回收人员权限]
            AuthOperation -->|批量权限| BatchAuth[批量权限操作]
            AdjustAuth --> AuthUpdate[更新权限配置]
            RevokeAuth --> AuthUpdate
            BatchAuth --> AuthUpdate
            AuthUpdate --> AuthEnd[权限管理完成]
        end

        subgraph 区域监控流程
            AreaMonitor --> SelectMonitorArea[选择区域]
            SelectMonitorArea --> MonitorType{监控类型}
            MonitorType -->|设备状态| DeviceMonitor[监控区域设备状态]
            MonitorType -->|人员通行| AccessMonitor[监控人员通行记录]
            MonitorType -->|区域容量| CapacityMonitor[监控区域容量]
            MonitorType -->|门状态| DoorMonitor[监控门状态]
            DeviceMonitor --> DeviceAlert[设备异常告警]
            AccessMonitor --> AccessLog[通行记录统计]
            CapacityMonitor --> CapacityAlert[容量超限告警]
            DoorMonitor --> DoorStatusLog[门状态日志]
            DeviceAlert --> MonitorEnd[区域监控完成]
            AccessLog --> MonitorEnd
            CapacityAlert --> MonitorEnd
            DoorStatusLog --> MonitorEnd
        end
    end

    subgraph 权限自动分配机制
        NewPerson[新增人员] --> PersonAreaCheck[检查人员所属区域]
        PersonAreaCheck --> GetAreaDoors[获取区域所有门]
        GetAreaDoors --> AutoPersonAuth[自动分配门权限]
        AutoPersonAuth --> PersonAuthSave[保存人员权限配置]

        NewDoor[新增门] --> DoorAreaCheck[检查门所属区域]
        DoorAreaCheck --> GetAreaPersons[获取区域所有人员]
        GetAreaPersons --> AutoDoorAuth[自动分配人员权限]
        AutoDoorAuth --> DoorAuthSave[保存门权限配置]
    end
```

## 核心功能说明
## 📋 IOE-DREAM七微服务架构

**核心架构组成**:
- **Gateway Service (8080)**: API网关
- **Common Service (8088)**: 公共模块微服务
- **DeviceComm Service (8087)**: 设备通讯微服务
- **OA Service (8089)**: OA微服务
- **Access Service (8090)**: 门禁服务
- **Attendance Service (8091)**: 考勤服务
- **Video Service (8092)**: 视频服务
- **Consume Service (8094)**: 消费服务
- **Visitor Service (8095)**: 访客服务

**架构特点**:
- 基于Spring Boot 3.5.8 + Java 17
- 严格遵循企业级微服务规范
- 支持高并发、高可用、水平扩展

**技术栈标准**:
- **数据库**: MySQL 8.0 + Druid连接池
- **缓存**: Redis + Caffeine多级缓存
- **注册中心**: Nacos
- **配置中心**: Nacos Config
- **认证授权**: Sa-Token

## 🏗️ 四层架构规范

**标准架构模式**:
```
Controller (接口控制层)
    ↓
Service (核心业务层)
    ↓
Manager (流程管理层)
    ↓
DAO (数据访问层)
```

**层级职责**:
- **Controller层**: HTTP请求处理、参数验证、权限控制
- **Service层**: 核心业务逻辑、事务管理、业务规则验证
- **Manager层**: 复杂流程编排、多数据组装、第三方服务集成
- **DAO层**: 数据库CRUD操作、SQL查询实现、数据访问边界

**严格禁止跨层访问**: Controller不能直接调用Manager/DAO！
### 区域信息管理
## ⚠️ IOE-DREAM零容忍规则（强制执行）

**必须遵守的架构规则**:
- ✅ **必须使用 @Resource 注入依赖**
- ✅ **必须使用 @Mapper 注解** (禁止@Repository)
- ✅ **必须使用 Dao 后缀** (禁止Repository)
- ✅ **必须使用 @RestController 注解**
- ✅ **必须使用 @Valid 参数校验**
- ✅ **必须返回统一ResponseDTO格式**
- ✅ **必须遵循四层架构边界**

**严格禁止事项**:
- ❌ **禁止使用 @Autowired 注入**
- ❌ **禁止使用 @Repository 注解**
- ❌ **禁止使用 Repository 后缀命名**
- ❌ **禁止跨层访问**
- ❌ **禁止在Controller中包含业务逻辑**
- ❌ **禁止直接访问数据库**

**违规后果**: P0级问题，立即修复，禁止合并！
1. **区域查询**：查询区域基本信息、区域概览统计
2. **区域修改**：修改区域名称、描述等基本信息（区域由公共模块统一维护）
3. **区域概览**：查看区域内的门数量、人员数量、设备数量等统计信息
4. **权限概览**：查看区域整体权限配置情况

### 门管理流程
1. **设备前置检查**：新增门前检查区域是否有关联的设备
2. **门列表管理**：查看、编辑、删除区域内的门
3. **自动权限分配**：新增门后，区域内所有人员自动获得该门的通行权限
4. **门信息配置**：设置门的验证方式、开放时间等参数
5. **权限继承**：门权限自动继承区域人员权限

### 人员管理流程
1. **人员列表管理**：查看、编辑、移除区域内的人员
2. **区域人员分配**：将人员分配到指定区域
3. **自动门权限**：新增人员后自动获得区域内所有门的通行权限
4. **权限继承**：人员权限自动继承区域门权限
5. **权限范围**：人员只能访问所属区域的门

### 权限管理流程
1. **权限矩阵查看**：以矩阵形式查看人员-门的权限关系
2. **权限调整**：在自动分配基础上进行个性化权限调整
3. **权限回收**：回收人员的门禁通行权限
4. **批量权限操作**：支持批量调整人员权限
5. **权限验证**：确保权限配置的合法性和一致性

### 区域监控
1. **设备状态监控**：实时监控区域内设备在线状态
2. **门状态监控**：监控门的开关状态、异常告警
3. **人员通行监控**：统计区域内人员通行记录
4. **容量监控**：监控区域人员容量，超限告警
5. **异常告警**：设备离线、异常通行等告警

## 权限自动分配机制

### 新增门权限自动分配
```mermaid
graph LR
    NewDoor[新增门] --> AreaCheck[检查所属区域]
    AreaCheck --> GetPersons[获取区域所有人员]
    GetPersons --> AutoAuth[自动分配通行权限]
    AutoAuth --> AuthSave[保存权限配置]
```

### 新增人员权限自动分配
```mermaid
graph LR
    NewPerson[新增人员] --> AreaCheck[检查所属区域]
    AreaCheck --> GetDoors[获取区域所有门]
    GetDoors --> AutoAuth[自动分配通行权限]
    AutoAuth --> AuthSave[保存权限配置]
```

## 重要特性

### 权限继承机制
- **人员继承门的权限**：新增人员自动获得区域内所有门的权限
- **门继承人员的权限**：新增门自动对区域内所有人员开放
- **区域权限边界**：人员只能访问所属区域的门禁

### 设备依赖机制
- 门管理依赖于设备管理中已关联到区域的设备
- 无设备的区域无法创建门，需要先在设备管理中添加设备

### 数据一致性
- 权限自动分配确保数据一致性
- 区域变更时同步更新相关权限
- 权限变更实时生效

## 与设备管理的关系

### 设备管理职责
- 设备添加时选择关联的区域ID
- 设备区域关联和变更管理
- 设备配置和维护功能

### 区域管理职责
- 基于已关联设备进行门管理
- 区域内人员权限管理
- 权限自动分配和调整
- 区域通行监控

### 协作流程
1. **设备管理**：添加设备并关联区域
2. **区域管理**：基于关联设备创建门
3. **权限自动分配**：门和人员权限自动同步
4. **监控**：区域和设备状态统一监控