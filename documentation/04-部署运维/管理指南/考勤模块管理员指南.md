# 考勤模块管理员指南

## 1. 概述

考勤模块管理员指南为系统管理员提供考勤模块的配置、管理和维护指导，确保系统稳定运行和数据准确性。

### 1.1 管理员职责

- 系统配置和参数设置
- 考勤规则制定和维护
- 用户权限管理
- 数据备份和恢复
- 系统监控和故障处理
- 用户支持和培训

### 1.2 系统要求

- Java 17 + Spring Boot 3.x
- MySQL 8.0+
- Redis 6.x+
- Node.js 18.x+

## 2. 系统配置

### 2.1 数据库配置

#### 2.1.1 数据库连接

在 `sa-base/src/main/resources/dev/sa-base.yaml` 中配置数据库连接：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/smart_admin_v3?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    username: root
    password: root1234
    driver-class-name: com.mysql.cj.jdbc.Driver
```

#### 2.1.2 数据库表结构

考勤模块主要涉及以下数据表：

- `t_attendance_record`: 考勤记录表
- `t_attendance_schedule`: 排班表
- `t_attendance_rule`: 考勤规则表
- `t_attendance_exception`: 考勤异常表
- `t_punch_correction`: 补卡申请表

### 2.2 Redis配置

在 `sa-base/src/main/resources/dev/sa-base.yaml` 中配置Redis连接：

```yaml
spring:
  redis:
    host: localhost
    port: 6389
    password: zkteco3100
    database: 1
    jedis:
      pool:
        max-active: 20
        max-wait: -1
        max-idle: 10
        min-idle: 0
```

### 2.3 考勤参数配置

#### 2.3.1 打卡范围设置

在系统配置中设置打卡允许的范围（单位：米）：
- 默认范围：100米
- 可根据实际需求调整

#### 2.3.2 时间规则设置

配置考勤时间相关规则：
- 上班时间：默认09:00
- 下班时间：默认18:00
- 迟到判定：上班后5分钟
- 早退判定：下班前5分钟
- 加班判定：下班后60分钟

## 3. 考勤规则管理
## 📋 IOE-DREAM七微服务架构

**核心架构组成**:
- **Gateway Service (8080)**: API网关
- **Common Service (8088)**: 公共模块微服务
- **DeviceComm Service (8087)**: 设备通讯微服务
- **OA Service (8089)**: OA微服务
- **Access Service (8090)**: 门禁服务
- **Attendance Service (8091)**: 考勤服务
- **Video Service (8092)**: 视频服务
- **Consume Service (8094)**: 消费服务
- **Visitor Service (8095)**: 访客服务

**架构特点**:
- 基于Spring Boot 3.5.8 + Java 17
- 严格遵循企业级微服务规范
- 支持高并发、高可用、水平扩展

**技术栈标准**:
- **数据库**: MySQL 8.0 + Druid连接池
- **缓存**: Redis + Caffeine多级缓存
- **注册中心**: Nacos
- **配置中心**: Nacos Config
- **认证授权**: Sa-Token

## 🏗️ 四层架构规范

**标准架构模式**:
```
Controller (接口控制层)
    ↓
Service (核心业务层)
    ↓
Manager (流程管理层)
    ↓
DAO (数据访问层)
```

**层级职责**:
- **Controller层**: HTTP请求处理、参数验证、权限控制
- **Service层**: 核心业务逻辑、事务管理、业务规则验证
- **Manager层**: 复杂流程编排、多数据组装、第三方服务集成
- **DAO层**: 数据库CRUD操作、SQL查询实现、数据访问边界

**严格禁止跨层访问**: Controller不能直接调用Manager/DAO！
### 3.1 规则类型
## ⚠️ IOE-DREAM零容忍规则（强制执行）

**必须遵守的架构规则**:
- ✅ **必须使用 @Resource 注入依赖**
- ✅ **必须使用 @Mapper 注解** (禁止@Repository)
- ✅ **必须使用 Dao 后缀** (禁止Repository)
- ✅ **必须使用 @RestController 注解**
- ✅ **必须使用 @Valid 参数校验**
- ✅ **必须返回统一ResponseDTO格式**
- ✅ **必须遵循四层架构边界**

**严格禁止事项**:
- ❌ **禁止使用 @Autowired 注入**
- ❌ **禁止使用 @Repository 注解**
- ❌ **禁止使用 Repository 后缀命名**
- ❌ **禁止跨层访问**
- ❌ **禁止在Controller中包含业务逻辑**
- ❌ **禁止直接访问数据库**

**违规后果**: P0级问题，立即修复，禁止合并！

#### 3.1.1 基础规则

- 工作日设置：周一至周五
- 工作时间设置：上班/下班时间
- 考勤异常判定规则

#### 3.1.2 特殊规则

- 节假日规则
- 部门特殊规则
- 员工个性化规则

### 3.2 规则配置

#### 3.2.1 全局规则配置

1. 进入系统管理 -> 考勤规则管理
2. 设置全局考勤规则
3. 配置迟到、早退、加班判定时间
4. 设置打卡范围和验证方式

#### 3.2.2 部门规则配置

1. 选择特定部门
2. 设置部门专属考勤规则
3. 可覆盖全局规则设置

#### 3.2.3 员工规则配置

1. 选择特定员工
2. 设置个性化考勤规则
3. 可覆盖部门和全局规则

## 4. 用户权限管理

### 4.1 角色权限设置

#### 4.1.1 员工权限

- 考勤打卡
- 查看个人考勤记录
- 提交补卡申请
- 查看个人统计

#### 4.1.2 部门主管权限

- 查看部门考勤统计
- 审批部门补卡申请
- 查看部门排班信息
- 导出部门考勤数据

#### 4.1.3 HR权限

- 查看全公司考勤统计
- 管理考勤规则
- 处理考勤异常
- 导出所有考勤数据

#### 4.1.4 管理员权限

- 系统配置管理
- 用户权限分配
- 数据备份恢复
- 系统监控维护

### 4.2 权限分配

1. 进入系统管理 -> 角色权限管理
2. 选择或创建角色
3. 分配相应的考勤模块权限
4. 将角色分配给用户

## 5. 数据管理

### 5.1 数据备份

#### 5.1.1 自动备份

配置定时任务进行数据备份：
```bash
# 每天凌晨2点执行备份
0 0 2 * * ? /backup/attendance-backup.sh
```

#### 5.1.2 手动备份

1. 进入系统管理 -> 数据备份
2. 选择考勤相关数据表
3. 执行备份操作
4. 下载备份文件

### 5.2 数据恢复

1. 进入系统管理 -> 数据恢复
2. 上传备份文件
3. 选择需要恢复的数据表
4. 执行恢复操作

### 5.3 数据清理

#### 5.3.1 历史数据清理

配置定期清理过期数据：
- 考勤记录保留2年
- 补卡申请记录保留1年
- 系统日志保留6个月

#### 5.3.2 清理策略

1. 进入系统管理 -> 数据清理
2. 设置清理规则和保留时间
3. 执行清理任务
4. 查看清理报告

## 6. 系统监控

### 6.1 性能监控

#### 6.1.1 数据库监控

监控数据库性能指标：
- 查询响应时间
- 连接数使用情况
- 索引使用效率

#### 6.1.2 Redis监控

监控Redis性能指标：
- 内存使用情况
- 缓存命中率
- 连接数

#### 6.1.3 API监控

监控API接口性能：
- 接口响应时间
- 错误率统计
- 并发访问量

### 6.2 日志管理

#### 6.2.1 系统日志

记录系统运行日志：
- 启动日志
- 错误日志
- 警告日志

#### 6.2.2 业务日志

记录考勤业务日志：
- 打卡日志
- 排班变更日志
- 统计计算日志

### 6.3 告警设置

#### 6.3.1 性能告警

设置性能阈值告警：
- 数据库查询超时告警
- Redis内存使用率告警
- API响应时间告警

#### 6.3.2 业务告警

设置业务异常告警：
- 大量补卡申请告警
- 考勤异常统计告警
- 系统错误告警

## 7. 故障处理

### 7.1 常见故障

#### 7.1.1 打卡失败

**故障现象**: 员工无法正常打卡
**处理步骤**:
1. 检查网络连接
2. 检查GPS定位服务
3. 检查打卡范围设置
4. 检查用户权限配置
5. 查看系统日志定位问题

#### 7.1.2 数据统计异常

**故障现象**: 考勤统计数据不准确
**处理步骤**:
1. 检查考勤规则配置
2. 验证数据完整性
3. 重新计算统计数据
4. 检查定时任务执行情况

#### 7.1.3 系统响应慢

**故障现象**: 系统操作响应缓慢
**处理步骤**:
1. 检查服务器资源使用情况
2. 检查数据库性能
3. 检查Redis缓存状态
4. 优化慢查询SQL
5. 调整系统配置参数

### 7.2 应急预案

#### 7.2.1 数据库故障

1. 启动备用数据库
2. 切换数据库连接
3. 恢复业务运行
4. 修复主数据库问题
5. 切换回主数据库

#### 7.2.2 系统宕机

1. 检查系统日志定位故障原因
2. 重启应用服务
3. 验证系统功能
4. 通知用户系统恢复
5. 分析故障原因并改进

## 8. 系统维护

### 8.1 定期维护任务

#### 8.1.1 每日维护

- 检查系统运行状态
- 查看错误日志
- 监控性能指标
- 备份重要数据

#### 8.1.2 每周维护

- 清理过期数据
- 优化数据库索引
- 更新系统配置
- 检查安全设置

#### 8.1.3 每月维护

- 审核用户权限
- 检查考勤规则
- 生成维护报告
- 规划系统升级

### 8.2 系统升级

#### 8.2.1 升级准备

1. 备份当前系统
2. 检查升级文档
3. 准备测试环境
4. 制定回滚计划

#### 8.2.2 升级步骤

1. 停止应用服务
2. 部署新版本代码
3. 更新数据库结构
4. 配置新功能参数
5. 启动应用服务
6. 验证系统功能

#### 8.2.3 升级验证

1. 功能测试
2. 性能测试
3. 安全测试
4. 用户验收测试

## 9. 安全管理

### 9.1 数据安全

#### 9.1.1 数据加密

- 敏感数据加密存储
- 传输数据加密
- 数据库连接加密

#### 9.1.2 访问控制

- 用户身份认证
- 权限访问控制
- 数据操作审计

### 9.2 系统安全

#### 9.2.1 网络安全

- 防火墙配置
- 入侵检测
- 安全扫描

#### 9.2.2 应用安全

- SQL注入防护
- XSS攻击防护
- CSRF攻击防护

## 10. 性能优化

### 10.1 数据库优化

#### 10.1.1 索引优化

- 为常用查询字段创建索引
- 定期分析索引使用情况
- 删除无用索引

#### 10.1.2 查询优化

- 优化慢查询SQL
- 使用分页查询
- 避免全表扫描

### 10.2 缓存优化

#### 10.2.1 Redis缓存

- 合理设置缓存过期时间
- 使用合适的缓存淘汰策略
- 监控缓存命中率

#### 10.2.2 应用缓存

- 使用本地缓存减少数据库访问
- 合理设置缓存大小
- 及时更新缓存数据

### 10.3 前端优化

#### 10.3.1 页面加载优化

- 减少HTTP请求数量
- 压缩静态资源
- 使用CDN加速

#### 10.3.2 交互优化

- 使用虚拟滚动处理大数据
- 实现防抖节流优化性能
- 懒加载图片和组件

---
**文档版本**: v1.0.0
**更新时间**: 2025-11-17
**适用系统**: SmartAdmin v3