# è€ƒå‹¤ç³»ç»Ÿæ•°æ®åº“è®¾è®¡

> **æ•°æ®åº“ç±»å‹**: MySQL 8.0
> **è®¾è®¡è§„èŒƒ**: éµå¾ªé¡¹ç›®æ•°æ®åº“è®¾è®¡è§„èŒƒï¼Œä½¿ç”¨utf8mb4å­—ç¬¦é›†
> **è¡¨æ•°é‡**: 12ä¸ªæ ¸å¿ƒè¡¨ + æ‰©å±•è¡¨
> **ç´¢å¼•ç­–ç•¥**: è¦†ç›–ç´¢å¼•ã€å¤åˆç´¢å¼•ã€æ€§èƒ½ä¼˜åŒ–
> **æ›´æ–°æ—¥æœŸ**: 2025-12-16

---

## ğŸ“‹ æ•°æ®åº“æ¦‚è¿°

è€ƒå‹¤ç³»ç»Ÿæ•°æ®åº“é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œåˆ†ä¸ºæ’ç­ç®¡ç†ã€è€ƒå‹¤è®°å½•ã€å‡å‹¤ç®¡ç†ã€è§„åˆ™é…ç½®ã€ç»Ÿè®¡åˆ†æç­‰æ ¸å¿ƒæ¨¡å—ï¼Œæ”¯æŒé«˜å¹¶å‘ã€å¤§æ•°æ®é‡çš„è€ƒå‹¤æ•°æ®å¤„ç†éœ€æ±‚ã€‚

### ğŸ¯ è®¾è®¡åŸåˆ™

- **æ€§èƒ½ä¼˜å…ˆ**: åˆç†è®¾è®¡ç´¢å¼•ï¼Œæ”¯æŒé«˜å¹¶å‘æŸ¥è¯¢
- **æ•°æ®å®Œæ•´**: å¤–é”®çº¦æŸã€æ•°æ®æ ¡éªŒã€äº‹åŠ¡ä¸€è‡´æ€§
- **æ‰©å±•æ€§**: æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé¢„ç•™æ‰©å±•å­—æ®µ
- **å®‰å…¨æ€§**: æ•æ„Ÿæ•°æ®åŠ å¯†ï¼Œè®¿é—®æƒé™æ§åˆ¶

---

## ğŸ—ƒï¸ æ•°æ®åº“è¡¨ç»“æ„

### 1. æ™ºèƒ½æ’ç­ç›¸å…³è¡¨

#### 1.1 æ’ç­è®¡åˆ’è¡¨ (t_attendance_schedule_plan)

**åŠŸèƒ½**: å­˜å‚¨æ’ç­è®¡åˆ’çš„é…ç½®ä¿¡æ¯ï¼Œæ”¯æŒå¤šç§æ’ç­ç®—æ³•

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_schedule_plan` (
    `plan_id` BIGINT NOT NULL COMMENT 'æ’ç­è®¡åˆ’ID',
    `plan_code` VARCHAR(50) NOT NULL COMMENT 'æ’ç­è®¡åˆ’ç¼–ç ',
    `plan_name` VARCHAR(100) NOT NULL COMMENT 'æ’ç­è®¡åˆ’åç§°',
    `department_id` BIGINT COMMENT 'éƒ¨é—¨ID',
    `plan_type` TINYINT NOT NULL COMMENT 'è®¡åˆ’ç±»å‹: 1-å›ºå®šæ’ç­ 2-å¾ªç¯æ’ç­ 3-å¼¹æ€§æ’ç­ 4-æ™ºèƒ½æ’ç­',
    `schedule_algorithm` VARCHAR(50) COMMENT 'æ’ç­ç®—æ³•: GENETIC-é—ä¼ ç®—æ³• GREEDY-è´ªå¿ƒç®—æ³• BACKTRACK-å›æº¯ç®—æ³•',
    `plan_status` TINYINT DEFAULT 1 COMMENT 'è®¡åˆ’çŠ¶æ€: 1-è‰ç¨¿ 2-å¾…å®¡æ‰¹ 3-å·²å®¡æ‰¹ 4-æ‰§è¡Œä¸­ 5-å·²å®Œæˆ 6-å·²å–æ¶ˆ',
    `effective_start_date` DATE COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸ',
    `effective_end_date` DATE COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¥æœŸ',
    `auto_approval` TINYINT DEFAULT 0 COMMENT 'è‡ªåŠ¨å®¡æ‰¹: 0-å¦ 1-æ˜¯',
    `conflict_resolution` VARCHAR(50) DEFAULT 'MANUAL' COMMENT 'å†²çªè§£å†³æ–¹å¼: MANUAL-æ‰‹åŠ¨ AUTO-è‡ªåŠ¨ PRIORITY-ä¼˜å…ˆçº§',
    `schedule_constraints` JSON COMMENT 'æ’ç­çº¦æŸæ¡ä»¶',
    `optimization_target` VARCHAR(50) COMMENT 'ä¼˜åŒ–ç›®æ ‡: BALANCE-å‡è¡¡ COST-æˆæœ¬ PREFERENCE-åå¥½',
    `description` TEXT COMMENT 'æ’ç­è®¡åˆ’æè¿°',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºäººID',
    `update_user_id` BIGINT COMMENT 'æ›´æ–°äººID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯†: 0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    `version` INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (`plan_id`),
    UNIQUE KEY `uk_plan_code` (`plan_code`, `deleted_flag`),
    KEY `idx_department_id` (`department_id`),
    KEY `idx_plan_status` (`plan_status`),
    KEY `idx_effective_date` (`effective_start_date`, `effective_end_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ’ç­è®¡åˆ’è¡¨';
```

**æ ¸å¿ƒå­—æ®µè¯´æ˜**:
- `schedule_constraints`: JSONæ ¼å¼å­˜å‚¨æ’ç­çº¦æŸæ¡ä»¶
- `optimization_target`: æ™ºèƒ½æ’ç­çš„ä¼˜åŒ–ç›®æ ‡
- `conflict_resolution`: å†²çªè‡ªåŠ¨è§£å†³ç­–ç•¥

#### 1.2 ä¸ªäººæ’ç­è¡¨ (t_attendance_personal_schedule)

**åŠŸèƒ½**: è®°å½•æ¯ä¸ªå‘˜å·¥çš„å…·ä½“æ’ç­å®‰æ’

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_personal_schedule` (
    `schedule_id` BIGINT NOT NULL COMMENT 'æ’ç­è®°å½•ID',
    `plan_id` BIGINT NOT NULL COMMENT 'æ’ç­è®¡åˆ’ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `department_id` BIGINT COMMENT 'éƒ¨é—¨ID',
    `shift_id` BIGINT COMMENT 'ç­æ¬¡ID',
    `schedule_date` DATE NOT NULL COMMENT 'æ’ç­æ—¥æœŸ',
    `work_start_time` TIME COMMENT 'ä¸Šç­æ—¶é—´',
    `work_end_time` TIME COMMENT 'ä¸‹ç­æ—¶é—´',
    `work_location` VARCHAR(100) COMMENT 'å·¥ä½œåœ°ç‚¹',
    `schedule_status` TINYINT DEFAULT 1 COMMENT 'æ’ç­çŠ¶æ€: 1-æ­£å¸¸ 2-è¯·å‡ 3-è°ƒç­ 4-åŠ ç­ 5-æ›¿ç­',
    `auto_generated` TINYINT DEFAULT 0 COMMENT 'è‡ªåŠ¨ç”Ÿæˆ: 0-å¦ 1-æ˜¯',
    `priority_level` TINYINT DEFAULT 1 COMMENT 'ä¼˜å…ˆçº§: 1-æ™®é€š 2-é‡è¦ 3-ç´§æ€¥',
    `schedule_source` VARCHAR(50) COMMENT 'æ’ç­æ¥æº: MANUAL-æ‰‹åŠ¨ AUTO-è‡ªåŠ¨ IMPORT-å¯¼å…¥ SYNC-åŒæ­¥',
    `conflict_flag` TINYINT DEFAULT 0 COMMENT 'å†²çªæ ‡è¯†: 0-æ— å†²çª 1-æœ‰æ—¶é—´å†²çª 2-æœ‰äººå‘˜å†²çª',
    `conflict_resolution` VARCHAR(200) COMMENT 'å†²çªè§£å†³æ–¹æ¡ˆ',
    `extended_attributes` JSON COMMENT 'æ‰©å±•å±æ€§',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºäººID',
    `update_user_id` BIGINT COMMENT 'æ›´æ–°äººID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯†: 0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    `version` INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (`schedule_id`),
    UNIQUE KEY `uk_user_date` (`user_id`, `schedule_date`, `deleted_flag`),
    KEY `idx_plan_id` (`plan_id`),
    KEY `idx_department_id` (`department_id`),
    KEY `idx_shift_id` (`shift_id`),
    KEY `idx_schedule_date` (`schedule_date`),
    KEY `idx_schedule_status` (`schedule_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¸ªäººæ’ç­è¡¨';
```

#### 1.3 è½®ç­è§„åˆ™è¡¨ (t_attendance_shift_rotation)

**åŠŸèƒ½**: é…ç½®å¤æ‚çš„è½®ç­è§„åˆ™ï¼Œæ”¯æŒä¸‰ç­å€’ã€å››ç­ä¸‰å€’ç­‰æ¨¡å¼

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_shift_rotation` (
    `rotation_id` BIGINT NOT NULL COMMENT 'è½®ç­è§„åˆ™ID',
    `rotation_code` VARCHAR(50) NOT NULL COMMENT 'è½®ç­è§„åˆ™ç¼–ç ',
    `rotation_name` VARCHAR(100) NOT NULL COMMENT 'è½®ç­è§„åˆ™åç§°',
    `rotation_type` TINYINT NOT NULL COMMENT 'è½®ç­ç±»å‹: 1-ä¸‰ç­å€’ 2-å››ç­ä¸‰å€’ 3-äº”ç­å››å€’ 4-è‡ªå®šä¹‰',
    `cycle_days` INT NOT NULL COMMENT 'è½®ç­å‘¨æœŸå¤©æ•°',
    `rotation_shifts` JSON NOT NULL COMMENT 'è½®ç­ç­æ¬¡é…ç½®',
    `rotation_groups` JSON COMMENT 'è½®ç­åˆ†ç»„é…ç½®',
    `effective_start_date` DATE NOT NULL COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸ',
    `effective_end_date` DATE COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¥æœŸ',
    `auto_rotate` TINYINT DEFAULT 1 COMMENT 'è‡ªåŠ¨è½®ç­: 0-å¦ 1-æ˜¯',
    `rotation_frequency` VARCHAR(50) DEFAULT 'DAILY' COMMENT 'è½®ç­é¢‘ç‡: DAILY-æ¯æ—¥ WEEKLY-æ¯å‘¨ MONTHLY-æ¯æœˆ',
    `conflict_handling` VARCHAR(50) DEFAULT 'SKIP' COMMENT 'å†²çªå¤„ç†: SKIP-è·³è¿‡ OVERRIDE-è¦†ç›– PROMPT-æç¤º',
    `holiday_handling` VARCHAR(50) DEFAULT 'NORMAL' COMMENT 'èŠ‚å‡æ—¥å¤„ç†: NORMAL-æ­£å¸¸ SKIP-è·³è¿‡ SUBSTITUTE-æ›¿ä»£',
    `rotation_status` TINYINT DEFAULT 1 COMMENT 'è½®ç­çŠ¶æ€: 1-å¯ç”¨ 0-ç¦ç”¨',
    `description` TEXT COMMENT 'è½®ç­è§„åˆ™æè¿°',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºäººID',
    `update_user_id` BIGINT COMMENT 'æ›´æ–°äººID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯†: 0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    `version` INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (`rotation_id`),
    UNIQUE KEY `uk_rotation_code` (`rotation_code`, `deleted_flag`),
    KEY `idx_rotation_type` (`rotation_type`),
    KEY `idx_effective_date` (`effective_start_date`, `effective_end_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è½®ç­è§„åˆ™è¡¨';
```

### 2. è€ƒå‹¤è®°å½•ç›¸å…³è¡¨

#### 2.1 è€ƒå‹¤è®°å½•è¡¨ (t_attendance_record)

**åŠŸèƒ½**: æ ¸å¿ƒè€ƒå‹¤æ‰“å¡è®°å½•ï¼Œå­˜å‚¨æ‰€æœ‰æ‰“å¡æ•°æ®

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_record` (
    `record_id` BIGINT NOT NULL COMMENT 'è€ƒå‹¤è®°å½•ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `user_name` VARCHAR(100) NOT NULL COMMENT 'ç”¨æˆ·å§“å',
    `department_id` BIGINT COMMENT 'éƒ¨é—¨ID',
    `department_name` VARCHAR(100) COMMENT 'éƒ¨é—¨åç§°',
    `shift_id` BIGINT COMMENT 'ç­æ¬¡ID',
    `shift_name` VARCHAR(100) COMMENT 'ç­æ¬¡åç§°',
    `attendance_date` DATE NOT NULL COMMENT 'è€ƒå‹¤æ—¥æœŸ',
    `punch_time` DATETIME NOT NULL COMMENT 'æ‰“å¡æ—¶é—´',
    `attendance_status` VARCHAR(20) NOT NULL COMMENT 'è€ƒå‹¤çŠ¶æ€: NORMAL-æ­£å¸¸ LATE-è¿Ÿåˆ° EARLY-æ—©é€€ ABSENT-ç¼ºå‹¤ OVERTIME-åŠ ç­',
    `attendance_type` VARCHAR(20) NOT NULL COMMENT 'è€ƒå‹¤ç±»å‹: CHECK_IN-ä¸Šç­æ‰“å¡ CHECK_OUT-ä¸‹ç­æ‰“å¡',
    `longitude` DECIMAL(10,6) COMMENT 'æ‰“å¡ä½ç½®ç»åº¦',
    `latitude` DECIMAL(10,6) COMMENT 'æ‰“å¡ä½ç½®çº¬åº¦',
    `punch_address` VARCHAR(200) COMMENT 'æ‰“å¡åœ°å€',
    `device_id` BIGINT COMMENT 'æ‰“å¡è®¾å¤‡ID',
    `device_name` VARCHAR(100) COMMENT 'æ‰“å¡è®¾å¤‡åç§°',
    `biometric_type` VARCHAR(20) COMMENT 'ç”Ÿç‰©è¯†åˆ«ç±»å‹: FACE-äººè„¸ FINGERPRINT-æŒ‡çº¹ IRIS-è™¹è†œ',
    `biometric_score` DECIMAL(5,2) COMMENT 'ç”Ÿç‰©è¯†åˆ«åŒ¹é…ç½®ä¿¡åº¦',
    `punch_photo_url` VARCHAR(500) COMMENT 'æ‰“å¡ç…§ç‰‡URL',
    `location_verified` TINYINT DEFAULT 0 COMMENT 'ä½ç½®éªŒè¯: 0-æœªéªŒè¯ 1-å·²éªŒè¯',
    `offline_flag` TINYINT DEFAULT 0 COMMENT 'ç¦»çº¿æ‰“å¡: 0-å¦ 1-æ˜¯',
    `sync_status` TINYINT DEFAULT 1 COMMENT 'åŒæ­¥çŠ¶æ€: 1-å·²åŒæ­¥ 0-å¾…åŒæ­¥',
    `remark` VARCHAR(500) COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`record_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_department_id` (`department_id`),
    KEY `idx_shift_id` (`shift_id`),
    KEY `idx_attendance_date` (`attendance_date`),
    KEY `idx_punch_time` (`punch_time`),
    KEY `idx_attendance_status` (`attendance_status`),
    KEY `idx_attendance_type` (`attendance_type`),
    KEY `idx_device_id` (`device_id`),
    KEY `idx_user_date_type` (`user_id`, `attendance_date`, `attendance_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤è®°å½•è¡¨';
```

### 3. å‡å‹¤ç®¡ç†ç›¸å…³è¡¨

#### 3.1 è¯·å‡ç”³è¯·è¡¨ (t_attendance_leave_application)

**åŠŸèƒ½**: å­˜å‚¨å‘˜å·¥è¯·å‡ç”³è¯·çš„å®Œæ•´ä¿¡æ¯

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_leave_application` (
    `leave_id` BIGINT NOT NULL COMMENT 'è¯·å‡ID',
    `leave_code` VARCHAR(50) NOT NULL COMMENT 'è¯·å‡å•å·',
    `user_id` BIGINT NOT NULL COMMENT 'ç”³è¯·äººID',
    `department_id` BIGINT COMMENT 'ç”³è¯·äººéƒ¨é—¨ID',
    `leave_type` VARCHAR(50) NOT NULL COMMENT 'è¯·å‡ç±»å‹: SICK-ç—…å‡ PERSONAL-äº‹å‡ MATERNITY-äº§å‡ MARRIAGE-å©šå‡ ANNUAL-å¹´å‡ COMPENSATORY-è°ƒä¼‘ OTHER-å…¶ä»–',
    `leave_reason` TEXT NOT NULL COMMENT 'è¯·å‡åŸå› ',
    `start_date` DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
    `end_date` DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
    `start_time` TIME COMMENT 'å¼€å§‹æ—¶é—´',
    `end_time` TIME COMMENT 'ç»“æŸæ—¶é—´',
    `leave_duration` DECIMAL(8,2) NOT NULL COMMENT 'è¯·å‡æ—¶é•¿ï¼ˆå¤©ï¼‰',
    `leave_days` DECIMAL(5,2) NOT NULL COMMENT 'è¯·å‡å¤©æ•°',
    `leave_hours` DECIMAL(5,2) COMMENT 'è¯·å‡å°æ—¶æ•°',
    `attachment_urls` JSON COMMENT 'é™„ä»¶URLåˆ—è¡¨',
    `approver_id` BIGINT COMMENT 'å®¡æ‰¹äººID',
    `approval_status` TINYINT DEFAULT 1 COMMENT 'å®¡æ‰¹çŠ¶æ€: 1-å¾…å®¡æ‰¹ 2-å®¡æ‰¹ä¸­ 3-å·²é€šè¿‡ 4-å·²æ‹’ç» 5-å·²æ’¤é”€',
    `approval_comments` TEXT COMMENT 'å®¡æ‰¹æ„è§',
    `approval_time` DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    `emergency_contact` VARCHAR(100) COMMENT 'ç´§æ€¥è”ç³»äºº',
    `emergency_phone` VARCHAR(20) COMMENT 'ç´§æ€¥è”ç³»ç”µè¯',
    `work_handover` TEXT COMMENT 'å·¥ä½œäº¤æ¥è¯´æ˜',
    `leave_status` TINYINT DEFAULT 1 COMMENT 'è¯·å‡çŠ¶æ€: 1-ç”³è¯·ä¸­ 2-å·²æ‰¹å‡† 3-è¿›è¡Œä¸­ 4-å·²å®Œæˆ 5-å·²å–æ¶ˆ',
    `cancel_reason` TEXT COMMENT 'å–æ¶ˆåŸå› ',
    `cancel_time` DATETIME COMMENT 'å–æ¶ˆæ—¶é—´',
    `extended_attributes` JSON COMMENT 'æ‰©å±•å±æ€§',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºäººID',
    `update_user_id` BIGINT COMMENT 'æ›´æ–°äººID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯†: 0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    `version` INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (`leave_id`),
    UNIQUE KEY `uk_leave_code` (`leave_code`, `deleted_flag`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_department_id` (`department_id`),
    KEY `idx_leave_type` (`leave_type`),
    KEY `idx_approval_status` (`approval_status`),
    KEY `idx_leave_status` (`leave_status`),
    KEY `idx_start_date` (`start_date`),
    KEY `idx_end_date` (`end_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯·å‡ç”³è¯·è¡¨';
```

#### 3.2 åŠ ç­ç”³è¯·è¡¨ (t_attendance_overtime_application)

**åŠŸèƒ½**: ç®¡ç†å‘˜å·¥åŠ ç­ç”³è¯·å’Œå®¡æ‰¹

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_overtime_application` (
    `overtime_id` BIGINT NOT NULL COMMENT 'åŠ ç­ID',
    `overtime_code` VARCHAR(50) NOT NULL COMMENT 'åŠ ç­å•å·',
    `user_id` BIGINT NOT NULL COMMENT 'ç”³è¯·äººID',
    `department_id` BIGINT COMMENT 'ç”³è¯·äººéƒ¨é—¨ID',
    `overtime_type` VARCHAR(50) NOT NULL COMMENT 'åŠ ç­ç±»å‹: WEEKDAY-å·¥ä½œæ—¥ WEEKEND-å‘¨æœ« HOLIDAY-èŠ‚å‡æ—¥ EMERGENCY-ç´§æ€¥',
    `overtime_reason` TEXT NOT NULL COMMENT 'åŠ ç­åŸå› ',
    `start_date` DATE NOT NULL COMMENT 'åŠ ç­å¼€å§‹æ—¥æœŸ',
    `end_date` DATE NOT NULL COMMENT 'åŠ ç­ç»“æŸæ—¥æœŸ',
    `start_time` TIME NOT NULL COMMENT 'åŠ ç­å¼€å§‹æ—¶é—´',
    `end_time` TIME NOT NULL COMMENT 'åŠ ç­ç»“æŸæ—¶é—´',
    `overtime_hours` DECIMAL(5,2) NOT NULL COMMENT 'åŠ ç­æ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
    `compensation_type` VARCHAR(50) NOT NULL COMMENT 'è¡¥å¿æ–¹å¼: PAY-åŠ ç­è´¹ COMP_TIME-è°ƒä¼‘ MIXED-æ··åˆ',
    `overtime_rate` DECIMAL(5,2) COMMENT 'åŠ ç­å€ç‡: 1.5-1.5å€ 2.0-2å€ 3.0-3å€',
    `estimated_cost` DECIMAL(10,2) COMMENT 'é¢„ä¼°åŠ ç­æˆæœ¬',
    `approver_id` BIGINT COMMENT 'å®¡æ‰¹äººID',
    `approval_status` TINYINT DEFAULT 1 COMMENT 'å®¡æ‰¹çŠ¶æ€: 1-å¾…å®¡æ‰¹ 2-å®¡æ‰¹ä¸­ 3-å·²é€šè¿‡ 4-å·²æ‹’ç» 5-å·²æ’¤é”€',
    `approval_comments` TEXT COMMENT 'å®¡æ‰¹æ„è§',
    `approval_time` DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    `actual_hours` DECIMAL(5,2) COMMENT 'å®é™…åŠ ç­æ—¶é•¿',
    `verification_method` VARCHAR(50) COMMENT 'éªŒè¯æ–¹å¼: MANUAL-æ‰‹åŠ¨ SYSTEM-ç³»ç»Ÿ DEVICE-è®¾å¤‡',
    `verification_status` TINYINT DEFAULT 0 COMMENT 'éªŒè¯çŠ¶æ€: 0-æœªéªŒè¯ 1-å·²éªŒè¯',
    `overtime_status` TINYINT DEFAULT 1 COMMENT 'åŠ ç­çŠ¶æ€: 1-ç”³è¯·ä¸­ 2-å·²æ‰¹å‡† 3-è¿›è¡Œä¸­ 4-å·²å®Œæˆ 5-å·²å–æ¶ˆ',
    `cancel_reason` TEXT COMMENT 'å–æ¶ˆåŸå› ',
    `cancel_time` DATETIME COMMENT 'å–æ¶ˆæ—¶é—´',
    `extended_attributes` JSON COMMENT 'æ‰©å±•å±æ€§',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºäººID',
    `update_user_id` BIGINT COMMENT 'æ›´æ–°äººID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯†: 0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    `version` INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (`overtime_id`),
    UNIQUE KEY `uk_overtime_code` (`overtime_code`, `deleted_flag`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_department_id` (`department_id`),
    KEY `idx_overtime_type` (`overtime_type`),
    KEY `idx_approval_status` (`approval_status`),
    KEY `idx_overtime_status` (`overtime_status`),
    KEY `idx_start_date` (`start_date`),
    KEY `idx_end_date` (`end_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŠ ç­ç”³è¯·è¡¨';
```

### 4. è§„åˆ™å¼•æ“ç›¸å…³è¡¨

#### 4.1 è€ƒå‹¤è§„åˆ™é…ç½®è¡¨ (t_attendance_rule_config)

**åŠŸèƒ½**: å­˜å‚¨è€ƒå‹¤è§„åˆ™å¼•æ“çš„é…ç½®ä¿¡æ¯

```sql
CREATE TABLE IF NOT EXISTS `t_attendance_rule_config` (
    `rule_id` BIGINT NOT NULL COMMENT 'è§„åˆ™ID',
    `rule_code` VARCHAR(50) NOT NULL COMMENT 'è§„åˆ™ç¼–ç ',
    `rule_name` VARCHAR(100) NOT NULL COMMENT 'è§„åˆ™åç§°',
    `rule_category` VARCHAR(50) NOT NULL COMMENT 'è§„åˆ™åˆ†ç±»: TIME-æ—¶é—´è§„åˆ™ LOCATION-åœ°ç‚¹è§„åˆ™ ABSENCE-ç¼ºå‹¤è§„åˆ™ OVERTIME-åŠ ç­è§„åˆ™',
    `rule_type` VARCHAR(50) NOT NULL COMMENT 'è§„åˆ™ç±»å‹',
    `rule_condition` JSON NOT NULL COMMENT 'è§„åˆ™æ¡ä»¶',
    `rule_action` JSON NOT NULL COMMENT 'è§„åˆ™åŠ¨ä½œ',
    `rule_priority` INT DEFAULT 100 COMMENT 'è§„åˆ™ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰',
    `effective_start_time` TIME COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¶é—´',
    `effective_end_time` TIME COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¶é—´',
    `effective_days` VARCHAR(20) COMMENT 'ç”Ÿæ•ˆæ—¥æœŸ: 1,2,3,4,5,6,7',
    `department_ids` JSON COMMENT 'é€‚ç”¨éƒ¨é—¨IDåˆ—è¡¨',
    `user_ids` JSON COMMENT 'é€‚ç”¨ç”¨æˆ·IDåˆ—è¡¨',
    `rule_status` TINYINT DEFAULT 1 COMMENT 'è§„åˆ™çŠ¶æ€: 1-å¯ç”¨ 0-ç¦ç”¨',
    `rule_scope` VARCHAR(50) DEFAULT 'GLOBAL' COMMENT 'è§„åˆ™ä½œç”¨åŸŸ: GLOBAL-å…¨å±€ DEPARTMENT-éƒ¨é—¨ USER-ä¸ªäºº',
    `execution_order` INT DEFAULT 0 COMMENT 'æ‰§è¡Œé¡ºåº',
    `parent_rule_id` BIGINT COMMENT 'çˆ¶è§„åˆ™ID',
    `rule_version` VARCHAR(20) DEFAULT '1.0' COMMENT 'è§„åˆ™ç‰ˆæœ¬',
    `description` TEXT COMMENT 'è§„åˆ™æè¿°',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºäººID',
    `update_user_id` BIGINT COMMENT 'æ›´æ–°äººID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è¯†: 0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    `version` INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (`rule_id`),
    UNIQUE KEY `uk_rule_code` (`rule_code`, `deleted_flag`),
    KEY `idx_rule_category` (`rule_category`),
    KEY `idx_rule_type` (`rule_type`),
    KEY `idx_rule_priority` (`rule_priority`),
    KEY `idx_rule_status` (`rule_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤è§„åˆ™é…ç½®è¡¨';
```

---

## ğŸ”— æ•°æ®åº“å…³ç³»å›¾

```mermaid
erDiagram
    t_attendance_schedule_plan {
        BIGINT plan_id PK
        VARCHAR plan_code
        VARCHAR plan_name
        BIGINT department_id
        TINYINT plan_type
        VARCHAR schedule_algorithm
        TINYINT plan_status
        JSON schedule_constraints
    }

    t_attendance_personal_schedule {
        BIGINT schedule_id PK
        BIGINT plan_id FK
        BIGINT user_id
        BIGINT department_id
        BIGINT shift_id
        DATE schedule_date
        TIME work_start_time
        TIME work_end_time
        TINYINT schedule_status
    }

    t_attendance_record {
        BIGINT record_id PK
        BIGINT user_id
        BIGINT department_id
        BIGINT shift_id
        DATE attendance_date
        DATETIME punch_time
        VARCHAR attendance_status
        VARCHAR attendance_type
        DECIMAL longitude
        DECIMAL latitude
    }

    t_attendance_leave_application {
        BIGINT leave_id PK
        VARCHAR leave_code
        BIGINT user_id
        BIGINT department_id
        VARCHAR leave_type
        DATE start_date
        DATE end_date
        DECIMAL leave_duration
        TINYINT approval_status
    }

    t_attendance_overtime_application {
        BIGINT overtime_id PK
        VARCHAR overtime_code
        BIGINT user_id
        BIGINT department_id
        VARCHAR overtime_type
        DATETIME start_time
        DATETIME end_time
        DECIMAL overtime_hours
        TINYINT approval_status
    }

    t_attendance_rule_config {
        BIGINT rule_id PK
        VARCHAR rule_code
        VARCHAR rule_name
        VARCHAR rule_category
        JSON rule_condition
        JSON rule_action
        INT rule_priority
        TINYINT rule_status
    }

    t_attendance_shift_rotation {
        BIGINT rotation_id PK
        VARCHAR rotation_code
        VARCHAR rotation_name
        TINYINT rotation_type
        INT cycle_days
        JSON rotation_shifts
        DATE effective_start_date
    }

    t_attendance_schedule_plan ||--o{ t_attendance_personal_schedule : "åŒ…å«"
    t_attendance_personal_schedule }o--|| t_attendance_record : "å…³è”"
    t_attendance_rule_config }o--o{ t_attendance_record : "è§„åˆ™æ‰§è¡Œ"
```

---

## ğŸ“Š æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

### 1. ç´¢å¼•è®¾è®¡ç­–ç•¥

#### 1.1 æ ¸å¿ƒæŸ¥è¯¢ç´¢å¼•
```sql
-- è€ƒå‹¤è®°å½•å¤åˆç´¢å¼•ï¼ˆæœ€å¸¸ç”¨æŸ¥è¯¢ï¼‰
CREATE INDEX idx_attendance_record_query ON t_attendance_record(
    user_id, attendance_date, attendance_type, attendance_status
);

-- ä¸ªäººæ’ç­å¤åˆç´¢å¼•
CREATE INDEX idx_personal_schedule_query ON t_attendance_personal_schedule(
    user_id, schedule_date, schedule_status
);

-- è¯·å‡ç”³è¯·å¤åˆç´¢å¼•
CREATE INDEX idx_leave_application_query ON t_attendance_leave_application(
    user_id, approval_status, start_date, end_date
);
```

#### 1.2 ç»Ÿè®¡æŸ¥è¯¢ç´¢å¼•
```sql
-- è€ƒå‹¤ç»Ÿè®¡ç´¢å¼•
CREATE INDEX idx_attendance_statistics ON t_attendance_record(
    department_id, attendance_date, attendance_status
);

-- åŠ ç­ç»Ÿè®¡ç´¢å¼•
CREATE INDEX idx_overtime_statistics ON t_attendance_overtime_application(
    department_id, approval_status, start_date
);
```

### 2. åˆ†åŒºç­–ç•¥

#### 2.1 æŒ‰æ—¶é—´åˆ†åŒº
```sql
-- è€ƒå‹¤è®°å½•è¡¨æŒ‰æœˆåˆ†åŒº
ALTER TABLE t_attendance_record PARTITION BY RANGE (TO_DAYS(attendance_date)) (
    PARTITION p202501 VALUES LESS THAN (TO_DAYS('2025-02-01')),
    PARTITION p202502 VALUES LESS THAN (TO_DAYS('2025-03-01')),
    PARTITION p202503 VALUES LESS THAN (TO_DAYS('2025-04-01')),
    -- ... æ›´å¤šåˆ†åŒº
    PARTITION pmax VALUES LESS THAN MAXVALUE
);
```

### 3. æ•°æ®å½’æ¡£ç­–ç•¥

#### 3.1 å†å²æ•°æ®å½’æ¡£
```sql
-- åˆ›å»ºå†å²æ•°æ®è¡¨
CREATE TABLE t_attendance_record_history LIKE t_attendance_record;

-- å½’æ¡£ä¸€å¹´å‰çš„æ•°æ®
INSERT INTO t_attendance_record_history
SELECT * FROM t_attendance_record
WHERE attendance_date < DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR);

-- åˆ é™¤å·²å½’æ¡£çš„æ•°æ®
DELETE FROM t_attendance_record
WHERE attendance_date < DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR);
```

---

## ğŸ”’ æ•°æ®å®‰å…¨è®¾è®¡

### 1. æ•æ„Ÿæ•°æ®åŠ å¯†

#### 1.1 ç”Ÿç‰©è¯†åˆ«æ•°æ®
```sql
-- ç”Ÿç‰©è¯†åˆ«ç‰¹å¾å€¼åŠ å¯†å­˜å‚¨
ALTER TABLE t_attendance_record
ADD COLUMN biometric_hash VARCHAR(255) COMMENT 'ç”Ÿç‰©è¯†åˆ«ç‰¹å¾å“ˆå¸Œå€¼';

-- ä½¿ç”¨AESåŠ å¯†æ•æ„Ÿå­—æ®µ
ALTER TABLE t_attendance_record
ADD COLUMN encrypted_punch_address VARCHAR(500) COMMENT 'åŠ å¯†çš„æ‰“å¡åœ°å€';
```

#### 1.2 ä½ç½®ä¿¡æ¯ä¿æŠ¤
```sql
-- ä½ç½®ç²¾åº¦æ§åˆ¶ï¼ˆä¿ç•™å°æ•°ç‚¹å4ä½ï¼Œçº¦10ç±³ç²¾åº¦ï¼‰
UPDATE t_attendance_record
SET longitude = ROUND(longitude, 4),
    latitude = ROUND(latitude, 4);
```

### 2. è®¿é—®æƒé™æ§åˆ¶

#### 2.1 æ•°æ®åº“ç”¨æˆ·æƒé™
```sql
-- è€ƒå‹¤æŸ¥è¯¢ç”¨æˆ·
CREATE USER 'attendance_query'@'%' IDENTIFIED BY 'secure_password';
GRANT SELECT ON attendance_db.* TO 'attendance_query'@'%';

-- è€ƒå‹¤ç®¡ç†ç”¨æˆ·
CREATE USER 'attendance_admin'@'%' IDENTIFIED BY 'secure_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON attendance_db.* TO 'attendance_admin'@'%';
```

---

## ğŸ“ˆ æ•°æ®åº“ç›‘æ§

### 1. æ€§èƒ½ç›‘æ§æŒ‡æ ‡

#### 1.1 å…³é”®æ€§èƒ½æŒ‡æ ‡
- **æŸ¥è¯¢å“åº”æ—¶é—´**: < 100ms (95%çš„æŸ¥è¯¢)
- **å†™å…¥ååé‡**: > 1000 TPS
- **æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡**: < 80%
- **æ…¢æŸ¥è¯¢æ•°é‡**: < 5/å°æ—¶

#### 1.2 ç›‘æ§SQL
```sql
-- æ…¢æŸ¥è¯¢ç›‘æ§
SELECT * FROM mysql.slow_log
WHERE start_time > DATE_SUB(NOW(), INTERVAL 1 HOUR)
ORDER BY query_time DESC LIMIT 10;

-- ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT OBJECT_SCHEMA, OBJECT_NAME, INDEX_NAME, COUNT_READ, COUNT_FETCH
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE OBJECT_SCHEMA = 'attendance_db'
ORDER BY COUNT_READ DESC;
```

### 2. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

#### 2.1 æ•°æ®æ ¡éªŒSQL
```sql
-- æ£€æŸ¥æ’ç­æ•°æ®å®Œæ•´æ€§
SELECT COUNT(*) as missing_schedule
FROM t_common_user u
LEFT JOIN t_attendance_personal_schedule s
  ON u.user_id = s.user_id AND s.schedule_date = CURRENT_DATE
WHERE u.deleted_flag = 0
  AND u.status = 1
  AND s.schedule_id IS NULL;

-- æ£€æŸ¥è€ƒå‹¤è®°å½•ä¸€è‡´æ€§
SELECT user_id, attendance_date,
       SUM(CASE WHEN attendance_type = 'CHECK_IN' THEN 1 ELSE 0 END) as check_in_count,
       SUM(CASE WHEN attendance_type = 'CHECK_OUT' THEN 1 ELSE 0 END) as check_out_count
FROM t_attendance_record
WHERE attendance_date = CURRENT_DATE
GROUP BY user_id, attendance_date
HAVING check_in_count != 1 OR check_out_count != 1;
```

---

## ğŸ“ æ•°æ®åº“è¿ç»´

### 1. å¤‡ä»½ç­–ç•¥

#### 1.1 å¤‡ä»½è®¡åˆ’
```bash
#!/bin/bash
# æ¯æ—¥å…¨é‡å¤‡ä»½
mysqldump -u backup_user -p --single-transaction --routines --triggers \
  --databases attendance_db > /backup/attendance_$(date +%Y%m%d).sql

# æ¯å°æ—¶å¢é‡å¤‡ä»½
mysqlbinlog --start-datetime="$(date -d '1 hour ago' '+%Y-%m-%d %H:00:00')" \
  /var/lib/mysql/mysql-bin.000001 > /backup/attendance_incremental_$(date +%Y%m%d_%H).sql
```

#### 1.2 æ¢å¤ç­–ç•¥
```bash
# å…¨é‡æ¢å¤
mysql -u root -p < /backup/attendance_20250115.sql

# å¢é‡æ¢å¤
mysql -u root -p < /backup/attendance_incremental_20250115_14.sql
```

### 2. å®¹é‡ç®¡ç†

#### 2.1 å­˜å‚¨å®¹é‡è§„åˆ’
```sql
-- æŸ¥çœ‹è¡¨å¤§å°
SELECT
    table_name,
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS size_mb
FROM information_schema.tables
WHERE table_schema = 'attendance_db'
ORDER BY size_mb DESC;

-- å®¹é‡è¶‹åŠ¿é¢„æµ‹
SELECT
    DATE_FORMAT(create_time, '%Y-%m') as month,
    COUNT(*) as record_count,
    ROUND(COUNT(*) / 30, 2) as daily_avg
FROM t_attendance_record
WHERE create_time >= DATE_SUB(NOW(), INTERVAL 6 MONTH)
GROUP BY DATE_FORMAT(create_time, '%Y-%m')
ORDER BY month;
```

---

## ğŸš€ æ€§èƒ½åŸºå‡†

### 1. å¹¶å‘æ€§èƒ½
- **æ‰“å¡å¹¶å‘**: æ”¯æŒ10,000+ç”¨æˆ·åŒæ—¶æ‰“å¡
- **æŸ¥è¯¢å¹¶å‘**: æ”¯æŒ1,000+å¹¶å‘æŸ¥è¯¢è¯·æ±‚
- **å†™å…¥æ€§èƒ½**: 5,000+ TPSæ’å…¥æ€§èƒ½
- **ç´¢å¼•ä¼˜åŒ–**: æŸ¥è¯¢å“åº”æ—¶é—´ < 50ms

### 2. å­˜å‚¨æ€§èƒ½
- **æ•°æ®å¢é•¿**: æ¯æ—¥çº¦50,000æ¡è®°å½•
- **å­˜å‚¨éœ€æ±‚**: 1å¹´çº¦18GBå­˜å‚¨ç©ºé—´
- **å¤‡ä»½æ•ˆç‡**: å…¨é‡å¤‡ä»½ < 30åˆ†é’Ÿ
- **æ¢å¤æ•ˆç‡**: å®Œå…¨æ¢å¤ < 1å°æ—¶

### 3. å¯ç”¨æ€§æŒ‡æ ‡
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.9%
- **æ•°æ®ä¸€è‡´æ€§**: å¼ºä¸€è‡´æ€§ä¿è¯
- **æ•…éšœæ¢å¤æ—¶é—´**: RTO < 1å°æ—¶ï¼ŒRPO < 15åˆ†é’Ÿ

---

## ğŸ“š æ‰©å±•è®¾è®¡

### 1. æ°´å¹³æ‰©å±•
- **è¯»å†™åˆ†ç¦»**: ä¸»åº“å†™å…¥ï¼Œä»åº“æŸ¥è¯¢
- **åˆ†åº“åˆ†è¡¨**: æŒ‰æ—¶é—´èŒƒå›´æˆ–ç”¨æˆ·IDåˆ†ç‰‡
- **ç¼“å­˜ä¼˜åŒ–**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
- **è¿æ¥æ± **: HikariCPè¿æ¥æ± ä¼˜åŒ–

### 2. åŠŸèƒ½æ‰©å±•
- **å®æ—¶æµå¤„ç†**: Kafka + Flinkå®æ—¶å¤„ç†
- **æ•°æ®ä»“åº“**: ClickHouseåˆ†æå‹æ•°æ®åº“
- **æœºå™¨å­¦ä¹ **: è€ƒå‹¤é¢„æµ‹æ¨¡å‹è®­ç»ƒ
- **å¤šç§Ÿæˆ·**: æ”¯æŒå¤šä¼ä¸šæ•°æ®éš”ç¦»

---

**ğŸ’¡ æ•°æ®åº“è®¾è®¡éµå¾ªé¡¹ç›®è§„èŒƒï¼Œç¡®ä¿é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å®‰å…¨æ€§ï¼Œä¸ºè€ƒå‹¤ç³»ç»Ÿæä¾›ç¨³å®šå¯é çš„æ•°æ®æ”¯æ’‘ã€‚**