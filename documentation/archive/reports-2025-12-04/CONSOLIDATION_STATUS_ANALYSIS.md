# æœåŠ¡æ•´åˆç°çŠ¶åˆ†ææŠ¥å‘Š

> **ğŸ“‹ åˆ†ææ—¥æœŸ**: 2025-12-02  
> **ğŸ“‹ åˆ†æç›®çš„**: äº†è§£å½“å‰æœåŠ¡æ•´åˆè¿›åº¦  
> **ğŸ“‹ åˆ†æç»“æœ**: éƒ¨åˆ†æœåŠ¡å·²æ ‡è®°åºŸå¼ƒï¼Œä½†æœªå®Œæˆå®é™…æ•´åˆ

---

## ğŸ” å½“å‰æ•´åˆçŠ¶æ€

### å·²æ ‡è®°ä¸ºDEPRECATEDçš„æœåŠ¡

é€šè¿‡æ‰«æå‘ç°ä»¥ä¸‹æœåŠ¡å·²æ ‡è®°ä¸ºåºŸå¼ƒï¼š

1. âœ… `ioedream-auth-service` - å·²æ ‡è®°DEPRECATED
2. âœ… `ioedream-identity-service` - å·²æ ‡è®°DEPRECATED
3. âœ… `ioedream-audit-service` - å·²æ ‡è®°DEPRECATED
4. âœ… `ioedream-config-service` - å·²æ ‡è®°DEPRECATED
5. âœ… `ioedream-device-service` - å·²æ ‡è®°DEPRECATED
6. âœ… `ioedream-infrastructure-service` - å·²æ ‡è®°DEPRECATED
7. âœ… `analytics` - å·²æ ‡è®°DEPRECATED

**æ ‡è®°çŠ¶æ€**: 7ä¸ªæœåŠ¡å·²æ ‡è®°åºŸå¼ƒ

### å®é™…æ•´åˆçŠ¶æ€

**common-serviceç°çŠ¶**:
- âœ… å·²æœ‰åŸºç¡€åŒ…ç»“æ„
- âœ… å·²æœ‰éƒ¨åˆ†åŠŸèƒ½ï¼ˆauthã€notificationã€rbacç­‰ï¼‰
- âš ï¸ ä½†åŠŸèƒ½ä¸å®Œæ•´ï¼Œéœ€è¦è¡¥å……

**device-comm-serviceç°çŠ¶**:
- âœ… å·²åˆ›å»ºåŸºç¡€ç»“æ„
- âš ï¸ åŠŸèƒ½è¾ƒå°‘ï¼Œéœ€è¦æ•´åˆdevice-service

**oa-serviceç°çŠ¶**:
- âœ… å·²åˆ›å»ºåŸºç¡€ç»“æ„
- âš ï¸ åŠŸèƒ½è¾ƒå°‘ï¼Œéœ€è¦æ•´åˆenterpriseå’Œinfrastructure

---

## ğŸ“Š æ•´åˆè¿›åº¦è¯„ä¼°

### æ•´åˆå®Œæˆåº¦

| ç›®æ ‡æœåŠ¡ | åº”æ•´åˆæœåŠ¡æ•° | å·²æ ‡è®°åºŸå¼ƒ | å®é™…æ•´åˆ | å®Œæˆåº¦ |
|---------|------------|-----------|---------|--------|
| **common-service** | 7ä¸ª | 4ä¸ª | 30% | 30% |
| **device-comm-service** | 1ä¸ª | 1ä¸ª | 10% | 10% |
| **oa-service** | 2ä¸ª | 1ä¸ª | 10% | 10% |
| **æ€»ä½“** | **10ä¸ª** | **6ä¸ª** | **20%** | **20%** |

### å…³é”®å‘ç°

1. **æ ‡è®°â‰ æ•´åˆ**: æœåŠ¡å·²æ ‡è®°åºŸå¼ƒï¼Œä½†ä»£ç æœªå®é™…è¿ç§»
2. **åŠŸèƒ½åˆ†æ•£**: åŠŸèƒ½ä»åˆ†æ•£åœ¨22ä¸ªæœåŠ¡ä¸­
3. **é…ç½®å†—ä½™**: 66ä¸ªé…ç½®æ–‡ä»¶ä»ç„¶å­˜åœ¨
4. **æ¶æ„æ··ä¹±**: æœåŠ¡è¾¹ç•Œä¸æ¸…æ™°

---

## ğŸ¯ æ•´åˆç­–ç•¥

### ç­–ç•¥Aï¼šå®Œå…¨é‡æ–°æ•´åˆï¼ˆæ¨èï¼‰â­

**æ–¹æ¡ˆ**: å¿½ç•¥ç°æœ‰çš„éƒ¨åˆ†æ•´åˆï¼Œä»é›¶å¼€å§‹è§„èŒƒæ•´åˆ

**ä¼˜ç‚¹**:
- âœ… æ¶æ„æ¸…æ™°ï¼Œç¬¦åˆCLAUDE.mdè§„èŒƒ
- âœ… é¿å…å†å²é—ç•™é—®é¢˜
- âœ… ä»£ç ç»“æ„ç»Ÿä¸€

**æ‰§è¡Œæ­¥éª¤**:
1. åˆ†æauth-serviceã€identity-serviceç­‰7ä¸ªæœåŠ¡
2. åœ¨common-serviceä¸­åˆ›å»ºæ ‡å‡†åŒ…ç»“æ„
3. æŒ‰æ¨¡å—è¿ç§»ä»£ç 
4. ç»Ÿä¸€é…ç½®å’Œä¾èµ–
5. æµ‹è¯•éªŒè¯

### ç­–ç•¥Bï¼šå¢é‡æ•´åˆï¼ˆä¿å®ˆï¼‰

**æ–¹æ¡ˆ**: åŸºäºç°æœ‰common-serviceï¼Œè¡¥å……ç¼ºå¤±åŠŸèƒ½

**ä¼˜ç‚¹**:
- âœ… ä¿ç•™å·²æœ‰å·¥ä½œ
- âœ… é£é™©è¾ƒä½

**ç¼ºç‚¹**:
- âš ï¸ å¯èƒ½å­˜åœ¨æ¶æ„ä¸ä¸€è‡´
- âš ï¸ éœ€è¦é‡æ„ç°æœ‰ä»£ç 

---

## ğŸ“‹ ç«‹å³æ‰§è¡Œè®¡åˆ’

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ ‡å‡†åŒ…ç»“æ„

**åœ¨common-serviceä¸­åˆ›å»ºå®Œæ•´çš„æ¨¡å—ç»“æ„**:

```
microservices/ioedream-common-service/src/main/java/net/lab1024/sa/common/
â”œâ”€â”€ auth/                    # è®¤è¯æ¨¡å—ï¼ˆæ¥è‡ªauth-serviceï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ AuthController.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ AuthService.java
â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚       â””â”€â”€ AuthServiceImpl.java
â”‚   â”œâ”€â”€ manager/
â”‚   â”‚   â””â”€â”€ AuthManager.java
â”‚   â”œâ”€â”€ dao/
â”‚   â”‚   â””â”€â”€ UserSessionDao.java
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â””â”€â”€ vo/
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ JwtTokenUtil.java
â”‚
â”œâ”€â”€ identity/                # èº«ä»½æ¨¡å—ï¼ˆæ¥è‡ªidentity-serviceï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ UserController.java
â”‚   â”‚   â”œâ”€â”€ RoleController.java
â”‚   â”‚   â””â”€â”€ PermissionController.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ UserService.java
â”‚   â”‚   â”œâ”€â”€ RoleService.java
â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”œâ”€â”€ manager/
â”‚   â”‚   â””â”€â”€ UserManager.java
â”‚   â”œâ”€â”€ dao/
â”‚   â”‚   â”œâ”€â”€ UserDao.java
â”‚   â”‚   â”œâ”€â”€ RoleDao.java
â”‚   â”‚   â””â”€â”€ PermissionDao.java
â”‚   â””â”€â”€ domain/
â”‚
â”œâ”€â”€ notification/            # é€šçŸ¥æ¨¡å—ï¼ˆæ¥è‡ªnotification-serviceï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ manager/
â”‚   â””â”€â”€ dao/
â”‚
â”œâ”€â”€ audit/                   # å®¡è®¡æ¨¡å—ï¼ˆæ¥è‡ªaudit-serviceï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ manager/
â”‚   â””â”€â”€ dao/
â”‚
â”œâ”€â”€ monitor/                 # ç›‘æ§æ¨¡å—ï¼ˆæ¥è‡ªmonitor-serviceï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ manager/
â”‚   â””â”€â”€ dao/
â”‚
â”œâ”€â”€ scheduler/               # è°ƒåº¦æ¨¡å—ï¼ˆæ¥è‡ªscheduler-serviceï¼‰
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ manager/
â”‚   â””â”€â”€ dao/
â”‚
â””â”€â”€ system/                  # ç³»ç»Ÿæ¨¡å—ï¼ˆæ¥è‡ªsystem-serviceï¼‰
    â”œâ”€â”€ controller/
    â”œâ”€â”€ service/
    â”œâ”€â”€ manager/
    â””â”€â”€ dao/
```

### ç¬¬äºŒæ­¥ï¼šè¿ç§»authæ¨¡å—

**ä»auth-serviceè¿ç§»åˆ°common-service/auth**

**è¿ç§»æ¸…å•**:
- Controller: AuthController.java
- Service: AuthService.java, AuthServiceImpl.java, LoginService.java
- Domain: LoginRequest, LoginResponse, UserSessionEntity
- Util: JwtTokenUtil.java

**åŒ…åæ›´æ–°**:
```java
// åŸåŒ…å
package net.lab1024.sa.auth.controller;

// æ–°åŒ…å
package net.lab1024.sa.common.auth.controller;
```

### ç¬¬ä¸‰æ­¥ï¼šè¿ç§»identityæ¨¡å—

**ä»identity-serviceè¿ç§»åˆ°common-service/identity**

**è¿ç§»æ¸…å•**:
- Controller: UserController, RoleController, PermissionController
- Service: UserService, RoleService, PermissionService
- Dao: UserMapper â†’ UserDao
- Domain: Userç›¸å…³å®ä½“å’ŒVO

**åŒ…åæ›´æ–°**:
```java
// åŸåŒ…å
package net.lab1024.sa.identity.controller;

// æ–°åŒ…å
package net.lab1024.sa.common.identity.controller;
```

---

## âš ï¸ å…³é”®é—®é¢˜å‘ç°

### é—®é¢˜1: auth-serviceä½¿ç”¨JPAï¼ˆè¿è§„ï¼‰

**å‘ç°**:
```xml
<!-- auth-service/pom.xml -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>  <!-- è¿è§„ï¼ -->
</dependency>
```

**CLAUDE.mdè§„èŒƒ**: å¿…é¡»ä½¿ç”¨MyBatis-Plusï¼Œç¦æ­¢JPA

**è§£å†³æ–¹æ¡ˆ**: æ•´åˆæ—¶è½¬æ¢ä¸ºMyBatis-Plus

### é—®é¢˜2: identity-serviceä½¿ç”¨HikariCPï¼ˆè¿è§„ï¼‰

**å‘ç°**:
```yaml
# identity-service/application.yml
datasource:
  hikari:  # è¿è§„ï¼åº”è¯¥ä½¿ç”¨Druid
    maximum-pool-size: 20
```

**CLAUDE.mdè§„èŒƒ**: å¿…é¡»ä½¿ç”¨Druidè¿æ¥æ± 

**è§£å†³æ–¹æ¡ˆ**: æ•´åˆæ—¶ç»Ÿä¸€ä½¿ç”¨Druid

### é—®é¢˜3: identity-serviceæœ‰Repositoryå‘½åï¼ˆè¿è§„ï¼‰

**å‘ç°**: identity-service/.serena/memories/æåˆ°DAOâ†’Repositoryé‡æ„

**CLAUDE.mdè§„èŒƒ**: å¿…é¡»ä½¿ç”¨Daoå‘½åï¼Œç¦æ­¢Repository

**è§£å†³æ–¹æ¡ˆ**: æ•´åˆæ—¶ç»Ÿä¸€ä¸ºDaoå‘½å

---

## ğŸš€ ç«‹å³æ‰§è¡Œçš„æ•´åˆä»»åŠ¡

### ä»»åŠ¡1: åˆ›å»ºcommon-serviceæ ‡å‡†åŒ…ç»“æ„

**ç«‹å³æ‰§è¡Œ**:
```bash
# åˆ›å»ºauthæ¨¡å—ç›®å½•
mkdir -p microservices/ioedream-common-service/src/main/java/net/lab1024/sa/common/auth/{controller,service/impl,manager,dao,domain/{entity,dto,vo},util}

# åˆ›å»ºidentityæ¨¡å—ç›®å½•
mkdir -p microservices/ioedream-common-service/src/main/java/net/lab1024/sa/common/identity/{controller,service/impl,manager,dao,domain/{entity,dto,vo}}

# åˆ›å»ºå…¶ä»–æ¨¡å—ç›®å½•
mkdir -p microservices/ioedream-common-service/src/main/java/net/lab1024/sa/common/{notification,audit,monitor,scheduler,system}/{controller,service/impl,manager,dao}
```

### ä»»åŠ¡2: è¿ç§»auth-serviceæ ¸å¿ƒä»£ç 

**è¿ç§»æ–‡ä»¶**:
1. AuthController.java â†’ common/auth/controller/
2. AuthService.java â†’ common/auth/service/
3. AuthServiceImpl.java â†’ common/auth/service/impl/
4. JwtTokenUtil.java â†’ common/auth/util/
5. æ‰€æœ‰domainç±» â†’ common/auth/domain/

### ä»»åŠ¡3: æ›´æ–°åŒ…åå’Œimport

**æ‰¹é‡æ›¿æ¢åŒ…å**:
```java
// åœ¨è¿ç§»çš„æ–‡ä»¶ä¸­æ‰¹é‡æ›¿æ¢
net.lab1024.sa.auth â†’ net.lab1024.sa.common.auth
```

---

## âœ… é¢„æœŸæˆæœ

### æ•´åˆå®Œæˆåçš„common-service

**åŒ…ç»“æ„**:
- 7ä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆauth, identity, notification, audit, monitor, scheduler, systemï¼‰
- ç»Ÿä¸€çš„å››å±‚æ¶æ„ï¼ˆController â†’ Service â†’ Manager â†’ DAOï¼‰
- ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶
- ç»Ÿä¸€çš„ä¾èµ–ç®¡ç†

**é…ç½®ç»Ÿä¸€**:
- 1ä¸ªapplication.ymlï¼ˆæ›¿ä»£7ä¸ªæœåŠ¡çš„é…ç½®ï¼‰
- ç»Ÿä¸€çš„ç«¯å£ï¼š8088
- ç»Ÿä¸€çš„Nacosé…ç½®
- ç»Ÿä¸€çš„æ•°æ®åº“é…ç½®

**æŠ€æœ¯æ ˆç»Ÿä¸€**:
- âœ… 100% MyBatis-Plusï¼ˆç§»é™¤JPAï¼‰
- âœ… 100% Druidè¿æ¥æ± ï¼ˆç§»é™¤HikariCPï¼‰
- âœ… 100% @Mapperæ³¨è§£ï¼ˆç§»é™¤@Repositoryï¼‰
- âœ… 100% @Resourceæ³¨å…¥ï¼ˆç§»é™¤@Autowiredï¼‰

---

**ğŸ‘¥ æ‰§è¡Œå›¢é˜Ÿ**: IOE-DREAM å¼€å‘å›¢é˜Ÿ  
**ğŸ“… å¼€å§‹æ—¥æœŸ**: 2025-12-02  
**â° é¢„è®¡å®Œæˆ**: 2025-12-09ï¼ˆ1å‘¨ï¼‰  
**âœ… æ‰§è¡ŒçŠ¶æ€**: ç«‹å³å¼€å§‹

