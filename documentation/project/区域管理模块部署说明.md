# 区域管理模块部署说明

## 概述
区域管理模块已成功实现并集成到SmartAdmin系统的"系统设置"模块下,提供完整的区域层级管理、树形展示、设备绑定和人员授权功能。

## 实现内容

### 1. 数据库设计 ✅
已创建以下数据库表:
- `t_area` - 区域主表
- `t_area_device` - 区域设备关联表
- `t_area_user` - 区域人员关联表
- `t_area_config` - 区域配置表

**SQL脚本位置**: `数据库SQL脚本/mysql/smart_area.sql`

### 2. 后端实现 ✅
已完成四层架构实现:

#### Entity实体层
- `AreaEntity` - 区域实体
- `AreaDeviceEntity` - 区域设备关联实体
- `AreaUserEntity` - 区域人员关联实体
- `AreaConfigEntity` - 区域配置实体

#### Form表单层
- `AreaAddForm` - 新增区域表单
- `AreaUpdateForm` - 更新区域表单
- `AreaQueryForm` - 查询区域表单

#### VO视图层
- `AreaVO` - 区域视图对象
- `AreaTreeVO` - 区域树形视图对象

#### DAO数据访问层
- `AreaDao` - 区域数据访问接口
- `AreaMapper.xml` - MyBatis映射文件

#### Manager管理层
- `AreaManager` - 区域业务管理类(处理缓存、树形结构等复杂逻辑)

#### Service服务层
- `AreaService` - 区域服务类(处理业务逻辑和事务)

#### Controller控制层
- `AreaController` - 区域控制器(提供RESTful API)

### 3. 前端实现 ✅
已完成Vue 3页面组件:

#### API接口
- `area-api.js` - 区域管理API封装

#### 页面组件
- `index.vue` - 区域管理主页面(树形列表)
- `area-modal.vue` - 区域编辑弹窗组件

### 4. 菜单和权限 ✅
已在SQL脚本中配置:
- 菜单: 系统设置 > 区域管理
- 权限:
  - `area:page` - 分页查询
  - `area:tree` - 查看区域树
  - `area:detail` - 查看详情
  - `area:add` - 新增区域
  - `area:update` - 更新区域
  - `area:delete` - 删除区域
  - `area:device:bind` - 绑定设备
  - `area:device:unbind` - 解绑设备
  - `area:user:grant` - 授予权限
  - `area:user:revoke` - 撤销权限
  - `area:config:view` - 查看配置
  - `area:config:update` - 更新配置

## 部署步骤

### 步骤1: 执行数据库脚本

**重要提示**：如果之前已经执行过 `smart_area.sql` 脚本但菜单未显示，请执行修复脚本：

```bash
# 方式1: 使用MySQL命令行
mysql -h 192.168.10.110 -P 33060 -u root smart_admin_v3 < "G:\111建湖项目文件\IOE-DREAM\数据库SQL脚本\mysql\fix_area_menu.sql"

# 方式2: 使用Navicat等工具
# 直接打开并执行 fix_area_menu.sql 文件
```

如果是首次部署，执行完整脚本：
```bash
# 进入MySQL数据库
mysql -h 192.168.10.110 -P 33060 -u root -p smart_admin_v3

# 执行SQL脚本
source G:\111建湖项目文件\IOE-DREAM\数据库SQL脚本\mysql\smart_area.sql
```

或使用Navicat等工具直接执行SQL脚本。

### 步骤2: 重启后端服务
```bash
cd smart-admin-api-java17-springboot3/sa-admin
mvn clean spring-boot:run
```

### 步骤3: 重启前端服务
```bash
cd smart-admin-web-javascript
npm run localhost
```

### 步骤4: 访问系统
1. 打开浏览器访问: http://localhost:8081
2. 登录系统
3. 进入 系统设置 > 区域管理

## 功能说明

### 核心功能
1. **区域树形管理**
   - 支持无限层级的区域树
   - 拖拽排序
   - 树形展示和折叠

2. **区域CRUD操作**
   - 新增区域
   - 编辑区域
   - 删除区域(软删除)
   - 查询区域

3. **区域类型**
   - 园区(CAMPUS)
   - 楼栋(BUILDING)
   - 楼层(FLOOR)
   - 房间(ROOM)
   - 室外(OUTDOOR)
   - 停车场(PARKING)
   - 出入口(ENTRANCE)

4. **扩展功能**(待开发)
   - 区域设备绑定/解绑
   - 区域人员授权/撤销
   - 区域配置管理

### API接口清单
| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 分页查询 | POST | /api/system/area/page | 分页查询区域列表 |
| 区域树 | GET | /api/system/area/tree | 获取区域树形结构 |
| 区域详情 | GET | /api/system/area/detail/{id} | 获取区域详细信息 |
| 新增区域 | POST | /api/system/area/add | 新增区域 |
| 更新区域 | POST | /api/system/area/update | 更新区域信息 |
| 删除区域 | POST | /api/system/area/delete/{id} | 删除区域 |
| 批量删除 | POST | /api/system/area/batchDelete | 批量删除区域 |

## 技术规范遵循

### 后端规范 ✅
- ✅ 严格遵循四层架构: Controller → Service → Manager → DAO
- ✅ 使用 @Resource 进行依赖注入
- ✅ 使用 @SaCheckPermission 进行权限控制
- ✅ 使用 @Transactional 进行事务管理
- ✅ 使用 ResponseDTO 统一响应格式
- ✅ 使用 @Valid 进行参数验证
- ✅ 软删除机制(deleted_flag)
- ✅ 乐观锁机制(version)
- ✅ 审计字段(create_time, update_time, create_user_id, update_user_id)

### 前端规范 ✅
- ✅ 使用 Vue 3 Composition API
- ✅ 使用 Ant Design Vue 4.x 组件库
- ✅ 使用 v-privilege 指令进行权限控制
- ✅ 统一的API封装
- ✅ 规范的错误处理
- ✅ 响应式设计

### 数据库规范 ✅
- ✅ 表名: t_{business}_{entity}
- ✅ 主键: {table}_id (BIGINT AUTO_INCREMENT)
- ✅ 字符集: utf8mb4_0900_ai_ci
- ✅ 存储引擎: InnoDB
- ✅ 审计字段完整
- ✅ 软删除标志
- ✅ 乐观锁版本号
- ✅ JSON字段支持

## 目录结构

### 后端目录
```
smart-admin-api-java17-springboot3/
└── sa-admin/
    └── src/main/java/net/lab1024/sa/admin/module/system/area/
        ├── controller/
        │   └── AreaController.java
        ├── service/
        │   └── AreaService.java
        ├── manager/
        │   └── AreaManager.java
        ├── dao/
        │   └── AreaDao.java
        └── domain/
            ├── entity/
            │   ├── AreaEntity.java
            │   ├── AreaDeviceEntity.java
            │   ├── AreaUserEntity.java
            │   └── AreaConfigEntity.java
            ├── form/
            │   ├── AreaAddForm.java
            │   ├── AreaUpdateForm.java
            │   └── AreaQueryForm.java
            └── vo/
                ├── AreaVO.java
                └── AreaTreeVO.java
```

### 前端目录
```
smart-admin-web-javascript/
└── src/
    ├── api/system/
    │   └── area-api.js
    └── views/system/area/
        ├── index.vue
        └── area-modal.vue
```

### 数据库脚本
```
数据库SQL脚本/
└── mysql/
    └── smart_area.sql
```

## 注意事项

1. **数据库连接配置**
   - 确认数据库连接信息正确: 192.168.10.110:33060
   - 数据库名称: smart_admin_v3
   - 用户名: root
   - 密码: (空密码)

2. **权限配置**
   - 执行SQL脚本后,需要为角色分配相应的菜单和权限
   - 管理员默认拥有所有权限

3. **依赖项**
   - 后端依赖: MyBatis-Plus, Sa-Token, Spring Boot 3
   - 前端依赖: Vue 3, Ant Design Vue 4.x

4. **性能优化**
   - 区域树查询已优化,支持缓存
   - 使用递归CTE查询子区域,性能优良
   - 建议区域层级不超过5层

5. **扩展开发**
   - 区域设备关联功能需要结合具体的设备管理模块开发
   - 区域人员关联功能需要结合员工管理模块开发
   - 区域配置功能可根据实际业务需求扩展

## 测试建议

### 功能测试
1. 测试新增根区域
2. 测试新增子区域
3. 测试编辑区域信息
4. 测试删除区域(无子区域)
5. 测试删除区域(有子区域,应失败)
6. 测试区域树形展示
7. 测试区域查询和筛选

### 权限测试
1. 测试无权限用户访问
2. 测试只有查看权限的用户
3. 测试只有新增权限的用户
4. 测试只有编辑权限的用户
5. 测试只有删除权限的用户

## 常见问题

### Q1: 前端页面没有"区域管理"菜单?
A: 这是component路径配置问题。请执行修复脚本 `fix_area_menu.sql`，该脚本会：
   - 删除旧的错误菜单数据
   - 重新插入正确的菜单配置（component路径为 `system/area/index.vue`，不包含 `views/` 前缀）
   - 重新登录系统后菜单即可显示

**技术说明**：前端路由处理会自动在component路径前添加 `../views/`，所以数据库中不应包含 `views/` 前缀。

### Q2: 执行SQL脚本报错?
A: 检查数据库连接信息是否正确,确保数据库版本为MySQL 8.0+

### Q3: 前端页面无法访问?
A: 检查菜单权限是否已分配,确认用户角色拥有相应权限

### Q4: API接口调用失败?
A: 检查后端服务是否正常启动,查看控制台日志

### Q5: 区域树不显示?
A: 检查是否有区域数据,尝试刷新页面

## 联系支持
如有问题,请查阅项目文档或联系开发团队。

---
**部署完成时间**: 2025-01-10
**版本**: v1.0.0
**状态**: ✅ 已完成
