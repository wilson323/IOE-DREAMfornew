# IOE-DREAM 代码审查指南

**版本**: v1.0.0  
**生效日期**: 2025-01-30  
**适用范围**: 所有Pull Request代码审查

---

## 代码审查原则

### 核心原则

1. **架构合规性优先**: 确保新代码符合项目架构规范
2. **代码质量保障**: 保证代码质量和可维护性
3. **知识共享**: 通过审查促进团队知识传递
4. **建设性反馈**: 提供建设性的改进建议

---

## 代码审查检查清单

### 架构合规性检查（强制）

#### 注解使用规范
- [ ] 使用 `@Resource` 而非 `@Autowired`
- [ ] 使用 `@Mapper` 而非 `@Repository`
- [ ] DAO接口使用 `Dao` 后缀

#### 包名规范
- [ ] 使用 `jakarta.*` 包名（而非 `javax.*`）
- [ ] 允许的 `javax.*` 包：`javax.crypto.*`、`javax.sql.*`、`javax.imageio.*`、`javax.net.ssl.*`

#### 依赖注入
- [ ] 统一使用 `@Resource` 注解
- [ ] Manager类不使用Spring注解（构造函数注入）

#### 四层架构
- [ ] Controller → Service → Manager → DAO 层次清晰
- [ ] 无跨层访问
- [ ] 无循环依赖

---

### 代码质量检查

#### 代码格式
- [ ] 符合 `.editorconfig` 配置
- [ ] 符合 `checkstyle.xml` 规范
- [ ] 无格式压缩（单行代码）

#### 代码规范
- [ ] 类命名规范（Entity、Dao、Service、Manager、Controller）
- [ ] 方法命名规范（add、delete、update、get、list、page）
- [ ] 包结构规范（无重复包名）

#### 实体类规范
- [ ] Entity行数 ≤400行
- [ ] 字段数 ≤30个
- [ ] 无业务逻辑方法
- [ ] 完整的审计字段

#### 异常处理
- [ ] 使用统一的 `GlobalExceptionHandler`
- [ ] 业务异常使用 `BusinessException`
- [ ] 异常信息清晰明确

#### 日志记录
- [ ] 使用 `@Slf4j` 注解
- [ ] 关键操作有日志记录
- [ ] 日志级别使用合理（ERROR/WARN/INFO/DEBUG）

---

### 测试覆盖率检查

- [ ] Service层测试覆盖率 ≥80%
- [ ] Manager层测试覆盖率 ≥75%
- [ ] DAO层测试覆盖率 ≥70%
- [ ] Controller层测试覆盖率 ≥60%

---

### 安全性检查

- [ ] 无明文密码配置
- [ ] 敏感数据加密存储
- [ ] 接口权限校验完整
- [ ] 参数验证完整（@Valid）

---

### 性能检查

- [ ] 数据库查询有合适索引
- [ ] 避免深度分页
- [ ] 合理使用缓存
- [ ] 无N+1查询问题

---

## 审查流程

### 1. 提交PR前检查

开发者应自行检查：
- [ ] 运行架构合规性检查脚本
- [ ] 运行单元测试并确保通过
- [ ] 检查代码格式
- [ ] 更新相关文档

### 2. PR提交

PR应包含：
- 清晰的PR描述
- 关联的Issue（如有）
- 修改范围说明
- 测试说明

### 3. 自动检查

CI/CD自动执行：
- [ ] 架构合规性检查
- [ ] 代码质量扫描（SonarQube）
- [ ] 测试覆盖率检查
- [ ] 代码格式检查

### 4. 人工审查

审查者检查：
- [ ] 业务逻辑正确性
- [ ] 代码设计合理性
- [ ] 性能优化建议
- [ ] 安全性检查

### 5. 审查反馈

审查者应：
- 明确指出问题位置（文件:行号）
- 说明问题原因
- 提供修复建议
- 标记阻塞性问题（必须修复）

### 6. 修复和重新审查

开发者：
- 修复所有阻塞性问题
- 响应审查反馈
- 更新PR说明

---

## PR模板

```markdown
## 变更描述

简要描述本次变更的目的和范围。

## 变更类型

- [ ] 新功能 (feat)
- [ ] 修复 (fix)
- [ ] 文档更新 (docs)
- [ ] 代码重构 (refactor)
- [ ] 性能优化 (perf)
- [ ] 测试相关 (test)
- [ ] 构建/工具 (chore)

## 架构合规性检查

- [ ] 已运行 `.\scripts\architecture-compliance-check.ps1`
- [ ] 无架构违规
- [ ] 已修复所有违规项

## 测试说明

- [ ] 已添加单元测试
- [ ] 测试覆盖率符合要求
- [ ] 所有测试通过

## 检查清单

- [ ] 代码符合 `.editorconfig` 配置
- [ ] 无硬编码配置值
- [ ] 日志记录完善
- [ ] 异常处理完善
- [ ] 无安全风险

## 相关Issue

关联的Issue编号（如有）

## 截图/示例

（如有UI变更或功能演示）
```

---

## 审查反馈格式

### 阻塞性问题（必须修复）

```
❌ [阻塞] 文件路径:行号
问题描述: ...
修复建议: ...
```

### 建议性问题（可选修复）

```
⚠️ [建议] 文件路径:行号
问题描述: ...
修复建议: ...
```

### 表扬

```
✅ [表扬] 文件路径:行号
说明: ...
```

---

## 审查通过标准

PR必须满足以下条件才能合并：

1. ✅ 架构合规性检查通过（无违规）
2. ✅ 所有自动化测试通过
3. ✅ 代码审查通过（至少1人批准）
4. ✅ 无阻塞性问题
5. ✅ 代码符合格式规范

---

**审查责任人**: IOE-DREAM 架构委员会 + 模块负责人

