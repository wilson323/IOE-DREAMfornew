# è®¿å®¢ç®¡ç†å¾®æœåŠ¡ - æ€»ä½“è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.1.0 - æ··åˆéªŒè¯æ¨¡å¼  
> **å¾®æœåŠ¡**: ioedream-visitor-service (8095)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17  
> **è®¾å¤‡äº¤äº’æ¨¡å¼**: æ··åˆéªŒè¯æ¨¡å¼ï¼ˆMode 4ï¼‰

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

è®¿å®¢ç®¡ç†å¾®æœåŠ¡è´Ÿè´£ä¼ä¸šè®¿å®¢çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬è®¿å®¢é¢„çº¦ã€ç™»è®°ã€èº«ä»½éªŒè¯ã€æƒé™æ§åˆ¶ã€é€šè¡Œè®°å½•å’Œç»Ÿè®¡åˆ†æã€‚

æœ¬æ–‡æ¡£æ˜¯IOE-DREAMæ™ºæ…§è®¿å®¢ç®¡ç†å¾®æœåŠ¡çš„æ€»ä½“è®¾è®¡æ–‡æ¡£ï¼ŒåŸºäº**æ··åˆéªŒè¯æ¨¡å¼**è®¾è®¡ï¼Œç¡®ä¿è®¿å®¢å¾®æœåŠ¡ä¸‹æ¯ä¸ªå­æ¨¡å—çš„å®Œæ•´æ€§ã€ç³»ç»Ÿæ€§å’Œä¸€è‡´æ€§ã€‚

---

## â­ æ··åˆéªŒè¯æ¨¡å¼ï¼ˆMode 4ï¼‰

### æ ¸å¿ƒç†å¿µ

è®¿å®¢ç³»ç»Ÿé‡‡ç”¨**æ··åˆéªŒè¯æ¨¡å¼**ï¼Œä¸´æ—¶è®¿å®¢ä¸­å¿ƒå®æ—¶éªŒè¯ï¼Œå¸¸å®¢è¾¹ç¼˜éªŒè¯ã€‚

### è®¾å¤‡äº¤äº’æµç¨‹

```
ã€ä¸´æ—¶è®¿å®¢ã€‘ä¸­å¿ƒå®æ—¶éªŒè¯
  é¢„çº¦ç”³è¯· â†’ å®¡æ‰¹é€šè¿‡ â†’ ç”Ÿæˆè®¿å®¢ç 
  åˆ°è®¿æ—¶æ‰«ç  â†’ æœåŠ¡å™¨éªŒè¯ â†’ ç°åœºé‡‡é›†äººè„¸
  æœåŠ¡å™¨ç”Ÿæˆä¸´æ—¶æ¨¡æ¿ â†’ ä¸‹å‘è®¾å¤‡ â†’ è®¾ç½®æœ‰æ•ˆæœŸ
  è®¿å®¢é€šè¡Œ â†’ å®æ—¶ä¸ŠæŠ¥ â†’ æœåŠ¡å™¨è®°å½•è½¨è¿¹
  è®¿é—®ç»“æŸ â†’ è‡ªåŠ¨å¤±æ•ˆ â†’ ä»è®¾å¤‡åˆ é™¤æ¨¡æ¿

ã€å¸¸å®¢ã€‘è¾¹ç¼˜éªŒè¯
  é•¿æœŸåˆä½œä¼™ä¼´ â†’ ç”³è¯·å¸¸å®¢æƒé™ â†’ å®¡æ‰¹é€šè¿‡
  é‡‡é›†ç”Ÿç‰©ç‰¹å¾ â†’ ä¸‹å‘æ‰€æœ‰æˆæƒè®¾å¤‡
  æ—¥å¸¸é€šè¡Œ â†’ è®¾å¤‡ç«¯éªŒè¯ â†’ æ‰¹é‡ä¸Šä¼ è®°å½•
  æƒé™åˆ°æœŸ â†’ è‡ªåŠ¨å¤±æ•ˆ â†’ ä»è®¾å¤‡åˆ é™¤
```

### æŠ€æœ¯ä¼˜åŠ¿

- âœ… **çµæ´»æ§åˆ¶**: æ ¹æ®å®‰å…¨ç­‰çº§é€‰æ‹©éªŒè¯æ¨¡å¼
- âœ… **æ•ˆç‡å¹³è¡¡**: å¸¸å®¢å¿«é€Ÿé€šè¡Œï¼Œä¸´æ—¶è®¿å®¢ä¸¥æ ¼éªŒè¯
- âœ… **è½¨è¿¹è¿½è¸ª**: è®¿å®¢å®Œæ•´è¡Œä¸ºè½¨è¿¹è®°å½•

### æ¶æ„è¦æ±‚

- âœ… ä¸´æ—¶è®¿å®¢å¿…é¡»ä¸­å¿ƒéªŒè¯
- âœ… å¸¸å®¢æ”¯æŒè¾¹ç¼˜éªŒè¯
- âœ… æ”¯æŒä¸´æ—¶æ¨¡æ¿è‡ªåŠ¨ä¸‹å‘å’Œå¤±æ•ˆ
- âœ… å®Œæ•´è®°å½•è®¿å®¢è½¨è¿¹

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph æ¥å…¥å±‚
        API[REST API]
        WS[WebSocket]
        MQ[RabbitMQ]
    end
    
    subgraph ä¸šåŠ¡å±‚
        INFO[è®¿å®¢ä¿¡æ¯]
        APPOINT[é¢„çº¦ç®¡ç†]
        REGISTER[ç™»è®°ç®¡ç†]
        AUTH[èº«ä»½éªŒè¯]
        PERM[æƒé™ç®¡ç†]
        RECORD[é€šè¡Œè®°å½•]
        STAT[ç»Ÿè®¡åˆ†æ]
    end
    
    subgraph æ•°æ®å±‚
        MySQL[(MySQL)]
        Redis[(Redis)]
    end
    
    API --> INFO
    API --> APPOINT
    API --> REGISTER
    WS --> AUTH
    MQ --> RECORD
    
    INFO --> MySQL
    APPOINT --> MySQL
    APPOINT --> Redis
```

---

## ğŸ“ ä»£ç ç»“æ„

```
ioedream-visitor-service/src/main/java/net/lab1024/sa/visitor/
â”œâ”€â”€ VisitorApplication.java                 # å¯åŠ¨ç±»
â”œâ”€â”€ controller/                             # Controllerå±‚
â”‚   â”œâ”€â”€ VisitorInfoController.java         # è®¿å®¢ä¿¡æ¯
â”‚   â”œâ”€â”€ AppointmentController.java         # é¢„çº¦ç®¡ç†
â”‚   â”œâ”€â”€ VisitorRegisterController.java     # ç™»è®°ç®¡ç†
â”‚   â”œâ”€â”€ VisitorAuthController.java         # èº«ä»½éªŒè¯
â”‚   â”œâ”€â”€ VisitorAccessController.java       # æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ VisitorRecordController.java       # é€šè¡Œè®°å½•
â”‚   â””â”€â”€ VisitorStatController.java         # ç»Ÿè®¡åˆ†æ
â”œâ”€â”€ service/                                # Serviceå±‚
â”‚   â”œâ”€â”€ VisitorInfoService.java
â”‚   â”œâ”€â”€ AppointmentService.java
â”‚   â”œâ”€â”€ VisitorRegisterService.java
â”‚   â”œâ”€â”€ VisitorAuthService.java
â”‚   â”œâ”€â”€ VisitorAccessService.java
â”‚   â”œâ”€â”€ VisitorRecordService.java
â”‚   â””â”€â”€ VisitorStatService.java
â”œâ”€â”€ dao/                                    # DAOå±‚
â”‚   â”œâ”€â”€ VisitorInfoDao.java
â”‚   â”œâ”€â”€ AppointmentDao.java
â”‚   â”œâ”€â”€ VisitorRegisterDao.java
â”‚   â””â”€â”€ VisitorRecordDao.java
â”œâ”€â”€ domain/                                 # é¢†åŸŸå¯¹è±¡
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/
â””â”€â”€ manager/                                # Managerå±‚
    â”œâ”€â”€ VisitorPermissionManager.java
    â””â”€â”€ VisitorStatisticsManager.java
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. è®¿å®¢ä¿¡æ¯ç®¡ç†
- è®¿å®¢åŸºæœ¬ä¿¡æ¯å½•å…¥
- è®¿å®¢ç±»å‹ç®¡ç†ï¼ˆæ™®é€šè®¿å®¢ã€VIPã€ä¾›åº”å•†ï¼‰
- è®¿å®¢é»‘åå•ç®¡ç†
- è®¿å®¢å†å²æŸ¥è¯¢

### 2. é¢„çº¦ç®¡ç†
- çº¿ä¸Šé¢„çº¦ç”³è¯·
- è¢«è®¿äººå®¡æ‰¹
- é¢„çº¦ç ç”Ÿæˆ
- é¢„çº¦é€šçŸ¥æ¨é€

### 3. ç™»è®°ç®¡ç†
- å‰å°ç™»è®°
- è‡ªåŠ©ç™»è®°
- è¯ä»¶è¯†åˆ«
- è®¿å®¢è¯å‘æ”¾

### 4. èº«ä»½éªŒè¯
- è¯ä»¶éªŒè¯
- äººè„¸è¯†åˆ«
- é¢„çº¦ç éªŒè¯
- äºŒç»´ç éªŒè¯

### 5. é€šè¡Œè®°å½•
- å…¥åœºè®°å½•
- ç¦»åœºè®°å½•
- æ»ç•™é¢„è­¦
- é€šè¡Œè½¨è¿¹

### 6. ç»Ÿè®¡åˆ†æ
- è®¿å®¢æµé‡ç»Ÿè®¡
- æ¥è®¿é¢‘æ¬¡åˆ†æ
- æ—¶æ®µåˆ†å¸ƒåˆ†æ
- åŒºåŸŸè®¿é—®åˆ†æ

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ |
|------|------|
| t_visitor_info | è®¿å®¢ä¿¡æ¯è¡¨ |
| t_visitor_appointment | é¢„çº¦è®°å½•è¡¨ |
| t_visitor_register | ç™»è®°è®°å½•è¡¨ |
| t_visitor_access_record | é€šè¡Œè®°å½•è¡¨ |
| t_visitor_permission | è®¿å®¢æƒé™è¡¨ |
| t_visitor_blacklist | è®¿å®¢é»‘åå•è¡¨ |

### ERå›¾

```mermaid
erDiagram
    t_visitor_info {
        bigint id PK
        varchar name
        varchar phone
        varchar id_card
        varchar company
        varchar visitor_type
        tinyint status
    }
    
    t_visitor_appointment {
        bigint id PK
        bigint visitor_id FK
        bigint host_id FK
        varchar appointment_code
        varchar visit_reason
        datetime visit_time
        datetime leave_time
        tinyint status
    }
    
    t_visitor_register {
        bigint id PK
        bigint appointment_id FK
        bigint visitor_id FK
        datetime register_time
        varchar register_type
        varchar visitor_card_no
        tinyint status
    }
    
    t_visitor_access_record {
        bigint id PK
        bigint visitor_id FK
        bigint device_id FK
        datetime access_time
        varchar direction
        varchar verify_type
    }
    
    t_visitor_info ||--o{ t_visitor_appointment : "é¢„çº¦"
    t_visitor_appointment ||--o| t_visitor_register : "ç™»è®°"
    t_visitor_info ||--o{ t_visitor_access_record : "é€šè¡Œ"
```

---

## ğŸ”§ APIæ¥å£è®¾è®¡

### é¢„çº¦ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/visitor/v1/appointment/apply | é¢„çº¦ç”³è¯· |
| GET | /api/visitor/v1/appointment/{code} | é¢„çº¦æŸ¥è¯¢ |
| PUT | /api/visitor/v1/appointment/approve | é¢„çº¦å®¡æ‰¹ |
| DELETE | /api/visitor/v1/appointment/{id} | å–æ¶ˆé¢„çº¦ |

### ç™»è®°ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/visitor/v1/register/checkin | è®¿å®¢ç™»è®° |
| POST | /api/visitor/v1/register/checkout | è®¿å®¢ç¦»å¼€ |
| GET | /api/visitor/v1/register/current | å½“å‰åœ¨è®¿ |

### èº«ä»½éªŒè¯

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/visitor/v1/auth/verify | èº«ä»½éªŒè¯ |
| POST | /api/visitor/v1/auth/face | äººè„¸éªŒè¯ |
| POST | /api/visitor/v1/auth/qrcode | äºŒç»´ç éªŒè¯ |

### ç»Ÿè®¡åˆ†æ

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/visitor/v1/stat/daily | æ—¥ç»Ÿè®¡ |
| GET | /api/visitor/v1/stat/monthly | æœˆç»Ÿè®¡ |
| GET | /api/visitor/v1/stat/distribution | åˆ†å¸ƒåˆ†æ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡é¡¹ | è¦æ±‚ |
|--------|------|
| é¢„çº¦æäº¤å“åº” | â‰¤ 1s |
| ç™»è®°å¤„ç†æ—¶é—´ | â‰¤ 3s |
| èº«ä»½éªŒè¯å»¶è¿Ÿ | â‰¤ 2s |
| äººè„¸è¯†åˆ«å»¶è¿Ÿ | â‰¤ 1s |
| å¹¶å‘é¢„çº¦æ”¯æŒ | â‰¥ 200æ¬¡/ç§’ |
| æ•°æ®ä¿å­˜å‘¨æœŸ | â‰¥ 2å¹´ |

---

## ğŸ” å®‰å…¨è¦æ±‚

- è®¿å®¢èº«ä»½ä¿¡æ¯è„±æ•å­˜å‚¨
- è¯ä»¶ç…§ç‰‡åŠ å¯†å­˜å‚¨
- è®¿å®¢æƒé™åŠæ—¶æ³¨é”€
- æ•æ„Ÿæ“ä½œå®¡è®¡æ—¥å¿—
- é»‘åå•å®æ—¶æ ¡éªŒ

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
