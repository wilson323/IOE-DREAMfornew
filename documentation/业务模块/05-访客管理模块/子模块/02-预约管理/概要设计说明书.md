# 预约管理子模块 - 概要设计说明书

> **版本**: v1.0.0  
> **更新日期**: 2025-01-30

## 1. 系统架构

### 1.1 模块定位

预约管理是访客管理系统的入口模块，提供访客来访预约的全流程管理能力。

### 1.2 架构图

```
┌─────────────────────────────────────────────────┐
│                  预约管理模块                     │
├─────────────────────────────────────────────────┤
│  Controller层                                    │
│  ├── ReservationController (预约管理)            │
│  └── ApprovalController (审批管理)               │
├─────────────────────────────────────────────────┤
│  Service层                                       │
│  ├── ReservationService                         │
│  └── ApprovalService                            │
├─────────────────────────────────────────────────┤
│  Manager层                                       │
│  ├── ReservationManager                         │
│  ├── ApprovalFlowManager                        │
│  ├── QrCodeGenerator                            │
│  └── NotificationManager                        │
├─────────────────────────────────────────────────┤
│  DAO层                                          │
│  ├── ReservationDao                             │
│  ├── ApprovalRecordDao                          │
│  └── CompanionDao                               │
└─────────────────────────────────────────────────┘
```

## 2. 模块设计

### 2.1 核心模块

| 模块 | 职责 |
|------|------|
| 预约创建 | 处理预约申请，验证信息，生成预约单 |
| 审批流程 | 支持单级/多级审批，审批通知 |
| 预约变更 | 修改、取消、延期预约 |
| 二维码管理 | 生成动态二维码，验证有效性 |
| 通知提醒 | 多渠道通知（短信/APP/邮件） |

### 2.2 模块依赖

- 访客信息模块：获取访客基本信息
- 黑名单模块：黑名单校验
- 通知服务：发送各类通知
- 区域管理：访问区域权限

## 3. 数据库概念模型

### 3.1 ER图

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   访客信息   │────<│   预约信息   │>────│   被访人    │
└─────────────┘     └──────┬──────┘     └─────────────┘
                          │
                          │ 1:N
                          ▼
                   ┌─────────────┐
                   │  审批记录    │
                   └─────────────┘
                          │
                          │ 1:N
                          ▼
                   ┌─────────────┐
                   │  随行人员    │
                   └─────────────┘
```

### 3.2 核心表

| 表名 | 说明 |
|------|------|
| vis_reservation | 预约信息表 |
| vis_reservation_approval | 审批记录表 |
| vis_companion | 随行人员表 |

## 4. 技术选型

| 技术 | 选型 | 说明 |
|------|------|------|
| 框架 | Spring Boot 3.5.8 | 微服务框架 |
| ORM | MyBatis-Plus 3.5.15 | 数据访问 |
| 缓存 | Redis + Caffeine | 多级缓存 |
| 二维码 | ZXing | 二维码生成 |
| 通知 | 统一通知服务 | 多渠道通知 |

## 5. 接口概览

| 接口 | 方法 | 说明 |
|------|------|------|
| /reservation/create | POST | 创建预约 |
| /reservation/approve | POST | 审批预约 |
| /reservation/cancel | POST | 取消预约 |
| /reservation/extend | POST | 延期预约 |
| /reservation/detail/{id} | GET | 预约详情 |
| /reservation/my-list | POST | 我的预约 |
| /reservation/pending-approvals | GET | 待审批列表 |

