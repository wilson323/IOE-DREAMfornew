# é¢„çº¦ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_visitor_appointment {
        bigint id PK "é¢„çº¦ID"
        varchar appointment_code "é¢„çº¦ç "
        bigint visitor_id FK "è®¿å®¢ID"
        bigint host_id FK "è¢«è®¿äººID"
        bigint host_dept_id FK "è¢«è®¿éƒ¨é—¨ID"
        varchar visit_reason "æ¥è®¿äº‹ç”±"
        datetime visit_start_time "é¢„è®¡åˆ°è®¿æ—¶é—´"
        datetime visit_end_time "é¢„è®¡ç¦»å¼€æ—¶é—´"
        varchar visitor_type "è®¿å®¢ç±»å‹"
        int visitor_count "éšè¡Œäººæ•°"
        varchar vehicle_no "è½¦ç‰Œå·"
        tinyint status "çŠ¶æ€"
        bigint approver_id FK "å®¡æ‰¹äººID"
        datetime approve_time "å®¡æ‰¹æ—¶é—´"
        varchar approve_remark "å®¡æ‰¹å¤‡æ³¨"
        datetime create_time "åˆ›å»ºæ—¶é—´"
    }
    
    t_visitor_info {
        bigint id PK "è®¿å®¢ID"
        varchar name "å§“å"
        varchar phone "æ‰‹æœºå·"
        varchar id_card "èº«ä»½è¯å·"
        varchar company "æ‰€å±å…¬å¸"
    }
    
    t_visitor_companion {
        bigint id PK "éšè¡ŒäººID"
        bigint appointment_id FK "é¢„çº¦ID"
        varchar name "å§“å"
        varchar phone "æ‰‹æœºå·"
        varchar id_card "èº«ä»½è¯å·"
    }
    
    t_visitor_info ||--o{ t_visitor_appointment : "é¢„çº¦"
    t_visitor_appointment ||--o{ t_visitor_companion : "éšè¡Œäºº"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_visitor_appointment (è®¿å®¢é¢„çº¦è¡¨)

```sql
CREATE TABLE t_visitor_appointment (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é¢„çº¦ID',
    appointment_code VARCHAR(20) NOT NULL COMMENT 'é¢„çº¦ç ',
    visitor_id BIGINT NOT NULL COMMENT 'è®¿å®¢ID',
    host_id BIGINT NOT NULL COMMENT 'è¢«è®¿äººID',
    host_dept_id BIGINT COMMENT 'è¢«è®¿éƒ¨é—¨ID',
    visit_reason VARCHAR(200) NOT NULL COMMENT 'æ¥è®¿äº‹ç”±',
    visit_start_time DATETIME NOT NULL COMMENT 'é¢„è®¡åˆ°è®¿æ—¶é—´',
    visit_end_time DATETIME NOT NULL COMMENT 'é¢„è®¡ç¦»å¼€æ—¶é—´',
    visitor_type VARCHAR(20) DEFAULT 'NORMAL' COMMENT 'è®¿å®¢ç±»å‹:NORMAL/VIP/SUPPLIER/INTERVIEW',
    visitor_count INT DEFAULT 1 COMMENT 'éšè¡Œäººæ•°',
    vehicle_no VARCHAR(20) COMMENT 'è½¦ç‰Œå·',
    visit_areas VARCHAR(500) COMMENT 'å¯è®¿é—®åŒºåŸŸIDåˆ—è¡¨',
    qr_code_url VARCHAR(200) COMMENT 'äºŒç»´ç åœ°å€',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€:0å¾…å®¡æ‰¹1å·²é€šè¿‡2å·²æ‹’ç»3å·²å–æ¶ˆ4å·²åˆ°è®¿5å·²ç¦»å¼€6å·²è¿‡æœŸ',
    approver_id BIGINT COMMENT 'å®¡æ‰¹äººID',
    approve_time DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    approve_remark VARCHAR(200) COMMENT 'å®¡æ‰¹å¤‡æ³¨',
    notify_status TINYINT DEFAULT 0 COMMENT 'é€šçŸ¥çŠ¶æ€:0æœªé€šçŸ¥1å·²é€šçŸ¥',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_appointment_code (appointment_code),
    INDEX idx_visitor_id (visitor_id),
    INDEX idx_host_id (host_id),
    INDEX idx_visit_time (visit_start_time),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¿å®¢é¢„çº¦è¡¨';
```

### t_visitor_companion (éšè¡Œäººå‘˜è¡¨)

```sql
CREATE TABLE t_visitor_companion (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'éšè¡ŒäººID',
    appointment_id BIGINT NOT NULL COMMENT 'é¢„çº¦ID',
    name VARCHAR(50) NOT NULL COMMENT 'å§“å',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    id_card VARCHAR(20) COMMENT 'èº«ä»½è¯å·',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_appointment_id (appointment_id),
    FOREIGN KEY (appointment_id) REFERENCES t_visitor_appointment(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='éšè¡Œäººå‘˜è¡¨';
```

---

## ğŸ”§ çŠ¶æ€æšä¸¾

| çŠ¶æ€å€¼ | è¯´æ˜ |
|--------|------|
| 0 | å¾…å®¡æ‰¹ |
| 1 | å·²é€šè¿‡ |
| 2 | å·²æ‹’ç» |
| 3 | å·²å–æ¶ˆ |
| 4 | å·²åˆ°è®¿ |
| 5 | å·²ç¦»å¼€ |
| 6 | å·²è¿‡æœŸ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
