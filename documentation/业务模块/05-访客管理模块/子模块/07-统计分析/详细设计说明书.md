# 统计分析子模块 - 详细设计说明书

> **版本**: v1.0.0  
> **更新日期**: 2025-01-30

## 1. 模块概述

统计分析子模块提供访客数据的多维度统计分析和报表生成能力。

## 2. 类结构设计

### 2.1 统计维度

| 维度 | 说明 |
|------|------|
| 时间维度 | 日/周/月/年统计 |
| 区域维度 | 按访问区域统计 |
| 来访目的 | 按来访事由统计 |
| 被访部门 | 按被访部门统计 |
| 访客类型 | 按访客类型统计 |

### 2.2 Manager层核心方法

- getDailyStats: 日统计
- getMonthlyStats: 月统计
- getAreaStats: 区域统计
- getPurposeStats: 来访目的统计
- generateReport: 生成报表

## 3. 数据库详细设计

### 3.1 统计汇总表 (vis_statistics_daily)

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| stat_date | DATE | 统计日期 |
| total_visitors | INT | 访客总数 |
| reservation_count | INT | 预约数 |
| walkin_count | INT | 临时登记数 |
| avg_stay_time | INT | 平均停留时间(分钟) |
| peak_hour | INT | 高峰时段 |
| area_distribution | JSON | 区域分布 |
| purpose_distribution | JSON | 目的分布 |

### 3.2 索引设计

- uk_stat_date: 统计日期唯一索引

## 4. 接口详细设计

### 4.1 获取日统计
- **URL**: GET /api/v1/visitor/stats/daily
- **请求参数**: date
- **响应**: 日统计数据

### 4.2 获取月统计
- **URL**: GET /api/v1/visitor/stats/monthly
- **请求参数**: year, month
- **响应**: 月统计数据

### 4.3 获取趋势数据
- **URL**: GET /api/v1/visitor/stats/trend
- **请求参数**: startDate, endDate, dimension
- **响应**: 趋势数据

### 4.4 导出报表
- **URL**: POST /api/v1/visitor/stats/export
- **请求参数**: startDate, endDate, format
- **响应**: 报表文件

## 5. 报表类型

| 报表 | 说明 |
|------|------|
| 访客日报 | 每日访客汇总 |
| 访客月报 | 月度访客分析 |
| 区域分析报告 | 各区域访客分布 |
| 趋势分析报告 | 访客量趋势分析 |
| 异常分析报告 | 异常事件统计 |

## 6. 错误码定义

| 错误码 | 说明 |
|--------|------|
| VIS_STA_001 | 统计数据不存在 |
| VIS_STA_002 | 日期范围超限 |
| VIS_STA_003 | 报表生成失败 |

