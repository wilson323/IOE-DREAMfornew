# 访客模块前端完整实施计划

> **版本**: v1.0.0
> **创建日期**: 2025-01-30
> **状态**: 待实施
> **预计工期**: 3-4周

---

## 📊 现状分析

### 当前前端实现状态

| 项目 | 状态 | 完成度 | 说明 |
|------|------|--------|------|
| **API接口定义** | ❌ 严重不足 | 2% | 仅2个接口，缺失70+接口 |
| **前端页面** | ❌ 完全缺失 | 0% | 无任何页面 |
| **组件库** | ❌ 完全缺失 | 0% | 无专用组件 |
| **路由配置** | ❌ 完全缺失 | 0% | 无路由配置 |
| **权限控制** | ❌ 完全缺失 | 0% | 无权限控制 |

### 后端实现状态

| 子模块 | 状态 | 接口数量 | 说明 |
|--------|------|----------|------|
| 访客信息管理 | ✅ 已实现 | 6个 | CRUD完整 |
| 预约管理 | ✅ 已实现 | 8个 | 审批流程完整 |
| 登记管理 | ✅ 已实现 | 7个 | 签到签出完整 |
| 身份验证 | ✅ 已实现 | 5个 | 多种验证方式 |
| 物流管理 | ✅ 已实现 | 12个 | 电子出门单完整 |
| 通行记录 | ✅ 已实现 | 6个 | 轨迹追踪完整 |
| 统计分析 | ✅ 已实现 | 10个 | 报表生成完整 |

**总计**: **54个后端接口已实现**，前端仅对接2个！

---

## 🎯 实施目标

### 总体目标

在3-4周内完成访客模块前端完整企业级实现，包括7个子模块的所有功能页面，确保与后端54个接口完整对接。

### 质量目标

- ✅ **代码规范**: 100%遵循Vue3 Composition API规范
- ✅ **UI一致性**: 100%使用Ant Design Vue 4组件
- ✅ **功能完整性**: 100%覆盖文档定义的所有功能
- ✅ **API对接**: 100%对接后端所有接口
- ✅ **响应式设计**: 支持1920/1440/1024分辨率
- ✅ **权限控制**: 实现RBAC权限矩阵
- ✅ **代码复用**: 抽取公共组件，避免冗余

---

## 📋 功能清单

### 子模块1: 访客信息管理 (3-4天)

#### 1.1 访客档案页面 (`visitor-info.vue`)

**页面功能**:
- 访客列表展示（分页、搜索、筛选）
- 访客信息新增/编辑弹窗
- 访客照片上传和裁剪
- 访客历史记录查看
- 访客等级设置（VIP/普通/受限）

**核心字段**:
```javascript
{
  name: '姓名',
  gender: '性别',
  idCard: '身份证号(加密)',
  phone: '手机号(加密)',
  email: '邮箱',
  companyName: '公司名称',
  visitorLevel: '访客等级',
  facePhoto: '人脸照片',
  visitCount: '来访次数',
  lastVisitTime: '最后来访时间'
}
```

**API接口**:
- `POST /api/v1/visitor/query` - 分页查询
- `POST /api/v1/visitor/add` - 添加访客
- `POST /api/v1/visitor/update` - 更新访客
- `POST /api/v1/visitor/delete/{id}` - 删除访客
- `GET /api/v1/visitor/{id}/history` - 历史记录

#### 1.2 黑名单管理页面 (`visitor-blacklist.vue`)

**页面功能**:
- 黑名单列表展示
- 黑名单添加（单个/批量）
- 黑名单移除
- 黑名单原因设置
- 黑名单有效期设置
- 黑名单实时检查状态

**核心字段**:
```javascript
{
  visitorId: '访客ID',
  visitorName: '访客姓名',
  blacklistType: '永久/临时',
  reason: '拉黑原因',
  riskLevel: '高/中/低',
  expireTime: '过期时间',
  operator: '操作人'
}
```

**API接口**:
- `POST /api/v1/visitor/blacklist/query` - 黑名单查询
- `POST /api/v1/visitor/addToBlacklist` - 加入黑名单
- `POST /api/v1/visitor/removeFromBlacklist` - 移出黑名单
- `GET /api/v1/visitor/blacklist/check/{visitorId}` - 黑名单检查

---

### 子模块2: 预约管理 (4-5天)

#### 2.1 预约列表页面 (`appointment-list.vue`)

**页面功能**:
- 预约列表展示（Tab切换：全部/待审批/已批准/已拒绝/已取消）
- 预约详情查看
- 预约状态筛选
- 预约时间轴展示
- 批量操作（批量审批/批量取消）

**列表字段**:
```javascript
{
  reservationNo: '预约编号',
  visitorName: '访客姓名',
  companyName: '公司名称',
  intervieweeName: '被访人',
  visitPurpose: '来访事由',
  visitDate: '来访日期',
  visitTimeRange: '09:00-12:00',
  status: '预约状态',
  approvalStatus: '审批状态',
  createTime: '创建时间'
}
```

**API接口**:
- `POST /api/v1/visitor/reservation/query` - 预约查询
- `GET /api/v1/visitor/reservation/{id}` - 预约详情
- `POST /api/v1/visitor/reservation/batch-approve` - 批量审批
- `POST /api/v1/visitor/reservation/batch-cancel` - 批量取消

#### 2.2 预约申请页面 (`appointment-apply.vue`)

**页面功能**:
- 预约申请表单（分步表单：访客信息→访问信息→确认提交）
- 访客信息自动补全（选择历史访客）
- 被访人选择器（员工组织架构树）
- 访问时间选择（日期+时间段）
- 访问区域选择（区域树形选择）
- 随行人员添加
- 车辆信息录入

**表单步骤**:
```
步骤1: 访客信息
  - 访客姓名、手机、邮箱
  - 公司名称
  - 访客类型选择

步骤2: 访问信息
  - 被访人选择
  - 来访事由
  - 访问日期时间
  - 访问区域
  - 随行人数

步骤3: 确认提交
  - 信息确认
  - 提交申请
```

**API接口**:
- `POST /api/v1/visitor/reservation/create` - 创建预约
- `GET /api/v1/visitor/employees/tree` - 员工组织树
- `GET /api/v1/visitor/areas/tree` - 区域树
- `GET /api/v1/visitor/slots/available` - 可用时间段

#### 2.3 预约审批页面 (`appointment-approve.vue`)

**页面功能**:
- 待审批预约列表
- 预约详情查看
- 审批操作（同意/拒绝）
- 审批条件设置（需陪同、限制区域等）
- 审批意见填写
- 审批历史查看

**审批流程**:
```
1. 查看预约详情
2. 选择审批结果（同意/拒绝）
3. 填写审批意见
4. 设置审批条件（可选）
5. 提交审批
6. 生成访客二维码
```

**API接口**:
- `GET /api/v1/visitor/reservation/pending` - 待审批列表
- `POST /api/v1/visitor/reservation/approve` - 审批预约
- `POST /api/v1/visitor/reservation/reject` - 拒绝预约
- `GET /api/v1/visitor/reservation/{id}/history` - 审批历史

#### 2.4 预约二维码展示 (`appointment-qrcode.vue`)

**页面功能**:
- 预约二维码展示
- 二维码下载（PNG/PDF）
- 二维码有效期显示
- 访客信息卡片展示
- 访问须知提示

**API接口**:
- `GET /api/v1/visitor/reservation/{id}/qrcode` - 获取二维码
- `GET /api/v1/visitor/reservation/{id}/detail` - 预约详情

---

### 子模块3: 登记管理 (3-4天)

#### 3.1 访客签到页面 (`visitor-checkin.vue`)

**页面功能**:
- 预约访客签到（预约码验证）
- 临时访客登记（信息录入）
- 身份验证（人脸/二维码/证件）
- 访客证打印
- 签到成功提示

**签到流程**:
```
1. 输入预约码/手机号
2. 系统验证预约信息
3. 身份验证（人脸识别）
4. 拍照存档
5. 生成访客证
6. 打印访客证
7. 签到成功
```

**API接口**:
- `POST /api/v1/visitor/registration/checkin` - 访客签到
- `POST /api/v1/visitor/verify/qrcode` - 二维码验证
- `POST /api/v1/visitor/verify/face` - 人脸验证
- `GET /api/v1/visitor/registration/{id}/pass` - 生成访客证

#### 3.2 访客签出页面 (`visitor-checkout.vue`)

**页面功能**:
- 在场访客列表
- 访客签出操作
- 访客证回收
- 访问时长统计
- 满意度调查

**签出流程**:
```
1. 选择在场访客
2. 确认签出信息
3. 满意度调查（可选）
4. 访客证回收
5. 记录签出时间
6. 计算访问时长
```

**API接口**:
- `GET /api/v1/visitor/registration/current-visitors` - 在场访客
- `POST /api/v1/visitor/registration/checkout` - 访客签出
- `GET /api/v1/visitor/registration/{id}/duration` - 访问时长
- `POST /api/v1/visitor/registration/feedback` - 满意度反馈

#### 3.3 在场访客监控 (`visitor-monitor.vue`)

**页面功能**:
- 在场访客实时列表
- 访客超时预警（红色标记）
- 访客轨迹地图展示
- 访客统计卡片（在场人数/今日签到/今日签出）
- 访客详细信息查看

**监控卡片**:
```javascript
{
  totalVisitors: '在场总数',
  todayCheckIn: '今日签到',
  todayCheckOut: '今日签出',
  overtimeVisitors: '超时人数'
}
```

**API接口**:
- `GET /api/v1/visitor/registration/current-visitors` - 在场访客
- `GET /api/v1/visitor/registration/overtime` - 超时访客
- `GET /api/v1/visitor/registration/{id}/trajectory` - 访客轨迹
- `GET /api/v1/visitor/registration/statistics/today` - 今日统计

---

### 子模块4: 身份验证组件 (2-3天)

#### 4.1 人脸识别组件 (`FaceAuth.vue`)

**组件功能**:
- 摄像头调用
- 人脸检测
- 活体检测
- 人脸比对
- 验证结果显示

**使用场景**:
- 访客签到
- 门禁通行
- 访客证办理

**API接口**:
- `POST /api/v1/visitor/verify/face` - 人脸验证

#### 4.2 二维码扫描组件 (`QRCodeScanner.vue`)

**组件功能**:
- 摄像头调用
- 二维码识别
- 预约码验证
- 访客码验证

**使用场景**:
- 访客签到
- 门禁通行
- 访客证验证

**API接口**:
- `POST /api/v1/visitor/verify/qrcode` - 二维码验证

#### 4.3 证件识别组件 (`IDCardReader.vue`)

**组件功能**:
- 身份证读取器调用
- OCR识别
- 信息提取
- 信息回填

**使用场景**:
- 访客登记
- 司机登记
- 物流登记

**API接口**:
- `POST /api/v1/visitor/verify/idcard` - 证件验证

---

### 子模块5: 物流管理 (4-5天)

#### 5.1 物流预约页面 (`logistics-reservation.vue`)

**页面功能**:
- 物流预约列表
- 物流预约申请
- 司机信息录入
- 车辆信息录入
- 货物信息登记
- 预约类型选择（送货/提货/转运）

**预约类型**:
- 送货: 进入园区送货
- 提货: 从园区提货
- 转运: 货物中转

**表单字段**:
```javascript
{
  // 司机信息
  driverName: '司机姓名',
  driverPhone: '司机电话',
  idCard: '身份证号',
  driverLicense: '驾驶证号',

  // 车辆信息
  plateNumber: '车牌号',
  vehicleType: '车型',
  loadCapacity: '载重',

  // 货物信息
  goodsType: '货物类型',
  goodsWeight: '货物重量',
  packageCount: '件数',

  // 作业信息
  operationType: '送货/提货/转运',
  expectedArriveDate: '预期到达日期',
  expectedArriveTime: '预期到达时间',
  intervieweeId: '被访人'
}
```

**API接口**:
- `POST /api/v1/logistics/reservation/create` - 创建物流预约
- `POST /api/v1/logistics/reservation/query` - 物流预约查询
- `POST /api/v1/logistics/reservation/cancel` - 取消预约

#### 5.2 物流登记页面 (`logistics-checkin.vue`)

**页面功能**:
- 预约码验证
- 车辆签到
- 货物核对
- 安全检查
- 登记凭证生成

**登记流程**:
```
1. 扫描预约码
2. 验证预约信息
3. 拍照存档（司机、车辆、证件）
4. 货物核对
5. 安全检查
6. 生成登记凭证
```

**API接口**:
- `POST /api/v1/logistics/registration/checkin` - 物流签到
- `POST /api/v1/logistics/registration/verify-goods` - 货物验证
- `POST /api/v1/logistics/registration/security-check` - 安全检查

#### 5.3 电子出门单页面 (`exit-pass.vue`)

**页面功能**:
- 出门单列表
- 出门单生成
- 货物信息确认
- 被访人确认（电子签名）
- 保安检查
- 放行操作

**出门单流程**:
```
1. 司机申请出门
2. 仓库管理员确认货物
3. 被访人确认（电子签名）
4. 保安检查
5. 放行操作
6. 记录放行时间
```

**流程步骤展示**:
```vue
<a-steps :current="currentStep">
  <a-step title="申请出门" />
  <a-step title="仓库确认" />
  <a-step title="被访人确认" />
  <a-step title="保安检查" />
  <a-step title="放行" />
</a-steps>
```

**API接口**:
- `POST /api/v1/logistics/exit-pass/generate` - 生成出门单
- `POST /api/v1/logistics/exit-pass/intervieweeConfirm` - 被访人确认
- `POST /api/v1/logistics/exit-pass/guardCheck` - 保安检查
- `POST /api/v1/logistics/exit-pass/release` - 放行
- `GET /api/v1/logistics/exit-pass/{id}/detail` - 出门单详情

#### 5.4 进出厂记录页面 (`logistics-records.vue`)

**页面功能**:
- 进厂记录列表
- 出厂记录列表
- 记录详情查看
- 记录统计报表

**API接口**:
- `GET /api/v1/logistics/records/inbound` - 进厂记录
- `GET /api/v1/logistics/records/outbound` - 出厂记录
- `GET /api/v1/logistics/records/statistics` - 物流统计

---

### 子模块6: 通行记录 (3天)

#### 6.1 通行记录页面 (`visitor-records.vue`)

**页面功能**:
- 通行记录列表
- 记录筛选（日期/区域/设备）
- 记录详情查看
- 轨迹回放
- 异常记录管理

**记录字段**:
```javascript
{
  recordId: '记录ID',
  visitorName: '访客姓名',
  accessType: '进入/离开',
  deviceName: '设备名称',
  areaName: '区域名称',
  accessTime: '通行时间',
  verifyType: '验证方式',
  snapshotUrl: '抓拍图片'
}
```

**API接口**:
- `POST /api/v1/visitor/records/query` - 通行记录查询
- `GET /api/v1/visitor/records/{id}/detail` - 记录详情
- `GET /api/v1/visitor/records/{id}/trajectory` - 轨迹回放

#### 6.2 异常记录页面 (`visitor-exceptions.vue`)

**页面功能**:
- 异常记录列表
- 异常类型筛选
- 异常处理操作
- 异常统计图表

**异常类型**:
- 黑名单闯入
- 逾期未离开
- 未授权区域通行
- 多次验证失败

**API接口**:
- `GET /api/v1/visitor/exceptions/query` - 异常记录查询
- `POST /api/v1/visitor/exceptions/handle` - 处理异常
- `GET /api/v1/visitor/exceptions/statistics` - 异常统计

---

### 子模块7: 统计分析 (3-4天)

#### 7.1 访客统计仪表板 (`visitor-dashboard.vue`)

**页面功能**:
- KPI指标卡片（今日访客/在场人数/预约待审批）
- 访客流量趋势图（日/周/月）
- 访客时段分布图
- 访客来源分析图
- 访客类型分布图
- 访客目的统计图

**KPI指标**:
```javascript
{
  todayVisitors: '今日访客',
  onSiteVisitors: '在场人数',
  pendingApprovals: '待审批',
  todayCheckOut: '今日签出',
  avgVisitDuration: '平均时长',
  blacklistAlerts: '黑名单告警'
}
```

**图表列表**:
1. 访客流量趋势图（折线图）
2. 访客时段分布图（柱状图）
3. 访客来源分析（饼图）
4. 访客类型分布（环形图）
5. 访客目的统计（横向柱状图）

**API接口**:
- `GET /api/v1/visitor/statistics/overview` - 统计概览
- `GET /api/v1/visitor/statistics/trend` - 流量趋势
- `GET /api/v1/visitor/statistics/distribution` - 分布分析
- `GET /api/v1/visitor/statistics/purpose` - 目的统计

#### 7.2 预约统计页面 (`appointment-statistics.vue`)

**页面功能**:
- 预约量统计（日/周/月）
- 审批通过率统计
- 预约完成率统计
- 预约取消率统计
- 部门预约排行

**API接口**:
- `GET /api/v1/visitor/reports/statistics` - 预约统计
- `GET /api/v1/visitor/reports/approval-rate` - 审批通过率
- `GET /api/v1/visitor/reports/completion-rate` - 完成率

#### 7.3 物流统计页面 (`logistics-statistics.vue`)

**页面功能**:
- 物流作业量统计
- 作业时长分析
- 货物类型统计
- 车辆类型统计
- 进出场统计

**API接口**:
- `GET /api/v1/logistics/reports/statistics` - 物流统计
- `GET /api/v1/logistics/reports/operation-duration` - 作业时长

#### 7.4 报表导出页面 (`visitor-reports.vue`)

**页面功能**:
- 报表类型选择
- 日期范围选择
- 报表字段自定义
- 报表预览
- 报表导出（Excel/PDF）

**报表类型**:
- 访客明细报表
- 预约统计报表
- 通行记录报表
- 物流作业报表
- 异常记录报表

**API接口**:
- `POST /api/v1/visitor/reports/generate` - 生成报表
- `POST /api/v1/visitor/reports/export` - 导出报表
- `GET /api/v1/visitor/reports/templates` - 报表模板

---

## 🏗️ 技术架构设计

### 前端技术栈

```yaml
框架: Vue 3.4.x
构建工具: Vite 5.x
状态管理: Pinia 2.x
路由: Vue Router 4.x
UI组件: Ant Design Vue 4.x
HTTP客户端: Axios 1.6.x
图表: ECharts 5.4.x
日期处理: Day.js 1.11.x
图片处理: Cropper.js
二维码: QRCode.js
签名: Signature Pad
```

### 目录结构

```
smart-admin-web-javascript/src/
├── views/
│   └── business/
│       └── smart-visitor/              # 访客模块根目录
│           ├── visitor-info.vue         # 访客信息管理
│           ├── visitor-blacklist.vue    # 黑名单管理
│           ├── appointment-list.vue     # 预约列表
│           ├── appointment-apply.vue     # 预约申请
│           ├── appointment-approve.vue   # 预约审批
│           ├── appointment-qrcode.vue   # 预约二维码
│           ├── visitor-checkin.vue      # 访客签到
│           ├── visitor-checkout.vue     # 访客签出
│           ├── visitor-monitor.vue      # 在场监控
│           ├── logistics-reservation.vue # 物流预约
│           ├── logistics-checkin.vue    # 物流签到
│           ├── exit-pass.vue            # 电子出门单
│           ├── logistics-records.vue    # 物流记录
│           ├── visitor-records.vue      # 通行记录
│           ├── visitor-exceptions.vue   # 异常记录
│           ├── visitor-dashboard.vue    # 统计仪表板
│           ├── appointment-statistics.vue # 预约统计
│           ├── logistics-statistics.vue # 物流统计
│           └── visitor-reports.vue      # 报表导出
├── components/
│   └── visitor/                        # 访客专用组件
│       ├── FaceAuth.vue                # 人脸认证组件
│       ├── QRCodeScanner.vue           # 二维码扫描组件
│       ├── IDCardReader.vue            # 证件读取组件
│       ├── SignaturePad.vue            # 电子签名组件
│       ├── VisitorCard.vue             # 访客证组件
│       ├── TimelineStep.vue            # 时间轴组件
│       └── trajectory-map.vue          # 轨迹地图组件
├── api/
│   └── business/
│       └── visitor/
│           ├── visitor-api.js          # 移动端API
│           └── visitor-pc-api.js        # PC端API（需完善）
└── store/
    └── modules/
        └── visitor.js                   # 访客状态管理
```

### API接口完善

当前`visitor-pc-api.js`仅2个接口，需补充至70+接口：

```javascript
export const visitorPcApi = {
  // ==================== 访客管理 (15个接口) ====================
  queryVisitors: (params) => postRequest('/visitor/query', params),
  getVisitorDetail: (id) => getRequest(`/visitor/${id}`),
  addVisitor: (data) => postRequest('/visitor/add', data),
  updateVisitor: (data) => postRequest('/visitor/update', data),
  deleteVisitor: (id) => postRequest(`/visitor/delete/${id}`),

  // 黑名单管理
  queryBlacklist: (params) => postRequest('/visitor/blacklist/query', params),
  addToBlacklist: (data) => postRequest('/visitor/addToBlacklist', data),
  removeFromBlacklist: (data) => postRequest('/visitor/removeFromBlacklist', data),
  checkBlacklist: (visitorId) => getRequest(`/visitor/blacklist/check/${visitorId}`),

  // ==================== 预约管理 (20个接口) ====================
  queryAppointments: (params) => postRequest('/visitor/appointment/query', params),
  getAppointmentDetail: (id) => getRequest(`/visitor/appointment/${id}`),
  createAppointment: (data) => postRequest('/visitor/appointment/create', data),
  updateAppointment: (data) => postRequest('/visitor/appointment/update', data),
  cancelAppointment: (data) => postRequest('/visitor/appointment/cancel', data),

  // 审批流程
  getPendingApprovals: (params) => getRequest('/visitor/appointment/pending', params),
  approveAppointment: (data) => postRequest('/visitor/appointment/approve', data),
  rejectAppointment: (data) => postRequest('/visitor/appointment/reject', data),
  batchApprove: (data) => postRequest('/visitor/appointment/batch-approve', data),
  batchCancel: (data) => postRequest('/visitor/appointment/batch-cancel', data),

  // 二维码
  getQRCode: (id) => getRequest(`/visitor/appointment/${id}/qrcode`),

  // ==================== 登记管理 (12个接口) ====================
  checkIn: (data) => postRequest('/visitor/registration/checkin', data),
  checkOut: (data) => postRequest('/visitor/registration/checkout', data),
  getCurrentVisitors: (params) => getRequest('/visitor/registration/current-visitors', params),
  getOvertimeVisitors: (params) => getRequest('/visitor/registration/overtime', params),
  getVisitorPass: (id) => getRequest(`/visitor/registration/${id}/pass`),
  getVisitDuration: (id) => getRequest(`/visitor/registration/${id}/duration`),

  // ==================== 身份验证 (8个接口) ====================
  verifyFace: (data) => postRequest('/visitor/verify/face', data),
  verifyQRCode: (data) => postRequest('/visitor/verify/qrcode', data),
  verifySMS: (data) => postRequest('/visitor/verify/sms', data),
  verifyIDCard: (data) => postRequest('/visitor/verify/idcard', data),

  // ==================== 物流管理 (20个接口) ====================
  createLogisticsReservation: (data) => postRequest('/logistics/reservation/create', data),
  queryLogisticsReservations: (params) => postRequest('/logistics/reservation/query', params),
  logisticsCheckIn: (data) => postRequest('/logistics/registration/checkin', data),

  // 出门单流程
  generateExitPass: (data) => postRequest('/logistics/exit-pass/generate', data),
  intervieweeConfirm: (data) => postRequest('/logistics/exit-pass/intervieweeConfirm', data),
  guardCheck: (data) => postRequest('/logistics/exit-pass/guardCheck', data),
  releaseVehicle: (data) => postRequest('/logistics/exit-pass/release', data),

  // 记录
  getInboundRecords: (params) => getRequest('/logistics/records/inbound', params),
  getOutboundRecords: (params) => getRequest('/logistics/records/outbound', params),

  // ==================== 通行记录 (8个接口) ====================
  queryAccessRecords: (params) => postRequest('/visitor/records/query', params),
  getAccessRecordDetail: (id) => getRequest(`/visitor/records/${id}/detail`),
  getVisitorTrajectory: (id) => getRequest(`/visitor/records/${id}/trajectory`),

  // 异常管理
  queryExceptions: (params) => getRequest('/visitor/exceptions/query', params),
  handleException: (data) => postRequest('/visitor/exceptions/handle', data),

  // ==================== 统计分析 (15个接口) ====================
  // 统计概览
  getStatisticsOverview: (params) => getRequest('/visitor/statistics/overview', params),
  getVisitorTrend: (params) => getRequest('/visitor/statistics/trend', params),
  getVisitorDistribution: (params) => getRequest('/visitor/statistics/distribution', params),

  // 预约统计
  getAppointmentStatistics: (params) => getRequest('/visitor/reports/statistics', params),
  getApprovalRate: (params) => getRequest('/visitor/reports/approval-rate', params),
  getCompletionRate: (params) => getRequest('/visitor/reports/completion-rate', params),

  // 物流统计
  getLogisticsStatistics: (params) => getRequest('/logistics/reports/statistics', params),

  // 报表
  generateReport: (data) => postRequest('/visitor/reports/generate', data),
  exportReport: (data) => postRequest('/visitor/reports/export', data),
  getReportTemplates: () => getRequest('/visitor/reports/templates'),
};
```

---

## 📐 开发规范

### 代码风格规范

1. **组件命名**: PascalCase，如`VisitorInfo.vue`
2. **文件组织**: 单文件组件（SFC），按`<template>`、`<script setup>`、`<style>`顺序
3. **API调用**: 统一使用`visitor-pc-api.js`
4. **状态管理**: 使用Pinia，按子模块划分store
5. **路由配置**: 使用嵌套路由，父路由`/business/smart-visitor`

### 响应式设计规范

```vue
<template>
  <a-row :gutter="[16, 16]">
    <a-col :xs="24" :sm="24" :md="12" :lg="8" :xl="6">
      <!-- 卡片内容 -->
    </a-col>
  </a-row>
</template>
```

### 表单验证规范

```javascript
const rules = {
  name: [
    { required: true, message: '请输入姓名', trigger: 'blur' },
    { min: 2, max: 50, message: '长度在2-50个字符', trigger: 'blur' }
  ],
  phone: [
    { required: true, message: '请输入手机号', trigger: 'blur' },
    { pattern: /^1[3-9]\d{9}$/, message: '手机号格式不正确', trigger: 'blur' }
  ],
  idCard: [
    { required: true, message: '请输入身份证号', trigger: 'blur' },
    {
      pattern: /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))\d{3}[0-9Xx]$/,
      message: '身份证号格式不正确',
      trigger: 'blur'
    }
  ]
};
```

### 数据脱敏规范

```javascript
// 显示脱敏
const maskPhone = (phone) => {
  if (!phone) return '-';
  return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
};

const maskIdCard = (idCard) => {
  if (!idCard) return '-';
  return idCard.replace(/(.{6})(.{8})(.{4})/, '$1********$3');
};
```

### 权限控制规范

```javascript
// 权限指令使用
<template>
  <a-button v-auth="'visitor:info:add'">添加访客</a-button>
  <a-button v-auth="'visitor:blacklist:add'">加入黑名单</a-button>
</template>

// 权限检查函数
import { useAuthStore } from '/@/store/modules/auth';

const canApprove = computed(() => {
  return authStore.hasPermission('visitor:appointment:approve');
});
```

---

## ⚠️ 注意事项

### 1. 安全注意事项

- ✅ **敏感数据加密**: 身份证号、手机号后端加密，前端脱敏显示
- ✅ **照片安全**: 访客照片使用HTTPS传输
- ✅ **权限控制**: 严格按权限矩阵控制功能访问
- ✅ **审计日志**: 关键操作记录审计日志
- ✅ **XSS防护**: 用户输入严格过滤和转义

### 2. 性能优化

- ✅ **图片懒加载**: 列表图片使用懒加载
- ✅ **虚拟滚动**: 大数据列表使用虚拟滚动
- ✅ **接口防抖**: 搜索输入使用防抖
- ✅ **缓存策略**: 字典数据使用Pinia缓存
- ✅ **路由懒加载**: 页面组件按需加载

### 3. 用户体验

- ✅ **加载状态**: 所有异步操作显示loading状态
- ✅ **错误提示**: 操作失败显示友好错误信息
- ✅ **操作确认**: 重要操作需二次确认
- ✅ **成功反馈**: 操作成功显示成功提示
- ✅ **快捷键**: 常用操作支持快捷键

### 4. 全局一致性

- ✅ **颜色规范**: 统一使用Ant Design颜色体系
- ✅ **图标规范**: 统一使用Ant Design Icons
- ✅ **字体规范**: 统一使用项目字体配置
- ✅ **布局规范**: 统一使用Ant Design Grid布局
- ✅ **组件复用**: 公共组件抽取到`components/visitor`

---

## 📅 实施时间表

| 阶段 | 任务 | 工期 | 产出物 |
|------|------|------|--------|
| **阶段1** | API接口完善+访客信息管理 | 3-4天 | 完整API文件、访客档案、黑名单页面 |
| **阶段2** | 预约管理模块 | 4-5天 | 预约列表、申请、审批、二维码页面 |
| **阶段3** | 登记管理模块 | 3-4天 | 签到、签出、在场监控页面 |
| **阶段4** | 身份验证组件 | 2-3天 | 人脸、二维码、证件识别组件 |
| **阶段5** | 物流管理模块 | 4-5天 | 预约、登记、出门单、记录页面 |
| **阶段6** | 通行记录+统计 | 5-6天 | 通行记录、异常管理、统计仪表板 |
| **阶段7** | 集成测试+优化 | 2-3天 | 功能测试、Bug修复、性能优化 |

**总计**: **23-30天**（约3-4周）

---

## 🎯 成功标准

### 功能完整性

- ✅ 7个子模块共20+页面全部实现
- ✅ 70+API接口100%对接
- ✅ 所有业务流程端到端打通
- ✅ 权限矩阵完全落地

### 代码质量

- ✅ 代码规范符合率100%
- ✅ 组件复用率>60%
- ✅ 无冗余代码
- ✅ ESlint零错误

### 用户体验

- ✅ 页面加载时间<2s
- ✅ 操作响应时间<500ms
- ✅ 移动端适配完成
- ✅ 浏览器兼容性测试通过

---

## 📌 下一步行动

立即开始**阶段1**：

1. ✅ 完善`visitor-pc-api.js`，补充所有70+接口
2. ✅ 实现`visitor-info.vue`访客信息管理页面
3. ✅ 实现`visitor-blacklist.vue`黑名单管理页面

**是否立即开始实施？**
