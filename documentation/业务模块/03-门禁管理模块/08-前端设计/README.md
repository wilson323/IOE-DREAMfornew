# é—¨ç¦ç®¡ç†æ¨¡å— - å‰ç«¯è®¾è®¡

## 1. ç§»åŠ¨ç«¯è®¾è®¡æ¦‚è¿°

åŸºäºç°æœ‰ç§»åŠ¨ç«¯ä»£ç åˆ†æï¼ˆ`smart-app/src/pages/access/`ï¼‰ï¼Œé—¨ç¦ç®¡ç†æ¨¡å—çš„ç§»åŠ¨ç«¯è®¾è®¡éµå¾ª IOE-DREAM æ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°çš„ç»Ÿä¸€è§„èŒƒã€‚

### 1.1 è®¾è®¡åŸåˆ™

- **åœºæ™¯é©±åŠ¨**: ç§»åŠ¨ç«¯èšç„¦é—¨ç¦é«˜é¢‘ä½¿ç”¨åœºæ™¯ï¼Œéå…¨åŠŸèƒ½å¤åˆ»
- **å®‰å…¨ä¼˜å…ˆ**: æ•æ„Ÿæƒé™æ“ä½œéœ€å¤šå› å­éªŒè¯
- **å®æ—¶æ€§**: é—¨ç¦çŠ¶æ€ã€å‘Šè­¦ä¿¡æ¯å®æ—¶æ¨é€
- **ç¦»çº¿æ”¯æŒ**: NFC/è“ç‰™å¼€é—¨æ”¯æŒç¦»çº¿æ“ä½œ

## 2. æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vue 3.x | 3.4+ | æ ¸å¿ƒæ¡†æ¶ |
| Uni-app | 3.0+ | è·¨å¹³å°å¼€å‘ |
| Pinia | 2.x | çŠ¶æ€ç®¡ç† |
| uni-ui | 1.5+ | UIç»„ä»¶åº“ |
| WebSocket | - | å®æ—¶é€šä¿¡ |

## 3. ç§»åŠ¨ç«¯åŠŸèƒ½èŒƒå›´

### 3.1 ç§»åŠ¨ç«¯å®ç°åŠŸèƒ½ï¼ˆåŸºäºä¸šåŠ¡åœºæ™¯ï¼‰

| åŠŸèƒ½æ¨¡å— | ç§»åŠ¨ç«¯å®ç° | ä¼˜å…ˆçº§ | ä¸šåŠ¡åœºæ™¯è¯´æ˜ |
|---------|-----------|--------|-------------|
| é—¨ç¦é¦–é¡µ | âœ… | P0 | é—¨ç¦å…¥å£ï¼ŒçŠ¶æ€æ¦‚è§ˆ |
| æ‰‹æœºå¼€é—¨ | âœ… | P0 | è“ç‰™/NFC/äºŒç»´ç å¼€é—¨ |
| å¼€é—¨è®°å½• | âœ… | P1 | æŸ¥çœ‹ä¸ªäººé€šè¡Œè®°å½• |
| é—¨ç¦çŠ¶æ€ | âœ… | P1 | æŸ¥çœ‹é—¨ç¦å®æ—¶çŠ¶æ€ |
| å‘Šè­¦æ¨é€ | âœ… | P0 | é—¨ç¦å¼‚å¸¸å‘Šè­¦æ¥æ”¶ |
| ä¸´æ—¶æˆæƒ | âœ… | P1 | è®¿å®¢ä¸´æ—¶é€šè¡Œæˆæƒ |
| æƒé™ç”³è¯· | âœ… | P2 | ç”³è¯·é—¨ç¦æƒé™ |
| äººè„¸å½•å…¥ | âœ… | P1 | å½•å…¥äººè„¸ç‰¹å¾ |

### 3.2 ä»…PCç«¯å®ç°åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | åŸå› è¯´æ˜ |
|---------|---------|
| è®¾å¤‡ç®¡ç† | éœ€è¦å¤æ‚é…ç½®ï¼Œç®¡ç†å‘˜åŠŸèƒ½ |
| åŒºåŸŸæƒé™é…ç½® | æƒé™çŸ©é˜µé…ç½®ï¼Œæ“ä½œå¤æ‚ |
| æ—¶é—´è®¡åˆ’é…ç½® | éœ€è¦è¯¦ç»†æ—¶é—´æ®µè®¾ç½® |
| æ‰¹é‡æˆæƒ | æ‰¹é‡æ“ä½œï¼ŒPCæ•ˆç‡é«˜ |
| ç»Ÿè®¡æŠ¥è¡¨ | å›¾è¡¨å±•ç¤ºï¼ŒPCä½“éªŒæ›´ä½³ |
| ç³»ç»Ÿé…ç½® | ç®¡ç†å‘˜ä¸“ç”¨ï¼Œå®‰å…¨è€ƒè™‘ |
| é—¨ç¦è”åŠ¨é…ç½® | å¤æ‚è§„åˆ™é…ç½® |
| å®¡æ‰¹æµç¨‹é…ç½® | æµç¨‹è®¾è®¡ï¼ŒPCæ›´ä¾¿æ· |

## 4. æ ¸å¿ƒé¡µé¢è®¾è®¡

### 4.1 é—¨ç¦é¦–é¡µ (`access/index.vue`)

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         çŠ¶æ€æ  + å¯¼èˆªæ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     é—¨ç¦ç»Ÿè®¡å¡ç‰‡         â”‚   â”‚
â”‚  â”‚  å¯é€šè¡Œé—¨ | ä»Šæ—¥é€šè¡Œ | å¼‚å¸¸ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¿«æ·æ“ä½œåŒºåŸŸ                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚
â”‚  â”‚å¼€é—¨ â”‚ â”‚è®°å½• â”‚ â”‚æƒé™ â”‚ â”‚äººè„¸ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆ‘çš„é—¨ç¦åˆ—è¡¨                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸšª 1å·æ¥¼å¤§é—¨      [å¼€é—¨] â”‚   â”‚
â”‚  â”‚   çŠ¶æ€ï¼šåœ¨çº¿  æœ€è¿‘ï¼š10:30  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸšª åŠå…¬å®¤é—¨        [å¼€é—¨] â”‚   â”‚
â”‚  â”‚   çŠ¶æ€ï¼šåœ¨çº¿  æœ€è¿‘ï¼š09:15  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½**:
- é—¨ç¦ç»Ÿè®¡å±•ç¤ºï¼ˆå¯é€šè¡Œé—¨æ•°ã€ä»Šæ—¥é€šè¡Œæ¬¡æ•°ã€å¼‚å¸¸æ¬¡æ•°ï¼‰
- å¿«æ·æ“ä½œå…¥å£ï¼ˆæ‰‹æœºå¼€é—¨ã€é€šè¡Œè®°å½•ã€æˆ‘çš„æƒé™ã€äººè„¸å½•å…¥ï¼‰
- æˆ‘çš„é—¨ç¦åˆ—è¡¨ï¼ˆæœ‰æƒé™çš„é—¨ç¦ç‚¹ï¼‰
- ä¸€é”®å¼€é—¨åŠŸèƒ½

### 4.2 æ‰‹æœºå¼€é—¨é¡µé¢ (`access/unlock.vue`)

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¯¼èˆªæ ï¼šæ‰‹æœºå¼€é—¨         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚     ğŸ”“ æ»‘åŠ¨å¼€é—¨         â”‚   â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚  â”‚    â—‰â”â”â”â”â”â”â”â”â”â”â”â”â”â–¶     â”‚   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¼€é—¨æ–¹å¼é€‰æ‹©                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ è“ç‰™å¼€é—¨ â”‚ â”‚ NFCå¼€é—¨ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ äºŒç»´ç   â”‚ â”‚ äººè„¸è¯†åˆ«â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é™„è¿‘é—¨ç¦                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸšª 1å·æ¥¼å¤§é—¨    è·ç¦»: 5m  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸšª åŠå…¬å®¤é—¨     è·ç¦»: 12m â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½**:
- æ»‘åŠ¨å¼€é—¨æ‰‹åŠ¿
- å¤šç§å¼€é—¨æ–¹å¼ï¼ˆè“ç‰™/NFC/äºŒç»´ç /äººè„¸ï¼‰
- åŸºäºä½ç½®çš„é—¨ç¦å‘ç°
- å¼€é—¨ç»“æœåé¦ˆï¼ˆéœ‡åŠ¨+å£°éŸ³ï¼‰

### 4.3 é€šè¡Œè®°å½•é¡µé¢ (`access/records.vue`)

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¯¼èˆªæ ï¼šé€šè¡Œè®°å½•         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´ç­›é€‰ï¼šä»Šå¤© | æœ¬å‘¨ | æœ¬æœˆ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è®°å½•åˆ—è¡¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1å·æ¥¼å¤§é—¨                â”‚   â”‚
â”‚  â”‚ âœ… æ­£å¸¸é€šè¡Œ              â”‚   â”‚
â”‚  â”‚ 2024-01-15 10:30:25     â”‚   â”‚
â”‚  â”‚ å¼€é—¨æ–¹å¼ï¼šæ‰‹æœºè“ç‰™        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åŠå…¬å®¤é—¨                  â”‚   â”‚
â”‚  â”‚ âš ï¸ æƒé™ä¸è¶³              â”‚   â”‚
â”‚  â”‚ 2024-01-15 09:15:30     â”‚   â”‚
â”‚  â”‚ å¼€é—¨æ–¹å¼ï¼šäººè„¸è¯†åˆ«        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            åŠ è½½æ›´å¤š...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 ä¸´æ—¶æˆæƒé¡µé¢ (`access/temp-auth.vue`)

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¯¼èˆªæ ï¼šä¸´æ—¶æˆæƒ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆæƒä¿¡æ¯                        â”‚
â”‚  è¢«æˆæƒäºº: [____________]       â”‚
â”‚  æ‰‹æœºå·:   [____________]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©é—¨ç¦                        â”‚
â”‚  â˜‘ 1å·æ¥¼å¤§é—¨                    â”‚
â”‚  â˜ 2å·æ¥¼å¤§é—¨                    â”‚
â”‚  â˜‘ åŠå…¬å®¤é—¨                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ‰æ•ˆæ—¶é—´                        â”‚
â”‚  å¼€å§‹: [2024-01-15 10:00]      â”‚
â”‚  ç»“æŸ: [2024-01-15 18:00]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¼€é—¨æ¬¡æ•°: [1æ¬¡ â–¼]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [ ç¡®è®¤æˆæƒ ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. APIæ¥å£è®¾è®¡

### 5.1 æ¥å£å‰ç¼€
```
/api/v1/mobile/access/
```

### 5.2 æ ¸å¿ƒæ¥å£åˆ—è¡¨

| æ¨¡å— | æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|------|
| **é—¨ç¦æ“ä½œ** | `/unlock` | POST | è¿œç¨‹å¼€é—¨ |
| | `/unlock/bluetooth` | POST | è“ç‰™å¼€é—¨ |
| | `/unlock/nfc` | POST | NFCå¼€é—¨ |
| | `/unlock/qrcode` | POST | äºŒç»´ç å¼€é—¨ |
| | `/unlock/face` | POST | äººè„¸å¼€é—¨ |
| **çŠ¶æ€æŸ¥è¯¢** | `/doors` | GET | æˆ‘çš„é—¨ç¦åˆ—è¡¨ |
| | `/doors/{id}/status` | GET | é—¨ç¦çŠ¶æ€ |
| | `/doors/nearby` | GET | é™„è¿‘é—¨ç¦ |
| **è®°å½•æŸ¥è¯¢** | `/records` | GET | é€šè¡Œè®°å½• |
| | `/records/{id}` | GET | è®°å½•è¯¦æƒ… |
| **æƒé™ç®¡ç†** | `/permissions` | GET | æˆ‘çš„æƒé™ |
| | `/permissions/apply` | POST | ç”³è¯·æƒé™ |
| | `/temp-auth` | POST | ä¸´æ—¶æˆæƒ |
| | `/temp-auth/list` | GET | æˆæƒè®°å½• |
| **äººè„¸ç®¡ç†** | `/face/upload` | POST | ä¸Šä¼ äººè„¸ |
| | `/face/status` | GET | äººè„¸çŠ¶æ€ |
| **ç»Ÿè®¡** | `/statistics` | GET | é—¨ç¦ç»Ÿè®¡ |

### 5.3 WebSocketäº‹ä»¶

| äº‹ä»¶ç±»å‹ | è¯´æ˜ |
|---------|------|
| `door_status` | é—¨ç¦çŠ¶æ€å˜æ›´ |
| `access_alert` | é—¨ç¦å‘Šè­¦ |
| `unlock_result` | å¼€é—¨ç»“æœ |
| `auth_update` | æƒé™å˜æ›´ |

## 6. çŠ¶æ€ç®¡ç†

### 6.1 Pinia Store ç»“æ„

```javascript
// store/modules/access.js
export const useAccessStore = defineStore('access', {
  state: () => ({
    doors: [],              // é—¨ç¦åˆ—è¡¨
    currentDoor: null,      // å½“å‰é—¨ç¦
    records: [],            // é€šè¡Œè®°å½•
    permissions: [],        // æƒé™åˆ—è¡¨
    statistics: {           // ç»Ÿè®¡æ•°æ®
      accessibleCount: 0,
      todayCount: 0,
      alertCount: 0
    },
    nearbyDoors: [],        // é™„è¿‘é—¨ç¦
    bluetoothConnected: false, // è“ç‰™çŠ¶æ€
    nfcEnabled: false       // NFCçŠ¶æ€
  }),
  
  actions: {
    async loadDoors() { ... },
    async unlockDoor(doorId, method) { ... },
    async loadRecords(params) { ... },
    async applyPermission(data) { ... },
    async createTempAuth(data) { ... },
    connectBluetooth(doorId) { ... },
    scanNFC() { ... }
  }
})
```

## 7. åŸç”Ÿèƒ½åŠ›é›†æˆ

### 7.1 è“ç‰™å¼€é—¨

```javascript
// è“ç‰™å¼€é—¨æµç¨‹
const bluetoothUnlock = async (doorId) => {
  // 1. æ£€æŸ¥è“ç‰™æƒé™
  const btEnabled = await checkBluetoothPermission()
  if (!btEnabled) {
    uni.showModal({ title: 'æç¤º', content: 'è¯·å¼€å¯è“ç‰™' })
    return
  }
  
  // 2. æ‰«æé™„è¿‘è®¾å¤‡
  const devices = await scanBluetoothDevices()
  const targetDevice = devices.find(d => d.doorId === doorId)
  
  // 3. è¿æ¥å¹¶å‘é€å¼€é—¨æŒ‡ä»¤
  await connectAndUnlock(targetDevice)
}
```

### 7.2 NFCå¼€é—¨

```javascript
// NFCå¼€é—¨æµç¨‹
const nfcUnlock = async () => {
  // 1. æ£€æŸ¥NFCæ”¯æŒ
  const nfcSupported = await checkNFCSupport()
  if (!nfcSupported) {
    uni.showToast({ title: 'è®¾å¤‡ä¸æ”¯æŒNFC', icon: 'none' })
    return
  }
  
  // 2. å¯åŠ¨NFCè¯»å–
  await startNFCReading()
  
  // 3. è¯»å–é—¨ç¦æ ‡ç­¾å¹¶éªŒè¯
  // ...
}
```

### 7.3 äººè„¸å¼€é—¨

```javascript
// äººè„¸å¼€é—¨æµç¨‹
const faceUnlock = async (doorId) => {
  // 1. å¯åŠ¨ç›¸æœº
  const imageData = await captureImage()
  
  // 2. æœ¬åœ°æ´»ä½“æ£€æµ‹
  const isLive = await livenessDetection(imageData)
  if (!isLive) {
    uni.showToast({ title: 'æ´»ä½“æ£€æµ‹å¤±è´¥', icon: 'none' })
    return
  }
  
  // 3. ä¸Šä¼ äººè„¸å¹¶å¼€é—¨
  const result = await accessApi.faceUnlock(doorId, imageData)
  handleUnlockResult(result)
}
```

## 8. äº¤äº’è§„èŒƒ

### 8.1 å¼€é—¨åé¦ˆ

```javascript
// å¼€é—¨æˆåŠŸåé¦ˆ
const onUnlockSuccess = () => {
  // éœ‡åŠ¨åé¦ˆ
  uni.vibrateShort({ type: 'heavy' })
  
  // å£°éŸ³æç¤º
  const audio = uni.createInnerAudioContext()
  audio.src = '/static/audio/unlock-success.mp3'
  audio.play()
  
  // è§†è§‰åé¦ˆ
  uni.showToast({ title: 'å¼€é—¨æˆåŠŸ', icon: 'success' })
}

// å¼€é—¨å¤±è´¥åé¦ˆ
const onUnlockFailed = (reason) => {
  uni.vibrateShort({ type: 'medium' })
  uni.showModal({
    title: 'å¼€é—¨å¤±è´¥',
    content: reason,
    showCancel: false
  })
}
```

### 8.2 å‘Šè­¦æ¨é€å¤„ç†

```javascript
// WebSocketå‘Šè­¦å¤„ç†
wsClient.on('access_alert', (alert) => {
  // 1. æœ¬åœ°é€šçŸ¥
  uni.createPushMessage({
    title: 'é—¨ç¦å‘Šè­¦',
    content: alert.message,
    payload: { alertId: alert.id }
  })
  
  // 2. éœ‡åŠ¨æé†’
  uni.vibrateLong()
  
  // 3. æ›´æ–°çŠ¶æ€
  accessStore.addAlert(alert)
})
```

## 9. æ ·å¼è§„èŒƒ

### 9.1 é—¨ç¦çŠ¶æ€è‰²

```scss
// é—¨ç¦çŠ¶æ€
$door-online: #52c41a;    // åœ¨çº¿
$door-offline: #d9d9d9;   // ç¦»çº¿
$door-alarm: #ff4d4f;     // å‘Šè­¦
$door-locked: #1890ff;    // é”å®š

// é€šè¡Œç»“æœ
$access-success: #52c41a; // é€šè¡ŒæˆåŠŸ
$access-denied: #ff4d4f;  // æ‹’ç»é€šè¡Œ
$access-timeout: #faad14; // è¶…æ—¶
```

### 9.2 å¼€é—¨æŒ‰é’®æ ·å¼

```scss
.unlock-btn {
  width: 200rpx;
  height: 200rpx;
  border-radius: 50%;
  background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
  box-shadow: 0 8rpx 24rpx rgba(24, 144, 255, 0.4);
  
  &:active {
    transform: scale(0.95);
    box-shadow: 0 4rpx 12rpx rgba(24, 144, 255, 0.3);
  }
  
  &.disabled {
    background: #d9d9d9;
    box-shadow: none;
  }
}
```

## 10. é¡µé¢è·¯ç”±é…ç½®

```json
// pages.json
{
  "pages": [
    {
      "path": "pages/access/index",
      "style": { "navigationBarTitleText": "é—¨ç¦ç®¡ç†" }
    },
    {
      "path": "pages/access/unlock",
      "style": { "navigationBarTitleText": "æ‰‹æœºå¼€é—¨" }
    },
    {
      "path": "pages/access/records",
      "style": { "navigationBarTitleText": "é€šè¡Œè®°å½•" }
    },
    {
      "path": "pages/access/permissions",
      "style": { "navigationBarTitleText": "æˆ‘çš„æƒé™" }
    },
    {
      "path": "pages/access/temp-auth",
      "style": { "navigationBarTitleText": "ä¸´æ—¶æˆæƒ" }
    },
    {
      "path": "pages/access/apply",
      "style": { "navigationBarTitleText": "æƒé™ç”³è¯·" }
    },
    {
      "path": "pages/access/face",
      "style": { "navigationBarTitleText": "äººè„¸å½•å…¥" }
    },
    {
      "path": "pages/access/door-detail",
      "style": { "navigationBarTitleText": "é—¨ç¦è¯¦æƒ…" }
    }
  ]
}
```

## 11. æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | è¦æ±‚ |
|------|------|
| é¦–å±åŠ è½½ | < 2ç§’ |
| è“ç‰™å¼€é—¨å“åº” | < 2ç§’ |
| NFCå¼€é—¨å“åº” | < 1ç§’ |
| äºŒç»´ç å¼€é—¨å“åº” | < 3ç§’ |
| äººè„¸å¼€é—¨å“åº” | < 3ç§’ |
| å‘Šè­¦æ¨é€å»¶è¿Ÿ | < 1ç§’ |
| å†…å­˜å ç”¨ | < 150MB |

## 12. æƒé™è¦æ±‚

| æƒé™ | ç”¨é€” |
|------|------|
| è“ç‰™ | è“ç‰™å¼€é—¨ |
| NFC | NFCå¼€é—¨ |
| ç›¸æœº | äººè„¸è¯†åˆ« |
| å®šä½ | é™„è¿‘é—¨ç¦å‘ç° |
| é€šçŸ¥ | å‘Šè­¦æ¨é€ |
| éœ‡åŠ¨ | æ“ä½œåé¦ˆ |

## 13. æ–‡æ¡£ç‰ˆæœ¬

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| v1.0.0 | 2025-12-17 | åˆå§‹ç‰ˆæœ¬ |
