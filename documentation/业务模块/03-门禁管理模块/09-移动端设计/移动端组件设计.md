# 门禁模块移动端组件设计

> **版本**: v1.0.0  
> **创建日期**: 2025-12-17  
> **适用范围**: IOE-DREAM智慧园区门禁移动端

---

## 📱 技术栈选择

| 技术 | 选型 | 说明 |
|------|------|------|
| 前端框架 | Vue 3 + TypeScript | 现代化响应式框架 |
| 移动端框架 | uni-app + Vant 4 | 跨平台支持 |
| 状态管理 | Pinia | Vue 3官方推荐 |
| 路由管理 | Vue Router 4 | SPA路由 |
| HTTP客户端 | Axios | 请求封装 |
| WebSocket | Socket.io-client | 实时通信 |
| 构建工具 | Vite | 快速构建 |

---

## 📁 项目结构

```
smart-app/src/pages/access/
├── area.vue        # 区域管理 - 查看有权限的区域列表
├── device.vue      # 设备管理 - 查看设备状态、远程控制
├── monitor.vue     # 实时监控 - 设备状态统计、实时事件
├── permission.vue  # 权限管理 - 查看个人权限
└── record.vue      # 通行记录 - 查看通行历史、筛选统计
```

---

## 🎯 核心页面组件

### 1. 实时监控页面 (monitor.vue)

```vue
<template>
  <div class="access-monitor">
    <!-- 顶部状态栏 -->
    <van-nav-bar title="门禁监控" :fixed="true">
      <template #right>
        <van-icon name="bell" @click="showAlerts" :badge="alertCount" />
      </template>
    </van-nav-bar>

    <!-- 设备状态概览 -->
    <div class="status-overview">
      <van-grid :column-num="2" :gutter="10">
        <van-grid-item v-for="item in statusData" :key="item.type">
          <div class="status-item">
            <div class="status-icon" :class="item.type">
              <van-icon :name="item.icon" />
            </div>
            <div class="status-info">
              <div class="status-value">{{ item.value }}</div>
              <div class="status-label">{{ item.label }}</div>
            </div>
          </div>
        </van-grid-item>
      </van-grid>
    </div>

    <!-- 实时监控列表 -->
    <van-list v-model:loading="loading" :finished="finished" @load="onLoad">
      <van-cell
        v-for="device in devices"
        :key="device.deviceId"
        :title="device.deviceName"
        :label="device.status"
        @click="showDeviceDetail(device)"
      >
        <template #extra>
          <van-tag :type="device.statusType" size="small">
            {{ device.statusText }}
          </van-tag>
        </template>
      </van-cell>
    </van-list>

    <!-- 快捷操作 -->
    <div class="quick-actions">
      <van-grid :column-num="4" :gutter="10">
        <van-grid-item
          v-for="action in quickActions"
          :key="action.type"
          :icon="action.icon"
          :text="action.text"
          @click="handleQuickAction(action)"
        />
      </van-grid>
    </div>
  </div>
</template>
```

**核心功能**:
- 实时状态监控：显示设备在线状态和访问统计
- 快捷操作：一键开锁、重启设备
- 告警提醒：实时推送告警信息
- 设备定位：地图显示设备位置

### 2. 设备管理页面 (device.vue)

```vue
<template>
  <div class="device-manage">
    <van-nav-bar title="设备管理" :fixed="true" />

    <!-- 搜索筛选 -->
    <van-search v-model="searchKeyword" placeholder="搜索设备" @search="handleSearch" />
    <van-dropdown-menu>
      <van-dropdown-item v-model="filterType" :options="deviceTypes" />
      <van-dropdown-item v-model="filterStatus" :options="deviceStatuses" />
    </van-dropdown-menu>

    <!-- 设备列表 -->
    <van-list v-model:loading="loading" :finished="finished" @load="onLoad">
      <device-card
        v-for="device in devices"
        :key="device.deviceId"
        :device="device"
        @control="handleDeviceControl"
        @detail="showDeviceDetail"
      />
    </van-list>
  </div>
</template>
```

### 3. 通行记录页面 (record.vue)

```vue
<template>
  <div class="access-records">
    <!-- 筛选区域 -->
    <van-dropdown-menu>
      <van-dropdown-item v-model="filterDateRange" :options="dateRangeOptions" />
      <van-dropdown-item v-model="filterResult" :options="resultOptions" />
    </van-dropdown-menu>

    <!-- 统计卡片 -->
    <div class="stats-card">
      <div class="stat-item">
        <span class="stat-value">{{ todayCount }}</span>
        <span class="stat-label">今日通行</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ successRate }}%</span>
        <span class="stat-label">成功率</span>
      </div>
    </div>

    <!-- 记录列表 -->
    <van-list v-model:loading="loading" :finished="finished" @load="onLoad">
      <access-record-item
        v-for="record in records"
        :key="record.eventId"
        :record="record"
        @click="showRecordDetail(record)"
      />
    </van-list>
  </div>
</template>
```

---

## 🔔 WebSocket实时通信

```typescript
// src/services/websocket.ts
export class WebSocketService {
  private ws: WebSocket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;

  connect() {
    this.ws = new WebSocket('ws://api.ioedream.com/access/v1/ws');
    
    this.ws.onopen = () => {
      this.reconnectAttempts = 0;
      this.subscribe(['device-status', 'access-events', 'alerts']);
    };

    this.ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      switch (data.type) {
        case 'DEVICE_STATUS':
          store.dispatch('access/updateDeviceStatus', data.data);
          break;
        case 'ACCESS_EVENT':
          store.dispatch('access/addAccessEvent', data.data);
          break;
        case 'ALERT':
          store.dispatch('access/addAlert', data.data);
          break;
      }
    };

    this.ws.onclose = () => this.reconnect();
  }

  subscribe(channels: string[]) {
    this.send({ type: 'SUBSCRIBE', channels });
  }

  reconnect() {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      setTimeout(() => {
        this.reconnectAttempts++;
        this.connect();
      }, 3000 * this.reconnectAttempts);
    }
  }
}
```

---

## 🎨 UI设计规范

### 颜色规范

```scss
// 状态颜色
$color-online: #52c41a;   // 在线/成功
$color-offline: #ff4d4f;  // 离线/失败
$color-warning: #faad14;  // 警告/异常
$color-primary: #667eea;  // 主色调

// 主题渐变
$gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
```

### 设计原则

1. **简洁高效**: 单手操作、快速完成
2. **状态清晰**: 颜色区分在线/离线/异常
3. **信息层级**: 重要信息突出显示
4. **操作反馈**: 及时的操作成功/失败提示

---

## 📊 性能优化

### 数据加载策略

| 策略 | 说明 |
|------|------|
| 分页加载 | 通行记录分页，每页20条 |
| 下拉刷新 | 支持手动刷新数据 |
| 上拉加载 | 滚动到底自动加载更多 |
| 缓存策略 | 设备列表、区域列表本地缓存 |

### 图片优化

- 使用van-image懒加载
- 缩略图展示，点击查看大图
- 加载失败显示占位图

### 网络优化

- WebSocket断线自动重连
- 请求超时30秒自动重试
- 离线状态提示

---

## 📱 移动端专用组件

### 指纹识别组件

```vue
<template>
  <div class="fingerprint-auth">
    <div class="scanner-ring" :class="{ active: isScanning }">
      <van-icon name="finger-print" />
    </div>
    <div class="scanner-text">{{ scanText }}</div>
    <van-button @click="startScan">开始扫描</van-button>
  </div>
</template>
```

### 人脸识别组件

```vue
<template>
  <div class="face-recognition">
    <div class="camera-view">
      <video ref="camera" autoplay muted playsinline />
      <div class="face-frame">
        <div class="frame-corner top-left"></div>
        <div class="frame-corner top-right"></div>
        <div class="frame-corner bottom-left"></div>
        <div class="frame-corner bottom-right"></div>
      </div>
    </div>
    <div class="recognition-status">{{ statusText }}</div>
  </div>
</template>
```

### 二维码扫描组件

```vue
<template>
  <div class="qr-scanner">
    <div class="scanner-view">
      <video ref="scanner" autoplay muted />
    </div>
    <div class="scanner-tips">
      <p>请将二维码对准扫描框</p>
    </div>
  </div>
</template>
```

---

## ✅ 验收标准

### 功能验收
- [ ] 区域列表正常加载和显示
- [ ] 设备状态正确显示(在线/离线)
- [ ] 远程开锁功能正常
- [ ] 通行记录筛选和分页正常
- [ ] 实时监控数据自动刷新
- [ ] 推送通知正常接收

### 性能验收
- [ ] 首屏加载时间 < 3秒
- [ ] 列表滚动流畅无卡顿
- [ ] WebSocket消息延迟 < 5秒

### 兼容性验收
- [ ] iOS 12+ 正常运行
- [ ] Android 8+ 正常运行
- [ ] 微信小程序正常运行

---

**📝 文档维护**
- **创建人**: IOE-DREAM架构团队
- **最后更新**: 2025-12-17
