# é«˜çº§åŠŸèƒ½ç®¡ç† - è¯¦ç»†è®¾è®¡è¯´æ˜ä¹¦

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“ ç±»ç»“æ„è®¾è®¡

```
net.lab1024.sa.access/
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ AntiPassbackController.java
â”‚   â””â”€â”€ AccessAdvancedController.java
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ AntiPassbackService.java
â”‚   â”œâ”€â”€ AdvancedAccessControlService.java
â”‚   â””â”€â”€ impl/
â”‚       â”œâ”€â”€ AntiPassbackServiceImpl.java
â”‚       â””â”€â”€ AdvancedAccessControlServiceImpl.java
â”œâ”€â”€ manager/
â”‚   â””â”€â”€ AntiPassbackManager.java
â””â”€â”€ domain/
    â””â”€â”€ vo/
        â””â”€â”€ AntiPassbackStatisticsVO.java
```

---

## ğŸ”Œ æ¥å£è¯¦ç»†è®¾è®¡

### GET /api/access/v1/antipassback/statistics

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "totalRules": 15,
    "activeRules": 12,
    "todayViolations": 5,
    "weekViolations": 23,
    "violations": [{
      "id": 1001,
      "userId": 2001,
      "userName": "å¼ ä¸‰",
      "areaName": "æ•°æ®ä¸­å¿ƒ",
      "violationType": "REPEAT_ENTRY",
      "violationTime": "2025-12-17T10:30:00Z"
    }]
  }
}
```

---

## ğŸ“Š Redisæ•°æ®ç»“æ„

### ç”¨æˆ·ä½ç½®ç¼“å­˜
```
Key: access:user:location:{userId}
Value: {areaId}
TTL: 24h
```

### åŒºåŸŸäººæ•°ç¼“å­˜
```
Key: access:area:count:{areaId}
Value: {count}
Type: String (æ”¯æŒINCR/DECR)
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

```sql
CREATE TABLE t_anti_passback_rule (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  area_id BIGINT NOT NULL,
  rule_type VARCHAR(30) NOT NULL,
  timeout_minutes INT DEFAULT 0,
  enabled TINYINT DEFAULT 1,
  create_time DATETIME NOT NULL,
  update_time DATETIME NOT NULL,
  INDEX idx_area(area_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE t_anti_passback_log (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  rule_id BIGINT NOT NULL,
  user_id BIGINT NOT NULL,
  violation_type VARCHAR(30) NOT NULL,
  violation_time DATETIME NOT NULL,
  device_id BIGINT,
  INDEX idx_rule(rule_id),
  INDEX idx_user(user_id),
  INDEX idx_time(violation_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
