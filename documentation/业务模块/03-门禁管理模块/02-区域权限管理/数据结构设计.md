# 02-åŒºåŸŸæƒé™ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **æ¨¡å—ç¼–å·**: 02
> **æ¨¡å—åç§°**: åŒºåŸŸæƒé™ç®¡ç†
> **æ–‡æ¡£ç±»å‹**: æ•°æ®ç»“æ„è®¾è®¡ER
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17
> **æŠ€æœ¯è§„èŒƒ**: IOE-DREAMå…¨å±€æ¶æ„è§„èŒƒ

---

## ğŸ“‹ æ•°æ®åº“è®¾è®¡æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºIOE-DREAMå…¨å±€æ•°æ®åº“æ¶æ„è§„èŒƒï¼Œè®¾è®¡åŒºåŸŸæƒé™ç®¡ç†æ¨¡å—çš„æ•°æ®ç»“æ„ã€‚éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

### è®¾è®¡åŸåˆ™

1. **å±‚çº§åŒ–è®¾è®¡**: æ”¯æŒæ— é™å±‚çº§çš„åŒºåŸŸæ ‘å½¢ç»“æ„
2. **æƒé™åˆ†ç¦»**: æƒé™æ•°æ®ä¸åŒºåŸŸæ•°æ®åˆ†ç¦»å­˜å‚¨
3. **ç»§æ‰¿ä¼˜åŒ–**: ä¼˜åŒ–æƒé™ç»§æ‰¿å…³ç³»çš„å­˜å‚¨å’ŒæŸ¥è¯¢
4. **å®¡è®¡å®Œæ•´**: å®Œæ•´è®°å½•æƒé™æ“ä½œå’ŒéªŒè¯æ—¥å¿—
5. **æ€§èƒ½ä¼˜å…ˆ**: ä¼˜åŒ–æƒé™æŸ¥è¯¢å’ŒéªŒè¯æ€§èƒ½

### æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: MySQL 8.0
- **ORMæ¡†æ¶**: MyBatis-Plus 3.5.15
- **è¿æ¥æ± **: Druid
- **ç¼“å­˜**: Rediså¤šçº§ç¼“å­˜
- **æ•°æ®è¿ç§»**: Flyway

---

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

### 1. åŒºåŸŸä¿¡æ¯è¡¨ (t_access_area)

å­˜å‚¨åŒºåŸŸçš„å±‚çº§ç»“æ„å’ŒåŸºç¡€ä¿¡æ¯ã€‚

```sql
CREATE TABLE t_access_area (
    -- ä¸»é”®å­—æ®µ
    area_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'åŒºåŸŸID',

    -- åŸºç¡€ä¿¡æ¯
    area_code VARCHAR(64) NOT NULL UNIQUE COMMENT 'åŒºåŸŸç¼–ç ',
    area_name VARCHAR(200) NOT NULL COMMENT 'åŒºåŸŸåç§°',
    area_type TINYINT NOT NULL COMMENT 'åŒºåŸŸç±»å‹: 1-å›­åŒº 2-æ¥¼å®‡ 3-æ¥¼å±‚ 4-åŒºåŸŸ 5-æˆ¿é—´ 6-é—¨ç¦ç‚¹',
    parent_area_id BIGINT DEFAULT 0 COMMENT 'çˆ¶çº§åŒºåŸŸID',
    area_level INT NOT NULL DEFAULT 1 COMMENT 'å±‚çº§æ·±åº¦',
    sort_order INT DEFAULT 0 COMMENT 'æ’åºå·',
    area_path VARCHAR(1000) DEFAULT NULL COMMENT 'åŒºåŸŸè·¯å¾„(é€—å·åˆ†éš”IDåºåˆ—)',

    -- ä½ç½®ä¿¡æ¯
    building_name VARCHAR(100) DEFAULT NULL COMMENT 'æ¥¼æ ‹åç§°',
    floor_number INT DEFAULT NULL COMMENT 'æ¥¼å±‚å·',
    room_number VARCHAR(50) DEFAULT NULL COMMENT 'æˆ¿é—´å·',
    address VARCHAR(500) DEFAULT NULL COMMENT 'è¯¦ç»†åœ°å€',
    longitude DECIMAL(10,6) DEFAULT NULL COMMENT 'ç»åº¦',
    latitude DECIMAL(10,6) DEFAULT NULL COMMENT 'çº¬åº¦',

    -- åŒºåŸŸå±æ€§
    security_level TINYINT DEFAULT 1 COMMENT 'å®‰å…¨ç­‰çº§: 1-ä½ 2-ä¸­ 3-é«˜ 4-å¾ˆé«˜ 5-æé«˜',
    access_level TINYINT DEFAULT 1 COMMENT 'è®¿é—®çº§åˆ«: 1-10',
    capacity_limit INT DEFAULT 0 COMMENT 'å®¹é‡é™åˆ¶',
    area_size DECIMAL(10,2) DEFAULT 0.00 COMMENT 'åŒºåŸŸé¢ç§¯(å¹³æ–¹ç±³)',
    door_count INT DEFAULT 0 COMMENT 'é—¨ç¦ç‚¹æ•°é‡',

    -- è¾¹ç•Œå®šä¹‰
    boundary_type TINYINT DEFAULT 0 COMMENT 'è¾¹ç•Œç±»å‹: 0-æ—  1-åœ°ç†å›´æ  2-ç½‘ç»œè¾¹ç•Œ 3-æ—¶é—´è¾¹ç•Œ',
    boundary_data JSON DEFAULT NULL COMMENT 'è¾¹ç•Œæ•°æ®(GeoJSONæ ¼å¼)',
    access_boundary JSON DEFAULT NULL COMMENT 'è®¿é—®è¾¹ç•Œå®šä¹‰',

    -- çŠ¶æ€ä¿¡æ¯
    area_status TINYINT DEFAULT 1 COMMENT 'åŒºåŸŸçŠ¶æ€: 0-åœç”¨ 1-æ­£å¸¸ 2-è£…ä¿® 3-å°é”',
    is_emergency_area TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç´§æ€¥åŒºåŸŸ: 0-å¦ 1-æ˜¯',
    is_public_area TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å…¬å…±åŒºåŸŸ: 0-å¦ 1-æ˜¯',
    is_sensitive_area TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ•æ„ŸåŒºåŸŸ: 0-å¦ 1-æ˜¯',

    -- ç®¡ç†ä¿¡æ¯
    responsible_user_id BIGINT DEFAULT NULL COMMENT 'è´Ÿè´£äººID',
    responsible_dept_id BIGINT DEFAULT NULL COMMENT 'è´Ÿè´£éƒ¨é—¨ID',
    security_user_id BIGINT DEFAULT NULL COMMENT 'å®‰å…¨ç®¡ç†å‘˜ID',
    create_user_id BIGINT DEFAULT NULL COMMENT 'åˆ›å»ºäººID',

    -- æ—¶é—´ä¿¡æ¯
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',

    -- ç´¢å¼•
    INDEX idx_area_code (area_code),
    INDEX idx_parent_area_id (parent_area_id),
    INDEX idx_area_type (area_type),
    INDEX idx_area_level (area_level),
    INDEX idx_area_status (area_status),
    INDEX idx_responsible_user (responsible_user_id),
    INDEX idx_security_level (security_level),
    INDEX idx_access_level (access_level),
    INDEX idx_sort_order (sort_order),
    INDEX idx_create_time (create_time),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (parent_area_id) REFERENCES t_area(area_id),
    FOREIGN KEY (responsible_user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (responsible_dept_id) REFERENCES t_department(department_id),
    FOREIGN KEY (security_user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (create_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒºåŸŸä¿¡æ¯è¡¨';
```

### 2. ç”¨æˆ·æƒé™è¡¨ (t_access_user_permission)

å­˜å‚¨ç”¨æˆ·çš„åŒºåŸŸæƒé™é…ç½®ã€‚

```sql
CREATE TABLE t_access_user_permission (
    -- ä¸»é”®å­—æ®µ
    permission_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æƒé™ID',

    -- ç”¨æˆ·å’ŒåŒºåŸŸå…³è”
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    area_id BIGINT NOT NULL COMMENT 'åŒºåŸŸID',

    -- æƒé™åŸºç¡€ä¿¡æ¯
    permission_type TINYINT NOT NULL COMMENT 'æƒé™ç±»å‹: 1-è®¿é—®æƒé™ 2-ç®¡ç†æƒé™ 3-ç›‘æ§æƒé™ 4-ç´§æ€¥æƒé™',
    access_level TINYINT DEFAULT 1 COMMENT 'è®¿é—®çº§åˆ«: 1-10',
    permission_level TINYINT DEFAULT 1 COMMENT 'æƒé™çº§åˆ«: 1-è¯»å†™ 2-åªè¯» 3-æ— æƒé™',

    -- æƒé™çŠ¶æ€
    permission_status TINYINT DEFAULT 1 COMMENT 'æƒé™çŠ¶æ€: 0-åœç”¨ 1-å¯ç”¨ 2-å¾…æ¿€æ´» 3-å·²è¿‡æœŸ',
    is_temporary TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ä¸´æ—¶æƒé™: 0-å¦ 1-æ˜¯',
    is_emergency TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç´§æ€¥æƒé™: 0-å¦ 1-æ˜¯',

    -- æ—¶é—´é™åˆ¶
    start_time DATETIME DEFAULT NULL COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¶é—´',
    end_time DATETIME DEFAULT NULL COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¶é—´',
    time_rule_id BIGINT DEFAULT NULL COMMENT 'æ—¶é—´è§„åˆ™ID',

    -- è®¤è¯è¦æ±‚
    require_card TINYINT DEFAULT 1 COMMENT 'è¦æ±‚å¡ç‰‡: 0-å¦ 1-æ˜¯',
    require_password TINYINT DEFAULT 0 COMMENT 'è¦æ±‚å¯†ç : 0-å¦ 1-æ˜¯',
    require_face TINYINT DEFAULT 0 COMMENT 'è¦æ±‚äººè„¸: 0-å¦ 1-æ˜¯',
    require_fingerprint TINYINT DEFAULT 0 COMMENT 'è¦æ±‚æŒ‡çº¹: 0-å¦ 1-æ˜¯',
    require_multi_factor TINYINT DEFAULT 0 COMMENT 'è¦æ±‚å¤šå› å­: 0-å¦ 1-æ˜¯',
    min_auth_factors INT DEFAULT 1 COMMENT 'æœ€å°‘è®¤è¯å› å­æ•°',

    -- è®¿é—®æ§åˆ¶
    max_daily_visits INT DEFAULT 0 COMMENT 'æ¯æ—¥æœ€å¤§è®¿é—®æ¬¡æ•°',
    max_concurrent_visits INT DEFAULT 1 COMMENT 'æœ€å¤§å¹¶å‘è®¿é—®æ¬¡æ•°',
    visit_interval INT DEFAULT 0 COMMENT 'è®¿é—®é—´éš”é™åˆ¶(ç§’)',
    blacklist_check TINYINT DEFAULT 1 COMMENT 'é»‘åå•æ£€æŸ¥: 0-å¦ 1-æ˜¯',

    -- ç»§æ‰¿è®¾ç½®
    inherit_to_children TINYINT DEFAULT 0 COMMENT 'ç»§æ‰¿åˆ°å­åŒºåŸŸ: 0-å¦ 1-æ˜¯',
    inherit_from_parent TINYINT DEFAULT 1 COMMENT 'ä»çˆ¶çº§ç»§æ‰¿: 0-å¦ 1-æ˜¯',
    inherit_priority INT DEFAULT 0 COMMENT 'ç»§æ‰¿ä¼˜å…ˆçº§',

    -- å®¡è®¡å­—æ®µ
    grant_user_id BIGINT DEFAULT NULL COMMENT 'æˆæƒäººID',
    grant_reason VARCHAR(500) DEFAULT NULL COMMENT 'æˆæƒåŸå› ',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    last_access_time DATETIME DEFAULT NULL COMMENT 'æœ€åè®¿é—®æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',

    -- ç´¢å¼•
    UNIQUE INDEX uk_user_area_permission (user_id, area_id, deleted_flag),
    INDEX idx_user_id (user_id),
    INDEX idx_area_id (area_id),
    INDEX idx_permission_type (permission_type),
    INDEX idx_permission_status (permission_status),
    INDEX idx_is_temporary (is_temporary),
    INDEX idx_is_emergency (is_emergency),
    INDEX idx_start_time (start_time),
    INDEX idx_end_time (end_time),
    INDEX idx_grant_user (grant_user_id),
    INDEX idx_last_access_time (last_access_time),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (area_id) REFERENCES t_access_area(area_id),
    FOREIGN KEY (time_rule_id) REFERENCES t_access_time_rule(time_rule_id),
    FOREIGN KEY (grant_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·æƒé™è¡¨';
```

### 3. è§’è‰²æƒé™è¡¨ (t_access_role_permission)

å­˜å‚¨è§’è‰²çš„æƒé™é…ç½®æ¨¡æ¿ã€‚

```sql
CREATE TABLE t_access_role_permission (
    -- ä¸»é”®å­—æ®µ
    role_permission_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§’è‰²æƒé™ID',

    -- è§’è‰²ä¿¡æ¯
    role_id BIGINT NOT NULL COMMENT 'è§’è‰²ID',
    role_type TINYINT NOT NULL COMMENT 'è§’è‰²ç±»å‹: 1-ç³»ç»Ÿè§’è‰² 2-éƒ¨é—¨è§’è‰² 3-é¡¹ç›®è§’è‰² 4-ä¸´æ—¶è§’è‰²',

    -- æƒé™é…ç½®æ¨¡å¼
    config_mode TINYINT DEFAULT 1 COMMENT 'é…ç½®æ¨¡å¼: 1-ç™½åå• 2-é»‘åå• 3-æ··åˆæ¨¡å¼',

    -- åŒºåŸŸæƒé™é…ç½®
    area_permission_config JSON NOT NULL COMMENT 'åŒºåŸŸæƒé™é…ç½®',
    area_pattern_rules JSON DEFAULT NULL COMMENT 'åŒºåŸŸæ¨¡å¼è§„åˆ™',

    -- æƒé™åŸºç¡€é…ç½®
    default_access_level TINYINT DEFAULT 1 COMMENT 'é»˜è®¤è®¿é—®çº§åˆ«',
    max_access_level TINYINT DEFAULT 5 COMMENT 'æœ€å¤§è®¿é—®çº§åˆ«',
    default_time_rule_id BIGINT DEFAULT NULL COMMENT 'é»˜è®¤æ—¶é—´è§„åˆ™ID',
    default_auth_types VARCHAR(100) DEFAULT 'card' COMMENT 'é»˜è®¤è®¤è¯ç±»å‹',

    -- ç¦æ­¢åŒºåŸŸé…ç½®
    denied_areas JSON DEFAULT NULL COMMENT 'ç¦æ­¢åŒºåŸŸåˆ—è¡¨',
    denied_area_patterns JSON DEFAULT NULL COMMENT 'ç¦æ­¢åŒºåŸŸæ¨¡å¼',

    -- æ—¶é—´æƒé™é…ç½®
    time_permission_config JSON DEFAULT NULL COMMENT 'æ—¶é—´æƒé™é…ç½®',
    custom_time_rules JSON DEFAULT NULL COMMENT 'è‡ªå®šä¹‰æ—¶é—´è§„åˆ™',

    -- è®¤è¯è¦æ±‚é…ç½®
    auth_requirements JSON DEFAULT NULL COMMENT 'è®¤è¯è¦æ±‚é…ç½®',
    multi_factor_requirement JSON DEFAULT NULL COMMENT 'å¤šå› å­è¦æ±‚',

    -- è®¿é—®æ§åˆ¶é…ç½®
    access_control_config JSON DEFAULT NULL COMMENT 'è®¿é—®æ§åˆ¶é…ç½®',
    security_policies JSON DEFAULT NULL COMMENT 'å®‰å…¨ç­–ç•¥',

    -- ç»§æ‰¿å’Œè¦†ç›–è§„åˆ™
    inheritance_rules JSON DEFAULT NULL COMMENT 'ç»§æ‰¿è§„åˆ™',
    override_rules JSON DEFAULT NULL COMMENT 'è¦†ç›–è§„åˆ™',

    -- çŠ¶æ€ä¿¡æ¯
    role_status TINYINT DEFAULT 1 COMMENT 'è§’è‰²çŠ¶æ€: 0-åœç”¨ 1-å¯ç”¨ 2-å¾…å®¡æ ¸',
    priority_level INT DEFAULT 0 COMMENT 'ä¼˜å…ˆçº§',
    is_default_role TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦é»˜è®¤è§’è‰²: 0-å¦ 1-æ˜¯',

    -- ä½¿ç”¨ç»Ÿè®¡
    usage_count INT DEFAULT 0 COMMENT 'ä½¿ç”¨æ¬¡æ•°',
    last_used_time DATETIME DEFAULT NULL COMMENT 'æœ€åä½¿ç”¨æ—¶é—´',

    -- å®¡è®¡å­—æ®µ
    create_user_id BIGINT DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    update_user_id BIGINT DEFAULT NULL COMMENT 'æ›´æ–°äººID',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',

    -- ç´¢å¼•
    INDEX idx_role_id (role_id),
    INDEX idx_role_type (role_type),
    INDEX idx_config_mode (config_mode),
    INDEX idx_role_status (role_status),
    INDEX idx_priority_level (priority_level),
    INDEX idx_is_default_role (is_default_role),
    INDEX idx_usage_count (usage_count),
    INDEX idx_last_used_time (last_used_time),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (role_id) REFERENCES t_role(role_id),
    FOREIGN KEY (default_time_rule_id) REFERENCES t_access_time_rule(time_rule_id),
    FOREIGN KEY (create_user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (update_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²æƒé™è¡¨';
```

### 4. æ—¶é—´è§„åˆ™è¡¨ (t_access_time_rule)

å­˜å‚¨æ—¶é—´æƒé™è§„åˆ™ã€‚

```sql
CREATE TABLE t_access_time_rule (
    -- ä¸»é”®å­—æ®µ
    rule_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§„åˆ™ID',

    -- è§„åˆ™åŸºæœ¬ä¿¡æ¯
    rule_name VARCHAR(100) NOT NULL COMMENT 'è§„åˆ™åç§°',
    rule_code VARCHAR(64) NOT NULL UNIQUE COMMENT 'è§„åˆ™ç¼–ç ',
    rule_type TINYINT NOT NULL COMMENT 'è§„åˆ™ç±»å‹: 1-å›ºå®šæ—¶é—´ 2-å‘¨æœŸæ—¶é—´ 3-èŠ‚å‡æ—¥æ—¶é—´ 4-è‡ªå®šä¹‰æ—¶é—´',
    rule_description TEXT DEFAULT NULL COMMENT 'è§„åˆ™æè¿°',
    rule_priority INT DEFAULT 0 COMMENT 'è§„åˆ™ä¼˜å…ˆçº§',

    -- æ—¶é—´èŒƒå›´é…ç½®
    time_ranges JSON NOT NULL COMMENT 'æ—¶é—´èŒƒå›´é…ç½®',
    date_ranges JSON DEFAULT NULL COMMENT 'æ—¥æœŸèŒƒå›´é…ç½®',
    week_days VARCHAR(20) DEFAULT 'MON,TUE,WED,THU,FRI' COMMENT 'å·¥ä½œæ—¥',
    exceptions JSON DEFAULT NULL COMMENT 'å¼‚å¸¸æ—¥æœŸ',

    -- è§„åˆ™å‚æ•°
    is_active TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨: 0-å¦ 1-æ˜¯',
    is_default TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦é»˜è®¤: 0-å¦ 1-æ˜¯',
    is_holiday TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦èŠ‚å‡æ—¥: 0-å¦ 1-æ˜¯',
    is_weekend TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å‘¨æœ«: 0-å¦ 1-æ˜¯',

    -- ç”Ÿæ•ˆæ—¶é—´
    effective_date DATE DEFAULT NULL COMMENT 'ç”Ÿæ•ˆæ—¥æœŸ',
    expire_date DATE DEFAULT NULL COMMENT 'è¿‡æœŸæ—¥æœŸ',

    -- é‡å¤é…ç½®
    repeat_type TINYINT DEFAULT 1 COMMENT 'é‡å¤ç±»å‹: 1-ä¸é‡å¤ 2-æ¯æ—¥ 3-æ¯å‘¨ 4-æ¯æœˆ 5-æ¯å¹´',
    repeat_interval INT DEFAULT 0 COMMENT 'é‡å¤é—´éš”',
    repeat_end_date DATE DEFAULT NULL COMMENT 'é‡å¤ç»“æŸæ—¥æœŸ',

    -- ä½¿ç”¨ç»Ÿè®¡
    usage_count INT DEFAULT 0 COMMENT 'ä½¿ç”¨æ¬¡æ•°',
    last_used_time DATETIME DEFAULT NULL COMMENT 'æœ€åä½¿ç”¨æ—¶é—´',

    -- å®¡è®¡å­—æ®µ
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    create_user_id BIGINT DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    update_user_id BIGINT DEFAULT NULL COMMENT 'æ›´æ–°äººID',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',

    -- ç´¢å¼•
    INDEX idx_rule_code (rule_code),
    INDEX idx_rule_type (rule_type),
    INDEX idx_rule_priority (rule_priority),
    INDEX idx_is_active (is_active),
    INDEX idx_is_default (is_default),
    INDEX idx_effective_date (effective_date),
    INDEX idx_expire_date (expire_date),
    INDEX idx_repeat_type (repeat_type),
    INDEX idx_usage_count (usage_count),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (create_user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (update_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ—¶é—´è§„åˆ™è¡¨';
```

### 5. æƒé™éªŒè¯æ—¥å¿—è¡¨ (t_access_permission_log)

å­˜å‚¨æƒé™éªŒè¯æ“ä½œçš„å®¡è®¡æ—¥å¿—ã€‚

```sql
CREATE TABLE t_access_permission_log (
    -- ä¸»é”®å­—æ®µ
    log_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',

    -- è¯·æ±‚ä¿¡æ¯
    request_id VARCHAR(64) DEFAULT NULL COMMENT 'è¯·æ±‚ID',
    request_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'è¯·æ±‚æ—¶é—´',
    response_time BIGINT DEFAULT NULL COMMENT 'å“åº”æ—¶é—´(æ¯«ç§’)',

    -- ç”¨æˆ·ä¿¡æ¯
    user_id BIGINT DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
    user_name VARCHAR(100) DEFAULT NULL COMMENT 'ç”¨æˆ·å§“å',
    user_card_number VARCHAR(50) DEFAULT NULL COMMENT 'ç”¨æˆ·å¡å·',
    user_role_ids VARCHAR(500) DEFAULT NULL COMMENT 'ç”¨æˆ·è§’è‰²IDs',

    -- è®¾å¤‡ä¿¡æ¯
    device_id BIGINT DEFAULT NULL COMMENT 'è®¾å¤‡ID',
    device_name VARCHAR(200) DEFAULT NULL COMMENT 'è®¾å¤‡åç§°',
    device_code VARCHAR(100) DEFAULT NULL COMMENT 'è®¾å¤‡ç¼–ç ',
    device_location VARCHAR(500) DEFAULT NULL COMMENT 'è®¾å¤‡ä½ç½®',

    -- åŒºåŸŸä¿¡æ¯
    area_id BIGINT DEFAULT NULL COMMENT 'åŒºåŸŸID',
    area_name VARCHAR(200) DEFAULT NULL COMMENT 'åŒºåŸŸåç§°',
    area_path VARCHAR(1000) DEFAULT NULL COMMENT 'åŒºåŸŸè·¯å¾„',

    -- æƒé™ä¿¡æ¯
    permission_type TINYINT DEFAULT NULL COMMENT 'æƒé™ç±»å‹',
    access_level TINYINT DEFAULT NULL COMMENT 'è®¿é—®çº§åˆ«',
    permission_sources VARCHAR(500) DEFAULT NULL COMMENT 'æƒé™æ¥æº',
    permission_details JSON DEFAULT NULL COMMENT 'æƒé™è¯¦æƒ…',

    -- éªŒè¯ä¿¡æ¯
    auth_types VARCHAR(100) DEFAULT NULL COMMENT 'è®¤è¯ç±»å‹',
    auth_result TINYINT DEFAULT 0 COMMENT 'è®¤è¯ç»“æœ: 0-å¤±è´¥ 1-æˆåŠŸ',
    auth_details JSON DEFAULT NULL COMMENT 'è®¤è¯è¯¦æƒ…',

    -- éªŒè¯ç»“æœ
    verify_result TINYINT DEFAULT 0 COMMENT 'éªŒè¯ç»“æœ: 0-æ‹’ç» 1-é€šè¿‡ 2-éƒ¨åˆ†é€šè¿‡',
    verify_reason VARCHAR(500) DEFAULT NULL COMMENT 'éªŒè¯åŸå› ',
    granted_permissions JSON DEFAULT NULL COMMENT 'æˆäºˆæƒé™',
    denied_permissions JSON DEFAULT NULL COMMENT 'æ‹’ç»æƒé™',

    -- å†³ç­–ä¿¡æ¯
    policy_applied VARCHAR(500) DEFAULT NULL COMMENT 'åº”ç”¨ç­–ç•¥',
    rule_matched VARCHAR(500) DEFAULT NULL COMMENT 'åŒ¹é…è§„åˆ™',
    conflict_resolution VARCHAR(500) DEFAULT NULL COMMENT 'å†²çªè§£å†³',

    -- æ€§èƒ½ä¿¡æ¯
    cache_hit TINYINT DEFAULT 0 COMMENT 'ç¼“å­˜å‘½ä¸­: 0-å¦ 1-æ˜¯',
    cache_keys VARCHAR(1000) DEFAULT NULL COMMENT 'ç¼“å­˜é”®',
    query_time BIGINT DEFAULT NULL COMMENT 'æŸ¥è¯¢è€—æ—¶(æ¯«ç§’)',

    -- å¼‚å¸¸ä¿¡æ¯
    error_code VARCHAR(50) DEFAULT NULL COMMENT 'é”™è¯¯ä»£ç ',
    error_message TEXT DEFAULT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
    stack_trace TEXT DEFAULT NULL COMMENT 'å †æ ˆè·Ÿè¸ª',

    -- æ‰©å±•å­—æ®µ
    extended_data JSON DEFAULT NULL COMMENT 'æ‰©å±•æ•°æ®',

    -- ç´¢å¼•
    INDEX idx_request_id (request_id),
    INDEX idx_request_time (request_time),
    INDEX idx_user_id (user_id),
    INDEX idx_device_id (device_id),
    INDEX idx_area_id (area_id),
    INDEX idx_verify_result (verify_result),
    INDEX_idx_auth_result (auth_result),
    INDEX idx_cache_hit (cache_hit),
    INDEX idx_error_code (error_code),
    INDEX idx_create_time (create_time),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (device_id) REFERENCES t_access_device(device_id),
    FOREIGN KEY (area_id) REFERENCES t_access_area(area_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™éªŒè¯æ—¥å¿—è¡¨';
```

### 6. æƒé™å˜æ›´è®°å½•è¡¨ (t_access_permission_change)

å­˜å‚¨æƒé™é…ç½®å˜æ›´çš„å®¡è®¡è®°å½•ã€‚

```sql
CREATE TABLE t_access_permission_change (
    -- ä¸»é”®å­—æ®µ
    change_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å˜æ›´ID',

    -- å˜æ›´åŸºæœ¬ä¿¡æ¯
    change_type TINYINT NOT NULL COMMENT 'å˜æ›´ç±»å‹: 1-æƒé™åˆ›å»º 2-æƒé™ä¿®æ”¹ 3-æƒé™åˆ é™¤ 4-æƒé™å‡çº§ 5-æƒé™é™çº§ 6-æƒé™è¿‡æœŸ',
    change_scope TINYINT NOT NULL COMMENT 'å˜æ›´èŒƒå›´: 1-å•ä¸ªæƒé™ 2-æ‰¹é‡æƒé™ 3-è§’è‰²æƒé™ 4-ç­–ç•¥æƒé™',
    change_level TINYINT DEFAULT 1 COMMENT 'å˜æ›´çº§åˆ«: 1-æ™®é€š 2-é‡è¦ 3-ç´§æ€¥',

    -- å˜æ›´å¯¹è±¡ä¿¡æ¯
    target_type TINYINT NOT NULL COMMENT 'ç›®æ ‡ç±»å‹: 1-ç”¨æˆ· 2-è§’è‰² 3-åŒºåŸŸ 4-ç­–ç•¥',
    target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡ID',
    target_name VARCHAR(200) DEFAULT NULL COMMENT 'ç›®æ ‡åç§°',

    -- å˜æ›´å‰åå¯¹æ¯”
    before_data JSON DEFAULT NULL COMMENT 'å˜æ›´å‰æ•°æ®',
    after_data JSON DEFAULT NULL COMMENT 'å˜æ›´åæ•°æ®',
    changed_fields JSON DEFAULT NULL COMMENT 'å˜æ›´å­—æ®µåˆ—è¡¨',

    -- å˜æ›´åŸå› 
    change_reason VARCHAR(500) DEFAULT NULL COMMENT 'å˜æ›´åŸå› ',
    change_description TEXT DEFAULT NULL COMMENT 'å˜æ›´æè¿°',
    business_context TEXT DEFAULT NULL COMMENT 'ä¸šåŠ¡èƒŒæ™¯',

    -- å®¡æ‰¹ä¿¡æ¯
    approval_required TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦éœ€è¦å®¡æ‰¹: 0-å¦ 1-æ˜¯',
    approval_status TINYINT DEFAULT 0 COMMENT 'å®¡æ‰¹çŠ¶æ€: 0-å¾…å®¡æ‰¹ 1-å·²é€šè¿‡ 2-å·²æ‹’ç» 3-å·²å–æ¶ˆ',
    approval_user_id BIGINT DEFAULT NULL COMMENT 'å®¡æ‰¹äººID',
    approval_time DATETIME DEFAULT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
    approval_remark TEXT DEFAULT NULL COMMENT 'å®¡æ‰¹å¤‡æ³¨',

    -- æ“ä½œä¿¡æ¯
    operator_id BIGINT NOT NULL COMMENT 'æ“ä½œäººID',
    operator_name VARCHAR(100) NOT NULL COMMENT 'æ“ä½œäººå§“å',
    operator_ip VARCHAR(45) DEFAULT NULL COMMENT 'æ“ä½œäººIP',
    operator_user_agent VARCHAR(500) DEFAULT NULL COMMENT 'æ“ä½œäººç”¨æˆ·ä»£ç†',

    -- æ—¶é—´ä¿¡æ¯
    change_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'å˜æ›´æ—¶é—´',
    effective_time DATETIME DEFAULT NULL COMMENT 'ç”Ÿæ•ˆæ—¶é—´',
    expire_time DATETIME DEFAULT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
    rollback_time DATETIME DEFAULT NULL COMMENT 'å›æ»šæ—¶é—´',

    -- å½±å“èŒƒå›´
    affected_users INT DEFAULT 0 COMMENT 'å½±å“ç”¨æˆ·æ•°',
    affected_areas INT DEFAULT 0 COMMENT 'å½±å“åŒºåŸŸæ•°',
    affected_devices INT DEFAULT 0 COMMENT 'å½±å“è®¾å¤‡æ•°',

    -- çŠ¶æ€ä¿¡æ¯
    change_status TINYINT DEFAULT 0 COMMENT 'å˜æ›´çŠ¶æ€: 0-å¾…å¤„ç† 1-å¤„ç†ä¸­ 2-å·²å®Œæˆ 3-å·²å›æ»š 4-å·²å–æ¶ˆ',
    final_result TINYINT DEFAULT 0 COMMENT 'æœ€ç»ˆç»“æœ: 0-æœªçŸ¥ 1-æˆåŠŸ 2-å¤±è´¥ 3-éƒ¨åˆ†æˆåŠŸ',

    -- å®¡è®¡å­—æ®µ
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',

    -- ç´¢å¼•
    INDEX idx_change_type (change_type),
    INDEX idx_change_scope (change_scope),
    INDEX idx_change_level (change_level),
    INDEX idx_target_type (target_type),
    INDEX idx_target_id (target_id),
    INDEX idx_change_status (change_status),
    INDEX idx_approval_status (approval_status),
    INDEX idx_operator_id (operator_id),
    INDEX idx_change_time (change_time),
    INDEX idx_effective_time (effective_time),
    INDEX idx_final_result (final_result),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (target_type) REFERENCES t_data_dictionary(dict_id),
    FOREIGN KEY (operator_id) REFERENCES t_user(user_id),
    FOREIGN KEY (approval_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™å˜æ›´è®°å½•è¡¨';
```

### 7. æƒé™ç­–ç•¥è¡¨ (t_access_permission_strategy)

å­˜å‚¨æƒé™æ§åˆ¶ç­–ç•¥é…ç½®ã€‚

```sql
CREATE TABLE t_access_permission_strategy (
    -- ä¸»é”®å­—æ®µ
    strategy_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç­–ç•¥ID',

    -- ç­–ç•¥åŸºæœ¬ä¿¡æ¯
    strategy_name VARCHAR(100) NOT NULL COMMENT 'ç­–ç•¥åç§°',
    strategy_code VARCHAR(64) NOT NULL UNIQUE COMMENT 'ç­–ç•¥ç¼–ç ',
    strategy_type TINYINT NOT NULL COMMENT 'ç­–ç•¥ç±»å‹: 1-é»˜è®¤æƒé™ 2-æƒé™å‡çº§ 3-æƒé™é™çº§ 4-ç»§æ‰¿è§„åˆ™ 5-å†²çªè§£å†³ 6-ç´§æ€¥æƒé™',
    strategy_description TEXT DEFAULT NULL COMMENT 'ç­–ç•¥æè¿°',
    strategy_priority INT DEFAULT 0 COMMENT 'ç­–ç•¥ä¼˜å…ˆçº§',

    -- ç­–ç•¥æ¡ä»¶
    condition_rules JSON NOT NULL COMMENT 'ç­–ç•¥æ¡ä»¶è§„åˆ™',
    target_rules JSON DEFAULT NULL COMMENT 'ç›®æ ‡å¯¹è±¡è§„åˆ™',
    scope_rules JSON DEFAULT NULL COMMENT 'ä½œç”¨èŒƒå›´è§„åˆ™',

    -- ç­–ç•¥åŠ¨ä½œ
    action_rules JSON NOT NULL COMMENT 'ç­–ç•¥åŠ¨ä½œè§„åˆ™',
    effect_rules JSON DEFAULT NULL COMMENT 'ç”Ÿæ•ˆè§„åˆ™',
    exception_rules JSON DEFAULT NULL COMMENT 'å¼‚å¸¸å¤„ç†è§„åˆ™',

    -- ç»§æ‰¿è§„åˆ™é…ç½®
    inheritance_enabled TINYINT DEFAULT 1 COMMENT 'å¯ç”¨ç»§æ‰¿: 0-å¦ 1-æ˜¯',
    inheritance_direction TINYINT DEFAULT 1 COMMENT 'ç»§æ‰¿æ–¹å‘: 1-å‘ä¸‹ 2-å‘ä¸Š 3-åŒå‘',
    inheritance_depth INT DEFAULT 0 COMMENT 'ç»§æ‰¿æ·±åº¦é™åˆ¶',
    inheritance_filter JSON DEFAULT NULL COMMENT 'ç»§æ‰¿è¿‡æ»¤å™¨',

    -- å†²çªè§£å†³é…ç½®
    conflict_resolution TINYINT DEFAULT 1 COMMENT 'å†²çªè§£å†³æ–¹å¼: 1-æƒé™ä¼˜å…ˆ 2-æ—¶é—´ä¼˜å…ˆ 3-çº§åˆ«ä¼˜å…ˆ 4-æœ€æ–°ä¼˜å…ˆ',
    conflict_priority JSON DEFAULT NULL COMMENT 'å†²çªä¼˜å…ˆçº§å®šä¹‰',
    conflict_exceptions JSON DEFAULT NULL COMMENT 'å†²çªå¤„ç†å¼‚å¸¸',

    -- ç´§æ€¥æƒé™é…ç½®
    emergency_enabled TINYINT DEFAULT 0 COMMENT 'å¯ç”¨ç´§æ€¥æƒé™: 0-å¦ 1-æ˜¯',
    emergency_conditions JSON DEFAULT NULL COMMENT 'ç´§æ€¥è§¦å‘æ¡ä»¶',
    emergency_permissions JSON DEFAULT NULL COMMENT 'ç´§æ€¥æƒé™é…ç½®',
    emergency_duration INT DEFAULT 0 COMMENT 'ç´§æ€¥æƒé™æŒç»­æ—¶é—´(åˆ†é’Ÿ)',
    emergency_auto_recovery TINYINT DEFAULT 1 COMMENT 'ç´§æ€¥æƒé™è‡ªåŠ¨æ¢å¤: 0-å¦ 1-æ˜¯',

    -- ç­–ç•¥æ‰§è¡Œé…ç½®
    execution_mode TINYINT DEFAULT 1 COMMENT 'æ‰§è¡Œæ¨¡å¼: 1-ç«‹å³ 2-å»¶è¿Ÿ 3-æ¡ä»¶è§¦å‘ 4-æ‰‹åŠ¨è§¦å‘',
    execution_delay INT DEFAULT 0 COMMENT 'æ‰§è¡Œå»¶è¿Ÿ(ç§’)',
    execution_timeout INT DEFAULT 300 COMMENT 'æ‰§è¡Œè¶…æ—¶(ç§’)',
    retry_count INT DEFAULT 3 COMMENT 'é‡è¯•æ¬¡æ•°',

    -- çŠ¶æ€ä¿¡æ¯
    strategy_status TINYINT DEFAULT 1 COMMENT 'ç­–ç•¥çŠ¶æ€: 0-åœç”¨ 1-å¯ç”¨ 2-æµ‹è¯• 3-å·²è¿‡æœŸ',
    effective_date DATETIME DEFAULT NULL COMMENT 'ç”Ÿæ•ˆæ—¶é—´',
    expire_date DATETIME DEFAULT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
    is_global TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å…¨å±€ç­–ç•¥: 0-å¦ 1-æ˜¯',

    -- ä½¿ç”¨ç»Ÿè®¡
    execution_count INT DEFAULT 0 COMMENT 'æ‰§è¡Œæ¬¡æ•°',
    success_count INT DEFAULT 0 COMMENT 'æˆåŠŸæ¬¡æ•°',
    failure_count INT DEFAULT 0 COMMENT 'å¤±è´¥æ¬¡æ•°',
    last_execution_time DATETIME DEFAULT NULL COMMENT 'æœ€åæ‰§è¡Œæ—¶é—´',
    last_success_time DATETIME DEFAULT NULL COMMENT 'æœ€åæˆåŠŸæ—¶é—´',

    -- å®¡è®¡å­—æ®µ
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    create_user_id BIGINT DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    update_user_id BIGINT DEFAULT NULL COMMENT 'æ›´æ–°äººID',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',

    -- ç´¢å¼•
    INDEX idx_strategy_code (strategy_code),
    INDEX idx_strategy_type (strategy_type),
    INDEX idx_strategy_priority (strategy_priority),
    INDEX idx_strategy_status (strategy_status),
    INDEX idx_is_global (is_global),
    INDEX idx_effective_date (effective_date),
    INDEX idx_expire_date (expire_date),
    INDEX idx_execution_count (execution_count),
    INDEX idx_last_execution_time (last_execution_time),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (create_user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (update_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™ç­–ç•¥è¡¨';
```

### 8. æƒé™æ¨¡æ¿è¡¨ (t_access_permission_template)

å­˜å‚¨æƒé™é…ç½®æ¨¡æ¿ã€‚

```sql
CREATE TABLE t_access_permission_template (
    -- ä¸»é”®å­—æ®µ
    template_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ¨¡æ¿ID',

    -- æ¨¡æ¿åŸºæœ¬ä¿¡æ¯
    template_name VARCHAR(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
    template_code VARCHAR(64) NOT NULL UNIQUE COMMENT 'æ¨¡æ¿ç¼–ç ',
    template_type TINYINT NOT NULL COMMENT 'æ¨¡æ¿ç±»å‹: 1-åŒºåŸŸæƒé™ 2-è§’è‰²æƒé™ 3-æ—¶é—´æƒé™ 4-è®¤è¯æƒé™ 5-è®¿é—®æ§åˆ¶',
    template_category VARCHAR(50) DEFAULT NULL COMMENT 'æ¨¡æ¿åˆ†ç±»',
    template_description TEXT DEFAULT NULL COMMENT 'æ¨¡æ¿æè¿°',

    -- æ¨¡æ¿å†…å®¹
    template_content JSON NOT NULL COMMENT 'æ¨¡æ¿å†…å®¹',
    default_values JSON DEFAULT NULL COMMENT 'é»˜è®¤å€¼',
    configurable_fields JSON DEFAULT NULL COMMENT 'å¯é…ç½®å­—æ®µ',
    validation_rules JSON DEFAULT NULL COMMENT 'éªŒè¯è§„åˆ™',

    -- åº”ç”¨åœºæ™¯
    applicable_scenarios JSON DEFAULT NULL COMMENT 'é€‚ç”¨åœºæ™¯',
    target_object_types JSON DEFAULT NULL COMMENT 'é€‚ç”¨å¯¹è±¡ç±»å‹',
    restriction_rules JSON DEFAULT NULL COMMENT 'é™åˆ¶è§„åˆ™',

    -- æ¨¡æ¿çŠ¶æ€
    template_status TINYINT DEFAULT 1 COMMENT 'æ¨¡æ¿çŠ¶æ€: 0-è‰ç¨¿ 1-å‘å¸ƒ 2-åœç”¨ 3-å·²åºŸå¼ƒ',
    is_system_template TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç³»ç»Ÿæ¨¡æ¿: 0-å¦ 1-æ˜¯',
    is_public_template TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å…¬å¼€æ¨¡æ¿: 0-å¦ 1-æ˜¯',
    is_default_template TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦é»˜è®¤æ¨¡æ¿: 0-å¦ 1-æ˜¯',

    -- ç‰ˆæœ¬ä¿¡æ¯
    template_version VARCHAR(20) DEFAULT '1.0' COMMENT 'æ¨¡æ¿ç‰ˆæœ¬',
    base_template_id BIGINT DEFAULT NULL COMMENT 'åŸºç¡€æ¨¡æ¿ID',
    version_history JSON DEFAULT NULL COMMENT 'ç‰ˆæœ¬å†å²',

    -- ä½¿ç”¨ç»Ÿè®¡
    usage_count INT DEFAULT 0 COMMENT 'ä½¿ç”¨æ¬¡æ•°',
    copy_count INT DEFAULT 0 COMMENT 'å¤åˆ¶æ¬¡æ•°',
    last_used_time DATETIME DEFAULT NULL COMMENT 'æœ€åä½¿ç”¨æ—¶é—´',
    user_ratings JSON DEFAULT NULL COMMENT 'ç”¨æˆ·è¯„åˆ†',

    -- æ¨èä¿¡æ¯
    is_recommended TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ¨è: 0-å¦ 1-æ˜¯',
    recommendation_reason VARCHAR(500) DEFAULT NULL COMMENT 'æ¨èåŸå› ',
    usage_tips TEXT DEFAULT NULL COMMENT 'ä½¿ç”¨æŠ€å·§',

    -- å®¡è®¡å­—æ®µ
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    create_user_id BIGINT DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    update_user_id BIGINT DEFAULT NULL COMMENT 'æ›´æ–°äººID',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',

    -- ç´¢å¼•
    INDEX idx_template_code (template_code),
    INDEX idx_template_type (template_type),
    INDEX idx_template_category (template_category),
    INDEX idx_template_status (template_status),
    INDEX idx_is_system_template (is_system_template),
    INDEX idx_is_public_template (is_public_template),
    INDEX idx_is_default_template (is_default_template),
    INDEX idx_usage_count (usage_count),
    INDEX idx_last_used_time (last_used_time),
    INDEX idx_is_recommended (is_recommended),

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (base_template_id) REFERENCES t_access_permission_template(template_id),
    FOREIGN KEY (create_user_id) REFERENCES t_user(user_id),
    FOREIGN KEY (update_user_id) REFERENCES t_user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™æ¨¡æ¿è¡¨';
```

---

## ğŸ”— æ•°æ®åº“å…³ç³»å›¾ (ERå›¾)

### å®ä½“å…³ç³»å›¾

```mermaid
erDiagram
    t_access_area ||--o{ t_access_user_permission : "åŒºåŸŸæƒé™"
    t_access_area ||--o{ t_area_device_relation : "åŒºåŸŸè®¾å¤‡å…³è”"
    t_access_user ||--o{ t_access_user_permission : "ç”¨æˆ·æƒé™"
    t_role ||--o{ t_access_role_permission : "è§’è‰²æƒé™"
    t_user ||--o{ t_access_user_permission : "ç”¨æˆ·æƒé™"
    t_role ||--o{ t_access_role_permission : "è§’è‰²æƒé™"

    t_access_user_permission ||--o{ t_access_time_rule : "æ—¶é—´è§„åˆ™"
    t_access_role_permission ||--o{ t_access_time_rule : "æ—¶é—´è§„åˆ™"

    t_access_area ||--o{ t_access_permission_log : "æƒé™éªŒè¯æ—¥å¿—"
    t_access_device ||--o{ t_access_permission_log : "æƒé™éªŒè¯æ—¥å¿—"
    t_user ||--o{ t_access_permission_log : "æƒé™éªŒè¯æ—¥å¿—"

    t_access_user_permission ||--o{ t_access_permission_change : "æƒé™å˜æ›´"
    t_access_role_permission ||--o{ t_access_permission_change : "æƒé™å˜æ›´"

    t_access_permission_strategy ||--o{ t_access_permission_change : "ç­–ç•¥å˜æ›´"
    t_access_permission_strategy ||--o{ t_access_permission_log : "ç­–ç•¥éªŒè¯"

    t_access_permission_template ||--o{ t_access_permission_change : "æ¨¡æ¿åº”ç”¨"
    t_access_permission_template ||--o{ t_access_user_permission : "æ¨¡æ¿åº”ç”¨"
    t_access_permission_template ||--o{ t_access_role_permission : "æ¨¡æ¿åº”ç”¨"

    t_area ||--|| t_access_area : "åŒºåŸŸåŸºç¡€ä¿¡æ¯"
    t_user ||--|| t_access_user : "ç”¨æˆ·åŸºç¡€ä¿¡æ¯"
    t_role ||--|| t_access_role : "è§’è‰²åŸºç¡€ä¿¡æ¯"

    t_access_area {
        bigint area_id PK
        varchar area_code UK
        varchar area_name
        tinyint area_type
        bigint parent_area_id FK
        int area_level
        varchar area_path
        varchar building_name
        int floor_number
        varchar room_number
        decimal longitude
        decimal latitude
        tinyint security_level
        tinyint access_level
        int capacity_limit
        decimal area_size
        int door_count
        tinyint area_status
        bigint responsible_user_id FK
        datetime create_time
        datetime update_time
        tinyint deleted_flag
        int version
    }

    t_access_user_permission {
        bigint permission_id PK
        bigint user_id FK
        bigint area_id FK
        tinyint permission_type
        tinyint access_level
        tinyint permission_level
        tinyint permission_status
        tinyint is_temporary
        tinyint is_emergency
        datetime start_time
        datetime end_time
        bigint time_rule_id FK
        tinyint require_card
        tinyint require_password
        tinyint require_face
        tinyint require_fingerprint
        tinyint require_multi_factor
        int min_auth_factors
        tinyint inherit_to_children
        tinyint inherit_from_parent
        int inherit_priority
        bigint grant_user_id FK
        varchar grant_reason
        datetime create_time
        datetime update_time
        datetime last_access_time
        tinyint deleted_flag
        int version
    }

    t_access_role_permission {
        bigint role_permission_id PK
        bigint role_id FK
        tinyint role_type
        tinyint config_mode
        json area_permission_config
        json area_pattern_rules
        tinyint default_access_level
        tinyint max_access_level
        bigint default_time_rule_id FK
        varchar default_auth_types
        json denied_areas
        json denied_area_patterns
        json time_permission_config
        json custom_time_rules
        json auth_requirements
        json multi_factor_requirement
        json access_control_config
        json security_policies
        json inheritance_rules
        json override_rules
        tinyint role_status
        int priority_level
        tinyint is_default_role
        int usage_count
        datetime last_used_time
        bigint create_user_id FK
        datetime create_time
        datetime update_time
        bigint update_user_id FK
        tinyint deleted_flag
        int version
    }

    t_access_time_rule {
        bigint rule_id PK
        varchar rule_name
        varchar rule_code UK
        tinyint rule_type
        text rule_description
        int rule_priority
        json time_ranges
        json date_ranges
        varchar week_days
        json exceptions
        tinyint is_active
        tinyint is_default
        tinyint is_holiday
        tinyint is_weekend
        date effective_date
        date expire_date
        tinyint repeat_type
        int repeat_interval
        date repeat_end_date
        int usage_count
        datetime last_used_time
        datetime create_time
        bigint create_user_id FK
        datetime update_time
        bigint update_user_id FK
        tinyint deleted_flag
        int version
    }

    t_access_permission_log {
        bigint log_id PK
        varchar request_id
        datetime request_time
        bigint response_time
        bigint user_id FK
        varchar user_name
        varchar user_card_number
        varchar user_role_ids
        bigint device_id FK
        varchar device_name
        varchar device_code
        varchar device_location
        bigint area_id FK
        varchar area_name
        varchar area_path
        tinyint permission_type
        tinyint access_level
        varchar permission_sources
        json permission_details
        varchar auth_types
        tinyint auth_result
        json auth_details
        tinyint verify_result
        varchar verify_reason
        json granted_permissions
        json denied_permissions
        varchar policy_applied
        varchar rule_matched
        varchar conflict_resolution
        tinyint cache_hit
        varchar cache_keys
        bigint query_time
        varchar error_code
        text error_message
        text stack_trace
        json extended_data
        datetime create_time
    }

    t_access_permission_change {
        bigint change_id PK
        tinyint change_type
        tinyint change_scope
        tinyint change_level
        tinyint target_type
        bigint target_id
        varchar target_name
        json before_data
        json after_data
        json changed_fields
        varchar change_reason
        text change_description
        text business_context
        tinyint approval_required
        tinyint approval_status
        bigint approval_user_id FK
        datetime approval_time
        text approval_remark
        bigint operator_id FK
        varchar operator_name
        varchar operator_ip
        varchar operator_user_agent
        datetime change_time
        datetime effective_time
        datetime expire_time
        datetime rollback_time
        int affected_users
        int affected_areas
        int affected_devices
        tinyint change_status
        tinyint final_result
        datetime create_time
        datetime update_time
        tinyint deleted_flag
    }

    t_access_permission_strategy {
        bigint strategy_id PK
        varchar strategy_name
        varchar strategy_code UK
        tinyint strategy_type
        int strategy_priority
        text strategy_description
        json condition_rules
        json target_rules
        json scope_rules
        json action_rules
        json effect_rules
        json exception_rules
        tinyint inheritance_enabled
        tinyint inheritance_direction
        int inheritance_depth
        json inheritance_filter
        tinyint conflict_resolution
        json conflict_priority
        json conflict_exceptions
        tinyint emergency_enabled
        json emergency_conditions
        json emergency_permissions
        int emergency_duration
        tinyint emergency_auto_recovery
        tinyint execution_mode
        int execution_delay
        int execution_timeout
        int retry_count
        tinyint strategy_status
        datetime effective_date
        datetime expire_date
        tinyint is_global
        int execution_count
        int success_count
        int failure_count
        datetime last_execution_time
        datetime last_success_time
        datetime create_time
        bigint create_user_id FK
        datetime update_time
        bigint update_user_id FK
        tinyint deleted_flag
        int version
    }

    t_access_permission_template {
        bigint template_id PK
        varchar template_name
        varchar template_code UK
        tinyint template_type
        varchar template_category
        text template_description
        json template_content
        json default_values
        json configurable_fields
        json validation_rules
        json applicable_scenarios
        json target_object_types
        json restriction_rules
        tinyint template_status
        tinyint is_system_template
        tinyint is_public_template
        tinyint is_default_template
        varchar template_version
        bigint base_template_id FK
        json version_history
        int usage_count
        int copy_count
        datetime last_used_time
        json user_ratings
        tinyint is_recommended
        varchar recommendation_reason
        text usage_tips
        datetime create_time
        bigint create_user_id FK
        datetime update_time
        bigint update_user_id FK
        tinyint deleted_flag
        int version
    }

    t_area {
        bigint area_id PK
        varchar area_name
        varchar area_code UK
        tinyint area_type
        bigint parent_area_id FK
        tinyint area_status
        datetime create_time
        tinyint deleted_flag
    }

    t_user {
        bigint user_id PK
        varchar user_name
        varchar login_name
        varchar phone
        tinyint user_status
        datetime create_time
        tinyint deleted_flag
    }

    t_role {
        bigint role_id PK
        varchar role_name
        varchar role_code
        tinyint role_type
        tinyint role_status
        datetime create_time
        tinyint deleted_flag
    }

    t_area_device_relation {
        bigint relation_id PK
        bigint area_id FK
        bigint device_id FK
        tinyint relation_status
        datetime create_time
    }

    t_access_device {
        bigint device_id PK
        varchar device_name
        varchar device_code
        tinyint device_status
        bigint area_id FK
        datetime create_time
    }
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡è§„èŒƒ

### å‘½åè§„èŒƒ

| å¯¹è±¡ç±»å‹ | å‘½åè§„èŒƒ | ç¤ºä¾‹ |
|---------|---------|------|
| è¡¨å | t_access_åŠŸèƒ½_å®ä½“ | t_access_area, t_access_user_permission |
| ä¸»é”® | id_åŠŸèƒ½ | area_id, permission_id |
| å¤–é”® | å¼•ç”¨è¡¨å_id | area_id, user_id, role_id |
| ç´¢å¼• | idx_å­—æ®µå | idx_area_type, idx_permission_type |
| å”¯ä¸€ç´¢å¼• | uk_å­—æ®µå | uk_area_code, uk_template_code |

### å­—æ®µè§„èŒƒ

| å­—æ®µç±»å‹ | å‘½åè§„èŒƒ | è¯´æ˜ |
|---------|---------|------|
| æ—¶é—´å­—æ®µ | time/date | create_time, update_time, expire_time |
| çŠ¶æ€å­—æ®µ | status/level | area_status, permission_status, verify_result |
| æ•°é‡å­—æ®µ | count/number | usage_count, capacity_limit |
| æ ‡è¯†å­—æ®µ | is_enabled/required | is_active, is_temporary, require_multi_factor |
| JSONå­—æ®µ | config/data/rules | extended_data, permission_details, template_content |
| æšä¸¾å­—æ®µ | tinyint | æƒé™ç±»å‹ã€åŒºåŸŸç±»å‹ã€ç­–ç•¥ç±»å‹ |

### ç´¢å¼•è®¾è®¡åŸåˆ™

1. **ä¸»é”®ç´¢å¼•**: æ‰€æœ‰è¡¨å¿…é¡»åŒ…å«è‡ªå¢ä¸»é”®
2. **å¤–é”®ç´¢å¼•**: æ‰€æœ‰å¤–é”®å­—æ®µå¿…é¡»åˆ›å»ºç´¢å¼•
3. **å”¯ä¸€ç´¢å¼•**: ä¿è¯ä¸šåŠ¡æ•°æ®å”¯ä¸€æ€§
4. **å¤åˆç´¢å¼•**: æ ¹æ®æŸ¥è¯¢æ¨¡å¼åˆ›å»ºå¤åˆç´¢å¼•
5. **åˆ†åŒºç´¢å¼•**: å¤§è¡¨æŒ‰æ—¶é—´åˆ†åŒº

---

## âš¡ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### ç´¢å¼•ä¼˜åŒ–

```sql
-- åŒºåŸŸå±‚çº§æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_area_hierarchy ON t_access_area(area_level, parent_area_id);

-- æƒé™æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_user_area_permission ON t_access_user_permission(user_id, area_id, permission_status);
CREATE INDEX idx_permission_time_range ON t_access_user_permission(user_id, start_time, end_time);

-- æ—¥å¿—æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_log_time_user ON t_access_permission_log(request_time, user_id);
CREATE INDEX idx_log_device_area ON t_access_permission_log(device_id, area_id, verify_result);
```

### åˆ†åŒºè®¾è®¡

```sql
-- æƒé™æ—¥å¿—è¡¨æŒ‰æœˆåˆ†åŒº
ALTER TABLE t_access_permission_log
PARTITION BY RANGE (MONTH(request_time)) (
    PARTITION p202501 VALUES LESS THAN ('2025-02-01'),
    PARTITION p202502 VALUES LESS THAN ('2025-03-01'),
    PARTITION p202503 VALUES LESS THAN ('2025-04-01'),
    -- ...
    PARTITION pmax VALUES LESS THAN MAXVALUE
);
```

### ç¼“å­˜ç­–ç•¥

```java
// æƒé™ç¼“å­˜é”®è®¾è®¡
@Cacheable(value = "permission:user:area", key = "#userId + ':' + #areaId + ':' + #currentTime")
public PermissionResult checkUserPermission(Long userId, Long areaId, Date currentTime) {
    return permissionService.checkPermission(userId, areaId, currentTime);
}

// åŒºåŸŸå±‚çº§ç¼“å­˜
@Cacheable(value = "area:hierarchy", key = "#areaId")
public List<Long> getAreaHierarchy(Long areaId) {
    return areaService.getAreaHierarchy(areaId);
}
```

---

## ğŸ”’ æ•°æ®å®‰å…¨è®¾è®¡

### æ•æ„Ÿæ•°æ®åŠ å¯†

```sql
-- è®¤è¯ä¿¡æ¯åŠ å¯†å­˜å‚¨
auth_details JSON COMMENT 'è®¤è¯è¯¦æƒ…(æ•æ„Ÿä¿¡æ¯åŠ å¯†)'

-- æƒé™é…ç½®åŠ å¯†
security_policies JSON COMMENT 'å®‰å…¨ç­–ç•¥(æ•æ„Ÿé…ç½®åŠ å¯†)'
```

### è®¿é—®æ§åˆ¶

```sql
-- è¡Œçº§å®‰å…¨ç­–ç•¥
CREATE POLICY permission_access_policy ON t_access_user_permission
FOR ALL TO access_app_user
USING (user_id = current_user_id());

-- æƒé™çº§åˆ«æ£€æŸ¥
CREATE POLICY permission_level_policy ON t_access_user_permission
FOR ALL TO access_app_user
USING (access_level <= user_access_level);
```

### å®¡è®¡æ—¥å¿—

```sql
-- å®¡è®¡å­—æ®µè®¾è®¡
operator_id BIGINT DEFAULT NULL COMMENT 'æ“ä½œäººID',
operator_name VARCHAR(100) NOT NULL COMMENT 'æ“ä½œäººå§“å',
operator_ip VARCHAR(45) DEFAULT NULL COMMENT 'æ“ä½œäººIP',
operator_user_agent VARCHAR(500) DEFAULT NULL COMMENT 'æ“ä½œäººç”¨æˆ·ä»£ç†',
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åŠŸèƒ½è¯´æ˜](./åŠŸèƒ½è¯´æ˜.md)
- [ç”¨æˆ·æ•…äº‹](./ç”¨æˆ·æ•…äº‹.md)
- [ä¸šåŠ¡æµç¨‹å›¾](./ä¸šåŠ¡æµç¨‹å›¾.md)
- [APIæ¥å£è®¾è®¡](./APIæ¥å£è®¾è®¡.md)
- [éªŒæ”¶æµ‹è¯•ç”¨ä¾‹](./éªŒæ”¶æµ‹è¯•ç”¨ä¾‹.md)

---

**ğŸ“ æ–‡æ¡£ä¿¡æ¯**
- **åˆ›å»ºäºº**: åŒºåŸŸæƒé™ç®¡ç†æ¨¡å—ç»„
- **å®¡æ ¸äºº**: æ•°æ®åº“æ¶æ„å¸ˆ
- **æœ€åæ›´æ–°**: 2025-12-17
- **ç‰ˆæœ¬**: v1.0.0