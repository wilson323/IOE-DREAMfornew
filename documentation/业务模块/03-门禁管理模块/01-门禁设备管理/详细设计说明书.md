# é—¨ç¦è®¾å¤‡ç®¡ç† - è¯¦ç»†è®¾è®¡è¯´æ˜ä¹¦

> **ç‰ˆæœ¬**: v1.0.0  
> **å¾®æœåŠ¡**: ioedream-access-service (8090)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“ æ¨¡å—å†…éƒ¨è®¾è®¡

### ç±»ç»“æ„

```
net.lab1024.sa.access/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ AccessDeviceController.java      # è®¾å¤‡ç®¡ç†æ¥å£
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ AccessDeviceService.java         # æœåŠ¡æ¥å£
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ AccessDeviceServiceImpl.java # æœåŠ¡å®ç°
â”œâ”€â”€ manager/
â”‚   â””â”€â”€ BiometricTemplateManager.java    # ç”Ÿç‰©æ¨¡æ¿ç®¡ç†
â”œâ”€â”€ dao/
â”‚   â””â”€â”€ AccessDeviceDao.java             # æ•°æ®è®¿é—®
â””â”€â”€ domain/
    â”œâ”€â”€ entity/
    â”‚   â””â”€â”€ AccessDeviceEntity.java      # è®¾å¤‡å®ä½“(common)
    â”œâ”€â”€ form/
    â”‚   â””â”€â”€ AccessDeviceAddForm.java     # æ–°å¢è¡¨å•
    â””â”€â”€ vo/
        â””â”€â”€ AccessDeviceVO.java          # è®¾å¤‡VO
```

### å…³é”®æ–¹æ³•

```java
// AccessDeviceServiceImpl.java
@Service
@Transactional(rollbackFor = Exception.class)
public class AccessDeviceServiceImpl implements AccessDeviceService {
    
    @Resource
    private AccessDeviceDao accessDeviceDao;
    
    /**
     * è¿œç¨‹æ§åˆ¶è®¾å¤‡
     * @param deviceId è®¾å¤‡ID
     * @param action æ§åˆ¶åŠ¨ä½œ(UNLOCK/LOCK/RESTART)
     * @return æ§åˆ¶ç»“æœ
     */
    public DeviceControlResultVO control(Long deviceId, String action) {
        // 1. éªŒè¯è®¾å¤‡åœ¨çº¿çŠ¶æ€
        // 2. ç»„è£…æ§åˆ¶æŒ‡ä»¤
        // 3. è°ƒç”¨è®¾å¤‡é€šè®¯æœåŠ¡
        // 4. è®°å½•æ“ä½œæ—¥å¿—
        // 5. è¿”å›æ‰§è¡Œç»“æœ
    }
}
```

---

## ğŸ“Š æ•°æ®åº“è¯¦ç»†è®¾è®¡

### è¡¨ç»“æ„: t_access_device

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | ä¸»é”® |
| device_name | VARCHAR(100) | NOT NULL | è®¾å¤‡åç§° |
| device_sn | VARCHAR(50) | UNIQUE | è®¾å¤‡åºåˆ—å· |
| ip_address | VARCHAR(50) | NOT NULL | IPåœ°å€ |
| port | INT | DEFAULT 8080 | ç«¯å£ |
| status | TINYINT | DEFAULT 0 | çŠ¶æ€(0ç¦»çº¿/1åœ¨çº¿) |
| area_id | BIGINT | FK | æ‰€å±åŒºåŸŸ |
| create_time | DATETIME | NOT NULL | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | NOT NULL | æ›´æ–°æ—¶é—´ |
| deleted_flag | TINYINT | DEFAULT 0 | åˆ é™¤æ ‡è®° |

### ç´¢å¼•è®¾è®¡

```sql
CREATE INDEX idx_device_sn ON t_access_device(device_sn);
CREATE INDEX idx_device_area ON t_access_device(area_id);
CREATE INDEX idx_device_status ON t_access_device(status);
```

---

## ğŸ”Œ æ¥å£è¯¦ç»†è®¾è®¡

### POST /api/access/v1/devices/{id}/control

**è¯·æ±‚å‚æ•°**:
```json
{
  "action": "UNLOCK",
  "duration": 5000,
  "reason": "è®¿å®¢é€šè¡Œ"
}
```

**å“åº”æ•°æ®**:
```json
{
  "code": 200,
  "data": {
    "deviceId": 1001,
    "action": "UNLOCK",
    "result": "SUCCESS",
    "executeTime": "2025-12-17T10:30:00Z"
  }
}
```

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 40001 | è®¾å¤‡ä¸å­˜åœ¨ |
| 40002 | è®¾å¤‡ç¦»çº¿ |
| 40003 | æ— æ§åˆ¶æƒé™ |
| 50001 | æ§åˆ¶å‘½ä»¤æ‰§è¡Œå¤±è´¥ |

---

## ğŸ–¥ï¸ ç•Œé¢è®¾è®¡

### è®¾å¤‡åˆ—è¡¨é¡µ

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| æœç´¢ | æ”¯æŒè®¾å¤‡åç§°ã€SNã€åŒºåŸŸç­›é€‰ |
| çŠ¶æ€ | åœ¨çº¿/ç¦»çº¿çŠ¶æ€æ ‡è¯† |
| æ“ä½œ | æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ã€è¿œç¨‹æ§åˆ¶ |
| æ‰¹é‡ | æ”¯æŒæ‰¹é‡å¯¼å…¥ã€å¯¼å‡º |

### è¿œç¨‹æ§åˆ¶å¼¹çª—

| å…ƒç´  | è¯´æ˜ |
|------|------|
| è®¾å¤‡ä¿¡æ¯ | æ˜¾ç¤ºè®¾å¤‡åç§°ã€çŠ¶æ€ |
| æ§åˆ¶é€‰é¡¹ | å¼€é—¨ã€å…³é—¨ã€é‡å¯ |
| åŸå› è¾“å…¥ | å¿…å¡«æ“ä½œåŸå›  |
| ç¡®è®¤æŒ‰é’® | äºŒæ¬¡ç¡®è®¤æ‰§è¡Œ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
