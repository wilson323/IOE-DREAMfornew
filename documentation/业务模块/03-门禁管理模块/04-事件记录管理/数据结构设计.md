# äº‹ä»¶è®°å½•ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    ACCESS_RECORD ||--o| ACCESS_DEVICE : from
    ACCESS_RECORD ||--o| USER : by
    ACCESS_RECORD ||--o| ACCESS_AREA : in
    ACCESS_RECORD ||--o{ ACCESS_PHOTO : has
    
    ACCESS_RECORD {
        bigint id PK
        bigint device_id FK
        bigint user_id FK
        bigint area_id FK
        string event_type
        string verify_method
        int result
        datetime event_time
        string photo_url
    }
    
    ACCESS_PHOTO {
        bigint id PK
        bigint record_id FK
        string photo_type
        string photo_url
        datetime capture_time
    }
```

---

## ğŸ“‹ è¡¨ç»“æ„è®¾è®¡

### t_access_record (é€šè¡Œè®°å½•è¡¨)

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| id | BIGINT | PK | ä¸»é”® |
| device_id | BIGINT | FK, NOT NULL | è®¾å¤‡ID |
| user_id | BIGINT | FK | ç”¨æˆ·ID |
| area_id | BIGINT | FK | åŒºåŸŸID |
| event_type | VARCHAR(50) | NOT NULL | äº‹ä»¶ç±»å‹ |
| verify_method | VARCHAR(30) | - | éªŒè¯æ–¹å¼(CARD/FACE/FP) |
| result | TINYINT | NOT NULL | ç»“æœ(1æˆåŠŸ/0å¤±è´¥) |
| fail_reason | VARCHAR(200) | - | å¤±è´¥åŸå›  |
| event_time | DATETIME | NOT NULL | äº‹ä»¶æ—¶é—´ |
| direction | VARCHAR(10) | - | æ–¹å‘(IN/OUT) |
| photo_url | VARCHAR(500) | - | æŠ“æ‹ç…§ç‰‡ |
| card_no | VARCHAR(50) | - | å¡å· |
| temperature | DECIMAL(4,1) | - | ä½“æ¸© |

---

## ğŸ”‘ ç´¢å¼•è®¾è®¡

```sql
CREATE INDEX idx_record_device ON t_access_record(device_id);
CREATE INDEX idx_record_user ON t_access_record(user_id);
CREATE INDEX idx_record_time ON t_access_record(event_time);
CREATE INDEX idx_record_area ON t_access_record(area_id);
CREATE INDEX idx_record_result ON t_access_record(result);
-- å¤åˆç´¢å¼•
CREATE INDEX idx_record_time_device ON t_access_record(event_time, device_id);
```

---

## ğŸ“¦ åˆ†åŒºç­–ç•¥

```sql
-- æŒ‰æœˆåˆ†åŒº
ALTER TABLE t_access_record PARTITION BY RANGE (TO_DAYS(event_time)) (
  PARTITION p202512 VALUES LESS THAN (TO_DAYS('2026-01-01')),
  PARTITION p202601 VALUES LESS THAN (TO_DAYS('2026-02-01'))
);
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
