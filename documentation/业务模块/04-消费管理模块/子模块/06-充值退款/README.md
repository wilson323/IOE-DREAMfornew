# 充值退款模块

> **版本**: v2.0.0  
> **更新日期**: 2025-12-17

---

## 1. 功能说明

安全可靠的资金管理，支持多种充值退款方式。

### 核心功能
- 多种充值方式（现金/微信/支付宝/银行卡）
- 充值赠送规则
- 退款申请与审批
- 完整资金流水

---

## 2. 用户故事

| 角色 | 故事 |
|------|------|
| 消费者 | 通过多种方式充值 |
| 消费者 | 申请退款 |
| 管理员 | 审批退款申请 |
| 财务 | 查看资金流水 |

---

## 3. 数据结构

### POSID_RECHARGE_ORDER 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | VARCHAR(50) | 订单ID |
| order_no | VARCHAR(32) | 订单号 |
| account_id | VARCHAR(50) | 账户ID |
| recharge_money | INT | 充值金额(分) |
| gift_money | INT | 赠送金额(分) |
| payment_type | VARCHAR(20) | 支付方式 |
| status | VARCHAR(20) | 状态 |

---

## 4. 充值流程

```
创建订单 --> 调用支付 --> 支付回调 --> 更新余额 --> 计算赠送 --> 记录流水
```

---

## 5. 退款流程

```
申请退款 --> 审批 --> 执行退款 --> 更新余额 --> 记录流水
```

---

## 6. 安全机制

- 幂等性控制
- 签名验证
- 对账机制
- 资金审计

---

*本文档持续更新中*

