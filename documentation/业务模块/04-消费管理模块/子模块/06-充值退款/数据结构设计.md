# å……å€¼é€€æ¬¾ - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_consume_recharge {
        bigint id PK "å……å€¼ID"
        varchar recharge_no "å……å€¼æµæ°´å·"
        bigint account_id FK "è´¦æˆ·ID"
        bigint user_id FK "ç”¨æˆ·ID"
        decimal amount "å……å€¼é‡‘é¢"
        varchar recharge_type "å……å€¼æ–¹å¼"
        varchar pay_channel "æ”¯ä»˜æ¸ é“"
        varchar pay_trade_no "æ”¯ä»˜æµæ°´å·"
        decimal balance_before "å……å€¼å‰ä½™é¢"
        decimal balance_after "å……å€¼åä½™é¢"
        tinyint status "çŠ¶æ€"
        bigint operator_id "æ“ä½œäººID"
        datetime recharge_time "å……å€¼æ—¶é—´"
    }
    
    t_consume_refund {
        bigint id PK "é€€æ¬¾ID"
        varchar refund_no "é€€æ¬¾æµæ°´å·"
        bigint account_id FK "è´¦æˆ·ID"
        bigint user_id FK "ç”¨æˆ·ID"
        decimal amount "é€€æ¬¾é‡‘é¢"
        varchar refund_type "é€€æ¬¾ç±»å‹"
        varchar refund_reason "é€€æ¬¾åŸå› "
        decimal balance_before "é€€æ¬¾å‰ä½™é¢"
        decimal balance_after "é€€æ¬¾åä½™é¢"
        tinyint status "çŠ¶æ€"
        bigint approver_id "å®¡æ‰¹äººID"
        datetime apply_time "ç”³è¯·æ—¶é—´"
        datetime approve_time "å®¡æ‰¹æ—¶é—´"
        datetime refund_time "é€€æ¬¾æ—¶é—´"
    }
    
    t_consume_account ||--o{ t_consume_recharge : "å……å€¼"
    t_consume_account ||--o{ t_consume_refund : "é€€æ¬¾"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_consume_recharge (å……å€¼è®°å½•è¡¨)

```sql
CREATE TABLE t_consume_recharge (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å……å€¼ID',
    recharge_no VARCHAR(32) NOT NULL COMMENT 'å……å€¼æµæ°´å·',
    account_id BIGINT NOT NULL COMMENT 'è´¦æˆ·ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    amount DECIMAL(10,2) NOT NULL COMMENT 'å……å€¼é‡‘é¢',
    recharge_type VARCHAR(20) NOT NULL COMMENT 'å……å€¼æ–¹å¼:CASH/ONLINE/TRANSFER',
    pay_channel VARCHAR(20) COMMENT 'æ”¯ä»˜æ¸ é“:WECHAT/ALIPAY/BANK',
    pay_trade_no VARCHAR(64) COMMENT 'æ”¯ä»˜æµæ°´å·',
    balance_before DECIMAL(10,2) NOT NULL COMMENT 'å……å€¼å‰ä½™é¢',
    balance_after DECIMAL(10,2) NOT NULL COMMENT 'å……å€¼åä½™é¢',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0å¾…ç¡®è®¤1æˆåŠŸ2å¤±è´¥',
    operator_id BIGINT COMMENT 'æ“ä½œäººID',
    operator_name VARCHAR(50) COMMENT 'æ“ä½œäººå§“å',
    recharge_time DATETIME NOT NULL COMMENT 'å……å€¼æ—¶é—´',
    remark VARCHAR(200) COMMENT 'å¤‡æ³¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    UNIQUE KEY uk_recharge_no (recharge_no),
    INDEX idx_user_id (user_id),
    INDEX idx_account_id (account_id),
    INDEX idx_recharge_time (recharge_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å……å€¼è®°å½•è¡¨';
```

### t_consume_refund (é€€æ¬¾è®°å½•è¡¨)

```sql
CREATE TABLE t_consume_refund (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é€€æ¬¾ID',
    refund_no VARCHAR(32) NOT NULL COMMENT 'é€€æ¬¾æµæ°´å·',
    account_id BIGINT NOT NULL COMMENT 'è´¦æˆ·ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    amount DECIMAL(10,2) NOT NULL COMMENT 'é€€æ¬¾é‡‘é¢',
    refund_type VARCHAR(20) NOT NULL COMMENT 'é€€æ¬¾ç±»å‹:FULL/PARTIAL',
    refund_reason VARCHAR(200) NOT NULL COMMENT 'é€€æ¬¾åŸå› ',
    balance_before DECIMAL(10,2) NOT NULL COMMENT 'é€€æ¬¾å‰ä½™é¢',
    balance_after DECIMAL(10,2) COMMENT 'é€€æ¬¾åä½™é¢',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€:0å¾…å®¡æ‰¹1å®¡æ‰¹é€šè¿‡2å®¡æ‰¹æ‹’ç»3å·²é€€æ¬¾',
    applicant_id BIGINT NOT NULL COMMENT 'ç”³è¯·äººID',
    approver_id BIGINT COMMENT 'å®¡æ‰¹äººID',
    apply_time DATETIME NOT NULL COMMENT 'ç”³è¯·æ—¶é—´',
    approve_time DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    refund_time DATETIME COMMENT 'é€€æ¬¾æ—¶é—´',
    reject_reason VARCHAR(200) COMMENT 'æ‹’ç»åŸå› ',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    UNIQUE KEY uk_refund_no (refund_no),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_apply_time (apply_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€€æ¬¾è®°å½•è¡¨';
```

---

## ğŸ”§ çŠ¶æ€æšä¸¾

### å……å€¼çŠ¶æ€

| å€¼ | è¯´æ˜ |
|------|------|
| 0 | å¾…ç¡®è®¤ |
| 1 | å……å€¼æˆåŠŸ |
| 2 | å……å€¼å¤±è´¥ |

### é€€æ¬¾çŠ¶æ€

| å€¼ | è¯´æ˜ |
|------|------|
| 0 | å¾…å®¡æ‰¹ |
| 1 | å®¡æ‰¹é€šè¿‡ |
| 2 | å®¡æ‰¹æ‹’ç» |
| 3 | å·²é€€æ¬¾ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
