# 区域权限模块

> **版本**: v2.0.0  
> **更新日期**: 2025-12-17

---

## 1. 功能说明

通过账户类别的area_config配置区域消费权限。

### 核心功能
- 账户类别区域权限配置
- 子区域权限继承
- 权限验证
- Redis反向索引加速

---

## 2. 用户故事

| 角色 | 故事 |
|------|------|
| 管理员 | 为账户类别配置可消费区域 |
| 管理员 | 配置是否包含子区域 |
| 系统 | 消费时验证区域权限 |

---

## 3. 数据结构

### area_config JSON结构

```json
[
  {
    "areaId": "main_campus",
    "includeSubAreas": true
  },
  {
    "areaId": "canteen_1",
    "includeSubAreas": false
  }
]
```

---

## 4. 权限验证流程

```
消费请求 --> 获取账户类别 --> 解析area_config --> 检查目标区域 --> 验证结果
```

---

## 5. 补偿机制

- Redis反向索引：区域→账户类别映射
- 统计表：POSID_AREA_USAGE_STAT
- 应急SQL视图

---

*本文档持续更新中*

