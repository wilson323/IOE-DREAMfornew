# åŒºåŸŸç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_consume_area {
        bigint id PK "åŒºåŸŸID"
        varchar area_name "åŒºåŸŸåç§°"
        varchar area_code "åŒºåŸŸç¼–ç "
        bigint parent_id FK "çˆ¶åŒºåŸŸID"
        varchar full_path "å®Œæ•´è·¯å¾„"
        int area_type "åŒºåŸŸç±»å‹"
        int manage_mode "ç»è¥æ¨¡å¼"
        int area_sub_type "ç»†åˆ†ç±»å‹"
        json fixed_value_config "å®šå€¼é…ç½®"
        json meal_categories "é¤åˆ«åˆ†ç±»"
        tinyint inventory_flag "åº“å­˜æ ‡è®°"
        time open_time "è¥ä¸šå¼€å§‹"
        time close_time "è¥ä¸šç»“æŸ"
        int sort_order "æ’åº"
        tinyint status "çŠ¶æ€"
    }
    
    t_consume_area_device {
        bigint id PK "å…³è”ID"
        bigint area_id FK "åŒºåŸŸID"
        bigint device_id FK "è®¾å¤‡ID"
        varchar device_sn "è®¾å¤‡åºåˆ—å·"
        tinyint status "çŠ¶æ€"
    }
    
    t_consume_area ||--o{ t_consume_area : "çˆ¶å­"
    t_consume_area ||--o{ t_consume_area_device : "è®¾å¤‡"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_consume_area (æ¶ˆè´¹åŒºåŸŸè¡¨)

```sql
CREATE TABLE t_consume_area (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'åŒºåŸŸID',
    area_name VARCHAR(100) NOT NULL COMMENT 'åŒºåŸŸåç§°',
    area_code VARCHAR(50) NOT NULL COMMENT 'åŒºåŸŸç¼–ç ',
    parent_id BIGINT DEFAULT 0 COMMENT 'çˆ¶åŒºåŸŸID,0ä¸ºé¡¶çº§',
    full_path VARCHAR(500) COMMENT 'å®Œæ•´è·¯å¾„,å¦‚/1/2/3/',
    level INT DEFAULT 1 COMMENT 'å±‚çº§',
    
    -- åŒºåŸŸç±»å‹
    area_type INT NOT NULL COMMENT 'åŒºåŸŸç±»å‹:1é¤é¥®2è¶…å¸‚3è‡ªåŠ©',
    manage_mode INT NOT NULL COMMENT 'ç»è¥æ¨¡å¼:1é¤åˆ«åˆ¶2è¶…å¸‚åˆ¶3æ··åˆ',
    area_sub_type INT COMMENT 'ç»†åˆ†ç±»å‹',
    
    -- å®šå€¼é…ç½®
    fixed_value_config JSON COMMENT 'å®šå€¼é…ç½®JSON',
    
    -- é¤åˆ«é…ç½®
    meal_categories JSON COMMENT 'å…è®¸é¤åˆ«åˆ†ç±»IDs JSONæ•°ç»„',
    
    -- åº“å­˜é…ç½®
    inventory_flag TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å¯ç”¨åº“å­˜:0å¦1æ˜¯',
    
    -- è¥ä¸šæ—¶é—´
    open_time TIME COMMENT 'è¥ä¸šå¼€å§‹æ—¶é—´',
    close_time TIME COMMENT 'è¥ä¸šç»“æŸæ—¶é—´',
    
    -- å…¶ä»–
    address VARCHAR(200) COMMENT 'åŒºåŸŸåœ°å€',
    contact_name VARCHAR(50) COMMENT 'è´Ÿè´£äºº',
    contact_phone VARCHAR(20) COMMENT 'è”ç³»ç”µè¯',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    
    UNIQUE KEY uk_area_code (area_code),
    INDEX idx_parent_id (parent_id),
    INDEX idx_area_type (area_type),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¶ˆè´¹åŒºåŸŸè¡¨';
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç»è¥æ¨¡å¼(manage_mode)

| å€¼ | è¯´æ˜ | æ¶ˆè´¹æ–¹å¼ |
|------|------|----------|
| 1 | é¤åˆ«åˆ¶ | å®šå€¼æ¶ˆè´¹ï¼ŒæŒ‰é¤åˆ«é…ç½®å›ºå®šé‡‘é¢ |
| 2 | è¶…å¸‚åˆ¶ | å•†å“æ‰«ç ï¼ŒæŒ‰å•†å“ä»·æ ¼è®¡ç®— |
| 3 | æ··åˆæ¨¡å¼ | æ”¯æŒå®šå€¼å’Œå•†å“æ‰«ç  |

### fixed_value_config é…ç½®ç¤ºä¾‹

```json
{
  "breakfast": {"amount": 5.00, "unit": "å…ƒ"},
  "lunch": {"amount": 12.00, "unit": "å…ƒ"},
  "dinner": {"amount": 10.00, "unit": "å…ƒ"},
  "supper": {"amount": 8.00, "unit": "å…ƒ"}
}
```

### meal_categories é…ç½®ç¤ºä¾‹

```json
["1", "2", "3"]
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
