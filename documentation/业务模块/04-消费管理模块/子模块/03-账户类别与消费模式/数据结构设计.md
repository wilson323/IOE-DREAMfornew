# è´¦æˆ·ç±»åˆ«ä¸æ¶ˆè´¹æ¨¡å¼ - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_consume_account_kind {
        bigint id PK "ç±»åˆ«ID"
        varchar kind_name "ç±»åˆ«åç§°"
        varchar kind_code "ç±»åˆ«ç¼–ç "
        tinyint is_attendance_consume "æ˜¯å¦è€ƒå‹¤æ¶ˆè´¹"
        json mode_config "æ¶ˆè´¹æ¨¡å¼é…ç½®"
        json area_config "åŒºåŸŸæƒé™é…ç½®"
        decimal daily_limit "æ—¥é™é¢"
        decimal monthly_limit "æœˆé™é¢"
        decimal single_limit "å•æ¬¡é™é¢"
        tinyint allow_overdraft "å…è®¸é€æ”¯"
        decimal overdraft_limit "é€æ”¯é¢åº¦"
        tinyint status "çŠ¶æ€"
    }
    
    t_consume_account {
        bigint id PK "è´¦æˆ·ID"
        varchar account_no "è´¦æˆ·å·"
        bigint user_id FK "ç”¨æˆ·ID"
        bigint kind_id FK "ç±»åˆ«ID"
        decimal balance "ä½™é¢"
        decimal frozen_amount "å†»ç»“é‡‘é¢"
        tinyint status "çŠ¶æ€"
    }
    
    t_consume_account_kind ||--o{ t_consume_account : "ç±»åˆ«"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_consume_account_kind (è´¦æˆ·ç±»åˆ«è¡¨)

```sql
CREATE TABLE t_consume_account_kind (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç±»åˆ«ID',
    kind_name VARCHAR(100) NOT NULL COMMENT 'ç±»åˆ«åç§°',
    kind_code VARCHAR(50) NOT NULL COMMENT 'ç±»åˆ«ç¼–ç ',
    
    -- è€ƒå‹¤æ¶ˆè´¹æ ‡è¯†
    is_attendance_consume TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ä½œä¸ºè€ƒå‹¤æ¶ˆè´¹:0å¦1æ˜¯',
    
    -- æ¶ˆè´¹æ¨¡å¼é…ç½®
    mode_config JSON COMMENT 'æ¶ˆè´¹æ¨¡å¼é…ç½®JSON',
    
    -- åŒºåŸŸæƒé™é…ç½®
    area_config JSON COMMENT 'åŒºåŸŸæƒé™é…ç½®JSONæ•°ç»„',
    
    -- é™é¢é…ç½®
    daily_limit DECIMAL(10,2) DEFAULT 200.00 COMMENT 'æ—¥é™é¢',
    monthly_limit DECIMAL(10,2) DEFAULT 3000.00 COMMENT 'æœˆé™é¢',
    single_limit DECIMAL(10,2) DEFAULT 100.00 COMMENT 'å•æ¬¡é™é¢',
    
    -- é€æ”¯é…ç½®
    allow_overdraft TINYINT DEFAULT 0 COMMENT 'å…è®¸é€æ”¯:0å¦1æ˜¯',
    overdraft_limit DECIMAL(10,2) DEFAULT 0.00 COMMENT 'é€æ”¯é¢åº¦',
    
    -- è¡¥è´´é…ç½®
    subsidy_enabled TINYINT DEFAULT 0 COMMENT 'å¯ç”¨è¡¥è´´:0å¦1æ˜¯',
    subsidy_priority TINYINT DEFAULT 1 COMMENT 'è¡¥è´´ä¼˜å…ˆæ‰£æ¬¾:0å¦1æ˜¯',
    
    -- æŠ˜æ‰£é…ç½®
    discount_rate DECIMAL(3,2) DEFAULT 1.00 COMMENT 'æŠ˜æ‰£ç‡(0.00-1.00)',
    
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    
    UNIQUE KEY uk_kind_code (kind_code),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è´¦æˆ·ç±»åˆ«è¡¨';
```

### t_consume_account (æ¶ˆè´¹è´¦æˆ·è¡¨)

```sql
CREATE TABLE t_consume_account (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è´¦æˆ·ID',
    account_no VARCHAR(32) NOT NULL COMMENT 'è´¦æˆ·å·',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    user_name VARCHAR(50) COMMENT 'ç”¨æˆ·å§“å',
    kind_id BIGINT NOT NULL COMMENT 'è´¦æˆ·ç±»åˆ«ID',
    
    -- ä½™é¢
    balance DECIMAL(10,2) DEFAULT 0.00 COMMENT 'è´¦æˆ·ä½™é¢',
    frozen_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT 'å†»ç»“é‡‘é¢',
    
    -- ç»Ÿè®¡
    total_recharge DECIMAL(12,2) DEFAULT 0.00 COMMENT 'ç´¯è®¡å……å€¼',
    total_consume DECIMAL(12,2) DEFAULT 0.00 COMMENT 'ç´¯è®¡æ¶ˆè´¹',
    
    -- çŠ¶æ€
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1æ­£å¸¸2å†»ç»“',
    
    -- ç»‘å®šä¿¡æ¯
    card_no VARCHAR(50) COMMENT 'å¡å·',
    
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    version INT DEFAULT 0 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',
    
    UNIQUE KEY uk_account_no (account_no),
    INDEX idx_user_id (user_id),
    INDEX idx_kind_id (kind_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¶ˆè´¹è´¦æˆ·è¡¨';
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### mode_config æ¶ˆè´¹æ¨¡å¼é…ç½®

```json
{
  "mode": "FIXED_AMOUNT",
  "values": {
    "breakfast": {"amount": 8.00, "unit": "å…ƒ", "remark": "VIPæ—©é¤æ ‡å‡†"},
    "lunch": {"amount": 15.00, "unit": "å…ƒ", "remark": "VIPåˆé¤æ ‡å‡†"}
  }
}
```

### area_config åŒºåŸŸæƒé™é…ç½®

```json
[
  {
    "areaId": "100",
    "areaName": "ä¸€é£Ÿå ‚",
    "includeSubAreas": true,
    "allowedMeals": ["breakfast", "lunch", "dinner"]
  },
  {
    "areaId": "200",
    "areaName": "ä¾¿åˆ©åº—",
    "includeSubAreas": false
  }
]
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
