# æ¶ˆè´¹å¤„ç† - ä¸šåŠ¡æµç¨‹å›¾

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š å®Œæ•´æ¶ˆè´¹æµç¨‹ï¼ˆ7æ­¥æ ‡å‡†æµç¨‹ï¼‰

```mermaid
flowchart TD
    A[å¼€å§‹æ¶ˆè´¹] --> B[1.èº«ä»½è¯†åˆ«]
    B --> C[åˆ·å¡/åˆ·è„¸/æ‰«ç ]
    C --> D[è·å–è´¦æˆ·ä¿¡æ¯]
    
    D --> E[2.æƒé™éªŒè¯]
    E --> F{éªŒè¯é€šè¿‡?}
    F -->|å¦| G[è¿”å›å¤±è´¥åŸå› ]
    F -->|æ˜¯| H[3.åœºæ™¯è¯†åˆ«]
    
    H --> I{æ¶ˆè´¹æ¨¡å¼?}
    I -->|å®šå€¼æ¨¡å¼| J[å®šå€¼é‡‘é¢è®¡ç®—]
    I -->|é‡‘é¢æ¨¡å¼| K[è¾“å…¥æ¶ˆè´¹é‡‘é¢]
    I -->|å•†å“æ¨¡å¼| L[é€‰æ‹©å•†å“]
    I -->|è®¡æ¬¡æ¨¡å¼| M[å›ºå®šè®¡æ¬¡]
    
    J --> N[4.é‡‘é¢è®¡ç®—]
    K --> N
    L --> N
    M --> N
    
    N --> O[åº”ç”¨æŠ˜æ‰£]
    O --> P[è®¡ç®—æœ€ç»ˆé‡‘é¢]
    
    P --> Q[5.ä½™é¢æ‰£é™¤]
    Q --> R{æ‰£æ¬¾é¡ºåº}
    R --> S[ä¼˜å…ˆæ‰£è¡¥è´´é’±åŒ…]
    S --> T[ä¸è¶³æ‰£ç°é‡‘é’±åŒ…]
    
    T --> U{ä½™é¢å……è¶³?}
    U -->|å¦| V[æ‰£æ¬¾å¤±è´¥,å›æ»š]
    U -->|æ˜¯| W[6.è®°å½•äº¤æ˜“]
    
    W --> X[å†™å…¥äº¤æ˜“è¡¨]
    X --> Y[æ›´æ–°è´¦æˆ·ä½™é¢]
    Y --> Z[æ›´æ–°æ¶ˆè´¹æ¬¡æ•°]
    Z --> AA[æ›´æ–°ç»Ÿè®¡æ•°æ®]
    
    AA --> AB[7.æ‰“å°å°ç¥¨]
    AB --> AC[è¿”å›æˆåŠŸ]
    
    V --> AD[è¿”å›ä½™é¢ä¸è¶³]
    
    style G fill:#ff6b6b
    style V fill:#ff6b6b
    style AD fill:#ff6b6b
    style AC fill:#51cf66
```

---

## ğŸ“Š æ¶ˆè´¹æ¨¡å¼åˆ¤æ–­æµç¨‹ï¼ˆåŸºäºåŒºåŸŸç»è¥æ¨¡å¼ï¼‰

```mermaid
flowchart TD
    A[è·å–åŒºåŸŸä¿¡æ¯] --> B[è¯»å–manage_mode]
    B --> C{ç»è¥æ¨¡å¼åˆ¤æ–­}
    
    C -->|1-é¤åˆ«åˆ¶| D{å½“å‰æ—¶é—´æ®µ}
    D -->|å°±é¤æ—¶é—´| E[è·å–é¤åˆ«ä¿¡æ¯]
    E --> F{æ£€æŸ¥å®šå€¼é…ç½®}
    F -->|åŒºåŸŸæœ‰fixed_value_config| G[ä½¿ç”¨åŒºåŸŸé»˜è®¤å®šå€¼]
    F -->|è´¦æˆ·ç±»åˆ«æœ‰mode_config| H[ä½¿ç”¨è´¦æˆ·ç±»åˆ«å®šå€¼]
    F -->|ä¸¤è€…éƒ½æœ‰| I[è´¦æˆ·ç±»åˆ«è¦†ç›–åŒºåŸŸé»˜è®¤]
    G --> J[å®šå€¼æ¨¡å¼æ¶ˆè´¹]
    H --> J
    I --> J
    D -->|éå°±é¤æ—¶é—´| K[è‡ªç”±é‡‘é¢æ¨¡å¼]
    
    C -->|2-è¶…å¸‚åˆ¶| L[å•†å“æ‰«ç æ¨¡å¼]
    L --> M[æ‰«æå•†å“æ¡ç ]
    M --> N[æŸ¥è¯¢å•†å“ä»·æ ¼]
    N --> O[è®¡ç®—å•†å“æ€»é¢]
    
    C -->|3-æ··åˆæ¨¡å¼| P{ç”¨æˆ·é€‰æ‹©}
    P -->|é¤åˆ«æ¶ˆè´¹| D
    P -->|å•†å“æ¶ˆè´¹| L
    
    J --> Q[è¿›å…¥é‡‘é¢è®¡ç®—]
    K --> Q
    O --> Q
    
    style J fill:#51cf66
    style O fill:#74b9ff
    style Q fill:#ffd93d
```

**æ ¸å¿ƒé€»è¾‘è¯´æ˜**ï¼š

1. **é¤åˆ«åˆ¶ï¼ˆmanage_mode=1ï¼‰**ï¼š
   - æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦åœ¨å°±é¤æ—¶é—´æ®µå†…
   - ä¼˜å…ˆä½¿ç”¨è´¦æˆ·ç±»åˆ«çš„`mode_config`å®šå€¼é…ç½®
   - å¦‚æœè´¦æˆ·ç±»åˆ«æœªé…ç½®ï¼Œä½¿ç”¨åŒºåŸŸçš„`fixed_value_config`é»˜è®¤å®šå€¼
   - éå°±é¤æ—¶é—´æ®µï¼Œé™çº§ä¸ºè‡ªç”±é‡‘é¢æ¨¡å¼

2. **è¶…å¸‚åˆ¶ï¼ˆmanage_mode=2ï¼‰**ï¼š
   - ç›´æ¥è¿›å…¥å•†å“æ‰«ç æµç¨‹
   - ä»å•†å“åº“æŸ¥è¯¢ä»·æ ¼
   - ç´¯è®¡å¤šä¸ªå•†å“çš„æ€»ä»·

3. **æ··åˆæ¨¡å¼ï¼ˆmanage_mode=3ï¼‰**ï¼š
   - ç”±ç”¨æˆ·æˆ–è®¾å¤‡é€‰æ‹©æ¶ˆè´¹æ–¹å¼
   - æ”¯æŒé¤åˆ«å®šå€¼æ¶ˆè´¹å’Œå•†å“æ‰«ç æ¶ˆè´¹
   - åŒä¸€ç¬”äº¤æ˜“å¯æ··åˆä¸¤ç§æ–¹å¼

---

## ğŸ“Š SAGAåˆ†å¸ƒå¼äº‹åŠ¡æµç¨‹

```mermaid
sequenceDiagram
    participant C as æ¶ˆè´¹è¯·æ±‚
    participant O as äº‹åŠ¡ç¼–æ’å™¨
    participant P as æƒé™æœåŠ¡
    participant A as è´¦æˆ·æœåŠ¡
    participant T as äº¤æ˜“æœåŠ¡
    participant S as ç»Ÿè®¡æœåŠ¡
    
    C->>O: å‘èµ·æ¶ˆè´¹è¯·æ±‚
    
    Note over O: SAGAäº‹åŠ¡å¼€å§‹
    
    O->>P: Step1: æƒé™éªŒè¯
    P-->>O: éªŒè¯é€šè¿‡
    
    O->>A: Step2: é”å®šä½™é¢
    A-->>O: ä½™é¢é”å®šæˆåŠŸ
    
    O->>A: Step3: æ‰£é™¤ä½™é¢
    A-->>O: æ‰£æ¬¾æˆåŠŸ
    
    O->>T: Step4: è®°å½•äº¤æ˜“
    T-->>O: äº¤æ˜“è®°å½•æˆåŠŸ
    
    O->>S: Step5: æ›´æ–°ç»Ÿè®¡
    S--xO: ç»Ÿè®¡æ›´æ–°å¤±è´¥
    
    Note over O: è§¦å‘è¡¥å¿äº‹åŠ¡
    
    O->>T: Compensate4: åˆ é™¤äº¤æ˜“è®°å½•
    T-->>O: è¡¥å¿æˆåŠŸ
    
    O->>A: Compensate3: é€€è¿˜ä½™é¢
    A-->>O: è¡¥å¿æˆåŠŸ
    
    O->>A: Compensate2: é‡Šæ”¾é”å®š
    A-->>O: è¡¥å¿æˆåŠŸ
    
    O-->>C: è¿”å›å¤±è´¥(ç»Ÿè®¡æ›´æ–°å¤±è´¥)
```

---

## ğŸ“Š è¡¥è´´æ‰£æ¬¾æµç¨‹

```mermaid
flowchart TD
    A[å¼€å§‹æ‰£æ¬¾] --> B[æŸ¥è¯¢è´¦æˆ·è¡¥è´´åˆ—è¡¨]
    B --> C{æœ‰å¯ç”¨è¡¥è´´?}
    
    C -->|å¦| D[ç›´æ¥æ‰£ä¸»è´¦æˆ·ä½™é¢]
    C -->|æ˜¯| E[æŒ‰ä¼˜å…ˆçº§æ’åºè¡¥è´´]
    
    E --> F[æ’åºè§„åˆ™]
    F --> G[1. æœ‰æ•ˆæœŸæœ€è¿‘çš„ä¼˜å…ˆ]
    G --> H[2. å³å°†è¿‡æœŸçš„ä¼˜å…ˆ]
    H --> I[3. é‡‘é¢å°çš„ä¼˜å…ˆç”¨å®Œ]
    
    I --> J{éå†è¡¥è´´è´¦æˆ·}
    J --> K[å½“å‰è¡¥è´´è´¦æˆ·]
    
    K --> L{è¡¥è´´å¯ç”¨?}
    L -->|å¦| M[è·³è¿‡æ­¤è¡¥è´´]
    L -->|æ˜¯| N[æ£€æŸ¥ä½¿ç”¨é™åˆ¶]
    
    N --> O{åŒºåŸŸé™åˆ¶?}
    O -->|é™åˆ¶ä¸”ä¸åŒ¹é…| M
    O -->|ä¸é™åˆ¶æˆ–åŒ¹é…| P{é¤åˆ«é™åˆ¶?}
    
    P -->|é™åˆ¶ä¸”ä¸åŒ¹é…| M
    P -->|ä¸é™åˆ¶æˆ–åŒ¹é…| Q{æœ€ä½æ¶ˆè´¹é‡‘é¢?}
    
    Q -->|ä¸æ»¡è¶³| M
    Q -->|æ»¡è¶³| R[è®¡ç®—å¯æ‰£é‡‘é¢]
    
    R --> S{è¡¥è´´ä½™é¢>=åº”ä»˜é‡‘é¢?}
    S -->|æ˜¯| T[å…¨é¢ä»è¡¥è´´æ‰£]
    S -->|å¦| U[éƒ¨åˆ†ä»è¡¥è´´æ‰£]
    
    T --> V[æ‰£æ¬¾å®Œæˆ]
    U --> W[è®°å½•å·²æ‰£é‡‘é¢]
    W --> X{è¿˜æœ‰æœªæ‰£é‡‘é¢?}
    
    X -->|æ˜¯| Y{è¿˜æœ‰å…¶ä»–è¡¥è´´?}
    Y -->|æ˜¯| J
    Y -->|å¦| Z[å‰©ä½™ä»ä¸»è´¦æˆ·æ‰£]
    
    X -->|å¦| V
    M --> Y
    
    D --> AA{ä¸»è´¦æˆ·ä½™é¢å……è¶³?}
    Z --> AA
    AA -->|å¦| AB[æ‰£æ¬¾å¤±è´¥]
    AA -->|æ˜¯| AC[ä»ä¸»è´¦æˆ·æ‰£æ¬¾]
    
    AC --> V
    
    style AB fill:#ff6b6b
    style V fill:#51cf66
```

---

## ğŸ“Š æ¶ˆè´¹æ’¤é”€æµç¨‹

```mermaid
flowchart TD
    A[æ’¤é”€ç”³è¯·] --> B{æ’¤é”€æ—¶é—´}
    B -->|5åˆ†é’Ÿå†…| C[å³æ—¶æ’¤é”€]
    B -->|è¶…è¿‡5åˆ†é’Ÿ| D[å‘èµ·å®¡æ‰¹]
    
    C --> E[éªŒè¯åŸäº¤æ˜“]
    E --> F{äº¤æ˜“æœ‰æ•ˆ}
    F -->|æ˜¯| G[æ‰§è¡Œæ’¤é”€]
    F -->|å¦| Z1[æ’¤é”€å¤±è´¥]
    
    D --> H[OAå®¡æ‰¹æµç¨‹]
    H --> I{å®¡æ‰¹ç»“æœ}
    I -->|é€šè¿‡| G
    I -->|æ‹’ç»| Z2[å®¡æ‰¹æ‹’ç»]
    
    G --> J[å›é€€ä½™é¢]
    J --> K[æ›´æ–°äº¤æ˜“çŠ¶æ€]
    K --> L[æ›´æ–°ç»Ÿè®¡æ•°æ®]
    L --> M[æ’¤é”€å®Œæˆ]
    
    Z1 --> END[ç»“æŸ]
    Z2 --> END
    M --> END
```

---

## ğŸ“Š å¼‚å¸¸è¡¥å¿ç­–ç•¥

```mermaid
flowchart LR
    A[äº¤æ˜“å¤±è´¥] --> B{å“ªä¸€æ­¥å¤±è´¥?}
    B -->|æƒé™éªŒè¯å¤±è´¥| C[æ— éœ€è¡¥å¿]
    B -->|ä½™é¢æ‰£é™¤å¤±è´¥| D[é‡Šæ”¾ä½™é¢é”]
    B -->|è®°å½•äº¤æ˜“å¤±è´¥| E[é€€è¿˜ä½™é¢]
    B -->|ç»Ÿè®¡æ›´æ–°å¤±è´¥| F[å¼‚æ­¥é‡è¯•]
    
    style C fill:#51cf66
    style D fill:#ffd93d
    style E fill:#ff6b6b
    style F fill:#74b9ff
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
