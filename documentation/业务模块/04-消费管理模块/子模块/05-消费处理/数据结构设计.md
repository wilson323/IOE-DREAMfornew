# æ¶ˆè´¹å¤„ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_consume_record {
        bigint id PK "æ¶ˆè´¹è®°å½•ID"
        varchar trade_no "äº¤æ˜“æµæ°´å·"
        bigint account_id FK "è´¦æˆ·ID"
        bigint user_id FK "ç”¨æˆ·ID"
        bigint area_id FK "æ¶ˆè´¹åŒºåŸŸID"
        bigint device_id FK "è®¾å¤‡ID"
        varchar meal_type "é¤åˆ«ç±»å‹"
        decimal amount "æ¶ˆè´¹é‡‘é¢"
        decimal balance_before "æ¶ˆè´¹å‰ä½™é¢"
        decimal balance_after "æ¶ˆè´¹åä½™é¢"
        varchar consume_type "æ¶ˆè´¹æ–¹å¼"
        datetime consume_time "æ¶ˆè´¹æ—¶é—´"
        tinyint status "çŠ¶æ€"
        varchar remark "å¤‡æ³¨"
    }
    
    t_consume_account {
        bigint id PK "è´¦æˆ·ID"
        bigint user_id FK "ç”¨æˆ·ID"
        varchar account_type "è´¦æˆ·ç±»å‹"
        decimal balance "ä½™é¢"
        decimal frozen_amount "å†»ç»“é‡‘é¢"
        tinyint status "çŠ¶æ€"
    }
    
    t_consume_limit {
        bigint id PK "é™é¢ID"
        bigint account_id FK "è´¦æˆ·ID"
        decimal single_limit "å•æ¬¡é™é¢"
        decimal daily_limit "æ—¥é™é¢"
        decimal monthly_limit "æœˆé™é¢"
        decimal used_today "ä»Šæ—¥å·²ç”¨"
        decimal used_month "æœ¬æœˆå·²ç”¨"
    }
    
    t_consume_account ||--o{ t_consume_record : "æ¶ˆè´¹"
    t_consume_account ||--|| t_consume_limit : "é™é¢"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_consume_record (æ¶ˆè´¹è®°å½•è¡¨)

```sql
CREATE TABLE t_consume_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ¶ˆè´¹è®°å½•ID',
    trade_no VARCHAR(32) NOT NULL COMMENT 'äº¤æ˜“æµæ°´å·',
    account_id BIGINT NOT NULL COMMENT 'è´¦æˆ·ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    area_id BIGINT NOT NULL COMMENT 'æ¶ˆè´¹åŒºåŸŸID',
    device_id BIGINT COMMENT 'è®¾å¤‡ID',
    device_sn VARCHAR(50) COMMENT 'è®¾å¤‡åºåˆ—å·',
    meal_type VARCHAR(20) COMMENT 'é¤åˆ«ç±»å‹:BREAKFAST/LUNCH/DINNER/SNACK',
    amount DECIMAL(10,2) NOT NULL COMMENT 'æ¶ˆè´¹é‡‘é¢',
    balance_before DECIMAL(10,2) NOT NULL COMMENT 'æ¶ˆè´¹å‰ä½™é¢',
    balance_after DECIMAL(10,2) NOT NULL COMMENT 'æ¶ˆè´¹åä½™é¢',
    consume_type VARCHAR(20) NOT NULL COMMENT 'æ¶ˆè´¹æ–¹å¼:CARD/FACE/QR/FINGER',
    consume_time DATETIME NOT NULL COMMENT 'æ¶ˆè´¹æ—¶é—´',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1æ­£å¸¸2æ’¤é”€',
    cancel_time DATETIME COMMENT 'æ’¤é”€æ—¶é—´',
    cancel_reason VARCHAR(200) COMMENT 'æ’¤é”€åŸå› ',
    remark VARCHAR(200) COMMENT 'å¤‡æ³¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    UNIQUE KEY uk_trade_no (trade_no),
    INDEX idx_user_id (user_id),
    INDEX idx_account_id (account_id),
    INDEX idx_consume_time (consume_time),
    INDEX idx_area_id (area_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¶ˆè´¹è®°å½•è¡¨';
```

### t_consume_limit (æ¶ˆè´¹é™é¢è¡¨)

```sql
CREATE TABLE t_consume_limit (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é™é¢ID',
    account_id BIGINT NOT NULL COMMENT 'è´¦æˆ·ID',
    single_limit DECIMAL(10,2) DEFAULT 100.00 COMMENT 'å•æ¬¡é™é¢',
    daily_limit DECIMAL(10,2) DEFAULT 200.00 COMMENT 'æ—¥é™é¢',
    monthly_limit DECIMAL(10,2) DEFAULT 3000.00 COMMENT 'æœˆé™é¢',
    used_today DECIMAL(10,2) DEFAULT 0.00 COMMENT 'ä»Šæ—¥å·²ç”¨é‡‘é¢',
    used_month DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æœ¬æœˆå·²ç”¨é‡‘é¢',
    last_reset_date DATE COMMENT 'ä¸Šæ¬¡é‡ç½®æ—¥æœŸ',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_account_id (account_id),
    FOREIGN KEY (account_id) REFERENCES t_consume_account(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¶ˆè´¹é™é¢è¡¨';
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
