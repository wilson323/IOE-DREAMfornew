# 消费管理模块 - 移动端详细设计

> **版本**: v1.0.0  
> **创建日期**: 2025-12-17

---

## 📋 移动端功能清单

### 核心功能

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 余额查询 | 查看账户余额和补贴余额 | P0 |
| 消费记录 | 查看个人消费明细 | P0 |
| 扫码消费 | 二维码付款消费 | P0 |
| 在线充值 | 微信/支付宝充值 | P1 |
| 消费统计 | 按日/周/月统计 | P1 |
| 补贴查询 | 查看补贴发放和使用 | P2 |

---

## 📱 界面原型

### 1. 首页(我的消费)

```
┌─────────────────────────────────┐
│ ← 我的消费              🔔      │
├─────────────────────────────────┤
│                                 │
│  ┌───────────────────────────┐  │
│  │        账户余额            │  │
│  │       ¥ 256.80            │  │
│  │                           │  │
│  │  现金: ¥186.80  补贴: ¥70 │  │
│  │                           │  │
│  │  [充值]  [消费记录]        │  │
│  └───────────────────────────┘  │
│                                 │
│  ┌─────────┐ ┌─────────┐       │
│  │   📊    │ │   🎁    │       │
│  │消费统计 │ │补贴查询 │       │
│  └─────────┘ └─────────┘       │
│                                 │
│  今日消费                       │
│  ┌───────────────────────────┐  │
│  │ 🍚 一食堂      12:30      │  │
│  │ 午餐定值           -¥12.00│  │
│  ├───────────────────────────┤  │
│  │ 🥤 便利店      14:20      │  │
│  │ 商品消费            -¥8.50│  │
│  └───────────────────────────┘  │
│                                 │
├─────────────────────────────────┤
│  🏠     📱     👤              │
│  首页   扫码    我的            │
└─────────────────────────────────┘
```

### 2. 扫码消费页

```
┌─────────────────────────────────┐
│ ← 扫码消费                      │
├─────────────────────────────────┤
│                                 │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │     ┌─────────────┐       │  │
│  │     │             │       │  │
│  │     │   QR CODE   │       │  │
│  │     │             │       │  │
│  │     └─────────────┘       │  │
│  │                           │  │
│  │   将二维码对准扫描框       │  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
│  当前余额: ¥256.80              │
│  今日已消费: ¥20.50             │
│  今日剩余限额: ¥179.50          │
│                                 │
│  💡 提示：请在消费设备上完成    │
│     扫码，系统将自动扣款        │
│                                 │
└─────────────────────────────────┘
```

### 3. 在线充值页

```
┌─────────────────────────────────┐
│ ← 在线充值                      │
├─────────────────────────────────┤
│                                 │
│  当前余额: ¥256.80              │
│                                 │
│  选择充值金额                   │
│  ┌──────┐ ┌──────┐ ┌──────┐    │
│  │ ¥50  │ │ ¥100 │ │ ¥200 │    │
│  └──────┘ └──────┘ └──────┘    │
│  ┌──────┐ ┌──────┐ ┌──────┐    │
│  │ ¥300 │ │ ¥500 │ │ 自定义│    │
│  └──────┘ └──────┘ └──────┘    │
│                                 │
│  自定义金额                     │
│  ┌───────────────────────────┐  │
│  │ ¥ [___________]           │  │
│  └───────────────────────────┘  │
│                                 │
│  支付方式                       │
│  ┌───────────────────────────┐  │
│  │ ○ 💚 微信支付              │  │
│  ├───────────────────────────┤  │
│  │ ○ 💙 支付宝                │  │
│  └───────────────────────────┘  │
│                                 │
│  ┌───────────────────────────┐  │
│  │      立即充值 ¥100         │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

### 4. 消费记录页

```
┌─────────────────────────────────┐
│ ← 消费记录            [筛选]   │
├─────────────────────────────────┤
│  [全部] [消费] [充值] [补贴]   │
├─────────────────────────────────┤
│                                 │
│  2025年12月                     │
│  ─────────────────────────────  │
│  │ 12月17日                     │
│  │                              │
│  │ 🍚 一食堂・午餐    12:30    │
│  │ 人脸消费          -¥12.00   │
│  │ 余额: ¥256.80               │
│  │                              │
│  │ 🥤 便利店          14:20    │
│  │ 扫码消费           -¥8.50   │
│  │ 余额: ¥268.80               │
│  ─────────────────────────────  │
│  │ 12月16日                     │
│  │                              │
│  │ 💰 在线充值        09:00    │
│  │ 微信支付          +¥100.00  │
│  │ 余额: ¥277.30               │
│  │                              │
│  │ 🍚 一食堂・早餐    07:30    │
│  │ 刷卡消费            -¥5.00  │
│  │ 余额: ¥177.30               │
│  ─────────────────────────────  │
│                                 │
└─────────────────────────────────┘
```

---

## 🔧 API接口设计

### 余额查询

```
GET /api/consume/v1/mobile/account/balance
```

**响应**:
```json
{
  "code": 0,
  "data": {
    "totalBalance": 256.80,
    "cashBalance": 186.80,
    "subsidyBalance": 70.00,
    "frozenAmount": 0.00,
    "todayConsumed": 20.50,
    "todayLimit": 200.00,
    "remainLimit": 179.50
  }
}
```

### 消费记录查询

```
GET /api/consume/v1/mobile/records
```

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| type | String | 否 | 类型:ALL/CONSUME/RECHARGE/SUBSIDY |
| startDate | String | 否 | 开始日期 |
| endDate | String | 否 | 结束日期 |
| pageNum | Integer | 是 | 页码 |
| pageSize | Integer | 是 | 每页条数 |

### 在线充值

```
POST /api/consume/v1/mobile/recharge
```

**请求**:
```json
{
  "amount": 100.00,
  "payChannel": "WECHAT"
}
```

**响应**:
```json
{
  "code": 0,
  "data": {
    "rechargeNo": "RCH20251217001",
    "payParams": {
      "appId": "wx...",
      "timeStamp": "1702800000",
      "nonceStr": "...",
      "package": "prepay_id=...",
      "signType": "RSA",
      "paySign": "..."
    }
  }
}
```

---

## 📊 组件设计

### 余额卡片组件

```vue
<template>
  <view class="balance-card">
    <view class="balance-title">账户余额</view>
    <view class="balance-amount">¥ {{ balance.toFixed(2) }}</view>
    <view class="balance-detail">
      <text>现金: ¥{{ cashBalance.toFixed(2) }}</text>
      <text>补贴: ¥{{ subsidyBalance.toFixed(2) }}</text>
    </view>
    <view class="balance-actions">
      <button @click="goRecharge">充值</button>
      <button @click="goRecords">消费记录</button>
    </view>
  </view>
</template>
```

### 消费记录项组件

```vue
<template>
  <view class="record-item" @click="showDetail">
    <view class="record-icon">
      <text>{{ icon }}</text>
    </view>
    <view class="record-info">
      <view class="record-title">{{ areaName }}・{{ mealName }}</view>
      <view class="record-type">{{ consumeTypeName }}</view>
    </view>
    <view class="record-amount" :class="{ income: amount > 0 }">
      {{ amount > 0 ? '+' : '' }}¥{{ Math.abs(amount).toFixed(2) }}
    </view>
  </view>
</template>
```

---

## 📈 性能优化

| 优化项 | 措施 |
|--------|------|
| 列表加载 | 分页加载+下拉刷新+上拉加载更多 |
| 图片加载 | 懒加载+图片压缩 |
| 数据缓存 | 余额信息本地缓存5分钟 |
| 接口优化 | 合并请求，减少接口调用次数 |

---

**📝 文档维护**: IOE-DREAM架构团队 | 2025-12-17
