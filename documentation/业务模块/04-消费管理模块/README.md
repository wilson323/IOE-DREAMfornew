# 消费管理模块

> **版本**: v2.0.0  
> **更新日期**: 2025-12-17  
> **所属服务**: ioedream-consume-service (8094)  
> **技术栈**: Spring Boot 3.5.8 + MyBatis-Plus + Redis + MySQL 8.0

---

## 模块概述

消费管理模块是IOE-DREAM智慧园区一卡通平台的核心业务模块，负责处理园区内所有消费场景，包括食堂消费、超市购物、订餐管理、充值退款、补贴发放等功能。

### 核心能力

- **多经营模式支持**: 餐别制、超市制、混合模式
- **统一区域管理**: 多级区域层级结构
- **灵活消费模式**: 6种核心消费模式
- **补贴管理**: 多类型补贴账户体系
- **离线消费**: 支持网络中断场景

---

## 子模块列表

| 序号 | 子模块 | 说明 | 优先级 |
|------|--------|------|--------|
| 01 | [区域管理](./子模块/01-区域管理/README.md) | 统一区域管理，多级层级结构 | P0 |
| 02 | [餐别分类](./子模块/02-餐别分类/README.md) | 二级餐别分类体系 | P0 |
| 03 | [账户类别](./子模块/03-账户类别/README.md) | 账户类别与消费模式配置 | P0 |
| 04 | [消费处理](./子模块/04-消费处理/README.md) | 核心消费流程处理 | P0 |
| 05 | [订餐管理](./子模块/05-订餐管理/README.md) | 订餐预约与取餐 | P1 |
| 06 | [充值退款](./子模块/06-充值退款/README.md) | 资金管理 | P0 |
| 07 | [补贴管理](./子模块/07-补贴管理/README.md) | 补贴发放与使用 | P1 |
| 08 | [离线消费](./子模块/08-离线消费/README.md) | 离线消费与同步 | P1 |
| 09 | [商品管理](./子模块/09-商品管理/README.md) | 商品与库存管理 | P1 |
| 10 | [报表统计](./子模块/10-报表统计/README.md) | 消费报表与分析 | P2 |
| 11 | [设备管理](./子模块/11-设备管理/README.md) | 消费设备管理 | P1 |

---

## 系统架构

### 微服务架构

```
┌─────────────────────────────────────────────────────────────┐
│                    ioedream-gateway-service (8080)          │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                  ioedream-consume-service (8094)            │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 区域管理 │ │ 消费处理 │ │ 订餐管理 │ │ 补贴管理 │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 充值退款 │ │ 商品管理 │ │ 报表统计 │ │ 离线消费 │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
└─────────────────────────────────────────────────────────────┘
                                │
                    ┌───────────┴───────────┐
                    ▼                       ▼
            ┌───────────────┐       ┌───────────────┐
            │   MySQL 8.0   │       │     Redis     │
            └───────────────┘       └───────────────┘
```

### 四层架构

```
Controller (接口控制层) → 参数验证、权限控制
    ↓
Service (核心业务层) → 业务逻辑、事务管理
    ↓
Manager (流程管理层) → 复杂流程编排、缓存管理
    ↓
DAO (数据访问层) → 数据库CRUD操作
```

---

## 经营模式

### 三种经营模式

| 模式 | manage_mode | 说明 | 典型场景 |
|------|-------------|------|----------|
| 餐别制 | 1 | 按餐次固定金额消费 | 食堂、员工餐厅 |
| 超市制 | 2 | 商品扫码计价 | 超市、便利店 |
| 混合模式 | 3 | 支持定值+商品混合 | 综合餐厅 |

### 六种消费模式

| 模式 | 编码 | 说明 | 子类型 |
|------|------|------|--------|
| 固定金额 | FIXED_AMOUNT | 按固定金额消费 | SIMPLE/KEYVALUE/SECTION |
| 自由金额 | FREE_AMOUNT | 输入任意金额 | - |
| 计量计费 | METERED | 按时长/次数计费 | TIMING/COUNT |
| 商品模式 | PRODUCT | 商品扫码消费 | - |
| 订餐模式 | ORDER | 预约订餐消费 | - |
| 智能模式 | INTELLIGENCE | 刷脸/自动识别 | - |

---

## 技术规范

### 强制规范

- ✅ 使用 `@Resource` 依赖注入
- ✅ 使用 `@Mapper` 注解 + `Dao` 后缀
- ✅ 使用 `jakarta.*` 包名
- ✅ 返回统一 `ResponseDTO` 格式
- ✅ 遵循四层架构边界

### 禁止事项

- ❌ 禁止使用 `@Autowired`
- ❌ 禁止使用 `@Repository`
- ❌ 禁止跨层访问
- ❌ 禁止在Controller中包含业务逻辑

---

## 快速导航

- [功能说明](./01-功能说明/README.md)
- [用户故事](./02-用户故事/README.md)
- [数据库设计](./03-数据库设计/README.md)
- [业务流程图](./04-业务流程图/README.md)
- [API接口设计](./05-API接口设计/README.md)
- [非功能需求](./06-非功能需求/README.md)
- [验收标准](./07-验收标准/README.md)

---

*本文档持续更新中*

