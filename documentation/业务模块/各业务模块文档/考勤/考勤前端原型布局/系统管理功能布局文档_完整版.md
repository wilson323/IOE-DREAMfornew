# 系统管理功能布局文档 - 完整版

## 功能概述

系统管理模块是考勤系统的管理和维护中心，仅对系统管理员开放，包含用户管理、系统配置、安全管理、系统监控、系统维护等功能。该模块负责系统的整体配置、用户权限管理、安全策略设置、系统性能监控、日常维护操作等，确保系统的稳定运行和安全可靠。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **WebSocket**: Socket.io-client (实时监控)
- **图表组件**: ECharts 5.x
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/attendance/system/
├── index.vue                        # 系统管理主页面
├── user-management/
│   ├── index.vue                   # 用户管理页面
│   ├── components/
│   │   ├── UserTable.vue           # 用户表格组件
│   │   ├── UserForm.vue            # 用户表单组件
│   │   ├── RoleAssign.vue          # 角色分配组件
│   │   └── PermissionTree.vue      # 权限树组件
│   └── api/
│       └── user-management-api.js  # 用户管理API
├── system-config/
│   ├── index.vue                   # 系统配置页面
│   ├── components/
│   │   ├── BasicConfig.vue         # 基础配置组件
│   │   ├── TimeConfig.vue          # 时间配置组件
│   │   ├── BackupConfig.vue        # 备份配置组件
│   │   └── MonitorConfig.vue       # 监控配置组件
│   └── api/
│       └── system-config-api.js    # 系统配置API
├── security-management/
│   ├── index.vue                   # 安全管理页面
│   ├── components/
│   │   ├── AccessControl.vue       # 访问控制组件
│   │   ├── OperationLogs.vue       # 操作日志组件
│   │   ├── SecurityPolicy.vue      # 安全策略组件
│   │   └── VulnerabilityScan.vue   # 漏洞扫描组件
│   └── api/
│       └── security-api.js         # 安全管理API
├── system-monitor/
│   ├── index.vue                   # 系统监控页面
│   ├── components/
│   │   ├── PerformanceMonitor.vue  # 性能监控组件
│   │   ├── DatabaseMonitor.vue     # 数据库监控组件
│   │   ├── ApiMonitor.vue          # API监控组件
│   │   └── AlertMonitor.vue        # 告警监控组件
│   └── api/
│       └── monitor-api.js          # 监控API
├── system-maintenance/
│   ├── index.vue                   # 系统维护页面
│   ├── components/
│   │   ├── DataBackup.vue          # 数据备份组件
│   │   ├── SystemUpgrade.vue       # 系统升级组件
│   │   ├── LogCleanup.vue          # 日志清理组件
│   │   └── StorageMonitor.vue      # 存储监控组件
│   └── api/
│       └── maintenance-api.js      # 维护API
├── mock/
│   └── system-mock.js              # 模拟数据
├── api/
│   └── system-api.js               # 统一API接口
└── utils/
    ├── auth-utils.js               # 认证工具函数
    ├── permission-utils.js         # 权限工具函数
    └── system-utils.js             # 系统工具函数
```

### API接口设计
```javascript
// src/api/business/attendance/system/user-management-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const userManagementApi = {
  // 用户管理
  getUsers: (params) => getRequest('/attendance/system/users', params),
  getUserById: (id) => getRequest(`/attendance/system/users/${id}`),
  createUser: (params) => postRequest('/attendance/system/users/create', params),
  updateUser: (id, params) => putRequest(`/attendance/system/users/${id}`, params),
  deleteUser: (id) => deleteRequest(`/attendance/system/users/${id}`),

  // 密码管理
  resetPassword: (id, params) => postRequest(`/attendance/system/users/${id}/reset-password`, params),
  changePassword: (params) => postRequest('/attendance/system/users/change-password', params),

  // 角色权限
  getUserRoles: (userId) => getRequest(`/attendance/system/users/${userId}/roles`),
  assignRoles: (userId, roleIds) => postRequest(`/attendance/system/users/${userId}/roles`, { roleIds }),
  getUserPermissions: (userId) => getRequest(`/attendance/system/users/${userId}/permissions`),

  // 登录日志
  getLoginLogs: (params) => getRequest('/attendance/system/users/login-logs', params),
};

// src/api/business/attendance/system/system-config-api.js
export const systemConfigApi = {
  // 基础配置
  getBasicConfig: () => getRequest('/attendance/system/config/basic'),
  updateBasicConfig: (params) => putRequest('/attendance/system/config/basic', params),

  // 时间配置
  getTimeConfig: () => getRequest('/attendance/system/config/time'),
  updateTimeConfig: (params) => putRequest('/attendance/system/config/time', params),

  // 备份配置
  getBackupConfig: () => getRequest('/attendance/system/config/backup'),
  updateBackupConfig: (params) => putRequest('/attendance/system/config/backup', params),

  // 监控配置
  getMonitorConfig: () => getRequest('/attendance/system/config/monitor'),
  updateMonitorConfig: (params) => putRequest('/attendance/system/config/monitor', params),
};

// src/api/business/attendance/system/security-api.js
export const securityApi = {
  // 访问控制
  getAccessControl: () => getRequest('/attendance/system/security/access-control'),
  updateAccessControl: (params) => putRequest('/attendance/system/security/access-control', params),

  // 操作日志
  getOperationLogs: (params) => getRequest('/attendance/system/security/operation-logs', params),
  clearOperationLogs: (params) => postRequest('/attendance/system/security/operation-logs/clear', params),

  // 安全策略
  getSecurityPolicy: () => getRequest('/attendance/system/security/policy'),
  updateSecurityPolicy: (params) => putRequest('/attendance/system/security/policy', params),

  // 漏洞扫描
  startVulnerabilityScan: () => postRequest('/attendance/system/security/vulnerability-scan'),
  getScanResults: () => getRequest('/attendance/system/security/scan-results'),
};
```

## 核心功能模块

### 1. 用户管理

```vue
<!-- src/views/business/attendance/system/user-management/components/UserTable.vue -->
<template>
  <div class="user-table">
    <!-- 搜索工具栏 -->
    <div class="table-toolbar">
      <a-form layout="inline" :model="searchForm" @finish="handleSearch">
        <a-form-item label="用户名">
          <a-input v-model:value="searchForm.username" placeholder="请输入用户名" allow-clear />
        </a-form-item>
        <a-form-item label="姓名">
          <a-input v-model:value="searchForm.realName" placeholder="请输入姓名" allow-clear />
        </a-form-item>
        <a-form-item label="角色">
          <a-select
            v-model:value="searchForm.roleId"
            placeholder="请选择角色"
            allow-clear
            style="width: 150px"
          >
            <a-select-option
              v-for="role in roleList"
              :key="role.id"
              :value="role.id"
            >
              {{ role.name }}
            </a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item label="状态">
          <a-select
            v-model:value="searchForm.status"
            placeholder="请选择状态"
            allow-clear
            style="width: 120px"
          >
            <a-select-option value="active">启用</a-select-option>
            <a-select-option value="inactive">禁用</a-select-option>
            <a-select-option value="locked">锁定</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item>
          <a-button type="primary" html-type="submit" :loading="loading">
            <template #icon><SearchOutlined /></template>
            搜索
          </a-button>
          <a-button @click="handleReset">
            <template #icon><ReloadOutlined /></template>
            重置
          </a-button>
        </a-form-item>
      </a-form>
    </div>

    <!-- 操作工具栏 -->
    <div class="table-actions">
      <div class="actions-left">
        <a-button type="primary" @click="handleAdd">
          <template #icon><PlusOutlined /></template>
          新增用户
        </a-button>
        <a-button @click="handleBatchImport">
          <template #icon><UploadOutlined /></template>
          批量导入
        </a-button>
        <a-button @click="handleBatchExport" :disabled="selectedRowKeys.length === 0">
          <template #icon><ExportOutlined /></template>
          批量导出
        </a-button>
        <a-button @click="handleBatchOperation" :disabled="selectedRowKeys.length === 0">
          <template #icon><AppstoreOutlined /></template>
          批量操作
        </a-button>
      </div>
      <div class="actions-right">
        <a-button @click="handleRefresh" :loading="loading">
          <template #icon><ReloadOutlined /></template>
          刷新
        </a-button>
        <a-button @click="toggleColumnSettings">
          <template #icon><SettingOutlined /></template>
          列设置
        </a-button>
      </div>
    </div>

    <!-- 数据表格 -->
    <a-table
      :columns="columns"
      :data-source="dataSource"
      :loading="loading"
      :pagination="pagination"
      :row-selection="rowSelection"
      row-key="id"
      @change="handleTableChange"
    >
      <template #bodyCell="{ column, record }">
        <template v-if="column.key === 'avatar'">
          <a-avatar :src="record.avatar" :alt="record.realName">
            {{ record.realName?.charAt(0) }}
          </a-avatar>
        </template>

        <template v-else-if="column.key === 'roles'">
          <a-tag v-for="role in record.roles" :key="role.id" :color="getRoleColor(role.code)">
            {{ role.name }}
          </a-tag>
        </template>

        <template v-else-if="column.key === 'status'">
          <a-badge :status="getStatusBadge(record.status)" :text="getStatusText(record.status)" />
        </template>

        <template v-else-if="column.key === 'lastLoginTime'">
          <span v-if="record.lastLoginTime">{{ formatDateTime(record.lastLoginTime) }}</span>
          <span v-else class="text-muted">从未登录</span>
        </template>

        <template v-else-if="column.key === 'action'">
          <a-space>
            <a-button type="link" size="small" @click="handleView(record)">查看</a-button>
            <a-button type="link" size="small" @click="handleEdit(record)">编辑</a-button>
            <a-dropdown>
              <template #overlay>
                <a-menu @click="({ key }) => handleMenuClick(key, record)">
                  <a-menu-item key="assign-roles">
                    <TeamOutlined />
                    分配角色
                  </a-menu-item>
                  <a-menu-item key="reset-password">
                    <KeyOutlined />
                    重置密码
                  </a-menu-item>
                  <a-menu-item key="login-logs">
                    <HistoryOutlined />
                    登录日志
                  </a-menu-item>
                  <a-menu-divider />
                  <a-menu-item key="enable" v-if="record.status !== 'active'">
                    <CheckCircleOutlined />
                    启用
                  </a-menu-item>
                  <a-menu-item key="disable" v-if="record.status === 'active'">
                    <StopOutlined />
                    禁用
                  </a-menu-item>
                  <a-menu-item key="lock" v-if="record.status !== 'locked'">
                    <LockOutlined />
                    锁定
                  </a-menu-item>
                  <a-menu-item key="unlock" v-if="record.status === 'locked'">
                    <UnlockOutlined />
                    解锁
                  </a-menu-item>
                  <a-menu-divider />
                  <a-menu-item key="delete" class="danger">
                    <DeleteOutlined />
                    删除
                  </a-menu-item>
                </a-menu>
              </template>
              <a-button type="link" size="small">
                更多 <DownOutlined />
              </a-button>
            </a-dropdown>
          </a-space>
        </template>
      </template>
    </a-table>

    <!-- 用户详情弹窗 -->
    <a-modal
      v-model:open="detailVisible"
      title="用户详情"
      :footer="null"
      width="800px"
    >
      <UserDetail
        :user-data="currentUser"
        @close="detailVisible = false"
      />
    </a-modal>

    <!-- 角色分配弹窗 -->
    <a-modal
      v-model:open="roleAssignVisible"
      title="分配角色"
      @ok="handleRoleAssignConfirm"
      @cancel="roleAssignVisible = false"
      width="600px"
    >
      <RoleAssignForm
        ref="roleAssignRef"
        :user-data="currentUser"
        :role-list="roleList"
        @change="handleRoleAssignChange"
      />
    </a-modal>

    <!-- 列设置弹窗 -->
    <a-modal
      v-model:open="columnSettingsVisible"
      title="列设置"
      @ok="handleColumnSettingsSave"
      @cancel="columnSettingsVisible = false"
    >
      <ColumnSettings
        :columns="allColumns"
        :visible-columns="visibleColumns"
        @change="handleColumnChange"
      />
    </a-modal>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  SearchOutlined,
  ReloadOutlined,
  PlusOutlined,
  UploadOutlined,
  ExportOutlined,
  AppstoreOutlined,
  SettingOutlined,
  TeamOutlined,
  KeyOutlined,
  HistoryOutlined,
  CheckCircleOutlined,
  StopOutlined,
  LockOutlined,
  UnlockOutlined,
  DeleteOutlined,
  DownOutlined
} from '@ant-design/icons-vue';
import { userManagementApi } from '/@/api/business/attendance/system/user-management-api';
import UserDetail from './UserDetail.vue';
import RoleAssignForm from './RoleAssignForm.vue';
import ColumnSettings from './ColumnSettings.vue';

const emit = defineEmits(['add', 'edit', 'view', 'export', 'import']);

const loading = ref(false);
const dataSource = ref([]);
const selectedRowKeys = ref([]);
const roleList = ref([]);

const detailVisible = ref(false);
const roleAssignVisible = ref(false);
const columnSettingsVisible = ref(false);
const currentUser = ref(null);
const roleAssignRef = ref();

const searchForm = reactive({
  username: '',
  realName: '',
  roleId: '',
  status: ''
});

const pagination = reactive({
  current: 1,
  pageSize: 20,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `共 ${total} 条记录`,
});

const allColumns = ref([
  {
    title: '头像',
    key: 'avatar',
    width: 80,
    align: 'center',
  },
  {
    title: '用户名',
    dataIndex: 'username',
    key: 'username',
    width: 120,
  },
  {
    title: '姓名',
    dataIndex: 'realName',
    key: 'realName',
    width: 100,
  },
  {
    title: '邮箱',
    dataIndex: 'email',
    key: 'email',
    width: 180,
  },
  {
    title: '手机号',
    dataIndex: 'phone',
    key: 'phone',
    width: 120,
  },
  {
    title: '角色',
    key: 'roles',
    width: 150,
  },
  {
    title: '部门',
    dataIndex: 'department',
    key: 'department',
    width: 120,
  },
  {
    title: '状态',
    key: 'status',
    width: 80,
  },
  {
    title: '最后登录',
    key: 'lastLoginTime',
    width: 150,
  },
  {
    title: '创建时间',
    dataIndex: 'createdAt',
    key: 'createdAt',
    width: 150,
  },
  {
    title: '操作',
    key: 'action',
    width: 200,
    fixed: 'right',
  },
]);

const visibleColumns = ref(allColumns.value.map(col => col.key));

const columns = computed(() => {
  return allColumns.value.filter(col => visibleColumns.value.includes(col.key));
});

const rowSelection = {
  selectedRowKeys: selectedRowKeys,
  onChange: (keys) => {
    selectedRowKeys.value = keys;
  },
};

// 加载用户数据
const loadUsers = async () => {
  loading.value = true;
  try {
    const params = {
      ...searchForm,
      page: pagination.current,
      pageSize: pagination.pageSize,
    };
    const response = await userManagementApi.getUsers(params);
    dataSource.value = response.data.records;
    pagination.total = response.data.total;
  } catch (error) {
    console.error('加载用户数据失败:', error);
    message.error('加载用户数据失败');
  } finally {
    loading.value = false;
  }
};

// 加载角色列表
const loadRoles = async () => {
  try {
    const response = await userManagementApi.getRoles();
    roleList.value = response.data;
  } catch (error) {
    console.error('加载角色列表失败:', error);
  }
};

// 搜索
const handleSearch = () => {
  pagination.current = 1;
  loadUsers();
};

// 重置
const handleReset = () => {
  Object.assign(searchForm, {
    username: '',
    realName: '',
    roleId: '',
    status: ''
  });
  pagination.current = 1;
  loadUsers();
};

// 表格变化
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadUsers();
};

// 新增用户
const handleAdd = () => {
  emit('add');
};

// 编辑用户
const handleEdit = (record) => {
  emit('edit', record);
};

// 查看用户
const handleView = (record) => {
  currentUser.value = record;
  detailVisible.value = true;
};

// 菜单点击
const handleMenuClick = async (key, record) => {
  switch (key) {
    case 'assign-roles':
      await handleAssignRoles(record);
      break;
    case 'reset-password':
      await handleResetPassword(record);
      break;
    case 'login-logs':
      await handleViewLoginLogs(record);
      break;
    case 'enable':
      await handleUpdateStatus(record, 'active');
      break;
    case 'disable':
      await handleUpdateStatus(record, 'inactive');
      break;
    case 'lock':
      await handleUpdateStatus(record, 'locked');
      break;
    case 'unlock':
      await handleUpdateStatus(record, 'active');
      break;
    case 'delete':
      await handleDeleteUser(record);
      break;
  }
};

// 分配角色
const handleAssignRoles = async (record) => {
  currentUser.value = record;
  try {
    const response = await userManagementApi.getUserRoles(record.id);
    currentUser.value.roleIds = response.data.map(role => role.id);
    roleAssignVisible.value = true;
  } catch (error) {
    message.error('获取用户角色失败');
  }
};

// 角色分配确认
const handleRoleAssignConfirm = async () => {
  try {
    const roleIds = await roleAssignRef.value.getRoleIds();
    await userManagementApi.assignRoles(currentUser.value.id, roleIds);
    message.success('角色分配成功');
    roleAssignVisible.value = false;
    loadUsers();
  } catch (error) {
    message.error('角色分配失败');
  }
};

// 重置密码
const handleResetPassword = (record) => {
  Modal.confirm({
    title: '确认重置密码',
    content: `确定要重置用户"${record.realName}"的密码吗？`,
    onOk: async () => {
      try {
        await userManagementApi.resetPassword(record.id, {
          newPassword: '123456',
          requireChangeOnFirstLogin: true
        });
        message.success('密码重置成功，新密码：123456');
      } catch (error) {
        message.error('密码重置失败');
      }
    },
  });
};

// 查看登录日志
const handleViewLoginLogs = async (record) => {
  try {
    const response = await userManagementApi.getLoginLogs({
      userId: record.id,
      pageSize: 20
    });
    // 这里可以显示登录日志弹窗
    console.log('登录日志:', response.data);
  } catch (error) {
    message.error('获取登录日志失败');
  }
};

// 更新用户状态
const handleUpdateStatus = async (record, status) => {
  try {
    await userManagementApi.updateUser(record.id, { status });
    message.success('状态更新成功');
    loadUsers();
  } catch (error) {
    message.error('状态更新失败');
  }
};

// 删除用户
const handleDeleteUser = (record) => {
  Modal.confirm({
    title: '确认删除',
    content: `确定要删除用户"${record.realName}"吗？`,
    onOk: async () => {
      try {
        await userManagementApi.deleteUser(record.id);
        message.success('用户删除成功');
        loadUsers();
      } catch (error) {
        message.error('用户删除失败');
      }
    },
  });
};

// 批量导入
const handleBatchImport = () => {
  emit('import');
};

// 批量导出
const handleBatchExport = () => {
  emit('export', {
    type: 'users',
    ids: selectedRowKeys.value
  });
};

// 批量操作
const handleBatchOperation = () => {
  // 批量操作逻辑
  console.log('批量操作:', selectedRowKeys.value);
};

// 刷新
const handleRefresh = () => {
  loadUsers();
};

// 切换列设置
const toggleColumnSettings = () => {
  columnSettingsVisible.value = true;
};

// 保存列设置
const handleColumnSettingsSave = () => {
  columnSettingsVisible.value = false;
};

// 列变化
const handleColumnChange = (columns) => {
  visibleColumns.value = columns;
};

// 获取状态徽标
const getStatusBadge = (status) => {
  const statusMap = {
    active: 'success',
    inactive: 'default',
    locked: 'error',
  };
  return statusMap[status] || 'default';
};

// 获取状态文本
const getStatusText = (status) => {
  const statusMap = {
    active: '启用',
    inactive: '禁用',
    locked: '锁定',
  };
  return statusMap[status] || '未知';
};

// 获取角色颜色
const getRoleColor = (roleCode) => {
  const colorMap = {
    'admin': 'red',
    'hr': 'blue',
    'manager': 'green',
    'employee': 'default'
  };
  return colorMap[roleCode] || 'default';
};

// 格式化日期时间
const formatDateTime = (dateTime) => {
  if (!dateTime) return '';
  return new Date(dateTime).toLocaleString('zh-CN');
};

onMounted(() => {
  loadUsers();
  loadRoles();
});
</script>

<style scoped lang="less">
.user-table {
  background: #fff;
  border-radius: 8px;
  padding: 16px;

  .table-toolbar {
    margin-bottom: 16px;
    padding: 16px;
    background: #fafafa;
    border-radius: 4px;
  }

  .table-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;

    .actions-left,
    .actions-right {
      display: flex;
      gap: 8px;
    }
  }

  .text-muted {
    color: #999;
    font-style: italic;
  }
}
</style>
```

### 2. 系统监控

```vue
<!-- src/views/business/attendance/system/system-monitor/components/PerformanceMonitor.vue -->
<template>
  <div class="performance-monitor">
    <!-- 实时指标卡片 -->
    <div class="metrics-cards">
      <a-row :gutter="16">
        <a-col :span="6" v-for="(metric, index) in metricsData" :key="index">
          <a-card :bordered="false" class="metric-card">
            <div class="metric-header">
              <span class="metric-title">{{ metric.title }}</span>
              <a-tag :color="getMetricColor(metric.status)">{{ metric.statusText }}</a-tag>
            </div>
            <div class="metric-value">
              <span class="value">{{ metric.value }}</span>
              <span class="unit">{{ metric.unit }}</span>
            </div>
            <div class="metric-trend" v-if="metric.trend">
              <component :is="metric.trend > 0 ? 'ArrowUpOutlined' : 'ArrowDownOutlined'"
                        :style="{ color: metric.trend > 0 ? '#52c41a' : '#ff4d4f' }" />
              <span>{{ Math.abs(metric.trend) }}%</span>
              <span class="trend-text">较上期</span>
            </div>
          </a-card>
        </a-col>
      </a-row>
    </div>

    <!-- 监控图表 -->
    <div class="monitoring-charts">
      <a-row :gutter="16">
        <a-col :span="12">
          <a-card title="CPU使用率" :bordered="false">
            <div ref="cpuChartRef" class="chart-container"></div>
          </a-card>
        </a-col>
        <a-col :span="12">
          <a-card title="内存使用率" :bordered="false">
            <div ref="memoryChartRef" class="chart-container"></div>
          </a-card>
        </a-col>
      </a-row>

      <a-row :gutter="16" style="margin-top: 16px;">
        <a-col :span="12">
          <a-card title="磁盘使用率" :bordered="false">
            <div ref="diskChartRef" class="chart-container"></div>
          </a-card>
        </a-col>
        <a-col :span="12">
          <a-card title="网络流量" :bordered="false">
            <div ref="networkChartRef" class="chart-container"></div>
          </a-card>
        </a-col>
      </a-row>
    </div>

    <!-- 系统信息 -->
    <div class="system-info">
      <a-card title="系统信息" :bordered="false">
        <a-descriptions :column="3" bordered>
          <a-descriptions-item label="系统版本">
            {{ systemInfo.version }}
          </a-descriptions-item>
          <a-descriptions-item label="运行时间">
            {{ systemInfo.uptime }}
          </a-descriptions-item>
          <a-descriptions-item label="服务器时间">
            {{ systemInfo.serverTime }}
          </a-descriptions-item>
          <a-descriptions-item label="CPU型号">
            {{ systemInfo.cpuModel }}
          </a-descriptions-item>
          <a-descriptions-item label="内存总量">
            {{ systemInfo.totalMemory }}
          </a-descriptions-item>
          <a-descriptions-item label="磁盘空间">
            {{ systemInfo.diskSpace }}
          </a-descriptions-item>
        </a-descriptions>
      </a-card>
    </div>

    <!-- 进程监控 -->
    <div class="process-monitor">
      <a-card title="进程监控" :bordered="false">
        <template #extra>
          <a-space>
            <a-button @click="refreshProcesses" :loading="refreshingProcesses">
              <template #icon><ReloadOutlined /></template>
              刷新
            </a-button>
            <a-button @click="killSelectedProcess" :disabled="!selectedProcess">
              <template #icon><StopOutlined /></template>
              结束进程
            </a-button>
          </a-space>
        </template>

        <a-table
          :columns="processColumns"
          :data-source="processData"
          :loading="loadingProcesses"
          :pagination="false"
          size="small"
          :row-selection="processRowSelection"
          @row-select="handleProcessSelect"
        >
          <template #bodyCell="{ column, record }">
            <template v-if="column.key === 'status'">
              <a-badge :status="getProcessStatusBadge(record.status)" />
            </template>
            <template v-else-if="column.key === 'memory'">
              {{ formatBytes(record.memory) }}
            </template>
            <template v-else-if="column.key === 'cpu'">
              {{ record.cpu }}%
            </template>
          </template>
        </a-table>
      </a-card>
    </div>

    <!-- 告警信息 -->
    <div class="alert-info">
      <a-card title="告警信息" :bordered="false">
        <template #extra>
          <a-badge :count="alertData.unhandled" :offset="[10, 0]">
            <a-button @click="viewAllAlerts">
              查看全部
            </a-button>
          </a-badge>
        </template>

        <a-list :data-source="recentAlerts" :loading="loadingAlerts">
          <template #renderItem="{ item }">
            <a-list-item>
              <a-list-item-meta>
                <template #avatar>
                  <a-badge :status="getAlertBadge(item.level)" />
                </template>
                <template #title>
                  <span :style="{ color: getAlertColor(item.level) }">{{ item.title }}</span>
                </template>
                <template #description>
                  {{ item.description }}
                </template>
              </a-list-item-meta>
              <div class="alert-actions">
                <a-button type="link" size="small" @click="handleAlert(item)">
                  处理
                </a-button>
                <a-button type="link" size="small" @click="ignoreAlert(item)">
                  忽略
                </a-button>
              </div>
            </a-list-item>
          </template>
        </a-list>
      </a-card>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, onUnmounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  ArrowUpOutlined,
  ArrowDownOutlined,
  ReloadOutlined,
  StopOutlined
} from '@ant-design/icons-vue';
import * as echarts from 'echarts';
import { monitorApi } from '/@/api/business/attendance/system/monitor-api';

const emit = defineEmits(['alert-handle', 'alert-ignore']);

const cpuChartRef = ref();
const memoryChartRef = ref();
const diskChartRef = ref();
const networkChartRef = ref();

const loadingProcesses = ref(false);
const loadingAlerts = ref(false);
const refreshingProcesses = ref(false);
const selectedProcess = ref(null);

const metricsData = ref([
  {
    title: 'CPU使用率',
    value: 45.2,
    unit: '%',
    status: 'normal',
    statusText: '正常',
    trend: 2.5
  },
  {
    title: '内存使用率',
    value: 68.7,
    unit: '%',
    status: 'warning',
    statusText: '警告',
    trend: 5.2
  },
  {
    title: '磁盘使用率',
    value: 32.1,
    unit: '%',
    status: 'normal',
    statusText: '正常',
    trend: -1.2
  },
  {
    title: '网络带宽',
    value: 125.6,
    unit: 'Mbps',
    status: 'normal',
    statusText: '正常',
    trend: 8.7
  }
]);

const systemInfo = reactive({
  version: 'v1.0.0',
  uptime: '15天 8小时 32分钟',
  serverTime: '',
  cpuModel: 'Intel Xeon E5-2680 v4',
  totalMemory: '32GB',
  diskSpace: '500GB / 1TB'
});

const processData = ref([]);
const recentAlerts = ref([]);
const alertData = reactive({
  total: 0,
  unhandled: 3
});

const processColumns = [
  {
    title: '进程名',
    dataIndex: 'name',
    key: 'name',
    width: 150,
  },
  {
    title: 'PID',
    dataIndex: 'pid',
    key: 'pid',
    width: 80,
  },
  {
    title: 'CPU',
    dataIndex: 'cpu',
    key: 'cpu',
    width: 80,
    sorter: (a, b) => a.cpu - b.cpu,
  },
  {
    title: '内存',
    dataIndex: 'memory',
    key: 'memory',
    width: 100,
    sorter: (a, b) => a.memory - b.memory,
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    width: 80,
  },
  {
    title: '启动时间',
    dataIndex: 'startTime',
    key: 'startTime',
    width: 150,
  },
];

const processRowSelection = {
  type: 'radio',
  onChange: (selectedRowKeys, selectedRows) => {
    selectedProcess.value = selectedRows[0];
  },
};

let charts = {};
let updateTimer = null;

// 初始化图表
const initCharts = () => {
  // CPU使用率图表
  charts.cpu = echarts.init(cpuChartRef.value);
  const cpuOption = {
    title: { text: 'CPU使用率', left: 'center', textStyle: { fontSize: 14 } },
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'time', splitLine: { show: false } },
    yAxis: { type: 'value', max: 100, axisLabel: { formatter: '{value}%' } },
    series: [{
      type: 'line',
      data: [],
      smooth: true,
      lineStyle: { width: 2 },
      areaStyle: { opacity: 0.3 },
      itemStyle: { color: '#1890ff' }
    }]
  };
  charts.cpu.setOption(cpuOption);

  // 内存使用率图表
  charts.memory = echarts.init(memoryChartRef.value);
  const memoryOption = {
    title: { text: '内存使用率', left: 'center', textStyle: { fontSize: 14 } },
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'time', splitLine: { show: false } },
    yAxis: { type: 'value', max: 100, axisLabel: { formatter: '{value}%' } },
    series: [{
      type: 'line',
      data: [],
      smooth: true,
      lineStyle: { width: 2 },
      areaStyle: { opacity: 0.3 },
      itemStyle: { color: '#52c41a' }
    }]
  };
  charts.memory.setOption(memoryOption);

  // 磁盘使用率图表
  charts.disk = echarts.init(diskChartRef.value);
  const diskOption = {
    title: { text: '磁盘使用率', left: 'center', textStyle: { fontSize: 14 } },
    tooltip: { trigger: 'item' },
    series: [{
      type: 'gauge',
      data: [{ value: 32.1, name: '使用率' }],
      detail: { formatter: '{value}%' }
    }]
  };
  charts.disk.setOption(diskOption);

  // 网络流量图表
  charts.network = echarts.init(networkChartRef.value);
  const networkOption = {
    title: { text: '网络流量', left: 'center', textStyle: { fontSize: 14 } },
    tooltip: { trigger: 'axis' },
    legend: { data: ['入站', '出站'], bottom: 0 },
    xAxis: { type: 'time', splitLine: { show: false } },
    yAxis: { type: 'value' },
    series: [
      {
        name: '入站',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#1890ff' }
      },
      {
        name: '出站',
        type: 'line',
        data: [],
        smooth: true,
        itemStyle: { color: '#52c41a' }
      }
    ]
  };
  charts.network.setOption(networkOption);
};

// 更新监控数据
const updateMonitorData = async () => {
  try {
    const response = await monitorApi.getSystemMetrics();
    const data = response.data;

    // 更新指标数据
    metricsData.value.forEach(metric => {
      const key = metric.title.replace('使用率', '').replace('带宽', '').toLowerCase();
      if (data[key]) {
        metric.value = data[key].value;
        metric.status = data[key].status;
        metric.statusText = data[key].statusText;
      }
    });

    // 更新图表数据
    updateChartData(data);

    // 更新系统信息
    systemInfo.serverTime = data.serverTime;

  } catch (error) {
    console.error('更新监控数据失败:', error);
  }
};

// 更新图表数据
const updateChartData = (data) => {
  const now = new Date();

  // 更新CPU图表
  if (charts.cpu && data.cpu) {
    const cpuData = charts.cpu.getOption().series[0].data;
    cpuData.push([now, data.cpu.value]);
    if (cpuData.length > 60) cpuData.shift();
    charts.cpu.setOption({ series: [{ data: cpuData }] });
  }

  // 更新内存图表
  if (charts.memory && data.memory) {
    const memoryData = charts.memory.getOption().series[0].data;
    memoryData.push([now, data.memory.value]);
    if (memoryData.length > 60) memoryData.shift();
    charts.memory.setOption({ series: [{ data: memoryData }] });
  }

  // 更新磁盘图表
  if (charts.disk && data.disk) {
    charts.disk.setOption({
      series: [{ data: [{ value: data.disk.value }] }]
    });
  }

  // 更新网络图表
  if (charts.network && data.network) {
    const networkOption = charts.network.getOption();
    networkOption.series[0].data.push([now, data.network.inbound]);
    networkOption.series[1].data.push([now, data.network.outbound]);

    if (networkOption.series[0].data.length > 60) {
      networkOption.series[0].data.shift();
      networkOption.series[1].data.shift();
    }
    charts.network.setOption(networkOption);
  }
};

// 加载进程数据
const loadProcesses = async () => {
  loadingProcesses.value = true;
  try {
    const response = await monitorApi.getProcesses();
    processData.value = response.data;
  } catch (error) {
    console.error('加载进程数据失败:', error);
    message.error('加载进程数据失败');
  } finally {
    loadingProcesses.value = false;
  }
};

// 刷新进程
const refreshProcesses = () => {
  refreshingProcesses.value = true;
  loadProcesses().finally(() => {
    refreshingProcesses.value = false;
  });
};

// 进程选择
const handleProcessSelect = (selectedRowKeys, selectedRows) => {
  selectedProcess.value = selectedRows[0];
};

// 结束进程
const killSelectedProcess = async () => {
  if (!selectedProcess.value) return;

  try {
    await monitorApi.killProcess(selectedProcess.value.pid);
    message.success('进程已结束');
    loadProcesses();
  } catch (error) {
    message.error('结束进程失败');
  }
};

// 加载告警数据
const loadAlerts = async () => {
  loadingAlerts.value = true;
  try {
    const response = await monitorApi.getAlerts();
    recentAlerts.value = response.data.recent;
    alertData.total = response.data.total;
    alertData.unhandled = response.data.unhandled;
  } catch (error) {
    console.error('加载告警数据失败:', error);
    message.error('加载告警数据失败');
  } finally {
    loadingAlerts.value = false;
  }
};

// 处理告警
const handleAlert = (alert) => {
  emit('alert-handle', alert);
};

// 忽略告警
const ignoreAlert = (alert) => {
  emit('alert-ignore', alert);
};

// 查看全部告警
const viewAllAlerts = () => {
  // 查看全部告警逻辑
};

// 获取进程状态徽标
const getProcessStatusBadge = (status) => {
  const statusMap = {
    running: 'success',
    sleeping: 'default',
    stopped: 'error',
    zombie: 'warning'
  };
  return statusMap[status] || 'default';
};

// 获取告警徽标
const getAlertBadge = (level) => {
  const levelMap = {
    info: 'default',
    warning: 'warning',
    error: 'error',
    critical: 'error'
  };
  return levelMap[level] || 'default';
};

// 获取告警颜色
const getAlertColor = (level) => {
  const colorMap = {
    info: '#1890ff',
    warning: '#faad14',
    error: '#ff4d4f',
    critical: '#ff4d4f'
  };
  return colorMap[level] || '#1890ff';
};

// 格式化字节数
const formatBytes = (bytes) => {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
};

onMounted(() => {
  initCharts();
  updateMonitorData();
  loadProcesses();
  loadAlerts();

  // 启动定时更新
  updateTimer = setInterval(() => {
    updateMonitorData();
    loadProcesses();
    loadAlerts();
  }, 5000);

  // 更新系统时间
  setInterval(() => {
    systemInfo.serverTime = new Date().toLocaleString('zh-CN');
  }, 1000);
});

onUnmounted(() => {
  // 清理定时器
  if (updateTimer) {
    clearInterval(updateTimer);
  }

  // 销毁图表
  Object.values(charts).forEach(chart => {
    if (chart) {
      chart.dispose();
    }
  });
});
</script>

<style scoped lang="less">
.performance-monitor {
  .metrics-cards {
    margin-bottom: 24px;

    .metric-card {
      text-align: center;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;

      &:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
      }

      .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .metric-title {
        font-size: 14px;
        color: #666;
      }

      .metric-value {
        margin-bottom: 8px;

        .value {
          font-size: 32px;
          font-weight: 600;
          color: #262626;
          line-height: 1;
        }

        .unit {
          font-size: 14px;
          color: #999;
          margin-left: 4px;
        }
      }

      .metric-trend {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 12px;

        .trend-text {
          color: #999;
        }
      }
    }
  }

  .monitoring-charts {
    margin-bottom: 24px;

    .chart-container {
      height: 200px;
      width: 100%;
    }
  }

  .system-info {
    margin-bottom: 24px;
  }

  .process-monitor {
    margin-bottom: 24px;
  }

  .alert-info {
    .alert-actions {
      display: flex;
      gap: 8px;
    }
  }
}
</style>
```

## Mock数据示例

```javascript
// src/mock/system-mock.js
export const mockUsers = [
  {
    id: 'user001',
    username: 'admin',
    realName: '系统管理员',
    email: 'admin@company.com',
    phone: '13800138000',
    roles: [{ id: 'role001', name: '系统管理员', code: 'admin' }],
    department: '信息部',
    status: 'active',
    lastLoginTime: '2024-01-15 10:30:00',
    createdAt: '2024-01-01 09:00:00'
  }
];

export const mockSystemMetrics = {
  cpu: { value: 45.2, status: 'normal', statusText: '正常' },
  memory: { value: 68.7, status: 'warning', statusText: '警告' },
  disk: { value: 32.1, status: 'normal', statusText: '正常' },
  network: { inbound: 125.6, outbound: 89.3 }
};

export const mockSystemConfig = {
  basic: {
    systemName: '企业考勤管理系统',
    version: '1.0.0',
    company: '科技有限公司'
  },
  time: {
    timezone: 'Asia/Shanghai',
    dateFormat: 'YYYY-MM-DD',
    timeFormat: 'HH:mm:ss'
  },
  backup: {
    enabled: true,
    frequency: 'daily',
    retention: 30
  }
};

export default {
  mockUsers,
  mockSystemMetrics,
  mockSystemConfig
};
```

## 开发注意事项总结

### 核心功能要点
1. **用户权限管理** - 精细的用户权限控制系统
2. **系统配置** - 灵活的系统参数配置
3. **安全防护** - 多层次的安全防护机制
4. **实时监控** - 全方位的系统性能监控
5. **自动化维护** - 智能的系统维护功能
6. **审计追踪** - 完整的操作审计日志

### 性能优化建议
1. 大量数据的分页加载
2. 实时数据的WebSocket推送
3. 系统监控数据的缓存
4. 图表渲染的性能优化

### 用户体验优化
1. 直观的管理界面
2. 实时的状态反馈
3. 丰富的操作提示
4. 完善的错误处理

## 总结

系统管理模块作为考勤系统的管理中心，需要重点关注：

- 权限控制的精确性和安全性
- 系统配置的灵活性和完整性
- 安全防护的全面性和有效性
- 监控功能的实时性和准确性
- 维护操作的便捷性和自动化

通过遵循本文档的技术规范，可以构建出功能完善、安全可靠的系统管理模块。