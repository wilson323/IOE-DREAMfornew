# 智能视频模块 - 移动端功能设计

## 设计原则

移动端聚焦**移动巡检场景**，不复刻PC全部功能，仅实现适合移动端的核心能力：

| 原则 | 说明 |
|------|------|
| 场景驱动 | 聚焦巡检、应急响应、远程查看场景 |
| 轻量化 | 减少操作步骤，适配移动交互 |
| 实时性 | 告警推送、状态实时更新 |
| 省流量 | 自适应码流，WiFi/4G智能切换 |

## 现有移动端页面

基于 `smart-app/src/pages/video/` 现有代码：

| 页面 | 文件 | 功能状态 |
|------|------|----------|
| 实时监控 | monitor.vue | ✅ 已实现 |
| 设备管理 | device.vue | ✅ 已实现 |
| 告警管理 | alert.vue | ✅ 已实现 |
| 视频回放 | playback.vue | ✅ 已实现 |
| 云台控制 | ptz.vue | ✅ 已实现 |

---

## 移动端功能矩阵

### ✅ 适合移动端（已实现/建议实现）

| 功能 | 场景 | 优先级 | 状态 |
|------|------|--------|------|
| 实时预览 | 远程巡检、应急查看 | P0 | ✅ 已实现 |
| 告警接收 | 告警推送、即时响应 | P0 | ✅ 已实现 |
| 告警处理 | 确认/忽略/转发 | P0 | ✅ 已实现 |
| 设备状态 | 查看设备在线状态 | P1 | ✅ 已实现 |
| 云台控制 | 远程调整摄像机 | P1 | ✅ 已实现 |
| 视频回放 | 快速查看录像 | P1 | ✅ 已实现 |
| 截图分享 | 抓拍并分享 | P2 | ⏳ 待增强 |

### ❌ 不适合移动端（仅PC端）

| 功能 | 原因 |
|------|------|
| 多画面上墙 | 屏幕尺寸限制 |
| 解码器配置 | 复杂配置操作 |
| 电视墙布局 | 需要大屏操作 |
| 分析规则配置 | 需要绘制区域 |
| 人脸库管理 | 批量导入操作 |
| 系统配置 | 管理员后台功能 |
| 设备新增/删除 | 需详细配置 |

---

## 现有代码功能分析

### 1. 实时监控 (monitor.vue)

**已实现功能**:
- ✅ 单画面/四画面切换
- ✅ 设备统计展示
- ✅ 云台控制面板(8方向+变焦)
- ✅ 预置位调用
- ✅ 快捷截图/录像
- ✅ WebSocket实时状态更新
- ✅ 网络自适应码流

**核心代码结构**:
```javascript
// 网络自适应
const networkInfo = await getNetworkType()
const quality = networkInfo === 'wifi' ? '720p' : '480p'

// WebSocket订阅
wsClient.value.subscribe('device_status', handleDeviceStatusUpdate)
wsClient.value.subscribe('alarm', handleAlarmUpdate)
```

### 2. 设备管理 (device.vue)

**已实现功能**:
- ✅ 设备列表(支持搜索)
- ✅ 设备状态统计
- ✅ 快速预览/控制
- ✅ 下拉刷新/上拉加载

### 3. 告警管理 (alert.vue)

**已实现功能**:
- ✅ 告警统计概览
- ✅ 告警列表(分级显示)
- ✅ 告警筛选
- ✅ 快速处理(确认/忽略/转发)
- ✅ WebSocket实时推送
- ✅ 震动/声音提醒

---

## 移动端API接口

基于现有代码调用的API：

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取设备列表 | GET | /ivs/v1/mobile/devices | 移动端设备列表 |
| 获取监控画面 | GET | /ivs/v1/mobile/monitor/{deviceId} | 获取视频流 |
| 获取多画面 | POST | /ivs/v1/mobile/multi-monitor | 四画面模式 |
| 云台控制 | POST | /ivs/v1/mobile/ptz/control | PTZ控制 |
| 获取预置位 | GET | /ivs/v1/mobile/preset/{deviceId} | 预置位列表 |
| 调用预置位 | POST | /ivs/v1/mobile/preset/goto | 转到预置位 |
| 获取告警概览 | GET | /ivs/v1/mobile/alarm/overview | 告警统计 |
| 获取告警列表 | GET | /ivs/v1/mobile/alarm/active | 活跃告警 |
| 处理告警 | POST | /ivs/v1/mobile/alarm/process | 处理告警 |
| 快捷操作 | POST | /ivs/v1/mobile/action | 截图/录像 |
| 设备统计 | GET | /ivs/v1/mobile/statistics | 设备统计 |

---

## 移动端优化建议

### 1. 网络适配优化

```javascript
// 建议增强：动态码流切换
const adaptiveStream = async () => {
  const networkType = await getNetworkType()
  switch(networkType) {
    case 'wifi':
      return { quality: '720p', protocol: 'HLS' }
    case '4g':
      return { quality: '480p', protocol: 'HLS' }
    case '3g':
      return { quality: '360p', protocol: 'HLS' }
    default:
      return { quality: '240p', protocol: 'HLS' }
  }
}
```

### 2. 离线能力

```javascript
// 建议增加：离线告警缓存
const cacheAlarms = async (alarms) => {
  await uni.setStorage({
    key: 'offline_alarms',
    data: JSON.stringify(alarms)
  })
}
```

### 3. 推送增强

```javascript
// 建议增加：本地通知
const showLocalNotification = (alarm) => {
  uni.createPushMessage({
    title: '视频告警',
    content: alarm.message,
    payload: { alarmId: alarm.id }
  })
}
```

---

## 性能指标(移动端)

| 指标 | 要求 |
|------|------|
| 首屏加载 | < 2秒 |
| 视频起播 | < 3秒(WiFi) / < 5秒(4G) |
| 告警推送延迟 | < 1秒 |
| 云台响应 | < 500ms |
| 内存占用 | < 200MB |
| 电量消耗 | < 5%/小时(后台) |

---

## 权限要求

| 权限 | 用途 |
|------|------|
| 网络访问 | 视频流加载 |
| 通知权限 | 告警推送 |
| 震动权限 | 告警提醒 |
| 存储权限 | 截图保存 |
| 后台运行 | 告警推送接收 |
