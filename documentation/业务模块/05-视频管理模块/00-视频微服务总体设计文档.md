# è§†é¢‘ç®¡ç†å¾®æœåŠ¡ - æ€»ä½“è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.1.0 - è¾¹ç¼˜AIè®¡ç®—æ¨¡å¼  
> **å¾®æœåŠ¡**: ioedream-video-service (8092)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17  
> **è®¾å¤‡äº¤äº’æ¨¡å¼**: è¾¹ç¼˜AIè®¡ç®—æ¨¡å¼ï¼ˆMode 5ï¼‰

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

è§†é¢‘ç®¡ç†å¾®æœåŠ¡è´Ÿè´£ä¼ä¸šè§†é¢‘ç›‘æ§çš„å…¨é¢ç®¡ç†ï¼ŒåŒ…æ‹¬å®æ—¶ç›‘æ§ã€è§†é¢‘å›æ”¾ã€AIè¡Œä¸ºåˆ†æã€å‘Šè­¦ç®¡ç†ã€è§£ç ä¸Šå¢™å’Œåœ°å›¾å±•ç¤ºç­‰åŠŸèƒ½ã€‚

æœ¬æ–‡æ¡£æ˜¯IOE-DREAMæ™ºæ…§è§†é¢‘ç®¡ç†å¾®æœåŠ¡çš„æ€»ä½“è®¾è®¡æ–‡æ¡£ï¼ŒåŸºäº**è¾¹ç¼˜AIè®¡ç®—æ¨¡å¼**è®¾è®¡ï¼Œç¡®ä¿è§†é¢‘å¾®æœåŠ¡ä¸‹æ¯ä¸ªå­æ¨¡å—çš„å®Œæ•´æ€§ã€ç³»ç»Ÿæ€§å’Œä¸€è‡´æ€§ã€‚

---

## â­ è¾¹ç¼˜AIè®¡ç®—æ¨¡å¼ï¼ˆMode 5ï¼‰

### æ ¸å¿ƒç†å¿µ

è§†é¢‘ç›‘æ§ç³»ç»Ÿé‡‡ç”¨**è¾¹ç¼˜AIè®¡ç®—æ¨¡å¼**ï¼Œè®¾å¤‡ç«¯AIåˆ†æï¼ŒæœåŠ¡å™¨ç«¯ç®¡ç†ã€‚

### è®¾å¤‡äº¤äº’æµç¨‹

```
ã€æ¨¡æ¿ä¸‹å‘ã€‘è½¯ä»¶ â†’ è®¾å¤‡
  â”œâ”€ é‡ç‚¹äººå‘˜åº•åº“ï¼ˆé»‘åå•/VIP/å‘˜å·¥ï¼‰
  â”œâ”€ AIæ¨¡å‹æ›´æ–°ï¼ˆå®šæœŸæ¨é€æ–°ç‰ˆæœ¬ï¼‰
  â””â”€ å‘Šè­¦è§„åˆ™é…ç½®ï¼ˆåŒºåŸŸå…¥ä¾µ/å¾˜å¾Šæ£€æµ‹ï¼‰

ã€å®æ—¶åˆ†æã€‘è®¾å¤‡ç«¯AIå¤„ç†
  è§†é¢‘é‡‡é›† â†’ AIèŠ¯ç‰‡åˆ†æ â†’ äººè„¸æ£€æµ‹+è¯†åˆ«
            â†“
  è¡Œä¸ºåˆ†æ â†’ å¼‚å¸¸æ£€æµ‹ï¼ˆå¾˜å¾Š/èšé›†/è¶Šç•Œï¼‰
            â†“
  ç»“æ„åŒ–æ•°æ® â†’ ä¸Šä¼ æœåŠ¡å™¨

ã€æœåŠ¡å™¨å¤„ç†ã€‘è½¯ä»¶ç«¯
  æ¥æ”¶ç»“æ„åŒ–æ•°æ® â†’ å­˜å‚¨ï¼ˆäººè„¸æŠ“æ‹/è¡Œä¸ºäº‹ä»¶ï¼‰
  å‘Šè­¦è§„åˆ™åŒ¹é… â†’ å®æ—¶æ¨é€å‘Šè­¦
  äººè„¸æ£€ç´¢ â†’ ä»¥å›¾æœå›¾/è½¨è¿¹è¿½è¸ª
  è§†é¢‘è”åŠ¨ â†’ å‘Šè­¦æ—¶è°ƒå–åŸå§‹è§†é¢‘

ã€åŸå§‹è§†é¢‘ã€‘è®¾å¤‡ç«¯å­˜å‚¨
  âš ï¸ åŸå§‹è§†é¢‘ä¸ä¸Šä¼ ï¼Œè®¾å¤‡ç«¯å½•åƒ7-30å¤©
  âš ï¸ åªæœ‰å‘Šè­¦/æ¡ˆä»¶æ—¶ï¼Œæ‰å›è°ƒåŸå§‹è§†é¢‘
```

### æŠ€æœ¯ä¼˜åŠ¿

- âœ… **å¸¦å®½èŠ‚çœ**: åªä¸Šä¼ ç»“æ„åŒ–æ•°æ®ï¼ŒèŠ‚çœ>95%å¸¦å®½
- âœ… **å®æ—¶å“åº”**: è®¾å¤‡ç«¯AIåˆ†æï¼Œå‘Šè­¦å»¶è¿Ÿ<1ç§’
- âœ… **éšç§ä¿æŠ¤**: åŸå§‹è§†é¢‘ä¸ä¸Šä¼ ï¼Œç¬¦åˆéšç§æ³•è§„

### æ¶æ„è¦æ±‚

- âœ… è®¾å¤‡ç«¯å¿…é¡»æ”¯æŒAIèŠ¯ç‰‡åˆ†æ
- âœ… åªä¸Šä¼ ç»“æ„åŒ–æ•°æ®ï¼Œä¸ä¸Šä¼ åŸå§‹è§†é¢‘
- âœ… å‘Šè­¦æ—¶æ”¯æŒå›è°ƒåŸå§‹è§†é¢‘
- âœ… æ”¯æŒAIæ¨¡å‹è¿œç¨‹æ›´æ–°

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph æ¥å…¥å±‚
        API[REST API]
        WS[WebSocket]
        RTSP[RTSPæµ]
    end
    
    subgraph ä¸šåŠ¡å±‚
        LIVE[å®æ—¶ç›‘æ§]
        DEVICE[è®¾å¤‡ç®¡ç†]
        PLAYBACK[è§†é¢‘å›æ”¾]
        AI[è¡Œä¸ºåˆ†æ]
        ALARM[å‘Šè­¦ç®¡ç†]
        WALL[è§£ç ä¸Šå¢™]
        MAP[åœ°å›¾å±•ç¤º]
    end
    
    subgraph æ•°æ®å±‚
        MySQL[(MySQL)]
        Redis[(Redis)]
        OSS[(å¯¹è±¡å­˜å‚¨)]
        ES[(Elasticsearch)]
    end
    
    subgraph æµåª’ä½“å±‚
        SRS[SRSæµåª’ä½“]
        FFMPEG[FFmpegè½¬ç ]
    end
    
    API --> DEVICE
    API --> PLAYBACK
    WS --> LIVE
    RTSP --> SRS
    
    LIVE --> SRS
    AI --> MySQL
    PLAYBACK --> OSS
    ALARM --> ES
```

---

## ğŸ“ ä»£ç ç»“æ„

```
ioedream-video-service/src/main/java/net/lab1024/sa/video/
â”œâ”€â”€ VideoApplication.java                   # å¯åŠ¨ç±»
â”œâ”€â”€ controller/                             # Controllerå±‚
â”‚   â”œâ”€â”€ CameraDeviceController.java        # è®¾å¤‡ç®¡ç†
â”‚   â”œâ”€â”€ LiveMonitorController.java         # å®æ—¶ç›‘æ§
â”‚   â”œâ”€â”€ PlaybackController.java            # è§†é¢‘å›æ”¾
â”‚   â”œâ”€â”€ AIAnalysisController.java          # è¡Œä¸ºåˆ†æ
â”‚   â”œâ”€â”€ VideoAlarmController.java          # å‘Šè­¦ç®¡ç†
â”‚   â”œâ”€â”€ VideoWallController.java           # è§£ç ä¸Šå¢™
â”‚   â””â”€â”€ VideoMapController.java            # åœ°å›¾å±•ç¤º
â”œâ”€â”€ service/                                # Serviceå±‚
â”‚   â”œâ”€â”€ CameraDeviceService.java
â”‚   â”œâ”€â”€ LiveMonitorService.java
â”‚   â”œâ”€â”€ PlaybackService.java
â”‚   â”œâ”€â”€ AIAnalysisService.java
â”‚   â”œâ”€â”€ VideoAlarmService.java
â”‚   â”œâ”€â”€ VideoWallService.java
â”‚   â””â”€â”€ VideoMapService.java
â”œâ”€â”€ dao/                                    # DAOå±‚
â”‚   â”œâ”€â”€ CameraDeviceDao.java
â”‚   â”œâ”€â”€ VideoRecordDao.java
â”‚   â”œâ”€â”€ VideoAlarmDao.java
â”‚   â””â”€â”€ VideoWallDao.java
â”œâ”€â”€ domain/                                 # é¢†åŸŸå¯¹è±¡
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/
â””â”€â”€ manager/                                # Managerå±‚
    â”œâ”€â”€ StreamManager.java
    â””â”€â”€ AIAnalysisManager.java
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. å®æ—¶ç›‘æ§
- å¤šç”»é¢åˆ†å‰²æ˜¾ç¤ºï¼ˆ1/4/9/16ç”»é¢ï¼‰
- PTZäº‘å°æ§åˆ¶
- å®æ—¶æŠ“æ‹
- ç”»é¢è½®å·¡
- ç”µå­æ”¾å¤§

### 2. è®¾å¤‡ç®¡ç†
- æ‘„åƒå¤´æ³¨å†Œç®¡ç†
- è®¾å¤‡åˆ†ç»„ç®¡ç†
- è®¾å¤‡çŠ¶æ€ç›‘æ§
- ONVIFè®¾å¤‡å‘ç°
- å½•åƒè®¡åˆ’é…ç½®

### 3. è§†é¢‘å›æ”¾
- æ—¶é—´è½´å›æ”¾
- äº‹ä»¶å›æ”¾
- ä¸‹è½½å½•åƒ
- å½•åƒæ£€ç´¢
- å¤šå€é€Ÿæ’­æ”¾

### 4. è¡Œä¸ºåˆ†æ
- äººå‘˜æ£€æµ‹
- è¶Šç•Œæ£€æµ‹
- å…¥ä¾µæ£€æµ‹
- ç¦»å²—æ£€æµ‹
- äººç¾¤èšé›†æ£€æµ‹
- çƒŸç«æ£€æµ‹

### 5. å‘Šè­¦ç®¡ç†
- å®æ—¶å‘Šè­¦æ¨é€
- å‘Šè­¦è”åŠ¨
- å‘Šè­¦å¤„ç†
- å‘Šè­¦ç»Ÿè®¡
- å‘Šè­¦è®¢é˜…

### 6. è§£ç ä¸Šå¢™
- ç”µè§†å¢™ç®¡ç†
- çª—å£å¸ƒå±€é…ç½®
- è§†é¢‘è½®å·¡è®¡åˆ’
- é¢„æ¡ˆç®¡ç†

### 7. åœ°å›¾å±•ç¤º
- è®¾å¤‡åˆ†å¸ƒåœ°å›¾
- å®æ—¶çŠ¶æ€æ˜¾ç¤º
- å‘Šè­¦å®šä½
- åŒºåŸŸçƒ­åŠ›å›¾

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ |
|------|------|
| t_video_camera | æ‘„åƒå¤´è®¾å¤‡è¡¨ |
| t_video_record | å½•åƒè®°å½•è¡¨ |
| t_video_alarm | è§†é¢‘å‘Šè­¦è¡¨ |
| t_video_wall | ç”µè§†å¢™é…ç½®è¡¨ |
| t_video_wall_window | å¢™çª—å£é…ç½®è¡¨ |
| t_video_ai_config | AIåˆ†æé…ç½®è¡¨ |
| t_video_ai_result | AIåˆ†æç»“æœè¡¨ |

### ERå›¾

```mermaid
erDiagram
    t_video_camera {
        bigint id PK
        varchar camera_name
        varchar camera_sn
        varchar ip_address
        int port
        varchar stream_url
        varchar protocol
        bigint area_id FK
        tinyint status
    }
    
    t_video_record {
        bigint id PK
        bigint camera_id FK
        datetime start_time
        datetime end_time
        varchar file_path
        bigint file_size
        varchar record_type
    }
    
    t_video_alarm {
        bigint id PK
        bigint camera_id FK
        varchar alarm_type
        varchar alarm_level
        datetime alarm_time
        varchar snapshot_url
        tinyint handle_status
    }
    
    t_video_ai_result {
        bigint id PK
        bigint camera_id FK
        varchar analysis_type
        json result_data
        datetime analysis_time
        decimal confidence
    }
    
    t_video_camera ||--o{ t_video_record : "å½•åƒ"
    t_video_camera ||--o{ t_video_alarm : "å‘Šè­¦"
    t_video_camera ||--o{ t_video_ai_result : "åˆ†æ"
```

---

## ğŸ”§ APIæ¥å£è®¾è®¡

### å®æ—¶ç›‘æ§

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/video/v1/live/stream/{cameraId} | è·å–è§†é¢‘æµ |
| POST | /api/video/v1/live/ptz/control | PTZæ§åˆ¶ |
| POST | /api/video/v1/live/capture | å®æ—¶æŠ“æ‹ |

### è§†é¢‘å›æ”¾

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/video/v1/playback/list | å½•åƒåˆ—è¡¨ |
| GET | /api/video/v1/playback/url | è·å–å›æ”¾åœ°å€ |
| POST | /api/video/v1/playback/download | ä¸‹è½½å½•åƒ |

### å‘Šè­¦ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/video/v1/alarm/list | å‘Šè­¦åˆ—è¡¨ |
| PUT | /api/video/v1/alarm/handle | å¤„ç†å‘Šè­¦ |
| GET | /api/video/v1/alarm/statistics | å‘Šè­¦ç»Ÿè®¡ |

### AIåˆ†æ

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/video/v1/ai/start | å¯åŠ¨åˆ†æ |
| POST | /api/video/v1/ai/stop | åœæ­¢åˆ†æ |
| GET | /api/video/v1/ai/result | åˆ†æç»“æœ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡é¡¹ | è¦æ±‚ |
|--------|------|
| è§†é¢‘æµå»¶è¿Ÿ | â‰¤ 3s |
| å•æ‘„åƒå¤´å¹¶å‘ | â‰¥ 20è·¯ |
| å½•åƒæ£€ç´¢æ—¶é—´ | â‰¤ 2s |
| AIåˆ†æå»¶è¿Ÿ | â‰¤ 500ms |
| å‘Šè­¦æ¨é€å»¶è¿Ÿ | â‰¤ 1s |
| å½•åƒä¿å­˜å‘¨æœŸ | â‰¥ 30å¤© |

---

## ğŸ” å®‰å…¨è¦æ±‚

- è§†é¢‘æµä¼ è¾“åŠ å¯†
- å½•åƒæ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ
- è®¾å¤‡è®¿é—®é‰´æƒ
- æ•æ„ŸåŒºåŸŸè§†é¢‘è„±æ•
- æ“ä½œå®¡è®¡æ—¥å¿—

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
