# 视频回放模块 - 功能说明

## 模块概述

视频回放模块提供历史录像的检索、播放和下载功能，支持按时间、设备、事件类型等多维度检索录像。

## 功能清单

### 1. 录像检索

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 按时间检索 | 指定时间段查询录像 | Level 2+ |
| 按设备检索 | 指定设备查询录像 | Level 2+ |
| 按事件检索 | 按告警/移动检测等事件 | Level 3+ |
| 组合检索 | 多条件组合查询 | Level 2+ |
| 时间轴展示 | 可视化录像时间轴 | Level 2+ |

### 2. 录像播放

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 正常播放 | 1x速度播放 | Level 2+ |
| 快进/快退 | 2x/4x/8x/16x速度 | Level 2+ |
| 慢放 | 0.5x/0.25x速度 | Level 2+ |
| 逐帧播放 | 单帧前进/后退 | Level 3+ |
| 进度跳转 | 点击时间轴跳转 | Level 2+ |
| 截图 | 回放画面截图 | Level 2+ |

### 3. 录像下载

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 单段下载 | 下载单条录像 | Level 3+ |
| 时间段下载 | 按时间段裁剪下载 | Level 3+ |
| 批量下载 | 多条录像打包下载 | Level 4+ |
| 下载进度 | 显示下载进度 | Level 3+ |
| 下载任务管理 | 管理下载队列 | Level 3+ |

### 4. 智能检索

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 人脸检索 | 按人脸图片检索 | Level 4+ |
| 行为检索 | 按行为类型检索 | Level 4+ |
| 车牌检索 | 按车牌号检索 | Level 3+ |
| 以图搜图 | 图片相似度搜索 | Level 4+ |

## 录像存储架构

```
┌─────────────────────────────────────────────────────────────┐
│                     录像存储系统                             │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 热数据      │  │ 温数据      │  │ 冷数据      │         │
│  │ (SSD)      │  │ (HDD)      │  │ (对象存储)  │         │
│  │ 7天内       │  │ 7-30天     │  │ 30天以上    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│         │                │                │                │
│         └────────────────┴────────────────┘                │
│                         │                                   │
│              ┌──────────┴──────────┐                       │
│              │   录像索引服务       │                       │
│              │   (PostgreSQL)      │                       │
│              └─────────────────────┘                       │
└─────────────────────────────────────────────────────────────┘
```

## 界面设计

```
┌─────────────────────────────────────────────────────────────────┐
│ 📹 录像回放                                                      │
├─────────────────────────────────────────────────────────────────┤
│ 设备: [大门摄像机▼]  日期: [2024-01-15]  类型: [全部▼]  🔍 查询  │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │                                                             │ │
│ │                     视频播放区域                             │ │
│ │                                                             │ │
│ └─────────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 00:00    04:00    08:00    12:00    16:00    20:00    24:00 │ │
│ │ ████████░░░░░░████████████████████████████░░░░░░░░░░░░████ │ │
│ │ █ 有录像  ░ 无录像                                          │ │
│ └─────────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ⏮️ ◀️ 0.5x │ ▶️ 播放 │ 2x ▶️ ⏭️ │ 📷截图 │ ⬇️下载 │ 当前: 10:30:25 │ │
│ └─────────────────────────────────────────────────────────────┘ │
│ 录像列表:                                                       │
│ ┌───────────────────────────────────────────────────────────┐   │
│ │ 开始时间          │ 结束时间          │ 时长   │ 操作    │   │
│ │ 2024-01-15 00:00  │ 2024-01-15 04:00  │ 4小时  │ 播放/下载│   │
│ │ 2024-01-15 08:00  │ 2024-01-15 20:00  │ 12小时 │ 播放/下载│   │
│ └───────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 性能指标

| 指标 | 要求 |
|------|------|
| 检索响应 | < 2秒 |
| 起播时间 | < 3秒 |
| 跳转响应 | < 1秒 |
| 下载速度 | ≥ 10MB/s |
| 并发回放 | 单用户最多4路 |
