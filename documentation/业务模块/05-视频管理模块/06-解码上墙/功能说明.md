# 解码上墙模块 - 功能说明

## 模块概述

解码上墙模块负责管理解码器设备、电视墙布局配置以及视频上墙任务，实现监控中心大屏展示功能。

## 功能清单

### 1. 解码器管理

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 解码器列表 | 查看所有解码器 | Level 3+ |
| 解码器状态 | 实时状态监控 | Level 3+ |
| 通道管理 | 管理解码通道 | Level 4+ |
| 能力查询 | 查询解码能力 | Level 3+ |

### 2. 电视墙管理

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 电视墙列表 | 查看电视墙配置 | Level 3+ |
| 布局配置 | 配置分屏布局 | Level 4+ |
| 屏幕映射 | 解码器-屏幕映射 | Level 4+ |
| 预案管理 | 配置预置场景 | Level 4+ |

### 3. 上墙任务

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 手动上墙 | 拖拽视频到屏幕 | Level 3+ |
| 预案调用 | 一键切换预案 | Level 3+ |
| 轮巡上墙 | 配置轮巡任务 | Level 4+ |
| 紧急插播 | 告警联动上墙 | Level 4+ |
| 任务状态 | 上墙任务监控 | Level 3+ |

### 4. 大屏控制

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 分屏切换 | 切换分屏模式 | Level 3+ |
| 画面切换 | 切换单画面内容 | Level 3+ |
| 声音控制 | 控制音频输出 | Level 3+ |
| 全屏控制 | 单画面全屏 | Level 3+ |

## 电视墙架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      电视墙系统架构                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    视频服务层                           │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                │   │
│  │  │视频预览  │  │录像回放  │  │告警视频  │                │   │
│  │  └────┬────┘  └────┬────┘  └────┬────┘                │   │
│  │       └─────────────┴─────────────┘                    │   │
│  │                     │                                   │   │
│  └─────────────────────┼───────────────────────────────────┘   │
│                        ▼                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  上墙任务调度                            │   │
│  │  任务队列 → 解码器选择 → 通道分配 → 流转发            │   │
│  └─────────────────────┼───────────────────────────────────┘   │
│                        ▼                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  解码器集群                              │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                │   │
│  │  │解码器1   │  │解码器2   │  │解码器3   │                │   │
│  │  │4通道    │  │4通道    │  │4通道    │                │   │
│  │  └────┬────┘  └────┬────┘  └────┬────┘                │   │
│  │       └─────────────┴─────────────┘                    │   │
│  │                     │ HDMI/VGA/DVI                      │   │
│  └─────────────────────┼───────────────────────────────────┘   │
│                        ▼                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   电视墙                                 │   │
│  │  ┌─────┬─────┬─────┬─────┐                             │   │
│  │  │ 1   │ 2   │ 3   │ 4   │                             │   │
│  │  ├─────┼─────┼─────┼─────┤                             │   │
│  │  │ 5   │ 6   │ 7   │ 8   │                             │   │
│  │  ├─────┼─────┼─────┼─────┤                             │   │
│  │  │ 9   │ 10  │ 11  │ 12  │                             │   │
│  │  └─────┴─────┴─────┴─────┘                             │   │
│  │           3×4 拼接屏                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 界面设计

```
┌─────────────────────────────────────────────────────────────────┐
│ 🖥️ 解码上墙                                                     │
├─────────────────────────────────────────────────────────────────┤
│ ┌───────────────┐ ┌─────────────────────────────────────────┐   │
│ │ 设备树        │ │           电视墙预览                      │   │
│ │ ├─园区        │ │  ┌─────┬─────┬─────┬─────┐              │   │
│ │ │ ├─摄像机1   │ │  │ 📹1 │ 📹2 │ 📹3 │ 📹4 │              │   │
│ │ │ ├─摄像机2   │ │  ├─────┼─────┼─────┼─────┤              │   │
│ │ │ └─摄像机3   │ │  │ 📹5 │ 📹6 │ 📹7 │ 📹8 │              │   │
│ │ └─办公区      │ │  ├─────┼─────┼─────┼─────┤              │   │
│ │   ├─摄像机4   │ │  │ 📹9 │ 📹10│ 📹11│ 📹12│              │   │
│ │   └─摄像机5   │ │  └─────┴─────┴─────┴─────┘              │   │
│ └───────────────┘ │  拖拽摄像机到对应窗口完成上墙             │   │
│ ───────────────── └─────────────────────────────────────────────┘   │
│ 预案列表:         上墙任务:                                     │
│ ┌───────────────┐ ┌─────────────────────────────────────────┐   │
│ │ 🎬 日常监控   │ │ 窗口1: 大门摄像机     状态: 🟢 正常     │   │
│ │ 🎬 夜间巡逻   │ │ 窗口2: 停车场摄像机   状态: 🟢 正常     │   │
│ │ 🎬 紧急预案   │ │ 窗口3: --空--        状态: ⚪ 空闲     │   │
│ │ [+新建预案]   │ │ ...                                     │   │
│ └───────────────┘ └─────────────────────────────────────────┘   │
│ [保存布局] [调用预案] [清空所有] [轮巡配置]                      │
└─────────────────────────────────────────────────────────────────┘
```

## 数据结构

### ivs_decoder (解码器表)

```sql
CREATE TABLE ivs_decoder (
    decoder_id BIGSERIAL PRIMARY KEY,
    decoder_name VARCHAR(100) NOT NULL,
    decoder_sn VARCHAR(64) UNIQUE,
    ip_address VARCHAR(50),
    port INT DEFAULT 8000,
    channel_count INT DEFAULT 4,
    max_resolution VARCHAR(20),
    status TINYINT DEFAULT 0,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) COMMENT='解码器表';
```

### ivs_display_wall (电视墙表)

```sql
CREATE TABLE ivs_display_wall (
    wall_id BIGSERIAL PRIMARY KEY,
    wall_name VARCHAR(100) NOT NULL,
    rows INT NOT NULL,
    cols INT NOT NULL,
    total_screens INT,
    description VARCHAR(500),
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) COMMENT='电视墙配置表';
```

### ivs_display_task (上墙任务表)

```sql
CREATE TABLE ivs_display_task (
    task_id BIGSERIAL PRIMARY KEY,
    wall_id BIGINT NOT NULL,
    window_no INT NOT NULL,
    device_id BIGINT,
    decoder_id BIGINT,
    channel_no INT,
    task_type TINYINT DEFAULT 0,
    status TINYINT DEFAULT 0,
    start_time TIMESTAMP,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) COMMENT='上墙任务表';
```
