# 设备管理交互模块 - 需求规格说明

## 功能需求

### FR-DEV-001: 设备信息订阅
| 项目 | 描述 |
|------|------|
| 需求ID | FR-DEV-001 |
| 优先级 | P0 |
| 前置条件 | 用户已登录，权限>=Level 2 |
| 操作步骤 | 1.选择订阅类型 2.选择目标设备/区域 3.确认订阅 |
| 后置结果 | 订阅成功，实时接收设备变更消息 |

### FR-DEV-002: 设备状态同步
| 项目 | 描述 |
|------|------|
| 需求ID | FR-DEV-002 |
| 优先级 | P0 |
| 前置条件 | 设备服务通信正常 |
| 操作步骤 | 1.定时拉取状态 2.比对变更 3.更新本地 4.推送订阅者 |
| 后置结果 | 本地设备状态与设备服务保持同步 |

### FR-DEV-003: 设备树查询
| 项目 | 描述 |
|------|------|
| 需求ID | FR-DEV-003 |
| 优先级 | P1 |
| 前置条件 | 用户已登录，权限>=Level 2 |
| 操作步骤 | 1.加载区域树 2.按需展开节点 3.显示设备列表 |
| 后置结果 | 返回层级结构的设备树数据 |

### FR-DEV-004: 设备搜索
| 项目 | 描述 |
|------|------|
| 需求ID | FR-DEV-004 |
| 优先级 | P1 |
| 前置条件 | 用户已登录，权限>=Level 2 |
| 操作步骤 | 1.输入关键词 2.触发搜索 3.显示结果 |
| 后置结果 | 返回匹配的设备列表 |

### FR-DEV-005: 设备离线告警
| 项目 | 描述 |
|------|------|
| 需求ID | FR-DEV-005 |
| 优先级 | P0 |
| 前置条件 | 已配置离线检测规则 |
| 操作步骤 | 1.心跳超时检测 2.标记离线 3.生成告警 4.推送通知 |
| 后置结果 | 设备离线时自动产生告警并通知 |

---

## 非功能需求

### NFR-DEV-001: 性能要求
| 指标 | 要求 |
|------|------|
| 设备树加载 | < 2秒(1000设备规模) |
| 状态同步延迟 | < 5秒 |
| 订阅推送延迟 | < 1秒 |
| 搜索响应 | < 500ms |

### NFR-DEV-002: 可靠性要求
| 指标 | 要求 |
|------|------|
| 消息送达率 | ≥ 99.9% |
| 状态同步准确率 | 100% |
| WebSocket可用性 | ≥ 99.9% |

### NFR-DEV-003: 安全性要求
| 要求 | 描述 |
|------|------|
| 权限控制 | 按权限级别过滤设备 |
| 数据脱敏 | 设备密码等敏感信息加密 |
| 操作审计 | 记录关键操作日志 |

---

## 验收标准

### AC-DEV-001: 订阅功能验收
- [ ] 订阅配置成功保存
- [ ] 订阅后收到相关事件推送
- [ ] 取消订阅后不再收到推送
- [ ] 订阅配置在重新登录后保持

### AC-DEV-002: 状态同步验收
- [ ] 设备上线/离线状态实时更新
- [ ] 状态变更通知延迟<5秒
- [ ] 批量设备状态查询正常
- [ ] 状态统计数据准确

### AC-DEV-003: 设备树验收
- [ ] 设备树层级正确显示
- [ ] 节点展开/折叠正常
- [ ] 各节点设备计数准确
- [ ] 设备拖拽到预览窗口正常

### AC-DEV-004: 离线告警验收
- [ ] 设备离线30秒内产生告警
- [ ] 告警信息包含设备详情
- [ ] 订阅用户收到告警通知
- [ ] 设备恢复后告警自动清除
