# 设备管理交互模块 - 功能说明

## 模块概述

设备管理交互模块负责与设备通讯服务(ioedream-device-comm-service)进行数据交互，通过事件订阅中心实现设备信息的订阅、同步和状态管理。

## 功能清单

### 1. 设备信息订阅

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 订阅设备列表 | 订阅指定区域设备信息 | Level 2+ |
| 订阅设备状态 | 订阅设备在线/离线状态 | Level 2+ |
| 订阅设备告警 | 订阅设备故障告警 | Level 3+ |
| 取消订阅 | 取消设备信息订阅 | Level 2+ |

### 2. 设备状态同步

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 实时状态同步 | 接收设备状态变更推送 | Level 2+ |
| 状态查询 | 主动查询设备当前状态 | Level 2+ |
| 批量状态查询 | 批量查询多设备状态 | Level 3+ |
| 状态统计 | 设备状态统计分析 | Level 3+ |

### 3. 设备信息管理

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 设备列表查询 | 分页查询设备列表 | Level 2+ |
| 设备详情查看 | 查看设备详细信息 | Level 2+ |
| 设备搜索 | 按名称/IP/区域搜索 | Level 2+ |
| 设备树构建 | 按区域构建设备树 | Level 2+ |

### 4. 离线告警

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 离线检测 | 检测设备离线状态 | 系统自动 |
| 告警推送 | 推送设备离线告警 | 系统自动 |
| 告警确认 | 确认处理离线告警 | Level 3+ |
| 告警统计 | 离线告警统计分析 | Level 4+ |

## 事件订阅模型

```
┌─────────────────────────────────────────────────────────────┐
│                    事件订阅中心                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │ 设备信息事件 │    │ 状态变更事件 │    │ 告警事件    │     │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘     │
│         │                  │                  │            │
│         ▼                  ▼                  ▼            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              消息队列 (RabbitMQ)                     │   │
│  └─────────────────────────────────────────────────────┘   │
│         │                  │                  │            │
│         ▼                  ▼                  ▼            │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │ 设备服务    │    │ 视频服务    │    │ 告警服务    │     │
│  │ (生产者)    │    │ (消费者)    │    │ (消费者)    │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
└─────────────────────────────────────────────────────────────┘
```

## 数据交互协议

### 设备信息事件格式

```json
{
  "eventType": "DEVICE_INFO_UPDATE",
  "deviceId": 1001,
  "deviceName": "大门摄像机",
  "deviceType": "IPC",
  "ipAddress": "192.168.1.100",
  "status": "ONLINE",
  "regionId": 1,
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 状态变更事件格式

```json
{
  "eventType": "DEVICE_STATUS_CHANGE",
  "deviceId": 1001,
  "oldStatus": "ONLINE",
  "newStatus": "OFFLINE",
  "reason": "NETWORK_TIMEOUT",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## 设备类型支持

| 设备类型 | 编码 | 说明 |
|----------|------|------|
| IPC | 131 | 网络摄像机 |
| NVR | 118 | 网络硬盘录像机 |
| DVR | 111 | 数字硬盘录像机 |
| PTZ | 132 | 云台摄像机 |
| DECODER | 134 | 解码器 |

## 界面设计

```
┌─────────────────────────────────────────────────────────────┐
│ 设备管理                                              🔄 刷新│
├─────────────────────────────────────────────────────────────┤
│ 🔍 搜索设备...                    状态: [全部▼] 类型: [全部▼]│
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┐ ┌───────────────────────────────────────────┐  │
│ │ 设备树   │ │ 设备名称     │ IP地址      │ 状态 │ 操作 │  │
│ │ ├─园区   │ ├──────────────┼─────────────┼──────┼──────┤  │
│ │ │ ├─大门 │ │ 大门摄像机   │192.168.1.100│ 🟢   │ 详情 │  │
│ │ │ ├─停车场│ │ 停车场摄像机 │192.168.1.101│ 🟢   │ 详情 │  │
│ │ │ └─大厅 │ │ 大厅摄像机   │192.168.1.102│ 🔴   │ 详情 │  │
│ │ └─办公区 │ └──────────────┴─────────────┴──────┴──────┘  │
│ └─────────┘                                                 │
│ 统计: 在线 15/18  离线 3                                    │
└─────────────────────────────────────────────────────────────┘
```
