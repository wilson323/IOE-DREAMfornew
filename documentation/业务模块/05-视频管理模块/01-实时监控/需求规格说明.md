# 实时监控模块 - 需求规格说明

## 功能需求

### FR-MON-001: 视频预览

| 需求项 | 描述 |
|--------|------|
| **需求ID** | FR-MON-001 |
| **优先级** | P0 (必须) |
| **前置条件** | 用户登录且权限>=Level2，设备在线 |
| **操作步骤** | 1. 选择设备 → 2. 请求视频流 → 3. 播放器渲染 |
| **后置结果** | 视频画面实时显示，延迟<2秒 |

**详细说明**:
- 支持RTSP/RTMP/HLS/WebRTC/HTTP-FLV协议
- 支持1/4/9/16画面分屏
- 支持画面拖拽调整
- 支持双击全屏

### FR-MON-002: 云台控制

| 需求项 | 描述 |
|--------|------|
| **需求ID** | FR-MON-002 |
| **优先级** | P0 (必须) |
| **前置条件** | 用户权限>=Level3，设备支持PTZ |
| **操作步骤** | 1. 选中设备 → 2. 操作控制面板 → 3. 设备执行 |
| **后置结果** | 云台按指令移动，响应<500ms |

**详细说明**:
- 8方向控制：上/下/左/右/左上/右上/左下/右下
- 变焦控制：放大/缩小
- 聚焦控制：近焦/远焦
- 光圈控制：大/小(Level4+)
- 设备锁机制防止并发冲突

### FR-MON-003: 预置位管理

| 需求项 | 描述 |
|--------|------|
| **需求ID** | FR-MON-003 |
| **优先级** | P1 (重要) |
| **前置条件** | 用户权限>=Level3，设备支持预置位 |
| **操作步骤** | 设置: 调整位置→保存 / 调用: 选择预置位→执行 |
| **后置结果** | 预置位保存/云台移动到预置位 |

**详细说明**:
- 每设备最多256个预置位
- 支持预置位命名
- 调用响应<2秒

### FR-MON-004: 视频截图

| 需求项 | 描述 |
|--------|------|
| **需求ID** | FR-MON-004 |
| **优先级** | P1 (重要) |
| **前置条件** | 用户权限>=Level2，正在预览视频 |
| **操作步骤** | 点击截图→抓取帧→保存/下载 |
| **后置结果** | 生成截图文件，自动添加水印 |

**详细说明**:
- 支持JPG/PNG格式
- 自动添加时间、设备名水印
- 支持本地下载

### FR-MON-005: 手动录制

| 需求项 | 描述 |
|--------|------|
| **需求ID** | FR-MON-005 |
| **优先级** | P1 (重要) |
| **前置条件** | 用户权限>=Level3，存储空间充足 |
| **操作步骤** | 点击录制→录制中→点击停止→保存 |
| **后置结果** | 生成录像文件，记录入库 |

**详细说明**:
- 支持MP4格式
- 显示录制时长
- 单次录制上限30分钟
- 支持断点续录

### FR-MON-006: 画面轮巡

| 需求项 | 描述 |
|--------|------|
| **需求ID** | FR-MON-006 |
| **优先级** | P2 (一般) |
| **前置条件** | 用户权限>=Level3，配置轮巡列表 |
| **操作步骤** | 配置设备列表→设置间隔→启动轮巡 |
| **后置结果** | 按间隔自动切换预览设备 |

**详细说明**:
- 轮巡间隔5-300秒可配
- 最多32个设备
- 支持暂停/恢复

---

## 非功能需求

### NFR-MON-001: 性能要求

| 指标 | 要求 |
|------|------|
| 视频延迟 | < 2秒 |
| 云台响应 | < 500ms |
| 截图生成 | < 1秒 |
| 并发预览 | 单用户最多16路 |
| 系统并发 | 支持1000用户同时在线 |

### NFR-MON-002: 可靠性要求

| 指标 | 要求 |
|------|------|
| 系统可用性 | ≥ 99.9% |
| 视频流自动重连 | 断开后3秒内重连 |
| 录制中断恢复 | 支持断点续录 |
| 数据一致性 | 操作日志完整记录 |

### NFR-MON-003: 安全性要求

| 指标 | 要求 |
|------|------|
| 访问控制 | 基于5级安全体系 |
| 数据加密 | 传输层TLS加密 |
| 操作审计 | 所有操作记录日志 |
| 会话管理 | Token过期自动踢出 |

### NFR-MON-004: 易用性要求

| 指标 | 要求 |
|------|------|
| 界面响应 | < 200ms |
| 操作反馈 | 即时视觉反馈 |
| 错误提示 | 明确具体的错误信息 |
| 快捷操作 | 支持键盘快捷键 |

---

## 验收标准

### AC-MON-001: 视频预览验收

- [ ] 选择在线设备，2秒内开始播放视频
- [ ] 支持1/4/9/16画面切换
- [ ] 双击可全屏播放
- [ ] 离线设备显示离线提示
- [ ] 无权限设备显示权限不足

### AC-MON-002: 云台控制验收

- [ ] 8方向控制均响应正常
- [ ] 变焦/聚焦/光圈控制正常
- [ ] 响应时间<500ms
- [ ] 并发控制时提示设备被占用
- [ ] Level2用户无法操作云台

### AC-MON-003: 截图功能验收

- [ ] 点击截图1秒内生成图片
- [ ] 图片包含时间和设备名水印
- [ ] 支持下载到本地
- [ ] 截图记录正确保存到数据库

### AC-MON-004: 录制功能验收

- [ ] 点击录制开始计时
- [ ] 录制时长实时显示
- [ ] 停止后正确保存文件
- [ ] 录像记录正确入库
- [ ] 超过30分钟自动停止

### AC-MON-005: 轮巡功能验收

- [ ] 配置轮巡列表成功
- [ ] 按设定间隔切换画面
- [ ] 暂停/恢复功能正常
- [ ] 轮巡状态持久化
