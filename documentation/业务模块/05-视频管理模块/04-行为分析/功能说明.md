# 行为分析模块 - 功能说明

## 模块概述

行为分析模块提供基于AI的智能视频分析能力，包括人脸识别、行为检测、目标追踪等功能，采用OpenCV和TensorFlow Lite实现。

## 功能清单

### 1. 人脸识别

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 人脸检测 | 实时检测视频中人脸 | Level 3+ |
| 人脸抓拍 | 自动抓拍人脸图片 | Level 3+ |
| 人脸比对 | 1:1人脸验证 | Level 4+ |
| 人脸搜索 | 1:N人脸识别 | Level 4+ |
| 人脸库管理 | 人脸底库增删改查 | Level 5 |
| 黑白名单 | 特殊人员标记 | Level 4+ |

### 2. 行为检测

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 越界检测 | 跨越警戒线检测 | Level 3+ |
| 区域入侵 | 进入禁区检测 | Level 3+ |
| 徘徊检测 | 长时间逗留检测 | Level 3+ |
| 人群聚集 | 人员密度异常检测 | Level 4+ |
| 打架斗殴 | 暴力行为检测 | Level 4+ |
| 跌倒检测 | 人员摔倒检测 | Level 3+ |
| 遗留物检测 | 物品遗留检测 | Level 3+ |
| 物品移走 | 物品消失检测 | Level 3+ |

### 3. 目标追踪

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 人员追踪 | 跨镜头人员轨迹 | Level 4+ |
| 车辆追踪 | 车辆轨迹追踪 | Level 4+ |
| 轨迹回溯 | 历史轨迹查询 | Level 4+ |
| 轨迹预测 | 移动方向预测 | Level 5 |

### 4. 车辆分析

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 车牌识别 | 自动识别车牌号 | Level 3+ |
| 车型识别 | 识别车辆品牌型号 | Level 3+ |
| 车辆颜色 | 识别车身颜色 | Level 3+ |
| 违停检测 | 违规停车检测 | Level 3+ |
| 逆行检测 | 车辆逆向行驶检测 | Level 3+ |

### 5. 分析规则配置

| 功能点 | 说明 | 权限要求 |
|--------|------|----------|
| 规则模板 | 预置分析规则模板 | Level 4+ |
| 自定义规则 | 创建自定义规则 | Level 4+ |
| 区域绘制 | 绘制检测区域 | Level 4+ |
| 警戒线绘制 | 绘制越界警戒线 | Level 4+ |
| 时间计划 | 规则生效时间配置 | Level 4+ |
| 灵敏度调节 | 检测灵敏度配置 | Level 4+ |

## AI分析架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      AI分析引擎架构                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   视频流输入层                           │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   │   │
│  │  │ 实时流   │  │ 录像流  │  │ 图片    │  │ 批量流  │   │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                            │                                    │
│  ┌─────────────────────────┴─────────────────────────────┐     │
│  │                   预处理层 (OpenCV)                    │     │
│  │  解码 → 缩放 → 去噪 → 帧提取 → ROI裁剪               │     │
│  └─────────────────────────────────────────────────────────┘   │
│                            │                                    │
│  ┌─────────────────────────┴─────────────────────────────┐     │
│  │               AI推理层 (TensorFlow Lite)              │     │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐            │     │
│  │  │人脸检测   │  │目标检测   │  │行为识别   │            │     │
│  │  │(RetinaFace)│ │(YOLOv8)  │  │(SlowFast) │            │     │
│  │  └──────────┘  └──────────┘  └──────────┘            │     │
│  └─────────────────────────────────────────────────────────┘   │
│                            │                                    │
│  ┌─────────────────────────┴─────────────────────────────┐     │
│  │                   后处理层                             │     │
│  │  规则匹配 → 告警生成 → 结果存储 → 消息推送            │     │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 界面设计

```
┌─────────────────────────────────────────────────────────────────┐
│ 🧠 智能分析                                                      │
├─────────────────────────────────────────────────────────────────┤
│ ┌───────────────┐ ┌─────────────────────────────────────────┐   │
│ │ 分析类型      │ │ ┌─────────────────────────────────────┐ │   │
│ │ ├─人脸识别    │ │ │                                     │ │   │
│ │ │ └─人脸抓拍  │ │ │          视频预览区域               │ │   │
│ │ │ └─人脸搜索  │ │ │    (可绘制检测区域/警戒线)          │ │   │
│ │ ├─行为检测    │ │ │                                     │ │   │
│ │ │ └─越界检测  │ │ └─────────────────────────────────────┘ │   │
│ │ │ └─区域入侵  │ │ 规则配置:                               │   │
│ │ │ └─徘徊检测  │ │ ┌─────────────────────────────────────┐ │   │
│ │ ├─车辆分析    │ │ │ 规则名称: [越界检测规则1        ]  │ │   │
│ │ │ └─车牌识别  │ │ │ 检测区域: [绘制区域] [清除]        │ │   │
│ │ │ └─违停检测  │ │ │ 灵敏度:   [●●●●●○○○○○] 50%        │ │   │
│ │ └─目标追踪    │ │ │ 生效时间: [00:00] - [23:59]        │ │   │
│ └───────────────┘ │ │ [保存规则] [启用] [测试]            │ │   │
│                   │ └─────────────────────────────────────┘ │   │
│                   └─────────────────────────────────────────────┘   │
│ 分析结果:                                                        │
│ ┌───────────────────────────────────────────────────────────┐   │
│ │ 时间              │ 类型     │ 设备     │ 结果    │ 操作 │   │
│ │ 2024-01-15 10:30  │ 人脸识别 │ 大门摄像机│ 张三    │ 详情 │   │
│ │ 2024-01-15 10:28  │ 越界检测 │ 围墙摄像机│ 触发告警│ 详情 │   │
│ └───────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 性能指标

| 指标 | 要求 |
|------|------|
| 人脸检测 | < 100ms/帧 |
| 人脸识别 | < 200ms/人 |
| 行为检测 | < 500ms/帧 |
| 车牌识别 | < 150ms/帧 |
| 准确率 | ≥ 95% |
| 误报率 | < 5% |
