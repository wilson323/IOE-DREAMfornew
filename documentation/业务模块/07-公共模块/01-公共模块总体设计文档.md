# IOE-DREAM å…¬å…±æ¨¡å—æ€»ä½“è®¾è®¡æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æ›´æ–°æ—¥æœŸ**: 2025-12-16
**æœåŠ¡åç§°**: ioedream-common-service
**æœåŠ¡ç«¯å£**: 8088
**æŠ€æœ¯æ¶æ„**: Spring Boot 3.5.8 + Spring Cloud 2025.0.0

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### æ¨¡å—å®šä½
IOE-DREAMå…¬å…±æ¨¡å—æ˜¯æ•´ä¸ªæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°çš„æ ¸å¿ƒæ”¯æ’‘æ¨¡å—ï¼Œè´Ÿè´£æä¾›ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†ã€é€šçŸ¥æœåŠ¡ã€AIæ™ºèƒ½åˆ†æã€ç³»ç»Ÿç›‘æ§ã€å®¡è®¡æ—¥å¿—ã€æ•°æ®å­—å…¸ç­‰åŸºç¡€å…¬å…±æœåŠ¡ã€‚

### æ ¸å¿ƒä»·å€¼
- âœ… **ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ**: æä¾›ç»Ÿä¸€çš„ç”¨æˆ·è®¤è¯å’Œèº«ä»½ç®¡ç†æœåŠ¡
- âœ… **æƒé™ç®¡æ§ä¸­å¿ƒ**: åŸºäºRBACæ¨¡å‹çš„ç»†ç²’åº¦æƒé™æ§åˆ¶
- âœ… **é€šçŸ¥æœåŠ¡ä¸­å¿ƒ**: å¤šæ¸ é“æ™ºèƒ½é€šçŸ¥æ¨é€å’Œæ¶ˆæ¯ç®¡ç†
- âœ… **AIæ™ºèƒ½åˆ†æ**: è·¨ç³»ç»Ÿäº‹ä»¶ç®¡ç†å’Œæ™ºèƒ½å†³ç­–æ”¯æŒ
- âœ… **ç³»ç»Ÿç›‘æ§ä¸­å¿ƒ**: å®æ—¶ç›‘æ§é¢„è­¦å’Œæ€§èƒ½åˆ†æ
- âœ… **å®¡è®¡æ—¥å¿—ä¸­å¿ƒ**: å…¨ç³»ç»Ÿæ“ä½œå®¡è®¡å’Œå®‰å…¨ç›‘æ§

### æœåŠ¡èŒƒå›´
- **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·ä¿¡æ¯ã€è®¤è¯æˆæƒã€ä¼šè¯ç®¡ç†
- **æƒé™ç®¡ç†**: è§’è‰²æƒé™ã€èµ„æºæƒé™ã€æ•°æ®æƒé™
- **é€šçŸ¥æœåŠ¡**: å¤šæ¸ é“é€šçŸ¥ã€æ¶ˆæ¯æ¨¡æ¿ã€æ¨é€ç®¡ç†
- **AIåˆ†æ**: äº‹ä»¶ç®¡ç†ã€å¼‚å¸¸æ£€æµ‹ã€æ™ºèƒ½é¢„è­¦
- **ç³»ç»Ÿé…ç½®**: å‚æ•°é…ç½®ã€æ•°æ®å­—å…¸ã€ç³»ç»Ÿè®¾ç½®
- **å®¡è®¡ç›‘æ§**: æ“ä½œå®¡è®¡ã€ç³»ç»Ÿç›‘æ§ã€æ€§èƒ½ç»Ÿè®¡

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å¾®æœåŠ¡æ¶æ„

```mermaid
flowchart TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        A[Webç®¡ç†ç«¯]
        B[ç§»åŠ¨ç«¯App]
        C[ç¬¬ä¸‰æ–¹ç³»ç»Ÿ]
        D[å…¶ä»–å¾®æœåŠ¡]
    end

    subgraph "APIç½‘å…³å±‚"
        E[API Gateway<br/>ioedream-gateway-service<br/>:8080]
    end

    subgraph "å…¬å…±æ¨¡å—å¾®æœåŠ¡å±‚"
        F[ioedream-common-service<br/>:8088<br/>å…¬å…±ä¸šåŠ¡æœåŠ¡]
    end

    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        G[ioedream-access-service<br/>:8090<br/>é—¨ç¦æœåŠ¡]
        H[ioedream-attendance-service<br/>:8091<br/>è€ƒå‹¤æœåŠ¡]
        I[ioedream-consume-service<br/>:8094<br/>æ¶ˆè´¹æœåŠ¡]
        J[ioedream-visitor-service<br/>:8095<br/>è®¿å®¢æœåŠ¡]
        K[ioedream-video-service<br/>:8092<br/>è§†é¢‘æœåŠ¡]
        L[ioedream-device-comm-service<br/>:8087<br/>è®¾å¤‡é€šè®¯]
    end

    subgraph "æ•°æ®å­˜å‚¨å±‚"
        M[(MySQL 8.0<br/>ä¸»æ•°æ®åº“)]
        N[(Redis 6.4<br/>ç¼“å­˜æ•°æ®åº“)]
        O[(Elasticsearch<br/>æœç´¢å¼•æ“)]
    end

    subgraph "æ¶ˆæ¯é˜Ÿåˆ—å±‚"
        P[RabbitMQ<br/>æ¶ˆæ¯é˜Ÿåˆ—]
        Q[Kafka<br/>æµå¤„ç†]
    end

    A --> E
    B --> E
    C --> E
    D --> E

    E --> F
    F --> G
    F --> H
    F --> I
    F --> J
    F --> K
    F --> L

    F --> M
    F --> N
    F --> O
    F --> P
    F --> Q
```

### æ ¸å¿ƒåŠŸèƒ½æ¶æ„

```mermaid
flowchart TD
    A[å…¬å…±æ¨¡å—å…¥å£] --> B[ç”¨æˆ·è®¤è¯ä¸­å¿ƒ]
    A --> C[æƒé™ç®¡ç†ä¸­å¿ƒ]
    A --> D[é€šçŸ¥æœåŠ¡ä¸­å¿ƒ]
    A --> E[AIæ™ºèƒ½åˆ†æä¸­å¿ƒ]
    A --> F[ç³»ç»Ÿç›‘æ§ä¸­å¿ƒ]
    A --> G[å®¡è®¡æ—¥å¿—ä¸­å¿ƒ]

    subgraph "ç”¨æˆ·è®¤è¯ä¸­å¿ƒ"
        B1[ç”¨æˆ·ç®¡ç†]
        B2[èº«ä»½è®¤è¯]
        B3[ä¼šè¯ç®¡ç†]
        B4[å¯†ç ç­–ç•¥]
        B5[å¤šå› å­è®¤è¯]
    end

    subgraph "æƒé™ç®¡ç†ä¸­å¿ƒ"
        C1[è§’è‰²ç®¡ç†]
        C2[æƒé™ç®¡ç†]
        C3[èµ„æºç®¡ç†]
        C4[æ•°æ®æƒé™]
        C5[æƒé™ç»§æ‰¿]
    end

    subgraph "é€šçŸ¥æœåŠ¡ä¸­å¿ƒ"
        D1[æ¶ˆæ¯æ¨¡æ¿]
        D2[å¤šæ¸ é“æ¨é€]
        D3[é€šçŸ¥é…ç½®]
        D4[æ¨é€ç»Ÿè®¡]
        D5[é™æµé‡è¯•]
    end

    subgraph "AIæ™ºèƒ½åˆ†æä¸­å¿ƒ"
        E1[äº‹ä»¶é‡‡é›†]
        E2[å¼‚å¸¸æ£€æµ‹]
        E3[æ™ºèƒ½åˆ†ç±»]
        E4[é£é™©è¯„ä¼°]
        E5[å†³ç­–æ”¯æŒ]
    end

    subgraph "ç³»ç»Ÿç›‘æ§ä¸­å¿ƒ"
        F1[æ€§èƒ½ç›‘æ§]
        F2[ä¸šåŠ¡ç›‘æ§]
        F3[å®‰å…¨ç›‘æ§]
        F4[å‘Šè­¦ç®¡ç†]
        F5[å¯è§†åŒ–å±•ç¤º]
    end

    subgraph "å®¡è®¡æ—¥å¿—ä¸­å¿ƒ"
        G1[æ“ä½œå®¡è®¡]
        G2[å®‰å…¨å®¡è®¡]
        G3[æ•°æ®å®¡è®¡]
        G4[åˆè§„æŠ¥å‘Š]
        G5[æ—¥å¿—åˆ†æ]
    end

    B --> B1
    B --> B2
    B --> B3
    B --> B4
    B --> B5

    C --> C1
    C --> C2
    C --> C3
    C --> C4
    C --> C5

    D --> D1
    D --> D2
    D --> D3
    D --> D4
    D --> D5

    E --> E1
    E --> E2
    E --> E3
    E --> E4
    E --> E5

    F --> F1
    F --> F2
    F --> F3
    F --> F4
    F --> F5

    G --> G1
    G --> G2
    G --> G3
    G --> G4
    G --> G5
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡

#### ç”¨æˆ·è®¤è¯ç›¸å…³è¡¨

```sql
-- ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨
CREATE TABLE `t_user` (
    `user_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
    `password` VARCHAR(255) NOT NULL COMMENT 'å¯†ç ï¼ˆåŠ å¯†ï¼‰',
    `real_name` VARCHAR(100) NOT NULL COMMENT 'çœŸå®å§“å',
    `phone` VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    `email` VARCHAR(100) COMMENT 'é‚®ç®±',
    `avatar_url` VARCHAR(500) COMMENT 'å¤´åƒURL',
    `user_type` TINYINT DEFAULT 1 COMMENT 'ç”¨æˆ·ç±»å‹ï¼š1-æ™®é€šç”¨æˆ· 2-ç®¡ç†å‘˜ 3-è¶…çº§ç®¡ç†å‘˜',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-å¯ç”¨ 0-ç¦ç”¨',
    `login_count` INT DEFAULT 0 COMMENT 'ç™»å½•æ¬¡æ•°',
    `last_login_time` DATETIME COMMENT 'æœ€åç™»å½•æ—¶é—´',
    `last_login_ip` VARCHAR(45) COMMENT 'æœ€åç™»å½•IP',
    `password_update_time` DATETIME COMMENT 'å¯†ç æ›´æ–°æ—¶é—´',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°ï¼š0-æœªåˆ é™¤ 1-å·²åˆ é™¤',
    PRIMARY KEY (`user_id`),
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_phone` (`phone`),
    UNIQUE KEY `uk_email` (`email`),
    KEY `idx_status_type` (`status`, `user_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨';

-- ç”¨æˆ·ä¼šè¯è¡¨
CREATE TABLE `t_user_session` (
    `session_id` VARCHAR(128) NOT NULL COMMENT 'ä¼šè¯ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `access_token` VARCHAR(255) NOT NULL COMMENT 'è®¿é—®ä»¤ç‰Œ',
    `refresh_token` VARCHAR(255) COMMENT 'åˆ·æ–°ä»¤ç‰Œ',
    `client_type` VARCHAR(20) COMMENT 'å®¢æˆ·ç«¯ç±»å‹',
    `client_ip` VARCHAR(45) COMMENT 'å®¢æˆ·ç«¯IP',
    `user_agent` VARCHAR(500) COMMENT 'ç”¨æˆ·ä»£ç†',
    `login_time` DATETIME NOT NULL COMMENT 'ç™»å½•æ—¶é—´',
    `expire_time` DATETIME NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
    `last_access_time` DATETIME COMMENT 'æœ€åè®¿é—®æ—¶é—´',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-æœ‰æ•ˆ 0-æ— æ•ˆ',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`session_id`),
    UNIQUE KEY `uk_access_token` (`access_token`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_expire_time` (`expire_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ä¼šè¯è¡¨';
```

#### æƒé™ç®¡ç†ç›¸å…³è¡¨

```sql
-- è§’è‰²è¡¨
CREATE TABLE `t_role` (
    `role_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è§’è‰²ID',
    `role_code` VARCHAR(50) NOT NULL COMMENT 'è§’è‰²ç¼–ç ',
    `role_name` VARCHAR(100) NOT NULL COMMENT 'è§’è‰²åç§°',
    `role_type` TINYINT DEFAULT 1 COMMENT 'è§’è‰²ç±»å‹ï¼š1-ç³»ç»Ÿè§’è‰² 2-ä¸šåŠ¡è§’è‰²',
    `parent_role_id` BIGINT COMMENT 'çˆ¶è§’è‰²ID',
    `sort_order` INT DEFAULT 0 COMMENT 'æ’åº',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-å¯ç”¨ 0-ç¦ç”¨',
    `description` VARCHAR(500) COMMENT 'è§’è‰²æè¿°',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`role_id`),
    UNIQUE KEY `uk_role_code` (`role_code`),
    KEY `idx_parent_id` (`parent_role_id`),
    KEY `idx_status_type` (`status`, `role_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';

-- æƒé™è¡¨
CREATE TABLE `t_permission` (
    `permission_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'æƒé™ID',
    `permission_code` VARCHAR(50) NOT NULL COMMENT 'æƒé™ç¼–ç ',
    `permission_name` VARCHAR(100) NOT NULL COMMENT 'æƒé™åç§°',
    `permission_type` TINYINT COMMENT 'æƒé™ç±»å‹ï¼š1-èœå• 2-æŒ‰é’® 3-æ¥å£ 4-æ•°æ®',
    `parent_permission_id` BIGINT COMMENT 'çˆ¶æƒé™ID',
    `resource_path` VARCHAR(200) COMMENT 'èµ„æºè·¯å¾„',
    `request_method` VARCHAR(10) COMMENT 'è¯·æ±‚æ–¹æ³•',
    `sort_order` INT DEFAULT 0 COMMENT 'æ’åº',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-å¯ç”¨ 0-ç¦ç”¨',
    `description` VARCHAR(500) COMMENT 'æƒé™æè¿°',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`permission_id`),
    UNIQUE KEY `uk_permission_code` (`permission_code`),
    KEY `idx_parent_id` (`parent_permission_id`),
    KEY `idx_type_status` (`permission_type`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™è¡¨';

-- ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE `t_user_role` (
    `user_role_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·è§’è‰²ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `role_id` BIGINT NOT NULL COMMENT 'è§’è‰²ID',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`user_role_id`),
    UNIQUE KEY `uk_user_role` (`user_id`, `role_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_role_id` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

#### é€šçŸ¥ç³»ç»Ÿç›¸å…³è¡¨

```sql
-- é€šçŸ¥æ¶ˆæ¯è¡¨
CREATE TABLE `t_notification` (
    `notification_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'é€šçŸ¥ID',
    `sender_id` BIGINT COMMENT 'å‘é€è€…ID',
    `receiver_type` VARCHAR(20) NOT NULL COMMENT 'æ¥æ”¶è€…ç±»å‹ï¼šUSER-ç”¨æˆ· ROLE-è§’è‰² DEPT-éƒ¨é—¨ ALL-å…¨éƒ¨',
    `receiver_ids` TEXT COMMENT 'æ¥æ”¶è€…IDåˆ—è¡¨',
    `notification_type` VARCHAR(20) NOT NULL COMMENT 'é€šçŸ¥ç±»å‹ï¼šSYSTEM-ç³»ç»Ÿ BUSINESS-ä¸šåŠ¡ SECURITY-å®‰å…¨',
    `title` VARCHAR(200) NOT NULL COMMENT 'é€šçŸ¥æ ‡é¢˜',
    `content` TEXT NOT NULL COMMENT 'é€šçŸ¥å†…å®¹',
    `template_code` VARCHAR(50) COMMENT 'æ¨¡æ¿ç¼–ç ',
    `template_data` TEXT COMMENT 'æ¨¡æ¿æ•°æ®',
    `channels` VARCHAR(100) COMMENT 'æ¨é€æ¸ é“ï¼šEMAIL-é‚®ä»¶ SMS-çŸ­ä¿¡ WECHAT-å¾®ä¿¡ APP-åº”ç”¨',
    `priority` VARCHAR(10) DEFAULT 'MEDIUM' COMMENT 'ä¼˜å…ˆçº§ï¼šHIGH-é«˜ MEDIUM-ä¸­ LOW-ä½',
    `status` VARCHAR(20) DEFAULT 'PENDING' COMMENT 'çŠ¶æ€ï¼šPENDING-å¾…å‘é€ SENT-å·²å‘é€ FAILED-å¤±è´¥',
    `send_status` VARCHAR(20) COMMENT 'å‘é€çŠ¶æ€',
    `schedule_time` DATETIME COMMENT 'è®¡åˆ’å‘é€æ—¶é—´',
    `sent_time` DATETIME COMMENT 'å‘é€æ—¶é—´',
    `read_time` DATETIME COMMENT 'é˜…è¯»æ—¶é—´',
    `expire_time` DATETIME COMMENT 'è¿‡æœŸæ—¶é—´',
    `attachments` TEXT COMMENT 'é™„ä»¶ä¿¡æ¯JSON',
    `buttons` TEXT COMMENT 'æŒ‰é’®ä¿¡æ¯JSON',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`notification_id`),
    KEY `idx_sender_id` (`sender_id`),
    KEY `idx_type_status` (`notification_type`, `status`),
    KEY `idx_priority_time` (`priority`, `create_time`),
    KEY `idx_schedule_time` (`schedule_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥æ¶ˆæ¯è¡¨';

-- é€šçŸ¥æ¨¡æ¿è¡¨
CREATE TABLE `t_notification_template` (
    `template_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'æ¨¡æ¿ID',
    `template_code` VARCHAR(50) NOT NULL COMMENT 'æ¨¡æ¿ç¼–ç ',
    `template_name` VARCHAR(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
    `template_type` VARCHAR(20) NOT NULL COMMENT 'æ¨¡æ¿ç±»å‹ï¼šEMAIL-é‚®ä»¶ SMS-çŸ­ä¿¡ WECHAT-å¾®ä¿¡',
    `category` VARCHAR(20) COMMENT 'åˆ†ç±»ï¼šSYSTEM-ç³»ç»Ÿ BUSINESS-ä¸šåŠ¡ SECURITY-å®‰å…¨',
    `subject` VARCHAR(200) COMMENT 'ä¸»é¢˜',
    `content` TEXT NOT NULL COMMENT 'å†…å®¹æ¨¡æ¿',
    `variables` TEXT COMMENT 'å˜é‡å®šä¹‰JSON',
    `attachment_enabled` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ”¯æŒé™„ä»¶',
    `button_enabled` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ”¯æŒæŒ‰é’®',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-å¯ç”¨ 0-ç¦ç”¨',
    `description` VARCHAR(500) COMMENT 'æ¨¡æ¿æè¿°',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`template_id`),
    UNIQUE KEY `uk_template_code` (`template_code`),
    KEY `idx_type_status` (`template_type`, `status`),
    KEY `idx_category` (`category`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥æ¨¡æ¿è¡¨';
```

#### AIæ™ºèƒ½åˆ†æç›¸å…³è¡¨

```sql
-- AIäº‹ä»¶è¡¨
CREATE TABLE `t_ai_event` (
    `event_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'äº‹ä»¶ID',
    `event_code` VARCHAR(50) NOT NULL COMMENT 'äº‹ä»¶ç¼–ç ',
    `source_module` VARCHAR(50) NOT NULL COMMENT 'æ¥æºæ¨¡å—',
    `event_type` VARCHAR(50) NOT NULL COMMENT 'äº‹ä»¶ç±»å‹',
    `event_subtype` VARCHAR(50) COMMENT 'äº‹ä»¶å­ç±»å‹',
    `event_title` VARCHAR(200) NOT NULL COMMENT 'äº‹ä»¶æ ‡é¢˜',
    `event_content` TEXT COMMENT 'äº‹ä»¶å†…å®¹',
    `event_data` TEXT COMMENT 'äº‹ä»¶æ•°æ®JSON',
    `confidence_score` DECIMAL(5,4) COMMENT 'ç½®ä¿¡åº¦',
    `risk_level` VARCHAR(20) COMMENT 'é£é™©ç­‰çº§ï¼šLOW-ä½ MEDIUM-ä¸­ HIGH-é«˜ CRITICAL-æé«˜',
    `urgency_level` VARCHAR(20) COMMENT 'ç´§æ€¥ç¨‹åº¦ï¼šNORMAL-ä¸€èˆ¬ URGENT-ç´§æ€¥ CRITICAL-æç´§æ€¥',
    `impact_scope` VARCHAR(20) COMMENT 'å½±å“èŒƒå›´ï¼šLOCAL-å±€éƒ¨ AREA-åŒºåŸŸ GLOBAL-å…¨å±€',
    `status` VARCHAR(20) DEFAULT 'PENDING' COMMENT 'çŠ¶æ€ï¼šPENDING-å¾…å¤„ç† PROCESSING-å¤„ç†ä¸­ RESOLVED-å·²è§£å†³',
    `processed_time` DATETIME COMMENT 'å¤„ç†æ—¶é—´',
    `processor_id` BIGINT COMMENT 'å¤„ç†äººID',
    `processing_result` TEXT COMMENT 'å¤„ç†ç»“æœ',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`event_id`),
    UNIQUE KEY `uk_event_code` (`event_code`),
    KEY `idx_source_type` (`source_module`, `event_type`),
    KEY `idx_risk_urgency` (`risk_level`, `urgency_level`),
    KEY `idx_status_time` (`status`, `create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='AIäº‹ä»¶è¡¨';

-- AIäº‹ä»¶å¤„ç†è®°å½•è¡¨
CREATE TABLE `t_ai_event_record` (
    `record_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è®°å½•ID',
    `event_id` BIGINT NOT NULL COMMENT 'äº‹ä»¶ID',
    `action_type` VARCHAR(50) NOT NULL COMMENT 'å¤„ç†åŠ¨ä½œç±»å‹',
    `action_content` TEXT COMMENT 'å¤„ç†å†…å®¹',
    `action_result` VARCHAR(20) COMMENT 'å¤„ç†ç»“æœï¼šSUCCESS-æˆåŠŸ FAILED-å¤±è´¥',
    `action_details` TEXT COMMENT 'å¤„ç†è¯¦æƒ…',
    `processor_id` BIGINT COMMENT 'å¤„ç†äººID',
    `processor_name` VARCHAR(100) COMMENT 'å¤„ç†äººå§“å',
    `processing_duration` BIGINT COMMENT 'å¤„ç†æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`record_id`),
    KEY `idx_event_id` (`event_id`),
    KEY `idx_action_type` (`action_type`),
    KEY `idx_processor_id` (`processor_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='AIäº‹ä»¶å¤„ç†è®°å½•è¡¨';
```

#### å®¡è®¡æ—¥å¿—ç›¸å…³è¡¨

```sql
-- æ“ä½œå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE `t_audit_log` (
    `log_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    `user_id` BIGINT COMMENT 'ç”¨æˆ·ID',
    `username` VARCHAR(50) COMMENT 'ç”¨æˆ·å',
    `operation_type` VARCHAR(50) NOT NULL COMMENT 'æ“ä½œç±»å‹',
    `operation_desc` VARCHAR(500) COMMENT 'æ“ä½œæè¿°',
    `request_method` VARCHAR(10) COMMENT 'è¯·æ±‚æ–¹æ³•',
    `request_url` VARCHAR(500) COMMENT 'è¯·æ±‚URL',
    `request_params` TEXT COMMENT 'è¯·æ±‚å‚æ•°',
    `response_result` TEXT COMMENT 'å“åº”ç»“æœ',
    `operation_ip` VARCHAR(45) COMMENT 'æ“ä½œIP',
    `user_agent` VARCHAR(500) COMMENT 'ç”¨æˆ·ä»£ç†',
    `operation_status` TINYINT COMMENT 'æ“ä½œçŠ¶æ€ï¼š1-æˆåŠŸ 0-å¤±è´¥',
    `error_message` TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',
    `execution_time` BIGINT COMMENT 'æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`log_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_operation_type` (`operation_type`),
    KEY `idx_status_time` (`operation_status`, `create_time`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ“ä½œå®¡è®¡æ—¥å¿—è¡¨';
```

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### ç”¨æˆ·è®¤è¯API

```java
@RestController
@RequestMapping("/api/v1/auth")
@Tag(name = "ç”¨æˆ·è®¤è¯")
public class AuthController {

    @PostMapping("/login")
    @Operation(summary = "ç”¨æˆ·ç™»å½•")
    public ResponseDTO<LoginResponseVO> login(@Valid @RequestBody LoginRequestDTO request);

    @PostMapping("/logout")
    @Operation(summary = "ç”¨æˆ·ç™»å‡º")
    public ResponseDTO<Void> logout(@RequestHeader("Authorization") String token);

    @PostMapping("/refresh")
    @Operation(summary = "åˆ·æ–°ä»¤ç‰Œ")
    public ResponseDTO<RefreshTokenResultDTO> refreshToken(@Valid @RequestBody RefreshTokenRequestDTO request);

    @GetMapping("/userinfo")
    @Operation(summary = "è·å–ç”¨æˆ·ä¿¡æ¯")
    public ResponseDTO<UserInfoVO> getUserInfo(@RequestHeader("Authorization") String token);

    @PostMapping("/changepassword")
    @Operation(summary = "ä¿®æ”¹å¯†ç ")
    public ResponseDTO<Void> changePassword(@Valid @RequestBody ChangePasswordRequestDTO request);
}
```

### æƒé™ç®¡ç†API

```java
@RestController
@RequestMapping("/api/v1/permission")
@Tag(name = "æƒé™ç®¡ç†")
public class PermissionController {

    @GetMapping("/roles")
    @Operation(summary = "è·å–è§’è‰²åˆ—è¡¨")
    public ResponseDTO<PageResult<RoleVO>> getRoleList(@Valid RoleQueryForm queryForm);

    @PostMapping("/roles")
    @Operation(summary = "åˆ›å»ºè§’è‰²")
    public ResponseDTO<Long> createRole(@Valid @RequestBody RoleAddForm addForm);

    @PutMapping("/roles/{roleId}")
    @Operation(summary = "æ›´æ–°è§’è‰²")
    public ResponseDTO<Void> updateRole(@PathVariable Long roleId, @Valid @RequestBody RoleUpdateForm updateForm);

    @DeleteMapping("/roles/{roleId}")
    @Operation(summary = "åˆ é™¤è§’è‰²")
    public ResponseDTO<Void> deleteRole(@PathVariable Long roleId);

    @GetMapping("/permissions")
    @Operation(summary = "è·å–æƒé™åˆ—è¡¨")
    public ResponseDTO<List<PermissionVO>> getPermissionList(@RequestParam(required = false) String permissionType);

    @GetMapping("/user/{userId}/permissions")
    @Operation(summary = "è·å–ç”¨æˆ·æƒé™")
    public ResponseDTO<List<PermissionVO>> getUserPermissions(@PathVariable Long userId);
}
```

### é€šçŸ¥ç³»ç»ŸAPI

```java
@RestController
@RequestMapping("/api/v1/notification")
@Tag(name = "é€šçŸ¥ç®¡ç†")
public class NotificationController {

    @PostMapping("/send")
    @Operation(summary = "å‘é€é€šçŸ¥")
    public ResponseDTO<NotificationResultVO> sendNotification(@Valid @RequestBody NotificationSendDTO sendDTO);

    @PostMapping("/batch")
    @Operation(summary = "æ‰¹é‡å‘é€é€šçŸ¥")
    public ResponseDTO<List<NotificationResultVO>> batchSendNotification(@Valid @RequestBody NotificationBatchDTO batchDTO);

    @GetMapping("/user/list")
    @Operation(summary = "è·å–ç”¨æˆ·é€šçŸ¥åˆ—è¡¨")
    public ResponseDTO<PageResult<UserNotificationVO>> getUserNotificationList(@Valid UserNotificationQueryForm queryForm);

    @PutMapping("/{notificationId}/read")
    @Operation(summary = "æ ‡è®°é€šçŸ¥å·²è¯»")
    public ResponseDTO<Void> markNotificationRead(@PathVariable Long notificationId);

    @GetMapping("/template/list")
    @Operation(summary = "è·å–é€šçŸ¥æ¨¡æ¿åˆ—è¡¨")
    public ResponseDTO<PageResult<NotificationTemplateVO>> getTemplateList(@Valid TemplateQueryForm queryForm);

    @PostMapping("/template")
    @Operation(summary = "åˆ›å»ºé€šçŸ¥æ¨¡æ¿")
    public ResponseDTO<Long> createTemplate(@Valid @RequestBody NotificationTemplateAddForm addForm);

    @GetMapping("/statistics")
    @Operation(summary = "è·å–é€šçŸ¥ç»Ÿè®¡")
    public ResponseDTO<NotificationStatisticsVO> getNotificationStatistics(@Valid NotificationStatisticsQueryForm queryForm);
}
```

### AIæ™ºèƒ½åˆ†æAPI

```java
@RestController
@RequestMapping("/api/v1/ai")
@Tag(name = "AIæ™ºèƒ½åˆ†æ")
public class AIAnalysisController {

    @GetMapping("/events")
    @Operation(summary = "è·å–AIäº‹ä»¶åˆ—è¡¨")
    public ResponseDTO<PageResult<AIEventVO>> getEventList(@Valid AIEventQueryForm queryForm);

    @PostMapping("/events/{eventId}/process")
    @Operation(summary = "å¤„ç†AIäº‹ä»¶")
    public ResponseDTO<Void> processEvent(@PathVariable Long eventId, @Valid @RequestBody EventProcessDTO processDTO);

    @GetMapping("/events/{eventId}/records")
    @Operation(summary = "è·å–äº‹ä»¶å¤„ç†è®°å½•")
    public ResponseDTO<List<EventRecordVO>> getEventRecords(@PathVariable Long eventId);

    @GetMapping("/analysis/statistics")
    @Operation(summary = "è·å–åˆ†æç»Ÿè®¡")
    public ResponseDTO<AIAnalysisStatisticsVO> getAnalysisStatistics(@Valid AnalysisStatisticsQueryForm queryForm);

    @GetMapping("/risk/assessment")
    @Operation(summary = "é£é™©è¯„ä¼°")
    public ResponseDTO<RiskAssessmentVO> riskAssessment(@Valid RiskAssessmentDTO assessmentDTO);
}
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### è®¤è¯æˆæƒå®ç°

#### JWT Tokenç®¡ç†

```java
@Component
@Slf4j
public class JwtTokenManager {

    @Value("${jwt.secret}")
    private String jwtSecret;

    @Value("${jwt.expiration}")
    private Long jwtExpiration;

    @Value("${jwt.refresh-expiration}")
    private Long refreshExpiration;

    @Resource
    private UserSessionDao userSessionDao;

    /**
     * ç”Ÿæˆè®¿é—®ä»¤ç‰Œ
     */
    public String generateAccessToken(UserEntity user) {
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + jwtExpiration * 1000);

        return Jwts.builder()
                .setSubject(user.getUserId().toString())
                .setIssuedAt(now)
                .setExpiration(expiryDate)
                .claim("username", user.getUsername())
                .claim("userType", user.getUserType())
                .signWith(SignatureAlgorithm.HS512, jwtSecret)
                .compact();
    }

    /**
     * ç”Ÿæˆåˆ·æ–°ä»¤ç‰Œ
     */
    public String generateRefreshToken(UserEntity user) {
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + refreshExpiration * 1000);

        return Jwts.builder()
                .setSubject(user.getUserId().toString())
                .setIssuedAt(now)
                .setExpiration(expiryDate)
                .claim("type", "refresh")
                .signWith(SignatureAlgorithm.HS512, jwtSecret)
                .compact();
    }

    /**
     * éªŒè¯ä»¤ç‰Œ
     */
    public boolean validateToken(String token) {
        try {
            Jwts.parser().setSigningKey(jwtSecret).parseClaimsJws(token);
            return true;
        } catch (JwtException | IllegalArgumentException e) {
            log.error("Invalid JWT token: {}", e.getMessage());
            return false;
        }
    }
}
```

#### æƒé™æ‹¦æˆªå™¨

```java
@Component
@Slf4j
public class PermissionInterceptor implements HandlerInterceptor {

    @Resource
    private PermissionService permissionService;

    @Resource
    private JwtTokenManager jwtTokenManager;

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        if (!(handler instanceof HandlerMethod)) {
            return true;
        }

        HandlerMethod handlerMethod = (HandlerMethod) handler;
        RequiresPermissions annotation = handlerMethod.getMethodAnnotation(RequiresPermissions.class);

        if (annotation == null) {
            return true;
        }

        String token = request.getHeader("Authorization");
        if (StringUtils.isEmpty(token) || !token.startsWith("Bearer ")) {
            throw new AuthenticationException("è®¤è¯ä»¤ç‰Œæ— æ•ˆ");
        }

        token = token.substring(7);
        if (!jwtTokenManager.validateToken(token)) {
            throw new AuthenticationException("è®¤è¯ä»¤ç‰Œå·²è¿‡æœŸ");
        }

        Long userId = jwtTokenManager.getUserIdFromToken(token);
        String[] permissions = annotation.value();

        for (String permission : permissions) {
            if (!permissionService.hasPermission(userId, permission)) {
                throw new AuthorizationException("æƒé™ä¸è¶³ï¼š" + permission);
            }
        }

        return true;
    }
}
```

### é€šçŸ¥æœåŠ¡å®ç°

#### å¤šæ¸ é“é€šçŸ¥å‘é€å™¨

```java
@Service
@Slf4j
public class NotificationSender {

    @Resource
    private EmailNotificationSender emailSender;

    @Resource
    private SmsNotificationSender smsSender;

    @Resource
    private WechatNotificationSender wechatSender;

    @Resource
    private AppPushNotificationSender appPushSender;

    /**
     * å‘é€é€šçŸ¥
     */
    public NotificationResult sendNotification(NotificationEntity notification) {
        List<NotificationChannelResult> channelResults = new ArrayList<>();

        for (String channel : notification.getChannels().split(",")) {
            try {
                NotificationChannelResult result = sendByChannel(notification, channel);
                channelResults.add(result);

                if (result.isSuccess()) {
                    log.info("é€šçŸ¥å‘é€æˆåŠŸ: channel={}, messageId={}", channel, result.getMessageId());
                } else {
                    log.error("é€šçŸ¥å‘é€å¤±è´¥: channel={}, error={}", channel, result.getErrorMessage());
                }
            } catch (Exception e) {
                log.error("é€šçŸ¥å‘é€å¼‚å¸¸: channel=" + channel, e);
                channelResults.add(NotificationChannelResult.failure(channel, e.getMessage()));
            }
        }

        return NotificationResult.builder()
                .notificationId(notification.getNotificationId())
                .channelResults(channelResults)
                .overallSuccess(channelResults.stream().anyMatch(NotificationChannelResult::isSuccess))
                .build();
    }

    private NotificationChannelResult sendByChannel(NotificationEntity notification, String channel) {
        switch (channel) {
            case "EMAIL":
                return emailSender.send(notification);
            case "SMS":
                return smsSender.send(notification);
            case "WECHAT":
                return wechatSender.send(notification);
            case "APP":
                return appPushSender.send(notification);
            default:
                throw new IllegalArgumentException("ä¸æ”¯æŒçš„é€šçŸ¥æ¸ é“: " + channel);
        }
    }
}
```

#### æ™ºèƒ½é™æµå™¨

```java
@Component
@Slf4j
public class NotificationRateLimiter {

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    /**
     * æ»‘åŠ¨çª—å£é™æµ
     */
    public boolean tryAcquire(String key, int limit, int windowSizeInSeconds) {
        String redisKey = "rate_limit:notification:" + key;
        long currentTime = System.currentTimeMillis();
        long windowStart = currentTime - windowSizeInSeconds * 1000L;

        // ä½¿ç”¨RedisåŸå­æ“ä½œ
        String script =
            "local current = redis.call('ZRANGEBYSCORE', KEYS[1], ARGV[1], ARGV[2]) " +
            "redis.call('ZREMRANGEBYSCORE', KEYS[1], '-inf', ARGV[1]) " +
            "redis.call('ZADD', KEYS[1], ARGV[3], ARGV[4]) " +
            "redis.call('EXPIRE', KEYS[1], ARGV[2]) " +
            "return #current";

        List<Object> result = redisTemplate.execute(
            new DefaultRedisScript<>(script, List.class),
            Collections.singletonList(redisKey),
            String.valueOf(windowStart),
            String.valueOf(windowSizeInSeconds),
            String.valueOf(currentTime),
            currentTime + ":" + ThreadLocalRandom.current().nextInt(1000)
        );

        return ((List<Long>) result.get(0)).size() < limit;
    }
}
```

### AIæ™ºèƒ½åˆ†æå®ç°

#### äº‹ä»¶åˆ†ç±»å™¨

```java
@Service
@Slf4j
public class AIEventClassifier {

    @Resource
    private MachineLearningClassifier mlClassifier;

    @Resource
    private RuleEngineClassifier ruleEngineClassifier;

    @Resource
    private PatternMatcherClassifier patternClassifier;

    /**
     * æ™ºèƒ½äº‹ä»¶åˆ†ç±»
     */
    public EventClassificationResult classifyEvent(AIEventEntity event) {
        // å¹¶è¡Œæ‰§è¡Œå¤šç§åˆ†ç±»ç®—æ³•
        CompletableFuture<MLClassificationResult> mlFuture =
            CompletableFuture.supplyAsync(() -> mlClassifier.classify(event));

        CompletableFuture<RuleClassificationResult> ruleFuture =
            CompletableFuture.supplyAsync(() -> ruleEngineClassifier.classify(event));

        CompletableFuture<PatternClassificationResult> patternFuture =
            CompletableFuture.supplyAsync(() -> patternClassifier.classify(event));

        try {
            // ç­‰å¾…æ‰€æœ‰åˆ†ç±»ç»“æœ
            MLClassificationResult mlResult = mlFuture.get(2, TimeUnit.SECONDS);
            RuleClassificationResult ruleResult = ruleFuture.get(2, TimeUnit.SECONDS);
            PatternClassificationResult patternResult = patternFuture.get(2, TimeUnit.SECONDS);

            // èåˆåˆ†ç±»ç»“æœ
            return fuseClassificationResults(event, mlResult, ruleResult, patternResult);

        } catch (Exception e) {
            log.error("äº‹ä»¶åˆ†ç±»å¤±è´¥: eventId=" + event.getEventId(), e);
            return EventClassificationResult.failure("åˆ†ç±»å¤±è´¥: " + e.getMessage());
        }
    }

    /**
     * èåˆåˆ†ç±»ç»“æœ
     */
    private EventClassificationResult fuseClassificationResults(
            AIEventEntity event,
            MLClassificationResult mlResult,
            RuleClassificationResult ruleResult,
            PatternClassificationResult patternResult) {

        // åŠ æƒèåˆç®—æ³•
        Map<String, Double> weights = Map.of(
            "ML", 0.4,
            "RULE", 0.4,
            "PATTERN", 0.2
        );

        String eventType = determineEventType(mlResult, ruleResult, patternResult, weights);
        double confidence = calculateConfidence(mlResult, ruleResult, patternResult, weights);

        return EventClassificationResult.builder()
                .eventType(eventType)
                .confidence(confidence)
                .mlResult(mlResult)
                .ruleResult(ruleResult)
                .patternResult(patternResult)
                .build();
    }
}
```

#### é£é™©è¯„ä¼°å™¨

```java
@Service
@Slf4j
public class AIRiskAssessor {

    @Resource
    private RiskModelRepository riskModelRepository;

    /**
     * äº‹ä»¶é£é™©è¯„ä¼°
     */
    public RiskAssessmentResult assessRisk(AIEventEntity event) {
        // å¤šç»´åº¦é£é™©è¯„ä¼°
        double severityScore = assessSeverity(event);
        double urgencyScore = assessUrgency(event);
        double impactScore = assessImpact(event);
        double likelihoodScore = assessLikelihood(event);

        // ç»¼åˆé£é™©è¯„åˆ†
        double riskScore = calculateRiskScore(severityScore, urgencyScore, impactScore, likelihoodScore);

        // ç¡®å®šé£é™©ç­‰çº§
        RiskLevel riskLevel = determineRiskLevel(riskScore);

        // ç¡®å®šç´§æ€¥ç¨‹åº¦
        UrgencyLevel urgencyLevel = determineUrgencyLevel(urgencyScore, riskScore);

        // ç¡®å®šå½±å“èŒƒå›´
        ImpactScope impactScope = determineImpactScope(event, impactScore);

        return RiskAssessmentResult.builder()
                .riskScore(riskScore)
                .riskLevel(riskLevel)
                .urgencyLevel(urgencyLevel)
                .impactScope(impactScope)
                .severityScore(severityScore)
                .urgencyScore(urgencyScore)
                .impactScore(impactScore)
                .likelihoodScore(likelihoodScore)
                .assessmentTime(LocalDateTime.now())
                .build();
    }

    /**
     * è®¡ç®—é£é™©è¯„åˆ†
     */
    private double calculateRiskScore(double severity, double urgency, double impact, double likelihood) {
        // é£é™©è¯„åˆ†å…¬å¼ï¼šRisk = (Severity Ã— Impact Ã— Likelihood) Ã— Urgency
        return (severity * impact * likelihood) * (1 + urgency * 0.2);
    }
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

```java
@Service
@Slf4j
public class CacheManager {

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    @Resource
    private Cache caffeineCache;

    /**
     * å¤šçº§ç¼“å­˜è·å–
     */
    public <T> T get(String key, Class<T> clazz, Supplier<T> loader, Duration ttl) {
        // L1: æœ¬åœ°ç¼“å­˜
        T value = (T) caffeineCache.getIfPresent(key);
        if (value != null) {
            return value;
        }

        // L2: Redisç¼“å­˜
        value = (T) redisTemplate.opsForValue().get(key);
        if (value != null) {
            caffeineCache.put(key, value);
            return value;
        }

        // L3: æ•°æ®åº“åŠ è½½
        value = loader.get();
        if (value != null) {
            caffeineCache.put(key, value);
            redisTemplate.opsForValue().set(key, value, ttl);
        }

        return value;
    }
}
```

### å¼‚æ­¥å¤„ç†

```java
@Configuration
@EnableAsync
public class AsyncConfig {

    @Bean
    public TaskExecutor notificationTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(1000);
        executor.setThreadNamePrefix("notification-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }

    @Bean
    public TaskExecutor aiAnalysisTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(500);
        executor.setThreadNamePrefix("ai-analysis-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }
}
```

---

## ğŸ”’ å®‰å…¨è®¾è®¡

### æ•°æ®åŠ å¯†

```java
@Component
@Slf4j
public class DataEncryption {

    @Value("${encryption.key}")
    private String encryptionKey;

    /**
     * AESåŠ å¯†
     */
    public String encrypt(String plainText) {
        try {
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            SecretKeySpec keySpec = new SecretKeySpec(encryptionKey.getBytes(), "AES");
            IvParameterSpec ivSpec = new IvParameterSpec(generateIV());
            cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivSpec);
            byte[] encrypted = cipher.doFinal(plainText.getBytes());
            return Base64.getEncoder().encodeToString(ivSpec.getIV()) + ":" +
                   Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            log.error("æ•°æ®åŠ å¯†å¤±è´¥", e);
            throw new RuntimeException("æ•°æ®åŠ å¯†å¤±è´¥", e);
        }
    }

    /**
     * AESè§£å¯†
     */
    public String decrypt(String encryptedText) {
        try {
            String[] parts = encryptedText.split(":");
            byte[] iv = Base64.getDecoder().decode(parts[0]);
            byte[] encrypted = Base64.getDecoder().decode(parts[1]);

            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            SecretKeySpec keySpec = new SecretKeySpec(encryptionKey.getBytes(), "AES");
            IvParameterSpec ivSpec = new IvParameterSpec(iv);
            cipher.init(Cipher.DECRYPT_MODE, keySpec, ivSpec);
            byte[] decrypted = cipher.doFinal(encrypted);
            return new String(decrypted);
        } catch (Exception e) {
            log.error("æ•°æ®è§£å¯†å¤±è´¥", e);
            throw new RuntimeException("æ•°æ®è§£å¯†å¤±è´¥", e);
        }
    }

    private byte[] generateIV() {
        byte[] iv = new byte[16];
        SecureRandom secureRandom = new SecureRandom();
        secureRandom.nextBytes(iv);
        return iv;
    }
}
```

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### Micrometerç›‘æ§é…ç½®

```java
@Configuration
public class MetricsConfig {

    @Bean
    public MeterRegistryCustomizer<MeterRegistry> metricsCommonTags() {
        return registry -> registry.config().commonTags(
            "application", "ioedream-common-service",
            "version", "1.0.0"
        );
    }

    @Bean
    public TimedAspect timedAspect(MeterRegistry registry) {
        return new TimedAspect(registry);
    }

    @Bean
    public CountedAspect countedAspect(MeterRegistry registry) {
        return new CountedAspect(registry);
    }
}
```

### ä¸šåŠ¡æŒ‡æ ‡æ”¶é›†

```java
@Component
@Slf4j
public class NotificationMetricsCollector {

    private final MeterRegistry meterRegistry;
    private final Counter sendCounter;
    private final Timer sendTimer;
    private final Counter errorCounter;

    public NotificationMetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.sendCounter = Counter.builder("notification.send.total")
                .description("é€šçŸ¥å‘é€æ€»æ•°")
                .register(meterRegistry);
        this.sendTimer = Timer.builder("notification.send.duration")
                .description("é€šçŸ¥å‘é€è€—æ—¶")
                .register(meterRegistry);
        this.errorCounter = Counter.builder("notification.send.error")
                .description("é€šçŸ¥å‘é€é”™è¯¯æ•°")
                .register(meterRegistry);
    }

    public void recordSend(String channel, boolean success) {
        sendCounter.increment(Tags.of("channel", channel, "result", success ? "success" : "failed"));
    }

    public void recordSendTime(String channel, Duration duration) {
        sendTimer.record(duration, Tags.of("channel", channel));
    }

    public void recordError(String channel, String errorType) {
        errorCounter.increment(Tags.of("channel", channel, "error_type", errorType));
    }
}
```

---

## ğŸš€ éƒ¨ç½²é…ç½®

### Dockeré…ç½®

```dockerfile
FROM openjdk:17-jdk-slim

LABEL maintainer="IOE-DREAM Team"
LABEL version="1.0.0"
LABEL description="IOE-DREAMå…¬å…±æ¨¡å—å¾®æœåŠ¡"

# åˆ›å»ºåº”ç”¨ç›®å½•
WORKDIR /app

# å¤åˆ¶jaråŒ…
COPY target/ioedream-common-service-1.0.0.jar app.jar

# åˆ›å»ºérootç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser

# JVMå‚æ•°
ENV JAVA_OPTS="-Xms1g -Xmx2g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8088/actuator/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8088

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

### Kuberneteséƒ¨ç½²é…ç½®

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ioedream-common-service
  namespace: ioedream
  labels:
    app: ioedream-common-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ioedream-common-service
  template:
    metadata:
      labels:
        app: ioedream-common-service
    spec:
      containers:
      - name: ioedream-common-service
        image: ioedream/common-service:1.0.0
        ports:
        - containerPort: 8088
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: NACOS_SERVER_ADDR
          value: "nacos:8848"
        - name: MYSQL_HOST
          value: "mysql"
        - name: REDIS_HOST
          value: "redis"
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8088
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8088
          initialDelaySeconds: 30
          periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: ioedream-common-service
  namespace: ioedream
spec:
  selector:
    app: ioedream-common-service
  ports:
  - protocol: TCP
    port: 8088
    targetPort: 8088
  type: ClusterIP
```

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

1. **é€šçŸ¥ç³»ç»Ÿè®¾è®¡**: [02-é€šçŸ¥ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md](./02-é€šçŸ¥ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)
2. **AIæ™ºèƒ½åˆ†æè®¾è®¡**: [03-AIæ™ºèƒ½åˆ†æè®¾è®¡æ–‡æ¡£.md](./03-AIæ™ºèƒ½åˆ†æè®¾è®¡æ–‡æ¡£.md)
3. **æƒé™ç®¡ç†è®¾è®¡**: [04-æƒé™ç®¡ç†è®¾è®¡æ–‡æ¡£.md](./04-æƒé™ç®¡ç†è®¾è®¡æ–‡æ¡£.md)
4. **å®¡è®¡æ—¥å¿—è®¾è®¡**: [05-å®¡è®¡æ—¥å¿—è®¾è®¡æ–‡æ¡£.md](./05-å®¡è®¡æ—¥å¿—è®¾è®¡æ–‡æ¡£.md)
5. **ç›‘æ§å‘Šè­¦è®¾è®¡**: [06-ç›‘æ§å‘Šè­¦è®¾è®¡æ–‡æ¡£.md](./06-ç›‘æ§å‘Šè­¦è®¾è®¡æ–‡æ¡£.md)
6. **æ•°æ®å­—å…¸è®¾è®¡**: [07-æ•°æ®å­—å…¸è®¾è®¡æ–‡æ¡£.md](./07-æ•°æ®å­—å…¸è®¾è®¡æ–‡æ¡£.md)

---

**æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ
**ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-12-16