# IOE-DREAM å¾®æœåŠ¡ä»£ç ç»“æ„è¯´æ˜

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17  
> **é€‚ç”¨èŒƒå›´**: æ‰€æœ‰ä¸šåŠ¡å¾®æœåŠ¡

---

## ğŸ“‹ æ¦‚è¿°

IOE-DREAM é‡‡ç”¨ä¸ƒå¾®æœåŠ¡æ¶æ„ï¼Œæ¯ä¸ªå¾®æœåŠ¡éµå¾ªç»Ÿä¸€çš„ä»£ç ç»“æ„å’Œå¼€å‘è§„èŒƒã€‚

---

## ğŸ—ï¸ å¾®æœåŠ¡æ¸…å•

| æœåŠ¡å | ç«¯å£ | èŒè´£ |
|--------|------|------|
| ioedream-gateway-service | 8080 | APIç½‘å…³ï¼Œç»Ÿä¸€å…¥å£ |
| ioedream-common-service | 8088 | å…¬å…±ä¸šåŠ¡æœåŠ¡ |
| ioedream-device-comm-service | 8087 | è®¾å¤‡é€šè®¯æœåŠ¡ |
| ioedream-oa-service | 8089 | OAå·¥ä½œæµæœåŠ¡ |
| ioedream-access-service | 8090 | é—¨ç¦æœåŠ¡ |
| ioedream-attendance-service | 8091 | è€ƒå‹¤æœåŠ¡ |
| ioedream-video-service | 8092 | è§†é¢‘æœåŠ¡ |
| ioedream-consume-service | 8094 | æ¶ˆè´¹æœåŠ¡ |
| ioedream-visitor-service | 8095 | è®¿å®¢æœåŠ¡ |

---

## ğŸ“ æ ‡å‡†ä»£ç ç»“æ„

ä»¥ ioedream-access-service ä¸ºä¾‹çš„å®é™…ä»£ç ç»“æ„ï¼š

```
ioedream-access-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ net/lab1024/sa/access/
â”‚   â”‚   â”‚       â”œâ”€â”€ AccessServiceApplication.java    # å¯åŠ¨ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ config/                          # é…ç½®ç±»
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AccessMetricsConfiguration.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AccessSecurityConfiguration.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AntiPassbackConfiguration.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ CacheOptimizationConfiguration.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ DatabaseOptimizationConfiguration.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ManagerConfiguration.java
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/                      # Controllerå±‚
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AccessDeviceController.java
â”‚   â”‚   â”‚       â”œâ”€â”€ service/                         # Serviceå±‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AccessDeviceService.java     # æ¥å£
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ BiometricAuthService.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ impl/
â”‚   â”‚   â”‚       â”‚       â”œâ”€â”€ AccessDeviceServiceImpl.java
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ BiometricAuthServiceImpl.java
â”‚   â”‚   â”‚       â”œâ”€â”€ manager/                         # Managerå±‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AntiPassbackManager.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ BiometricTemplateManager.java
â”‚   â”‚   â”‚       â”œâ”€â”€ dao/                             # DAOå±‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AccessAreaDao.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ AccessDeviceDao.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AccessRecordDao.java
â”‚   â”‚   â”‚       â”œâ”€â”€ domain/                          # é¢†åŸŸå¯¹è±¡
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ entity/                      # å®ä½“ç±»
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ BiometricConfigEntity.java
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ form/                        # è¡¨å•ç±»
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ AccessDeviceAddForm.java
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ AccessDeviceQueryForm.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ vo/                          # è§†å›¾å¯¹è±¡
â”‚   â”‚   â”‚       â”‚       â”œâ”€â”€ AccessDeviceVO.java
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ AccessRecordVO.java
â”‚   â”‚   â”‚       â”œâ”€â”€ edge/                            # è¾¹ç¼˜è®¡ç®—ç›¸å…³
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ controller/EdgeSecurityController.java
â”‚   â”‚   â”‚       â””â”€â”€ openapi/                         # å¼€æ”¾API
â”‚   â”‚   â”‚           â””â”€â”€ controller/AccessOpenApiController.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚       â”œâ”€â”€ application-prod.yml
â”‚   â”‚       â”œâ”€â”€ bootstrap.yml
â”‚   â”‚       â””â”€â”€ mapper/                              # MyBatis XML
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/
â””â”€â”€ pom.xml
```

---

## ğŸ”§ å„å±‚èŒè´£è¯´æ˜

### Controller å±‚

```java
@RestController
@RequestMapping("/api/xxx/v1")
public class XxxController {

    @Resource
    private XxxService xxxService;

    @GetMapping("/{id}")
    public ResponseDTO<XxxVO> getById(@PathVariable Long id) {
        return ResponseDTO.ok(xxxService.getById(id));
    }

    @PostMapping
    public ResponseDTO<Long> add(@Valid @RequestBody XxxAddForm form) {
        return ResponseDTO.ok(xxxService.add(form));
    }
}
```

**èŒè´£**:
- HTTP è¯·æ±‚å¤„ç†
- å‚æ•°éªŒè¯ (`@Valid`)
- æƒé™æ§åˆ¶
- è¿”å›ç»Ÿä¸€ `ResponseDTO`

### Service å±‚

```java
public interface XxxService {
    XxxVO getById(Long id);
    Long add(XxxAddForm form);
}

@Service
@Transactional(rollbackFor = Exception.class)
public class XxxServiceImpl implements XxxService {

    @Resource
    private XxxDao xxxDao;

    @Override
    public XxxVO getById(Long id) {
        XxxEntity entity = xxxDao.selectById(id);
        return BeanUtil.copyProperties(entity, XxxVO.class);
    }
}
```

**èŒè´£**:
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- äº‹åŠ¡ç®¡ç†
- ä¸šåŠ¡è§„åˆ™éªŒè¯

### Manager å±‚

```java
public class XxxManager {

    private final XxxDao xxxDao;
    private final RedisTemplate<String, Object> redisTemplate;

    public XxxManager(XxxDao xxxDao, RedisTemplate<String, Object> redisTemplate) {
        this.xxxDao = xxxDao;
        this.redisTemplate = redisTemplate;
    }

    public XxxEntity getFromCacheOrDb(Long id) {
        String key = "xxx:" + id;
        XxxEntity entity = (XxxEntity) redisTemplate.opsForValue().get(key);
        if (entity == null) {
            entity = xxxDao.selectById(id);
            redisTemplate.opsForValue().set(key, entity, 1, TimeUnit.HOURS);
        }
        return entity;
    }
}
```

**èŒè´£**:
- å¤æ‚æµç¨‹ç¼–æ’
- ç¼“å­˜ç®¡ç†
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

### DAO å±‚

```java
@Mapper
public interface XxxDao extends BaseMapper<XxxEntity> {

    @Select("SELECT * FROM t_xxx WHERE status = #{status}")
    List<XxxEntity> selectByStatus(@Param("status") Integer status);
}
```

**èŒè´£**:
- æ•°æ®åº“ CRUD æ“ä½œ
- ç»§æ‰¿ `BaseMapper`
- ä½¿ç”¨ `@Mapper` æ³¨è§£

---

## ğŸ“Š é¢†åŸŸå¯¹è±¡è§„èŒƒ

### Entity (å®ä½“ç±»)

```java
@Data
@TableName("t_xxx")
public class XxxEntity extends BaseEntity {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String name;
    
    private Integer status;
}
```

### Form (è¡¨å•ç±»)

```java
@Data
public class XxxAddForm {
    
    @NotBlank(message = "åç§°ä¸èƒ½ä¸ºç©º")
    @Size(max = 50, message = "åç§°æœ€é•¿50å­—ç¬¦")
    private String name;
}
```

### VO (è§†å›¾å¯¹è±¡)

```java
@Data
public class XxxVO {
    private Long id;
    private String name;
    private String statusName;
}
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### application.yml (ä¸»é…ç½®)

```yaml
server:
  port: 8090

spring:
  application:
    name: ioedream-xxx-service
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
```

### bootstrap.yml (Nacosé…ç½®)

```yaml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:}
      config:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        file-extension: yaml
```

---

## ğŸ¯ å¼€å‘è§„èŒƒæ£€æŸ¥æ¸…å•

- [ ] ä½¿ç”¨ `@Resource` æ³¨å…¥ä¾èµ–
- [ ] ä½¿ç”¨ `@Mapper` + `Dao` åç¼€
- [ ] ä½¿ç”¨ `jakarta.*` åŒ…
- [ ] Controller è¿”å› `ResponseDTO`
- [ ] ä½¿ç”¨ `@Valid` å‚æ•°éªŒè¯
- [ ] éµå¾ªå››å±‚æ¶æ„è¾¹ç•Œ
- [ ] è¡¨åä»¥ `t_` å¼€å¤´
- [ ] å®ä½“ç±»ç»§æ‰¿ `BaseEntity`

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**
- **åˆ›å»ºäºº**: IOE-DREAMæ¶æ„å›¢é˜Ÿ
- **æœ€åæ›´æ–°**: 2025-12-17
