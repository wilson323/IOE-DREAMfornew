# OAå·¥ä½œæµå¾®æœåŠ¡ - æ€»ä½“è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0.0  
> **å¾®æœåŠ¡**: ioedream-oa-service (8089)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

OAå·¥ä½œæµå¾®æœåŠ¡è´Ÿè´£ä¼ä¸šå†…éƒ¨å®¡æ‰¹æµç¨‹çš„å…¨é¢ç®¡ç†ï¼ŒåŒ…æ‹¬æµç¨‹è®¾è®¡ã€è¡¨å•é…ç½®ã€ä»»åŠ¡å¤„ç†ã€å®¡æ‰¹ç®¡ç†å’Œæµç¨‹ç›‘æ§ï¼Œä¸ºé—¨ç¦ã€è€ƒå‹¤ã€è®¿å®¢ç­‰ä¸šåŠ¡æä¾›ç»Ÿä¸€çš„å®¡æ‰¹èƒ½åŠ›ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph æ¥å…¥å±‚
        API[REST API]
        WS[WebSocket]
        MQ[RabbitMQ]
    end
    
    subgraph ä¸šåŠ¡å±‚
        FLOW[æµç¨‹ç®¡ç†]
        FORM[è¡¨å•è®¾è®¡]
        TASK[ä»»åŠ¡å¤„ç†]
        APPROVAL[å®¡æ‰¹ç®¡ç†]
        NOTIFY[æ¶ˆæ¯é€šçŸ¥]
        REPORT[æµç¨‹æŠ¥è¡¨]
    end
    
    subgraph æµç¨‹å¼•æ“
        ACTIVITI[Activiti 7]
    end
    
    subgraph æ•°æ®å±‚
        MySQL[(MySQL)]
        Redis[(Redis)]
    end
    
    API --> FLOW
    API --> TASK
    WS --> NOTIFY
    MQ --> APPROVAL
    
    FLOW --> ACTIVITI
    TASK --> ACTIVITI
    ACTIVITI --> MySQL
    NOTIFY --> Redis
```

---

## ğŸ“ ä»£ç ç»“æ„

```
ioedream-oa-service/src/main/java/net/lab1024/sa/oa/
â”œâ”€â”€ OaApplication.java                      # å¯åŠ¨ç±»
â”œâ”€â”€ controller/                             # Controllerå±‚
â”‚   â”œâ”€â”€ ProcessDefinitionController.java   # æµç¨‹å®šä¹‰
â”‚   â”œâ”€â”€ ProcessInstanceController.java     # æµç¨‹å®ä¾‹
â”‚   â”œâ”€â”€ FormDefinitionController.java      # è¡¨å•å®šä¹‰
â”‚   â”œâ”€â”€ TaskController.java                # ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ ApprovalController.java            # å®¡æ‰¹ç®¡ç†
â”‚   â””â”€â”€ WorkflowReportController.java      # æµç¨‹æŠ¥è¡¨
â”œâ”€â”€ service/                                # Serviceå±‚
â”‚   â”œâ”€â”€ ProcessDefinitionService.java
â”‚   â”œâ”€â”€ ProcessInstanceService.java
â”‚   â”œâ”€â”€ FormDefinitionService.java
â”‚   â”œâ”€â”€ TaskService.java
â”‚   â”œâ”€â”€ ApprovalService.java
â”‚   â”œâ”€â”€ WorkflowNotifyService.java
â”‚   â””â”€â”€ WorkflowReportService.java
â”œâ”€â”€ dao/                                    # DAOå±‚
â”‚   â”œâ”€â”€ ProcessDefinitionDao.java
â”‚   â”œâ”€â”€ FormDefinitionDao.java
â”‚   â”œâ”€â”€ ApprovalRecordDao.java
â”‚   â””â”€â”€ WorkflowCallbackDao.java
â”œâ”€â”€ domain/                                 # é¢†åŸŸå¯¹è±¡
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/
â”œâ”€â”€ manager/                                # Managerå±‚
â”‚   â”œâ”€â”€ ActivitiManager.java
â”‚   â””â”€â”€ WorkflowCallbackManager.java
â””â”€â”€ listener/                               # æµç¨‹ç›‘å¬å™¨
    â”œâ”€â”€ TaskCreateListener.java
    â””â”€â”€ ProcessEndListener.java
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æµç¨‹ç®¡ç†
- æµç¨‹å®šä¹‰ï¼ˆBPMNè®¾è®¡ï¼‰
- æµç¨‹éƒ¨ç½²
- æµç¨‹ç‰ˆæœ¬ç®¡ç†
- æµç¨‹æŒ‚èµ·/æ¿€æ´»

### 2. è¡¨å•è®¾è®¡
- è¡¨å•æ¨¡æ¿å®šä¹‰
- å­—æ®µé…ç½®
- è¡¨å•ç‰ˆæœ¬ç®¡ç†
- è¡¨å•ä¸æµç¨‹ç»‘å®š

### 3. ä»»åŠ¡å¤„ç†
- å¾…åŠä»»åŠ¡æŸ¥è¯¢
- å·²åŠä»»åŠ¡æŸ¥è¯¢
- ä»»åŠ¡è®¤é¢†
- ä»»åŠ¡å§”æ‰˜/è½¬åŠ

### 4. å®¡æ‰¹ç®¡ç†
- å®¡æ‰¹é€šè¿‡/æ‹’ç»
- åŠ ç­¾/å‡ç­¾
- å›é€€/æ’¤å›
- å®¡æ‰¹æ„è§

### 5. æ¶ˆæ¯é€šçŸ¥
- å¾…åŠé€šçŸ¥
- å®¡æ‰¹ç»“æœé€šçŸ¥
- å‚¬åŠæé†’
- è¶…æ—¶é¢„è­¦

### 6. æµç¨‹æŠ¥è¡¨
- æµç¨‹ç»Ÿè®¡
- æ•ˆç‡åˆ†æ
- å®¡æ‰¹æ—¶é•¿åˆ†æ
- æµç¨‹ç›‘æ§å¤§å±

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ |
|------|------|
| t_oa_process_definition | æµç¨‹å®šä¹‰è¡¨ |
| t_oa_form_definition | è¡¨å•å®šä¹‰è¡¨ |
| t_oa_process_instance | æµç¨‹å®ä¾‹è¡¨ |
| t_oa_approval_record | å®¡æ‰¹è®°å½•è¡¨ |
| t_oa_workflow_callback | å›è°ƒé…ç½®è¡¨ |
| t_oa_task_delegate | ä»»åŠ¡å§”æ‰˜è¡¨ |

### ERå›¾

```mermaid
erDiagram
    t_oa_process_definition {
        bigint id PK
        varchar process_key
        varchar process_name
        varchar category
        int version
        varchar bpmn_xml
        tinyint status
    }
    
    t_oa_form_definition {
        bigint id PK
        varchar form_key
        varchar form_name
        json form_config
        int version
        tinyint status
    }
    
    t_oa_process_instance {
        bigint id PK
        varchar process_instance_id
        varchar process_key
        varchar business_key
        bigint applicant_id
        varchar title
        tinyint status
        datetime start_time
        datetime end_time
    }
    
    t_oa_approval_record {
        bigint id PK
        varchar process_instance_id FK
        varchar task_id
        bigint approver_id
        varchar action
        varchar comment
        datetime approve_time
    }
    
    t_oa_process_definition ||--o{ t_oa_process_instance : "å®ä¾‹"
    t_oa_process_instance ||--o{ t_oa_approval_record : "å®¡æ‰¹"
```

---

## ğŸ”§ APIæ¥å£è®¾è®¡

### æµç¨‹å®šä¹‰

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/oa/v1/process/definition/list | æµç¨‹åˆ—è¡¨ |
| POST | /api/oa/v1/process/definition/deploy | éƒ¨ç½²æµç¨‹ |
| PUT | /api/oa/v1/process/definition/suspend | æŒ‚èµ·æµç¨‹ |

### æµç¨‹å®ä¾‹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/oa/v1/process/instance/start | å‘èµ·æµç¨‹ |
| GET | /api/oa/v1/process/instance/{id} | æµç¨‹è¯¦æƒ… |
| DELETE | /api/oa/v1/process/instance/{id} | æ’¤å›æµç¨‹ |

### ä»»åŠ¡ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/oa/v1/task/todo | å¾…åŠä»»åŠ¡ |
| GET | /api/oa/v1/task/done | å·²åŠä»»åŠ¡ |
| POST | /api/oa/v1/task/claim | è®¤é¢†ä»»åŠ¡ |
| POST | /api/oa/v1/task/delegate | å§”æ‰˜ä»»åŠ¡ |

### å®¡æ‰¹ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/oa/v1/approval/approve | å®¡æ‰¹é€šè¿‡ |
| POST | /api/oa/v1/approval/reject | å®¡æ‰¹æ‹’ç» |
| POST | /api/oa/v1/approval/rollback | å›é€€ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡é¡¹ | è¦æ±‚ |
|--------|------|
| æµç¨‹å‘èµ·å“åº” | â‰¤ 1s |
| å®¡æ‰¹å¤„ç†å»¶è¿Ÿ | â‰¤ 500ms |
| å¾…åŠæŸ¥è¯¢å“åº” | â‰¤ 300ms |
| å¹¶å‘å®¡æ‰¹æ”¯æŒ | â‰¥ 200æ¬¡/ç§’ |
| æµç¨‹å®ä¾‹ä¿å­˜ | â‰¥ 3å¹´ |

---

## ğŸ” å®‰å…¨è¦æ±‚

- å®¡æ‰¹è®°å½•ä¸å¯ç¯¡æ”¹
- æµç¨‹æ“ä½œå®¡è®¡æ—¥å¿—
- æ•æ„Ÿæ•°æ®è„±æ•
- å®¡æ‰¹æƒé™ä¸¥æ ¼æ§åˆ¶

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
