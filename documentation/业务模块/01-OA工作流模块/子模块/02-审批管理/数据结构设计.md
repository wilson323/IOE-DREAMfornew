# å®¡æ‰¹ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_oa_process_instance {
        bigint id PK "å®ä¾‹ID"
        varchar process_instance_id "å¼•æ“å®ä¾‹ID"
        varchar process_key "æµç¨‹æ ‡è¯†"
        varchar business_key "ä¸šåŠ¡KEY"
        bigint applicant_id FK "ç”³è¯·äººID"
        varchar title "ç”³è¯·æ ‡é¢˜"
        json form_data "è¡¨å•æ•°æ®"
        tinyint status "çŠ¶æ€"
        datetime start_time "å¼€å§‹æ—¶é—´"
        datetime end_time "ç»“æŸæ—¶é—´"
    }
    
    t_oa_approval_record {
        bigint id PK "è®°å½•ID"
        bigint instance_id FK "å®ä¾‹ID"
        varchar task_id "ä»»åŠ¡ID"
        varchar task_name "ä»»åŠ¡åç§°"
        bigint approver_id FK "å®¡æ‰¹äººID"
        varchar action "å®¡æ‰¹åŠ¨ä½œ"
        varchar comment "å®¡æ‰¹æ„è§"
        datetime approve_time "å®¡æ‰¹æ—¶é—´"
        int duration "å¤„ç†æ—¶é•¿ç§’"
    }
    
    t_oa_task_delegate {
        bigint id PK "å§”æ‰˜ID"
        bigint delegator_id FK "å§”æ‰˜äººID"
        bigint delegatee_id FK "è¢«å§”æ‰˜äººID"
        varchar process_key "æµç¨‹æ ‡è¯†"
        datetime start_time "å¼€å§‹æ—¶é—´"
        datetime end_time "ç»“æŸæ—¶é—´"
        tinyint status "çŠ¶æ€"
    }
    
    t_oa_process_instance ||--o{ t_oa_approval_record : "å®¡æ‰¹è®°å½•"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_oa_process_instance (æµç¨‹å®ä¾‹è¡¨)

```sql
CREATE TABLE t_oa_process_instance (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å®ä¾‹ID',
    process_instance_id VARCHAR(64) NOT NULL COMMENT 'Activitiå®ä¾‹ID',
    process_key VARCHAR(50) NOT NULL COMMENT 'æµç¨‹æ ‡è¯†',
    process_name VARCHAR(100) COMMENT 'æµç¨‹åç§°',
    business_key VARCHAR(100) COMMENT 'ä¸šåŠ¡KEY',
    applicant_id BIGINT NOT NULL COMMENT 'ç”³è¯·äººID',
    applicant_name VARCHAR(50) COMMENT 'ç”³è¯·äººå§“å',
    title VARCHAR(200) NOT NULL COMMENT 'ç”³è¯·æ ‡é¢˜',
    form_data JSON COMMENT 'è¡¨å•æ•°æ®JSON',
    current_node VARCHAR(100) COMMENT 'å½“å‰èŠ‚ç‚¹',
    current_approvers VARCHAR(500) COMMENT 'å½“å‰å®¡æ‰¹äººIDs',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€:0è¿›è¡Œä¸­1å·²å®Œæˆ2å·²æ‹’ç»3å·²æ’¤å›4å·²ç»ˆæ­¢',
    start_time DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    end_time DATETIME COMMENT 'ç»“æŸæ—¶é—´',
    duration INT COMMENT 'æ€»æ—¶é•¿ç§’',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_process_instance_id (process_instance_id),
    INDEX idx_process_key (process_key),
    INDEX idx_applicant_id (applicant_id),
    INDEX idx_status (status),
    INDEX idx_start_time (start_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æµç¨‹å®ä¾‹è¡¨';
```

### t_oa_approval_record (å®¡æ‰¹è®°å½•è¡¨)

```sql
CREATE TABLE t_oa_approval_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
    instance_id BIGINT NOT NULL COMMENT 'æµç¨‹å®ä¾‹ID',
    process_instance_id VARCHAR(64) NOT NULL COMMENT 'Activitiå®ä¾‹ID',
    task_id VARCHAR(64) NOT NULL COMMENT 'ä»»åŠ¡ID',
    task_name VARCHAR(100) COMMENT 'ä»»åŠ¡åç§°',
    task_key VARCHAR(50) COMMENT 'ä»»åŠ¡æ ‡è¯†',
    approver_id BIGINT NOT NULL COMMENT 'å®¡æ‰¹äººID',
    approver_name VARCHAR(50) COMMENT 'å®¡æ‰¹äººå§“å',
    action VARCHAR(20) NOT NULL COMMENT 'å®¡æ‰¹åŠ¨ä½œ:APPROVE/REJECT/ROLLBACK/TRANSFER/DELEGATE',
    comment VARCHAR(500) COMMENT 'å®¡æ‰¹æ„è§',
    approve_time DATETIME NOT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
    duration INT COMMENT 'å¤„ç†æ—¶é•¿ç§’',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_instance_id (instance_id),
    INDEX idx_process_instance_id (process_instance_id),
    INDEX idx_approver_id (approver_id),
    INDEX idx_approve_time (approve_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®¡æ‰¹è®°å½•è¡¨';
```

### t_oa_task_delegate (ä»»åŠ¡å§”æ‰˜è¡¨)

```sql
CREATE TABLE t_oa_task_delegate (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å§”æ‰˜ID',
    delegator_id BIGINT NOT NULL COMMENT 'å§”æ‰˜äººID',
    delegator_name VARCHAR(50) COMMENT 'å§”æ‰˜äººå§“å',
    delegatee_id BIGINT NOT NULL COMMENT 'è¢«å§”æ‰˜äººID',
    delegatee_name VARCHAR(50) COMMENT 'è¢«å§”æ‰˜äººå§“å',
    process_key VARCHAR(50) COMMENT 'æµç¨‹æ ‡è¯†,ç©ºä¸ºå…¨éƒ¨',
    start_time DATETIME NOT NULL COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¶é—´',
    end_time DATETIME NOT NULL COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¶é—´',
    reason VARCHAR(200) COMMENT 'å§”æ‰˜åŸå› ',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0å¤±æ•ˆ1ç”Ÿæ•ˆ',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_delegator_id (delegator_id),
    INDEX idx_delegatee_id (delegatee_id),
    INDEX idx_status_time (status, start_time, end_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä»»åŠ¡å§”æ‰˜è¡¨';
```

---

## ğŸ”§ çŠ¶æ€æšä¸¾

### æµç¨‹å®ä¾‹çŠ¶æ€

| å€¼ | è¯´æ˜ |
|------|------|
| 0 | è¿›è¡Œä¸­ |
| 1 | å·²å®Œæˆ(é€šè¿‡) |
| 2 | å·²æ‹’ç» |
| 3 | å·²æ’¤å› |
| 4 | å·²ç»ˆæ­¢ |

### å®¡æ‰¹åŠ¨ä½œ

| å€¼ | è¯´æ˜ |
|------|------|
| APPROVE | å®¡æ‰¹é€šè¿‡ |
| REJECT | å®¡æ‰¹æ‹’ç» |
| ROLLBACK | å›é€€ |
| TRANSFER | è½¬åŠ |
| DELEGATE | å§”æ‰˜ |
| ADD_SIGN | åŠ ç­¾ |
| SUB_SIGN | å‡ç­¾ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
