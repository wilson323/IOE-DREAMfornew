# æµç¨‹ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_oa_process_definition {
        bigint id PK "æµç¨‹å®šä¹‰ID"
        varchar process_key "æµç¨‹æ ‡è¯†"
        varchar process_name "æµç¨‹åç§°"
        varchar category "æµç¨‹åˆ†ç±»"
        int version "ç‰ˆæœ¬å·"
        text bpmn_xml "BPMNå®šä¹‰"
        varchar deployment_id "éƒ¨ç½²ID"
        tinyint status "çŠ¶æ€"
        bigint creator_id "åˆ›å»ºäºº"
        datetime create_time "åˆ›å»ºæ—¶é—´"
        datetime update_time "æ›´æ–°æ—¶é—´"
    }
    
    t_oa_process_category {
        bigint id PK "åˆ†ç±»ID"
        varchar category_code "åˆ†ç±»ç¼–ç "
        varchar category_name "åˆ†ç±»åç§°"
        int sort_order "æ’åº"
        tinyint status "çŠ¶æ€"
    }
    
    t_oa_process_node {
        bigint id PK "èŠ‚ç‚¹ID"
        bigint process_id FK "æµç¨‹ID"
        varchar node_id "èŠ‚ç‚¹æ ‡è¯†"
        varchar node_name "èŠ‚ç‚¹åç§°"
        varchar node_type "èŠ‚ç‚¹ç±»å‹"
        varchar assignee_type "å¤„ç†äººç±»å‹"
        varchar assignee_value "å¤„ç†äººå€¼"
        json node_config "èŠ‚ç‚¹é…ç½®"
    }
    
    t_oa_process_definition ||--o{ t_oa_process_node : "èŠ‚ç‚¹"
    t_oa_process_category ||--o{ t_oa_process_definition : "åˆ†ç±»"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_oa_process_definition (æµç¨‹å®šä¹‰è¡¨)

```sql
CREATE TABLE t_oa_process_definition (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æµç¨‹å®šä¹‰ID',
    process_key VARCHAR(50) NOT NULL COMMENT 'æµç¨‹æ ‡è¯†',
    process_name VARCHAR(100) NOT NULL COMMENT 'æµç¨‹åç§°',
    category VARCHAR(50) COMMENT 'æµç¨‹åˆ†ç±»',
    version INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    bpmn_xml TEXT COMMENT 'BPMNå®šä¹‰XML',
    deployment_id VARCHAR(64) COMMENT 'Activitiéƒ¨ç½²ID',
    process_definition_id VARCHAR(64) COMMENT 'Activitiæµç¨‹å®šä¹‰ID',
    description VARCHAR(500) COMMENT 'æµç¨‹æè¿°',
    form_key VARCHAR(50) COMMENT 'å…³è”è¡¨å•æ ‡è¯†',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨2æŒ‚èµ·',
    creator_id BIGINT COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    UNIQUE KEY uk_process_key_version (process_key, version),
    INDEX idx_category (category),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æµç¨‹å®šä¹‰è¡¨';
```

### t_oa_process_node (æµç¨‹èŠ‚ç‚¹è¡¨)

```sql
CREATE TABLE t_oa_process_node (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'èŠ‚ç‚¹ID',
    process_id BIGINT NOT NULL COMMENT 'æµç¨‹å®šä¹‰ID',
    node_id VARCHAR(50) NOT NULL COMMENT 'èŠ‚ç‚¹æ ‡è¯†',
    node_name VARCHAR(100) NOT NULL COMMENT 'èŠ‚ç‚¹åç§°',
    node_type VARCHAR(20) NOT NULL COMMENT 'èŠ‚ç‚¹ç±»å‹:USER_TASK/EXCLUSIVE_GATEWAY/PARALLEL_GATEWAY',
    assignee_type VARCHAR(20) COMMENT 'å¤„ç†äººç±»å‹:USER/ROLE/DEPT/EXPRESSION',
    assignee_value VARCHAR(200) COMMENT 'å¤„ç†äººå€¼',
    form_key VARCHAR(50) COMMENT 'èŠ‚ç‚¹è¡¨å•æ ‡è¯†',
    node_config JSON COMMENT 'èŠ‚ç‚¹é…ç½®JSON',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_process_id (process_id),
    INDEX idx_node_id (node_id),
    FOREIGN KEY (process_id) REFERENCES t_oa_process_definition(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æµç¨‹èŠ‚ç‚¹è¡¨';
```

---

## ğŸ”§ å­—æ®µæšä¸¾è¯´æ˜

### èŠ‚ç‚¹ç±»å‹

| å€¼ | è¯´æ˜ |
|------|------|
| START_EVENT | å¼€å§‹äº‹ä»¶ |
| END_EVENT | ç»“æŸäº‹ä»¶ |
| USER_TASK | ç”¨æˆ·ä»»åŠ¡ |
| EXCLUSIVE_GATEWAY | æ’ä»–ç½‘å…³ |
| PARALLEL_GATEWAY | å¹¶è¡Œç½‘å…³ |
| SUB_PROCESS | å­æµç¨‹ |

### å¤„ç†äººç±»å‹

| å€¼ | è¯´æ˜ |
|------|------|
| USER | æŒ‡å®šç”¨æˆ· |
| ROLE | æŒ‡å®šè§’è‰² |
| DEPT | æŒ‡å®šéƒ¨é—¨ |
| EXPRESSION | è¡¨è¾¾å¼ |
| INITIATOR | æµç¨‹å‘èµ·äºº |
| LEADER | å‘èµ·äººä¸»ç®¡ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
