# 考勤管理模块 - 业务流程图文档

> **版本**: v2.0.0  
> **更新日期**: 2025-12-17  
> **文档类型**: 业务流程设计

---

## 1. 核心业务流程概览

```mermaid
graph TB
    subgraph 配置管理
        A1[班次时间配置] --> A2[排班管理]
        A3[考勤规则配置] --> A4[预警通知配置]
    end
    
    subgraph 日常考勤
        B1[员工打卡] --> B2[打卡记录采集]
        B2 --> B3[考勤计算]
        B3 --> B4[考勤结果]
    end
    
    subgraph 异常处理
        C1[异常申请] --> C2[审批流程]
        C2 --> C3[考勤调整]
    end
    
    subgraph 数据统计
        D1[月度汇总] --> D2[报表生成]
        D2 --> D3[数据导出]
    end
    
    A2 --> B3
    A3 --> B3
    B4 --> C1
    B4 --> D1
    C3 --> D1
```

---

## 2. 班次时间管理流程

### 2.1 时间段创建流程

```mermaid
flowchart TD
    A[开始] --> B[输入时间段信息]
    B --> C{编码唯一性校验}
    C -->|不唯一| D[提示编码已存在]
    D --> B
    C -->|唯一| E[设置时间范围]
    E --> F{时间有效性校验}
    F -->|无效| G[提示时间配置错误]
    G --> E
    F -->|有效| H[配置容忍度和规则]
    H --> I[保存时间段]
    I --> J[结束]
```

### 2.2 班次创建流程

```mermaid
flowchart TD
    A[开始] --> B[输入班次基本信息]
    B --> C[选择班次类型]
    C --> D{班次类型}
    D -->|规律班次| E1[配置固定时间]
    D -->|弹性班次| E2[配置弹性时间和核心时间]
    D -->|轮班| E3[配置轮班周期]
    E1 --> F[关联时间段]
    E2 --> F
    E3 --> F
    F --> G{时间段冲突检测}
    G -->|有冲突| H[提示冲突信息]
    H --> F
    G -->|无冲突| I[保存班次配置]
    I --> J[结束]
```

### 2.3 班次时间段关联流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant S as 系统
    participant DB as 数据库
    
    U->>S: 选择班次
    S->>DB: 查询班次信息
    DB-->>S: 返回班次数据
    S-->>U: 显示班次详情
    
    U->>S: 添加时间段
    S->>S: 检测时间冲突
    alt 存在冲突
        S-->>U: 提示冲突信息
    else 无冲突
        S->>DB: 保存关联关系
        DB-->>S: 保存成功
        S-->>U: 更新时间线预览
    end
```

---

## 3. 排班管理流程

### 3.1 手动排班流程

```mermaid
flowchart TD
    A[开始] --> B[选择员工和日期]
    B --> C[选择班次]
    C --> D{检查排班冲突}
    D -->|有冲突| E[显示冲突信息]
    E --> F{选择处理方式}
    F -->|覆盖| G[创建覆盖记录]
    F -->|取消| B
    D -->|无冲突| H[创建排班记录]
    G --> I[保存排班]
    H --> I
    I --> J[通知相关人员]
    J --> K[结束]
```

### 3.2 批量排班流程

```mermaid
flowchart TD
    A[开始] --> B[选择员工范围]
    B --> C[选择日期范围]
    C --> D[选择班次或模板]
    D --> E[生成排班预览]
    E --> F{确认排班}
    F -->|取消| B
    F -->|确认| G[批量冲突检测]
    G --> H{存在冲突}
    H -->|是| I[显示冲突列表]
    I --> J[选择冲突处理策略]
    J --> K[执行批量排班]
    H -->|否| K
    K --> L[保存排班记录]
    L --> M[发送通知]
    M --> N[结束]
```

### 3.3 排班模板应用流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant S as 系统
    participant DB as 数据库
    
    U->>S: 选择排班模板
    S->>DB: 加载模板配置
    DB-->>S: 返回模板数据
    
    U->>S: 选择应用范围
    U->>S: 选择应用周期
    
    S->>S: 根据模板生成排班计划
    S-->>U: 显示排班预览
    
    U->>S: 确认应用
    S->>S: 检测排班冲突
    S->>DB: 批量创建排班记录
    DB-->>S: 保存成功
    S-->>U: 显示应用结果
```

### 3.4 临时排班覆盖流程

```mermaid
flowchart TD
    A[开始] --> B[选择员工和日期]
    B --> C[查询现有排班]
    C --> D{选择覆盖方式}
    D -->|整班覆盖| E1[选择新班次]
    D -->|部分覆盖| E2[设置时间段]
    E1 --> F[设置优先级]
    E2 --> F
    F --> G[填写覆盖原因]
    G --> H[保存覆盖记录]
    H --> I[通知相关人员]
    I --> J[结束]
```

---

## 4. 考勤规则配置流程

### 4.1 考勤规则创建流程

```mermaid
flowchart TD
    A[开始] --> B[选择规则类型]
    B --> C{规则类型}
    C -->|考勤规则| D1[配置迟到早退规则]
    C -->|预警规则| D2[配置预警条件]
    C -->|通知规则| D3[配置通知渠道]
    D1 --> E[设置适用范围]
    D2 --> E
    D3 --> E
    E --> F[规则验证]
    F --> G{验证通过}
    G -->|否| H[提示配置错误]
    H --> B
    G -->|是| I[保存规则]
    I --> J[结束]
```

### 4.2 预警规则触发流程

```mermaid
sequenceDiagram
    participant T as 定时任务
    participant S as 预警服务
    participant DB as 数据库
    participant N as 通知服务
    
    T->>S: 触发预警检测
    S->>DB: 查询启用的预警规则
    DB-->>S: 返回规则列表
    
    loop 每条规则
        S->>DB: 查询符合条件的数据
        DB-->>S: 返回异常数据
        alt 存在异常
            S->>S: 生成预警记录
            S->>DB: 保存预警记录
            S->>N: 发送预警通知
            N-->>S: 通知发送结果
        end
    end
    
    S-->>T: 检测完成
```

---

## 5. 异常管理流程

### 5.1 请假申请流程

```mermaid
flowchart TD
    A[开始] --> B[选择假种类型]
    B --> C[查询剩余额度]
    C --> D{额度充足}
    D -->|否| E[提示额度不足]
    E --> F{是否继续}
    F -->|否| Z[结束]
    F -->|是| G
    D -->|是| G[选择请假时间]
    G --> H[系统计算请假天数]
    H --> I[填写请假原因]
    I --> J{需要证明}
    J -->|是| K[上传证明材料]
    J -->|否| L[提交申请]
    K --> L
    L --> M[进入审批流程]
    M --> N{审批结果}
    N -->|通过| O[更新考勤数据]
    N -->|拒绝| P[通知申请人]
    O --> Q[扣减假期额度]
    Q --> R[通知申请人]
    P --> Z
    R --> Z
```

### 5.2 加班申请流程

```mermaid
flowchart TD
    A[开始] --> B[选择加班类型]
    B --> C[设置加班时间]
    C --> D[系统计算加班时长]
    D --> E[填写加班原因]
    E --> F[选择补偿方式]
    F --> G[提交申请]
    G --> H[主管审批]
    H --> I{审批结果}
    I -->|通过| J[记录加班]
    I -->|拒绝| K[通知申请人]
    J --> L{补偿方式}
    L -->|调休| M[增加调休额度]
    L -->|加班费| N[计入工资]
    M --> O[通知申请人]
    N --> O
    K --> P[结束]
    O --> P
```

### 5.3 补签申请流程

```mermaid
flowchart TD
    A[开始] --> B[选择补签日期]
    B --> C[查询当日打卡记录]
    C --> D[选择补签类型]
    D --> E[填写实际打卡时间]
    E --> F[填写补签原因]
    F --> G{需要证明}
    G -->|是| H[上传证明材料]
    G -->|否| I[提交申请]
    H --> I
    I --> J[主管审批]
    J --> K{审批结果}
    K -->|通过| L[创建补签打卡记录]
    L --> M[重新计算考勤]
    K -->|拒绝| N[通知申请人]
    M --> O[通知申请人]
    N --> P[结束]
    O --> P
```

### 5.4 审批流程

```mermaid
stateDiagram-v2
    [*] --> 待审批: 提交申请
    待审批 --> 一级审批中: 分配审批人
    一级审批中 --> 一级通过: 审批通过
    一级审批中 --> 已拒绝: 审批拒绝
    一级通过 --> 二级审批中: 需要二级审批
    一级通过 --> 已通过: 不需要二级审批
    二级审批中 --> 已通过: 审批通过
    二级审批中 --> 已拒绝: 审批拒绝
    已通过 --> [*]
    已拒绝 --> [*]
    待审批 --> 已撤销: 申请人撤销
    已撤销 --> [*]
```

### 5.5 销假流程

```mermaid
flowchart TD
    A[开始] --> B[选择原请假申请]
    B --> C[查询请假详情]
    C --> D[设置实际销假时间]
    D --> E[系统计算销假时长]
    E --> F[提交销假申请]
    F --> G[审批流程]
    G --> H{审批结果}
    H -->|通过| I[更新请假记录]
    I --> J[恢复假期额度]
    J --> K[更新考勤数据]
    H -->|拒绝| L[通知申请人]
    K --> M[通知申请人]
    L --> N[结束]
    M --> N
```

---

## 6. 考勤数据流程

### 6.1 打卡流程

```mermaid
flowchart TD
    A[开始] --> B[员工发起打卡]
    B --> C{打卡方式}
    C -->|考勤机| D1[刷卡/人脸识别]
    C -->|移动端| D2[GPS定位+人脸]
    C -->|门禁| D3[门禁刷卡]
    D1 --> E[身份验证]
    D2 --> E
    D3 --> E
    E --> F{验证结果}
    F -->|失败| G[提示重试]
    G --> B
    F -->|成功| H{位置验证}
    H -->|无效| I[提示位置异常]
    I --> J[记录异常打卡]
    H -->|有效| K[记录正常打卡]
    J --> L[判定打卡状态]
    K --> L
    L --> M[返回打卡结果]
    M --> N[结束]
```

### 6.2 考勤计算流程

```mermaid
flowchart TD
    A[定时任务触发] --> B[获取待计算员工列表]
    B --> C[循环处理每个员工]
    C --> D[获取员工排班信息]
    D --> E{有排班}
    E -->|否| F[标记为无排班]
    E -->|是| G[获取打卡记录]
    G --> H[获取异常申请]
    H --> I[计算出勤状态]
    I --> J{有请假}
    J -->|是| K[标记为请假]
    J -->|否| L[判定迟到早退]
    K --> M[计算工作时长]
    L --> M
    M --> N[计算加班时长]
    N --> O[生成考勤结果]
    O --> P{触发预警}
    P -->|是| Q[生成预警记录]
    P -->|否| R[保存考勤结果]
    Q --> R
    F --> R
    R --> S{还有员工}
    S -->|是| C
    S -->|否| T[结束]
```

### 6.3 考勤计算时序图

```mermaid
sequenceDiagram
    participant T as 定时任务
    participant CS as 考勤计算服务
    participant SS as 排班服务
    participant RS as 打卡记录服务
    participant ES as 异常申请服务
    participant DB as 数据库
    
    T->>CS: 触发考勤计算
    CS->>DB: 获取待计算员工
    DB-->>CS: 员工列表
    
    loop 每个员工
        CS->>SS: 查询排班信息
        SS-->>CS: 排班数据
        
        CS->>RS: 查询打卡记录
        RS-->>CS: 打卡数据
        
        CS->>ES: 查询异常申请
        ES-->>CS: 异常申请数据
        
        CS->>CS: 执行考勤计算
        CS->>DB: 保存考勤结果
    end
    
    CS-->>T: 计算完成
```

---

## 7. 汇总报表流程

### 7.1 月度汇总流程

```mermaid
flowchart TD
    A[月初定时触发] --> B[获取上月员工列表]
    B --> C[循环处理每个员工]
    C --> D[统计出勤天数]
    D --> E[统计迟到早退次数]
    E --> F[统计旷工天数]
    F --> G[统计请假天数]
    G --> H[统计加班时长]
    H --> I[计算出勤率]
    I --> J[生成汇总记录]
    J --> K{还有员工}
    K -->|是| C
    K -->|否| L[生成部门汇总]
    L --> M[发送报表通知]
    M --> N[结束]
```

### 7.2 报表导出流程

```mermaid
flowchart TD
    A[开始] --> B[选择报表类型]
    B --> C[设置筛选条件]
    C --> D[选择导出格式]
    D --> E[生成报表数据]
    E --> F{数据量检查}
    F -->|超限| G[异步生成]
    F -->|正常| H[同步生成]
    G --> I[发送下载链接]
    H --> J[直接下载]
    I --> K[结束]
    J --> K
```

---

## 8. 系统集成流程

### 8.1 门禁联动流程

```mermaid
sequenceDiagram
    participant D as 门禁设备
    participant DS as 设备通讯服务
    participant AS as 考勤服务
    participant DB as 数据库
    
    D->>DS: 门禁刷卡事件
    DS->>DS: 解析设备数据
    DS->>AS: 推送打卡数据
    AS->>AS: 验证员工身份
    AS->>AS: 判断打卡类型
    AS->>DB: 保存打卡记录
    DB-->>AS: 保存成功
    AS-->>DS: 处理结果
    DS-->>D: 返回响应
```

### 8.2 审批流程集成

```mermaid
sequenceDiagram
    participant U as 用户
    participant AS as 考勤服务
    participant OA as OA服务
    participant DB as 数据库
    
    U->>AS: 提交异常申请
    AS->>DB: 保存申请记录
    AS->>OA: 发起审批流程
    OA-->>AS: 返回流程ID
    AS-->>U: 申请提交成功
    
    Note over OA: 审批人处理
    
    OA->>AS: 回调审批结果
    AS->>DB: 更新申请状态
    AS->>AS: 触发后续处理
    AS-->>U: 通知审批结果
```

---

*本文档持续更新中*

