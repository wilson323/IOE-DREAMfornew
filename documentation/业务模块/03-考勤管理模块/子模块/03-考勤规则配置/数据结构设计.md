# è€ƒå‹¤è§„åˆ™é…ç½® - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_attendance_rule {
        bigint id PK "ä¸»é”®ID"
        varchar rule_name "è§„åˆ™åç§°"
        varchar rule_code UK "è§„åˆ™ç¼–ç "
        varchar rule_type "è§„åˆ™ç±»å‹"
        text description "è§„åˆ™æè¿°"
        json config_json "è§„åˆ™é…ç½®"
        json warning_config "é¢„è­¦é…ç½®"
        json notification_config "é€šçŸ¥é…ç½®"
        json applicable_scope "é€‚ç”¨èŒƒå›´"
        tinyint is_enabled "æ˜¯å¦å¯ç”¨"
        tinyint status "çŠ¶æ€"
    }

    t_attendance_point {
        bigint id PK "ä¸»é”®ID"
        varchar point_name "è€ƒå‹¤ç‚¹åç§°"
        varchar point_code UK "è€ƒå‹¤ç‚¹ç¼–ç "
        decimal longitude "ç»åº¦"
        decimal latitude "çº¬åº¦"
        int radius "æœ‰æ•ˆåŠå¾„"
        bigint device_id FK "è®¾å¤‡ID"
        tinyint status "çŠ¶æ€"
    }

    t_attendance_warning_rule {
        bigint id PK "ä¸»é”®ID"
        varchar rule_name "è§„åˆ™åç§°"
        varchar rule_code UK "è§„åˆ™ç¼–ç "
        varchar rule_type "è§„åˆ™ç±»å‹"
        json device_linkage_config "è®¾å¤‡è”åŠ¨é…ç½®"
        json trigger_conditions "è§¦å‘æ¡ä»¶"
        json handling_rules "å¤„ç†è§„åˆ™"
        tinyint is_enabled "æ˜¯å¦å¯ç”¨"
    }

    t_attendance_notification_rule {
        bigint id PK "ä¸»é”®ID"
        varchar rule_name "è§„åˆ™åç§°"
        varchar rule_code UK "è§„åˆ™ç¼–ç "
        varchar rule_type "è§„åˆ™ç±»å‹"
        json trigger_conditions "è§¦å‘æ¡ä»¶"
        json notification_methods "é€šçŸ¥æ–¹å¼"
        json recipient_config "æ¥æ”¶äººé…ç½®"
        json frequency_control "é¢‘ç‡æ§åˆ¶"
        tinyint is_enabled "æ˜¯å¦å¯ç”¨"
    }

    t_attendance_mobile_config {
        bigint id PK "ä¸»é”®ID"
        varchar config_name "é…ç½®åç§°"
        json location_rules "ä½ç½®è§„åˆ™"
        json accuracy_requirements "ç²¾åº¦è¦æ±‚"
        json time_limits "æ—¶é—´é™åˆ¶"
        json device_binding_rules "è®¾å¤‡ç»‘å®šè§„åˆ™"
        tinyint status "çŠ¶æ€"
    }
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_attendance_rule (è€ƒå‹¤è§„åˆ™è¡¨)

```sql
CREATE TABLE t_attendance_rule (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    rule_name VARCHAR(50) NOT NULL COMMENT 'è§„åˆ™åç§°',
    rule_code VARCHAR(30) NOT NULL COMMENT 'è§„åˆ™ç¼–ç ',
    rule_type VARCHAR(20) NOT NULL COMMENT 'è§„åˆ™ç±»å‹:ATTENDANCE/WARNING/NOTIFICATION',
    description TEXT COMMENT 'è§„åˆ™æè¿°',
    config_json JSON NOT NULL COMMENT 'è§„åˆ™é…ç½®JSON',
    warning_config JSON COMMENT 'é¢„è­¦é…ç½®JSON',
    notification_config JSON COMMENT 'é€šçŸ¥é…ç½®JSON',
    applicable_scope JSON COMMENT 'é€‚ç”¨èŒƒå›´JSON',
    is_enabled TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨:0ç¦ç”¨1å¯ç”¨',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0åˆ é™¤1æ­£å¸¸',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_rule_code (rule_code),
    INDEX idx_rule_type (rule_type),
    INDEX idx_is_enabled (is_enabled)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤è§„åˆ™è¡¨';
```

### t_attendance_point (è€ƒå‹¤ç‚¹è¡¨)

```sql
CREATE TABLE t_attendance_point (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    point_name VARCHAR(50) NOT NULL COMMENT 'è€ƒå‹¤ç‚¹åç§°',
    point_code VARCHAR(30) NOT NULL COMMENT 'è€ƒå‹¤ç‚¹ç¼–ç ',
    longitude DECIMAL(10,7) NOT NULL COMMENT 'ç»åº¦åæ ‡',
    latitude DECIMAL(10,7) NOT NULL COMMENT 'çº¬åº¦åæ ‡',
    radius INT DEFAULT 100 COMMENT 'æœ‰æ•ˆåŠå¾„(ç±³)',
    device_id BIGINT COMMENT 'å…³è”è®¾å¤‡ID',
    address VARCHAR(200) COMMENT 'è¯¦ç»†åœ°å€',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_point_code (point_code),
    INDEX idx_device_id (device_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤ç‚¹è¡¨';
```

---

## ğŸ”§ JSONé…ç½®ç»“æ„

### è€ƒå‹¤è§„åˆ™é…ç½®

```json
{
  "attendance_settings": {
    "late_tolerance_minutes": 10,
    "early_tolerance_minutes": 10,
    "absent_threshold_hours": 4,
    "min_work_hours": 8.0,
    "overtime_calculation_method": "daily",
    "weekend_overtime_multiplier": 2.0,
    "holiday_overtime_multiplier": 3.0
  },
  "work_time_rules": {
    "flexible_start_time": "08:00",
    "flexible_end_time": "20:00",
    "core_start_time": "10:00",
    "core_end_time": "16:00"
  }
}
```

### é¢„è­¦é…ç½®

```json
{
  "warning_types": [
    {
      "type": "late_frequent",
      "threshold": 3,
      "time_range_days": 7,
      "level": "medium",
      "auto_actions": ["notify_employee", "notify_manager"]
    }
  ]
}
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
