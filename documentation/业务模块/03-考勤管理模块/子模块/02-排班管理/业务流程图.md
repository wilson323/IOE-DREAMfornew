# 排班管理 - 业务流程图

> **版本**: v1.0.0  
> **微服务**: ioedream-attendance-service (8091)  
> **创建日期**: 2025-12-17

---

## 📋 核心业务流程

### 1. 排班生成流程

```mermaid
flowchart TD
    A[开始] --> B[选择排班周期]
    B --> C[确定适用员工]
    C --> D{选择排班方式}
    
    D -->|模板排班| E1[选择排班模板]
    D -->|手动排班| E2[手动配置班次]
    D -->|智能排班| E3[配置约束条件]
    
    E1 --> F[应用排班规则]
    E2 --> F
    E3 --> G[执行智能算法]
    G --> F
    
    F --> H[生成排班记录]
    H --> I[冲突检测]
    I --> J{存在冲突}
    J -->|是| K[提示冲突信息]
    K --> L{处理冲突}
    L -->|修改| B
    L -->|忽略| M[保存排班]
    J -->|否| M
    M --> N[结束]
```

### 2. 临时排班流程

```mermaid
flowchart TD
    A[开始] --> B[选择员工和日期]
    B --> C[设置覆盖内容]
    C --> D[指定优先级]
    D --> E[记录覆盖原因]
    E --> F{验证覆盖有效性}
    
    F -->|有效| G[保存临时排班]
    F -->|无效| H[提示错误]
    H --> C
    
    G --> I[更新排班状态]
    I --> J[通知相关方]
    J --> K[结束]
```

### 3. 智能排班流程

```mermaid
flowchart TD
    A[开始] --> B[设定优化目标]
    B --> C[配置约束条件]
    C --> D[选择优化算法]
    D --> E[执行排班计算]
    E --> F[生成候选方案]
    F --> G[评估排班方案]
    G --> H{满足要求}
    H -->|否| I[调整参数]
    I --> E
    H -->|是| J[确认排班方案]
    J --> K[生成最终排班]
    K --> L[结束]
```

---

## 🔄 时序图

### 批量排班时序

```mermaid
sequenceDiagram
    participant U as 管理员
    participant C as Controller
    participant S as ScheduleService
    participant E as ScheduleEngine
    participant D as ScheduleRecordDao

    U->>C: POST /api/schedules/batch
    C->>S: batchCreateSchedule(form)
    S->>S: 验证员工列表
    S->>E: generateSchedules(employees, template)
    
    loop 每个员工
        E->>E: 应用排班模板
        E->>E: 检测时间冲突
    end
    
    E-->>S: 排班结果列表
    S->>D: batchInsert(schedules)
    D-->>S: 插入结果
    S-->>C: 返回批量结果
    C-->>U: 批量排班完成
```

---

## 📊 状态图

### 排班记录状态

```mermaid
stateDiagram-v2
    [*] --> 待生效: 创建排班
    待生效 --> 生效中: 到达排班日期
    生效中 --> 已完成: 排班日期结束
    待生效 --> 已取消: 取消排班
    生效中 --> 已取消: 紧急取消
    待生效 --> 已覆盖: 临时排班覆盖
    已覆盖 --> 生效中: 覆盖生效
    已完成 --> [*]
    已取消 --> [*]
```

---

**📝 文档维护**: IOE-DREAM架构团队 | 2025-12-17
