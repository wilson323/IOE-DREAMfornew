# æ’ç­ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_attendance_schedule_record {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        date schedule_date "æ’ç­æ—¥æœŸ"
        bigint shift_id FK "ç­æ¬¡ID"
        varchar schedule_type "æ’ç­ç±»å‹"
        tinyint is_temporary "æ˜¯å¦ä¸´æ—¶æ’ç­"
        text reason "æ’ç­åŸå› "
        tinyint status "çŠ¶æ€"
        datetime create_time "åˆ›å»ºæ—¶é—´"
        datetime update_time "æ›´æ–°æ—¶é—´"
    }

    t_attendance_schedule_template {
        bigint id PK "ä¸»é”®ID"
        varchar template_name "æ¨¡æ¿åç§°"
        varchar template_type "æ¨¡æ¿ç±»å‹"
        bigint department_id FK "éƒ¨é—¨ID"
        json template_config "æ¨¡æ¿é…ç½®"
        tinyint status "çŠ¶æ€"
        datetime create_time "åˆ›å»ºæ—¶é—´"
        datetime update_time "æ›´æ–°æ—¶é—´"
    }

    t_attendance_schedule_override {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        date schedule_date "æ—¥æœŸ"
        bigint shift_id FK "ç­æ¬¡ID"
        time start_time "å¼€å§‹æ—¶é—´"
        time end_time "ç»“æŸæ—¶é—´"
        varchar source "æ¥æº"
        int priority "ä¼˜å…ˆçº§"
        text reason "åŸå› "
        tinyint status "çŠ¶æ€"
    }

    t_attendance_shift ||--o{ t_attendance_schedule_record : "ç­æ¬¡å…³è”"
    t_attendance_shift ||--o{ t_attendance_schedule_override : "è¦†ç›–ç­æ¬¡"
    t_attendance_schedule_template ||--o{ t_attendance_schedule_record : "æ¨¡æ¿ç”Ÿæˆ"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_attendance_schedule_record (æ’ç­è®°å½•è¡¨)

```sql
CREATE TABLE t_attendance_schedule_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    schedule_date DATE NOT NULL COMMENT 'æ’ç­æ—¥æœŸ',
    shift_id BIGINT NOT NULL COMMENT 'ç­æ¬¡ID',
    schedule_type VARCHAR(20) NOT NULL COMMENT 'æ’ç­ç±»å‹:NORMAL/TEMPORARY/OVERTIME/DUTY',
    is_temporary TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ä¸´æ—¶æ’ç­:0å¦1æ˜¯',
    reason VARCHAR(200) COMMENT 'æ’ç­åŸå› ',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0å–æ¶ˆ1æ­£å¸¸',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    UNIQUE KEY uk_employee_date (employee_id, schedule_date, deleted_flag),
    INDEX idx_schedule_date (schedule_date),
    INDEX idx_shift_id (shift_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ’ç­è®°å½•è¡¨';
```

### t_attendance_schedule_template (æ’ç­æ¨¡æ¿è¡¨)

```sql
CREATE TABLE t_attendance_schedule_template (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    template_name VARCHAR(50) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
    template_type VARCHAR(20) NOT NULL COMMENT 'æ¨¡æ¿ç±»å‹:DEPARTMENT/POSITION/PERSONAL',
    department_id BIGINT COMMENT 'éƒ¨é—¨ID',
    template_config JSON NOT NULL COMMENT 'æ¨¡æ¿é…ç½®JSON',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    INDEX idx_template_type (template_type),
    INDEX idx_department_id (department_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ’ç­æ¨¡æ¿è¡¨';
```

### t_attendance_schedule_override (ä¸´æ—¶æ’ç­è¦†ç›–è¡¨)

```sql
CREATE TABLE t_attendance_schedule_override (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    schedule_date DATE NOT NULL COMMENT 'æ—¥æœŸ',
    shift_id BIGINT COMMENT 'ç­æ¬¡ID',
    start_time TIME COMMENT 'è‡ªå®šä¹‰å¼€å§‹æ—¶é—´',
    end_time TIME COMMENT 'è‡ªå®šä¹‰ç»“æŸæ—¶é—´',
    source VARCHAR(20) DEFAULT 'manual' COMMENT 'æ¥æº:manual/system/api',
    priority INT DEFAULT 0 COMMENT 'ä¼˜å…ˆçº§',
    reason VARCHAR(200) COMMENT 'åŸå› ',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0å–æ¶ˆ1ç”Ÿæ•ˆ',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_employee_date (employee_id, schedule_date),
    INDEX idx_priority (priority DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¸´æ—¶æ’ç­è¦†ç›–è¡¨';
```

---

## ğŸ”§ æ¨¡æ¿é…ç½®JSONç»“æ„

```json
{
  "template_name": "æŠ€æœ¯éƒ¨æ ‡å‡†æ’ç­æ¨¡æ¿",
  "cycle_type": "weekly",
  "cycle_days": 7,
  "schedule_pattern": [
    {
      "day_of_week": 1,
      "shift_id": 101,
      "required_employees": 5
    }
  ],
  "rotation_rules": {
    "auto_rotation": true,
    "rotation_frequency": "weekly"
  },
  "constraints": {
    "max_consecutive_days": 6,
    "min_rest_hours": 12
  }
}
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
