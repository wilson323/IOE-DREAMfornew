# å¼‚å¸¸ç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_attendance_leave_type {
        bigint id PK "ä¸»é”®ID"
        varchar leave_type_code UK "å‡ç§ç¼–ç "
        varchar leave_type_name "å‡ç§åç§°"
        varchar leave_category "å‡ç§åˆ†ç±»"
        decimal max_days_per_year "å¹´åº¦æœ€å¤§å¤©æ•°"
        decimal max_days_per_application "å•æ¬¡æœ€å¤§å¤©æ•°"
        tinyint require_certificate "æ˜¯å¦éœ€è¦è¯æ˜"
        tinyint deduct_salary "æ˜¯å¦æ‰£å·¥èµ„"
        decimal salary_deduction_rate "æ‰£è–ªæ¯”ä¾‹"
        json approval_workflow "å®¡æ‰¹æµç¨‹"
        json applicable_scope "é€‚ç”¨èŒƒå›´"
        tinyint is_enabled "æ˜¯å¦å¯ç”¨"
    }

    t_attendance_exception_application {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        bigint leave_type_id FK "å‡ç§ID"
        varchar application_type "ç”³è¯·ç±»å‹"
        date application_date "ç”³è¯·æ—¥æœŸ"
        date start_date "å¼€å§‹æ—¥æœŸ"
        date end_date "ç»“æŸæ—¥æœŸ"
        time start_time "å¼€å§‹æ—¶é—´"
        time end_time "ç»“æŸæ—¶é—´"
        decimal duration "æ—¶é•¿"
        text reason "ç”³è¯·åŸå› "
        varchar certificate_url "å‡­è¯URL"
        tinyint approval_status "å®¡æ‰¹çŠ¶æ€"
        bigint approver_id FK "å®¡æ‰¹äººID"
        datetime approval_time "å®¡æ‰¹æ—¶é—´"
        text approval_comment "å®¡æ‰¹æ„è§"
    }

    t_attendance_exception_approval {
        bigint id PK "ä¸»é”®ID"
        bigint application_id FK "ç”³è¯·ID"
        bigint approver_id FK "å®¡æ‰¹äººID"
        int approval_level "å®¡æ‰¹çº§åˆ«"
        varchar approval_result "å®¡æ‰¹ç»“æœ"
        text approval_comment "å®¡æ‰¹æ„è§"
        datetime approval_time "å®¡æ‰¹æ—¶é—´"
    }

    t_attendance_leave_type ||--o{ t_attendance_exception_application : "å‡ç§å…³è”"
    t_attendance_exception_application ||--o{ t_attendance_exception_approval : "å®¡æ‰¹è®°å½•"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_attendance_leave_type (å‡ç§é…ç½®è¡¨)

```sql
CREATE TABLE t_attendance_leave_type (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    leave_type_code VARCHAR(30) NOT NULL COMMENT 'å‡ç§ç¼–ç ',
    leave_type_name VARCHAR(50) NOT NULL COMMENT 'å‡ç§åç§°',
    leave_category VARCHAR(20) NOT NULL COMMENT 'å‡ç§åˆ†ç±»:LEGAL/WELFARE/SICK/PERSONAL',
    description TEXT COMMENT 'å‡ç§æè¿°',
    max_days_per_year DECIMAL(5,1) COMMENT 'å¹´åº¦æœ€å¤§å¤©æ•°',
    max_days_per_application DECIMAL(5,1) COMMENT 'å•æ¬¡ç”³è¯·æœ€å¤§å¤©æ•°',
    require_certificate TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦éœ€è¦è¯æ˜:0å¦1æ˜¯',
    certificate_types VARCHAR(200) COMMENT 'è¯æ˜ç±»å‹',
    deduct_salary TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ‰£å·¥èµ„:0å¦1æ˜¯',
    salary_deduction_rate DECIMAL(3,2) DEFAULT 0 COMMENT 'æ‰£è–ªæ¯”ä¾‹',
    approval_workflow JSON COMMENT 'å®¡æ‰¹æµç¨‹é…ç½®',
    applicable_scope JSON COMMENT 'é€‚ç”¨èŒƒå›´',
    is_enabled TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_leave_type_code (leave_type_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‡ç§é…ç½®è¡¨';
```

### t_attendance_exception_application (å¼‚å¸¸ç”³è¯·è¡¨)

```sql
CREATE TABLE t_attendance_exception_application (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    leave_type_id BIGINT COMMENT 'å‡ç§ID',
    application_type VARCHAR(20) NOT NULL COMMENT 'ç”³è¯·ç±»å‹:LEAVE/OVERTIME/SUPPLEMENT/TRANSFER/CANCEL',
    application_date DATE NOT NULL COMMENT 'ç”³è¯·æ—¥æœŸ',
    start_date DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
    start_time TIME COMMENT 'å¼€å§‹æ—¶é—´',
    end_time TIME COMMENT 'ç»“æŸæ—¶é—´',
    duration DECIMAL(5,2) NOT NULL COMMENT 'æ—¶é•¿',
    reason TEXT NOT NULL COMMENT 'ç”³è¯·åŸå› ',
    certificate_url VARCHAR(500) COMMENT 'å‡­è¯æ–‡ä»¶URL',
    approval_status TINYINT DEFAULT 0 COMMENT 'å®¡æ‰¹çŠ¶æ€:0å¾…å®¡æ‰¹1å·²é€šè¿‡2å·²æ‹’ç»3å·²æ’¤é”€',
    approver_id BIGINT COMMENT 'å®¡æ‰¹äººID',
    approval_time DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    approval_comment TEXT COMMENT 'å®¡æ‰¹æ„è§',
    overtime_type VARCHAR(20) COMMENT 'åŠ ç­ç±»å‹',
    original_application_id BIGINT COMMENT 'åŸç”³è¯·ID(é”€å‡ç”¨)',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_employee_id (employee_id),
    INDEX idx_application_type (application_type),
    INDEX idx_approval_status (approval_status),
    INDEX idx_start_date (start_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å¼‚å¸¸ç”³è¯·è¡¨';
```

### t_attendance_exception_approval (å¼‚å¸¸å®¡æ‰¹è¡¨)

```sql
CREATE TABLE t_attendance_exception_approval (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    application_id BIGINT NOT NULL COMMENT 'ç”³è¯·ID',
    approver_id BIGINT NOT NULL COMMENT 'å®¡æ‰¹äººID',
    approval_level INT NOT NULL COMMENT 'å®¡æ‰¹çº§åˆ«',
    approval_result VARCHAR(20) NOT NULL COMMENT 'å®¡æ‰¹ç»“æœ:APPROVED/REJECTED',
    approval_comment TEXT COMMENT 'å®¡æ‰¹æ„è§',
    approval_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'å®¡æ‰¹æ—¶é—´',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_application_id (application_id),
    INDEX idx_approver_id (approver_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å¼‚å¸¸å®¡æ‰¹è¡¨';
```

---

## ğŸ”§ å®¡æ‰¹æµç¨‹JSONé…ç½®

```json
{
  "workflow_name": "ç—…å‡å®¡æ‰¹æµç¨‹",
  "approval_levels": [
    {
      "level": 1,
      "approver_type": "direct_manager",
      "required": true,
      "time_limit_hours": 24,
      "conditions": {
        "max_duration_days": 3
      }
    },
    {
      "level": 2,
      "approver_type": "hr_manager",
      "required": false,
      "conditions": {
        "duration_days_gte": 3
      }
    }
  ]
}
```

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
