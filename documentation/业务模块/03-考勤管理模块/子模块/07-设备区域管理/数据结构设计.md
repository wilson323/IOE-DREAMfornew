# è®¾å¤‡åŒºåŸŸç®¡ç† - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_attendance_device {
        bigint id PK "ä¸»é”®ID"
        varchar device_code UK "è®¾å¤‡ç¼–ç "
        varchar device_name "è®¾å¤‡åç§°"
        varchar device_type "è®¾å¤‡ç±»å‹"
        varchar device_sn "è®¾å¤‡åºåˆ—å·"
        varchar device_ip "è®¾å¤‡IP"
        int device_port "è®¾å¤‡ç«¯å£"
        bigint area_id FK "åŒºåŸŸID"
        varchar protocol_type "åè®®ç±»å‹"
        tinyint online_status "åœ¨çº¿çŠ¶æ€"
        datetime last_heartbeat "æœ€åå¿ƒè·³æ—¶é—´"
        tinyint status "çŠ¶æ€"
    }

    t_attendance_area {
        bigint id PK "ä¸»é”®ID"
        varchar area_code UK "åŒºåŸŸç¼–ç "
        varchar area_name "åŒºåŸŸåç§°"
        bigint parent_id FK "çˆ¶çº§ID"
        int level "å±‚çº§"
        varchar area_path "å±‚çº§è·¯å¾„"
        int sort_order "æ’åº"
        tinyint status "çŠ¶æ€"
    }

    t_attendance_device_area {
        bigint id PK "ä¸»é”®ID"
        bigint device_id FK "è®¾å¤‡ID"
        bigint area_id FK "åŒºåŸŸID"
        tinyint is_primary "æ˜¯å¦ä¸»è¦è®¾å¤‡"
    }

    t_attendance_area ||--o{ t_attendance_area : "çˆ¶å­å…³ç³»"
    t_attendance_area ||--o{ t_attendance_device_area : "åŒºåŸŸè®¾å¤‡"
    t_attendance_device ||--o{ t_attendance_device_area : "è®¾å¤‡åŒºåŸŸ"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_attendance_device (è€ƒå‹¤è®¾å¤‡è¡¨)

```sql
CREATE TABLE t_attendance_device (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    device_code VARCHAR(30) NOT NULL COMMENT 'è®¾å¤‡ç¼–ç ',
    device_name VARCHAR(50) NOT NULL COMMENT 'è®¾å¤‡åç§°',
    device_type VARCHAR(20) NOT NULL COMMENT 'è®¾å¤‡ç±»å‹:ATTENDANCE/ACCESS/FACE/FINGERPRINT',
    device_sn VARCHAR(50) COMMENT 'è®¾å¤‡åºåˆ—å·',
    device_ip VARCHAR(50) COMMENT 'è®¾å¤‡IPåœ°å€',
    device_port INT COMMENT 'è®¾å¤‡ç«¯å£',
    area_id BIGINT COMMENT 'åŒºåŸŸID',
    protocol_type VARCHAR(20) COMMENT 'åè®®ç±»å‹:PUSH/SDK/HTTP',
    manufacturer VARCHAR(50) COMMENT 'å‚å•†',
    model VARCHAR(50) COMMENT 'å‹å·',
    online_status TINYINT DEFAULT 0 COMMENT 'åœ¨çº¿çŠ¶æ€:0ç¦»çº¿1åœ¨çº¿',
    last_heartbeat DATETIME COMMENT 'æœ€åå¿ƒè·³æ—¶é—´',
    last_sync_time DATETIME COMMENT 'æœ€ååŒæ­¥æ—¶é—´',
    remark VARCHAR(200) COMMENT 'å¤‡æ³¨',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    UNIQUE KEY uk_device_code (device_code),
    INDEX idx_area_id (area_id),
    INDEX idx_device_type (device_type),
    INDEX idx_online_status (online_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤è®¾å¤‡è¡¨';
```

### t_attendance_area (è€ƒå‹¤åŒºåŸŸè¡¨)

```sql
CREATE TABLE t_attendance_area (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    area_code VARCHAR(30) NOT NULL COMMENT 'åŒºåŸŸç¼–ç ',
    area_name VARCHAR(50) NOT NULL COMMENT 'åŒºåŸŸåç§°',
    parent_id BIGINT DEFAULT 0 COMMENT 'çˆ¶çº§ID,0è¡¨ç¤ºé¡¶çº§',
    level INT DEFAULT 1 COMMENT 'å±‚çº§',
    area_path VARCHAR(200) COMMENT 'å±‚çº§è·¯å¾„,å¦‚:1/2/3',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    description VARCHAR(200) COMMENT 'æè¿°',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:0ç¦ç”¨1å¯ç”¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',
    UNIQUE KEY uk_area_code (area_code),
    INDEX idx_parent_id (parent_id),
    INDEX idx_area_path (area_path)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤åŒºåŸŸè¡¨';
```

### t_attendance_device_area (è®¾å¤‡åŒºåŸŸå…³è”è¡¨)

```sql
CREATE TABLE t_attendance_device_area (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    device_id BIGINT NOT NULL COMMENT 'è®¾å¤‡ID',
    area_id BIGINT NOT NULL COMMENT 'åŒºåŸŸID',
    is_primary TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ä¸»è¦è®¾å¤‡:0å¦1æ˜¯',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    UNIQUE KEY uk_device_area (device_id, area_id),
    INDEX idx_area_id (area_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¾å¤‡åŒºåŸŸå…³è”è¡¨';
```

---

## ğŸ”§ è®¾å¤‡ç±»å‹æšä¸¾

| ç±»å‹ç  | åç§° | è¯´æ˜ |
|--------|------|------|
| ATTENDANCE | è€ƒå‹¤æœº | ä¸“ç”¨è€ƒå‹¤è®¾å¤‡ |
| ACCESS | é—¨ç¦è®¾å¤‡ | é—¨ç¦ä¸€ä½“æœº |
| FACE | äººè„¸ç»ˆç«¯ | äººè„¸è¯†åˆ«ç»ˆç«¯ |
| FINGERPRINT | æŒ‡çº¹æœº | æŒ‡çº¹è¯†åˆ«è®¾å¤‡ |
| CARD | åˆ·å¡æœº | IC/IDå¡è¯»å¡å™¨ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
