# è€ƒå‹¤æ•°æ®é‡‡é›†ä¸è®¡ç®— - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_attendance_clock_record {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        datetime clock_time "æ‰“å¡æ—¶é—´"
        varchar clock_type "æ‰“å¡ç±»å‹"
        varchar clock_source "æ‰“å¡æ¥æº"
        bigint device_id FK "è®¾å¤‡ID"
        bigint point_id FK "è€ƒå‹¤ç‚¹ID"
        decimal longitude "ç»åº¦"
        decimal latitude "çº¬åº¦"
        varchar photo_url "ç…§ç‰‡URL"
        varchar ip_address "IPåœ°å€"
        varchar device_info "è®¾å¤‡ä¿¡æ¯"
        tinyint is_valid "æ˜¯å¦æœ‰æ•ˆ"
        varchar invalid_reason "æ— æ•ˆåŸå› "
    }

    t_attendance_result {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        date attendance_date "è€ƒå‹¤æ—¥æœŸ"
        bigint shift_id FK "ç­æ¬¡ID"
        datetime plan_clock_in "åº”ç­¾åˆ°æ—¶é—´"
        datetime plan_clock_out "åº”ç­¾é€€æ—¶é—´"
        datetime actual_clock_in "å®é™…ç­¾åˆ°æ—¶é—´"
        datetime actual_clock_out "å®é™…ç­¾é€€æ—¶é—´"
        varchar attendance_status "è€ƒå‹¤çŠ¶æ€"
        int late_minutes "è¿Ÿåˆ°åˆ†é’Ÿæ•°"
        int early_leave_minutes "æ—©é€€åˆ†é’Ÿæ•°"
        decimal work_hours "å·¥ä½œæ—¶é•¿"
        decimal overtime_hours "åŠ ç­æ—¶é•¿"
        varchar remark "å¤‡æ³¨"
    }

    t_attendance_clock_record }o--|| t_attendance_result : "ç”Ÿæˆç»“æœ"
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_attendance_clock_record (æ‰“å¡è®°å½•è¡¨)

```sql
CREATE TABLE t_attendance_clock_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    clock_time DATETIME NOT NULL COMMENT 'æ‰“å¡æ—¶é—´',
    clock_type VARCHAR(20) NOT NULL COMMENT 'æ‰“å¡ç±»å‹:CLOCK_IN/CLOCK_OUT/GO_OUT/COME_BACK',
    clock_source VARCHAR(20) NOT NULL COMMENT 'æ‰“å¡æ¥æº:DEVICE/MOBILE/WEB/MANUAL',
    device_id BIGINT COMMENT 'è®¾å¤‡ID',
    point_id BIGINT COMMENT 'è€ƒå‹¤ç‚¹ID',
    longitude DECIMAL(10,7) COMMENT 'ç»åº¦',
    latitude DECIMAL(10,7) COMMENT 'çº¬åº¦',
    location_accuracy INT COMMENT 'å®šä½ç²¾åº¦(ç±³)',
    photo_url VARCHAR(500) COMMENT 'æ‰“å¡ç…§ç‰‡URL',
    ip_address VARCHAR(50) COMMENT 'IPåœ°å€',
    device_info VARCHAR(200) COMMENT 'è®¾å¤‡ä¿¡æ¯',
    is_valid TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦æœ‰æ•ˆ:0æ— æ•ˆ1æœ‰æ•ˆ',
    invalid_reason VARCHAR(100) COMMENT 'æ— æ•ˆåŸå› ',
    raw_data JSON COMMENT 'åŸå§‹æ•°æ®',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_employee_time (employee_id, clock_time),
    INDEX idx_clock_time (clock_time),
    INDEX idx_device_id (device_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰“å¡è®°å½•è¡¨';
```

### t_attendance_result (è€ƒå‹¤ç»“æœè¡¨)

```sql
CREATE TABLE t_attendance_result (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    attendance_date DATE NOT NULL COMMENT 'è€ƒå‹¤æ—¥æœŸ',
    shift_id BIGINT COMMENT 'ç­æ¬¡ID',
    schedule_id BIGINT COMMENT 'æ’ç­ID',
    plan_clock_in DATETIME COMMENT 'åº”ç­¾åˆ°æ—¶é—´',
    plan_clock_out DATETIME COMMENT 'åº”ç­¾é€€æ—¶é—´',
    actual_clock_in DATETIME COMMENT 'å®é™…ç­¾åˆ°æ—¶é—´',
    actual_clock_out DATETIME COMMENT 'å®é™…ç­¾é€€æ—¶é—´',
    clock_in_record_id BIGINT COMMENT 'ç­¾åˆ°è®°å½•ID',
    clock_out_record_id BIGINT COMMENT 'ç­¾é€€è®°å½•ID',
    attendance_status VARCHAR(20) NOT NULL COMMENT 'è€ƒå‹¤çŠ¶æ€:NORMAL/LATE/EARLY_LEAVE/ABSENT/LEAVE/OVERTIME',
    late_minutes INT DEFAULT 0 COMMENT 'è¿Ÿåˆ°åˆ†é’Ÿæ•°',
    early_leave_minutes INT DEFAULT 0 COMMENT 'æ—©é€€åˆ†é’Ÿæ•°',
    absent_hours DECIMAL(4,2) DEFAULT 0 COMMENT 'ç¼ºå‹¤å°æ—¶æ•°',
    work_hours DECIMAL(4,2) DEFAULT 0 COMMENT 'å·¥ä½œæ—¶é•¿',
    overtime_hours DECIMAL(4,2) DEFAULT 0 COMMENT 'åŠ ç­æ—¶é•¿',
    leave_hours DECIMAL(4,2) DEFAULT 0 COMMENT 'è¯·å‡æ—¶é•¿',
    exception_type VARCHAR(50) COMMENT 'å¼‚å¸¸ç±»å‹',
    exception_reason VARCHAR(200) COMMENT 'å¼‚å¸¸åŸå› ',
    is_calculated TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²è®¡ç®—',
    calculate_time DATETIME COMMENT 'è®¡ç®—æ—¶é—´',
    remark VARCHAR(200) COMMENT 'å¤‡æ³¨',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_employee_date (employee_id, attendance_date),
    INDEX idx_attendance_date (attendance_date),
    INDEX idx_attendance_status (attendance_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤ç»“æœè¡¨';
```

---

## ğŸ”§ è€ƒå‹¤çŠ¶æ€æšä¸¾

| çŠ¶æ€ç  | åç§° | è¯´æ˜ |
|--------|------|------|
| NORMAL | æ­£å¸¸ | æ­£å¸¸å‡ºå‹¤ |
| LATE | è¿Ÿåˆ° | ä¸Šç­è¿Ÿåˆ° |
| EARLY_LEAVE | æ—©é€€ | ä¸‹ç­æ—©é€€ |
| LATE_EARLY | è¿Ÿåˆ°æ—©é€€ | åŒæ—¶è¿Ÿåˆ°å’Œæ—©é€€ |
| ABSENT | æ—·å·¥ | æ— æ•…ç¼ºå‹¤ |
| LEAVE | è¯·å‡ | å·²æ‰¹å‡†è¯·å‡ |
| OVERTIME | åŠ ç­ | åŠ ç­å‡ºå‹¤ |
| BUSINESS_TRIP | å‡ºå·® | å¤–å‡ºå‡ºå·® |
| REST | ä¼‘æ¯ | ä¼‘æ¯æ—¥/èŠ‚å‡æ—¥ |
| NO_SCHEDULE | æ— æ’ç­ | å½“æ—¥æ— æ’ç­ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
