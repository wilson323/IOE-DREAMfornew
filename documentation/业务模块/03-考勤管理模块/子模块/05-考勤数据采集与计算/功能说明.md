# 考勤数据采集与计算 - 功能说明

> **版本**: v1.0.0  
> **微服务**: ioedream-attendance-service (8091)  
> **创建日期**: 2025-12-17

---

## 📋 功能概述

考勤数据采集与计算模块负责采集员工的打卡记录数据，并根据排班和考勤规则进行考勤结果计算，生成每日考勤结果和统计数据。

---

## 🎯 核心功能

### 1. 打卡记录采集

- **设备打卡**: 接收考勤机、门禁设备的打卡数据
- **移动打卡**: 接收移动端APP的打卡数据
- **位置验证**: GPS定位验证打卡位置有效性
- **照片采集**: 支持拍照打卡，存储打卡照片

### 2. 打卡记录管理

- **记录查询**: 按员工、日期、设备等条件查询
- **记录修正**: 管理员手工修正异常记录
- **原始数据**: 保留原始打卡数据用于追溯
- **数据去重**: 自动处理重复打卡记录

### 3. 考勤结果计算

- **自动计算**: 根据排班和规则自动计算考勤结果
- **迟到判定**: 计算迟到时长和迟到类型
- **早退判定**: 计算早退时长和早退类型
- **旷工判定**: 判定缺勤和旷工情况
- **加班计算**: 计算加班时长和加班类型

### 4. 工时统计

- **有效工时**: 计算有效工作时长
- **加班工时**: 计算各类加班时长
- **出勤天数**: 统计出勤天数和缺勤天数
- **异常统计**: 统计迟到、早退、旷工次数

### 5. 考勤异常处理

- **异常检测**: 自动检测考勤异常情况
- **异常标记**: 标记异常记录便于处理
- **异常通知**: 发送异常通知给相关人员
- **异常申诉**: 支持员工提交异常申诉

---

## 📊 打卡类型

| 打卡类型 | 代码 | 说明 |
|----------|------|------|
| 签到 | CLOCK_IN | 上班打卡 |
| 签退 | CLOCK_OUT | 下班打卡 |
| 外出 | GO_OUT | 外出打卡 |
| 返回 | COME_BACK | 返回打卡 |
| 加班开始 | OT_START | 加班开始打卡 |
| 加班结束 | OT_END | 加班结束打卡 |

---

## 🔧 考勤结果类型

| 结果类型 | 代码 | 说明 |
|----------|------|------|
| 正常 | NORMAL | 正常出勤 |
| 迟到 | LATE | 迟到 |
| 早退 | EARLY_LEAVE | 早退 |
| 旷工 | ABSENT | 旷工 |
| 请假 | LEAVE | 请假 |
| 加班 | OVERTIME | 加班 |
| 出差 | BUSINESS_TRIP | 出差 |
| 休息 | REST | 休息日 |

---

## 📈 计算规则

### 迟到判定规则

```
迟到时长 = 实际签到时间 - 应签到时间
迟到类型:
  - 轻微迟到: 0 < 迟到时长 ≤ 10分钟
  - 一般迟到: 10分钟 < 迟到时长 ≤ 30分钟
  - 严重迟到: 迟到时长 > 30分钟
```

### 工时计算规则

```
有效工时 = 签退时间 - 签到时间 - 休息时长 - 异常时长
加班工时 = 实际下班时间 - 应下班时间 (需审批)
```

---

## 📈 性能指标

| 指标项 | 要求 |
|--------|------|
| 打卡记录写入 | ≤ 100ms |
| 考勤计算延迟 | ≤ 5分钟 |
| 批量计算吞吐 | ≥ 10000人/分钟 |
| 记录查询响应 | ≤ 500ms |

---

**📝 文档维护**: IOE-DREAM架构团队 | 2025-12-17
