# è€ƒå‹¤æ±‡æ€»æŠ¥è¡¨ - æ•°æ®ç»“æ„è®¾è®¡

> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“Š ERå›¾

```mermaid
erDiagram
    t_attendance_monthly_summary {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        int year "å¹´ä»½"
        int month "æœˆä»½"
        int should_work_days "åº”å‡ºå‹¤å¤©æ•°"
        int actual_work_days "å®é™…å‡ºå‹¤å¤©æ•°"
        int late_count "è¿Ÿåˆ°æ¬¡æ•°"
        int early_leave_count "æ—©é€€æ¬¡æ•°"
        int absent_days "æ—·å·¥å¤©æ•°"
        decimal leave_days "è¯·å‡å¤©æ•°"
        decimal overtime_hours "åŠ ç­æ—¶é•¿"
        decimal work_hours "å·¥ä½œæ—¶é•¿"
        decimal attendance_rate "å‡ºå‹¤ç‡"
    }

    t_attendance_warning_record {
        bigint id PK "ä¸»é”®ID"
        bigint employee_id FK "å‘˜å·¥ID"
        varchar warning_type "é¢„è­¦ç±»å‹"
        varchar warning_level "é¢„è­¦çº§åˆ«"
        text warning_content "é¢„è­¦å†…å®¹"
        datetime warning_time "é¢„è­¦æ—¶é—´"
        tinyint is_handled "æ˜¯å¦å¤„ç†"
        bigint handler_id FK "å¤„ç†äººID"
        datetime handle_time "å¤„ç†æ—¶é—´"
    }
```

---

## ğŸ“‹ è¡¨ç»“æ„è¯¦ç»†è®¾è®¡

### t_attendance_monthly_summary (æœˆåº¦è€ƒå‹¤æ±‡æ€»è¡¨)

```sql
CREATE TABLE t_attendance_monthly_summary (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    department_id BIGINT COMMENT 'éƒ¨é—¨ID',
    year INT NOT NULL COMMENT 'å¹´ä»½',
    month INT NOT NULL COMMENT 'æœˆä»½',
    should_work_days INT DEFAULT 0 COMMENT 'åº”å‡ºå‹¤å¤©æ•°',
    actual_work_days INT DEFAULT 0 COMMENT 'å®é™…å‡ºå‹¤å¤©æ•°',
    late_count INT DEFAULT 0 COMMENT 'è¿Ÿåˆ°æ¬¡æ•°',
    late_minutes INT DEFAULT 0 COMMENT 'è¿Ÿåˆ°æ€»åˆ†é’Ÿæ•°',
    early_leave_count INT DEFAULT 0 COMMENT 'æ—©é€€æ¬¡æ•°',
    early_leave_minutes INT DEFAULT 0 COMMENT 'æ—©é€€æ€»åˆ†é’Ÿæ•°',
    absent_days INT DEFAULT 0 COMMENT 'æ—·å·¥å¤©æ•°',
    leave_days DECIMAL(5,2) DEFAULT 0 COMMENT 'è¯·å‡å¤©æ•°',
    sick_leave_days DECIMAL(5,2) DEFAULT 0 COMMENT 'ç—…å‡å¤©æ•°',
    personal_leave_days DECIMAL(5,2) DEFAULT 0 COMMENT 'äº‹å‡å¤©æ•°',
    annual_leave_days DECIMAL(5,2) DEFAULT 0 COMMENT 'å¹´å‡å¤©æ•°',
    overtime_hours DECIMAL(6,2) DEFAULT 0 COMMENT 'åŠ ç­æ—¶é•¿',
    weekend_overtime_hours DECIMAL(6,2) DEFAULT 0 COMMENT 'å‘¨æœ«åŠ ç­æ—¶é•¿',
    holiday_overtime_hours DECIMAL(6,2) DEFAULT 0 COMMENT 'èŠ‚å‡æ—¥åŠ ç­æ—¶é•¿',
    work_hours DECIMAL(6,2) DEFAULT 0 COMMENT 'æ€»å·¥ä½œæ—¶é•¿',
    attendance_rate DECIMAL(5,2) DEFAULT 0 COMMENT 'å‡ºå‹¤ç‡(%)',
    calculate_time DATETIME COMMENT 'è®¡ç®—æ—¶é—´',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    UNIQUE KEY uk_employee_month (employee_id, year, month),
    INDEX idx_department_month (department_id, year, month),
    INDEX idx_year_month (year, month)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æœˆåº¦è€ƒå‹¤æ±‡æ€»è¡¨';
```

### t_attendance_warning_record (è€ƒå‹¤é¢„è­¦è®°å½•è¡¨)

```sql
CREATE TABLE t_attendance_warning_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    employee_id BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    department_id BIGINT COMMENT 'éƒ¨é—¨ID',
    warning_type VARCHAR(30) NOT NULL COMMENT 'é¢„è­¦ç±»å‹:LATE_FREQUENT/ABSENT_CONTINUOUS/ABNORMAL',
    warning_level VARCHAR(10) NOT NULL COMMENT 'é¢„è­¦çº§åˆ«:LOW/MEDIUM/HIGH',
    warning_content TEXT NOT NULL COMMENT 'é¢„è­¦å†…å®¹',
    warning_time DATETIME NOT NULL COMMENT 'é¢„è­¦æ—¶é—´',
    trigger_rule_id BIGINT COMMENT 'è§¦å‘è§„åˆ™ID',
    related_data JSON COMMENT 'ç›¸å…³æ•°æ®',
    is_handled TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²å¤„ç†:0æœªå¤„ç†1å·²å¤„ç†',
    handler_id BIGINT COMMENT 'å¤„ç†äººID',
    handle_time DATETIME COMMENT 'å¤„ç†æ—¶é—´',
    handle_comment TEXT COMMENT 'å¤„ç†æ„è§',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_employee_id (employee_id),
    INDEX idx_warning_type (warning_type),
    INDEX idx_warning_level (warning_level),
    INDEX idx_is_handled (is_handled)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤é¢„è­¦è®°å½•è¡¨';
```

---

## ğŸ”§ é¢„è­¦ç±»å‹æšä¸¾

| ç±»å‹ç  | åç§° | è¯´æ˜ |
|--------|------|------|
| LATE_FREQUENT | é¢‘ç¹è¿Ÿåˆ° | 7å¤©å†…è¿Ÿåˆ°â‰¥3æ¬¡ |
| ABSENT_CONTINUOUS | è¿ç»­ç¼ºå‹¤ | è¿ç»­ç¼ºå‹¤â‰¥2å¤© |
| NO_CLOCK | æœªæ‰“å¡ | å½“æ—¥æœªæ‰“å¡ |
| OVERTIME_EXCESS | åŠ ç­è¶…é™ | æœˆåŠ ç­è¶…36å°æ—¶ |
| ABNORMAL_PATTERN | å¼‚å¸¸æ¨¡å¼ | å¼‚å¸¸è€ƒå‹¤æ¨¡å¼ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
