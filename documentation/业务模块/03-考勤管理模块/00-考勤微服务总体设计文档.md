# è€ƒå‹¤ç®¡ç†å¾®æœåŠ¡ - æ€»ä½“è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v1.0.0  
> **å¾®æœåŠ¡**: ioedream-attendance-service (8091)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-17

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

è€ƒå‹¤ç®¡ç†å¾®æœåŠ¡è´Ÿè´£ä¼ä¸šå‘˜å·¥è€ƒå‹¤çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬ç­æ¬¡é…ç½®ã€æ’ç­ç®¡ç†ã€æ‰“å¡é‡‡é›†ã€è€ƒå‹¤è®¡ç®—ã€å¼‚å¸¸å¤„ç†å’ŒæŠ¥è¡¨ç»Ÿè®¡ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph æ¥å…¥å±‚
        API[REST API]
        WS[WebSocket]
        MQ[RabbitMQ]
    end
    
    subgraph ä¸šåŠ¡å±‚
        SHIFT[ç­æ¬¡ç®¡ç†]
        SCHED[æ’ç­ç®¡ç†]
        RULE[è§„åˆ™é…ç½®]
        CLOCK[æ‰“å¡é‡‡é›†]
        CALC[è€ƒå‹¤è®¡ç®—]
        EXCEPT[å¼‚å¸¸å¤„ç†]
        REPORT[æŠ¥è¡¨ç»Ÿè®¡]
    end
    
    subgraph æ•°æ®å±‚
        MySQL[(MySQL)]
        Redis[(Redis)]
        ES[(Elasticsearch)]
    end
    
    API --> SHIFT
    API --> SCHED
    API --> RULE
    MQ --> CLOCK
    CLOCK --> CALC
    CALC --> EXCEPT
    CALC --> REPORT
    
    SHIFT --> MySQL
    SCHED --> MySQL
    CLOCK --> MySQL
    CLOCK --> Redis
    REPORT --> ES
```

---

## ğŸ“ ä»£ç ç»“æ„

```
ioedream-attendance-service/src/main/java/net/lab1024/sa/attendance/
â”œâ”€â”€ AttendanceApplication.java              # å¯åŠ¨ç±»
â”œâ”€â”€ controller/                             # Controllerå±‚
â”‚   â”œâ”€â”€ ShiftController.java               # ç­æ¬¡ç®¡ç†
â”‚   â”œâ”€â”€ ScheduleController.java            # æ’ç­ç®¡ç†
â”‚   â”œâ”€â”€ AttendanceRuleController.java      # è§„åˆ™é…ç½®
â”‚   â”œâ”€â”€ ClockRecordController.java         # æ‰“å¡è®°å½•
â”‚   â”œâ”€â”€ AttendanceExceptionController.java # å¼‚å¸¸ç®¡ç†
â”‚   â””â”€â”€ AttendanceReportController.java    # æŠ¥è¡¨ç»Ÿè®¡
â”œâ”€â”€ service/                                # Serviceå±‚
â”‚   â”œâ”€â”€ ShiftService.java
â”‚   â”œâ”€â”€ ScheduleService.java
â”‚   â”œâ”€â”€ AttendanceRuleService.java
â”‚   â”œâ”€â”€ ClockRecordService.java
â”‚   â”œâ”€â”€ AttendanceCalculateService.java
â”‚   â”œâ”€â”€ AttendanceExceptionService.java
â”‚   â””â”€â”€ AttendanceReportService.java
â”œâ”€â”€ dao/                                    # DAOå±‚
â”‚   â”œâ”€â”€ ShiftDao.java
â”‚   â”œâ”€â”€ ScheduleDao.java
â”‚   â”œâ”€â”€ AttendanceRuleDao.java
â”‚   â”œâ”€â”€ ClockRecordDao.java
â”‚   â””â”€â”€ AttendanceExceptionDao.java
â”œâ”€â”€ domain/                                 # é¢†åŸŸå¯¹è±¡
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ form/
â”‚   â””â”€â”€ vo/
â””â”€â”€ manager/                                # Managerå±‚
    â”œâ”€â”€ AttendanceCalculateManager.java
    â””â”€â”€ AttendanceStatisticsManager.java
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç­æ¬¡æ—¶é—´ç®¡ç†
- ç­æ¬¡å®šä¹‰ï¼ˆæ—©ç­ã€ä¸­ç­ã€æ™šç­ã€å¼¹æ€§ç­ï¼‰
- å·¥ä½œæ—¶é—´æ®µé…ç½®
- ä¼‘æ¯æ—¶é—´é…ç½®
- æ‰“å¡æ—¶é—´çª—å£è®¾ç½®

### 2. æ’ç­ç®¡ç†
- å›ºå®šæ’ç­
- è½®ç­æ’ç­
- å¼¹æ€§æ’ç­
- è°ƒç­ç”³è¯·

### 3. è€ƒå‹¤è§„åˆ™é…ç½®
- è¿Ÿåˆ°æ—©é€€è§„åˆ™
- åŠ ç­è§„åˆ™
- è¯·å‡è§„åˆ™
- å¤–å‹¤è§„åˆ™

### 4. è€ƒå‹¤æ•°æ®é‡‡é›†
- è®¾å¤‡æ‰“å¡é‡‡é›†
- é—¨ç¦é€šè¡Œé‡‡é›†
- ç§»åŠ¨ç«¯æ‰“å¡
- å¤–å‹¤æ‰“å¡ï¼ˆGPSï¼‰

### 5. å¼‚å¸¸ç®¡ç†
- ç¼ºå¡å¼‚å¸¸
- è¿Ÿåˆ°æ—©é€€
- æ—·å·¥å¤„ç†
- è¡¥å¡ç”³è¯·

### 6. è€ƒå‹¤æ±‡æ€»æŠ¥è¡¨
- æ—¥æŠ¥è¡¨
- æœˆæŠ¥è¡¨
- éƒ¨é—¨ç»Ÿè®¡
- å¯¼å‡ºåŠŸèƒ½

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ |
|------|------|
| t_attendance_shift | ç­æ¬¡å®šä¹‰è¡¨ |
| t_attendance_schedule | æ’ç­è®°å½•è¡¨ |
| t_attendance_rule | è€ƒå‹¤è§„åˆ™è¡¨ |
| t_attendance_clock_record | æ‰“å¡è®°å½•è¡¨ |
| t_attendance_daily_result | æ—¥è€ƒå‹¤ç»“æœè¡¨ |
| t_attendance_exception | è€ƒå‹¤å¼‚å¸¸è¡¨ |
| t_attendance_leave | è¯·å‡è®°å½•è¡¨ |
| t_attendance_overtime | åŠ ç­è®°å½•è¡¨ |

### ERå›¾

```mermaid
erDiagram
    t_attendance_shift {
        bigint id PK
        varchar shift_name
        time work_start_time
        time work_end_time
        time break_start_time
        time break_end_time
        int early_clock_minutes
        int late_clock_minutes
    }
    
    t_attendance_schedule {
        bigint id PK
        bigint employee_id FK
        bigint shift_id FK
        date schedule_date
        tinyint status
    }
    
    t_attendance_clock_record {
        bigint id PK
        bigint employee_id FK
        bigint device_id FK
        datetime clock_time
        varchar clock_type
        varchar source
        varchar location
    }
    
    t_attendance_daily_result {
        bigint id PK
        bigint employee_id FK
        date attendance_date
        tinyint status
        int work_minutes
        int late_minutes
        int early_minutes
        int overtime_minutes
    }
    
    t_attendance_shift ||--o{ t_attendance_schedule : "ç­æ¬¡"
    t_attendance_schedule ||--o{ t_attendance_daily_result : "æ’ç­"
    t_attendance_clock_record ||--o{ t_attendance_daily_result : "æ‰“å¡"
```

---

## ğŸ”§ APIæ¥å£è®¾è®¡

### ç­æ¬¡ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/attendance/v1/shift/list | ç­æ¬¡åˆ—è¡¨ |
| POST | /api/attendance/v1/shift/add | æ–°å¢ç­æ¬¡ |
| PUT | /api/attendance/v1/shift/update | æ›´æ–°ç­æ¬¡ |
| DELETE | /api/attendance/v1/shift/{id} | åˆ é™¤ç­æ¬¡ |

### æ’ç­ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/attendance/v1/schedule/query | æŸ¥è¯¢æ’ç­ |
| POST | /api/attendance/v1/schedule/batch | æ‰¹é‡æ’ç­ |
| PUT | /api/attendance/v1/schedule/adjust | è°ƒæ•´æ’ç­ |

### æ‰“å¡è®°å½•

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/attendance/v1/clock/receive | æ¥æ”¶æ‰“å¡ |
| POST | /api/attendance/v1/clock/mobile | ç§»åŠ¨æ‰“å¡ |
| GET | /api/attendance/v1/clock/records | æ‰“å¡è®°å½• |

### è€ƒå‹¤æŠ¥è¡¨

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/attendance/v1/report/daily | æ—¥æŠ¥è¡¨ |
| GET | /api/attendance/v1/report/monthly | æœˆæŠ¥è¡¨ |
| POST | /api/attendance/v1/report/export | å¯¼å‡ºæŠ¥è¡¨ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡é¡¹ | è¦æ±‚ |
|--------|------|
| æ‰“å¡å¤„ç†å»¶è¿Ÿ | â‰¤ 500ms |
| æ—¥æŠ¥è¡¨ç”Ÿæˆ | â‰¤ 5s |
| æœˆæŠ¥è¡¨ç”Ÿæˆ | â‰¤ 30s |
| å¹¶å‘æ‰“å¡æ”¯æŒ | â‰¥ 1000æ¬¡/ç§’ |
| æ•°æ®ä¿å­˜å‘¨æœŸ | â‰¥ 3å¹´ |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ | 2025-12-17
