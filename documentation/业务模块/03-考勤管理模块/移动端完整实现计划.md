# è€ƒå‹¤æ¨¡å—ç§»åŠ¨ç«¯å®Œæ•´å®ç°è®¡åˆ’

> **ç‰ˆæœ¬**: v1.0.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-24
> **ç›®æ ‡**: åŸºäºä¸šåŠ¡æ–‡æ¡£å®Œæ•´å®ç°è€ƒå‹¤æ¨¡å—ç§»åŠ¨ç«¯å…¨éƒ¨åŠŸèƒ½ï¼Œç¡®ä¿å…¨å±€ä¸€è‡´æ€§

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### 1. ç§»åŠ¨ç«¯å·²å®ç°åŠŸèƒ½

#### âœ… å·²æœ‰é¡µé¢ï¼ˆ3ä¸ªï¼‰
```
smart-app/src/pages/attendance/
â”œâ”€â”€ index.vue          # ä¸»é¡µ - ä»Šæ—¥è€ƒå‹¤æ‰“å¡ã€å¿«é€Ÿæ“ä½œèœå•
â”œâ”€â”€ analytics.vue      # æ™ºèƒ½åˆ†æ - è€ƒå‹¤ç»Ÿè®¡å›¾è¡¨ã€å¼‚å¸¸æé†’ã€è€ƒå‹¤è¯„åˆ†
â””â”€â”€ smart-schedule.vue # æ™ºèƒ½æ’ç­ - æ’ç­æ—¥å†ã€å¿«é€Ÿæ’ç­ã€å†²çªæ£€æµ‹
```

#### âœ… å·²å®ç°åŠŸèƒ½æ¸…å•

| åŠŸèƒ½æ¨¡å— | é¡µé¢ | å®ç°åº¦ | è¯´æ˜ |
|---------|------|--------|------|
| **æ‰“å¡ç­¾åˆ°** | index.vue | 70% | ä¸Šä¸‹ç­æ‰“å¡ã€ä½ç½®éªŒè¯ã€ä»Šæ—¥çŠ¶æ€ |
| **æ‰“å¡è®°å½•** | index.vue | 60% | æœ€è¿‘7å¤©è®°å½•åˆ—è¡¨å±•ç¤º |
| **æ™ºèƒ½åˆ†æ** | analytics.vue | 80% | è¶‹åŠ¿å›¾è¡¨ã€å¼‚å¸¸æé†’ã€è€ƒå‹¤è¯„åˆ† |
| **æ™ºèƒ½æ’ç­** | smart-schedule.vue | 75% | æ’ç­æ—¥å†ã€å¿«é€Ÿæ’ç­ã€å†²çªæ£€æµ‹ã€AIå»ºè®® |

---

## âŒ æœªå®ç°åŠŸèƒ½æ¸…å•

### 1. æ‰“å¡è®°å½•é¡µé¢ï¼ˆrecords.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ å®Œæ•´æ‰“å¡è®°å½•åˆ—è¡¨ï¼ˆæ—¥æœŸèŒƒå›´ç­›é€‰ï¼‰
- âŒ æ‰“å¡è¯¦æƒ…æŸ¥çœ‹ï¼ˆä½ç½®ã€ç…§ç‰‡ã€è®¾å¤‡ä¿¡æ¯ï¼‰
- âŒ å¼‚å¸¸è®°å½•æ ‡è®°å’Œè¯´æ˜
- âŒ æ‰“å¡è®°å½•å¯¼å‡ºåŠŸèƒ½

#### åç«¯APIå·²å°±ç»ª
```javascript
// smart-app/src/api/business/attendance/attendance-api.js å·²å®šä¹‰
getPunchRecords: (params) => getRequest('/api/attendance/mobile/punch/records', params)
```

---

### 2. è¯·å‡ç”³è¯·é¡µé¢ï¼ˆleave.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ å‡ç§é€‰æ‹©ï¼ˆå¹´å‡ã€äº‹å‡ã€ç—…å‡ç­‰ï¼‰
- âŒ æ—¶é—´èŒƒå›´é€‰æ‹©ï¼ˆå¼€å§‹/ç»“æŸæ—¶é—´ï¼‰
- âŒ è¯·å‡æ—¶é•¿è‡ªåŠ¨è®¡ç®—
- âŒ è¯·å‡åŸå› å¡«å†™
- âŒ è¯æ˜ææ–™ä¸Šä¼ 
- âŒ å‰©ä½™å‡æœŸé¢åº¦æ˜¾ç¤º
- âŒ è¯·å‡è®°å½•æŸ¥è¯¢
- âŒ ç”³è¯·çŠ¶æ€è·Ÿè¸ª

#### åç«¯APIå·²å°±ç»ª
```javascript
leaveApi: {
  applyLeave: (data) => postRequest('/api/attendance/mobile/leave/apply', data),
  getLeaveRecords: (params) => getRequest('/api/attendance/mobile/leave/records', params),
  cancelLeave: (leaveId, employeeId) => postRequest(`/api/attendance/mobile/leave/cancel/${leaveId}`, { employeeId })
}
```

---

### 3. åŠ ç­ç”³è¯·é¡µé¢ï¼ˆovertime.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ åŠ ç­ç±»å‹é€‰æ‹©ï¼ˆå¹³æ—¶/å‘¨æœ«/èŠ‚å‡æ—¥ï¼‰
- âŒ åŠ ç­æ—¶é—´é€‰æ‹©
- âŒ åŠ ç­æ—¶é•¿è®¡ç®—
- âŒ åŠ ç­åŸå› å¡«å†™
- âŒ è¯æ˜ææ–™ä¸Šä¼ 
- âŒ è¡¥å¿æ–¹å¼é€‰æ‹©ï¼ˆè°ƒä¼‘/åŠ ç­è´¹ï¼‰
- âŒ åŠ ç­è®°å½•æŸ¥è¯¢
- âŒ ç”³è¯·çŠ¶æ€è·Ÿè¸ª

#### åç«¯APIå·²å°±ç»ª
```javascript
overtimeApi: {
  applyOvertime: (data) => postRequest('/api/attendance/mobile/overtime/apply', data),
  getOvertimeRecords: (params) => getRequest('/api/attendance/mobile/overtime/records', params)
}
```

---

### 4. è¡¥å¡ç”³è¯·é¡µé¢ï¼ˆrepair.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ è¡¥å¡ç±»å‹é€‰æ‹©ï¼ˆä¸Šç­/ä¸‹ç­/å¤–å‡ºï¼‰
- âŒ è¡¥å¡æ—¶é—´é€‰æ‹©
- âŒ è¡¥å¡åŸå› å¡«å†™
- âŒ è¯æ˜ææ–™ä¸Šä¼ 
- âŒ å®¡æ‰¹æµç¨‹
- âŒ è¡¥å¡è®°å½•æŸ¥è¯¢
- âŒ ç”³è¯·çŠ¶æ€è·Ÿè¸ª

#### åç«¯APIå·²å°±ç»ª
```javascript
supplementApi: {
  applySupplement: (data) => postRequest('/api/attendance/mobile/supplement/apply', data),
  getSupplementRecords: (params) => getRequest('/api/attendance/mobile/supplement/records', params)
}
```

---

### 5. å‡ºå·®ç”³è¯·é¡µé¢ï¼ˆtrip.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ å‡ºå·®ç±»å‹é€‰æ‹©
- âŒ å‡ºå·®æ—¶é—´é€‰æ‹©
- âŒ ç›®çš„åœ°ä¿¡æ¯
- âŒ å‡ºå·®äº‹ç”±å¡«å†™
- âŒ å®¡æ‰¹æµç¨‹
- âŒ å‡ºå·®è®°å½•æŸ¥è¯¢
- âŒ ç”³è¯·çŠ¶æ€è·Ÿè¸ª

#### åç«¯APIå·²å°±ç»ª
```javascript
travelApi: {
  applyTravel: (data) => postRequest('/api/attendance/mobile/travel/apply', data),
  getTravelRecords: (params) => getRequest('/api/attendance/mobile/travel/records', params)
}
```

---

### 6. è€ƒå‹¤ç»Ÿè®¡é¡µé¢ï¼ˆstatistics.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ æœˆåº¦è€ƒå‹¤æ±‡æ€»ï¼ˆåº”å‡ºå‹¤ã€å®å‡ºå‹¤ã€å¼‚å¸¸ç»Ÿè®¡ï¼‰
- âŒ è€ƒå‹¤æ˜ç»†æŸ¥è¯¢ï¼ˆæ¯æ—¥çŠ¶æ€ã€å¼‚å¸¸è®°å½•ï¼‰
- âŒ å‡ºå‹¤ç‡ç»Ÿè®¡å›¾è¡¨
- âŒ è€ƒå‹¤å¼‚å¸¸åˆ†æï¼ˆè¿Ÿåˆ°ã€æ—©é€€ã€æ—·å·¥è¶‹åŠ¿ï¼‰
- âŒ åŠ ç­æ—¶é•¿ç»Ÿè®¡
- âŒ ç»Ÿè®¡æŠ¥è¡¨å¯¼å‡º

#### åç«¯APIå·²å°±ç»ª
```javascript
statisticsApi: {
  getPersonalStatistics: (params) => getRequest('/api/attendance/mobile/statistics/personal', params),
  getMonthlySummary: (params) => getRequest('/api/attendance/mobile/statistics/monthly', params),
  getAbnormalRecords: (params) => getRequest('/api/attendance/mobile/statistics/abnormal', params)
}
```

---

### 7. æ’ç­æŸ¥çœ‹é¡µé¢ï¼ˆschedule.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ æˆ‘çš„æ’ç­æ—¥å†å±•ç¤º
- âŒ ä»Šæ—¥æ’ç­è¯¦æƒ…
- âŒ æœ¬å‘¨æ’ç­æŸ¥çœ‹
- âŒ æ’ç­å˜æ›´æé†’
- âŒ æ’ç­å†²çªæç¤º

#### åç«¯APIå·²å°±ç»ª
```javascript
scheduleApi: {
  getPersonalSchedule: (params) => getRequest('/api/attendance/mobile/schedule/personal', params),
  getTodaySchedule: (employeeId) => getRequest('/api/attendance/mobile/schedule/today', { employeeId }),
  getWeekSchedule: (employeeId) => getRequest('/api/attendance/mobile/schedule/week', { employeeId })
}
```

---

### 8. è€ƒå‹¤æ±‡æ€»é¡µé¢ï¼ˆsummary.vueï¼‰

#### ç¼ºå¤±åŠŸèƒ½
- âŒ å¹´åº¦è€ƒå‹¤æ±‡æ€»
- âŒ å­£åº¦è€ƒå‹¤æ±‡æ€»
- âŒ è¶‹åŠ¿åˆ†æå›¾è¡¨
- âŒ å¯¹æ¯”åˆ†æ
- âŒ æ±‡æ€»æ•°æ®å¯¼å‡º

---

### 9. æ¶ˆæ¯é€šçŸ¥é¡µé¢

#### ç¼ºå¤±åŠŸèƒ½
- âŒ æ‰“å¡æé†’é€šçŸ¥
- âŒ å®¡æ‰¹ç»“æœé€šçŸ¥
- âŒ å¼‚å¸¸é¢„è­¦é€šçŸ¥
- âŒ æ’ç­å˜æ›´é€šçŸ¥
- âŒ ç³»ç»Ÿå…¬å‘Šé€šçŸ¥
- âŒ é€šçŸ¥å†å²æŸ¥è¯¢

---

## ğŸ“‹ è¯¦ç»†å¼€å‘è®¡åˆ’

### Phase 1: æ ¸å¿ƒæ‰“å¡åŠŸèƒ½å®Œå–„ï¼ˆWeek 1-2ï¼‰

#### 1.1 å®Œå–„ä¸»é¡µæ‰“å¡åŠŸèƒ½ï¼ˆindex.vueï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¼˜åŒ–GPSå®šä½ç²¾åº¦å’ŒéªŒè¯é€»è¾‘
- [ ] å¢åŠ WiFiæ‰“å¡æ”¯æŒ
- [ ] å¢åŠ äººè„¸è¯†åˆ«æ‰“å¡æ”¯æŒ
- [ ] å¢åŠ è“ç‰™æ‰“å¡æ”¯æŒ
- [ ] ä¼˜åŒ–æ‰“å¡å“åº”é€Ÿåº¦ï¼ˆç›®æ ‡<2ç§’ï¼‰
- [ ] å¢åŠ æ‰“å¡æ‹ç…§åŠŸèƒ½
- [ ] å¢åŠ ç¦»çº¿æ‰“å¡ç¼“å­˜æœºåˆ¶
- [ ] å¢åŠ æ‰“å¡å¤±è´¥é‡è¯•æœºåˆ¶

**å¼€å‘è¦ç‚¹**:
```javascript
// GPSå®šä½éªŒè¯ä¼˜åŒ–
const validateLocation = async () => {
  try {
    const res = await attendanceApi.locationApi.validateLocation({
      employeeId: employeeId.value,
      latitude: currentPosition.latitude,
      longitude: currentPosition.longitude,
      accuracy: currentPosition.accuracy  // å¢åŠ ç²¾åº¦å‚æ•°
    })
    // ...å¤„ç†é€»è¾‘
  } catch (error) {
    // å¢åŠ é‡è¯•æœºåˆ¶
    if (retryCount < 3) {
      retryCount++
      setTimeout(() => validateLocation(), 1000)
    }
  }
}
```

#### 1.2 å®ç°æ‰“å¡è®°å½•é¡µé¢ï¼ˆrecords.vueï¼‰

**é¡µé¢ç»“æ„**:
```vue
<template>
  <view class="records-page">
    <!-- ç­›é€‰åŒº -->
    <view class="filter-section">
      <date-range-selector @change="handleDateRangeChange" />
      <status-filter @change="handleStatusFilter" />
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="records-list">
      <view class="record-item" v-for="record in records" :key="record.id">
        <view class="record-header">
          <text class="record-date">{{ formatDate(record.punchTime) }}</text>
          <text class="record-status" :class="record.status">{{ record.statusText }}</text>
        </view>
        <view class="record-body">
          <text class="record-type">{{ record.punchType === 'IN' ? 'ä¸Šç­' : 'ä¸‹ç­' }}</text>
          <text class="record-time">{{ formatTime(record.punchTime) }}</text>
          <text class="record-location">{{ record.location }}</text>
        </view>
        <view class="record-footer" v-if="record.hasException">
          <text class="exception-tag">{{ record.exceptionType }}</text>
        </view>
      </view>
    </view>

    <!-- åˆ†é¡µ -->
    <view class="pagination">
      <pagination :current="pageNum" :total="total" @change="handlePageChange" />
    </view>
  </view>
</template>
```

**APIé›†æˆ**:
```javascript
const loadRecords = async () => {
  try {
    loading.value = true
    const res = await attendanceApi.punchApi.getPunchRecords({
      employeeId: employeeId.value,
      startDate: dateRange.value.start,
      endDate: dateRange.value.end,
      pageSize: pageSize.value,
      pageNum: pageNum.value
    })

    if (res.success) {
      records.value = res.data.list || []
      total.value = res.data.total || 0
    }
  } catch (error) {
    console.error('åŠ è½½æ‰“å¡è®°å½•å¤±è´¥:', error)
    uni.showToast({ title: 'åŠ è½½å¤±è´¥', icon: 'none' })
  } finally {
    loading.value = false
  }
}
```

---

### Phase 2: å¼‚å¸¸ç”³è¯·åŠŸèƒ½ï¼ˆWeek 3-4ï¼‰

#### 2.1 å®ç°è¯·å‡ç”³è¯·é¡µé¢ï¼ˆleave.vueï¼‰

**é¡µé¢ç»“æ„**:
```vue
<template>
  <view class="leave-page">
    <!-- å‡ç§é€‰æ‹© -->
    <view class="form-item">
      <text class="label">è¯·å‡ç±»å‹</text>
      <picker :range="leaveTypes" @change="handleLeaveTypeChange">
        <view class="picker">
          <text>{{ selectedLeaveType || 'è¯·é€‰æ‹©è¯·å‡ç±»å‹' }}</text>
          <text class="arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- æ—¶é—´é€‰æ‹© -->
    <view class="form-item">
      <text class="label">è¯·å‡æ—¶é—´</text>
      <view class="time-range">
        <datetime-picker v-model="startTime" @change="handleStartTimeChange">
          <text>{{ formatStartTime }}</text>
        </datetime-picker>
        <text>è‡³</text>
        <datetime-picker v-model="endTime" @change="handleEndTimeChange">
          <text>{{ formatEndTime }}</text>
        </datetime-picker>
      </view>
    </view>

    <!-- æ—¶é•¿æ˜¾ç¤º -->
    <view class="form-item">
      <text class="label">è¯·å‡æ—¶é•¿</text>
      <text class="duration">{{ calculatedDuration }}å¤©</text>
    </view>

    <!-- å‰©ä½™é¢åº¦ -->
    <view class="form-item">
      <text class="label">å‰©ä½™é¢åº¦</text>
      <text class="quota">{{ remainingQuota }}å¤©</text>
    </view>

    <!-- è¯·å‡åŸå›  -->
    <view class="form-item">
      <text class="label">è¯·å‡åŸå› </text>
      <textarea v-model="reason" placeholder="è¯·å¡«å†™è¯·å‡åŸå› " />
    </view>

    <!-- è¯æ˜ä¸Šä¼  -->
    <view class="form-item">
      <text class="label">è¯æ˜ææ–™</text>
      <image-uploader
        :file-list="proofFiles"
        @upload="handleProofUpload"
        @delete="handleProofDelete"
      />
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <button class="submit-btn" @click="handleSubmit">æäº¤ç”³è¯·</button>
  </view>
</template>
```

**æ ¸å¿ƒé€»è¾‘**:
```javascript
// æ—¶é•¿è‡ªåŠ¨è®¡ç®—
const calculatedDuration = computed(() => {
  if (startTime.value && endTime.value) {
    const start = dayjs(startTime.value)
    const end = dayjs(end.value.value)
    return end.diff(start, 'day')
  }
  return 0
})

// å‰©ä½™é¢åº¦æ˜¾ç¤º
const remainingQuota = ref(0)
const loadLeaveQuota = async () => {
  try {
    const res = await attendanceApi.leaveApi.getLeaveQuota({
      employeeId: employeeId.value,
      leaveType: selectedLeaveType.value
    })
    if (res.success) {
      remainingQuota.value = res.data.quota || 0
    }
  } catch (error) {
    console.error('è·å–å‡æœŸé¢åº¦å¤±è´¥:', error)
  }
}

// æäº¤ç”³è¯·
const handleSubmit = async () => {
  try {
    uni.showLoading({ title: 'æäº¤ä¸­...' })

    const res = await attendanceApi.leaveApi.applyLeave({
      employeeId: employeeId.value,
      leaveType: selectedLeaveType.value,
      startTime: startTime.value,
      endTime: endTime.value,
      reason: reason.value,
      proofFiles: proofFiles.value
    })

    uni.hideLoading()

    if (res.success) {
      uni.showToast({ title: 'ç”³è¯·æäº¤æˆåŠŸ', icon: 'success' })
      // è¿”å›ä¸Šä¸€é¡µæˆ–è·³è½¬åˆ°ç”³è¯·è®°å½•é¡µ
      setTimeout(() => {
        uni.navigateBack()
      }, 1500)
    }
  } catch (error) {
    uni.hideLoading()
    uni.showToast({ title: 'æäº¤å¤±è´¥', icon: 'none' })
  }
}
```

#### 2.2 å®ç°åŠ ç­ç”³è¯·é¡µé¢ï¼ˆovertime.vueï¼‰
#### 2.3 å®ç°è¡¥å¡ç”³è¯·é¡µé¢ï¼ˆrepair.vueï¼‰
#### 2.4 å®ç°å‡ºå·®ç”³è¯·é¡µé¢ï¼ˆtrip.vueï¼‰

**å‚è€ƒè¯·å‡ç”³è¯·çš„é¡µé¢ç»“æ„å’Œé€»è¾‘ï¼Œè°ƒæ•´ç›¸åº”çš„å­—æ®µå’ŒéªŒè¯è§„åˆ™ã€‚**

---

### Phase 3: è€ƒå‹¤ç»Ÿè®¡åŠŸèƒ½ï¼ˆWeek 5-6ï¼‰

#### 3.1 å®ç°è€ƒå‹¤ç»Ÿè®¡é¡µé¢ï¼ˆstatistics.vueï¼‰

**é¡µé¢ç»“æ„**:
```vue
<template>
  <view class="statistics-page">
    <!-- æœˆä»½é€‰æ‹© -->
    <view class="month-selector">
      <picker mode="date" fields="month" :value="selectedMonth" @change="handleMonthChange">
        <view class="picker-display">
          <text>{{ selectedMonthText }}</text>
          <text class="arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="overview-cards">
      <view class="card">
        <text class="value">{{ monthStats.workDays }}</text>
        <text class="label">åº”å‡ºå‹¤</text>
      </view>
      <view class="card">
        <text class="value">{{ monthStats.attendanceDays }}</text>
        <text class="label">å®é™…å‡ºå‹¤</text>
      </view>
      <view class="card">
        <text class="value">{{ monthStats.lateDays }}</text>
        <text class="label">è¿Ÿåˆ°</text>
      </view>
      <view class="card">
        <text class="value">{{ monthStats.earlyDays }}</text>
        <text class="label">æ—©é€€</text>
      </view>
    </view>

    <!-- å‡ºå‹¤ç‡å›¾è¡¨ -->
    <view class="chart-section">
      <view class="chart-title">å‡ºå‹¤ç‡è¶‹åŠ¿</view>
      <qiun-data-charts
        type="line"
        :chartData="attendanceRateData"
        :opts="chartOpts"
      />
    </view>

    <!-- å¼‚å¸¸è®°å½• -->
    <view class="abnormal-section">
      <view class="section-title">å¼‚å¸¸è®°å½•</view>
      <view class="abnormal-list">
        <view
          class="abnormal-item"
          v-for="item in abnormalRecords"
          :key="item.id"
          @click="viewAbnormalDetail(item)"
        >
          <view class="abnormal-date">{{ item.date }}</view>
          <view class="abnormal-type">{{ item.type }}</view>
          <view class="abnormal-reason">{{ item.reason }}</view>
        </view>
      </view>
    </view>

    <!-- å¯¼å‡ºæŒ‰é’® -->
    <view class="actions">
      <button class="export-btn" @click="handleExport">å¯¼å‡ºç»Ÿè®¡æŠ¥è¡¨</button>
    </view>
  </view>
</template>
```

**æ ¸å¿ƒé€»è¾‘**:
```javascript
// åŠ è½½æœˆåº¦ç»Ÿè®¡æ•°æ®
const loadMonthStats = async () => {
  try {
    loading.value = true
    const res = await attendanceApi.statisticsApi.getMonthlySummary({
      employeeId: employeeId.value,
      month: selectedMonth.value
    })

    if (res.success) {
      Object.assign(monthStats, res.data)
    }
  } catch (error) {
    console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

// åŠ è½½å¼‚å¸¸è®°å½•
const loadAbnormalRecords = async () => {
  try {
    const res = await attendanceApi.statisticsApi.getAbnormalRecords({
      employeeId: employeeId.value,
      startDate: monthStart.value,
      endDate: monthEnd.value
    })

    if (res.success) {
      abnormalRecords.value = res.data || []
    }
  } catch (error) {
    console.error('åŠ è½½å¼‚å¸¸è®°å½•å¤±è´¥:', error)
  }
}
```

#### 3.2 å®ç°è€ƒå‹¤æ±‡æ€»é¡µé¢ï¼ˆsummary.vueï¼‰

---

### Phase 4: æ’ç­åŠŸèƒ½å®Œå–„ï¼ˆWeek 7ï¼‰

#### 4.1 å®ç°æ’ç­æŸ¥çœ‹é¡µé¢ï¼ˆschedule.vueï¼‰

**é¡µé¢ç»“æ„**:
```vue
<template>
  <view class="schedule-page">
    <!-- å‘¨é€‰æ‹©å™¨ -->
    <view class="week-selector">
      <button @click="prevWeek">â€¹</button>
      <text class="week-text">{{ weekRangeText }}</text>
      <button @click="nextWeek">â€º</button>
    </view>

    <!-- æ’ç­æ—¥å† -->
    <view class="schedule-calendar">
      <view class="calendar-weekdays">
        <text v-for="day in weekDays" :key="day">{{ day }}</text>
      </view>
      <view class="calendar-days">
        <view
          v-for="day in weekDays"
          :key="day.date"
          :class="['day-item', { 'has-shift': day.shift }]"
        >
          <text class="day-number">{{ day.day }}</text>
          <text v-if="day.shift" class="shift-name">{{ day.shift }}</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥æ’ç­è¯¦æƒ… -->
    <view class="today-detail" v-if="todaySchedule">
      <view class="detail-title">ä»Šæ—¥æ’ç­</view>
      <view class="detail-content">
        <text class="shift-name">{{ todaySchedule.shiftName }}</text>
        <text class="time-range">{{ todaySchedule.workTime }}</text>
        <text class="location">{{ todaySchedule.location }}</text>
      </view>
    </view>
  </view>
</template>
```

---

### Phase 5: æ¶ˆæ¯é€šçŸ¥åŠŸèƒ½ï¼ˆWeek 8ï¼‰

#### 5.1 å®ç°æ¶ˆæ¯é€šçŸ¥é¡µé¢

**åŠŸèƒ½**:
- æ‰“å¡æé†’é€šçŸ¥
- å®¡æ‰¹ç»“æœé€šçŸ¥
- å¼‚å¸¸é¢„è­¦é€šçŸ¥
- æ’ç­å˜æ›´é€šçŸ¥
- ç³»ç»Ÿå…¬å‘Š

**æŠ€æœ¯æ–¹æ¡ˆ**:
- ä½¿ç”¨uni.pushæ¶ˆæ¯æ¨é€
- æœ¬åœ°é€šçŸ¥å†å²è®°å½•
- é€šçŸ¥æƒé™ç®¡ç†

---

## ğŸ“ å¼€å‘è§„èŒƒ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

```
smart-app/src/pages/attendance/
â”œâ”€â”€ index.vue                 # ä¸»é¡µï¼ˆå·²æœ‰ï¼Œéœ€å®Œå–„ï¼‰
â”œâ”€â”€ records.vue              # æ‰“å¡è®°å½•ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ statistics.vue           # è€ƒå‹¤ç»Ÿè®¡ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ schedule.vue             # æ’ç­æŸ¥çœ‹ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ leave.vue                # è¯·å‡ç”³è¯·ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ overtime.vue            # åŠ ç­ç”³è¯·ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ repair.vue               # è¡¥å¡ç”³è¯·ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ trip.vue                 # å‡ºå·®ç”³è¯·ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ summary.vue              # è€ƒå‹¤æ±‡æ€»ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ notification.vue          # æ¶ˆæ¯é€šçŸ¥ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ components/              # å…¬å…±ç»„ä»¶ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ CalendarSelector.vue
â”‚   â”œâ”€â”€ DatePicker.vue
â”‚   â”œâ”€â”€ FileUploader.vue
â”‚   â””â”€â”€ Pagination.vue
â””â”€â”€ mixins/                  # æ··å…¥ï¼ˆæ–°å¢ï¼‰
    â””â”€â”€ attendance-mixin.js
```

### 2. ä»£ç è§„èŒƒ

#### 2.1 Vue 3 Composition APIè§„èŒƒ

```vue
<script setup>
import { ref, computed, onMounted } from 'vue'
import { useUserStore } from '@/store/modules/system/user.js'
import attendanceApi from '@/api/business/attendance/attendance-api'

// å“åº”å¼æ•°æ®å®šä¹‰ï¼ˆæ”¾åœ¨é¡¶éƒ¨ï¼‰
const loading = ref(false)
const formData = ref({})
const listData = ref([])

// è®¡ç®—å±æ€§
const filteredList = computed(() => {
  return listData.value.filter(item => item.status === 1)
})

// æ–¹æ³•å®šä¹‰
const loadData = async () => {
  // ...
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadData()
})
</script>
```

#### 2.2 APIè°ƒç”¨è§„èŒƒ

```javascript
// âœ… æ­£ç¡®çš„APIè°ƒç”¨
const loadData = async () => {
  try {
    loading.value = true
    const res = await attendanceApi.xxxApi.getData(params)

    if (res.success) {
      // å¤„ç†æˆåŠŸæ•°æ®
      data.value = res.data
    } else {
      // å¤„ç†ä¸šåŠ¡é”™è¯¯
      uni.showToast({ title: res.message || 'æ“ä½œå¤±è´¥', icon: 'none' })
    }
  } catch (error) {
    // å¤„ç†ç³»ç»Ÿé”™è¯¯
    console.error('æ“ä½œå¤±è´¥:', error)
    uni.showToast({ title: 'ç³»ç»Ÿé”™è¯¯', icon: 'none' })
  } finally {
    loading.value = false
  }
}

// âŒ é”™è¯¯çš„APIè°ƒç”¨ï¼ˆç¼ºå°‘é”™è¯¯å¤„ç†ï¼‰
const loadData = async () => {
  const res = await attendanceApi.xxxApi.getData(params)
  data.value = res.data  // å¯èƒ½ä¸ºnull
}
```

#### 2.3 æ ·å¼è§„èŒƒ

```scss
// ä½¿ç”¨rpxå•ä½ç¡®ä¿å“åº”å¼
.page-container {
  padding: 32rpx;

  .section-title {
    font-size: 32rpx;
    font-weight: 600;
    color: #333;
    margin-bottom: 24rpx;
  }

  .form-item {
    margin-bottom: 32rpx;

    .label {
      font-size: 28rpx;
      color: #666;
      margin-bottom: 16rpx;
    }
  }
}

// ä½¿ç”¨uni-appæ”¯æŒçš„CSSå±æ€§
.button {
  border-radius: 8rpx;  // âœ… æ­£ç¡®
  // border-radius: 8px;   // âŒ é”™è¯¯ï¼Œåº”ä½¿ç”¨rpx
}
```

### 3. ç»„ä»¶åŒ–å¼€å‘

#### 3.1 å…¬å…±ç»„ä»¶æŠ½å–

**æ—¥æœŸé€‰æ‹©å™¨ç»„ä»¶** (`components/DatePicker.vue`):
```vue
<template>
  <picker mode="date" :value="modelValue" @change="handleChange">
    <slot>
      <view class="date-picker">
        <text>{{ displayText }}</text>
        <text class="icon">ğŸ“…</text>
      </view>
    </slot>
  </picker>
</template>

<script setup>
import { computed } from 'vue'

const props = defineProps({
  modelValue: String,
  format: {
    type: String,
    default: 'YYYY-MM-DD'
  }
})

const emit = defineEmits(['update:modelValue', 'change'])

const displayText = computed(() => {
  return props.modelValue || 'è¯·é€‰æ‹©æ—¥æœŸ'
})

const handleChange = (e) => {
  emit('update:modelValue', e.detail.value)
  emit('change', e.detail.value)
}
</script>
```

**æ–‡ä»¶ä¸Šä¼ ç»„ä»¶** (`components/FileUploader.vue`):
```vue
<template>
  <view class="file-uploader">
    <view class="file-list">
      <view
        class="file-item"
        v-for="(file, index) in fileList"
        :key="index"
      >
        <image :src="file.url" class="preview" mode="aspectFill" />
        <view class="delete-btn" @click="handleDelete(index)">Ã—</view>
      </view>
    </view>
    <button class="upload-btn" @click="handleUpload">
      <text class="icon">+</text>
      <text>ä¸Šä¼ æ–‡ä»¶</text>
    </button>
  </view>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps({
  fileList: {
    type: Array,
    default: () => []
  },
  maxSize: {
    type: Number,
    default: 10 * 1024 * 1024 // 10MB
  },
  maxCount: {
    type: Number,
    default: 9
  }
})

const emit = defineEmits(['upload', 'delete'])

const handleUpload = () => {
  uni.chooseImage({
    count: props.maxCount - props.fileList.length,
    success: (res) => {
      emit('upload', res.tempFilePaths)
    }
  })
}

const handleDelete = (index) => {
  emit('delete', index)
}
</script>
```

#### 3.2 ä¸šåŠ¡é€»è¾‘æ··å…¥

```javascript
// mixins/attendance-mixin.js
import { ref } from 'vue'
import { useUserStore } from '@/store/modules/system/user.js'

export function useAttendance() {
  const userStore = useUserStore()
  const employeeId = ref(userStore.userId)

  // åŠ è½½ä»Šæ—¥çŠ¶æ€
  const loadTodayStatus = async () => {
    // ...
  }

  // ä½ç½®éªŒè¯
  const validateLocation = async (latitude, longitude) => {
    // ...
  }

  return {
    employeeId,
    loadTodayStatus,
    validateLocation
  }
}
```

**ä½¿ç”¨æ–¹å¼**:
```vue
<script setup>
import { useAttendance } from '@/pages/attendance/mixins/attendance-mixin'

const { employeeId, loadTodayStatus, validateLocation } = useAttendance()

onMounted(() => {
  loadTodayStatus()
})
</script>
```

### 4. æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

#### 4.1 æ•°æ®ç¼“å­˜ç­–ç•¥

```javascript
// ä½¿ç”¨uni.setStorageSyncç¼“å­˜æ•°æ®
const cacheKey = `attendance_records_${employeeId.value}_${date}`

// å…ˆè¯»å–ç¼“å­˜
const cachedData = uni.getStorageSync(cacheKey)
if (cachedData) {
  records.value = cachedData
}

// è¯·æ±‚æœ€æ–°æ•°æ®
const freshData = await loadRecords()

// æ›´æ–°ç¼“å­˜
uni.setStorageSync(cacheKey, freshData)

// è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆ1å°æ—¶ï¼‰
const expireTime = Date.now() + 3600000
uni.setStorageSync(`${cacheKey}_expire`, expireTime)
```

#### 4.2 åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–

```vue
<template>
  <!-- ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨æˆ–åˆ†é¡µåŠ è½½ -->
  <scroll-view
    scroll-y
    @scrolltolower="loadMore"
    class="record-list"
  >
    <view
      v-for="item in displayedRecords"
      :key="item.id"
      class="record-item"
    >
      <!-- æ¸²æŸ“å†…å®¹ -->
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view v-if="hasMore" class="load-more">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </scroll-view>
</template>

<script setup>
const displayedRecords = ref([])  // åªæ¸²æŸ“å¯è§æ•°æ®
const currentPage = ref(1)
const pageSize = 20
const hasMore = ref(true)

const loadMore = async () => {
  if (!hasMore.value) return

  currentPage.value++
  const newData = await loadRecords(currentPage.value)

  if (newData.length < pageSize) {
    hasMore.value = false
  }

  displayedRecords.value.push(...newData)
}
</script>
```

#### 4.3 å›¾ç‰‡æ‡’åŠ è½½

```vue
<template>
  <image
    :src="imageUrl"
    lazy-load
    mode="aspectFill"
    @error="handleImageError"
  />
</template>

<script setup>
const handleImageError = (e) => {
  e.target.src = '/static/images/placeholder.png'
}
</script>
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æƒé™æ§åˆ¶

```javascript
// æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºä¸åŒåŠŸèƒ½
const userRole = computed(() => userStore.role)

const quickActions = computed(() => {
  const allActions = [
    { key: 'clock', title: 'æ‰“å¡', roles: ['employee', 'manager', 'hr', 'admin'] },
    { key: 'schedule', title: 'æ’ç­', roles: ['manager', 'hr', 'admin'] },
    { key: 'report', title: 'æŠ¥è¡¨', roles: ['manager', 'hr', 'admin'] }
  ]

  return allActions.filter(action => action.roles.includes(userRole.value))
})
```

### 2. å¼‚å¸¸å¤„ç†

```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
const handleError = (error, defaultMessage = 'æ“ä½œå¤±è´¥') => {
  console.error(defaultMessage, error)

  let message = defaultMessage
  if (error.code) {
    message = getErrorMessage(error.code)
  } else if (error.message) {
    message = error.message
  }

  uni.showToast({
    title: message,
    icon: 'none',
    duration: 3000
  })
}

const getErrorMessage = (code) => {
  const errorMessages = {
    'NETWORK_ERROR': 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ',
    'TIMEOUT': 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•',
    'UNAUTHORIZED': 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
    'FORBIDDEN': 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ'
  }
  return errorMessages[code] || 'ç³»ç»Ÿé”™è¯¯'
}
```

### 3. æ•°æ®éªŒè¯

```javascript
// è¡¨å•éªŒè¯
const validateForm = () => {
  if (!formData.value.leaveType) {
    uni.showToast({ title: 'è¯·é€‰æ‹©è¯·å‡ç±»å‹', icon: 'none' })
    return false
  }

  if (!formData.value.startTime || !formData.value.endTime) {
    uni.showToast({ title: 'è¯·é€‰æ‹©è¯·å‡æ—¶é—´', icon: 'none' })
    return false
  }

  if (!formData.value.reason) {
    uni.showToast({ title: 'è¯·å¡«å†™è¯·å‡åŸå› ', icon: 'none' })
    return false
  }

  return true
}

// æ—¶é—´èŒƒå›´éªŒè¯
const validateTimeRange = () => {
  const start = dayjs(formData.value.startTime)
  const end = dayjs(formData.value.endTime)

  if (end.isBefore(start)) {
    uni.showToast({ title: 'ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´', icon: 'none' })
    return false
  }

  // è¯·å‡ä¸èƒ½è¶…è¿‡1å¹´
  if (end.diff(start, 'day') > 365) {
    uni.showToast({ title: 'è¯·å‡æ—¶é—´ä¸èƒ½è¶…è¿‡1å¹´', icon: 'none' })
    return false
  }

  return true
}
```

### 4. å…¼å®¹æ€§å¤„ç†

```javascript
// å¹³å°å·®å¼‚åŒ–å¤„ç†
const chooseImage = () => {
  // #ifdef H5
  uni.chooseImage({
    count: 1,
    sourceType: ['album', 'camera'],
    success: (res) => {
      // H5å¹³å°é€»è¾‘
    }
  })
  // #endif

  // #ifdef MP-WEIXIN
  uni.chooseImage({
    count: 1,
    sizeType: ['original', 'compressed'],
    sourceType: ['album', 'camera'],
    success: (res) => {
      // å¾®ä¿¡å°ç¨‹åºå¹³å°é€»è¾‘
    }
  })
  // #endif
}
```

### 5. çŠ¶æ€ç®¡ç†

```javascript
// store/modules/attendance.js
import { defineStore } from 'pinia'

export const useAttendanceStore = defineStore('attendance', {
  state: () => ({
    todayStatus: null,
    recentRecords: [],
    statistics: {}
  }),

  getters: {
    hasPunchedIn: (state) => {
      return !!state.todayStatus?.morningPunch
    },
    hasPunchedOut: (state) => {
      return !!state.todayStatus?.eveningPunch
    }
  },

  actions: {
    async loadTodayStatus({ commit }) {
      const res = await attendanceApi.punchApi.getTodayPunchStatus(employeeId)
      if (res.success) {
        commit('SET_TODAY_STATUS', res.data)
      }
    }
  },

  mutations: {
    SET_TODAY_STATUS(state, status) {
      state.todayStatus = status
    }
  }
})
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§

- [ ] æ‰€æœ‰èœå•åŠŸèƒ½å‡å·²å®ç°
- [ ] æ‰€æœ‰APIæ¥å£å‡å·²å¯¹æ¥
- [ ] è¡¨å•éªŒè¯å®Œæ•´æœ‰æ•ˆ
- [ ] é”™è¯¯æç¤ºå‹å¥½æ˜ç¡®
- [ ] æ•°æ®åŠ è½½çŠ¶æ€æ¸…æ™°

### ä»£ç è´¨é‡

- [ ] ä»£ç ç¬¦åˆè§„èŒƒ
- [ ] ç»„ä»¶æ‹†åˆ†åˆç†
- [ ] å¤ç”¨æ€§è‰¯å¥½
- [ ] æ— æ˜æ˜¾ä»£ç å†—ä½™
- [ ] æ³¨é‡Šå®Œæ•´æ¸…æ™°

### æ€§èƒ½æŒ‡æ ‡

- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
- [ ] APIå“åº”æ—¶é—´ < 1ç§’
- [ ] æ‰“å¡å“åº”æ—¶é—´ < 2ç§’
- [ ] æ»šåŠ¨å¸§ç‡ > 55fps
- [ ] å†…å­˜å ç”¨ < 100MB

### ç”¨æˆ·ä½“éªŒ

- [ ] ç•Œé¢ç¾è§‚ç»Ÿä¸€
- [ ] æ“ä½œæµç•…è‡ªç„¶
- [ ] æç¤ºä¿¡æ¯å‡†ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] å…¼å®¹æ€§è‰¯å¥½

---

## ğŸ“š é™„å½•

### A. APIæ¥å£å®Œæ•´åˆ—è¡¨

```javascript
// å·²åœ¨ attendance-api.js ä¸­å®šä¹‰çš„API
export default {
  // GPSæ‰“å¡
  gpsPunch,
  uploadPunchPhoto,
  getTodayPunchStatus,
  getPunchRecords,

  // ä½ç½®éªŒè¯
  validateLocation,
  getAttendanceLocations,
  getNearestLocation,

  // ç¦»çº¿æ‰“å¡
  cacheOfflinePunch,
  syncOfflinePunches,
  getOfflineStatus,
  clearOfflineCache,

  // è¯·å‡
  applyLeave,
  getLeaveRecords,
  cancelLeave,

  // åŠ ç­
  applyOvertime,
  getOvertimeRecords,

  // ç»Ÿè®¡
  getPersonalStatistics,
  getMonthlySummary,
  getAbnormalRecords,

  // æ’ç­
  getPersonalSchedule,
  getTodaySchedule,
  getWeekSchedule,

  // è¡¥å¡
  applySupplement,
  getSupplementRecords,

  // å‡ºå·®
  applyTravel,
  getTravelRecords
}
```

### B. åç«¯Controlleræ˜ å°„

| åç«¯Controller | ç§»åŠ¨ç«¯APIå‰ç¼€ | ä¸»è¦åŠŸèƒ½ |
|---------------|---------------|----------|
| DeviceAttendancePunchController | /api/attendance/mobile | è®¾å¤‡æ‰“å¡ |
| AttendanceRecordController | /api/attendance/mobile | æ‰“å¡è®°å½• |
| AttendanceLeaveController | /api/attendance/mobile | è¯·å‡ç®¡ç† |
| AttendanceOvertimeController | /api/attendance/mobile | åŠ ç­ç®¡ç† |
| AttendanceSupplementController | /api/attendance/mobile | è¡¥å¡ç®¡ç† |
| AttendanceTravelController | /api/attendance/mobile | å‡ºå·®ç®¡ç† |
| AttendanceReportController | /api/attendance/mobile | ç»Ÿè®¡æŠ¥è¡¨ |
| ScheduleController | /api/attendance/mobile | æ’ç­ç®¡ç† |
| SmartSchedulingController | /api/attendance/mobile | æ™ºèƒ½æ’ç­ |

### C. å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ | å®Œæˆæ—¶é—´ |
|------|------|--------|----------|
| Phase 1 | æ‰“å¡åŠŸèƒ½å®Œå–„ | 3äººæ—¥ | Week 1-2 |
| Phase 2 | å¼‚å¸¸ç”³è¯·åŠŸèƒ½ | 12äººæ—¥ | Week 3-4 |
| Phase 3 | è€ƒå‹¤ç»Ÿè®¡åŠŸèƒ½ | 8äººæ—¥ | Week 5-6 |
| Phase 4 | æ’ç­åŠŸèƒ½å®Œå–„ | 4äººæ—¥ | Week 7 |
| Phase 5 | æ¶ˆæ¯é€šçŸ¥åŠŸèƒ½ | 4äººæ—¥ | Week 8 |
| **æ€»è®¡** | | **31äººæ—¥** | **8å‘¨** |

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**: IOE-DREAMæ¶æ„å›¢é˜Ÿ
**ğŸ“… æœ€åæ›´æ–°**: 2025-12-24
**ğŸ“Œ ç‰ˆæœ¬**: v1.0.0
