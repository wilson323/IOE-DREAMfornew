# 设备分组管理页面功能与布局文档

## 页面概述
设备分组管理页面是智能视频监控系统中的核心组织管理界面，用于对系统中所有视频监控设备进行分层分组管理。该页面采用经典的左右分栏布局，左侧为树形分组结构，右侧为设备卡片展示区。基于SmartAdmin前端框架构建，采用Vue3 + Ant Design Vue技术栈，支持拖拽移动设备、分组创建、设备统计等完整的分组管理功能。

## 页面布局特点
- **左侧树形结构**：支持多级分组展示，可展开/收起，显示每个分组的设备数量
- **右侧卡片网格**：以卡片形式展示设备，支持批量选择和操作
- **拖拽支持**：可拖拽设备到不同分组（原型展示功能，需后期实现）
- **实时统计**：自动统计分组数量、设备总数、在线设备数

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/smart-video/
├── device-group.vue                 # 设备分组主页面
├── components/
│   ├── GroupTree.vue               # 分组树组件
│   ├── GroupForm.vue               # 分组表单组件（新增/编辑）
│   ├── DeviceCardList.vue          # 设备卡片列表组件
│   ├── DeviceCard.vue              # 单个设备卡片组件
│   ├── MoveToGroupModal.vue        # 移动到分组弹窗
│   └── GroupStatistics.vue         # 分组统计组件
├── mock/
│   └── device-group-mock-data.js   # 模拟数据
└── api/
    └── device-group-api.js         # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/device-group-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const deviceGroupApi = {
  // 查询分组树
  queryGroupTree: () => getRequest('/device-group/tree'),

  // 添加分组
  addGroup: (params) => postRequest('/device-group/add', params),

  // 更新分组
  updateGroup: (params) => postRequest('/device-group/update', params),

  // 删除分组
  deleteGroup: (id) => getRequest(`/device-group/delete/${id}`),

  // 批量删除分组
  batchDeleteGroup: (ids) => postRequest('/device-group/batch/delete', ids),

  // 查询分组下的设备列表
  queryGroupDevices: (groupId, params) => postRequest(`/device-group/${groupId}/devices`, params),

  // 移动设备到分组
  moveDevicesToGroup: (params) => postRequest('/device-group/move-devices', params),

  // 从分组移除设备
  removeDevicesFromGroup: (params) => postRequest('/device-group/remove-devices', params),

  // 搜索分组
  searchGroups: (keyword) => getRequest(`/device-group/search?keyword=${keyword}`),

  // 获取分组统计信息
  getGroupStatistics: () => getRequest('/device-group/statistics'),

  // 获取单个分组详情
  getGroupDetail: (id) => getRequest(`/device-group/detail/${id}`),
};
```

## ⚠️ 开发注意事项与常见错误避免

### 1. Vue 3 组件开发注意事项

#### ❌ 错误用法：在 props 上使用 v-model
```vue
<!-- 错误：不能在props上使用v-model -->
<template>
  <a-modal v-model:open="visible" title="分组管理">
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean  // props是只读的，不能直接绑定v-model
});
</script>
```

#### ✅ 正确用法：使用 :open 绑定和事件
```vue
<!-- 正确：使用属性绑定和事件监听 -->
<template>
  <a-modal
    :open="visible"
    title="分组管理"
    @close="handleClose"
    @cancel="handleCancel"
  >
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean
});

const emit = defineEmits(['update:visible', 'close', 'cancel']);

const handleClose = () => {
  emit('update:visible', false);
  emit('close');
};

const handleCancel = () => {
  emit('update:visible', false);
  emit('cancel');
};
</script>
```

### 2. 图标导入注意事项

#### ❌ 错误：使用不存在的图标
```vue
<!-- 错误：某些图标可能不存在 -->
<script setup>
import { DeviceOutlined, GroupOutlined } from '@ant-design/icons-vue';  // ❌ 可能不存在
</script>
```

#### ✅ 正确：使用存在的图标
```vue
<!-- 正确：使用实际存在的图标 -->
<script setup>
import {
  FolderOutlined,        // ✅ 文件夹图标（用于分组）
  FolderOpenOutlined,    // ✅ 打开的文件夹
  VideoCameraOutlined,   // ✅ 摄像机
  PlusOutlined,          // ✅ 新增
  DeleteOutlined,        // ✅ 删除
  EditOutlined,          // ✅ 编辑
  SearchOutlined,        // ✅ 搜索
  ReloadOutlined,        // ✅ 刷新
  RightOutlined,         // ✅ 右箭头（树节点收起）
  DownOutlined,          // ✅ 下箭头（树节点展开）
  SwapOutlined,          // ✅ 移动/交换
  EyeOutlined,           // ✅ 预览
  SettingOutlined,       // ✅ 配置
  CheckCircleOutlined,   // ✅ 在线状态
  CloseCircleOutlined,   // ✅ 离线状态
} from '@ant-design/icons-vue';
</script>
```

### 3. Tree组件使用注意事项

#### ✅ 正确的树形数据结构
```javascript
// Tree组件要求的标准数据格式
const treeData = [
  {
    title: '全部设备',           // 节点显示文本
    key: 'root',                 // 节点唯一标识
    icon: h(FolderOutlined),     // 节点图标
    children: [                  // 子节点数组
      {
        title: '办公区域',
        key: 'office',
        icon: h(FolderOutlined),
        count: 42,               // 自定义字段：设备数量
        children: [
          {
            title: '一楼',
            key: 'office-1f',
            icon: h(FolderOutlined),
            count: 15,
          },
        ],
      },
    ],
  },
];
```

#### ✅ Tree组件的正确使用方式
```vue
<template>
  <a-tree
    v-model:selectedKeys="selectedKeys"
    v-model:expandedKeys="expandedKeys"
    :tree-data="treeData"
    :show-icon="true"
    :show-line="true"
    @select="handleSelectNode"
  >
    <template #title="{ title, count }">
      <span class="tree-node-title">
        {{ title }}
        <a-badge
          v-if="count !== undefined"
          :count="count"
          :number-style="{ backgroundColor: '#e5e7eb', color: '#374151' }"
        />
      </span>
    </template>
  </a-tree>
</template>

<script setup>
import { ref, h } from 'vue';
import { FolderOutlined } from '@ant-design/icons-vue';

const selectedKeys = ref(['root']);
const expandedKeys = ref(['root']);
const treeData = ref([]);

const handleSelectNode = (selectedKeys, info) => {
  console.log('选中的节点:', selectedKeys, info);
  // 加载该分组下的设备列表
};
</script>
```

### 4. 卡片网格布局注意事项

#### ✅ 使用Ant Design的响应式栅格系统
```vue
<template>
  <a-row :gutter="[16, 16]">
    <a-col
      v-for="device in deviceList"
      :key="device.id"
      :xs="24"      <!-- 超小屏：1列 -->
      :sm="12"      <!-- 小屏：2列 -->
      :md="8"       <!-- 中屏：3列 -->
      :lg="6"       <!-- 大屏：4列 -->
      :xl="6"       <!-- 超大屏：4列 -->
    >
      <device-card :device="device" />
    </a-col>
  </a-row>
</template>
```

### 5. API导入路径注意事项

#### ✅ 正确：使用项目标准导入路径
```javascript
// 正确：使用项目中实际的axios文件
import { postRequest, getRequest } from '/@/lib/axios';
```

## 核心功能模块

### 1. 左侧分组树功能区

#### 1.1 分组树头部（搜索栏）
**位置**: 左侧顶部
**功能**: 搜索分组、刷新分组树

**技术实现**:
```vue
<template>
  <div class="group-tree-header">
    <div class="header-title">
      <h3>设备分组列表</h3>
      <a-button type="text" size="small" @click="refreshGroupTree">
        <template #icon><ReloadOutlined /></template>
      </a-button>
    </div>
    <div class="header-search">
      <a-input-search
        v-model:value="searchKeyword"
        placeholder="搜索分组..."
        allowClear
        @search="handleSearchGroup"
      >
        <template #enterButton>
          <a-button type="primary">
            <template #icon><SearchOutlined /></template>
          </a-button>
        </template>
      </a-input-search>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { message } from 'ant-design-vue';
import { SearchOutlined, ReloadOutlined } from '@ant-design/icons-vue';

const searchKeyword = ref('');

const handleSearchGroup = (value) => {
  console.log('搜索分组:', value);
  // 调用API搜索分组
};

const refreshGroupTree = () => {
  message.success('分组列表已刷新');
  // 重新加载分组树
};
</script>

<style scoped lang="less">
.group-tree-header {
  padding: 16px;
  border-bottom: 1px solid #f0f0f0;

  .header-title {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;

    h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }
  }

  .header-search {
    width: 100%;
  }
}
</style>
```

#### 1.2 分组操作工具栏
**位置**: 搜索栏下方
**功能**: 新增分组、删除分组

**技术实现**:
```vue
<template>
  <div class="group-toolbar">
    <a-space>
      <a-button type="primary" block @click="showAddGroupModal">
        <template #icon><PlusOutlined /></template>
        新增分组
      </a-button>
      <a-button danger block @click="deleteSelectedGroups" :disabled="selectedGroupKeys.length === 0">
        <template #icon><DeleteOutlined /></template>
        删除分组
      </a-button>
    </a-space>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { message, Modal } from 'ant-design-vue';
import { PlusOutlined, DeleteOutlined } from '@ant-design/icons-vue';

const selectedGroupKeys = ref([]);

const showAddGroupModal = () => {
  // 显示新增分组表单
  console.log('打开新增分组弹窗');
};

const deleteSelectedGroups = () => {
  if (selectedGroupKeys.value.length === 0) {
    message.warning('请选择要删除的分组');
    return;
  }

  Modal.confirm({
    title: '确认删除',
    content: `确定要删除选中的 ${selectedGroupKeys.value.length} 个分组吗？删除后分组下的设备将移动到根分组。`,
    onOk: async () => {
      try {
        // await deviceGroupApi.batchDeleteGroup(selectedGroupKeys.value);
        message.success(`成功删除 ${selectedGroupKeys.value.length} 个分组`);
        selectedGroupKeys.value = [];
        // 刷新分组树
      } catch (error) {
        message.error('删除失败');
      }
    },
  });
};
</script>

<style scoped lang="less">
.group-toolbar {
  padding: 16px;
  border-bottom: 1px solid #f0f0f0;
  background-color: #fafafa;
}
</style>
```

#### 1.3 分组树主体
**位置**: 工具栏下方，占据左侧主要区域
**功能**: 展示层级分组结构，支持展开/收起，显示设备数量

**技术实现**:
```vue
<template>
  <div class="group-tree-container">
    <a-tree
      v-model:selectedKeys="selectedKeys"
      v-model:expandedKeys="expandedKeys"
      v-model:checkedKeys="checkedKeys"
      :tree-data="treeData"
      :show-icon="true"
      :show-line="true"
      checkable
      @select="handleSelectNode"
      @check="handleCheckNode"
    >
      <template #title="{ title, count, key }">
        <div class="tree-node-title">
          <span>{{ title }}</span>
          <a-badge
            v-if="count !== undefined"
            :count="`${count}台`"
            :number-style="{
              backgroundColor: '#e5e7eb',
              color: '#374151',
              fontWeight: 500,
            }"
          />
        </div>
      </template>

      <template #icon="{ expanded }">
        <FolderOpenOutlined v-if="expanded" />
        <FolderOutlined v-else />
      </template>
    </a-tree>
  </div>
</template>

<script setup>
import { ref, h, onMounted } from 'vue';
import { FolderOutlined, FolderOpenOutlined } from '@ant-design/icons-vue';
import { deviceGroupApi } from '/@/api/business/smart-video/device-group-api';

const selectedKeys = ref(['root']);
const expandedKeys = ref(['root']);
const checkedKeys = ref([]);
const treeData = ref([]);

// 加载分组树数据
const loadGroupTree = async () => {
  try {
    const response = await deviceGroupApi.queryGroupTree();
    if (response.code === 1) {
      treeData.value = response.data;
    }
  } catch (error) {
    console.error('加载分组树失败:', error);
  }
};

// 选中节点
const handleSelectNode = (selectedKeys, info) => {
  console.log('选中节点:', selectedKeys, info);
  // 加载该分组下的设备
};

// 勾选节点
const handleCheckNode = (checkedKeys, info) => {
  console.log('勾选节点:', checkedKeys, info);
};

onMounted(() => {
  loadGroupTree();
});
</script>

<style scoped lang="less">
.group-tree-container {
  flex: 1;
  overflow-y: auto;
  padding: 16px;

  :deep(.ant-tree) {
    .tree-node-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding-right: 8px;

      span {
        flex: 1;
      }
    }

    .ant-tree-node-content-wrapper {
      width: calc(100% - 24px);
    }

    .ant-tree-switcher {
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }
}
</style>
```

#### 1.4 分组统计信息
**位置**: 左侧底部
**功能**: 显示分组总数、设备总数、在线设备数

**技术实现**:
```vue
<template>
  <div class="group-statistics">
    <div class="stat-item">
      <span class="stat-label">分组总数:</span>
      <span class="stat-value">{{ statistics.groupCount }}个</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">设备总数:</span>
      <span class="stat-value">{{ statistics.totalDevices }}台</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">在线设备:</span>
      <span class="stat-value online">{{ statistics.onlineDevices }}台</span>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { deviceGroupApi } from '/@/api/business/smart-video/device-group-api';

const statistics = ref({
  groupCount: 0,
  totalDevices: 0,
  onlineDevices: 0,
});

const loadStatistics = async () => {
  try {
    const response = await deviceGroupApi.getGroupStatistics();
    if (response.code === 1) {
      statistics.value = response.data;
    }
  } catch (error) {
    console.error('加载统计信息失败:', error);
  }
};

onMounted(() => {
  loadStatistics();
});
</script>

<style scoped lang="less">
.group-statistics {
  padding: 16px;
  border-top: 1px solid #f0f0f0;
  background-color: #fafafa;

  .stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 12px;

    &:last-child {
      margin-bottom: 0;
    }

    .stat-label {
      color: #666;
    }

    .stat-value {
      font-weight: 600;
      color: #333;

      &.online {
        color: #52c41a;
      }
    }
  }
}
</style>
```

### 2. 右侧设备列表功能区

#### 2.1 设备列表头部
**位置**: 右侧顶部
**功能**: 显示当前分组名称、设备数量、搜索设备

**技术实现**:
```vue
<template>
  <div class="device-list-header">
    <div class="header-info">
      <div>
        <h3>{{ currentGroupTitle }}</h3>
        <p class="device-count">共 <span>{{ deviceCount }}</span> 台设备</p>
      </div>
    </div>
    <div class="header-actions">
      <a-input-search
        v-model:value="searchKeyword"
        placeholder="搜索设备..."
        style="width: 240px; margin-right: 12px;"
        allowClear
        @search="handleSearchDevice"
      />
      <a-button type="primary" @click="showMoveToGroupModal">
        <template #icon><SwapOutlined /></template>
        移动到分组
      </a-button>
      <a-button @click="removeFromGroup">
        <template #icon><CloseCircleOutlined /></template>
        移出分组
      </a-button>
      <a-button type="text" @click="refreshDeviceList">
        <template #icon><ReloadOutlined /></template>
      </a-button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  SwapOutlined,
  CloseCircleOutlined,
  ReloadOutlined,
} from '@ant-design/icons-vue';

const currentGroupTitle = ref('办公区域 - 一楼');
const deviceCount = ref(15);
const searchKeyword = ref('');
const selectedDeviceIds = ref([]);

const handleSearchDevice = (value) => {
  console.log('搜索设备:', value);
  // 过滤设备列表
};

const showMoveToGroupModal = () => {
  if (selectedDeviceIds.value.length === 0) {
    message.warning('请选择要移动的设备');
    return;
  }
  // 显示移动到分组弹窗
};

const removeFromGroup = () => {
  if (selectedDeviceIds.value.length === 0) {
    message.warning('请选择要移出的设备');
    return;
  }

  Modal.confirm({
    title: '确认移出',
    content: `确定要将选中的 ${selectedDeviceIds.value.length} 台设备移出当前分组吗？`,
    onOk: async () => {
      try {
        // await deviceGroupApi.removeDevicesFromGroup({...});
        message.success('设备已移出分组');
        // 刷新设备列表
      } catch (error) {
        message.error('操作失败');
      }
    },
  });
};

const refreshDeviceList = () => {
  message.success('设备列表已刷新');
  // 重新加载设备列表
};
</script>

<style scoped lang="less">
.device-list-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  border-bottom: 1px solid #f0f0f0;

  .header-info {
    h3 {
      margin: 0 0 4px 0;
      font-size: 18px;
      font-weight: 600;
    }

    .device-count {
      margin: 0;
      font-size: 14px;
      color: #666;

      span {
        font-weight: 600;
        color: #1890ff;
      }
    }
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }
}
</style>
```

#### 2.2 设备卡片网格
**位置**: 右侧主体区域
**功能**: 以卡片形式展示设备，支持批量选择

**技术实现**:
```vue
<template>
  <div class="device-card-grid">
    <a-row :gutter="[16, 16]">
      <a-col
        v-for="device in deviceList"
        :key="device.id"
        :xs="24"
        :sm="12"
        :md="8"
        :lg="6"
        :xl="6"
      >
        <device-card
          :device="device"
          :selected="selectedDeviceIds.includes(device.id)"
          @select="handleSelectDevice"
          @preview="handlePreviewDevice"
          @config="handleConfigDevice"
        />
      </a-col>
    </a-row>

    <!-- 空状态 -->
    <a-empty
      v-if="deviceList.length === 0"
      description="暂无设备"
      style="margin-top: 80px;"
    />
  </div>
</template>

<script setup>
import { ref, watch } from 'vue';
import DeviceCard from './DeviceCard.vue';

const props = defineProps({
  groupId: {
    type: String,
    required: true,
  },
});

const deviceList = ref([]);
const selectedDeviceIds = ref([]);

// 加载设备列表
const loadDeviceList = async () => {
  try {
    const response = await deviceGroupApi.queryGroupDevices(props.groupId);
    if (response.code === 1) {
      deviceList.value = response.data;
    }
  } catch (error) {
    console.error('加载设备列表失败:', error);
  }
};

// 选择设备
const handleSelectDevice = (deviceId, checked) => {
  if (checked) {
    selectedDeviceIds.value.push(deviceId);
  } else {
    const index = selectedDeviceIds.value.indexOf(deviceId);
    if (index > -1) {
      selectedDeviceIds.value.splice(index, 1);
    }
  }
};

// 预览设备
const handlePreviewDevice = (device) => {
  console.log('预览设备:', device);
  // 打开视频预览
};

// 配置设备
const handleConfigDevice = (device) => {
  console.log('配置设备:', device);
  // 打开设备配置页面
};

watch(() => props.groupId, () => {
  loadDeviceList();
}, { immediate: true });
</script>

<style scoped lang="less">
.device-card-grid {
  flex: 1;
  overflow-y: auto;
  padding: 16px 24px;
}
</style>
```

#### 2.3 单个设备卡片组件
**组件路径**: `src/views/business/smart-video/components/DeviceCard.vue`

**技术实现**:
```vue
<template>
  <a-card
    class="device-card"
    :class="{ 'device-card-selected': selected }"
    hoverable
    @click.stop="handleCardClick"
  >
    <div class="card-header">
      <div class="header-left">
        <a-checkbox
          :checked="selected"
          @click.stop
          @change="handleCheckboxChange"
        />
        <VideoCameraOutlined class="device-icon" />
      </div>
      <div class="header-right">
        <a-badge
          :status="device.status === 'online' ? 'success' : 'error'"
          :text="device.status === 'online' ? '在线' : '离线'"
        />
      </div>
    </div>

    <div class="card-body">
      <div class="device-name">{{ device.deviceName }}</div>
      <div class="device-location">{{ device.location }}</div>

      <div class="device-info">
        <div class="info-item">
          <span class="label">IP:</span>
          <span class="value">{{ device.ipAddress }}</span>
        </div>
        <div class="info-item">
          <span class="label">类型:</span>
          <span class="value">{{ getDeviceTypeLabel(device.deviceType) }}</span>
        </div>
        <div class="info-item">
          <span class="label">厂商:</span>
          <span class="value">{{ getManufacturerLabel(device.manufacturer) }}</span>
        </div>
        <div class="info-item">
          <span class="label">状态:</span>
          <span class="value" :class="device.status">
            {{ device.status === 'online' ? '在线' : '离线' }}
          </span>
        </div>
      </div>
    </div>

    <div class="card-footer">
      <a-button type="text" size="small" @click.stop="handlePreview">
        <template #icon><EyeOutlined /></template>
        预览
      </a-button>
      <a-button type="text" size="small" @click.stop="handleConfig">
        <template #icon><SettingOutlined /></template>
        配置
      </a-button>
    </div>
  </a-card>
</template>

<script setup>
import { computed } from 'vue';
import {
  VideoCameraOutlined,
  EyeOutlined,
  SettingOutlined,
} from '@ant-design/icons-vue';

const props = defineProps({
  device: {
    type: Object,
    required: true,
  },
  selected: {
    type: Boolean,
    default: false,
  },
});

const emit = defineEmits(['select', 'preview', 'config']);

const handleCheckboxChange = (e) => {
  emit('select', props.device.id, e.target.checked);
};

const handleCardClick = () => {
  emit('select', props.device.id, !props.selected);
};

const handlePreview = () => {
  emit('preview', props.device);
};

const handleConfig = () => {
  emit('config', props.device);
};

const getDeviceTypeLabel = (type) => {
  const typeMap = {
    ipc: '网络摄像机',
    nvr: 'NVR',
    dvr: 'DVR',
    decoder: '解码器',
  };
  return typeMap[type] || type;
};

const getManufacturerLabel = (manufacturer) => {
  const manufacturerMap = {
    hikvision: '海康威视',
    dahua: '大华',
    uniview: '宇视',
    tiandy: '天地伟业',
  };
  return manufacturerMap[manufacturer] || manufacturer;
};
</script>

<style scoped lang="less">
.device-card {
  transition: all 0.3s;
  border: 2px solid transparent;

  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  &.device-card-selected {
    border-color: #1890ff;
    box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);
  }

  :deep(.ant-card-body) {
    padding: 16px;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;

    .header-left {
      display: flex;
      align-items: center;
      gap: 8px;

      .device-icon {
        font-size: 20px;
        color: #666;
      }
    }
  }

  .card-body {
    .device-name {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }

    .device-location {
      font-size: 12px;
      color: #999;
      margin-bottom: 12px;
    }

    .device-info {
      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        margin-bottom: 6px;

        &:last-child {
          margin-bottom: 0;
        }

        .label {
          color: #666;
        }

        .value {
          color: #333;

          &.online {
            color: #52c41a;
          }

          &.offline {
            color: #ff4d4f;
          }
        }
      }
    }
  }

  .card-footer {
    display: flex;
    gap: 4px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #f0f0f0;

    .ant-btn {
      flex: 1;
    }
  }
}
</style>
```

### 3. 分组表单组件（新增/编辑）
**组件路径**: `src/views/business/smart-video/components/GroupForm.vue`

**技术实现**:
```vue
<template>
  <a-modal
    :open="visible"
    :title="isEdit ? '编辑分组' : '新增分组'"
    width="600px"
    @ok="handleSubmit"
    @cancel="handleCancel"
    :confirmLoading="loading"
    :maskClosable="false"
  >
    <a-form
      ref="formRef"
      :model="formData"
      :rules="formRules"
      :label-col="{ span: 6 }"
      :wrapper-col="{ span: 18 }"
    >
      <a-form-item label="分组名称" name="groupName">
        <a-input
          v-model:value="formData.groupName"
          placeholder="请输入分组名称"
          allowClear
        />
      </a-form-item>

      <a-form-item label="上级分组" name="parentId">
        <a-tree-select
          v-model:value="formData.parentId"
          :tree-data="groupTreeData"
          placeholder="请选择上级分组"
          allowClear
          tree-default-expand-all
        />
      </a-form-item>

      <a-form-item label="分组图标" name="icon">
        <div class="icon-selector">
          <a-button
            v-for="icon in iconOptions"
            :key="icon.value"
            :type="formData.icon === icon.value ? 'primary' : 'default'"
            class="icon-button"
            @click="formData.icon = icon.value"
          >
            <component :is="icon.component" />
          </a-button>
        </div>
      </a-form-item>

      <a-form-item label="分组描述" name="description">
        <a-textarea
          v-model:value="formData.description"
          placeholder="请输入分组描述"
          :rows="4"
          allowClear
        />
      </a-form-item>

      <a-form-item label="排序" name="sort">
        <a-input-number
          v-model:value="formData.sort"
          placeholder="请输入排序"
          :min="0"
          style="width: 100%;"
        />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive, watch, h } from 'vue';
import { message } from 'ant-design-vue';
import {
  FolderOutlined,
  HomeOutlined,
  ShopOutlined,
  CarOutlined,
  SafetyOutlined,
} from '@ant-design/icons-vue';
import { deviceGroupApi } from '/@/api/business/smart-video/device-group-api';

const props = defineProps({
  visible: {
    type: Boolean,
    default: false,
  },
  isEdit: {
    type: Boolean,
    default: false,
  },
  groupData: {
    type: Object,
    default: () => ({}),
  },
  groupTreeData: {
    type: Array,
    default: () => [],
  },
});

const emit = defineEmits(['update:visible', 'success', 'cancel']);

const formRef = ref();
const loading = ref(false);

const formData = reactive({
  groupName: '',
  parentId: undefined,
  icon: 'folder',
  description: '',
  sort: 0,
});

const formRules = {
  groupName: [
    { required: true, message: '请输入分组名称', trigger: 'blur' },
    { max: 50, message: '分组名称不能超过50个字符', trigger: 'blur' },
  ],
};

const iconOptions = [
  { value: 'folder', component: h(FolderOutlined) },
  { value: 'home', component: h(HomeOutlined) },
  { value: 'shop', component: h(ShopOutlined) },
  { value: 'car', component: h(CarOutlined) },
  { value: 'safety', component: h(SafetyOutlined) },
];

// 监听编辑数据变化
watch(
  () => props.groupData,
  (newVal) => {
    if (newVal && Object.keys(newVal).length > 0) {
      Object.assign(formData, newVal);
    }
  },
  { immediate: true, deep: true }
);

// 提交表单
const handleSubmit = async () => {
  try {
    await formRef.value.validate();

    loading.value = true;

    const apiMethod = props.isEdit
      ? deviceGroupApi.updateGroup
      : deviceGroupApi.addGroup;

    const result = await apiMethod(formData);

    if (result.code === 1) {
      message.success(props.isEdit ? '编辑成功' : '新增成功');
      emit('success');
      handleCancel();
    } else {
      message.error(result.msg || '操作失败');
    }
  } catch (error) {
    console.error('表单提交失败:', error);
  } finally {
    loading.value = false;
  }
};

// 取消
const handleCancel = () => {
  formRef.value?.resetFields();
  emit('update:visible', false);
  emit('cancel');
};
</script>

<style scoped lang="less">
.icon-selector {
  display: flex;
  gap: 8px;

  .icon-button {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }
}
</style>
```

### 4. 移动到分组弹窗组件
**组件路径**: `src/views/business/smart-video/components/MoveToGroupModal.vue`

**技术实现**:
```vue
<template>
  <a-modal
    :open="visible"
    title="移动到分组"
    width="500px"
    @ok="handleSubmit"
    @cancel="handleCancel"
    :confirmLoading="loading"
  >
    <div class="move-to-group-content">
      <a-alert
        :message="`已选择 ${deviceCount} 台设备`"
        type="info"
        show-icon
        style="margin-bottom: 16px;"
      />

      <a-form :label-col="{ span: 6 }" :wrapper-col="{ span: 18 }">
        <a-form-item label="目标分组" required>
          <a-tree-select
            v-model:value="targetGroupId"
            :tree-data="groupTreeData"
            placeholder="请选择目标分组"
            allowClear
            tree-default-expand-all
          />
        </a-form-item>
      </a-form>
    </div>
  </a-modal>
</template>

<script setup>
import { ref } from 'vue';
import { message } from 'ant-design-vue';
import { deviceGroupApi } from '/@/api/business/smart-video/device-group-api';

const props = defineProps({
  visible: {
    type: Boolean,
    default: false,
  },
  deviceIds: {
    type: Array,
    default: () => [],
  },
  groupTreeData: {
    type: Array,
    default: () => [],
  },
});

const emit = defineEmits(['update:visible', 'success', 'cancel']);

const loading = ref(false);
const targetGroupId = ref(undefined);

const deviceCount = computed(() => props.deviceIds.length);

const handleSubmit = async () => {
  if (!targetGroupId.value) {
    message.warning('请选择目标分组');
    return;
  }

  loading.value = true;

  try {
    const result = await deviceGroupApi.moveDevicesToGroup({
      deviceIds: props.deviceIds,
      targetGroupId: targetGroupId.value,
    });

    if (result.code === 1) {
      message.success('设备已成功移动到新分组');
      emit('success');
      handleCancel();
    } else {
      message.error(result.msg || '移动失败');
    }
  } catch (error) {
    console.error('移动设备失败:', error);
    message.error('移动失败');
  } finally {
    loading.value = false;
  }
};

const handleCancel = () => {
  targetGroupId.value = undefined;
  emit('update:visible', false);
  emit('cancel');
};
</script>

<style scoped lang="less">
.move-to-group-content {
  padding: 16px 0;
}
</style>
```

## Mock数据示例

```javascript
// src/views/business/smart-video/mock/device-group-mock-data.js

// 分组树数据
export const mockGroupTreeData = [
  {
    title: '全部设备',
    key: 'root',
    value: 'root',
    count: 158,
    children: [
      {
        title: '办公区域',
        key: 'office',
        value: 'office',
        count: 42,
        children: [
          { title: '一楼', key: 'office-1f', value: 'office-1f', count: 15 },
          { title: '二楼', key: 'office-2f', value: 'office-2f', count: 18 },
          { title: '三楼', key: 'office-3f', value: 'office-3f', count: 9 },
        ],
      },
      {
        title: '生产区域',
        key: 'production',
        value: 'production',
        count: 38,
        children: [
          { title: '车间', key: 'production-workshop', value: 'production-workshop', count: 22 },
          { title: '仓库', key: 'production-warehouse', value: 'production-warehouse', count: 16 },
        ],
      },
      {
        title: '停车区域',
        key: 'parking',
        value: 'parking',
        count: 28,
      },
      {
        title: '公共区域',
        key: 'public',
        value: 'public',
        count: 35,
      },
      {
        title: '周界防范',
        key: 'security',
        value: 'security',
        count: 15,
      },
    ],
  },
];

// 设备列表数据
export const mockDeviceList = [
  {
    id: 1,
    deviceName: 'CAM001',
    deviceCode: 'CAM-001-20240101',
    deviceType: 'ipc',
    manufacturer: 'hikvision',
    ipAddress: '192.168.1.101',
    port: 8000,
    status: 'online',
    groupId: 'office-1f',
    location: '前门-入口',
    registerTime: '2024-01-15 10:30:25',
  },
  {
    id: 2,
    deviceName: 'CAM002',
    deviceCode: 'CAM-002-20240102',
    deviceType: 'ipc',
    manufacturer: 'dahua',
    ipAddress: '192.168.1.102',
    port: 8000,
    status: 'online',
    groupId: 'office-1f',
    location: '大厅-中央',
    registerTime: '2024-01-15 10:32:18',
  },
  {
    id: 3,
    deviceName: 'CAM003',
    deviceCode: 'CAM-003-20240103',
    deviceType: 'ipc',
    manufacturer: 'uniview',
    ipAddress: '192.168.1.103',
    port: 8000,
    status: 'online',
    groupId: 'office-1f',
    location: '走廊-东侧',
    registerTime: '2024-01-15 10:35:42',
  },
  {
    id: 4,
    deviceName: 'CAM004',
    deviceCode: 'CAM-004-20240104',
    deviceType: 'ipc',
    manufacturer: 'tiandy',
    ipAddress: '192.168.1.104',
    port: 8000,
    status: 'offline',
    groupId: 'office-1f',
    location: '会议室-001',
    registerTime: '2024-01-15 10:40:15',
  },
  {
    id: 5,
    deviceName: 'CAM005',
    deviceCode: 'CAM-005-20240105',
    deviceType: 'ipc',
    manufacturer: 'hikvision',
    ipAddress: '192.168.1.105',
    port: 8000,
    status: 'online',
    groupId: 'office-1f',
    location: '电梯-前厅',
    registerTime: '2024-01-15 10:45:30',
  },
];

// 分组统计数据
export const mockGroupStatistics = {
  groupCount: 6,
  totalDevices: 158,
  onlineDevices: 156,
  offlineDevices: 2,
};

// Mock API实现
export default {
  // 查询分组树
  mockQueryGroupTree: () => {
    return {
      code: 1,
      msg: '查询成功',
      data: mockGroupTreeData,
    };
  },

  // 查询分组下的设备列表
  mockQueryGroupDevices: (groupId) => {
    // 根据groupId筛选设备
    const devices = mockDeviceList.filter(device => {
      if (groupId === 'root') {
        return true; // 根分组显示所有设备
      }
      return device.groupId === groupId;
    });

    return {
      code: 1,
      msg: '查询成功',
      data: devices,
    };
  },

  // 获取分组统计信息
  mockGetGroupStatistics: () => {
    return {
      code: 1,
      msg: '查询成功',
      data: mockGroupStatistics,
    };
  },

  // 添加分组
  mockAddGroup: (params) => {
    console.log('添加分组:', params);
    return {
      code: 1,
      msg: '添加成功',
      data: {
        id: Date.now(),
        ...params,
      },
    };
  },

  // 更新分组
  mockUpdateGroup: (params) => {
    console.log('更新分组:', params);
    return {
      code: 1,
      msg: '更新成功',
      data: params,
    };
  },

  // 删除分组
  mockDeleteGroup: (id) => {
    console.log('删除分组:', id);
    return {
      code: 1,
      msg: '删除成功',
    };
  },

  // 移动设备到分组
  mockMoveDevicesToGroup: (params) => {
    console.log('移动设备到分组:', params);
    return {
      code: 1,
      msg: '移动成功',
    };
  },

  // 从分组移除设备
  mockRemoveDevicesFromGroup: (params) => {
    console.log('从分组移除设备:', params);
    return {
      code: 1,
      msg: '移除成功',
    };
  },

  // 搜索分组
  mockSearchGroups: (keyword) => {
    console.log('搜索分组:', keyword);
    // 简单的关键字匹配
    const filterTree = (nodes) => {
      return nodes.filter(node => {
        if (node.title.includes(keyword)) {
          return true;
        }
        if (node.children) {
          node.children = filterTree(node.children);
          return node.children.length > 0;
        }
        return false;
      });
    };

    const filteredData = filterTree(JSON.parse(JSON.stringify(mockGroupTreeData)));

    return {
      code: 1,
      msg: '查询成功',
      data: filteredData,
    };
  },
};
```

## 主页面完整实现

```vue
<!-- src/views/business/smart-video/device-group.vue -->
<template>
  <div class="device-group-page">
    <!-- 左侧分组树 -->
    <a-card class="group-tree-card" :bordered="false">
      <!-- 头部搜索 -->
      <div class="group-tree-header">
        <div class="header-title">
          <h3>设备分组列表</h3>
          <a-button type="text" size="small" @click="refreshGroupTree">
            <template #icon><ReloadOutlined /></template>
          </a-button>
        </div>
        <div class="header-search">
          <a-input-search
            v-model:value="searchKeyword"
            placeholder="搜索分组..."
            allowClear
            @search="handleSearchGroup"
          />
        </div>
      </div>

      <!-- 工具栏 -->
      <div class="group-toolbar">
        <a-space direction="vertical" style="width: 100%;">
          <a-button type="primary" block @click="showAddGroupModal">
            <template #icon><PlusOutlined /></template>
            新增分组
          </a-button>
          <a-button danger block @click="deleteSelectedGroups" :disabled="checkedKeys.length === 0">
            <template #icon><DeleteOutlined /></template>
            删除分组
          </a-button>
        </a-space>
      </div>

      <!-- 分组树 -->
      <div class="group-tree-container">
        <a-tree
          v-model:selectedKeys="selectedKeys"
          v-model:expandedKeys="expandedKeys"
          v-model:checkedKeys="checkedKeys"
          :tree-data="treeData"
          :show-icon="true"
          :show-line="true"
          checkable
          @select="handleSelectNode"
        >
          <template #title="{ title, count }">
            <div class="tree-node-title">
              <span>{{ title }}</span>
              <a-badge
                v-if="count !== undefined"
                :count="`${count}台`"
                :number-style="{
                  backgroundColor: '#e5e7eb',
                  color: '#374151',
                  fontWeight: 500,
                }"
              />
            </div>
          </template>

          <template #icon="{ expanded }">
            <FolderOpenOutlined v-if="expanded" />
            <FolderOutlined v-else />
          </template>
        </a-tree>
      </div>

      <!-- 统计信息 -->
      <div class="group-statistics">
        <div class="stat-item">
          <span class="stat-label">分组总数:</span>
          <span class="stat-value">{{ statistics.groupCount }}个</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">设备总数:</span>
          <span class="stat-value">{{ statistics.totalDevices }}台</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">在线设备:</span>
          <span class="stat-value online">{{ statistics.onlineDevices }}台</span>
        </div>
      </div>
    </a-card>

    <!-- 右侧设备列表 -->
    <a-card class="device-list-card" :bordered="false">
      <!-- 头部 -->
      <div class="device-list-header">
        <div class="header-info">
          <div>
            <h3>{{ currentGroupTitle }}</h3>
            <p class="device-count">共 <span>{{ deviceList.length }}</span> 台设备</p>
          </div>
        </div>
        <div class="header-actions">
          <a-input-search
            v-model:value="deviceSearchKeyword"
            placeholder="搜索设备..."
            style="width: 240px; margin-right: 12px;"
            allowClear
            @search="handleSearchDevice"
          />
          <a-button type="primary" @click="showMoveToGroupModal">
            <template #icon><SwapOutlined /></template>
            移动到分组
          </a-button>
          <a-button @click="removeFromGroup">
            <template #icon><CloseCircleOutlined /></template>
            移出分组
          </a-button>
          <a-button type="text" @click="refreshDeviceList">
            <template #icon><ReloadOutlined /></template>
          </a-button>
        </div>
      </div>

      <!-- 设备卡片网格 -->
      <div class="device-card-grid">
        <a-row :gutter="[16, 16]">
          <a-col
            v-for="device in filteredDeviceList"
            :key="device.id"
            :xs="24"
            :sm="12"
            :md="8"
            :lg="6"
            :xl="6"
          >
            <a-card
              class="device-card"
              :class="{ 'device-card-selected': selectedDeviceIds.includes(device.id) }"
              hoverable
              @click="handleSelectDevice(device.id)"
            >
              <div class="card-header">
                <div class="header-left">
                  <a-checkbox
                    :checked="selectedDeviceIds.includes(device.id)"
                    @click.stop
                    @change="(e) => handleDeviceCheckboxChange(device.id, e.target.checked)"
                  />
                  <VideoCameraOutlined class="device-icon" />
                </div>
                <div class="header-right">
                  <a-badge
                    :status="device.status === 'online' ? 'success' : 'error'"
                  />
                </div>
              </div>

              <div class="card-body">
                <div class="device-name">{{ device.deviceName }}</div>
                <div class="device-location">{{ device.location }}</div>

                <div class="device-info">
                  <div class="info-item">
                    <span class="label">IP:</span>
                    <span class="value">{{ device.ipAddress }}</span>
                  </div>
                  <div class="info-item">
                    <span class="label">类型:</span>
                    <span class="value">{{ getDeviceTypeLabel(device.deviceType) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="label">厂商:</span>
                    <span class="value">{{ getManufacturerLabel(device.manufacturer) }}</span>
                  </div>
                  <div class="info-item">
                    <span class="label">状态:</span>
                    <span class="value" :class="device.status">
                      {{ device.status === 'online' ? '在线' : '离线' }}
                    </span>
                  </div>
                </div>
              </div>

              <div class="card-footer">
                <a-button type="text" size="small" @click.stop="handlePreviewDevice(device)">
                  <template #icon><EyeOutlined /></template>
                  预览
                </a-button>
                <a-button type="text" size="small" @click.stop="handleConfigDevice(device)">
                  <template #icon><SettingOutlined /></template>
                  配置
                </a-button>
              </div>
            </a-card>
          </a-col>
        </a-row>

        <!-- 空状态 -->
        <a-empty
          v-if="filteredDeviceList.length === 0"
          description="暂无设备"
          style="margin-top: 80px;"
        />
      </div>
    </a-card>

    <!-- 分组表单弹窗 -->
    <group-form
      :visible="groupFormVisible"
      :is-edit="isEditGroup"
      :group-data="currentGroupData"
      :group-tree-data="treeData"
      @update:visible="groupFormVisible = $event"
      @success="handleGroupFormSuccess"
    />

    <!-- 移动到分组弹窗 -->
    <move-to-group-modal
      :visible="moveToGroupVisible"
      :device-ids="selectedDeviceIds"
      :group-tree-data="treeData"
      @update:visible="moveToGroupVisible = $event"
      @success="handleMoveSuccess"
    />
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  FolderOutlined,
  FolderOpenOutlined,
  PlusOutlined,
  DeleteOutlined,
  SearchOutlined,
  ReloadOutlined,
  SwapOutlined,
  CloseCircleOutlined,
  VideoCameraOutlined,
  EyeOutlined,
  SettingOutlined,
} from '@ant-design/icons-vue';
import GroupForm from './components/GroupForm.vue';
import MoveToGroupModal from './components/MoveToGroupModal.vue';
import { deviceGroupApi } from '/@/api/business/smart-video/device-group-api';

// 分组树相关
const searchKeyword = ref('');
const selectedKeys = ref(['root']);
const expandedKeys = ref(['root']);
const checkedKeys = ref([]);
const treeData = ref([]);
const currentGroupTitle = ref('全部设备');
const currentGroupId = ref('root');

// 设备列表相关
const deviceSearchKeyword = ref('');
const deviceList = ref([]);
const selectedDeviceIds = ref([]);

// 统计信息
const statistics = ref({
  groupCount: 0,
  totalDevices: 0,
  onlineDevices: 0,
});

// 表单弹窗
const groupFormVisible = ref(false);
const isEditGroup = ref(false);
const currentGroupData = ref({});

// 移动到分组弹窗
const moveToGroupVisible = ref(false);

// 过滤后的设备列表
const filteredDeviceList = computed(() => {
  if (!deviceSearchKeyword.value) {
    return deviceList.value;
  }
  return deviceList.value.filter(device =>
    device.deviceName.toLowerCase().includes(deviceSearchKeyword.value.toLowerCase()) ||
    device.location.toLowerCase().includes(deviceSearchKeyword.value.toLowerCase())
  );
});

// 加载分组树
const loadGroupTree = async (useMock = true) => {
  try {
    let response;
    if (useMock) {
      const mockData = await import('./mock/device-group-mock-data');
      response = mockData.default.mockQueryGroupTree();
    } else {
      response = await deviceGroupApi.queryGroupTree();
    }

    if (response.code === 1) {
      treeData.value = response.data;
    }
  } catch (error) {
    console.error('加载分组树失败:', error);
    message.error('加载分组树失败');
  }
};

// 加载分组统计
const loadStatistics = async (useMock = true) => {
  try {
    let response;
    if (useMock) {
      const mockData = await import('./mock/device-group-mock-data');
      response = mockData.default.mockGetGroupStatistics();
    } else {
      response = await deviceGroupApi.getGroupStatistics();
    }

    if (response.code === 1) {
      statistics.value = response.data;
    }
  } catch (error) {
    console.error('加载统计信息失败:', error);
  }
};

// 加载设备列表
const loadDeviceList = async (groupId, useMock = true) => {
  try {
    let response;
    if (useMock) {
      const mockData = await import('./mock/device-group-mock-data');
      response = mockData.default.mockQueryGroupDevices(groupId);
    } else {
      response = await deviceGroupApi.queryGroupDevices(groupId);
    }

    if (response.code === 1) {
      deviceList.value = response.data;
    }
  } catch (error) {
    console.error('加载设备列表失败:', error);
    message.error('加载设备列表失败');
  }
};

// 选中树节点
const handleSelectNode = (selectedKeys, info) => {
  if (selectedKeys.length > 0) {
    currentGroupId.value = selectedKeys[0];
    currentGroupTitle.value = info.node.title;
    loadDeviceList(currentGroupId.value);
    selectedDeviceIds.value = [];
  }
};

// 搜索分组
const handleSearchGroup = (value) => {
  console.log('搜索分组:', value);
  // TODO: 实现分组搜索
};

// 刷新分组树
const refreshGroupTree = () => {
  loadGroupTree();
  loadStatistics();
  message.success('分组列表已刷新');
};

// 显示新增分组弹窗
const showAddGroupModal = () => {
  isEditGroup.value = false;
  currentGroupData.value = {};
  groupFormVisible.value = true;
};

// 删除选中的分组
const deleteSelectedGroups = () => {
  if (checkedKeys.value.length === 0) {
    message.warning('请选择要删除的分组');
    return;
  }

  Modal.confirm({
    title: '确认删除',
    content: `确定要删除选中的 ${checkedKeys.value.length} 个分组吗？删除后分组下的设备将移动到根分组。`,
    onOk: async () => {
      try {
        // await deviceGroupApi.batchDeleteGroup(checkedKeys.value);
        message.success(`成功删除 ${checkedKeys.value.length} 个分组`);
        checkedKeys.value = [];
        refreshGroupTree();
      } catch (error) {
        message.error('删除失败');
      }
    },
  });
};

// 分组表单提交成功
const handleGroupFormSuccess = () => {
  refreshGroupTree();
};

// 搜索设备
const handleSearchDevice = (value) => {
  console.log('搜索设备:', value);
};

// 刷新设备列表
const refreshDeviceList = () => {
  loadDeviceList(currentGroupId.value);
  message.success('设备列表已刷新');
};

// 选择设备
const handleSelectDevice = (deviceId) => {
  const index = selectedDeviceIds.value.indexOf(deviceId);
  if (index > -1) {
    selectedDeviceIds.value.splice(index, 1);
  } else {
    selectedDeviceIds.value.push(deviceId);
  }
};

// 设备复选框变化
const handleDeviceCheckboxChange = (deviceId, checked) => {
  if (checked) {
    if (!selectedDeviceIds.value.includes(deviceId)) {
      selectedDeviceIds.value.push(deviceId);
    }
  } else {
    const index = selectedDeviceIds.value.indexOf(deviceId);
    if (index > -1) {
      selectedDeviceIds.value.splice(index, 1);
    }
  }
};

// 显示移动到分组弹窗
const showMoveToGroupModal = () => {
  if (selectedDeviceIds.value.length === 0) {
    message.warning('请选择要移动的设备');
    return;
  }
  moveToGroupVisible.value = true;
};

// 移动成功
const handleMoveSuccess = () => {
  selectedDeviceIds.value = [];
  refreshDeviceList();
};

// 从分组移除设备
const removeFromGroup = () => {
  if (selectedDeviceIds.value.length === 0) {
    message.warning('请选择要移出的设备');
    return;
  }

  Modal.confirm({
    title: '确认移出',
    content: `确定要将选中的 ${selectedDeviceIds.value.length} 台设备移出当前分组吗？`,
    onOk: async () => {
      try {
        // await deviceGroupApi.removeDevicesFromGroup({...});
        message.success('设备已移出分组');
        selectedDeviceIds.value = [];
        refreshDeviceList();
      } catch (error) {
        message.error('操作失败');
      }
    },
  });
};

// 预览设备
const handlePreviewDevice = (device) => {
  console.log('预览设备:', device);
  message.info(`正在预览设备: ${device.deviceName}`);
  // TODO: 打开视频预览
};

// 配置设备
const handleConfigDevice = (device) => {
  console.log('配置设备:', device);
  message.info(`打开设备配置: ${device.deviceName}`);
  // TODO: 打开设备配置页面
};

// 获取设备类型标签
const getDeviceTypeLabel = (type) => {
  const typeMap = {
    ipc: '网络摄像机',
    nvr: 'NVR',
    dvr: 'DVR',
    decoder: '解码器',
  };
  return typeMap[type] || type;
};

// 获取厂商标签
const getManufacturerLabel = (manufacturer) => {
  const manufacturerMap = {
    hikvision: '海康威视',
    dahua: '大华',
    uniview: '宇视',
    tiandy: '天地伟业',
  };
  return manufacturerMap[manufacturer] || manufacturer;
};

onMounted(() => {
  loadGroupTree();
  loadStatistics();
  loadDeviceList('root');
});
</script>

<style scoped lang="less">
.device-group-page {
  display: flex;
  gap: 16px;
  height: calc(100vh - 120px);
  padding: 16px;

  .group-tree-card {
    width: 380px;
    display: flex;
    flex-direction: column;

    :deep(.ant-card-body) {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0;
      overflow: hidden;
    }

    .group-tree-header {
      padding: 16px;
      border-bottom: 1px solid #f0f0f0;

      .header-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;

        h3 {
          margin: 0;
          font-size: 16px;
          font-weight: 600;
        }
      }
    }

    .group-toolbar {
      padding: 16px;
      border-bottom: 1px solid #f0f0f0;
      background-color: #fafafa;
    }

    .group-tree-container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;

      :deep(.ant-tree) {
        .tree-node-title {
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          padding-right: 8px;

          span {
            flex: 1;
          }
        }

        .ant-tree-node-content-wrapper {
          width: calc(100% - 24px);
        }
      }
    }

    .group-statistics {
      padding: 16px;
      border-top: 1px solid #f0f0f0;
      background-color: #fafafa;

      .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 12px;

        &:last-child {
          margin-bottom: 0;
        }

        .stat-label {
          color: #666;
        }

        .stat-value {
          font-weight: 600;
          color: #333;

          &.online {
            color: #52c41a;
          }
        }
      }
    }
  }

  .device-list-card {
    flex: 1;
    display: flex;
    flex-direction: column;

    :deep(.ant-card-body) {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0;
      overflow: hidden;
    }

    .device-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-bottom: 1px solid #f0f0f0;

      .header-info {
        h3 {
          margin: 0 0 4px 0;
          font-size: 18px;
          font-weight: 600;
        }

        .device-count {
          margin: 0;
          font-size: 14px;
          color: #666;

          span {
            font-weight: 600;
            color: #1890ff;
          }
        }
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }
    }

    .device-card-grid {
      flex: 1;
      overflow-y: auto;
      padding: 16px 24px;

      .device-card {
        transition: all 0.3s;
        border: 2px solid transparent;

        &:hover {
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        &.device-card-selected {
          border-color: #1890ff;
          box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);
        }

        :deep(.ant-card-body) {
          padding: 16px;
        }

        .card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;

          .header-left {
            display: flex;
            align-items: center;
            gap: 8px;

            .device-icon {
              font-size: 20px;
              color: #666;
            }
          }
        }

        .card-body {
          .device-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
          }

          .device-location {
            font-size: 12px;
            color: #999;
            margin-bottom: 12px;
          }

          .device-info {
            .info-item {
              display: flex;
              justify-content: space-between;
              align-items: center;
              font-size: 12px;
              margin-bottom: 6px;

              &:last-child {
                margin-bottom: 0;
              }

              .label {
                color: #666;
              }

              .value {
                color: #333;

                &.online {
                  color: #52c41a;
                }

                &.offline {
                  color: #ff4d4f;
                }
              }
            }
          }
        }

        .card-footer {
          display: flex;
          gap: 4px;
          margin-top: 12px;
          padding-top: 12px;
          border-top: 1px solid #f0f0f0;

          .ant-btn {
            flex: 1;
          }
        }
      }
    }
  }
}
</style>
```

## 路由配置

### ✅ 正确的路由配置
```javascript
// src/router/business/smart-video.js
import SmartLayout from '/@/layout/index.vue';
import { MENU_TYPE_ENUM } from '/@/constants/system/menu-const';

export const smartVideoRouters = [
  {
    path: '/',
    component: SmartLayout,
    children: [
      {
        path: '/business/smart-video/device-group',
        name: 'SmartVideoDeviceGroup',
        component: () => import('/@/views/business/smart-video/device-group.vue'),
        meta: {
          title: '智能视频 - 设备分组',
          menuType: MENU_TYPE_ENUM.MENU.value,
          icon: 'FolderOutlined',
          hideInMenu: false,
          keepAlive: true,
        },
      },
    ],
  },
];
```

### ✅ 主路由文件集成
```javascript
// src/router/routers.js
import { smartVideoRouters } from './business/smart-video';

export const routerArray = [
  // ...其他路由
  ...smartVideoRouters,
  // ...更多路由
];
```

## 菜单配置

### ✅ 动态菜单注入
```javascript
// src/store/modules/system/user.js
function addSmartVideoMenu(menuList) {
  const maxMenuId = Math.max(...menuList.map(item => item.menuId || 0));

  // 智能视频父菜单
  const smartVideoMenu = {
    menuId: maxMenuId + 1000,
    menuName: '智能视频',
    menuTitle: '智能视频',
    menuType: MENU_TYPE_ENUM.CATALOG.value,
    parentId: 0,
    path: '/business/smart-video',
    icon: 'VideoCameraOutlined',
    visibleFlag: true,
    disabledFlag: false,
    cacheFlag: false,
    frameFlag: false,
    frameUrl: '',
    sort: 10,
    updateTime: new Date().toISOString(),
  };

  // 设备分组子菜单
  const deviceGroupMenu = {
    menuId: maxMenuId + 1002,
    menuName: '设备分组',
    menuTitle: '设备分组',
    menuType: MENU_TYPE_ENUM.MENU.value,
    parentId: smartVideoMenu.menuId,
    path: '/business/smart-video/device-group',
    component: '/business/smart-video/device-group.vue',
    icon: 'FolderOutlined',
    visibleFlag: true,
    disabledFlag: false,
    cacheFlag: true,
    frameFlag: false,
    frameUrl: '',
    sort: 2,
    updateTime: new Date().toISOString(),
  };

  menuList.push(smartVideoMenu, deviceGroupMenu);
  return smartVideoMenu.menuId;
}
```

## Pinia Store状态管理

```javascript
// src/store/modules/business/device-group.js
import { defineStore } from 'pinia';
import { message } from 'ant-design-vue';
import { deviceGroupApi } from '/@/api/business/smart-video/device-group-api';

export const useDeviceGroupStore = defineStore('deviceGroup', {
  state: () => ({
    groupTree: [],
    currentGroup: null,
    deviceList: [],
    statistics: {
      groupCount: 0,
      totalDevices: 0,
      onlineDevices: 0,
    },
    loading: false,
  }),

  getters: {
    // 扁平化分组树，方便查找
    flatGroupTree(state) {
      const flatten = (nodes, result = []) => {
        nodes.forEach(node => {
          result.push(node);
          if (node.children && node.children.length > 0) {
            flatten(node.children, result);
          }
        });
        return result;
      };
      return flatten(state.groupTree);
    },

    // 根据key查找分组
    findGroupByKey: (state) => (key) => {
      const flatten = (nodes) => {
        for (const node of nodes) {
          if (node.key === key) return node;
          if (node.children) {
            const found = flatten(node.children);
            if (found) return found;
          }
        }
        return null;
      };
      return flatten(state.groupTree);
    },
  },

  actions: {
    async fetchGroupTree(useMock = true) {
      this.loading = true;
      try {
        let response;
        if (useMock) {
          const mockData = await import('/@/views/business/smart-video/mock/device-group-mock-data');
          response = mockData.default.mockQueryGroupTree();
        } else {
          response = await deviceGroupApi.queryGroupTree();
        }

        if (response.code === 1) {
          this.groupTree = response.data;
          return response.data;
        } else {
          message.error(response.msg || '获取分组树失败');
          return null;
        }
      } catch (error) {
        console.error('获取分组树失败:', error);
        message.error('获取分组树失败');
        return null;
      } finally {
        this.loading = false;
      }
    },

    async fetchDeviceList(groupId, useMock = true) {
      this.loading = true;
      try {
        let response;
        if (useMock) {
          const mockData = await import('/@/views/business/smart-video/mock/device-group-mock-data');
          response = mockData.default.mockQueryGroupDevices(groupId);
        } else {
          response = await deviceGroupApi.queryGroupDevices(groupId);
        }

        if (response.code === 1) {
          this.deviceList = response.data;
          return response.data;
        } else {
          message.error(response.msg || '获取设备列表失败');
          return null;
        }
      } catch (error) {
        console.error('获取设备列表失败:', error);
        message.error('获取设备列表失败');
        return null;
      } finally {
        this.loading = false;
      }
    },

    async fetchStatistics(useMock = true) {
      try {
        let response;
        if (useMock) {
          const mockData = await import('/@/views/business/smart-video/mock/device-group-mock-data');
          response = mockData.default.mockGetGroupStatistics();
        } else {
          response = await deviceGroupApi.getGroupStatistics();
        }

        if (response.code === 1) {
          this.statistics = response.data;
          return response.data;
        }
      } catch (error) {
        console.error('获取统计信息失败:', error);
        return null;
      }
    },

    async addGroup(groupData) {
      try {
        const response = await deviceGroupApi.addGroup(groupData);
        if (response.code === 1) {
          message.success('添加分组成功');
          return true;
        } else {
          message.error(response.msg || '添加分组失败');
          return false;
        }
      } catch (error) {
        console.error('添加分组失败:', error);
        message.error('添加分组失败');
        return false;
      }
    },

    async updateGroup(groupData) {
      try {
        const response = await deviceGroupApi.updateGroup(groupData);
        if (response.code === 1) {
          message.success('更新分组成功');
          return true;
        } else {
          message.error(response.msg || '更新分组失败');
          return false;
        }
      } catch (error) {
        console.error('更新分组失败:', error);
        message.error('更新分组失败');
        return false;
      }
    },

    async deleteGroup(groupId) {
      try {
        const response = await deviceGroupApi.deleteGroup(groupId);
        if (response.code === 1) {
          message.success('删除分组成功');
          return true;
        } else {
          message.error(response.msg || '删除分组失败');
          return false;
        }
      } catch (error) {
        console.error('删除分组失败:', error);
        message.error('删除分组失败');
        return false;
      }
    },

    async moveDevicesToGroup(deviceIds, targetGroupId) {
      try {
        const response = await deviceGroupApi.moveDevicesToGroup({
          deviceIds,
          targetGroupId,
        });
        if (response.code === 1) {
          message.success('设备移动成功');
          return true;
        } else {
          message.error(response.msg || '设备移动失败');
          return false;
        }
      } catch (error) {
        console.error('设备移动失败:', error);
        message.error('设备移动失败');
        return false;
      }
    },

    setCurrentGroup(group) {
      this.currentGroup = group;
    },
  },
});
```

## 常见错误排查清单

### 1. 控制台报错排查
- [ ] 图标导入错误：检查 `@ant-design/icons-vue` 中是否存在该图标
- [ ] API导入错误：确认导入路径是否为 `/@/lib/axios`
- [ ] v-model错误：检查是否在props上使用了v-model
- [ ] Tree组件数据格式错误：确保包含title、key、children字段
- [ ] TreeSelect组件数据格式错误：确保包含title、key、value字段

### 2. 页面无法访问排查
- [ ] 路由配置：检查路由是否正确添加到 `routerArray`
- [ ] 菜单配置：检查菜单是否正确注入到菜单列表
- [ ] 组件路径：确认组件路径是否正确
- [ ] 文件存在：确认所有引用的组件文件都存在

### 3. 功能异常排查
- [ ] Store状态：检查Pinia store是否正确定义和使用
- [ ] API调用：确认API接口路径和参数是否正确
- [ ] 数据格式：检查mock数据格式是否符合预期
- [ ] 事件绑定：确认事件监听器是否正确绑定
- [ ] 树形选择器：确保treeData数据正确传递

### 4. 布局相关排查
- [ ] 左右分栏布局：确认flex布局样式正确
- [ ] 卡片网格：检查a-row和a-col的gutter和span配置
- [ ] 滚动区域：确保overflow-y: auto样式正确应用
- [ ] 高度计算：检查父容器高度是否正确设置

## 最佳实践总结

### ✅ 推荐的开发流程
1. **先创建基础组件** - 确保每个组件可以独立运行
2. **逐步集成功能** - 从简单到复杂，逐步添加功能
3. **Mock数据优先** - 先用mock数据开发，后期对接真实API
4. **及时测试验证** - 每添加一个功能就进行测试
5. **遵循项目规范** - 使用项目既定的命名和结构规范

### ✅ 代码质量保证
1. **使用TypeScript类型检查**（如果项目支持）
2. **遵循ESLint和Prettier规范**
3. **编写单元测试**（重要功能）
4. **添加适当的注释**，特别是复杂逻辑
5. **保持组件单一职责**，避免过度复杂

### ✅ 性能优化建议
1. **使用懒加载**：路由和组件按需加载
2. **合理使用computed和watch**
3. **避免不必要的重新渲染**
4. **使用虚拟滚动**处理大数据列表（设备数量超过1000时）
5. **添加防抖和节流**优化用户交互（如搜索输入）

### ✅ 用户体验优化
1. **加载状态提示**：所有异步操作都应有loading提示
2. **空状态处理**：当没有数据时显示友好的空状态提示
3. **错误处理**：友好的错误提示和容错处理
4. **操作确认**：删除等重要操作要有二次确认
5. **即时反馈**：操作成功/失败要有明确的消息提示

## 特殊功能实现说明

### 1. 拖拽功能实现（可选增强）
虽然原型中展示了拖拽功能，但在实际开发中可以使用以下方案实现：

```vue
<script setup>
// 安装依赖: npm install vuedraggable@next
import draggable from 'vuedraggable';

// 在设备卡片上启用拖拽
const drag = ref(false);

const onDragStart = (device) => {
  console.log('开始拖拽设备:', device);
};

const onDragEnd = (event) => {
  console.log('拖拽结束:', event);
  // 调用API移动设备到新分组
};
</script>
```

### 2. 分组批量操作
```javascript
// 批量移动设备到分组
const batchMoveToGroup = async (deviceIds, targetGroupId) => {
  const loading = message.loading('正在移动设备...', 0);
  try {
    const result = await deviceGroupApi.moveDevicesToGroup({
      deviceIds,
      targetGroupId,
    });
    loading();
    if (result.code === 1) {
      message.success(`成功移动 ${deviceIds.length} 台设备`);
      return true;
    } else {
      message.error(result.msg || '移动失败');
      return false;
    }
  } catch (error) {
    loading();
    message.error('移动失败');
    return false;
  }
};
```

### 3. 分组树搜索高亮
```vue
<script setup>
// 搜索结果高亮
const highlightSearchResult = (title, keyword) => {
  if (!keyword) return title;
  const regex = new RegExp(`(${keyword})`, 'gi');
  return title.replace(regex, '<span class="highlight">$1</span>');
};
</script>

<style>
.highlight {
  color: #1890ff;
  background-color: #e6f7ff;
  padding: 0 2px;
}
</style>
```

## 总结

通过遵循本文档的技术规范和注意事项，可以有效避免开发过程中的常见错误，确保设备分组管理页面能够顺利开发和部署。

关键要点：
- ✅ **左右分栏布局**：使用flex布局，左侧固定宽度，右侧自适应
- ✅ **树形组件正确使用**：注意Tree和TreeSelect的数据格式区别
- ✅ **卡片网格响应式**：使用a-row和a-col实现响应式布局
- ✅ **避免在props上使用v-model**，改用属性绑定和事件监听
- ✅ **验证图标存在性**，使用实际存在于`@ant-design/icons-vue`中的图标
- ✅ **使用正确的API导入路径**：`/@/lib/axios`
- ✅ **完善的状态管理**：使用Pinia管理分组树和设备列表状态
- ✅ **友好的交互体验**：加载状态、空状态、错误处理、操作确认
- ✅ **批量操作支持**：支持批量选择、移动、删除等操作
- ✅ **实时统计更新**：自动统计并显示分组和设备数量

通过这些规范和最佳实践，可以确保开发过程顺利进行，减少调试时间，提高开发效率。
