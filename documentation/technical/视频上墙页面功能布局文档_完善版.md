# 视频上墙页面功能与布局文档

## 页面概述
视频上墙页面用于将监控摄像头的回放视频拖拽到电视墙的不同窗口进行展示,支持多种电视墙布局(4x4/3x3/2x2等),提供预案管理、窗口控制、批量操作等功能。该页面基于SmartAdmin前端框架构建,采用Vue3 + Ant Design Vue技术栈,实现拖拽上墙、同步播放、预案保存等核心功能。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **拖拽库**: VueDraggable Next (vue3版本)
- **视频播放器**: jessibuca 3.x (推荐用于低延迟流媒体)

### 拖拽库安装
```bash
npm install vuedraggable@next
```

### 项目文件组织结构
```
src/views/business/smart-video/
├── video-on-wall.vue                # 视频上墙主页面
├── components/
│   ├── DeviceTreeDrag.vue          # 设备树拖拽源组件
│   ├── TVWallGrid.vue              # 电视墙网格组件(拖拽目标)
│   ├── WallWindowCell.vue          # 单个窗口单元格组件
│   ├── SchemeManage.vue            # 预案管理组件
│   └── DecoderStatus.vue           # 解码器状态组件
├── mock/
│   └── video-wall-mock-data.js     # 模拟数据
├── api/
│   └── video-wall-api.js           # API接口定义
└── utils/
    └── drag-drop-helper.js         # 拖拽辅助工具
```

### API接口设计
```javascript
// src/api/business/smart-video/video-wall-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const videoWallApi = {
  // 获取电视墙列表
  getTVWallList: () => getRequest('/video-wall/list'),

  // 获取电视墙配置
  getTVWallConfig: (wallId) => getRequest(`/video-wall/config/${wallId}`),

  // 获取设备树
  getDeviceTree: () => getRequest('/video-wall/device/tree'),

  // 获取解码器状态
  getDecoderStatus: () => getRequest('/video-wall/decoder/status'),

  // 加载回放到窗口
  loadPlaybackToWindow: (params) => postRequest('/video-wall/playback/load', params),

  // 清除窗口
  clearWindow: (params) => postRequest('/video-wall/window/clear', params),

  // 交换窗口
  swapWindows: (params) => postRequest('/video-wall/window/swap', params),

  // 同步播放
  syncPlayback: (params) => postRequest('/video-wall/playback/sync', params),

  // 停止播放
  stopPlayback: (params) => postRequest('/video-wall/playback/stop', params),

  // 保存预案
  saveScheme: (params) => postRequest('/video-wall/scheme/save', params),

  // 获取预案列表
  getSchemeList: () => getRequest('/video-wall/scheme/list'),

  // 应用预案
  applyScheme: (schemeId) => postRequest(`/video-wall/scheme/apply/${schemeId}`),

  // 删除预案
  deleteScheme: (schemeId) => postRequest(`/video-wall/scheme/delete/${schemeId}`),

  // 电视墙截图
  captureWallSnapshot: (params) => postRequest('/video-wall/snapshot/capture', params),
};
```

## 开发注意事项

### 1. 拖拽功能实现要点

#### 使用HTML5原生拖拽API
```vue
<template>
  <!-- 拖拽源：设备树节点 -->
  <div
    class="device-node"
    draggable="true"
    @dragstart="handleDragStart"
    @dragend="handleDragEnd"
  >
    <CameraOutlined />
    <span>{{ device.name }}</span>
  </div>

  <!-- 拖拽目标：电视墙窗口 -->
  <div
    class="wall-window"
    @drop="handleDrop"
    @dragover="handleDragOver"
    @dragenter="handleDragEnter"
    @dragleave="handleDragLeave"
  >
    <!-- 窗口内容 -->
  </div>
</template>

<script setup>
// 拖拽开始
const handleDragStart = (event, device) => {
  // 设置拖拽数据
  event.dataTransfer.effectAllowed = 'copy';
  event.dataTransfer.setData('application/json', JSON.stringify({
    deviceId: device.id,
    deviceName: device.name,
    channelId: device.channelId,
  }));
};

// 拖拽结束
const handleDragEnd = (event) => {
  // 清理拖拽状态
};

// 拖拽经过目标
const handleDragOver = (event) => {
  event.preventDefault(); // 必须阻止默认行为才能触发drop
  event.dataTransfer.dropEffect = 'copy';
};

// 进入拖拽目标
const handleDragEnter = (event) => {
  event.currentTarget.classList.add('drag-over');
};

// 离开拖拽目标
const handleDragLeave = (event) => {
  event.currentTarget.classList.remove('drag-over');
};

// 放置到目标
const handleDrop = (event, windowIndex) => {
  event.preventDefault();
  event.currentTarget.classList.remove('drag-over');

  const data = JSON.parse(event.dataTransfer.getData('application/json'));

  // 调用API加载视频到窗口
  loadVideoToWindow(windowIndex, data);
};
</script>

<style scoped lang="less">
.device-node {
  cursor: move;

  &:active {
    opacity: 0.6;
  }
}

.wall-window {
  position: relative;

  &.drag-over {
    outline: 3px dashed #1890ff;
    background: rgba(24, 144, 255, 0.1);
  }
}
</style>
```

### 2. 图标使用规范

#### 正确的图标导入
```vue
<script setup>
import {
  CameraOutlined,          // 摄像头
  VideoCameraOutlined,     // 录像机
  DesktopOutlined,         // 电视墙
  PlayCircleOutlined,      // 播放
  PauseCircleOutlined,     // 暂停
  StopOutlined,            // 停止
  SyncOutlined,            // 同步
  DeleteOutlined,          // 清除
  SwapOutlined,            // 交换
  ExpandOutlined,          // 全屏
  SaveOutlined,            // 保存
  FolderOutlined,          // 文件夹
  AppstoreOutlined,        // 网格布局
  PictureOutlined,         // 截图
  SettingOutlined,         // 设置
  ReloadOutlined,          // 刷新
} from '@ant-design/icons-vue';
</script>
```

### 3. 窗口状态管理

#### 使用Pinia管理电视墙状态
```javascript
// src/store/modules/business/video-wall-store.js
import { defineStore } from 'pinia';

export const useVideoWallStore = defineStore('videoWall', {
  state: () => ({
    currentWall: null,          // 当前选中的电视墙
    wallLayout: '4x4',          // 当前布局
    windows: [],                // 窗口列表
    selectedWindows: [],        // 选中的窗口
    isPlaying: false,           // 是否正在播放
    isSyncing: false,           // 是否同步播放中
  }),

  actions: {
    // 设置当前电视墙
    setCurrentWall(wall) {
      this.currentWall = wall;
      this.initWindows();
    },

    // 初始化窗口
    initWindows() {
      const [rows, cols] = this.wallLayout.split('x').map(Number);
      const totalWindows = rows * cols;

      this.windows = Array.from({ length: totalWindows }, (_, index) => ({
        id: index,
        deviceId: null,
        deviceName: null,
        channelId: null,
        streamUrl: null,
        isPlaying: false,
        progress: 0,
      }));
    },

    // 加载视频到窗口
    loadVideoToWindow(windowIndex, deviceData) {
      if (this.windows[windowIndex]) {
        this.windows[windowIndex] = {
          ...this.windows[windowIndex],
          deviceId: deviceData.deviceId,
          deviceName: deviceData.deviceName,
          channelId: deviceData.channelId,
          streamUrl: deviceData.streamUrl,
        };
      }
    },

    // 清除窗口
    clearWindow(windowIndex) {
      if (this.windows[windowIndex]) {
        this.windows[windowIndex] = {
          id: windowIndex,
          deviceId: null,
          deviceName: null,
          channelId: null,
          streamUrl: null,
          isPlaying: false,
          progress: 0,
        };
      }
    },

    // 交换窗口
    swapWindows(index1, index2) {
      const temp = { ...this.windows[index1] };
      this.windows[index1] = { ...this.windows[index2], id: index1 };
      this.windows[index2] = { ...temp, id: index2 };
    },

    // 批量清除
    clearSelectedWindows() {
      this.selectedWindows.forEach(index => {
        this.clearWindow(index);
      });
      this.selectedWindows = [];
    },

    // 切换布局
    changeLayout(newLayout) {
      this.wallLayout = newLayout;
      this.initWindows();
    },
  },
});
```

## 核心功能模块

### 1. 顶部工具栏

**功能说明**:
- 电视墙选择
- 日期时间选择
- 回放控制(加载、同步播放、停止)
- 布局编辑
- 墙面截图

**技术实现**:
```vue
<!-- src/views/business/smart-video/video-on-wall.vue -->
<template>
  <div class="video-wall-page">
    <!-- 顶部工具栏 -->
    <div class="toolbar">
      <div class="toolbar-left">
        <!-- 电视墙选择 -->
        <a-space>
          <span>电视墙:</span>
          <a-select
            v-model:value="currentWallId"
            style="width: 200px;"
            @change="handleWallChange"
          >
            <a-select-option
              v-for="wall in wallList"
              :key="wall.id"
              :value="wall.id"
            >
              {{ wall.name }} ({{ wall.layout }})
            </a-select-option>
          </a-select>
        </a-space>

        <!-- 日期选择 -->
        <a-space>
          <span>日期:</span>
          <a-date-picker v-model:value="playbackDate" />
        </a-space>

        <!-- 时间段 -->
        <a-space>
          <span>时间段:</span>
          <a-select v-model:value="timePeriod" style="width: 150px;">
            <a-select-option value="morning">上午 (06:00-12:00)</a-select-option>
            <a-select-option value="afternoon">下午 (12:00-18:00)</a-select-option>
            <a-select-option value="evening">晚上 (18:00-24:00)</a-select-option>
            <a-select-option value="custom">自定义</a-select-option>
          </a-select>
        </a-space>

        <!-- 自定义时间 -->
        <a-space v-if="timePeriod === 'custom'">
          <a-time-picker v-model:value="startTime" format="HH:mm" />
          <span>至</span>
          <a-time-picker v-model:value="endTime" format="HH:mm" />
        </a-space>
      </div>

      <div class="toolbar-right">
        <a-space>
          <a-button type="primary" @click="handleLoadPlayback">
            <template #icon><PlayCircleOutlined /></template>
            加载回放
          </a-button>

          <a-button type="primary" @click="handleSyncPlayback">
            <template #icon><SyncOutlined /></template>
            同步播放
          </a-button>

          <a-button danger @click="handleStopPlayback">
            <template #icon><StopOutlined /></template>
            停止回放
          </a-button>

          <a-button @click="handleOpenLayoutEditor">
            <template #icon><AppstoreOutlined /></template>
            布局编辑
          </a-button>

          <a-button @click="handleCaptureWall">
            <template #icon><PictureOutlined /></template>
            墙面截图
          </a-button>
        </a-space>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  PlayCircleOutlined,
  SyncOutlined,
  StopOutlined,
  AppstoreOutlined,
  PictureOutlined,
} from '@ant-design/icons-vue';
import { videoWallApi } from '/@/api/business/smart-video/video-wall-api';
import { useVideoWallStore } from '/@/store/modules/business/video-wall-store';

const videoWallStore = useVideoWallStore();

const currentWallId = ref('wall1');
const wallList = ref([]);
const playbackDate = ref(null);
const timePeriod = ref('morning');
const startTime = ref(null);
const endTime = ref(null);

onMounted(async () => {
  await loadWallList();
});

// 加载电视墙列表
const loadWallList = async () => {
  try {
    const res = await videoWallApi.getTVWallList();
    wallList.value = res.data || mockWallList;
  } catch (error) {
    console.error('加载电视墙列表失败:', error);
  }
};

// 电视墙切换
const handleWallChange = async (wallId) => {
  try {
    const res = await videoWallApi.getTVWallConfig(wallId);
    videoWallStore.setCurrentWall(res.data);
  } catch (error) {
    console.error('切换电视墙失败:', error);
  }
};

// 加载回放
const handleLoadPlayback = () => {
  message.success('正在加载回放...');
};

// 同步播放
const handleSyncPlayback = async () => {
  try {
    await videoWallApi.syncPlayback({
      wallId: currentWallId.value,
      windows: videoWallStore.windows,
    });
    videoWallStore.isSyncing = true;
    message.success('开始同步播放');
  } catch (error) {
    message.error('同步播放失败');
  }
};

// 停止回放
const handleStopPlayback = async () => {
  try {
    await videoWallApi.stopPlayback({
      wallId: currentWallId.value,
    });
    videoWallStore.isSyncing = false;
    message.success('已停止回放');
  } catch (error) {
    message.error('停止回放失败');
  }
};

// Mock数据
const mockWallList = [
  { id: 'wall1', name: '主监控墙', layout: '4x4' },
  { id: 'wall2', name: '会议室墙', layout: '2x2' },
  { id: 'wall3', name: '大厅墙', layout: '3x3' },
];
</script>

<style scoped lang="less">
.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: #fff;
  border-radius: 8px;
  margin-bottom: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>
```

### 2. 左侧解码器状态面板

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/DecoderStatus.vue -->
<template>
  <div class="decoder-panel">
    <div class="panel-header">
      <DesktopOutlined />
      <span>解码器状态</span>
    </div>

    <div class="decoder-list">
      <div
        v-for="decoder in decoderList"
        :key="decoder.id"
        class="decoder-item"
      >
        <div class="decoder-header">
          <span class="decoder-name">{{ decoder.name }}</span>
          <span
            class="status-dot"
            :class="{ online: decoder.status === 'online' }"
          ></span>
        </div>

        <div class="decoder-info">
          <div class="info-row">
            <span>IP:</span>
            <span>{{ decoder.ip }}</span>
          </div>
          <div class="info-row">
            <span>型号:</span>
            <span>{{ decoder.model }}</span>
          </div>
          <div class="info-row">
            <span>通道:</span>
            <span>{{ decoder.channels }}</span>
          </div>
          <div class="info-row">
            <span>CPU:</span>
            <span>{{ decoder.cpu }}%</span>
          </div>
          <div class="info-row">
            <span>内存:</span>
            <span>{{ decoder.memory }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 统计信息 -->
    <div class="decoder-stats">
      <div class="stat-item">
        <span>在线解码器:</span>
        <span class="stat-value online">{{ stats.online }}台</span>
      </div>
      <div class="stat-item">
        <span>总通道数:</span>
        <span class="stat-value">{{ stats.totalChannels }}</span>
      </div>
      <div class="stat-item">
        <span>使用通道:</span>
        <span class="stat-value used">{{ stats.usedChannels }}</span>
      </div>
      <div class="stat-item">
        <span>平均负载:</span>
        <span class="stat-value">{{ stats.avgLoad }}%</span>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { DesktopOutlined } from '@ant-design/icons-vue';
import { videoWallApi } from '/@/api/business/smart-video/video-wall-api';

const decoderList = ref([]);
const stats = ref({
  online: 0,
  totalChannels: 0,
  usedChannels: 0,
  avgLoad: 0,
});

onMounted(async () => {
  await loadDecoderStatus();
});

const loadDecoderStatus = async () => {
  try {
    const res = await videoWallApi.getDecoderStatus();
    decoderList.value = res.data?.list || mockDecoders;
    stats.value = res.data?.stats || mockStats;
  } catch (error) {
    console.error('加载解码器状态失败:', error);
  }
};

// Mock数据
const mockDecoders = [
  {
    id: 'dec001',
    name: 'DEC001',
    ip: '192.168.1.301',
    model: 'DS-6408HD-T',
    channels: '1-4 (使用中)',
    cpu: 45,
    memory: 68,
    status: 'online',
  },
  {
    id: 'dec002',
    name: 'DEC002',
    ip: '192.168.1.302',
    model: 'DH-NVR4216-4KS2',
    channels: '5-12 (使用中)',
    cpu: 72,
    memory: 85,
    status: 'online',
  },
];

const mockStats = {
  online: 2,
  totalChannels: 16,
  usedChannels: 12,
  avgLoad: 65,
};
</script>

<style scoped lang="less">
.decoder-panel {
  width: 260px;
  background: #fff;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  height: 100%;

  .panel-header {
    padding: 16px;
    font-size: 16px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px solid #f0f0f0;
  }

  .decoder-list {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
  }

  .decoder-item {
    padding: 12px;
    background: #f5f5f5;
    border-radius: 6px;
    margin-bottom: 12px;

    .decoder-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;

      .decoder-name {
        font-weight: 500;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ff4d4f;

        &.online {
          background: #52c41a;
        }
      }
    }

    .decoder-info {
      .info-row {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #666;
        margin-bottom: 4px;
      }
    }
  }

  .decoder-stats {
    padding: 12px;
    border-top: 1px solid #f0f0f0;
    background: #fafafa;

    .stat-item {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 8px;

      .stat-value {
        font-weight: 600;

        &.online {
          color: #52c41a;
        }

        &.used {
          color: #1890ff;
        }
      }
    }
  }
}
</style>
```

### 3. 电视墙窗口网格(拖拽目标)

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/TVWallGrid.vue -->
<template>
  <div class="tv-wall-container">
    <!-- 电视墙头部 -->
    <div class="wall-header">
      <div class="header-left">
        <h3>{{ wallConfig.name }} - {{ wallConfig.layout }}布局</h3>
        <p>当前时间: {{ currentTime }}</p>
      </div>

      <div class="header-right">
        <a-space>
          <span>布局:</span>
          <a-select
            v-model:value="layoutValue"
            style="width: 120px;"
            @change="handleLayoutChange"
          >
            <a-select-option value="2x2">2x2</a-select-option>
            <a-select-option value="3x3">3x3</a-select-option>
            <a-select-option value="4x4">4x4</a-select-option>
            <a-select-option value="1x4">1x4</a-select-option>
            <a-select-option value="4x1">4x1</a-select-option>
          </a-select>
        </a-space>
      </div>
    </div>

    <!-- 电视墙显示区域 -->
    <div class="wall-display">
      <div
        class="wall-grid"
        :style="gridStyle"
      >
        <WallWindowCell
          v-for="(window, index) in windows"
          :key="window.id"
          :window="window"
          :index="index"
          :selected="selectedWindows.includes(index)"
          @drop="handleWindowDrop"
          @select="handleWindowSelect"
          @clear="handleWindowClear"
          @fullscreen="handleWindowFullscreen"
        />
      </div>
    </div>

    <!-- 底部控制栏 -->
    <div class="wall-footer">
      <div class="footer-left">
        <a-space>
          <span
            v-if="isPlaying"
            class="status-indicator playing"
          >
            <span class="dot"></span>
            <span>同步播放中</span>
          </span>

          <a-button
            type="primary"
            :icon="isPlaying ? h(PauseCircleOutlined) : h(PlayCircleOutlined)"
            @click="togglePlay"
          >
            {{ isPlaying ? '暂停' : '播放' }}
          </a-button>

          <a-button danger @click="handleStopAll">
            <template #icon><StopOutlined /></template>
            停止
          </a-button>

          <a-button @click="handleMute">
            <template #icon><SoundOutlined /></template>
          </a-button>

          <a-slider
            v-model:value="volume"
            :min="0"
            :max="100"
            style="width: 100px;"
          />

          <a-select v-model:value="playSpeed" style="width: 80px;">
            <a-select-option :value="0.5">0.5x</a-select-option>
            <a-select-option :value="1">1x</a-select-option>
            <a-select-option :value="2">2x</a-select-option>
            <a-select-option :value="4">4x</a-select-option>
          </a-select>

          <a-checkbox v-model:checked="loopPlay">循环播放</a-checkbox>
        </a-space>
      </div>

      <div class="footer-right">
        <span>总时长: {{ totalDuration }}</span>
        <span>当前: {{ currentDuration }}</span>
        <span>进度: {{ progress }}%</span>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, h, onMounted, onUnmounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  PlayCircleOutlined,
  PauseCircleOutlined,
  StopOutlined,
  SoundOutlined,
} from '@ant-design/icons-vue';
import WallWindowCell from './WallWindowCell.vue';
import { useVideoWallStore } from '/@/store/modules/business/video-wall-store';

const videoWallStore = useVideoWallStore();

const layoutValue = ref('4x4');
const currentTime = ref('');
const isPlaying = ref(false);
const volume = ref(80);
const playSpeed = ref(1);
const loopPlay = ref(true);
const totalDuration = ref('14:24:00');
const currentDuration = ref('05:02:15');
const progress = ref(35);

const wallConfig = computed(() => ({
  name: '主监控墙',
  layout: layoutValue.value,
}));

const windows = computed(() => videoWallStore.windows);
const selectedWindows = computed(() => videoWallStore.selectedWindows);

const gridStyle = computed(() => {
  const [rows, cols] = layoutValue.value.split('x').map(Number);
  return {
    gridTemplateColumns: `repeat(${cols}, 1fr)`,
    gridTemplateRows: `repeat(${rows}, 1fr)`,
  };
});

let timeTimer = null;

onMounted(() => {
  updateTime();
  timeTimer = setInterval(updateTime, 1000);
});

onUnmounted(() => {
  if (timeTimer) {
    clearInterval(timeTimer);
  }
});

const updateTime = () => {
  const now = new Date();
  currentTime.value = now.toLocaleString('zh-CN');
};

const handleLayoutChange = (value) => {
  videoWallStore.changeLayout(value);
};

const handleWindowDrop = (index, deviceData) => {
  videoWallStore.loadVideoToWindow(index, deviceData);
  message.success(`已将 ${deviceData.deviceName} 加载到窗口 ${index + 1}`);
};

const handleWindowSelect = (index) => {
  const selectedIndex = videoWallStore.selectedWindows.indexOf(index);
  if (selectedIndex > -1) {
    videoWallStore.selectedWindows.splice(selectedIndex, 1);
  } else {
    videoWallStore.selectedWindows.push(index);
  }
};

const handleWindowClear = (index) => {
  videoWallStore.clearWindow(index);
  message.success(`已清除窗口 ${index + 1}`);
};

const handleWindowFullscreen = (index) => {
  // 实现全屏逻辑
  message.info('全屏功能');
};

const togglePlay = () => {
  isPlaying.value = !isPlaying.value;
};

const handleStopAll = () => {
  isPlaying.value = false;
  message.success('已停止所有播放');
};

const handleMute = () => {
  message.info('静音切换');
};
</script>

<style scoped lang="less">
.tv-wall-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;

  .wall-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    border-bottom: 1px solid #f0f0f0;

    h3 {
      margin: 0;
      font-size: 16px;
    }

    p {
      margin: 4px 0 0 0;
      font-size: 12px;
      color: #999;
    }
  }

  .wall-display {
    flex: 1;
    padding: 8px;
    background: #000;
    overflow: hidden;

    .wall-grid {
      display: grid;
      gap: 4px;
      width: 100%;
      height: 100%;
    }
  }

  .wall-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-top: 1px solid #f0f0f0;
    background: #fafafa;

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;

      &.playing .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #52c41a;
        animation: blink 1.5s infinite;
      }
    }

    .footer-right {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #666;
    }
  }
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}
</style>
```

### 4. 单个窗口单元格组件

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/WallWindowCell.vue -->
<template>
  <div
    class="wall-window-cell"
    :class="{ selected: selected, 'has-video': hasVideo, 'drag-over': isDragOver }"
    @drop="handleDrop"
    @dragover="handleDragOver"
    @dragenter="handleDragEnter"
    @dragleave="handleDragLeave"
    @click="handleClick"
  >
    <!-- 窗口信息 -->
    <div v-if="hasVideo" class="window-info">
      <span>{{ window.deviceName }} → CH{{ index + 1 }}</span>
    </div>

    <!-- 窗口控制按钮 -->
    <div v-if="hasVideo" class="window-controls">
      <a-button
        type="text"
        size="small"
        @click.stop="handleFullscreen"
      >
        <template #icon><ExpandOutlined /></template>
      </a-button>

      <a-button
        type="text"
        size="small"
        danger
        @click.stop="handleClear"
      >
        <template #icon><DeleteOutlined /></template>
      </a-button>
    </div>

    <!-- 视频内容 -->
    <div v-if="hasVideo" class="window-content">
      <!-- 这里集成视频播放器组件 -->
      <div class="video-placeholder">
        <VideoCameraOutlined style="font-size: 48px; color: #999;" />
      </div>

      <!-- 播放进度 -->
      <div class="playback-progress">
        <div class="progress-bar" :style="{ width: `${window.progress}%` }"></div>
      </div>
    </div>

    <!-- 空窗口提示 -->
    <div v-else class="empty-window">
      <PlusOutlined style="font-size: 32px; color: #666;" />
      <div>拖拽设备到此处</div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import {
  VideoCameraOutlined,
  PlusOutlined,
  ExpandOutlined,
  DeleteOutlined,
} from '@ant-design/icons-vue';

const props = defineProps({
  window: {
    type: Object,
    required: true,
  },
  index: {
    type: Number,
    required: true,
  },
  selected: {
    type: Boolean,
    default: false,
  },
});

const emit = defineEmits(['drop', 'select', 'clear', 'fullscreen']);

const isDragOver = ref(false);

const hasVideo = computed(() => !!props.window.deviceId);

const handleDragOver = (event) => {
  event.preventDefault();
  event.dataTransfer.dropEffect = 'copy';
};

const handleDragEnter = (event) => {
  isDragOver.value = true;
};

const handleDragLeave = (event) => {
  isDragOver.value = false;
};

const handleDrop = (event) => {
  event.preventDefault();
  isDragOver.value = false;

  try {
    const data = JSON.parse(event.dataTransfer.getData('application/json'));
    emit('drop', props.index, data);
  } catch (error) {
    console.error('拖拽数据解析失败:', error);
  }
};

const handleClick = () => {
  emit('select', props.index);
};

const handleClear = () => {
  emit('clear', props.index);
};

const handleFullscreen = () => {
  emit('fullscreen', props.index);
};
</script>

<style scoped lang="less">
.wall-window-cell {
  position: relative;
  background: #1a1a1a;
  border: 2px solid #333;
  border-radius: 4px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s;

  &.selected {
    border-color: #1890ff;
    box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
  }

  &.drag-over {
    border-color: #52c41a;
    background: rgba(82, 196, 26, 0.1);
  }

  &:hover {
    border-color: #1890ff;

    .window-controls {
      opacity: 1;
    }
  }

  .window-info {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0, 0, 0, 0.75);
    color: #fff;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 10;
  }

  .window-controls {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 10;

    .ant-btn {
      color: #fff;
      background: rgba(0, 0, 0, 0.5);

      &:hover {
        background: rgba(0, 0, 0, 0.75);
      }
    }
  }

  .window-content {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;

    .video-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .playback-progress {
      position: absolute;
      bottom: 8px;
      left: 8px;
      width: 60px;
      height: 4px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 2px;
      overflow: hidden;

      .progress-bar {
        height: 100%;
        background: #52c41a;
        transition: width 0.3s;
      }
    }
  }

  .empty-window {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #666;

    div {
      margin-top: 8px;
      font-size: 12px;
    }
  }
}
</style>
```

### 5. 预案管理组件

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/SchemeManage.vue -->
<template>
  <a-dropdown :trigger="['click']">
    <a-button>
      <template #icon><FolderOutlined /></template>
      预案管理
    </a-button>

    <template #overlay>
      <a-menu>
        <a-menu-item key="save" @click="handleSaveScheme">
          <SaveOutlined />
          <span>保存当前预案</span>
        </a-menu-item>

        <a-menu-divider />

        <a-sub-menu key="apply" title="应用预案">
          <a-menu-item
            v-for="scheme in schemeList"
            :key="scheme.id"
            @click="handleApplyScheme(scheme)"
          >
            <span>{{ scheme.name }}</span>
            <a-button
              type="text"
              size="small"
              danger
              @click.stop="handleDeleteScheme(scheme.id)"
            >
              <template #icon><DeleteOutlined /></template>
            </a-button>
          </a-menu-item>

          <a-menu-item v-if="schemeList.length === 0" disabled>
            暂无预案
          </a-menu-item>
        </a-sub-menu>
      </a-menu>
    </template>
  </a-dropdown>

  <!-- 保存预案对话框 -->
  <a-modal
    v-model:open="saveModalVisible"
    title="保存预案"
    @ok="handleSaveConfirm"
  >
    <a-form :model="schemeForm" layout="vertical">
      <a-form-item label="预案名称" required>
        <a-input
          v-model:value="schemeForm.name"
          placeholder="请输入预案名称"
        />
      </a-form-item>

      <a-form-item label="预案描述">
        <a-textarea
          v-model:value="schemeForm.description"
          :rows="3"
          placeholder="请输入预案描述"
        />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  FolderOutlined,
  SaveOutlined,
  DeleteOutlined,
} from '@ant-design/icons-vue';
import { videoWallApi } from '/@/api/business/smart-video/video-wall-api';
import { useVideoWallStore } from '/@/store/modules/business/video-wall-store';

const videoWallStore = useVideoWallStore();

const saveModalVisible = ref(false);
const schemeList = ref([]);
const schemeForm = ref({
  name: '',
  description: '',
});

onMounted(async () => {
  await loadSchemeList();
});

// 加载预案列表
const loadSchemeList = async () => {
  try {
    const res = await videoWallApi.getSchemeList();
    schemeList.value = res.data || mockSchemes;
  } catch (error) {
    console.error('加载预案列表失败:', error);
  }
};

// 保存预案
const handleSaveScheme = () => {
  saveModalVisible.value = true;
  schemeForm.value = {
    name: '',
    description: '',
  };
};

// 确认保存
const handleSaveConfirm = async () => {
  if (!schemeForm.value.name) {
    message.warning('请输入预案名称');
    return;
  }

  try {
    await videoWallApi.saveScheme({
      ...schemeForm.value,
      wallId: videoWallStore.currentWall?.id,
      windows: videoWallStore.windows,
      layout: videoWallStore.wallLayout,
    });

    message.success('预案保存成功');
    saveModalVisible.value = false;
    await loadSchemeList();
  } catch (error) {
    message.error('预案保存失败');
  }
};

// 应用预案
const handleApplyScheme = async (scheme) => {
  try {
    const res = await videoWallApi.applyScheme(scheme.id);

    // 更新电视墙状态
    videoWallStore.changeLayout(res.data.layout);
    res.data.windows.forEach((window, index) => {
      if (window.deviceId) {
        videoWallStore.loadVideoToWindow(index, window);
      }
    });

    message.success(`已应用预案: ${scheme.name}`);
  } catch (error) {
    message.error('应用预案失败');
  }
};

// 删除预案
const handleDeleteScheme = (schemeId) => {
  Modal.confirm({
    title: '确认删除',
    content: '确定要删除该预案吗?',
    onOk: async () => {
      try {
        await videoWallApi.deleteScheme(schemeId);
        message.success('预案删除成功');
        await loadSchemeList();
      } catch (error) {
        message.error('预案删除失败');
      }
    },
  });
};

// Mock数据
const mockSchemes = [
  { id: 1, name: '全景监控预案', description: '全区域监控布局' },
  { id: 2, name: '重点区域预案', description: '重点区域重点监控' },
];
</script>
```

## Mock数据示例

```javascript
// src/views/business/smart-video/mock/video-wall-mock-data.js

export const mockTVWalls = [
  {
    id: 'wall1',
    name: '主监控墙',
    layout: '4x4',
    windows: 16,
  },
  {
    id: 'wall2',
    name: '会议室墙',
    layout: '2x2',
    windows: 4,
  },
];

export const mockDecoders = [
  {
    id: 'dec001',
    name: 'DEC001',
    ip: '192.168.1.301',
    model: 'DS-6408HD-T',
    channels: '1-4 (使用中)',
    cpu: 45,
    memory: 68,
    status: 'online',
  },
];

export const mockSchemes = [
  {
    id: 1,
    name: '全景监控预案',
    description: '全区域监控布局',
    wallId: 'wall1',
    layout: '4x4',
    windows: [],
  },
];
```

## 路由配置

```javascript
// src/router/business/smart-video.js
export const smartVideoRouters = [
  {
    path: '/business/smart-video/video-on-wall',
    name: 'SmartVideoOnWall',
    component: () => import('/@/views/business/smart-video/video-on-wall.vue'),
    meta: {
      title: '智能视频 - 视频上墙',
      menuType: MENU_TYPE_ENUM.MENU.value,
      icon: 'DesktopOutlined',
      hideInMenu: false,
      keepAlive: true,
    },
  },
];
```

## 菜单配置

```javascript
// src/store/modules/system/user.js
const videoOnWallMenu = {
  menuId: maxMenuId + 1003,
  menuName: '视频上墙',
  menuTitle: '视频上墙',
  menuType: MENU_TYPE_ENUM.MENU.value,
  parentId: smartVideoMenu.menuId,
  path: '/business/smart-video/video-on-wall',
  component: '/business/smart-video/video-on-wall.vue',
  icon: 'DesktopOutlined',
  visibleFlag: true,
  disabledFlag: false,
  cacheFlag: true,
  sort: 3,
};
```

## 开发注意事项总结

### 拖拽功能注意事项
- 必须在dragover事件中调用`event.preventDefault()`才能触发drop事件
- 使用`event.dataTransfer.setData()`和`getData()`传递数据
- 使用CSS类标记拖拽状态,提升用户体验

### 窗口状态管理
- 使用Pinia统一管理电视墙和窗口状态
- 窗口数据结构要包含设备信息、播放状态、进度等
- 支持窗口选择、批量操作

### 性能优化
- 限制同时播放的视频数量
- 及时销毁未使用的播放器实例
- 使用虚拟滚动处理大量设备列表

### 图标使用
- 只使用@ant-design/icons-vue中实际存在的图标
- 避免使用不存在的图标名称

## 总结

视频上墙页面的核心功能包括:
- 拖拽上墙操作(HTML5原生拖拽API)
- 电视墙多布局支持(CSS Grid动态布局)
- 窗口控制(清除、全屏、交换)
- 预案管理(保存、应用、删除)
- 解码器状态监控
- 同步播放控制

通过遵循本文档的技术规范,可以开发出功能完善、操作流畅的视频上墙系统。
