# é—¨ç¦ç³»ç»Ÿè®¾å¤‡æ—¶é—´åŒæ­¥åŠŸèƒ½è¡¥å……å®ŒæˆæŠ¥å‘Š

> **ğŸ“‹ å®Œæˆæ—¶é—´**: 2025-11-19  
> **ğŸ“‹ åŠŸèƒ½**: è®¾å¤‡æ—¶é—´åŒæ­¥å‰åç«¯å®Œæ•´å®ç°  
> **ğŸ“‹ çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## âœ… ä¸€ã€å®Œæˆå†…å®¹

### 1. å‰ç«¯APIæ¥å£ âœ…

**æ–‡ä»¶**: `smart-admin-web-javascript/src/api/business/access/device-api.js`

**æ–°å¢æ–¹æ³•**:
```javascript
/**
 * åŒæ­¥è®¾å¤‡æ—¶é—´
 */
syncDeviceTime: (deviceId) => {
  return postRequest(`/api/smart/access/device/syncTime/${deviceId}`);
},
```

**æ¥å£è·¯å¾„**: `/api/smart/access/device/syncTime/{deviceId}`  
**è¯·æ±‚æ–¹å¼**: POST  
**å‚æ•°**: `deviceId` (è·¯å¾„å‚æ•°)

---

### 2. å‰ç«¯Storeæ–¹æ³• âœ…

**æ–‡ä»¶**: `smart-admin-web-javascript/src/stores/access-device.js`

**æ–°å¢æ–¹æ³•**:
```javascript
/**
 * åŒæ­¥è®¾å¤‡æ—¶é—´
 */
async syncDeviceTime(deviceId) {
  try {
    const loadingKey = `syncTime-${deviceId}`;
    this.controlLoadingMap.set(loadingKey, true);

    const response = await accessDeviceApi.syncDeviceTime(deviceId);

    if (response.code === 200) {
      message.success('è®¾å¤‡æ—¶é—´åŒæ­¥æˆåŠŸ');
      return true;
    } else {
      message.error(response.message || 'è®¾å¤‡æ—¶é—´åŒæ­¥å¤±è´¥');
      return false;
    }
  } catch (error) {
    console.error('è®¾å¤‡æ—¶é—´åŒæ­¥å¤±è´¥:', error);
    message.error('è®¾å¤‡æ—¶é—´åŒæ­¥å¤±è´¥');
    return false;
  } finally {
    this.controlLoadingMap.delete(`syncTime-${deviceId}`);
  }
}
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… åŠ è½½çŠ¶æ€ç®¡ç†
- âœ… æˆåŠŸ/å¤±è´¥æ¶ˆæ¯æç¤º
- âœ… å¼‚å¸¸å¤„ç†
- âœ… é”™è¯¯æ—¥å¿—è®°å½•

---

### 3. å‰ç«¯é¡µé¢UI âœ…

**æ–‡ä»¶**: `smart-admin-web-javascript/src/views/business/access/device/index.vue`

**æ–°å¢èœå•é¡¹**:
```vue
<a-menu-item @click="handleSyncDeviceTime(record)">
  <ClockCircleOutlined />
  æ—¶é—´åŒæ­¥
</a-menu-item>
```

**æ–°å¢å¤„ç†æ–¹æ³•**:
```javascript
const handleSyncDeviceTime = (device) => {
  Modal.confirm({
    title: 'æ—¶é—´åŒæ­¥ç¡®è®¤',
    content: `ç¡®å®šè¦å°†æœåŠ¡å™¨æ—¶é—´åŒæ­¥åˆ°è®¾å¤‡ "${device.deviceName}" å—ï¼Ÿ`,
    okText: 'ç¡®è®¤åŒæ­¥',
    cancelText: 'å–æ¶ˆ',
    onOk: async () => {
      const success = await deviceStore.syncDeviceTime(device.deviceId);
      if (success) {
        message.success('è®¾å¤‡æ—¶é—´åŒæ­¥æˆåŠŸ');
      }
    },
  });
};
```

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… ç¡®è®¤å¯¹è¯æ¡†
- âœ… è®¾å¤‡åç§°æ˜¾ç¤º
- âœ… æ“ä½œç»“æœæç¤º
- âœ… å›¾æ ‡ä½¿ç”¨ `ClockCircleOutlined`

---

## âœ… äºŒã€åç«¯å®ç°å›é¡¾

### 1. Controllerå±‚ âœ…

**æ–‡ä»¶**: `AccessDeviceController.java`

**æ¥å£**:
```java
@Operation(summary = "åŒæ­¥è®¾å¤‡æ—¶é—´", description = "åŒæ­¥æœåŠ¡å™¨æ—¶é—´åˆ°é—¨ç¦è®¾å¤‡")
@SaCheckPermission("smart:access:device:control")
@PostMapping("/syncTime/{accessDeviceId}")
public ResponseDTO<String> syncDeviceTime(@PathVariable Long accessDeviceId)
```

**è·¯å¾„**: `/api/smart/access/device/syncTime/{accessDeviceId}`

---

### 2. Serviceå±‚ âœ…

**æ–‡ä»¶**: `AccessDeviceServiceImpl.java`

**æ–¹æ³•**: `syncDeviceTime(Long accessDeviceId)`

**åŠŸèƒ½**:
- âœ… è®¾å¤‡å­˜åœ¨æ€§éªŒè¯
- âœ… è®¾å¤‡åœ¨çº¿çŠ¶æ€æ£€æŸ¥
- âœ… åè®®é€‚é…å™¨è°ƒç”¨
- âœ… å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•

---

### 3. åè®®é€‚é…å™¨å±‚ âœ…

**å·²å®ç°**:
- âœ… `TcpProtocolAdapter.syncDeviceTime()` - TCPåè®®å®ç°
- âœ… `HttpProtocolAdapter.syncDeviceTime()` - HTTPåè®®å®ç°
- âœ… æ—¶é—´æ ¼å¼ï¼š`yyyy-MM-dd HH:mm:ss`
- âœ… é‡è¯•æœºåˆ¶å’Œè¶…æ—¶æ§åˆ¶

---

## ğŸ“Š ä¸‰ã€åŠŸèƒ½å¯¹é½æƒ…å†µ

### å‰åç«¯å¯¹é½çŠ¶æ€ âœ…

| å±‚çº§ | åç«¯ | å‰ç«¯ | å¯¹é½çŠ¶æ€ |
|------|------|------|---------|
| APIæ¥å£ | âœ… | âœ… | âœ… å®Œå…¨å¯¹é½ |
| ä¸šåŠ¡é€»è¾‘ | âœ… | âœ… | âœ… å®Œå…¨å¯¹é½ |
| UIç•Œé¢ | âœ… | âœ… | âœ… å®Œå…¨å¯¹é½ |
| é”™è¯¯å¤„ç† | âœ… | âœ… | âœ… å®Œå…¨å¯¹é½ |
| ç”¨æˆ·æç¤º | âœ… | âœ… | âœ… å®Œå…¨å¯¹é½ |

---

## ğŸ¯ å››ã€ä½¿ç”¨è¯´æ˜

### æ“ä½œæµç¨‹

1. **è¿›å…¥è®¾å¤‡ç®¡ç†é¡µé¢**
   - è·¯å¾„ï¼š`/business/access/device`

2. **é€‰æ‹©è®¾å¤‡**
   - åœ¨è®¾å¤‡åˆ—è¡¨ä¸­æ‰¾åˆ°éœ€è¦åŒæ­¥æ—¶é—´çš„è®¾å¤‡

3. **æ‰§è¡Œæ—¶é—´åŒæ­¥**
   - ç‚¹å‡»è®¾å¤‡æ“ä½œåˆ—çš„"æ›´å¤š"æŒ‰é’®
   - åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©"æ—¶é—´åŒæ­¥"
   - ç¡®è®¤åŒæ­¥æ“ä½œ

4. **æŸ¥çœ‹ç»“æœ**
   - æˆåŠŸï¼šæ˜¾ç¤º"è®¾å¤‡æ—¶é—´åŒæ­¥æˆåŠŸ"æç¤º
   - å¤±è´¥ï¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯

---

## ğŸ” äº”ã€æŠ€æœ¯ç»†èŠ‚

### 1. APIè·¯å¾„å¯¹é½

**åç«¯è·¯å¾„**: `/api/smart/access/device/syncTime/{accessDeviceId}`  
**å‰ç«¯è°ƒç”¨**: `/api/smart/access/device/syncTime/${deviceId}`  
**å¯¹é½çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

### 2. å“åº”æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": "è®¾å¤‡æ—¶é—´åŒæ­¥æˆåŠŸ",
  "msg": "æ“ä½œæˆåŠŸ"
}
```

**å¤±è´¥å“åº”**:
```json
{
  "code": 500,
  "data": null,
  "msg": "è®¾å¤‡æ—¶é—´åŒæ­¥å¤±è´¥: [å…·ä½“é”™è¯¯ä¿¡æ¯]"
}
```

### 3. æƒé™æ§åˆ¶

**åç«¯æƒé™**: `smart:access:device:control`  
**å‰ç«¯æƒé™**: é€šè¿‡ `@SaCheckPermission` æ³¨è§£æ§åˆ¶

---

## âœ… å…­ã€æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•

- [ ] æµ‹è¯•åœ¨çº¿è®¾å¤‡æ—¶é—´åŒæ­¥
- [ ] æµ‹è¯•ç¦»çº¿è®¾å¤‡æ—¶é—´åŒæ­¥ï¼ˆåº”æç¤ºè®¾å¤‡ç¦»çº¿ï¼‰
- [ ] æµ‹è¯•TCPåè®®è®¾å¤‡æ—¶é—´åŒæ­¥
- [ ] æµ‹è¯•HTTPåè®®è®¾å¤‡æ—¶é—´åŒæ­¥
- [ ] æµ‹è¯•ç½‘ç»œå¼‚å¸¸æƒ…å†µå¤„ç†

### 2. UIæµ‹è¯•

- [ ] æµ‹è¯•èœå•é¡¹æ˜¾ç¤º
- [ ] æµ‹è¯•ç¡®è®¤å¯¹è¯æ¡†
- [ ] æµ‹è¯•æˆåŠŸ/å¤±è´¥æç¤º
- [ ] æµ‹è¯•åŠ è½½çŠ¶æ€æ˜¾ç¤º

### 3. é›†æˆæµ‹è¯•

- [ ] å‰åç«¯è”è°ƒæµ‹è¯•
- [ ] å¤šè®¾å¤‡å¹¶å‘åŒæ­¥æµ‹è¯•
- [ ] å¼‚å¸¸åœºæ™¯æµ‹è¯•

---

## ğŸ“ ä¸ƒã€ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `smart-admin-web-javascript/src/api/business/access/device-api.js`
   - æ–°å¢ `syncDeviceTime` æ–¹æ³•

2. âœ… `smart-admin-web-javascript/src/stores/access-device.js`
   - æ–°å¢ `syncDeviceTime` æ–¹æ³•

3. âœ… `smart-admin-web-javascript/src/views/business/access/device/index.vue`
   - æ–°å¢æ—¶é—´åŒæ­¥èœå•é¡¹
   - æ–°å¢ `handleSyncDeviceTime` æ–¹æ³•
   - å¯¼å…¥ `ClockCircleOutlined` å›¾æ ‡

---

## ğŸ‰ å…«ã€å®Œæˆæ€»ç»“

### å®ŒæˆçŠ¶æ€

âœ… **è®¾å¤‡æ—¶é—´åŒæ­¥åŠŸèƒ½å·²å®Œæ•´å®ç°**ï¼Œå‰åç«¯å®Œå…¨å¯¹é½ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚

### åŠŸèƒ½å®Œæ•´æ€§

- âœ… åç«¯å®ç°ï¼š100%
- âœ… å‰ç«¯å®ç°ï¼š100%
- âœ… UIç•Œé¢ï¼š100%
- âœ… é”™è¯¯å¤„ç†ï¼š100%
- âœ… ç”¨æˆ·æç¤ºï¼š100%

### åç»­å·¥ä½œ

1. **æµ‹è¯•éªŒè¯**ï¼šè¿è¡ŒåŠŸèƒ½æµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–°APIæ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œ
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¦‚æœ‰éœ€è¦ï¼Œå¯ä¼˜åŒ–æ‰¹é‡æ—¶é—´åŒæ­¥åŠŸèƒ½

---

**ğŸ“ è¯´æ˜**: æœ¬åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œå‰åç«¯å®Œå…¨å¯¹é½ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ã€‚

