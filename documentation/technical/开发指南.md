# 开发指南

<cite>
**本文档引用的文件**   
- [README.md](file://README.md)
- [smart-admin-api-java17-springboot3\sa-admin\pom.xml](file://smart-admin-api-java17-springboot3\sa-admin\pom.xml)
- [smart-admin-api-java17-springboot3\sa-base\pom.xml](file://smart-admin-api-java17-springboot3\sa-base\pom.xml)
- [smart-admin-api-java17-springboot3\sa-admin\src\main\java\net\lab1024\sa\admin\AdminApplication.java](file://smart-admin-api-java17-springboot3\sa-admin\src\main\java\net\lab1024\sa\admin\AdminApplication.java)
- [smart-admin-api-java17-springboot3\sa-base\src\main\resources\dev\sa-base.yaml](file://smart-admin-api-java17-springboot3\sa-base\src\main\resources\dev\sa-base.yaml)
- [smart-admin-web-javascript\package.json](file://smart-admin-web-javascript\package.json)
- [smart-admin-web-javascript\vite.config.js](file://smart-admin-web-javascript\vite.config.js)
- [smart-admin-web-javascript\.env.development](file://smart-admin-web-javascript\.env.development)
- [smart-admin-web-javascript\docs\使用说明-README.md](file://smart-admin-web-javascript\docs\使用说明-README.md)
- [CLAUDE.md](file://CLAUDE.md)
- [数据库SQL脚本\mysql\smart_area.sql](file://数据库SQL脚本\mysql\smart_area.sql)
- [smart-admin-web-javascript\src\views\business\consumption\消费管理菜单配置.sql](file://smart-admin-web-javascript\src\views\business\consumption\消费管理菜单配置.sql)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [开发环境搭建](#开发环境搭建)
4. [前后端项目启动](#前后端项目启动)
5. [代码规范与编码标准](#代码规范与编码标准)
6. [调试技巧](#调试技巧)
7. [开发流程](#开发流程)
8. [常见问题与故障排除](#常见问题与故障排除)

## 简介

本开发指南旨在为新加入项目的开发者提供完整的开发环境搭建和开发流程指导。SmartAdmin 是一个基于 SpringBoot2/3 + Sa-Token + Mybatis-Plus 和 Vue3 + Ant Design Vue + Uni-App + Uni-UI 的快速开发平台，以"高质量代码"为核心，追求"简洁、高效、安全"的设计理念。项目支持国产数据库（如达梦、金仓等）和主流数据库（MySQL、PostgreSQL等），并提供前端JavaScript和TypeScript双版本，后端Java8+SpringBoot2.X和Java17+SpringBoot3.X双版本。

项目具有丰富的功能亮点，包括满足国家三级等保要求的安全体系、接口加解密、表格自定义列、数据变更记录、在线文档、OA办公、日志监控等系统功能。本指南将详细介绍开发环境的搭建、项目启动、代码规范、调试技巧和开发流程，帮助开发者快速上手。

**Section sources**
- [README.md](file://README.md#L1-L84)

## 项目结构

SmartAdmin 项目包含多个子项目，主要分为后端、前端和移动端三个部分。后端采用 Maven 多模块结构，前端使用 Vite 构建，移动端基于 Uni-App 开发。

### 后端项目结构

后端项目位于 `smart-admin-api-java17-springboot3` 目录下，采用 Maven 多模块架构：

```
smart-admin-api-java17-springboot3/
├── sa-parent/                    # 父模块，定义公共依赖和配置
├── sa-base/                      # 基础模块，包含公共配置、工具类、常量等
│   ├── src/main/java/net/lab1024/sa/
│   │   ├── common/               # 公共模块
│   │   │   ├── domain/           # 实体类（Entity, VO, DTO）
│   │   │   ├── mapper/           # MyBatis Plus Mapper
│   │   │   └── service/          # 基础 Service 接口
│   │   ├── config/               # 配置类
│   │   ├── util/                 # 工具类
│   │   └── constant/             # 常量定义
│   └── src/main/resources/
│       ├── dev/                  # 开发环境配置
│       ├── pre/                  # 预发布环境配置
│       ├── prod/                 # 生产环境配置
│       └── test/                 # 测试环境配置
└── sa-admin/                     # 管理模块
    ├── src/main/java/net/lab1024/sa/
    │   ├── admin/                # 管理模块代码
    │   │   ├── controller/       # 控制器（四层架构：controller, service, manager, dao）
    │   │   ├── service/          # Service 层
    │   │   ├── manager/          # Manager 层（业务逻辑封装）
    │   │   └── dao/              # DAO 层
    │   └── module/               # 功能模块（business, data, system 等）
    └── pom.xml                   # 模块配置文件
```

### 前端项目结构

前端项目位于 `smart-admin-web-javascript` 目录下，采用 Vue3 + Vite 构建：

```
smart-admin-web-javascript/
├── src/
│   ├── api/                      # API 接口
│   ├── assets/                   # 静态资源
│   ├── components/               # 公共组件
│   ├── config/                   # 配置文件（环境变量、主题等）
│   ├── constants/                # 常量定义（枚举、字典）
│   ├── directives/               # 自定义指令
│   ├── i18n/                     # 国际化
│   ├── layout/                   # 布局组件
│   ├── lib/                      # 第三方库扩展
│   ├── plugins/                  # 插件（axios, ant-design-vue 等）
│   ├── router/                   # 路由配置
│   ├── store/                    # Pinia 状态管理
│   ├── theme/                    # 主题配置
│   ├── utils/                    # 工具函数
│   ├── views/                    # 页面组件
│   ├── App.vue                   # 根组件
│   └── main.js                   # 入口文件
├── vite.config.js                # Vite 配置
└── package.json                  # 依赖管理
```

### 移动端项目结构

移动端项目位于 `smart-app` 目录下，基于 Uni-App 开发，支持 APP、小程序、H5 多端运行。

**Section sources**
- [README.md](file://README.md#L89-L134)
- [CLAUDE.md](file://CLAUDE.md#L89-L134)

## 开发环境搭建

### Java 环境配置

1. **安装 JDK 17**
   - 下载并安装 JDK 17，推荐使用 OpenJDK 或 Oracle JDK
   - 配置环境变量：
     - `JAVA_HOME`: JDK 安装路径
     - `PATH`: 添加 `%JAVA_HOME%\bin`
   - 验证安装：在命令行执行 `java -version`，应显示 Java 17 版本信息

2. **Maven 配置**
   - 下载并安装 Maven 3.8.6 或更高版本
   - 配置环境变量：
     - `MAVEN_HOME`: Maven 安装路径
     - `PATH`: 添加 `%MAVEN_HOME%\bin`
   - 配置 Maven 仓库镜像（推荐使用阿里云镜像）：
     ```xml
     <mirror>
       <id>aliyunmaven</id>
       <mirrorOf>*</mirrorOf>
       <name>阿里云公共仓库</name>
       <url>https://maven.aliyun.com/repository/public</url>
     </mirror>
     ```

### Node.js 环境配置

1. **安装 Node.js**
   - 下载并安装 Node.js 18 或更高版本（根据 `package.json` 中的 engines 配置）
   - 验证安装：在命令行执行 `node -v` 和 `npm -v`，应显示 Node.js 和 npm 版本信息

2. **配置 npm 镜像**
   - 为提高依赖下载速度，建议配置淘宝镜像：
     ```bash
     npm config set registry https://registry.npmmirror.com
     ```

### MySQL 数据库配置

1. **安装 MySQL 8.0+**
   - 下载并安装 MySQL 8.0 或更高版本
   - 启动 MySQL 服务

2. **创建数据库**
   - 使用以下 SQL 命令创建数据库：
     ```sql
     CREATE DATABASE smart_admin_v3 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
     ```
   - 导入数据库脚本：
     ```bash
     mysql -uroot -proot1234 smart_admin_v3 < 数据库SQL脚本/mysql/smart_admin_v3.sql
     ```

3. **数据库连接配置**
   - 数据库连接信息在 `sa-base.yaml` 文件中配置：
     ```yaml
     spring:
       datasource:
         url: jdbc:p6spy:mysql://192.168.10.110:33060/smart_admin_v3?autoReconnect=true&useServerPreparedStmts=false&rewriteBatchedStatements=true&characterEncoding=UTF-8&useSSL=false&allowMultiQueries=true&serverTimezone=Asia/Shanghai
         username: root
         password: 
         driver-class-name: com.p6spy.engine.spy.P6SpyDriver
     ```

### Redis 配置

1. **安装 Redis**
   - 下载并安装 Redis 6.0 或更高版本
   - 启动 Redis 服务

2. **Redis 连接配置**
   - Redis 连接信息在 `sa-base.yaml` 文件中配置：
     ```yaml
     spring:
       data:
         redis:
           database: 1
           host: 127.0.0.1
           port: 6389
           password: zkteco3100
           timeout: 10000ms
     ```

### 开发工具推荐

- **IDE**: IntelliJ IDEA（后端）、WebStorm（前端）或 VS Code
- **数据库管理工具**: Navicat、DBeaver 或 MySQL Workbench
- **API 测试工具**: Postman 或 Apifox
- **版本控制**: Git

**Section sources**
- [CLAUDE.md](file://CLAUDE.md#L330-L339)
- [smart-admin-api-java17-springboot3\sa-base\src\main\resources\dev\sa-base.yaml](file://smart-admin-api-java17-springboot3\sa-base\src\main\resources\dev\sa-base.yaml#L1-L187)

## 前后端项目启动

### 后端项目启动

1. **Maven 构建**
   - 进入后端项目根目录：
     ```bash
     cd smart-admin-api-java17-springboot3
     ```
   - 编译整个项目（跳过测试）：
     ```bash
     mvn clean install -DskipTests
     ```

2. **启动开发服务**
   - 方法一：使用 Maven 插件启动
     ```bash
     cd sa-admin
     mvn spring-boot:run
     ```
   - 方法二：直接运行 JAR 包
     ```bash
     java -jar sa-admin/target/sa-admin-dev-3.0.0.jar
     ```

3. **访问服务**
   - 后端服务默认启动在 `http://localhost:1024`
   - API 文档地址：`http://localhost:1024/doc.html`

4. **多环境配置**
   - 项目支持多环境配置，通过 Maven Profile 实现：
     - 开发环境：`dev`
     - 测试环境：`test`
     - 预发布环境：`pre`
     - 生产环境：`prod`
   - 启动时指定环境：
     ```bash
     mvn spring-boot:run -Pdev
     ```

### 前端项目启动

1. **安装依赖**
   - 进入前端项目目录：
     ```bash
     cd smart-admin-web-javascript
     ```
   - 安装项目依赖：
     ```bash
     npm install
     ```

2. **启动开发服务器**
   - 启动开发服务器（localhost 模式）：
     ```bash
     npm run localhost
     ```
   - 启动开发服务器（dev 模式）：
     ```bash
     npm run dev
     ```

3. **访问前端**
   - 前端开发服务器默认启动在 `http://localhost:8081`
   - 通过浏览器访问该地址即可查看前端页面

4. **构建生产环境**
   - 构建测试环境：
     ```bash
     npm run build:test
     ```
   - 构建预发布环境：
     ```bash
     npm run build:pre
     ```
   - 构建生产环境：
     ```bash
     npm run build:prod
     ```

5. **环境配置**
   - 项目支持多个环境配置文件：
     - `.env.development`: 开发环境
     - `.env.test`: 测试环境
     - `.env.pre`: 预发布环境
     - `.env.production`: 生产环境
   - 配置文件内容示例（`.env.development`）：
     ```env
     NODE_ENV=development
     VITE_APP_TITLE='SmartAdmin 开发环境(Dev)'
     VITE_APP_API_URL='http://127.0.0.1:1024'
     ```

### 服务启动顺序

1. 先启动 MySQL 和 Redis 服务
2. 再启动后端服务（端口 1024）
3. 最后启动前端服务（端口 8081）

**Section sources**
- [CLAUDE.md](file://CLAUDE.md#L19-L39)
- [smart-admin-web-javascript\package.json](file://smart-admin-web-javascript\package.json#L1-L75)
- [smart-admin-web-javascript\vite.config.js](file://smart-admin-web-javascript\vite.config.js#L1-L100)
- [smart-admin-web-javascript\.env.development](file://smart-admin-web-javascript\.env.development#L1-L3)

## 代码规范与编码标准

### 后端代码规范

1. **四层架构**
   - 严格遵守 Controller → Service → Manager → DAO 调用链
   - **Controller 层**: 接收 HTTP 请求，参数校验，调用 Service 层
   - **Service 层**: 业务逻辑处理，事务管理
   - **Manager 层**: 复杂业务逻辑封装，跨模块调用
   - **DAO 层**: 数据访问，使用 MyBatis Plus

2. **依赖注入**
   - 使用 `@Resource`，禁止使用 `@Autowired`
   - 示例：
     ```java
     @Service
     public class UserService {
         @Resource
         private UserDao userDao;
         
         // 业务逻辑
     }
     ```

3. **事务管理**
   - 事务边界必须在 Service 层
   - 使用 `@Transactional` 注解管理事务

4. **数据库规范**
   - **表命名**: `t_{business}_{entity}` 格式
   - **主键**: `{table}_id` 格式，BIGINT AUTO_INCREMENT
   - **审计字段**: 必须包含 create_time, update_time, create_user_id, deleted_flag
   - **软删除**: 使用 deleted_flag 字段，禁止物理删除
   - **字符集**: 统一使用 utf8mb4，存储引擎 InnoDB

5. **后端规范**
   - **权限控制**: 所有接口必须使用 `@SaCheckLogin` 和 `@SaCheckPermission`
   - **参数验证**: 使用 `@Valid` 进行参数校验
   - **统一响应**: 使用 ResponseDTO 返回格式
   - **异常处理**: 使用 SmartException 及其子类
   - **日志记录**: 使用 @SLF4J，禁止使用 System.out

6. **命名规范**
   - **包名**: `net.lab1024.sa.{module}.{layer}`
   - **类名**: Controller→{Module}Controller, Service→{Module}Service, Manager→{Module}Manager, DAO→{Module}Dao
   - **方法名**: 查询→get/query/find/list, 新增→add/create/save/insert, 修改→update/edit/modify, 删除→delete/remove
   - **变量名**: Boolean→is/has/can开头，集合→复数形式或List/Map后缀

### 前端代码规范

1. **技术栈**
   - 必须使用 Vue 3 + TypeScript + Pinia + Ant Design Vue 4.x
   - 使用 Composition API，遵循单一职责原则

2. **API 封装**
   - 统一在 `/@/api/` 目录下封装
   - API 命名使用下划线分隔（如：`login_in`）

3. **权限控制**
   - 使用 v-permission 指令进行权限控制
   - 示例：
     ```vue
     <a-button v-permission="'business:customer:add'">新增客户</a-button>
     ```

4. **状态管理**
   - 使用 Pinia 进行状态管理
   - 模块化管理 store

5. **组件开发**
   - 使用 Composition API
   - 遵循单一职责原则
   - 组件结构清晰，逻辑分离

6. **常量定义**
   - 使用枚举，避免魔法数字
   - 常量定义在 `/@/constants/` 目录下

7. **文件组织**
   - 按功能模块组织，API、组件、页面分离
   - 路径别名 `/@/` 指向 `src/` 目录

8. **样式规范**
   - 使用 Less 预处理器
   - 使用主题变量进行样式定制

**Section sources**
- [CLAUDE.md](file://CLAUDE.md#L194-L228)
- [smart-admin-web-javascript\docs\使用说明-README.md](file://smart-admin-web-javascript\docs\使用说明-README.md#L1-L430)

## 调试技巧

### 前后端联调

1. **接口调试**
   - 使用 Postman 或 Apifox 测试后端接口
   - 通过 Swagger 文档（`http://localhost:1024/doc.html`）查看接口定义
   - 前端通过 axios 调用后端接口，配置代理解决跨域问题

2. **跨域配置**
   - 前端 Vite 配置中设置代理：
     ```javascript
     server: {
       proxy: {
         '/': {
           target: 'http://127.0.0.1:1024/', // 目标服务器地址
           changeOrigin: true,
           rewrite: (path) => path,
         },
       },
     }
     ```

3. **数据交互调试**
   - 在浏览器开发者工具中查看网络请求
   - 检查请求参数、响应数据和状态码
   - 使用断点调试前端逻辑

### 断点调试

1. **后端断点调试**
   - 在 IntelliJ IDEA 中设置断点
   - 以 Debug 模式启动应用：
     ```bash
     mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"
     ```
   - 在关键代码处设置断点，观察变量值和执行流程

2. **前端断点调试**
   - 在浏览器开发者工具的 Sources 面板中设置断点
   - 或在代码中使用 `debugger` 语句：
     ```javascript
     function handleLogin() {
         debugger;
         // 登录逻辑
     }
     ```

### 日志分析

1. **后端日志**
   - 日志配置在 `log4j2-spring.xml` 中
   - 日志文件位于项目根目录下的 `logs` 文件夹
   - 关键日志级别：DEBUG、INFO、WARN、ERROR
   - 使用日志分析工具（如 ELK）进行日志聚合和分析

2. **前端日志**
   - 使用 console.log 输出调试信息
   - 生产环境通过 smart-sentry.js 收集错误日志
   - 避免在生产环境输出敏感信息

3. **数据库日志**
   - 启用 P6Spy 监控 SQL 执行：
     ```yaml
     spring:
       datasource:
         driver-class-name: com.p6spy.engine.spy.P6SpyDriver
     ```
   - 查看 SQL 执行时间和参数

4. **Redis 日志**
   - 监控 Redis 命令执行
   - 检查缓存命中率和性能

**Section sources**
- [CLAUDE.md](file://CLAUDE.md#L340-L350)
- [smart-admin-api-java17-springboot3\sa-base\src\main\resources\dev\sa-base.yaml](file://smart-admin-api-java17-springboot3\sa-base\src\main\resources\dev\sa-base.yaml#L1-L187)
- [smart-admin-web-javascript\vite.config.js](file://smart-admin-web-javascript\vite.config.js#L1-L100)

## 开发流程

### 分支管理

1. **Git 分支策略**
   - 采用 GitFlow 工作流
   - 主要分支：
     - `main`: 生产环境代码
     - `develop`: 开发环境代码
     - `feature/*`: 功能开发分支
     - `release/*`: 发布分支
     - `hotfix/*`: 热修复分支

2. **分支创建规范**
   - 功能开发：`feature/功能名称`
   - Bug 修复：`bugfix/问题描述`
   - 发布版本：`release/v1.0.0`
   - 热修复：`hotfix/紧急问题`

3. **分支操作流程**
   - 从 develop 分支创建功能分支：
     ```bash
     git checkout -b feature/customer-management develop
     ```
   - 开发完成后合并到 develop 分支：
     ```bash
     git checkout develop
     git merge --no-ff feature/customer-management
     git branch -d feature/customer-management
     ```

### 代码提交

1. **提交信息规范**
   - 遵循 `<type>(<scope>): <subject>` 格式
   - 类型（type）：
     - feat: 新功能
     - fix: 修复 bug
     - docs: 文档更新
     - style: 代码格式调整
     - refactor: 代码重构
     - test: 测试相关
     - chore: 构建过程或辅助工具的变动
   - 范围（scope）：模块名称
   - 主题（subject）：简短描述
   - 示例：
     ```
     feat(customer): 添加客户管理功能
     fix(login): 修复登录验证漏洞
     docs(api): 更新用户接口文档
     ```

2. **提交前检查**
   - 确保代码遵循所有命名规范
   - 添加必要的注释和文档
   - 处理所有异常情况
   - 添加权限控制
   - 单元测试覆盖率≥80%
   - 通过相关检查清单验证

### 代码审查

1. **审查流程**
   - 提交 Pull Request 后，指定至少一名同事进行代码审查
   - 审查重点：
     - 代码质量
     - 是否符合规范
     - 安全性
     - 性能影响
     - 测试覆盖
   - 审查通过后才能合并代码

2. **审查清单**
   - 是否遵循四层架构调用规范
   - 所有接口是否进行权限验证
   - 是否使用统一异常处理机制
   - 是否编写完整的单元测试
   - 是否遵循缓存使用规范
   - 代码安全性是否达标

### 新功能开发步骤

1. **设计阶段**
   - 阅读相关规范文档，制定设计方案
   - 确认技术架构要求
   - 设计数据库方案

2. **数据库设计**
   - 遵循数据库规范，编写 DDL 脚本
   - 创建必要的索引和约束
   - 考虑数据安全和性能

3. **后端开发**
   - 按四层架构顺序开发
   - 编写单元测试
   - 确保接口文档完整

4. **前端开发**
   - 创建 API、Store、组件
   - 遵循 Vue 3 最佳实践
   - 实现权限控制

5. **测试验证**
   - 运行完整测试
   - 确保功能正确
   - 性能达标
   - 安全性符合要求

**Section sources**
- [CLAUDE.md](file://CLAUDE.md#L239-L242)
- [smart-admin-web-javascript\docs\使用说明-README.md](file://smart-admin-web-javascript\docs\使用说明-README.md#L244-L275)

## 常见问题与故障排除

### 数据库相关问题

1. **数据库连接失败**
   - 检查数据库服务是否启动
   - 验证连接配置（host、port、username、password）
   - 检查防火墙设置
   - 确认数据库用户权限

2. **SQL 脚本执行失败**
   - 检查 SQL 语法是否正确
   - 确认表名和字段名是否符合规范
   - 检查外键约束
   - 验证字符集和排序规则

3. **数据初始化问题**
   - 确保先创建数据库再导入脚本
   - 检查脚本执行顺序
   - 验证数据完整性约束

### 后端服务问题

1. **服务启动失败**
   - 检查端口是否被占用
   - 验证依赖是否完整
   - 查看启动日志中的错误信息
   - 确认配置文件正确性

2. **接口返回 404**
   - 检查 Controller 是否正确映射
   - 验证请求路径和方法
   - 确认服务是否正常启动

3. **接口返回 500**
   - 查看服务器日志定位异常
   - 检查参数验证
   - 验证数据库连接
   - 确认业务逻辑正确性

### 前端问题

1. **页面无法访问**
   - 检查开发服务器是否启动
   - 验证端口是否被占用
   - 确认网络连接正常

2. **接口调用失败**
   - 检查代理配置是否正确
   - 验证跨域设置
   - 确认后端服务正常运行
   - 查看浏览器控制台错误

3. **样式问题**
   - 检查 Less 变量是否正确
   - 验证主题配置
   - 确认组件库版本兼容性

### 环境配置问题

1. **Maven 依赖下载失败**
   - 检查网络连接
   - 验证 Maven 镜像配置
   - 清理本地仓库缓存

2. **Node.js 依赖安装失败**
   - 检查 npm 镜像配置
   - 验证 Node.js 版本兼容性
   - 清理 npm 缓存

3. **多环境配置不生效**
   - 确认环境变量设置正确
   - 验证配置文件加载顺序
   - 检查构建命令参数

### 性能问题

1. **服务响应慢**
   - 检查数据库查询性能
   - 验证缓存使用情况
   - 分析 GC 日志
   - 监控系统资源使用

2. **内存泄漏**
   - 使用内存分析工具（如 JProfiler）
   - 检查对象引用
   - 验证资源释放

3. **高并发问题**
   - 优化数据库连接池配置
   - 使用缓存减少数据库压力
   - 实现限流和降级策略

**Section sources**
- [CLAUDE.md](file://CLAUDE.md#L330-L350)
- [数据库SQL脚本\mysql\smart_area.sql](file://数据库SQL脚本\mysql\smart_area.sql#L1-L197)
- [smart-admin-web-javascript\src\views\business\consumption\消费管理菜单配置.sql](file://smart-admin-web-javascript\src\views\business\consumption\消费管理菜单配置.sql#L1-L444)
