# 大屏监控页面功能与布局文档

## 页面概述
大屏监控页面是智能视频监控系统的电视墙管控界面,用于将多路监控画面统一展示在大屏幕上。该页面基于SmartAdmin前端框架构建,采用Vue3 + Ant Design Vue技术栈,支持多种电视墙布局(2x2/3x3/4x4),提供设备上墙、预案管理、轮巡播放、全屏展示等大屏管控功能。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **视频播放器**: jessibuca 3.x (推荐用于低延迟流媒体)

### 项目文件组织结构
```
src/views/business/smart-video/
├── screen-monitor.vue              # 大屏监控主页面
├── components/
│   ├── TvWallSelector.vue         # 电视墙选择组件
│   ├── DeviceTreeTabs.vue         # 设备树标签组件
│   ├── ScreenGrid.vue             # 大屏网格组件
│   ├── ScreenCell.vue             # 单个屏幕单元组件
│   ├── PlanManager.vue            # 预案管理组件
│   └── PollingControl.vue         # 轮巡控制组件
├── mock/
│   └── screen-monitor-mock.js     # 模拟数据
├── api/
│   └── screen-monitor-api.js      # API接口定义
└── utils/
    └── screen-layout-manager.js   # 大屏布局管理工具
```

### API接口设计
```javascript
// src/api/business/smart-video/screen-monitor-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const screenMonitorApi = {
  // 获取电视墙列表
  getTvWallList: () => getRequest('/screen/tvwall/list'),

  // 获取电视墙配置
  getTvWallConfig: (tvwallId) => getRequest(`/screen/tvwall/config/${tvwallId}`),

  // 保存电视墙配置
  saveTvWallConfig: (params) => postRequest('/screen/tvwall/config/save', params),

  // 获取设备树
  getDeviceTree: () => getRequest('/screen/device/tree'),

  // 设备上墙
  deviceOnWall: (params) => postRequest('/screen/device/on-wall', params),

  // 设备下墙
  deviceOffWall: (params) => postRequest('/screen/device/off-wall', params),

  // 一键上墙
  oneClickOnWall: (params) => postRequest('/screen/device/one-click-on-wall', params),

  // 获取预案列表
  getPlanList: () => getRequest('/screen/plan/list'),

  // 应用预案
  applyPlan: (params) => postRequest('/screen/plan/apply', params),

  // 保存预案
  savePlan: (params) => postRequest('/screen/plan/save', params),

  // 获取轮巡列表
  getPollingList: () => getRequest('/screen/polling/list'),

  // 开始轮巡
  startPolling: (params) => postRequest('/screen/polling/start', params),

  // 停止轮巡
  stopPolling: (pollingId) => postRequest('/screen/polling/stop', { pollingId }),

  // 同步布局
  syncLayout: (params) => postRequest('/screen/layout/sync', params),

  // 切换码流
  switchStream: (params) => postRequest('/screen/stream/switch', params),
};
```

## 开发注意事项

### 1. Vue 3 组件开发

#### 正确的Modal使用
```vue
<!-- 正确：使用属性绑定和事件监听 -->
<template>
  <a-modal
    :open="visible"
    title="预案管理"
    @ok="handleOk"
    @cancel="handleCancel"
  >
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean
});

const emit = defineEmits(['update:visible', 'ok', 'cancel']);

const handleOk = () => {
  emit('update:visible', false);
  emit('ok');
};

const handleCancel = () => {
  emit('update:visible', false);
  emit('cancel');
};
</script>
```

### 2. 图标使用

#### 使用存在的图标
```vue
<script setup>
import {
  DesktopOutlined,        // 大屏/电视墙
  VideoCameraOutlined,    // 摄像机
  AppstoreOutlined,       // 网格布局
  FullscreenOutlined,     // 全屏
  UploadOutlined,         // 上墙
  DownloadOutlined,       // 下墙
  SyncOutlined,           // 同步
  PlayCircleOutlined,     // 播放轮巡
  PauseCircleOutlined,    // 暂停轮巡
  EyeOutlined,            // 预览
  SettingOutlined,        // 设置
  BellOutlined,           // 报警
  ReloadOutlined,         // 刷新
  CloseOutlined,          // 关闭
  CheckCircleOutlined,    // 在线状态
  CloseCircleOutlined,    // 离线状态
} from '@ant-design/icons-vue';
</script>
```

### 3. 大屏布局CSS Grid

```vue
<style scoped lang="less">
.screen-grid {
  display: grid;
  gap: 8px;
  width: 100%;
  height: 100%;
  background: #000;
  padding: 16px;

  // 2x2布局
  &.grid-2x2 {
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
  }

  // 3x3布局
  &.grid-3x3 {
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
  }

  // 4x4布局
  &.grid-4x4 {
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
  }

  .screen-cell {
    position: relative;
    background: #1a1a1a;
    border-radius: 4px;
    overflow: hidden;
    aspect-ratio: 16/9;

    &.selected {
      outline: 3px solid #1890ff;
      box-shadow: 0 0 20px rgba(24, 144, 255, 0.5);
    }

    &:hover {
      outline: 2px solid #40a9ff;
    }
  }
}
</style>
```

### 4. 轮巡播放实现

```javascript
// 轮巡管理类
class PollingManager {
  constructor() {
    this.timer = null;
    this.currentIndex = 0;
    this.deviceList = [];
  }

  start(deviceList, interval) {
    this.deviceList = deviceList;
    this.currentIndex = 0;

    this.timer = setInterval(() => {
      this.currentIndex = (this.currentIndex + 1) % this.deviceList.length;
      const device = this.deviceList[this.currentIndex];
      // 切换到下一个设备
      this.switchDevice(device);
    }, interval * 1000);
  }

  stop() {
    if (this.timer) {
      clearInterval(this.timer);
      this.timer = null;
    }
  }

  switchDevice(device) {
    // 实现设备切换逻辑
    console.log('切换到设备:', device);
  }
}
```

## 核心功能模块

### 1. 电视墙选择器

```vue
<!-- src/views/business/smart-video/components/TvWallSelector.vue -->
<template>
  <div class="tvwall-selector">
    <div class="selector-header">
      <DesktopOutlined />
      <h2>大屏管控</h2>
    </div>

    <div class="selector-control">
      <label>电视墙选择:</label>
      <a-select
        v-model:value="selectedTvWall"
        placeholder="请选择电视墙"
        style="width: 200px;"
        @change="handleTvWallChange"
      >
        <a-select-option
          v-for="tvwall in tvwallList"
          :key="tvwall.id"
          :value="tvwall.id"
        >
          {{ tvwall.name }} ({{ tvwall.layout }})
        </a-select-option>
      </a-select>
    </div>

    <div class="current-info">
      <span>当前: {{ currentTvWallName }}</span>
      <span v-if="currentPlanName"> - {{ currentPlanName }}</span>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { DesktopOutlined } from '@ant-design/icons-vue';
import { screenMonitorApi } from '/@/api/business/smart-video/screen-monitor-api';

const emit = defineEmits(['tvwall-change']);

const selectedTvWall = ref('');
const currentPlanName = ref('');
const tvwallList = ref([
  { id: '1', name: '电视墙1', layout: '2×2布局' },
  { id: '2', name: '电视墙2', layout: '3×3布局' },
  { id: '3', name: '电视墙3', layout: '4×4布局' },
]);

const currentTvWallName = computed(() => {
  const tvwall = tvwallList.value.find(t => t.id === selectedTvWall.value);
  return tvwall ? tvwall.name : '未选择';
});

const handleTvWallChange = async (tvwallId) => {
  try {
    const config = await screenMonitorApi.getTvWallConfig(tvwallId);
    emit('tvwall-change', config);
  } catch (error) {
    console.error('加载电视墙配置失败:', error);
  }
};
</script>

<style scoped lang="less">
.tvwall-selector {
  display: flex;
  align-items: center;
  gap: 24px;
  padding: 16px 24px;
  background: #fff;
  border-bottom: 1px solid #f0f0f0;

  .selector-header {
    display: flex;
    align-items: center;
    gap: 12px;

    h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }
  }

  .selector-control {
    display: flex;
    align-items: center;
    gap: 12px;

    label {
      font-size: 14px;
      color: #666;
    }
  }

  .current-info {
    flex: 1;
    text-align: right;
    font-size: 14px;
    color: #999;
  }
}
</style>
```

### 2. 设备树标签组件

```vue
<!-- src/views/business/smart-video/components/DeviceTreeTabs.vue -->
<template>
  <div class="device-tree-tabs">
    <div class="tabs-header">
      <div class="tabs-nav">
        <div
          v-for="tab in tabs"
          :key="tab.key"
          class="tab-item"
          :class="{ active: activeTab === tab.key }"
          @click="handleTabChange(tab.key)"
        >
          <component :is="tab.icon" />
          <span>{{ tab.label }}</span>
        </div>
      </div>
    </div>

    <div class="tabs-content">
      <!-- 设备列表 -->
      <div v-show="activeTab === 'device'" class="tab-pane">
        <a-tree
          v-model:expandedKeys="expandedKeys"
          :tree-data="deviceTreeData"
          :field-names="{ title: 'name', key: 'id', children: 'children' }"
          @select="handleDeviceSelect"
        >
          <template #title="{ name, online }">
            <span class="tree-node-title">
              <VideoCameraOutlined />
              <span>{{ name }}</span>
              <CheckCircleOutlined
                v-if="online"
                style="color: #52c41a; margin-left: 8px;"
              />
              <CloseCircleOutlined
                v-else
                style="color: #ff4d4f; margin-left: 8px;"
              />
            </span>
          </template>
        </a-tree>
      </div>

      <!-- 预案列表 -->
      <div v-show="activeTab === 'plan'" class="tab-pane">
        <div
          v-for="plan in planList"
          :key="plan.id"
          class="plan-item"
          :class="{ selected: selectedPlan === plan.id }"
          @click="handlePlanSelect(plan)"
        >
          <div class="plan-header">
            <h4>{{ plan.name }}</h4>
            <StarOutlined v-if="plan.isDefault" style="color: #faad14;" />
          </div>
          <p>{{ plan.description }}</p>
        </div>
      </div>

      <!-- 轮巡列表 -->
      <div v-show="activeTab === 'polling'" class="tab-pane">
        <div
          v-for="polling in pollingList"
          :key="polling.id"
          class="polling-item"
          :class="{ selected: selectedPolling === polling.id }"
          @click="handlePollingSelect(polling)"
        >
          <div class="polling-header">
            <h4>{{ polling.name }}</h4>
            <PlayCircleOutlined
              v-if="polling.status === 'running'"
              style="color: #52c41a;"
            />
            <PauseCircleOutlined v-else style="color: #999;" />
          </div>
          <p>{{ polling.deviceCount }}个摄像头 - {{ polling.interval }}秒切换</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import {
  VideoCameraOutlined,
  FileTextOutlined,
  SyncOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  StarOutlined,
  PlayCircleOutlined,
  PauseCircleOutlined,
} from '@ant-design/icons-vue';

const emit = defineEmits(['device-select', 'plan-select', 'polling-select']);

const activeTab = ref('device');
const expandedKeys = ref([]);
const selectedPlan = ref(null);
const selectedPolling = ref(null);

const tabs = [
  { key: 'device', label: '设备', icon: VideoCameraOutlined },
  { key: 'plan', label: '预案', icon: FileTextOutlined },
  { key: 'polling', label: '轮巡', icon: SyncOutlined },
];

const deviceTreeData = ref([
  {
    id: 'area-1',
    name: '主楼',
    children: [
      { id: 'device-001', name: '前门摄像头', online: true },
      { id: 'device-002', name: '大厅摄像头', online: true },
      { id: 'device-003', name: '走廊摄像头', online: true },
    ],
  },
  {
    id: 'area-2',
    name: '仓库区',
    children: [
      { id: 'device-016', name: '仓库入口', online: true },
      { id: 'device-017', name: '仓储区A', online: false },
    ],
  },
]);

const planList = ref([
  { id: '1', name: '默认预案', description: '2×2布局 - 主楼摄像头', isDefault: true },
  { id: '2', name: '全覆盖预案', description: '3×3布局 - 全部区域', isDefault: false },
  { id: '3', name: '重点区域预案', description: '4×4布局 - 仓库区重点', isDefault: false },
]);

const pollingList = ref([
  { id: '1', name: '主楼轮巡', deviceCount: 5, interval: 30, status: 'running' },
  { id: '2', name: '仓库轮巡', deviceCount: 3, interval: 60, status: 'stopped' },
]);

const handleTabChange = (key) => {
  activeTab.value = key;
};

const handleDeviceSelect = (selectedKeys, e) => {
  if (selectedKeys.length > 0) {
    emit('device-select', e.node);
  }
};

const handlePlanSelect = (plan) => {
  selectedPlan.value = plan.id;
  emit('plan-select', plan);
};

const handlePollingSelect = (polling) => {
  selectedPolling.value = polling.id;
  emit('polling-select', polling);
};
</script>

<style scoped lang="less">
.device-tree-tabs {
  width: 280px;
  height: 100%;
  background: #fff;
  border-right: 1px solid #f0f0f0;
  display: flex;
  flex-direction: column;

  .tabs-header {
    border-bottom: 1px solid #f0f0f0;

    .tabs-nav {
      display: flex;

      .tab-item {
        flex: 1;
        padding: 12px 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.3s;

        &:hover {
          color: #1890ff;
          background: #f5f5f5;
        }

        &.active {
          color: #1890ff;
          border-bottom-color: #1890ff;
        }

        span {
          font-size: 13px;
        }
      }
    }
  }

  .tabs-content {
    flex: 1;
    overflow-y: auto;
    padding: 12px;

    .tab-pane {
      .tree-node-title {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .plan-item,
      .polling-item {
        padding: 12px;
        margin-bottom: 8px;
        border: 1px solid #f0f0f0;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;

        &:hover {
          border-color: #1890ff;
          background: #f5f5f5;
        }

        &.selected {
          border-color: #1890ff;
          background: #e6f7ff;
        }

        .plan-header,
        .polling-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;

          h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
          }
        }

        p {
          margin: 0;
          font-size: 12px;
          color: #999;
        }
      }
    }
  }
}
</style>
```

### 3. 大屏网格组件

```vue
<!-- src/views/business/smart-video/components/ScreenGrid.vue -->
<template>
  <div class="screen-grid-wrapper">
    <!-- 工具栏 -->
    <div class="grid-toolbar">
      <div class="toolbar-left">
        <a-button size="small" type="primary" @click="handleSetAlarm">
          <template #icon><BellOutlined /></template>
          报警设置
        </a-button>

        <a-button size="small" @click="handlePreview">
          <template #icon><EyeOutlined /></template>
          预览
        </a-button>

        <a-button size="small" @click="handleRestore">
          <template #icon><ReloadOutlined /></template>
          恢复
        </a-button>

        <a-button size="small" @click="handleOffWall">
          <template #icon><DownloadOutlined /></template>
          下墙
        </a-button>
      </div>

      <div class="toolbar-right">
        <a-button-group size="small">
          <a-button
            v-for="layout in layoutOptions"
            :key="layout.value"
            :type="currentLayout === layout.value ? 'primary' : 'default'"
            @click="handleLayoutChange(layout.value)"
          >
            <template #icon><AppstoreOutlined /></template>
            {{ layout.label }}
          </a-button>
        </a-button-group>
      </div>
    </div>

    <!-- 大屏网格 -->
    <div class="screen-grid" :class="`grid-${currentLayout}`">
      <ScreenCell
        v-for="(screen, index) in screens"
        :key="screen.id || index"
        :screen-data="screen"
        :index="index"
        :selected="selectedScreen === index"
        @click="handleScreenClick(index)"
        @remove="handleRemoveScreen(index)"
        @context-menu="handleContextMenu"
      />
    </div>

    <!-- 右键菜单 -->
    <div
      v-if="contextMenuVisible"
      class="context-menu"
      :style="{ left: contextMenuX + 'px', top: contextMenuY + 'px' }"
    >
      <div class="menu-item" @click="handleSwitchMainStream">主码流</div>
      <div class="menu-item" @click="handleSwitchSubStream">子码流</div>
      <a-divider style="margin: 4px 0;" />
      <div class="menu-item danger" @click="handleClearScreen">清空画面</div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { message } from 'ant-design-vue';
import {
  BellOutlined,
  EyeOutlined,
  ReloadOutlined,
  DownloadOutlined,
  AppstoreOutlined,
} from '@ant-design/icons-vue';
import ScreenCell from './ScreenCell.vue';

const emit = defineEmits(['layout-change', 'screen-select']);

const currentLayout = ref('2x2');
const selectedScreen = ref(null);
const contextMenuVisible = ref(false);
const contextMenuX = ref(0);
const contextMenuY = ref(0);

const layoutOptions = [
  { value: '2x2', label: '4分屏' },
  { value: '3x3', label: '9分屏' },
  { value: '4x4', label: '16分屏' },
];

const screens = computed(() => {
  const layoutMap = {
    '2x2': 4,
    '3x3': 9,
    '4x4': 16,
  };
  const count = layoutMap[currentLayout.value] || 4;
  return Array.from({ length: count }, (_, i) => ({
    id: `screen-${i}`,
    deviceName: i < 2 ? `摄像头${i + 1}` : null,
    streamUrl: i < 2 ? `ws://localhost:8080/live/camera${i + 1}.flv` : null,
  }));
});

const handleLayoutChange = (layout) => {
  currentLayout.value = layout;
  emit('layout-change', layout);
  message.success(`已切换到${layout}布局`);
};

const handleScreenClick = (index) => {
  selectedScreen.value = index;
  emit('screen-select', index);
};

const handleRemoveScreen = (index) => {
  screens.value[index].streamUrl = null;
  screens.value[index].deviceName = null;
};

const handleContextMenu = (e, index) => {
  e.preventDefault();
  contextMenuVisible.value = true;
  contextMenuX.value = e.clientX;
  contextMenuY.value = e.clientY;
  selectedScreen.value = index;

  // 点击其他地方关闭菜单
  setTimeout(() => {
    document.addEventListener('click', () => {
      contextMenuVisible.value = false;
    }, { once: true });
  }, 100);
};

const handleSwitchMainStream = () => {
  message.success('已切换到主码流');
  contextMenuVisible.value = false;
};

const handleSwitchSubStream = () => {
  message.success('已切换到子码流');
  contextMenuVisible.value = false;
};

const handleClearScreen = () => {
  if (selectedScreen.value !== null) {
    handleRemoveScreen(selectedScreen.value);
    message.info('画面已清空');
  }
  contextMenuVisible.value = false;
};

const handleSetAlarm = () => {
  message.info('报警设置功能');
};

const handlePreview = () => {
  message.info('预览模式');
};

const handleRestore = () => {
  message.info('恢复窗口');
};

const handleOffWall = () => {
  message.info('下墙操作');
};
</script>

<style scoped lang="less">
.screen-grid-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #000;
  position: relative;

  .grid-toolbar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    z-index: 10;

    .toolbar-left {
      display: flex;
      gap: 8px;
    }

    .toolbar-right {
      display: flex;
      gap: 8px;
    }
  }

  .screen-grid {
    flex: 1;
    display: grid;
    gap: 8px;
    padding: 72px 16px 16px;

    &.grid-2x2 {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
    }

    &.grid-3x3 {
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
    }

    &.grid-4x4 {
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
    }
  }

  .context-menu {
    position: fixed;
    background: #fff;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    padding: 4px 0;
    z-index: 1000;
    min-width: 120px;

    .menu-item {
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;

      &:hover {
        background: #f5f5f5;
      }

      &.danger {
        color: #ff4d4f;
      }
    }
  }
}
</style>
```

### 4. 单个屏幕单元组件

```vue
<!-- src/views/business/smart-video/components/ScreenCell.vue -->
<template>
  <div
    class="screen-cell"
    :class="{ selected: selected }"
    @contextmenu="handleContextMenu"
  >
    <!-- 有视频流 -->
    <div v-if="screenData.streamUrl" class="video-wrapper">
      <img
        :src="getPreviewImage()"
        alt="视频预览"
        class="video-preview"
      />

      <div class="screen-overlay">
        <div class="screen-title">
          <CheckCircleOutlined style="color: #52c41a;" />
          <span>{{ screenData.deviceName }}</span>
        </div>

        <div class="screen-time">{{ currentTime }}</div>
      </div>

      <div class="screen-actions">
        <a-button
          type="text"
          size="small"
          class="btn-remove"
          @click.stop="handleRemove"
        >
          <template #icon><CloseOutlined /></template>
        </a-button>
      </div>
    </div>

    <!-- 空白单元格 -->
    <div v-else class="empty-cell">
      <PlusOutlined style="font-size: 48px; color: #666;" />
      <p>点击添加设备</p>
    </div>

    <!-- 屏幕编号 -->
    <div class="screen-index">屏幕{{ index + 1 }}</div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import {
  CheckCircleOutlined,
  CloseOutlined,
  PlusOutlined,
} from '@ant-design/icons-vue';

const props = defineProps({
  screenData: {
    type: Object,
    required: true,
  },
  index: {
    type: Number,
    required: true,
  },
  selected: {
    type: Boolean,
    default: false,
  },
});

const emit = defineEmits(['remove', 'context-menu']);

const currentTime = ref('');

let timeInterval = null;

onMounted(() => {
  updateTime();
  timeInterval = setInterval(updateTime, 1000);
});

onUnmounted(() => {
  if (timeInterval) {
    clearInterval(timeInterval);
  }
});

const updateTime = () => {
  const now = new Date();
  currentTime.value = now.toLocaleString('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false,
  });
};

const getPreviewImage = () => {
  return `https://picsum.photos/seed/${props.screenData.id}/800/450`;
};

const handleRemove = () => {
  emit('remove', props.index);
};

const handleContextMenu = (e) => {
  emit('context-menu', e, props.index);
};
</script>

<style scoped lang="less">
.screen-cell {
  position: relative;
  background: #1a1a1a;
  border-radius: 4px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s;
  aspect-ratio: 16/9;

  &:hover {
    outline: 2px solid #40a9ff;

    .screen-actions {
      opacity: 1;
    }
  }

  &.selected {
    outline: 3px solid #1890ff;
    box-shadow: 0 0 20px rgba(24, 144, 255, 0.5);
  }

  .video-wrapper {
    width: 100%;
    height: 100%;
    position: relative;

    .video-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .screen-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 8px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);

      .screen-title {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #fff;
        font-size: 14px;
      }

      .screen-time {
        position: absolute;
        bottom: 8px;
        right: 8px;
        color: #fff;
        font-size: 12px;
        background: rgba(0,0,0,0.6);
        padding: 4px 8px;
        border-radius: 4px;
      }
    }

    .screen-actions {
      position: absolute;
      top: 8px;
      right: 8px;
      opacity: 0;
      transition: opacity 0.3s;

      .btn-remove {
        color: #fff;
        background: rgba(0, 0, 0, 0.5);

        &:hover {
          background: rgba(255, 77, 79, 0.8);
        }
      }
    }
  }

  .empty-cell {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #666;

    p {
      margin-top: 16px;
      font-size: 14px;
    }
  }

  .screen-index {
    position: absolute;
    top: 8px;
    left: 8px;
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    font-size: 12px;
    border-radius: 4px;
  }
}
</style>
```

### 5. 主页面集成

```vue
<!-- src/views/business/smart-video/screen-monitor.vue -->
<template>
  <div class="screen-monitor-page">
    <!-- 顶部电视墙选择 -->
    <TvWallSelector
      @tvwall-change="handleTvWallChange"
    />

    <div class="page-body">
      <!-- 左侧设备树 -->
      <DeviceTreeTabs
        @device-select="handleDeviceSelect"
        @plan-select="handlePlanSelect"
        @polling-select="handlePollingSelect"
      />

      <!-- 右侧大屏区域 -->
      <ScreenGrid
        ref="screenGridRef"
        @layout-change="handleLayoutChange"
        @screen-select="handleScreenSelect"
      />
    </div>

    <!-- 底部操作栏 -->
    <div class="page-footer">
      <div class="footer-actions">
        <a-button type="primary" size="large" @click="handleOneClickOnWall">
          <template #icon><UploadOutlined /></template>
          一键上墙
        </a-button>

        <a-button size="large" @click="handleSingleOnWall">
          <template #icon><UploadOutlined /></template>
          个上墙
        </a-button>

        <a-button size="large" @click="handleSyncLayout">
          <template #icon><SyncOutlined /></template>
          同步布局
        </a-button>
      </div>

      <div class="footer-tip">
        选择左侧设备，点击"个上墙"将设备画面添加到大屏，或使用"一键上墙"自动填充所有屏幕
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import { message } from 'ant-design-vue';
import { UploadOutlined, SyncOutlined } from '@ant-design/icons-vue';
import TvWallSelector from './components/TvWallSelector.vue';
import DeviceTreeTabs from './components/DeviceTreeTabs.vue';
import ScreenGrid from './components/ScreenGrid.vue';
import { screenMonitorApi } from '/@/api/business/smart-video/screen-monitor-api';

const screenGridRef = ref(null);
const selectedDevice = ref(null);
const selectedScreen = ref(null);
const currentTvWall = ref(null);

// 电视墙变化
const handleTvWallChange = (config) => {
  currentTvWall.value = config;
  message.success(`已加载${config.name}`);
};

// 设备选择
const handleDeviceSelect = (device) => {
  selectedDevice.value = device;
  console.log('选中设备:', device);

  // 如果有选中的屏幕，直接上墙
  if (selectedScreen.value !== null) {
    deviceOnWall(device, selectedScreen.value);
  }
};

// 预案选择
const handlePlanSelect = async (plan) => {
  try {
    await screenMonitorApi.applyPlan({ planId: plan.id });
    message.success(`已应用预案: ${plan.name}`);
  } catch (error) {
    message.error('应用预案失败');
  }
};

// 轮巡选择
const handlePollingSelect = async (polling) => {
  try {
    if (polling.status === 'running') {
      await screenMonitorApi.stopPolling(polling.id);
      message.success('轮巡已停止');
    } else {
      await screenMonitorApi.startPolling({ pollingId: polling.id });
      message.success('轮巡已开始');
    }
  } catch (error) {
    message.error('轮巡操作失败');
  }
};

// 布局变化
const handleLayoutChange = (layout) => {
  console.log('切换布局:', layout);
};

// 屏幕选择
const handleScreenSelect = (index) => {
  selectedScreen.value = index;
  console.log('选中屏幕:', index);

  // 如果有选中的设备，直接上墙
  if (selectedDevice.value) {
    deviceOnWall(selectedDevice.value, index);
  }
};

// 设备上墙
const deviceOnWall = async (device, screenIndex) => {
  try {
    await screenMonitorApi.deviceOnWall({
      deviceId: device.id,
      screenIndex: screenIndex,
      tvwallId: currentTvWall.value?.id,
    });
    message.success(`${device.name} 已上墙到屏幕${screenIndex + 1}`);
  } catch (error) {
    message.error('上墙失败');
  }
};

// 一键上墙
const handleOneClickOnWall = async () => {
  if (!currentTvWall.value) {
    message.warning('请先选择电视墙');
    return;
  }

  try {
    await screenMonitorApi.oneClickOnWall({
      tvwallId: currentTvWall.value.id,
    });
    message.success('一键上墙完成');
  } catch (error) {
    message.error('一键上墙失败');
  }
};

// 个上墙
const handleSingleOnWall = () => {
  if (!selectedDevice.value) {
    message.warning('请先选择设备');
    return;
  }

  if (selectedScreen.value === null) {
    message.warning('请先选择屏幕窗口');
    return;
  }

  deviceOnWall(selectedDevice.value, selectedScreen.value);
};

// 同步布局
const handleSyncLayout = async () => {
  if (!currentTvWall.value) {
    message.warning('请先选择电视墙');
    return;
  }

  try {
    await screenMonitorApi.syncLayout({
      tvwallId: currentTvWall.value.id,
    });
    message.success('布局同步成功');
  } catch (error) {
    message.error('布局同步失败');
  }
};
</script>

<style scoped lang="less">
.screen-monitor-page {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;

  .page-body {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  .page-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    background: #fff;
    border-top: 1px solid #f0f0f0;

    .footer-actions {
      display: flex;
      gap: 12px;
    }

    .footer-tip {
      font-size: 14px;
      color: #999;
    }
  }
}
</style>
```

## Mock数据示例

```javascript
// src/views/business/smart-video/mock/screen-monitor-mock.js

export const mockTvWallList = [
  {
    id: '1',
    name: '电视墙1',
    layout: '2x2',
    description: '2×2布局',
    screenCount: 4,
  },
  {
    id: '2',
    name: '电视墙2',
    layout: '3x3',
    description: '3×3布局',
    screenCount: 9,
  },
  {
    id: '3',
    name: '电视墙3',
    layout: '4x4',
    description: '4×4布局',
    screenCount: 16,
  },
];

export const mockDeviceTree = [
  {
    id: 'area-1',
    name: '主楼',
    type: 'area',
    children: [
      { id: 'device-001', name: '前门摄像头', online: true, streamUrl: 'ws://localhost:8080/live/001.flv' },
      { id: 'device-002', name: '大厅摄像头', online: true, streamUrl: 'ws://localhost:8080/live/002.flv' },
      { id: 'device-003', name: '走廊摄像头', online: true, streamUrl: 'ws://localhost:8080/live/003.flv' },
    ],
  },
  {
    id: 'area-2',
    name: '仓库区',
    type: 'area',
    children: [
      { id: 'device-016', name: '仓库入口', online: true, streamUrl: 'ws://localhost:8080/live/016.flv' },
      { id: 'device-017', name: '仓储区A', online: false, streamUrl: 'ws://localhost:8080/live/017.flv' },
    ],
  },
];

export const mockPlanList = [
  {
    id: '1',
    name: '默认预案',
    description: '2×2布局 - 主楼摄像头',
    isDefault: true,
    layout: '2x2',
    devices: ['device-001', 'device-002', 'device-003', 'device-004'],
  },
  {
    id: '2',
    name: '全覆盖预案',
    description: '3×3布局 - 全部区域',
    isDefault: false,
    layout: '3x3',
    devices: ['device-001', 'device-002', 'device-003', 'device-016', 'device-017'],
  },
];

export const mockPollingList = [
  {
    id: '1',
    name: '主楼轮巡',
    deviceCount: 5,
    interval: 30,
    status: 'running',
    devices: ['device-001', 'device-002', 'device-003', 'device-004', 'device-005'],
  },
  {
    id: '2',
    name: '仓库轮巡',
    deviceCount: 3,
    interval: 60,
    status: 'stopped',
    devices: ['device-016', 'device-017', 'device-018'],
  },
];

export default {
  mockTvWallList,
  mockDeviceTree,
  mockPlanList,
  mockPollingList,
};
```

## 路由配置

```javascript
// src/router/business/smart-video.js
import SmartLayout from '/@/layout/index.vue';
import { MENU_TYPE_ENUM } from '/@/constants/system/menu-const';

export const smartVideoRouters = [
  {
    path: '/',
    component: SmartLayout,
    children: [
      {
        path: '/business/smart-video/screen-monitor',
        name: 'SmartVideoScreenMonitor',
        component: () => import('/@/views/business/smart-video/screen-monitor.vue'),
        meta: {
          title: '智能视频 - 大屏监控',
          menuType: MENU_TYPE_ENUM.MENU.value,
          icon: 'DesktopOutlined',
          hideInMenu: false,
          keepAlive: true,
        },
      },
    ],
  },
];
```

## 菜单配置

```javascript
// src/store/modules/system/user.js
function addScreenMonitorMenu(menuList) {
  const maxMenuId = Math.max(...menuList.map(item => item.menuId || 0));

  const screenMonitorMenu = {
    menuId: maxMenuId + 1005,
    menuName: '大屏监控',
    menuTitle: '大屏监控',
    menuType: MENU_TYPE_ENUM.MENU.value,
    parentId: smartVideoMenu.menuId,
    path: '/business/smart-video/screen-monitor',
    component: '/business/smart-video/screen-monitor.vue',
    icon: 'DesktopOutlined',
    visibleFlag: true,
    disabledFlag: false,
    cacheFlag: true,
    frameFlag: false,
    frameUrl: '',
    sort: 5,
    updateTime: new Date().toISOString(),
  };

  menuList.push(screenMonitorMenu);
}
```

## 开发注意事项总结

### 核心功能要点
1. **电视墙布局** - 支持2x2/3x3/4x4多种布局方式
2. **设备上墙** - 拖拽或点击方式将设备画面上墙
3. **预案管理** - 保存和快速应用常用布局配置
4. **轮巡播放** - 自动切换设备画面,支持自定义间隔
5. **实时监控** - 多路视频同时播放,低延迟展示
6. **全屏模式** - 支持全屏大屏展示

### 性能优化建议
1. 根据布局动态加载视频流,避免同时加载过多
2. 使用虚拟滚动优化设备树大数据渲染
3. 合理设置视频缓冲区,平衡延迟和流畅度
4. 轮巡切换时优雅地销毁旧播放器实例

### 用户体验优化
1. 提供清晰的视觉反馈(选中状态、在线状态)
2. 右键菜单快速操作(切换码流、清空画面)
3. 快捷键支持(全屏、布局切换)
4. 保存用户的电视墙和布局配置

## 总结

大屏监控页面是视频监控系统的集中展示界面,需要特别注意:

- 灵活的电视墙布局管理
- 便捷的设备上墙操作
- 预案快速切换功能
- 自动轮巡播放机制
- 多屏幕同时显示优化
- 全屏大屏展示支持

通过遵循本文档的技术规范,可以开发出功能完善、操作便捷的大屏监控管理系统。
