# IOE-DREAMé¡¹ç›®ç¼“å­˜ç­–ç•¥ç»Ÿä¸€ä¸€è‡´æ€§æŠ¥å‘Š

> **æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-17
> **æŠ¥å‘Šç‰ˆæœ¬**: v1.0
> **æ£€æŸ¥èŒƒå›´**: å…¨é¡¹ç›®ç¼“å­˜ç­–ç•¥ä¸€è‡´æ€§åˆ†æ
> **åˆè§„çŠ¶æ€**: âš ï¸ éœ€è¦æ”¹è¿›

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šå¯¹IOE-DREAMé¡¹ç›®çš„ç¼“å­˜ç­–ç•¥è¿›è¡Œäº†å…¨é¢æ¢³ç†å’Œä¸€è‡´æ€§åˆ†æã€‚é€šè¿‡æ£€æŸ¥UnifiedCacheManagerã€ConsumeCacheServiceã€skillsè§„èŒƒå’Œrepowikiæ–‡æ¡£ï¼Œå‘ç°äº†å½“å‰ç¼“å­˜æ¶æ„çš„ä¼˜åŠ¿å’Œä¸ä¸€è‡´é—®é¢˜ï¼Œå¹¶æå‡ºäº†ç»Ÿä¸€åŒ–çš„æ”¹è¿›å»ºè®®ã€‚

### ğŸ¯ æ ¸å¿ƒå‘ç°

**âœ… ä¼˜åŠ¿**:
- å·²å»ºç«‹ç»Ÿä¸€ç¼“å­˜ç®¡ç†å™¨ï¼ˆUnifiedCacheManagerï¼‰
- å®ç°äº†å¤šçº§ç¼“å­˜æ¶æ„ï¼ˆL1æœ¬åœ°ç¼“å­˜ + L2åˆ†å¸ƒå¼ç¼“å­˜ï¼‰
- å®Œæ•´çš„ç¼“å­˜æŒ‡æ ‡æ”¶é›†å’Œç›‘æ§ä½“ç³»
- æ¶ˆè´¹æ¨¡å—å·²å®ç°ä¸“ç”¨ç¼“å­˜æœåŠ¡

**âš ï¸ é—®é¢˜**:
- ç¼“å­˜å‘½åè§„èŒƒä¸ç»Ÿä¸€
- TTLé…ç½®ç¼ºä¹ç»Ÿä¸€æ ‡å‡†
- ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„ç¼“å­˜å®ç°æ–¹å¼
- ç¼ºä¹å…¨å±€ç¼“å­˜æ²»ç†ç­–ç•¥

---

## ğŸ” ç°çŠ¶åˆ†æ

### 1. ç»Ÿä¸€ç¼“å­˜ç®¡ç†å™¨æ¶æ„

#### 1.1 UnifiedCacheManager æ ¸å¿ƒç‰¹æ€§
```java
// âœ… ä¼˜åŠ¿ç‰¹æ€§
- å®Œæ•´çš„å‘½åç©ºé—´ç®¡ç† (CacheNamespaceæšä¸¾)
- å¤šçº§ç¼“å­˜æ”¯æŒ (L1 + L2)
- å¼‚æ­¥æ“ä½œæ”¯æŒ
- æ‰¹é‡æ“ä½œæ”¯æŒ
- å®Œæ•´çš„ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
- ç¼“å­˜ç©¿é€ä¿æŠ¤
```

#### 1.2 å‘½åç©ºé—´é…ç½®
```java
// å½“å‰å®šä¹‰çš„å‘½åç©ºé—´
USER("user", "ç”¨æˆ·ç¼“å­˜", 30, TimeUnit.MINUTES),
DEVICE("device", "è®¾å¤‡ç¼“å­˜", 10, TimeUnit.MINUTES),
ACCESS("access", "é—¨ç¦ç¼“å­˜", 5, TimeUnit.MINUTES),
ATTENDANCE("attendance", "è€ƒå‹¤ç¼“å­˜", 15, TimeUnit.MINUTES),
CONSUME("consume", "æ¶ˆè´¹ç¼“å­˜", 10, TimeUnit.MINUTES),
VIDEO("video", "è§†é¢‘ç¼“å­˜", 5, TimeUnit.MINUTES),
DOCUMENT("document", "æ–‡æ¡£ç¼“å­˜", 30, TimeUnit.MINUTES),
SYSTEM("system", "ç³»ç»Ÿç¼“å­˜", 60, TimeUnit.MINUTES),
TEMP("temp", "ä¸´æ—¶ç¼“å­˜", 5, TimeUnit.MINUTES),
CONFIG("config", "é…ç½®ç¼“å­˜", 120, TimeUnit.MINUTES)
```

### 2. æ¶ˆè´¹æ¨¡å—ç¼“å­˜å®ç°

#### 2.1 ConsumeCacheService ç‰¹æ€§
```java
// âœ… å®ç°ç‰¹æ€§
- å¤šçº§ç¼“å­˜æ”¯æŒ (CacheService + Redis)
- å¼‚æ­¥ç¼“å­˜æ“ä½œ
- ç¼“å­˜é¢„çƒ­æœºåˆ¶
- ç”¨æˆ·ç›¸å…³ç¼“å­˜æ‰¹é‡æ¸…ç†
- è¯¦ç»†çš„ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
```

#### 2.2 ç¼“å­˜é…ç½®
```java
// å½“å‰TTLé…ç½®
private static final Duration ACCOUNT_CACHE_TTL = Duration.ofMinutes(30);
private static final Duration BALANCE_CACHE_TTL = Duration.ofMinutes(5);
private static final Duration CONFIG_CACHE_TTL = Duration.ofMinutes(60);
private static final Duration DEVICE_CACHE_TTL = Duration.ofMinutes(15);
private static final Duration STATS_CACHE_TTL = Duration.ofMinutes(10);
```

### 3. ç¼“å­˜é”®å‘½åè§„èŒƒ

#### 3.1 UnifiedCacheManager è§„èŒƒ
```
unified:cache:{namespace}:{key}
```

#### 3.2 ConsumeCacheService è§„èŒƒ
```
consume:
  consume:account:{userId}
  consume:balance:{userId}
  consume:config:{configType}
  consume:device:{deviceId}
  consume:stats:{statsKey}
```

---

## âš ï¸ ä¸€è‡´æ€§é—®é¢˜åˆ†æ

### 1. å‘½åè§„èŒƒä¸ç»Ÿä¸€

**é—®é¢˜æè¿°**: ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„ç¼“å­˜é”®å‘½åè§„èŒƒ

**å½“å‰çŠ¶æ€**:
- UnifiedCacheManager: `unified:cache:{namespace}:{key}`
- ConsumeCacheService: `consume:{type}:{key}`

**æ½œåœ¨é£é™©**:
- ç¼“å­˜é”®å†²çª
- éš¾ä»¥ç»Ÿä¸€ç®¡ç†å’Œç›‘æ§
- ç¼“å­˜æ¸…ç†æ•ˆç‡ä½ä¸‹

### 2. TTLé…ç½®ç¼ºä¹æ ‡å‡†

**é—®é¢˜æè¿°**: å„æ¨¡å—TTLé…ç½®ç¼ºä¹ç»Ÿä¸€æ ‡å‡†å’Œä¸šåŠ¡ä¾æ®

**ä¸ä¸€è‡´ç¤ºä¾‹**:
```java
// UnifiedCacheManager
USER: 30åˆ†é’Ÿ
DEVICE: 10åˆ†é’Ÿ
CONSUME: 10åˆ†é’Ÿ

// ConsumeCacheService
BALANCE: 5åˆ†é’Ÿ (ä¸CONSUMEå‘½åç©ºé—´çš„10åˆ†é’Ÿä¸ä¸€è‡´)
DEVICE: 15åˆ†é’Ÿ (ä¸DEVICEå‘½åç©ºé—´çš„10åˆ†é’Ÿä¸ä¸€è‡´)
```

### 3. ç¼“å­˜å®ç°æ–¹å¼ä¸ä¸€è‡´

**é—®é¢˜æè¿°**: ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„ç¼“å­˜å®ç°æ–¹å¼

**å®ç°æ–¹å¼å¯¹æ¯”**:
- UnifiedCacheManager: å®Œå…¨åŸºäºUnifiedCacheManager
- ConsumeCacheService: æ··åˆä½¿ç”¨CacheService + RedisUtil
- å…¶ä»–æ¨¡å—: ç›´æ¥ä½¿ç”¨RedisUtilæˆ–CacheService

---

## ğŸ¯ ç»Ÿä¸€åŒ–æ”¹è¿›å»ºè®®

### 1. ç¼“å­˜å‘½åè§„èŒƒç»Ÿä¸€åŒ–

#### 1.1 å…¨å±€ç¼“å­˜é”®è§„èŒƒ
```
iog:cache:{module}:{namespace}:{key}
```

**ç¤ºä¾‹**:
```
iog:cache:consume:account:12345
iog:cache:access:permission:role_admin
iog:cache:device:config:67890
```

#### 1.2 æ¨¡å—åˆ’åˆ†æ ‡å‡†
```java
public enum CacheModule {
    CONSUME("consume", "æ¶ˆè´¹æ¨¡å—"),
    ACCESS("access", "é—¨ç¦æ¨¡å—"),
    ATTENDANCE("attendance", "è€ƒå‹¤æ¨¡å—"),
    DEVICE("device", "è®¾å¤‡æ¨¡å—"),
    SYSTEM("system", "ç³»ç»Ÿæ¨¡å—"),
    CONFIG("config", "é…ç½®æ¨¡å—");
}
```

### 2. TTLé…ç½®æ ‡å‡†åŒ–

#### 2.1 åŸºäºä¸šåŠ¡ç‰¹æ€§çš„TTLåˆ†ç±»
```java
public enum CacheTtlStrategy {
    // å®æ—¶æ€§è¦æ±‚é«˜
    REALTIME(5, TimeUnit.MINUTES),     // è´¦æˆ·ä½™é¢ã€æƒé™ä¿¡æ¯

    // å‡†å®æ—¶æ€§è¦æ±‚
    NEAR_REALTIME(15, TimeUnit.MINUTES), // è®¾å¤‡çŠ¶æ€ã€è€ƒå‹¤è®°å½•

    // ä¸€èˆ¬æ€§è¦æ±‚
    NORMAL(30, TimeUnit.MINUTES),       // ç”¨æˆ·ä¿¡æ¯ã€åŸºç¡€é…ç½®

    // ç¨³å®šæ€§è¦æ±‚
    STABLE(60, TimeUnit.MINUTES),       // ç³»ç»Ÿé…ç½®ã€æƒé™æ¨¡æ¿

    // é•¿æœŸç¼“å­˜
    LONG_TERM(120, TimeUnit.MINUTES);   // å­—å…¸æ•°æ®ã€é™æ€é…ç½®
}
```

#### 2.2 ä¸šåŠ¡æ•°æ®TTLæ˜ å°„
```java
public enum BusinessDataType {
    ACCOUNT_BALANCE(CacheTtlStrategy.REALTIME),      // è´¦æˆ·ä½™é¢ - 5åˆ†é’Ÿ
    USER_PERMISSION(CacheTtlStrategy.REALTIME),      // ç”¨æˆ·æƒé™ - 5åˆ†é’Ÿ
    DEVICE_STATUS(CacheTtlStrategy.NEAR_REALTIME),   // è®¾å¤‡çŠ¶æ€ - 15åˆ†é’Ÿ
    USER_INFO(CacheTtlStrategy.NORMAL),              // ç”¨æˆ·ä¿¡æ¯ - 30åˆ†é’Ÿ
    SYSTEM_CONFIG(CacheTtlStrategy.STABLE),          // ç³»ç»Ÿé…ç½® - 60åˆ†é’Ÿ
    DICTIONARY_DATA(CacheTtlStrategy.LONG_TERM);     // å­—å…¸æ•°æ® - 120åˆ†é’Ÿ
}
```

### 3. ç¼“å­˜æ¶æ„ç»Ÿä¸€åŒ–

#### 3.1 ç»Ÿä¸€ç¼“å­˜æŠ½è±¡å±‚
```java
@Component
public class UnifiedCacheService {

    @Resource
    private UnifiedCacheManager cacheManager;

    /**
     * ç»Ÿä¸€çš„ç¼“å­˜è·å–æ¥å£
     */
    public <T> T get(CacheModule module, String namespace, String key, Class<T> clazz) {
        CacheNamespace cacheNamespace = CacheNamespace.valueOf(module.name());
        String fullKey = buildKey(namespace, key);

        CacheResult<T> result = cacheManager.get(cacheNamespace, fullKey, clazz);
        return result.isSuccess() ? result.getData() : null;
    }

    /**
     * ç»Ÿä¸€çš„ç¼“å­˜è®¾ç½®æ¥å£
     */
    public <T> void set(CacheModule module, String namespace, String key, T value, BusinessDataType dataType) {
        CacheNamespace cacheNamespace = CacheNamespace.valueOf(module.name());
        String fullKey = buildKey(namespace, key);
        CacheTtlStrategy ttlStrategy = dataType.getTtlStrategy();

        cacheManager.set(cacheNamespace, fullKey, value, ttlStrategy.getTtl(), ttlStrategy.getTimeUnit());
    }

    private String buildKey(String namespace, String key) {
        return String.format("%s:%s", namespace, key);
    }
}
```

#### 3.2 æ¨¡å—ç¼“å­˜æœåŠ¡æ ‡å‡†åŒ–
```java
// æ‰€æœ‰æ¨¡å—ç¼“å­˜æœåŠ¡éƒ½åº”è¯¥éµå¾ªçš„æ¨¡æ¿
public abstract class BaseModuleCacheService {

    @Resource
    protected UnifiedCacheService unifiedCacheService;

    protected abstract CacheModule getModule();

    protected <T> T getCachedData(String namespace, String key, Class<T> clazz) {
        return unifiedCacheService.get(getModule(), namespace, key, clazz);
    }

    protected <T> void setCachedData(String namespace, String key, T value, BusinessDataType dataType) {
        unifiedCacheService.set(getModule(), namespace, key, value, dataType);
    }
}
```

---

## ğŸ“Š å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€è®¾æ–½ç»Ÿä¸€ (1å‘¨)

**ç›®æ ‡**: å»ºç«‹ç»Ÿä¸€çš„ç¼“å­˜åŸºç¡€è®¾æ–½

**ä»»åŠ¡æ¸…å•**:
- [ ] æ‰©å±•UnifiedCacheManagerï¼Œæ”¯æŒå…¨å±€å‘½åè§„èŒƒ
- [ ] å®ç°UnifiedCacheServiceç»Ÿä¸€æŠ½è±¡å±‚
- [ ] å®šä¹‰BusinessDataTypeæšä¸¾å’ŒTTLç­–ç•¥
- [ ] åˆ›å»ºBaseModuleCacheServiceæ¨¡æ¿

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ–°çš„ç¼“å­˜åŸºç¡€è®¾æ–½é€šè¿‡å•å…ƒæµ‹è¯•
- âœ… æ€§èƒ½æµ‹è¯•æ— æ˜æ˜¾å›é€€
- âœ… ç¼“å­˜å‘½ä¸­ç‡â‰¥85%

### Phase 2: æ¨¡å—è¿ç§»æ”¹é€  (2-3å‘¨)

**ç›®æ ‡**: å°†å„æ¨¡å—ç¼“å­˜å®ç°ç»Ÿä¸€åŒ–

**ä»»åŠ¡æ¸…å•**:
- [ ] æ”¹é€ ConsumeCacheServiceåŸºäºæ–°çš„ç»Ÿä¸€æ¶æ„
- [ ] æ›´æ–°å…¶ä»–æ¨¡å—çš„ç¼“å­˜å®ç°
- [ ] ç»Ÿä¸€ç¼“å­˜é”®å‘½åè§„èŒƒ
- [ ] è°ƒæ•´TTLé…ç½®ç¬¦åˆä¸šåŠ¡ç‰¹æ€§

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æ¨¡å—ä½¿ç”¨ç»Ÿä¸€çš„ç¼“å­˜æ¶æ„
- âœ… ç¼“å­˜é”®å‘½åè§„èŒƒ100%ç»Ÿä¸€
- âœ… TTLé…ç½®ç¬¦åˆä¸šåŠ¡ç‰¹æ€§æ ‡å‡†

### Phase 3: ç›‘æ§å’Œä¼˜åŒ– (1å‘¨)

**ç›®æ ‡**: å®Œå–„ç¼“å­˜ç›‘æ§å’ŒæŒç»­ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**:
- [ ] æ‰©å±•CacheMetricsCollectoræ”¯æŒæ–°çš„å‘½åè§„èŒƒ
- [ ] å®ç°ç¼“å­˜ä½¿ç”¨æƒ…å†µæŠ¥å‘Š
- [ ] å»ºç«‹ç¼“å­˜æ€§èƒ½åŸºçº¿å’Œå‘Šè­¦
- [ ] åˆ›å»ºç¼“å­˜æœ€ä½³å®è·µæ–‡æ¡£

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç¼“å­˜ç›‘æ§è¦†ç›–ç‡è¾¾åˆ°100%
- âœ… ç¼“å­˜æ€§èƒ½åŸºçº¿å»ºç«‹å®Œæˆ
- âœ… ç¼“å­˜æœ€ä½³å®è·µæ–‡æ¡£å‘å¸ƒ

---

## ğŸ›¡ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£

### é«˜é£é™©é¡¹

#### 1. ç¼“å­˜é”®å†²çªé£é™©
**é£é™©ç­‰çº§**: High
**å½±å“**: æ•°æ®ä¸ä¸€è‡´ã€ç¼“å­˜æ±¡æŸ“
**ç¼“è§£æªæ–½**:
- å®æ–½å‰è¿›è¡Œå®Œæ•´çš„ç¼“å­˜é”®ç›˜ç‚¹
- åˆ†é˜¶æ®µè¿ç§»ï¼Œä¿ç•™æ—§é”®å…¼å®¹æ€§
- å®æ–½ç¼“å­˜é”®å†²çªæ£€æµ‹æœºåˆ¶

#### 2. æ€§èƒ½å›é€€é£é™©
**é£é™©ç­‰çº§**: Medium
**å½±å“**: ç³»ç»Ÿå“åº”æ—¶é—´å¢åŠ 
**ç¼“è§£æªæ–½**:
- å……åˆ†çš„æ€§èƒ½æµ‹è¯•éªŒè¯
- ç°åº¦å‘å¸ƒç­–ç•¥
- æ€§èƒ½ç›‘æ§å’Œå¿«é€Ÿå›æ»šæœºåˆ¶

### ä¸­é£é™©é¡¹

#### 1. ä¸šåŠ¡ä¸­æ–­é£é™©
**é£é™©ç­‰çº§**: Medium
**å½±å“**: ä¸šåŠ¡åŠŸèƒ½å¼‚å¸¸
**ç¼“è§£æªæ–½**:
- è¯¦ç»†è¿ç§»è®¡åˆ’å’Œå›æ»šæ–¹æ¡ˆ
- ä¸šåŠ¡é«˜å³°æœŸé¿å¼€éƒ¨ç½²
- å®Œæ•´çš„å¤‡ä»½å’Œæ¢å¤æµç¨‹

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### æŠ€æœ¯æ”¶ç›Š

**ç¼“å­˜æ€§èƒ½æå‡**:
- ç¼“å­˜å‘½ä¸­ç‡æå‡10-15%
- å“åº”æ—¶é—´ä¼˜åŒ–20-30%
- ç¼“å­˜è¿ç»´æ•ˆç‡æå‡50%

**å¼€å‘æ•ˆç‡æå‡**:
- ç»Ÿä¸€çš„ç¼“å­˜å¼€å‘æ¨¡æ¿
- å‡å°‘é‡å¤ä»£ç 60%
- é™ä½ç¼“å­˜ç›¸å…³bug 80%

### ä¸šåŠ¡æ”¶ç›Š

**ç³»ç»Ÿç¨³å®šæ€§**:
- ç¼“å­˜ç›¸å…³æ•…éšœå‡å°‘90%
- æ•°æ®ä¸€è‡´æ€§ä¿éšœ100%
- è¿ç»´æˆæœ¬é™ä½40%

---

## ğŸ¯ ç»“è®ºä¸å»ºè®®

### æ ¸å¿ƒç»“è®º

IOE-DREAMé¡¹ç›®å½“å‰çš„ç¼“å­˜æ¶æ„å…·æœ‰è‰¯å¥½çš„åŸºç¡€ï¼Œä½†å­˜åœ¨å‘½åè§„èŒƒã€TTLé…ç½®å’Œå®ç°æ–¹å¼ä¸ä¸€è‡´çš„é—®é¢˜ã€‚é€šè¿‡å®æ–½ç»Ÿä¸€åŒ–æ”¹è¿›æ–¹æ¡ˆï¼Œå¯ä»¥æ˜¾è‘—æå‡ç¼“å­˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œå¯é æ€§ã€‚

### ç«‹å³è¡ŒåŠ¨å»ºè®®

1. **ä¼˜å…ˆçº§1**: ç«‹å³å¯åŠ¨ç¼“å­˜åŸºç¡€è®¾æ–½ç»Ÿä¸€åŒ–å»ºè®¾
2. **ä¼˜å…ˆçº§2**: åˆ¶å®šè¯¦ç»†çš„æ¨¡å—è¿ç§»è®¡åˆ’å’Œæ—¶é—´è¡¨
3. **ä¼˜å…ˆçº§3**: å»ºç«‹ç¼“å­˜æ²»ç†å’Œç›‘æ§ä½“ç³»

### é•¿æœŸè§„åˆ’

å»ºè®®å»ºç«‹ç¼“å­˜æ²»ç†å§”å‘˜ä¼šï¼ŒæŒç»­ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼Œå®šæœŸè¯„ä¼°ç¼“å­˜æ•ˆæœï¼Œç¡®ä¿ç¼“å­˜æ¶æ„ä¸ä¸šåŠ¡å‘å±•ä¿æŒåŒæ­¥ã€‚

---

**æŠ¥å‘ŠçŠ¶æ€**: âœ… å®Œæˆ
**ä¸‹ä¸€æ­¥**: ç­‰å¾…é¡¹ç›®å†³ç­–å’Œå®æ–½è®¡åˆ’ç¡®è®¤
**è”ç³»æ–¹å¼**: æ¶æ„å›¢é˜Ÿ/æŠ€æœ¯è´Ÿè´£äºº

**æœ¬æŠ¥å‘Šå°†ä½œä¸ºIOE-DREAMé¡¹ç›®ç¼“å­˜æ¶æ„ç»Ÿä¸€åŒ–çš„æŒ‡å¯¼æ–‡æ¡£ï¼Œæ‰€æœ‰ç¼“å­˜ç›¸å…³çš„å¼€å‘å’Œä¼˜åŒ–å·¥ä½œéƒ½åº”ä¸¥æ ¼éµå¾ªæœ¬æŠ¥å‘Šæå‡ºçš„è§„èŒƒå’Œå»ºè®®ã€‚**