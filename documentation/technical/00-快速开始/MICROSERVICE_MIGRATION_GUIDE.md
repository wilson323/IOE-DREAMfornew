# ğŸš€ IOE-DREAMé¡¹ç›®å¾®æœåŠ¡åŒ–è¿ç§»æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-25
**æœ€åæ›´æ–°**: 2025-11-25
**ç»´æŠ¤è€…**: SmartAdmin Team
**çŠ¶æ€**: [è¯„å®¡]
**é€‚ç”¨èŒƒå›´**: IOE-DREAMæ™ºèƒ½ç®¡ç†ç³»ç»Ÿå¾®æœåŠ¡åŒ–æ”¹é€ 

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºIOE-DREAMé¡¹ç›®çš„ç°æœ‰å•ä½“æ¶æ„ï¼Œæä¾›å®Œæ•´çš„å¾®æœåŠ¡åŒ–è¿ç§»æŒ‡å—ã€‚è¿ç§»éµå¾ªæ¸è¿›å¼é‡æ„åŸåˆ™ï¼Œç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§å’Œç³»ç»Ÿç¨³å®šæ€§ï¼ŒåŒæ—¶å»ºç«‹ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„æ ‡å‡†ã€‚

### ğŸ¯ è¿ç§»ç›®æ ‡

- **ä¸šåŠ¡ç›®æ ‡**: æå‡ç³»ç»Ÿå¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿå¼€å‘æ•ˆç‡
- **æŠ€æœ¯ç›®æ ‡**: å»ºç«‹äº‘åŸç”Ÿå¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²å’ŒDevOps
- **è´¨é‡ç›®æ ‡**: ç¡®ä¿è¿ç§»è¿‡ç¨‹é›¶ä¸šåŠ¡ä¸­æ–­ï¼Œ99.9%ç³»ç»Ÿå¯ç”¨æ€§

---

## ğŸ—ï¸ ç°çŠ¶åˆ†æ

### å½“å‰æ¶æ„ç‰¹ç‚¹

```mermaid
graph TB
    subgraph "IOE-DREAMå•ä½“æ¶æ„"
        A[å‰ç«¯Vue3åº”ç”¨] --> B[Nginxåå‘ä»£ç†]
        B --> C[Spring Bootåº”ç”¨]
        C --> D[MySQLæ•°æ®åº“]
        C --> E[Redisç¼“å­˜]
        C --> F[æ–‡ä»¶å­˜å‚¨]
    end

    subgraph "ä¸šåŠ¡æ¨¡å—"
        G[é—¨ç¦ç®¡ç†]
        H[æ¶ˆè´¹ç®¡ç†]
        I[è€ƒå‹¤ç®¡ç†]
        J[è§†é¢‘ç›‘æ§]
        K[äººå‘˜ç®¡ç†]
        L[æƒé™ç®¡ç†]
    end

    C --> G
    C --> H
    C --> I
    C --> J
    C --> K
    C --> L
```

#### ç°æœ‰æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Vue3 + TypeScript + Ant Design Vue
- **åç«¯**: Java 17 + Spring Boot 3.x + Sa-Token + MyBatis-Plus
- **æ•°æ®åº“**: MySQL 8.0 + Redis
- **éƒ¨ç½²**: å•æœºéƒ¨ç½² + Dockerå®¹å™¨

#### æ¶æ„ä¼˜åŠ¿
- âœ… å¼€å‘æ•ˆç‡é«˜ï¼Œéƒ¨ç½²ç®€å•
- âœ… æŠ€æœ¯æ ˆç»Ÿä¸€ï¼Œç»´æŠ¤æˆæœ¬ä½
- âœ… äº‹åŠ¡ç®¡ç†ç®€å•ï¼Œæ•°æ®ä¸€è‡´æ€§å¼º

#### æ¶æ„æŒ‘æˆ˜
- âŒ æ¨¡å—è€¦åˆåº¦é«˜ï¼Œç‹¬ç«‹éƒ¨ç½²å›°éš¾
- âŒ æŠ€æœ¯æ ˆå›ºåŒ–ï¼Œåˆ›æ–°å—é™
- âŒ æ‰©å±•æ€§å—é™ï¼Œæ€§èƒ½ç“¶é¢ˆæ˜æ˜¾
- âŒ å›¢é˜Ÿåä½œæ•ˆç‡ä½ï¼Œå‘å¸ƒé£é™©å¤§

---

## ğŸ¯ å¾®æœåŠ¡æ¶æ„è®¾è®¡

### ç›®æ ‡æ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    subgraph "ç”¨æˆ·æ¥å…¥å±‚"
        A1[Webç®¡ç†ç«¯]
        A2[ç§»åŠ¨ç«¯APP]
        A3[ç¬¬ä¸‰æ–¹ç³»ç»Ÿ]
        A4[IoTè®¾å¤‡]
    end

    subgraph "APIç½‘å…³å±‚"
        B1[API Gateway<br/>Spring Cloud Gateway]
        B2[è´Ÿè½½å‡è¡¡å™¨<br/>Nginx]
        B3[è®¤è¯æˆæƒä¸­å¿ƒ<br/>OAuth2/JWT]
    end

    subgraph "æ ¸å¿ƒä¸šåŠ¡æœåŠ¡"
        C1[è®¾å¤‡ç®¡ç†æœåŠ¡<br/>Device Service]
        C2[äººå‘˜ç®¡ç†æœåŠ¡<br/>People Service]
        C3[é—¨ç¦ç®¡ç†æœåŠ¡<br/>Access Control Service]
        C4[æ¶ˆè´¹ç®¡ç†æœåŠ¡<br/>Consume Service]
        C5[è€ƒå‹¤ç®¡ç†æœåŠ¡<br/>Attendance Service]
        C6[è§†é¢‘ç›‘æ§æœåŠ¡<br/>Video Service]
        C7[è®¿å®¢ç®¡ç†æœåŠ¡<br/>Visitor Service]
        C8[æƒé™ç®¡ç†æœåŠ¡<br/>Permission Service]
        C9[é€šçŸ¥æœåŠ¡<br/>Notification Service]
    end

    subgraph "åŸºç¡€è®¾æ–½æœåŠ¡"
        D1[é…ç½®ä¸­å¿ƒ<br/>Nacos Config]
        D2[æœåŠ¡æ³¨å†Œå‘ç°<br/>Nacos Discovery]
        D3[åˆ†å¸ƒå¼äº‹åŠ¡<br/>Seata]
        D4[æ¶ˆæ¯é˜Ÿåˆ—<br/>RocketMQ]
        D5[åˆ†å¸ƒå¼ç¼“å­˜<br/>Redis Cluster]
        D6[ç›‘æ§é“¾è·¯è¿½è¸ª<br/>Prometheus+Jaeger]
    end

    subgraph "æ•°æ®å­˜å‚¨å±‚"
        E1[ä¸šåŠ¡æ•°æ®åº“<br/>MySQL Cluster]
        E2[æ–‡ä»¶å­˜å‚¨<br/>MinIO/OSS]
        E3[æœç´¢å¼•æ“<br/>Elasticsearch]
        E4[æ—¶åºæ•°æ®åº“<br/>InfluxDB]
    end

    A1 --> B1
    A2 --> B1
    A3 --> B1
    A4 --> B1

    B1 --> C1
    B1 --> C2
    B1 --> C3
    B1 --> C4
    B1 --> C5
    B1 --> C6
    B1 --> C7
    B1 --> C8
    B1 --> C9

    C1 --> D1
    C2 --> D2
    C3 --> D3
    C4 --> D4
    C5 --> D5
    C6 --> D6

    C1 --> E1
    C2 --> E1
    C3 --> E2
    C4 --> E3
    C5 --> E4
```

### æœåŠ¡æ‹†åˆ†ç­–ç•¥

#### 1. æŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†

| æœåŠ¡åç§° | èŒè´£è¾¹ç•Œ | æ•°æ®ç‹¬ç«‹æ€§ | æŠ€æœ¯æ ˆ |
|---------|---------|-----------|--------|
| **è®¾å¤‡ç®¡ç†æœåŠ¡** | è®¾å¤‡æ³¨å†Œã€é…ç½®ã€çŠ¶æ€ç®¡ç† | ç‹¬ç«‹è®¾å¤‡æ•°æ®åº“ | Spring Boot + Netty |
| **äººå‘˜ç®¡ç†æœåŠ¡** | å‘˜å·¥ä¿¡æ¯ã€ç»„ç»‡æ¶æ„ | ç‹¬ç«‹äººå‘˜æ•°æ®åº“ | Spring Boot + MyBatis |
| **é—¨ç¦ç®¡ç†æœåŠ¡** | é—¨ç¦æ§åˆ¶ã€æƒé™éªŒè¯ | ç‹¬ç«‹é—¨ç¦æ•°æ®åº“ | Spring Boot + Redis |
| **æ¶ˆè´¹ç®¡ç†æœåŠ¡** | æ¶ˆè´¹è®°å½•ã€è´¦æˆ·ç®¡ç† | ç‹¬ç«‹æ¶ˆè´¹æ•°æ®åº“ | Spring Boot + Seata |
| **è€ƒå‹¤ç®¡ç†æœåŠ¡** | è€ƒå‹¤è®°å½•ã€ç»Ÿè®¡åˆ†æ | ç‹¬ç«‹è€ƒå‹¤æ•°æ®åº“ | Spring Boot + InfluxDB |
| **è§†é¢‘ç›‘æ§æœåŠ¡** | è§†é¢‘æµã€å½•åƒç®¡ç† | æ–‡ä»¶å­˜å‚¨+å…ƒæ•°æ® | Spring Boot + FFmpeg |
| **è®¿å®¢ç®¡ç†æœåŠ¡** | è®¿å®¢é¢„çº¦ã€å‡ºå…¥ç®¡ç†ã€è®¿å®¢è®°å½• | ç‹¬ç«‹è®¿å®¢æ•°æ®åº“ | Spring Boot + Redis |
| **æƒé™ç®¡ç†æœåŠ¡** | ç”¨æˆ·è®¤è¯ã€æƒé™æ§åˆ¶ | ç‹¬ç«‹æƒé™æ•°æ®åº“ | Spring Boot + Sa-Token |
| **é€šçŸ¥æœåŠ¡** | æ¶ˆæ¯æ¨é€ã€é‚®ä»¶çŸ­ä¿¡ | è½»é‡çº§æ•°æ®åº“ | Spring Boot + RocketMQ |

#### 2. æœåŠ¡ä¾èµ–å…³ç³»

```mermaid
graph LR
    A[è®¾å¤‡ç®¡ç†æœåŠ¡] --> B[é—¨ç¦ç®¡ç†æœåŠ¡]
    A --> C[è§†é¢‘ç›‘æ§æœåŠ¡]
    D[äººå‘˜ç®¡ç†æœåŠ¡] --> B
    D --> E[è€ƒå‹¤ç®¡ç†æœåŠ¡]
    D --> F[æ¶ˆè´¹ç®¡ç†æœåŠ¡]
    D --> G[è®¿å®¢ç®¡ç†æœåŠ¡]
    H[æƒé™ç®¡ç†æœåŠ¡] --> B
    H --> C
    H --> E
    H --> F
    H --> G
    I[é€šçŸ¥æœåŠ¡] --> B
    I --> E
    I --> F
    I --> G
```

---

## ğŸ“… è¿ç§»è·¯çº¿å›¾

### é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½å‡†å¤‡ (4-6å‘¨)

#### ç›®æ ‡
å»ºç«‹å¾®æœåŠ¡åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬æœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ä¸­å¿ƒã€APIç½‘å…³ç­‰ã€‚

#### å…³é”®ä»»åŠ¡
- [ ] **æœåŠ¡æ³¨å†Œä¸­å¿ƒæ­å»º** (Nacosé›†ç¾¤)
- [ ] **é…ç½®ä¸­å¿ƒéƒ¨ç½²** (Nacos Config)
- [ ] **APIç½‘å…³å®æ–½** (Spring Cloud Gateway)
- [ ] **ç›‘æ§ä½“ç³»å»ºç«‹** (Prometheus + Grafana)
- [ ] **æ—¥å¿—ç³»ç»Ÿæ­å»º** (ELK Stack)
- [ ] **CI/CDæµæ°´çº¿** (Jenkins/GitLab CI)

#### äº¤ä»˜ç‰©
- å¾®æœåŠ¡åŸºç¡€è®¾æ–½ç¯å¢ƒ
- ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
- è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿
- åŸºç¡€è¿ç»´æ‰‹å†Œ

### é˜¶æ®µ2ï¼šæœåŠ¡æ‹†åˆ†è¯•ç‚¹ (6-8å‘¨)

#### ç›®æ ‡
é€‰æ‹©è¾¹ç•Œæ¸…æ™°ã€è€¦åˆåº¦ä½çš„æ¨¡å—ä½œä¸ºè¯•ç‚¹ï¼ŒéªŒè¯å¾®æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆã€‚

#### è¯•ç‚¹æœåŠ¡ï¼šè®¾å¤‡ç®¡ç†æœåŠ¡

##### æ‹†åˆ†èŒƒå›´
- è®¾å¤‡åŸºç¡€ä¿¡æ¯ç®¡ç†
- è®¾å¤‡çŠ¶æ€ç›‘æ§
- è®¾å¤‡é…ç½®ç®¡ç†
- è®¾å¤‡è®¤è¯æˆæƒ

##### æŠ€æœ¯å®ç°
```java
// è®¾å¤‡ç®¡ç†æœåŠ¡æ¶æ„
@SpringBootApplication
@EnableDiscoveryClient
@EnableConfigurationProperties
public class DeviceServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(DeviceServiceApplication.class, args);
    }
}

// è®¾å¤‡ç®¡ç†æ§åˆ¶å™¨
@RestController
@RequestMapping("/api/devices")
@RequiredArgsConstructor
public class DeviceController {

    private final DeviceService deviceService;

    @GetMapping("/{deviceId}")
    @SaCheckPermission("device:query")
    public ResponseDTO<DeviceVO> getDevice(@PathVariable Long deviceId) {
        return deviceService.getDevice(deviceId);
    }

    @PostMapping
    @SaCheckPermission("device:add")
    public ResponseDTO<Long> createDevice(@Valid @RequestBody DeviceCreateDTO dto) {
        return deviceService.createDevice(dto);
    }
}
```

#### æ•°æ®è¿ç§»ç­–ç•¥
- **åŒå†™æ¨¡å¼**: æ–°æœåŠ¡å†™æ–°åº“ï¼ŒåŒæ­¥å†™æ—§åº“
- **æ•°æ®åŒæ­¥**: åŸºäºCanalçš„å®æ—¶æ•°æ®åŒæ­¥
- **é€æ­¥åˆ‡æ¢**: æµé‡é€æ­¥åˆ‡æ¢åˆ°æ–°æœåŠ¡
- **å›æ»šæ–¹æ¡ˆ**: æ”¯æŒå¿«é€Ÿå›æ»šåˆ°å•ä½“æ¶æ„

### é˜¶æ®µ3ï¼šæ ¸å¿ƒæœåŠ¡è¿ç§» (12-16å‘¨)

#### ç›®æ ‡
è¿ç§»æ ¸å¿ƒä¸šåŠ¡æœåŠ¡ï¼ŒåŒ…æ‹¬äººå‘˜ç®¡ç†ã€é—¨ç¦ç®¡ç†ã€æ¶ˆè´¹ç®¡ç†ç­‰ã€‚

#### è¿ç§»é¡ºåº
1. **äººå‘˜ç®¡ç†æœåŠ¡** - åŸºç¡€æ•°æ®æœåŠ¡ï¼Œä¾èµ–å°‘
2. **æƒé™ç®¡ç†æœåŠ¡** - è¢«ä¾èµ–çš„æœåŠ¡ï¼Œä¼˜å…ˆè¿ç§»
3. **é€šçŸ¥æœåŠ¡** - ç‹¬ç«‹æ€§å¼ºï¼Œé£é™©ä½
4. **é—¨ç¦ç®¡ç†æœåŠ¡** - æ ¸å¿ƒä¸šåŠ¡ï¼Œä¾èµ–äººå‘˜æƒé™
5. **æ¶ˆè´¹ç®¡ç†æœåŠ¡** - äº‹åŠ¡å¤æ‚ï¼Œéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡
6. **è€ƒå‹¤ç®¡ç†æœåŠ¡** - æ•°æ®é‡å¤§ï¼Œéœ€è¦æ€§èƒ½ä¼˜åŒ–
7. **è§†é¢‘ç›‘æ§æœåŠ¡** - èµ„æºå¯†é›†ï¼Œæœ€åè¿ç§»

#### åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
```java
// åŸºäºSeataçš„åˆ†å¸ƒå¼äº‹åŠ¡
@Service
@Transactional
@RequiredArgsConstructor
public class ConsumeService {

    private final AccountService accountService;
    private final ConsumeRecordService consumeRecordService;

    @GlobalTransactional
    public ResponseDTO<String> processConsume(ConsumeRequestDTO dto) {
        try {
            // 1. æ‰£å‡è´¦æˆ·ä½™é¢
            accountService.deductBalance(dto.getAccountId(), dto.getAmount());

            // 2. åˆ›å»ºæ¶ˆè´¹è®°å½•
            consumeRecordService.createRecord(dto);

            // 3. å‘é€é€šçŸ¥
            notificationService.sendConsumeNotification(dto);

            return ResponseDTO.ok("æ¶ˆè´¹æˆåŠŸ");
        } catch (Exception e) {
            TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
            throw new SmartException("æ¶ˆè´¹å¤±è´¥: " + e.getMessage());
        }
    }
}
```

### é˜¶æ®µ4ï¼šä¼˜åŒ–å’Œæ²»ç† (4-6å‘¨)

#### ç›®æ ‡
å®Œå–„å¾®æœåŠ¡æ²»ç†èƒ½åŠ›ï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§ã€‚

#### å…³é”®ä»»åŠ¡
- [ ] **æœåŠ¡ç½‘æ ¼å®æ–½** (Istio)
- [ ] **ç†”æ–­é™çº§ä¼˜åŒ–** (Hystrix/Sentinel)
- [ ] **é™æµç­–ç•¥** (Guava RateLimiter)
- [ ] **ç¼“å­˜ä¼˜åŒ–** (Rediså¤šçº§ç¼“å­˜)
- [ ] **æ•°æ®åº“ä¼˜åŒ–** (è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨)
- [ ] **å®‰å…¨åŠ å›º** (æœåŠ¡é—´mTLS)

---

## ğŸ”§ æŠ€æœ¯å®æ–½æŒ‡å—

### APIç½‘å…³é…ç½®

```yaml
# Spring Cloud Gatewayé…ç½®
spring:
  cloud:
    gateway:
      routes:
        # è®¾å¤‡ç®¡ç†æœåŠ¡è·¯ç”±
        - id: device-service
          uri: lb://device-service
          predicates:
            - Path=/api/devices/**
          filters:
            - StripPrefix=2
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20

        # äººå‘˜ç®¡ç†æœåŠ¡è·¯ç”±
        - id: people-service
          uri: lb://people-service
          predicates:
            - Path=/api/people/**
          filters:
            - StripPrefix=2

      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOriginPatterns: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
            allowedHeaders: "*"
            allowCredentials: true
```

### æœåŠ¡æ³¨å†Œå‘ç°

```yaml
# NacosæœåŠ¡æ³¨å†Œé…ç½®
spring:
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:nacos1:8848,nacos2:8848,nacos3:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        cluster-name: ${CLUSTER_NAME:default}
        metadata:
          version: ${SERVICE_VERSION:1.0.0}
          zone: ${ZONE:default}
      config:
        server-addr: ${NACOS_SERVER_ADDR:nacos1:8848,nacos2:8848,nacos3:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        file-extension: yaml
        refresh-enabled: true
```

### åˆ†å¸ƒå¼é…ç½®ç®¡ç†

```yaml
# é…ç½®ä¸­å¿ƒé…ç½®ç¤ºä¾‹
ioe-dream:
  device:
    service:
      # è®¾å¤‡è¿æ¥é…ç½®
      connection:
        max-connections: 10000
        timeout: 30000
        retry-attempts: 3
      # è®¾å¤‡è®¤è¯é…ç½®
      auth:
        token-expire: 3600
        refresh-threshold: 300
  notification:
    service:
      # é€šçŸ¥æ¸ é“é…ç½®
      channels:
        email:
          enabled: true
          batch-size: 100
        sms:
          enabled: true
          rate-limit: 10/minute
        push:
          enabled: true
          ttl: 86400
```

### ç›‘æ§å’Œé“¾è·¯è¿½è¸ª

```yaml
# Prometheusç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
        step: 30s

# é“¾è·¯è¿½è¸ªé…ç½®
spring:
  sleuth:
    sampler:
      probability: 1.0
    zipkin:
      base-url: ${ZIPKIN_BASE_URL:http://zipkin:9411}
      sender:
        type: rabbit
```

---

## ğŸš¨ é£é™©æ§åˆ¶å’Œå›æ»šç­–ç•¥

### è¿ç§»é£é™©è¯†åˆ«

| é£é™©ç±»å‹ | é£é™©æè¿° | å½±å“ç­‰çº§ | åº”å¯¹ç­–ç•¥ |
|---------|---------|---------|---------|
| **æ•°æ®ä¸€è‡´æ€§** | åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ•°æ®ä¸ä¸€è‡´ | é«˜ | åˆ†å¸ƒå¼äº‹åŠ¡+è¡¥å¿æœºåˆ¶ |
| **æ€§èƒ½ä¸‹é™** | æœåŠ¡è°ƒç”¨å¢åŠ å»¶è¿Ÿ | ä¸­ | æœåŠ¡ä¼˜åŒ–+ç¼“å­˜ç­–ç•¥ |
| **æœåŠ¡æ•…éšœ** | å•ä¸ªæœåŠ¡å½±å“æ•´ä½“ | é«˜ | ç†”æ–­é™çº§+ç›‘æ§å‘Šè­¦ |
| **è¿ç»´å¤æ‚åº¦** | æœåŠ¡æ•°é‡å¢åŠ è¿ç»´æˆæœ¬ | ä¸­ | è‡ªåŠ¨åŒ–è¿ç»´+ç›‘æ§å·¥å…· |
| **å›¢é˜ŸæŠ€èƒ½** | å¾®æœåŠ¡æŠ€æœ¯æ ˆå­¦ä¹ æˆæœ¬ | ä¸­ | åŸ¹è®­+æ–‡æ¡£+æœ€ä½³å®è·µ |

### å›æ»šç­–ç•¥

#### æ•°æ®åº“å›æ»š
```sql
-- 1. åœæ­¢æ–°æœåŠ¡å†™å…¥
-- 2. æ•°æ®åŒæ­¥æ ¡éªŒ
SELECT COUNT(*) FROM old_db.device t1
WHERE NOT EXISTS (SELECT 1 FROM new_db.device t2 WHERE t2.id = t1.id);

-- 3. åˆ‡æ¢æµé‡åˆ°æ—§æœåŠ¡
-- 4. æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
-- 5. å¯åŠ¨å®Œæ•´ä¸šåŠ¡åŠŸèƒ½
```

#### æœåŠ¡å›æ»š
```bash
#!/bin/bash
# å¿«é€Ÿå›æ»šè„šæœ¬
echo "å¼€å§‹æ‰§è¡Œå¾®æœåŠ¡å›æ»š..."

# 1. åˆ‡æ¢APIç½‘å…³è·¯ç”±
kubectl patch virtualservice device-service --type merge -p '{
  "spec": {
    "http": [
      {
        "match": [{"uri": {"prefix": "/api/devices"}}],
        "route": [{"destination": {"host": "monolith-service", "port": {"number": 8080}}}]
      }
    ]
  }
}'

# 2. åœæ­¢æ–°æœåŠ¡
kubectl scale deployment device-service --replicas=0

# 3. éªŒè¯æ—§æœåŠ¡åŠŸèƒ½
curl -X GET "http://api.ioe-dream.com/api/devices/health"

echo "å›æ»šå®Œæˆï¼"
```

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡å’ŒéªŒæ”¶æ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• | éªŒæ”¶æ ‡å‡† |
|---------|--------|---------|---------|
| **ç³»ç»Ÿå¯ç”¨æ€§** | â‰¥99.9% | Prometheusç›‘æ§ | æœˆåº¦ downtime < 43.2åˆ†é’Ÿ |
| **APIå“åº”æ—¶é—´** | P95 < 200ms | APMå·¥å…· | 95%è¯·æ±‚å“åº”æ—¶é—´è¾¾æ ‡ |
| **æœåŠ¡å¯åŠ¨æ—¶é—´** | < 30ç§’ | æ—¥å¿—åˆ†æ | æ‰€æœ‰æœåŠ¡å¯åŠ¨æ—¶é—´è¾¾æ ‡ |
| **æ•…éšœæ¢å¤æ—¶é—´** | < 5åˆ†é’Ÿ | ç›‘æ§å‘Šè­¦ | æ•…éšœè‡ªåŠ¨æ¢å¤æ—¶é—´è¾¾æ ‡ |
| **æ•°æ®ä¸€è‡´æ€§** | 100% | æ•°æ®æ ¡éªŒ | å…³é”®æ•°æ®ä¸€è‡´æ€§100% |

### ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡åç§° | åŸºå‡†å€¼ | ç›®æ ‡å€¼ | æ”¹å–„å¹…åº¦ |
|---------|--------|--------|---------|
| **å¼€å‘æ•ˆç‡** | 1.0 | 1.5 | æå‡50% |
| **éƒ¨ç½²é¢‘ç‡** | 1æ¬¡/å‘¨ | 1æ¬¡/å¤© | æå‡7å€ |
| **å˜æ›´å¤±è´¥ç‡** | 15% | <5% | é™ä½67% |
| **æ•…éšœæ¢å¤æ—¶é—´** | 30åˆ†é’Ÿ | 5åˆ†é’Ÿ | é™ä½83% |
| **èµ„æºåˆ©ç”¨ç‡** | 40% | 70% | æå‡75% |

### éªŒæ”¶æ£€æŸ¥æ¸…å•

#### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- [ ] æ–°å¢å¾®æœåŠ¡ç®¡ç†åŠŸèƒ½
- [ ] ç›‘æ§å‘Šè­¦ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- [ ] æ—¥å¿—æ”¶é›†åˆ†ææ­£å¸¸

#### æ€§èƒ½éªŒæ”¶
- [ ] ç³»ç»Ÿå“åº”æ—¶é—´è¾¾æ ‡
- [ ] å¹¶å‘å¤„ç†èƒ½åŠ›è¾¾æ ‡
- [ ] èµ„æºä½¿ç”¨ç‡åˆç†
- [ ] æ•°æ®åº“æ€§èƒ½æ­£å¸¸

#### è¿ç»´éªŒæ”¶
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿æ­£å¸¸
- [ ] ç›‘æ§å‘Šè­¦è¦†ç›–å®Œæ•´
- [ ] æ•…éšœè‡ªæ„ˆèƒ½åŠ›éªŒè¯
- [ ] å¤‡ä»½æ¢å¤æœºåˆ¶éªŒè¯

#### å®‰å…¨éªŒæ”¶
- [ ] æœåŠ¡é—´è®¤è¯åŠ å¯†
- [ ] APIè®¿é—®æƒé™æ§åˆ¶
- [ ] æ•æ„Ÿæ•°æ®ä¿æŠ¤
- [ ] å®‰å…¨æ¼æ´æ‰«æé€šè¿‡

---

## ğŸ“š é™„å½•

### A. å¾®æœåŠ¡æŠ€æœ¯æ ˆå¯¹ç…§è¡¨

| æŠ€æœ¯é¢†åŸŸ | å•ä½“æ¶æ„ | å¾®æœåŠ¡æ¶æ„ | è¿ç§»æ–¹æ¡ˆ |
|---------|---------|-----------|---------|
| **æœåŠ¡æ¡†æ¶** | Spring Boot | Spring Cloud | é€æ­¥è¿ç§» |
| **é…ç½®ç®¡ç†** | æœ¬åœ°é…ç½®æ–‡ä»¶ | Nacos Config | é…ç½®ä¸­å¿ƒåŒ– |
| **æœåŠ¡å‘ç°** | æ—  | Nacos Discovery | æœåŠ¡æ³¨å†Œ |
| **APIç½‘å…³** | Nginx | Spring Cloud Gateway | æµé‡è·¯ç”± |
| **è´Ÿè½½å‡è¡¡** | Nginx | Ribbon/LoadBalancer | æœåŠ¡è´Ÿè½½å‡è¡¡ |
| **ç†”æ–­é™çº§** | æ—  | Hystrix/Sentinel | æœåŠ¡ä¿æŠ¤ |
| **åˆ†å¸ƒå¼äº‹åŠ¡** | æœ¬åœ°äº‹åŠ¡ | Seata | äº‹åŠ¡é‡æ„ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | æ—  | RocketMQ | å¼‚æ­¥è§£è€¦ |
| **é“¾è·¯è¿½è¸ª** | æ—¥å¿— | Jaeger/Zipkin | åˆ†å¸ƒå¼è¿½è¸ª |

### B. è¿ç§»æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | å·¥ä½œé‡(äººå¤©) | å…³é”®è·¯å¾„ | é£é™©ç­‰çº§ |
|-----|------------|---------|---------|
| **åŸºç¡€è®¾æ–½å‡†å¤‡** | 20 | 4å‘¨ | ä¸­ |
| **è®¾å¤‡æœåŠ¡è¿ç§»** | 30 | 6å‘¨ | é«˜ |
| **äººå‘˜æƒé™è¿ç§»** | 25 | 5å‘¨ | ä¸­ |
| **é—¨ç¦æ¶ˆè´¹è¿ç§»** | 40 | 8å‘¨ | é«˜ |
| **è€ƒå‹¤è§†é¢‘è¿ç§»** | 35 | 7å‘¨ | ä¸­ |
| **æ€§èƒ½ä¼˜åŒ–è°ƒä¼˜** | 20 | 4å‘¨ | ä¸­ |
| **æµ‹è¯•éªŒæ”¶** | 15 | 3å‘¨ | ä½ |
| **æ€»è®¡** | **185** | **37å‘¨** | - |

### C. å›¢é˜ŸæŠ€èƒ½æå‡è®¡åˆ’

#### å¼€å‘å›¢é˜Ÿ
- **å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸ¹è®­** (2å‘¨)
- **Spring Cloudå®è·µåŸ¹è®­** (1å‘¨)
- **Dockerå®¹å™¨åŒ–åŸ¹è®­** (1å‘¨)
- **K8sç¼–æ’åŸ¹è®­** (1å‘¨)

#### è¿ç»´å›¢é˜Ÿ
- **å¾®æœåŠ¡ç›‘æ§åŸ¹è®­** (1å‘¨)
- **æœåŠ¡ç½‘æ ¼åŸ¹è®­** (1å‘¨)
- **æ•…éšœæ’æŸ¥åŸ¹è®­** (1å‘¨)
- **è‡ªåŠ¨åŒ–è¿ç»´åŸ¹è®­** (1å‘¨)

---

**âœ… æœ¬æ–‡æ¡£å°†éšç€å¾®æœåŠ¡åŒ–è¿›ç¨‹æŒç»­æ›´æ–°ï¼Œç¡®ä¿æŠ€æœ¯æ–¹æ¡ˆä¸å®æ–½å®è·µä¿æŒåŒæ­¥ã€‚**