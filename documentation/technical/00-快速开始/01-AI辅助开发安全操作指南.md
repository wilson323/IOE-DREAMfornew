# AI辅助开发安全操作指南

> **版本**: v1.0
> **更新时间**: 2025-11-21
> **基于项目**: IOE-DREAM项目285→48→402编译错误教训

## 🚨 严格禁止的操作

### 立即停止的危险行为
- ❌ **批量文本替换**：`find + sed` 等全局替换操作
- ❌ **自动化脚本修复**：编写和执行修复脚本
- ❌ **无监督的AI执行**：让AI自动生成和修改代码
- ❌ **批量文件操作**：一次性处理多个文件

### 基于IOE-DREAM的惨痛教训
```
第一阶段成功（285→48个错误，83.2%修复率）：
✅ 单文件手动修改
✅ 实时编译验证
✅ 人类决策优先
✅ 严格规范执行

第二阶段失败（48→402个错误，-41%回退率）：
❌ 批量sed替换脚本
❌ 全局自动化修改
❌ 绕过风险评估
❌ 违背渐进式原则

教训：在复杂软件系统中，**控制比速度更重要，可预测性比效率更关键！**
```

## ✅ 推荐的安全操作模式

### AI人类协作模式
```
1. AI分析问题 → 提供诊断报告和建议
2. 人类评估风险 → 决定是否执行及如何执行
3. AI设计方案 → 提供详细的修复策略
4. 人类精确执行 → 手动修改，完全控制
5. 实时验证 → 每次修改后立即编译检查
6. 结果确认 → 成功则继续，失败则回滚
7. AI总结经验 → 提炼最佳实践和方法论
```

### 渐进式修复流程
```markdown
## 单文件修复流程
1. 选择问题文件 → 选择单个最关键的问题文件
2. AI分析该文件 → 分析具体问题和修复方案
3. 人类评估风险 → 确认修改安全性和可行性
4. 设计修改策略 → 明确具体修改内容和步骤
5. 手动精确修改 → 人类执行精确的代码修改
6. 立即编译验证 → 修改后立即编译检查
7. 验证改进效果 → 确认错误数量减少
8. 继续下一个文件 → 重复此流程

## 关键原则
- **单文件优先**：一次只处理一个文件
- **实时验证**：每次修改后立即编译
- **错误只减**：确保编译错误数量只减不增
- **快速回滚**：问题增加时立即恢复原文件
- **人类决策**：所有关键修改必须由人类决策
```

## 🔍 风险评估框架

### 风险评估矩阵
| 影响范围 | 修改复杂度 | 风险等级 | 推荐操作 |
|----------|------------|----------|----------|
| 文件级 | 简单 | 🟢 低风险 | 单文件修复 |
| 文件级 | 中等 | 🟡 中风险 | 分步修复 |
| 文件级 | 复杂 | 🟠 高风险 | 寻求帮助 |
| 模块级 | 简单 | 🟡 中风险 | 寻求帮助 |
| 模块级 | 中等 | 🟠 高风险 | 寻求帮助 |
| 模块级 | 复杂 | 🔴 极高风险 | 禁止操作 |
| 系统级 | 任意 | 🔴 极高风险 | 绝对禁止 |
| 任意范围 | 批量 | 🔴 极高风险 | 绝对禁止 |

### 风险评估检查清单
在执行任何修改前，必须回答以下问题：

**1. 影响范围评估**
- [ ] 是否只影响单个文件？
- [ ] 是否会影响其他相关文件？
- [ ] 是否会影响数据库结构？
- [ ] 是否会影响API接口？

**2. 修改复杂度评估**
- [ ] 修改内容是否简单（如字符串替换）？
- [ ] 是否需要复杂逻辑调整？
- [ ] 是否需要架构变更？
- [ ] 是否有测试覆盖？

**3. 风险等级确认**
- [ ] 风险等级是否为低或中？
- [ ] 是否有可靠的回滚方案？
- [ ] 是否有足够的备份？
- [ ] 团队是否具备处理能力？

**只有所有问题都回答"是"且风险等级为低或中时，才能继续操作！**

## 🛠️ 实时验证机制

### 编译验证标准
```bash
# 每次修改后必须执行
mvn clean compile -q

# 检查错误数量变化
before_errors=$(get_error_count)
# 执行修改...
after_errors=$(get_error_count)

# 验证改进效果
if [ $after_count -lt $before_count ]; then
    echo "✅ 修复成功，错误数量减少"
elif [ $after_count -eq $before_count ]; then
    echo "⚠️ 错误数量不变，需要调整策略"
else
    echo "❌ 错误数量增加，立即回滚！"
    # 立即恢复备份文件
fi
```

### 质量门禁检查
```markdown
## 编译错误零容忍
- 每次修改后编译错误必须减少
- 错误增加必须立即回滚
- 最终目标：编译错误数为零

## 架构规范验证
## repowiki规范检查
- jakarta包名合规性检查
- @Resource依赖注入检查
- 四层架构合规性检查
- UTF-8编码和零乱码检查
```

## 🎯 应急预案

### 立即回滚方案
```bash
# 如果修改导致问题增加，立即执行：
git checkout <filename>

# 如果没有备份，立即停止所有修改
# 重新评估问题，寻求更安全的解决方案
```

### 寻求帮助的条件
- 修改复杂度为高或极高
- 风险等级为中高或极高
- 单次修改影响多个文件
- 缺乏可靠的测试覆盖
- 不确定修改的具体影响范围

### 寻求帮助的流程
1. **详细描述问题**：清楚说明遇到的编译错误
2. **提供上下文信息**：相关代码和错误日志
3. **说明已尝试的方法**：已经尝试过的解决方案
4. **明确需求**：希望得到什么样的帮助

---

**记住：在复杂软件系统中，安全的慢速进步比危险的快速冒进更有价值！**