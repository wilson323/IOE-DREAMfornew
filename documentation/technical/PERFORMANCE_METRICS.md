# SmartAdmin 性能与容量指标指南

> 版本: v1.0.0  
> 责任人: 性能优化组  
> 最后更新: 2025-11-12

## 1. 目标
- 为各业务模块提供统一的性能目标、容量规划与验证流程;
- 指导 Claude Code 与研发团队在交付前完成性能验证与回归。

## 2. 核心指标
| 模块 | 指标 | 目标值 | 备注 |
| --- | --- | --- | --- |
| 权限服务 | P99 响应时间 | ≤ 200ms | 角色查询、权限校验 |
| 设备服务 | 注册吞吐 | ≥ 500 req/min | 支持批量注册场景 |
| 实时推送 | 消息延迟 | ≤ 2s | 95% 消息送达 |
| 告警服务 | ACK 响应 | ≤ 300ms | 双中心部署 |
| 工作流 | 流程启动 | ≤ 400ms | 包含引擎路由 |

## 3. 容量规划
- Redis: 使用集群模式, 单节点内存利用率 ≤ 70%, 订阅通道 < 1000;
- MySQL: 主从架构, 单表行数控制在 1000 万以内, QPS 预留 30% 缓冲;
- WebSocket: 单实例最大连接数 20k, 超出需横向扩容;
- 消息队列: RocketMQ 主题 TPS 预警阈值 500。

## 4. 压测流程
1. 在测试环境预置真实数据副本 ≥ 10%;
2. 使用 JMeter/Gatling 建立统一脚本, 与 `docs/TESTING` 中用例联动;
3. 压测阶段: 升温→高压→回落, 持续至少 30 分钟;
4. 记录系统资源, 包括 CPU、内存、GC、I/O, 并生成报告;
5. 结果与指标对比, 未达标需提交整改方案。

## 5. 回压与降级策略
- WebSocket: 当客户端处理缓慢时, 触发 `429` 并提供重试延迟;
- 告警服务: 超过告警堆积阈值时切换为批量通知;
- 工作流: 当流程引擎延迟 > 1s 时启动只读镜像, 阻断新部署;
- 权限服务: 启动本地缓存降级, 失效时间 2 分钟。

## 6. 监控与告警
- 指标采集: 使用 Prometheus + Grafana, 指标前缀 `smartadmin_*`;
- 必需告警规则:
  - CPU 使用率连续 5 分钟 > 85%;
  - Redis 命中率 < 80%;
  - WebSocket 推送失败率 > 1%;
  - MySQL 主库延迟 > 2s;
- 告警通知: 飞书+短信双渠道。

## 7. 报告模板
```
# 性能压测报告
- 项目模块:
- 时间范围:
- 测试工具:
- 指标结果:
  - 指标A: 实测 / 目标
  - 指标B: 实测 / 目标
- 问题与改进:
- 负责人:
- 提交日期:
```

## 8. 变更管理
- 新增或调整指标需经过性能评审会;
- 更新本指南并同步 `CHANGELOG.md`;
- 所有压测报告需存档于 `docs/performance/reports/`。

## 9. 附录
- 工具: JMeter 5.6+, Gatling 3.9+, Prometheus 2.51+;
- 数据生成脚本: 参考 `docs/scripts/data-import/`;
- 指标说明: 详见 `docs/SmartAdmin规范体系_v4/05-治理运营层/质量度量体系.md`。
