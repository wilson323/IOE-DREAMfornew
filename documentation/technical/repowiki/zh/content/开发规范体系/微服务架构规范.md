# ğŸš€ IOE-DREAM å¾®æœåŠ¡æ¶æ„è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†IOE-DREAMæ™ºæ…§å›­åŒºå¹³å°çš„å¾®æœåŠ¡æ¶æ„è§„èŒƒï¼ŒåŸºäº**APIå¥‘çº¦ä¼˜å…ˆ**å’Œ**é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)**åŸåˆ™ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

---

## ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)
æ¯ä¸ªå¾®æœåŠ¡ä¸“æ³¨äºå•ä¸€ä¸šåŠ¡åŸŸï¼Œé¿å…åŠŸèƒ½æ··æ‚ï¼š
- âœ… æ¶ˆè´¹æœåŠ¡ï¼šä¸“æ³¨äºä¸€å¡é€šæ¶ˆè´¹ç›¸å…³ä¸šåŠ¡
- âœ… é—¨ç¦æœåŠ¡ï¼šä¸“æ³¨äºé—¨ç¦æ§åˆ¶å’Œæƒé™ç®¡ç†
- âŒ é¿å…åˆ›å»º"ç»¼åˆæœåŠ¡"åŒ…å«å¤šä¸ªä¸ç›¸å…³ä¸šåŠ¡

### 2. APIå¥‘çº¦ä¼˜å…ˆåŸåˆ™ (API-First Design)
APIå®šä¹‰å¿…é¡»åœ¨æœåŠ¡å®ç°ä¹‹å‰å®Œæˆï¼š
- âœ… ä½¿ç”¨OpenAPI 3.0è§„èŒƒå®šä¹‰APIå¥‘çº¦
- âœ… APIç‰ˆæœ¬åŒ–ç®¡ç† (v0, v1, v2)
- âœ… APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå’Œç»´æŠ¤

### 3. é¢†åŸŸé©±åŠ¨è®¾è®¡åŸåˆ™ (Domain-Driven Design)
æŒ‰ä¸šåŠ¡é¢†åŸŸç»„ç»‡æ¶æ„ï¼š
- âœ… æ˜ç¡®çš„ä¸šåŠ¡è¾¹ç•Œ (Bounded Context)
- âœ… ç»Ÿä¸€è¯­è¨€ (Ubiquitous Language)
- âœ… é¢†åŸŸæ¨¡å‹ä¸æ•°æ®æ¨¡å‹åˆ†ç¦»

### 4. æ¾è€¦åˆé«˜å†…èšåŸåˆ™ (Loose Coupling, High Cohesion)
æœåŠ¡é—´é€šè¿‡APIå¥‘çº¦äº¤äº’ï¼Œå†…éƒ¨é«˜åº¦å†…èšï¼š
- âœ… æœåŠ¡é—´åªèƒ½é€šè¿‡APIæ¥å£é€šä¿¡
- âœ… é¿å…è·¨æœåŠ¡æ•°æ®åº“ç›´æ¥è®¿é—®
- âœ… ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„å¤„ç†è·¨æœåŠ¡äº‹åŠ¡

---

## ğŸ“¦ æ¨¡å—åˆ’åˆ†è§„èŒƒ

### é¡¹ç›®ç»“æ„è§„èŒƒ

```
ioe-dream-platform/
â”œâ”€â”€ ğŸ“¦ ioe-dream-api/                    # APIå¥‘çº¦å±‚
â”‚   â”œâ”€â”€ ioe-dream-api-consume/           # æ¶ˆè´¹æœåŠ¡API
â”‚   â”œâ”€â”€ ioe-dream-api-access/            # é—¨ç¦æœåŠ¡API
â”‚   â”œâ”€â”€ ioe-dream-api-attendance/        # è€ƒå‹¤æœåŠ¡API
â”‚   â”œâ”€â”€ ioe-dream-api-device/            # è®¾å¤‡æœåŠ¡API
â”‚   â”œâ”€â”€ ioe-dream-api-monitor/           # ç›‘æ§æœåŠ¡API
â”‚   â”œâ”€â”€ ioe-dream-api-video/             # è§†é¢‘æœåŠ¡API
â”‚   â”œâ”€â”€ ioe-dream-api-system/            # ç³»ç»ŸæœåŠ¡API
â”‚   â””â”€â”€ ioe-dream-api-common/            # å…¬å…±APIå®šä¹‰
â”œâ”€â”€ ğŸ“¦ ioe-dream-service/                # å¾®æœåŠ¡å®ç°å±‚
â”‚   â”œâ”€â”€ ioe-dream-service-consume/       # æ¶ˆè´¹æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ ioe-dream-service-access/        # é—¨ç¦æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ ioe-dream-service-attendance/    # è€ƒå‹¤æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ ioe-dream-service-device/        # è®¾å¤‡æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ ioe-dream-service-monitor/       # ç›‘æ§æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ ioe-dream-service-video/         # è§†é¢‘æœåŠ¡å®ç°
â”‚   â””â”€â”€ ioe-dream-service-system/        # ç³»ç»ŸæœåŠ¡å®ç°
â”œâ”€â”€ ğŸ“¦ ioe-dream-gateway/                # APIç½‘å…³
â”œâ”€â”€ ğŸ“¦ ioe-dream-infrastructure/         # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ ioe-dream-common/                # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ioe-dream-cache/                 # ç¼“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ ioe-dream-messaging/             # æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â””â”€â”€ ioe-dream-config/                # é…ç½®ä¸­å¿ƒ
â””â”€â”€ ğŸ“¦ ioe-dream-admin/                  # ç®¡ç†åå°èšåˆæœåŠ¡
```

### APIæ¨¡å—ç»“æ„è§„èŒƒ

æ¯ä¸ªAPIæ¨¡å—å¿…é¡»éµå¾ªä»¥ä¸‹ç»“æ„ï¼š

```
ioe-dream-api-{service}/
â”œâ”€â”€ src/main/java/ioe/dream/api/{service}/
â”‚   â”œâ”€â”€ v0/                              # APIç‰ˆæœ¬v0 (å…¼å®¹æ€§)
â”‚   â”‚   â”œâ”€â”€ dto/                         # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ request/                 # è¯·æ±‚DTO
â”‚   â”‚   â”‚   â””â”€â”€ response/                # å“åº”DTO
â”‚   â”‚   â”œâ”€â”€ enums/                       # æšä¸¾å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ vo/                          # å€¼å¯¹è±¡
â”‚   â”‚   â””â”€â”€ {Service}ApiV0.java           # APIæ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ v1/                              # APIç‰ˆæœ¬v1 (ç¨³å®šç‰ˆæœ¬)
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”‚   â””â”€â”€ response/
â”‚   â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â”œâ”€â”€ vo/
â”‚   â”‚   â””â”€â”€ {Service}ApiV1.java
â”‚   â””â”€â”€ v2/                              # APIç‰ˆæœ¬v2 (æ–°åŠŸèƒ½)
â”‚       â”œâ”€â”€ dto/
â”‚       â”‚   â”œâ”€â”€ request/
â”‚       â”‚   â””â”€â”€ response/
â”‚       â”œâ”€â”€ enums/
â”‚       â”œâ”€â”€ vo/
â”‚       â””â”€â”€ {Service}ApiV2.java
â””â”€â”€ pom.xml
```

### æœåŠ¡å®ç°æ¨¡å—ç»“æ„è§„èŒƒ

æ¯ä¸ªæœåŠ¡å®ç°å¿…é¡»éµå¾ªDDDæ¶æ„ï¼š

```
ioe-dream-service-{service}/
â”œâ”€â”€ src/main/java/ioe/dream/service/{service}/
â”‚   â”œâ”€â”€ application/                     # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ service/                     # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ {Service}ApplicationService.java
â”‚   â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚   â”œâ”€â”€ facade/                      # å¤–è§‚æ¨¡å¼
â”‚   â”‚   â”‚   â””â”€â”€ {Service}Facade.java
â”‚   â”‚   â””â”€â”€ event/                       # äº‹ä»¶å¤„ç†
â”‚   â”‚       â”œâ”€â”€ {Service}EventHandler.java
â”‚   â”‚       â””â”€â”€ impl/
â”‚   â”œâ”€â”€ domain/                          # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ model/                       # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/                  # å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/             # å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/               # èšåˆæ ¹
â”‚   â”‚   â”‚   â””â”€â”€ repository/              # ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ service/                     # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ {Domain}Service.java
â”‚   â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚   â””â”€â”€ event/                       # é¢†åŸŸäº‹ä»¶
â”‚   â”‚       â”œâ”€â”€ {Domain}Event.java
â”‚   â”‚       â””â”€â”€ {Domain}EventPublisher.java
â”‚   â”œâ”€â”€ infrastructure/                   # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ repository/impl/             # ä»“å‚¨å®ç°
â”‚   â”‚   â”œâ”€â”€ messaging/                   # æ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ external/                    # å¤–éƒ¨æœåŠ¡
â”‚   â”‚   â””â”€â”€ config/                      # é…ç½®
â”‚   â””â”€â”€ interfaces/                      # æ¥å£å±‚
â”‚       â”œâ”€â”€ rest/                        # RESTæ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ v0/                       # v0ç‰ˆæœ¬æ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ v1/                       # v1ç‰ˆæœ¬æ§åˆ¶å™¨
â”‚       â”‚   â””â”€â”€ v2/                       # v2ç‰ˆæœ¬æ§åˆ¶å™¨
â”‚       â”œâ”€â”€ grpc/                        # gRPCæœåŠ¡
â”‚       â””â”€â”€ event/                      # äº‹ä»¶å‘å¸ƒ
â””â”€â”€ pom.xml
```

---

## ğŸ”— æœåŠ¡é—´é€šä¿¡è§„èŒƒ

### 1. RESTful APIé€šä¿¡

#### APIè·¯å¾„è§„èŒƒ
```
åŸºç¡€è·¯å¾„: https://api.ioe-dream.com/{version}/{service}

ç¤ºä¾‹:
https://api.ioe-dream.com/v1/consume/accounts/{accountId}
https://api.ioe-dream.com/v1/access/permissions
https://api.ioe-dream.com/v0/legacy-accounts/{accountId}
```

#### HTTPæ–¹æ³•è§„èŒƒ
- `GET /v1/consume/accounts` - è·å–è´¦æˆ·åˆ—è¡¨
- `POST /v1/consume/accounts` - åˆ›å»ºè´¦æˆ·
- `PUT /v1/consume/accounts/{id}` - æ›´æ–°è´¦æˆ·
- `DELETE /v1/consume/accounts/{id}` - åˆ é™¤è´¦æˆ·
- `PATCH /v1/consume/accounts/{id}/status` - éƒ¨åˆ†æ›´æ–°çŠ¶æ€

#### è¯·æ±‚å“åº”è§„èŒƒ
```java
// ç»Ÿä¸€å“åº”æ ¼å¼
public class ApiResponse<T> {
    private Integer code;           // çŠ¶æ€ç 
    private String message;        // æ¶ˆæ¯
    private T data;               // æ•°æ®
    private Long timestamp;        // æ—¶é—´æˆ³
    private String traceId;        // é“¾è·¯è¿½è¸ªID
}
```

### 2. äº‹ä»¶é©±åŠ¨é€šä¿¡

#### äº‹ä»¶å‘½åè§„èŒƒ
```java
// é¢†åŸŸäº‹ä»¶å‘½å: {èšåˆæ ¹å}{äº‹ä»¶å}Event
public class AccountCreatedEvent extends DomainEvent {
    private Long accountId;
    private String accountNumber;
    private LocalDateTime createdTime;
}

public class AccessPermissionGrantedEvent extends DomainEvent {
    private Long personId;
    private String deviceId;
    private String areaId;
    private LocalDateTime grantedTime;
}
```

#### äº‹ä»¶å‘å¸ƒè§„èŒƒ
```java
@EventPublisher
public class AccountEventPublisher {

    public void publishAccountCreated(Account account) {
        AccountCreatedEvent event = AccountCreatedEvent.builder()
            .accountId(account.getId())
            .accountNumber(account.getAccountNumber())
            .createdTime(LocalDateTime.now())
            .build();

        eventPublisher.publish(event);
    }
}
```

### 3. æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡

#### æ¶ˆæ¯ä¸»é¢˜è§„èŒƒ
```
ä¸šåŠ¡ä¸»é¢˜: ioe.dream.{service}.{event}
ç¤ºä¾‹:
ioe.dream.consume.account.created
ioe.dream.access.permission.granted
ioe.dream.attendance.record.created
```

#### æ¶ˆæ¯æ ¼å¼è§„èŒƒ
```json
{
  "eventId": "uuid",
  "eventType": "AccountCreatedEvent",
  "eventTime": "2025-01-01T12:00:00Z",
  "aggregateId": "account-123",
  "aggregateType": "Account",
  "data": {
    "accountId": 123,
    "accountNumber": "CARD001",
    "balance": 1000.00
  },
  "metadata": {
    "source": "consume-service",
    "version": "1.0"
  }
}
```

---

## ğŸ—‚ï¸ åŒ…ç»“æ„å‘½åè§„èŒƒ

### åŸºç¡€åŒ…å‘½åè§„èŒƒ
```
åŸºç¡€åŒ…å: ioe.dream.{layer}.{service}

å±‚çº§è¯´æ˜:
- api: APIå¥‘çº¦å±‚
- service: å¾®æœåŠ¡å®ç°å±‚
- gateway: APIç½‘å…³å±‚
- infrastructure: åŸºç¡€è®¾æ–½å±‚
- common: å…¬å…±ç»„ä»¶å±‚
```

### APIæ¨¡å—åŒ…å‘½å
```
ioe.dream.api.{service}.{version}.{component}

ç»„ä»¶è¯´æ˜:
- dto: æ•°æ®ä¼ è¾“å¯¹è±¡
  - request: è¯·æ±‚DTO
  - response: å“åº”DTO
- vo: å€¼å¯¹è±¡
- enums: æšä¸¾å®šä¹‰
- constants: å¸¸é‡å®šä¹‰
- exception: å¼‚å¸¸å®šä¹‰
```

### æœåŠ¡å®ç°åŒ…å‘½å
```
ioe.dream.service.{service}.{layer}.{component}

å±‚çº§è¯´æ˜:
- application: åº”ç”¨å±‚
  - service: åº”ç”¨æœåŠ¡
  - facade: å¤–è§‚æœåŠ¡
  - event: åº”ç”¨äº‹ä»¶å¤„ç†
- domain: é¢†åŸŸå±‚
  - model: é¢†åŸŸæ¨¡å‹
    - entity: å®ä½“
    - valueobject: å€¼å¯¹è±¡
    - aggregate: èšåˆæ ¹
  - service: é¢†åŸŸæœåŠ¡
  - repository: ä»“å‚¨æ¥å£
  - event: é¢†åŸŸäº‹ä»¶
- infrastructure: åŸºç¡€è®¾æ–½å±‚
  - repository: ä»“å‚¨å®ç°
  - messaging: æ¶ˆæ¯å¤„ç†
  - external: å¤–éƒ¨æœåŠ¡é›†æˆ
- interfaces: æ¥å£å±‚
  - rest: RESTæ§åˆ¶å™¨
  - grpc: gRPCæœåŠ¡
  - dto: æ¥å£DTO
  - mapper: å¯¹è±¡æ˜ å°„
```

---

## ğŸ”„ æ•°æ®ä¸€è‡´æ€§è§„èŒƒ

### 1. äº‹åŠ¡è¾¹ç•Œè§„èŒƒ

#### æœ¬åœ°äº‹åŠ¡
```java
@Service
@Transactional
public class AccountApplicationService {

    @Transactional
    public void createAccount(CreateAccountRequest request) {
        // åœ¨å•ä¸ªæœåŠ¡å†…çš„äº‹åŠ¡æ“ä½œ
        Account account = accountRepository.save(buildAccount(request));
        balanceChangeRepository.save(buildInitialBalance(account.getId()));
        accountAuditRepository.save(buildAuditLog(account.getId()));
    }
}
```

#### åˆ†å¸ƒå¼äº‹åŠ¡ (Sagaæ¨¡å¼)
```java
@Service
public class ConsumeSagaOrchestrator {

    @SagaOrchestrationStart
    public void startConsumeTransaction(ConsumeRequest request) {
        // æ­¥éª¤1: æ‰£å‡è´¦æˆ·ä½™é¢
        AccountDeductCommand deductCommand = buildDeductCommand(request);
        sagaManager.sendCommand(deductCommand);
    }

    @SagaEventHandler
    public void onAccountDeducted(AccountDeductedEvent event) {
        // æ­¥éª¤2: åˆ›å»ºæ¶ˆè´¹è®°å½•
        ConsumeRecordCreateCommand createCommand = buildCreateCommand(event);
        sagaManager.sendCommand(createCommand);
    }

    @SagaEventHandler
    public void onConsumeRecordCreated(ConsumeRecordCreatedEvent event) {
        // æ­¥éª¤3: å‘é€é€šçŸ¥
        NotificationSendCommand notificationCommand = buildNotificationCommand(event);
        sagaManager.sendCommand(notificationCommand);
    }
}
```

### 2. æœ€ç»ˆä¸€è‡´æ€§ä¿è¯

#### äº‹ä»¶å­˜å‚¨æ¨¡å¼
```java
@Entity
public class AccountEvent {
    private Long id;
    private String eventId;
    private String eventType;
    private String aggregateId;
    private String eventData;
    private LocalDateTime eventTime;
    private Integer version;
}
```

#### è¡¥å¿æœºåˆ¶
```java
@Component
public class ConsumeCompensationHandler {

    @CompensationHandler("account-deduct-failed")
    public void compensateAccountDeduct(AccountDeductFailedEvent event) {
        // å›æ»šè´¦æˆ·ä½™é¢æ‰£å‡
        AccountRollbackCommand rollbackCommand = buildRollbackCommand(event);
        commandGateway.send(rollbackCommand);
    }
}
```

---

## ğŸ›¡ï¸ å®‰å…¨æ¶æ„è§„èŒƒ

### 1. APIå®‰å…¨è§„èŒƒ

#### è®¤è¯æœºåˆ¶
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/v0/**").permitAll()  // v0ç‰ˆæœ¬å…¼å®¹æ€§
                .requestMatchers("/v1/auth/**").permitAll()
                .requestMatchers("/v2/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .oauth2ResourceServer(oauth2 -> oauth2
                .jwt(jwt -> jwt.jwtDecoder(jwtDecoder()))
            )
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )
            .build();
    }
}
```

#### æˆæƒè§„èŒƒ
```java
@RestController
@RequestMapping("/v1/consume")
@PreAuthorize("hasRole('USER')")
public class ConsumeControllerV1 {

    @GetMapping("/accounts")
    @PreAuthorize("hasAuthority('consume:account:read')")
    public ResponseEntity<ApiResponse<List<AccountVO>>> getAccounts() {
        // å®ç°
    }

    @PostMapping("/consume")
    @PreAuthorize("hasAuthority('consume:create')")
    public ResponseEntity<ApiResponse<ConsumeResultVO>> consume(
            @RequestBody @Valid ConsumeRequestDTO request) {
        // å®ç°
    }
}
```

### 2. æœåŠ¡é—´å®‰å…¨é€šä¿¡

#### mTLSé…ç½®
```yaml
# application.yml
spring:
  cloud:
    openfeign:
      client:
        config:
          default:
            connectTimeout: 5000
            readTimeout: 5000
            loggerLevel: basic
    security:
      oauth2:
        client:
          registration:
            service-client:
              provider: keycloak
              client-id: service-client
              client-secret: ${SERVICE_CLIENT_SECRET}
              authorization-grant-type: client_credentials
              scope: service
```

---

## ğŸ“ˆ ç›‘æ§ä¸å¯è§‚æµ‹æ€§è§„èŒƒ

### 1. å¥åº·æ£€æŸ¥è§„èŒƒ

```java
@Component
public class ServiceHealthIndicator implements HealthIndicator {

    @Override
    public Health health() {
        return Health.up()
            .withDetail("service", "ioe-dream-consume-service")
            .withDetail("version", "1.0.0")
            .withDetail("uptime", getUptime())
            .withDetail("database", checkDatabaseHealth())
            .withDetail("cache", checkCacheHealth())
            .build();
    }
}
```

### 2. æŒ‡æ ‡æ”¶é›†è§„èŒƒ

```java
@Component
public class ConsumeMetrics {

    private final MeterRegistry meterRegistry;
    private final Counter consumeCounter;
    private final Timer consumeTimer;

    public ConsumeMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.consumeCounter = Counter.builder("consume.requests")
            .description("Number of consume requests")
            .register(meterRegistry);
        this.consumeTimer = Timer.builder("consume.duration")
            .description("Consume request duration")
            .register(meterRegistry);
    }

    public void recordConsume(String result) {
        consumeCounter.increment(Tags.of("result", result));
    }

    public void recordDuration(Duration duration) {
        consumeTimer.record(duration);
    }
}
```

### 3. é“¾è·¯è¿½è¸ªè§„èŒƒ

```java
@RestController
@RequestMapping("/v1/consume")
public class ConsumeControllerV1 {

    @PostMapping("/consume")
    public ResponseEntity<ApiResponse<ConsumeResultVO>> consume(
            @RequestBody @Valid ConsumeRequestDTO request,
            @RequestHeader("X-Trace-Id") String traceId) {

        Span span = tracer.nextSpan().name("consume-operation");
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(span)) {
            span.tag("service.name", "consume-service");
            span.tag("operation.type", "consume");
            span.tag("trace.id", traceId);

            // ä¸šåŠ¡é€»è¾‘å®ç°
            ConsumeResultVO result = consumeService.processConsume(request);

            return ResponseEntity.ok(ApiResponse.success(result));
        } finally {
            span.end();
        }
    }
}
```

---

## ğŸš€ éƒ¨ç½²è§„èŒƒ

### 1. å®¹å™¨åŒ–è§„èŒƒ

#### Dockerfileè§„èŒƒ
```dockerfile
FROM openjdk:17-jre-slim

LABEL maintainer="IOE-DREAM Team"
LABEL service="consume-service"
LABEL version="1.0.0"

# åº”ç”¨ç”¨æˆ·
RUN addgroup --system spring && adduser --system --ingroup spring

# å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY target/ioe-dream-service-consume-*.jar app.jar

# è®¾ç½®æƒé™
RUN chown -R spring:spring /app

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8080/actuator/health || exit 1

# å¯åŠ¨åº”ç”¨
USER spring
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 2. Kuberneteséƒ¨ç½²è§„èŒƒ

#### éƒ¨ç½²æ¸…å•è§„èŒƒ
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: consume-service
  labels:
    app: consume-service
    version: v1.0.0
spec:
  replicas: 3
  selector:
    matchLabels:
      app: consume-service
  template:
    metadata:
      labels:
        app: consume-service
        version: v1.0.0
    spec:
      containers:
      - name: consume-service
        image: ioe-dream/consume-service:1.0.0
        ports:
        - containerPort: 8080
          name: http
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        - name: DB_HOST
          valueFrom:
            configMapKeyRef:
              name: db-config
              key: host
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health/liveness
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
```

---

## ğŸ“š å¼€å‘è§„èŒƒæ£€æŸ¥æ¸…å•

### âœ… è®¾è®¡é˜¶æ®µæ£€æŸ¥
- [ ] æœåŠ¡è¾¹ç•Œæ˜¯å¦æ˜ç¡® (å•ä¸€ä¸šåŠ¡åŸŸ)
- [ ] APIå¥‘çº¦æ˜¯å¦å·²å®šä¹‰ (OpenAPIè§„èŒƒ)
- [ ] ç‰ˆæœ¬ç­–ç•¥æ˜¯å¦å·²åˆ¶å®š (v0/v1/v2)
- [ ] æ•°æ®æ¨¡å‹æ˜¯å¦å·²è®¾è®¡ (å®ä½“å…³ç³»)
- [ ] äº‹ä»¶æ¨¡å‹æ˜¯å¦å·²å®šä¹‰ (é¢†åŸŸäº‹ä»¶)

### âœ… å¼€å‘é˜¶æ®µæ£€æŸ¥
- [ ] åŒ…ç»“æ„æ˜¯å¦ç¬¦åˆDDDè§„èŒƒ
- [ ] APIè·¯å¾„æ˜¯å¦éµå¾ªRESTfulè§„èŒƒ
- [ ] äº‹åŠ¡è¾¹ç•Œæ˜¯å¦æ¸…æ™°
- [ ] å¼‚å¸¸å¤„ç†æ˜¯å¦å®Œå–„
- [ ] æ—¥å¿—è®°å½•æ˜¯å¦å……åˆ†

### âœ… æµ‹è¯•é˜¶æ®µæ£€æŸ¥
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] é›†æˆæµ‹è¯•æ˜¯å¦è¦†ç›–ä¸»è¦åœºæ™¯
- [ ] APIæµ‹è¯•æ˜¯å¦é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•æ˜¯å¦è¾¾æ ‡
- [ ] å®‰å…¨æµ‹è¯•æ˜¯å¦é€šè¿‡

### âœ… éƒ¨ç½²é˜¶æ®µæ£€æŸ¥
- [ ] å®¹å™¨é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥æ˜¯å¦æ­£å¸¸
- [ ] ç›‘æ§æŒ‡æ ‡æ˜¯å¦æ­£å¸¸
- [ ] æ—¥å¿—æ”¶é›†æ˜¯å¦æ­£å¸¸
- [ ] é“¾è·¯è¿½è¸ªæ˜¯å¦æ­£å¸¸

---

*æœ¬è§„èŒƒæ–‡æ¡£æ˜¯IOE-DREAMå¹³å°å¾®æœåŠ¡æ¶æ„è®¾è®¡çš„æƒå¨æŒ‡å—ï¼Œæ‰€æœ‰å¼€å‘å›¢é˜Ÿå¿…é¡»ä¸¥æ ¼éµå¾ªã€‚*