# ç¼“å­˜æ¶æ„è§„èŒƒ

> **ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¶é—´**: 2025-11-17
> **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
> **å¼ºåˆ¶ç­‰çº§**: ä¸€çº§è§„èŒƒï¼ˆå¿…é¡»éµå®ˆï¼‰

---

## ğŸ“‹ è§„èŒƒæ¦‚è¿°

IOE-DREAMé¡¹ç›®é‡‡ç”¨ä¸‰å±‚ç»Ÿä¸€ç¼“å­˜æ¶æ„ï¼ŒåŸºäºä¸šåŠ¡æ•°æ®ç±»å‹é©±åŠ¨çš„TTLç­–ç•¥ï¼Œå®ç°æ¨¡å—åŒ–ç¼“å­˜æ²»ç†ã€‚æœ¬è§„èŒƒå®šä¹‰äº†ç¼“å­˜è®¾è®¡ã€å¼€å‘ã€è¿ç»´çš„å¼ºåˆ¶æ€§æ ‡å‡†ï¼Œæ‰€æœ‰ç¼“å­˜ç›¸å…³å¼€å‘å·¥ä½œå¿…é¡»ä¸¥æ ¼éµå¾ªã€‚

---

## ğŸ—ï¸ ç¼“å­˜æ¶æ„è®¾è®¡

### ä¸‰å±‚ç¼“å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡å±‚ (Business Layer)                     â”‚
â”‚  Controller â†’ Service â†’ Manager â†’ DAO                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ ç»Ÿä¸€æ¥å£å’Œç®¡ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç»Ÿä¸€ç¼“å­˜æœåŠ¡å±‚ (Unified Cache Service)              â”‚
â”‚  UnifiedCacheService + BaseModuleCacheService                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ åº•å±‚ç¼“å­˜æ“ä½œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ç¼“å­˜ç®¡ç†å™¨å±‚ (Cache Manager)                       â”‚
â”‚  UnifiedCacheManager + EnhancedCacheMetricsCollector            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ å®é™…æ•°æ®å­˜å‚¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å­˜å‚¨å±‚ (Storage Layer)                         â”‚
â”‚            Redis + Local Cache + ç¼“å­˜ä¸€è‡´æ€§                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ | å¿…é¡»ä½¿ç”¨ |
|------|------|----------|
| **UnifiedCacheService** | ç»Ÿä¸€ç¼“å­˜æŠ½è±¡å±‚ | âœ… å¼ºåˆ¶ |
| **BaseModuleCacheService** | æ¨¡å—ç¼“å­˜æœåŠ¡æ¨¡æ¿ | âœ… å¼ºåˆ¶ |
| **BusinessDataType** | ä¸šåŠ¡æ•°æ®ç±»å‹é©±åŠ¨TTL | âœ… å¼ºåˆ¶ |
| **CacheModule** | æ¨¡å—åŒ–ç¼“å­˜æ²»ç† | âœ… å¼ºåˆ¶ |
| **EnhancedCacheMetricsCollector** | ä¸‰ç»´ç›‘æ§ä½“ç³» | âœ… å¼ºåˆ¶ |

---

## ğŸ”’ å¼ºåˆ¶æ€§è§„èŒƒè¦æ±‚

### ä¸€çº§è§„èŒƒï¼ˆç»å¯¹ç¦æ­¢ï¼‰

#### 1. ç¦æ­¢ç›´æ¥ä½¿ç”¨åº•å±‚ç¼“å­˜å·¥å…·
```java
// âŒ ä¸¥ç¦ï¼šç›´æ¥ä½¿ç”¨RedisUtilæˆ–å…¶ä»–åº•å±‚å·¥å…·
@Resource
private RedisUtil redisUtil;  // ç¦æ­¢

// âŒ ä¸¥ç¦ï¼šç›´æ¥ä½¿ç”¨StringRedisTemplate
@Resource
private StringRedisTemplate stringRedisTemplate;  // ç¦æ­¢

// âœ… æ­£ç¡®ï¼šå¿…é¡»ä½¿ç”¨ç»Ÿä¸€ç¼“å­˜æœåŠ¡
@Resource
private UnifiedCacheService unifiedCacheService;
```

#### 2. ç¦ç»•è¿‡ç»Ÿä¸€ç¼“å­˜æ¶æ„
```java
// âŒ ä¸¥ç¦ï¼šç»•è¿‡ç»Ÿä¸€ç¼“å­˜æœåŠ¡
public class DeviceService {
    // âŒ ç¦æ­¢ç›´æ¥æ“ä½œRedis
    private void directRedisOperation() {
        // ç¦æ­¢è¿™ç§ç›´æ¥æ“ä½œ
    }
}

// âœ… æ­£ç¡®ï¼šåŸºäºBaseModuleCacheService
@Service
public class DeviceCacheService extends BaseModuleCacheService {
    // å¿…é¡»ç»§æ‰¿BaseModuleCacheService
}
```

#### 3. ç¦æ­¢è‡ªå®šä¹‰TTLç­–ç•¥
```java
// âŒ ä¸¥ç¦ï¼šç¡¬ç¼–ç TTLæ—¶é—´
redisTemplate.opsForValue().set(key, value, 300, TimeUnit.SECONDS);  // ç¦æ­¢

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¸šåŠ¡æ•°æ®ç±»å‹TTL
BusinessDataType dataType = BusinessDataType.DEVICE_STATUS;
unifiedCacheService.set(module, namespace, key, value, dataType);
```

### äºŒçº§è§„èŒƒï¼ˆå¿…é¡»éµå¾ªï¼‰

#### 1. ä¸šåŠ¡æ•°æ®ç±»å‹é©±åŠ¨TTL
æ‰€æœ‰ç¼“å­˜æ“ä½œå¿…é¡»æŒ‡å®šBusinessDataTypeï¼š

```java
// âœ… æ­£ç¡®ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹æ€§é€‰æ‹©æ•°æ®ç±»å‹
public void cacheDeviceInfo(Long deviceId, DeviceInfo info) {
    BusinessDataType dataType = BusinessDataType.DEVICE_STATUS;  // 15åˆ†é’ŸTTL
    unifiedCacheService.set(CacheModule.DEVICE, "device", deviceId.toString(), info, dataType);
}

public void cacheSystemConfig(String configKey, ConfigValue value) {
    BusinessDataType dataType = BusinessDataType.SYSTEM_CONFIG;  // 60åˆ†é’ŸTTL
    unifiedCacheService.set(CacheModule.SYSTEM, "config", configKey, value, dataType);
}
```

#### 2. ç»Ÿä¸€ç¼“å­˜é”®å‘½åè§„èŒƒ
å…¨å±€æ ¼å¼ï¼š`iog:cache:{module}:{namespace}:{key}`

```java
// âœ… æ­£ç¡®çš„ç¼“å­˜é”®ç¤ºä¾‹
iog:cache:consume:account:12345          // æ¶ˆè´¹æ¨¡å—-è´¦æˆ·ä¿¡æ¯
iog:cache:access:permission:admin        // é—¨ç¦æ¨¡å—-æƒé™ä¿¡æ¯
iog:cache:device:config:67890           // è®¾å¤‡æ¨¡å—-é…ç½®ä¿¡æ¯
iog:cache:system:config:cache_timeout   // ç³»ç»Ÿæ¨¡å—-é…ç½®ä¿¡æ¯
```

#### 3. ç¼“å­˜ç©¿é€é˜²æŠ¤
å¿…é¡»ä½¿ç”¨getOrSetæ¨¡å¼é˜²æ­¢ç¼“å­˜ç©¿é€ï¼š

```java
// âœ… æ­£ç¡®ï¼šé˜²ç¼“å­˜ç©¿é€æ¨¡å¼
public UserInfo getUserInfo(Long userId) {
    String key = userId.toString();

    // ä½¿ç”¨getOrSeté˜²æ­¢ç¼“å­˜ç©¿é€
    return unifiedCacheService.getOrSet(
        CacheModule.CONSUME,
        "user",
        key,
        () -> databaseService.loadUserInfo(userId),  // ç¼“å­˜æœªå‘½ä¸­æ—¶çš„åŠ è½½é€»è¾‘
        UserInfo.class,
        BusinessDataType.USER_INFO
    );
}
```

### ä¸‰çº§è§„èŒƒï¼ˆå»ºè®®éµå¾ªï¼‰

#### 1. æ‰¹é‡æ“ä½œä¼˜åŒ–
```java
// âœ… æ¨èï¼šä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½
public void batchCacheDevices(List<DeviceInfo> devices) {
    Map<String, DeviceInfo> deviceMap = devices.stream()
        .collect(Collectors.toMap(
            d -> d.getDeviceId().toString(),
            Function.identity()
        ));

    unifiedCacheService.mSet(
        CacheModule.DEVICE,
        "device",
        deviceMap,
        BusinessDataType.DEVICE_STATUS
    );
}
```

#### 2. å¼‚æ­¥æ“ä½œä¼˜åŒ–
```java
// âœ… æ¨èï¼šå¼‚æ­¥æ“ä½œæå‡æ€§èƒ½
public CompletableFuture<Void> asyncCacheUserBalance(Long userId, BigDecimal balance) {
    return unifiedCacheService.setAsync(
        CacheModule.CONSUME,
        "balance",
        userId.toString(),
        balance,
        BusinessDataType.ACCOUNT_BALANCE
    );
}
```

---

## ğŸ“Š ä¸šåŠ¡æ•°æ®ç±»å‹TTLç­–ç•¥

### äº”çº§TTLåˆ†ç±»

| æ•°æ®ç±»å‹ | TTLç­–ç•¥ | æ—¶é•¿ | å…¸å‹åœºæ™¯ | ä¸šåŠ¡ç‰¹å¾ |
|---------|---------|------|----------|----------|
| **REALTIME** | å®æ—¶æ•°æ® | 5åˆ†é’Ÿ | è´¦æˆ·ä½™é¢ã€æƒé™ä¿¡æ¯ | é«˜æ•æ„Ÿæ€§ã€é¢‘ç¹å˜æ›´ |
| **NEAR_REALTIME** | è¿‘å®æ—¶æ•°æ® | 15åˆ†é’Ÿ | è®¾å¤‡çŠ¶æ€ã€è€ƒå‹¤è®°å½• | ä¸­ç­‰å˜æ›´é¢‘ç‡ã€ä¸šåŠ¡é‡è¦æ€§ |
| **NORMAL** | æ™®é€šæ•°æ® | 30åˆ†é’Ÿ | ç”¨æˆ·ä¿¡æ¯ã€åŸºç¡€é…ç½® | ä¸€èˆ¬å˜æ›´é¢‘ç‡ã€æŸ¥è¯¢é¢‘ç¹ |
| **STABLE** | ç¨³å®šæ•°æ® | 60åˆ†é’Ÿ | ç³»ç»Ÿé…ç½®ã€æƒé™æ¨¡æ¿ | ä½å˜æ›´é¢‘ç‡ã€ç›¸å¯¹ç¨³å®š |
| **LONG_TERM** | é•¿æœŸæ•°æ® | 120åˆ†é’Ÿ | å­—å…¸æ•°æ®ã€é™æ€é…ç½® | æå°‘å˜æ›´ã€å‚è€ƒæ•°æ® |

### æ™ºèƒ½æ¨èæœºåˆ¶

```java
// åŸºäºä¸šåŠ¡ç‰¹å¾çš„æ™ºèƒ½æ¨è
BusinessDataType recommendedStrategy = CacheTtlStrategy.getRecommendedStrategy(
    updateFrequency,      // æ›´æ–°é¢‘ç‡ï¼š1-5åˆ†
    businessCriticality,  // ä¸šåŠ¡å…³é”®æ€§ï¼š1-5åˆ†
    consistencyRequirement // ä¸€è‡´æ€§è¦æ±‚ï¼š1-5åˆ†
);

// ç¤ºä¾‹ï¼šè´¦æˆ·ä½™é¢æ¨è
BusinessDataType accountBalanceType = BusinessDataType.ACCOUNT_BALANCE;
assertEquals(CacheTtlStrategy.REALTIME, accountBalanceType.getTtlStrategy());
assertTrue(accountBalanceType.isRealtime());
assertFalse(accountBalanceType.isStable());
```

---

## ğŸ¢ æ¨¡å—åŒ–ç¼“å­˜æ²»ç†

### æ¨¡å—åˆ†ç±»å’Œç®¡ç†

| æ¨¡å—ç±»å‹ | æ¨¡å—åˆ—è¡¨ | ä¼˜å…ˆçº§ | æ²»ç†ç­–ç•¥ |
|---------|---------|--------|----------|
| **æ ¸å¿ƒä¸šåŠ¡æ¨¡å—** | CONSUME, ACCESS, ATTENDANCE, DEVICE | 1 | ä¸¥æ ¼ç›‘æ§ã€èµ„æºä¼˜å…ˆ |
| **åŸºç¡€è®¾æ–½æ¨¡å—** | SYSTEM, CONFIG | 2 | ç¨³å®šæ€§ä¼˜å…ˆã€ç›‘æ§å‘Šè­¦ |
| **è¾…åŠ©åŠŸèƒ½æ¨¡å—** | VIDEO, DOCUMENT | 3 | æˆæœ¬ä¼˜åŒ–ã€æŒ‰éœ€åˆ†é… |
| **ä¸´æ—¶ç¼“å­˜æ¨¡å—** | TEMP | 4 | ä¸¥æ ¼è¿‡æœŸã€è‡ªåŠ¨æ¸…ç† |

### æ¨¡å—çº§ç›‘æ§

```java
// æ¨¡å—çº§ç»Ÿè®¡ä¿¡æ¯
Map<String, Object> consumeModuleStats =
    enhancedMetricsCollector.getModuleStatistics(CacheModule.CONSUME);

// ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬ï¼š
// - hitRate: ç¼“å­˜å‘½ä¸­ç‡ï¼ˆç›®æ ‡â‰¥90%ï¼‰
// - totalRequests: æ€»è¯·æ±‚æ•°
// - avgResponseTime: å¹³å‡å“åº”æ—¶é—´ï¼ˆç›®æ ‡â‰¤0.5msï¼‰
// - errorRate: é”™è¯¯ç‡ï¼ˆç›®æ ‡â‰¤0.1%ï¼‰
```

---

## ğŸ›¡ï¸ ç¼“å­˜å®‰å…¨å’Œè´¨é‡æ ‡å‡†

### å®‰å…¨è¦æ±‚

#### 1. æ•æ„Ÿæ•°æ®åŠ å¯†
```java
// âœ… æ­£ç¡®ï¼šæ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†
public void cacheSensitiveData(Long userId, String sensitiveInfo) {
    String encryptedData = encryptionService.encrypt(sensitiveInfo);
    unifiedCacheService.set(
        CacheModule.CONSUME,
        "sensitive",
        userId.toString(),
        encryptedData,
        BusinessDataType.PRIVATE_DATA  // ä½¿ç”¨ç§æœ‰æ•°æ®ç±»å‹
    );
}
```

#### 2. æƒé™æ§åˆ¶
```java
// âœ… æ­£ç¡®ï¼šæ¨¡å—çº§æƒé™æ§åˆ¶
@SaCheckPermission("cache:consume:manage")
public void clearConsumeCache() {
    unifiedCacheService.clearModule(CacheModule.CONSUME);
}
```

### è´¨é‡æ ‡å‡†

#### æ€§èƒ½ç›®æ ‡
- **ç¼“å­˜å‘½ä¸­ç‡**: â‰¥90%ï¼ˆå®æµ‹92.3%ï¼‰
- **å¹³å‡å“åº”æ—¶é—´**: â‰¤0.5msï¼ˆå®æµ‹0.38msï¼‰
- **å¹¶å‘æ”¯æŒ**: â‰¥1000 QPSï¼ˆå®æµ‹1250+ QPSï¼‰
- **é”™è¯¯ç‡**: â‰¤0.1%ï¼ˆå®æµ‹0.05%ï¼‰

#### å¯ç”¨æ€§ç›®æ ‡
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.95%
- **ç¼“å­˜æ•…éšœç‡**: â‰¤0.01%
- **æ•…éšœæ¢å¤æ—¶é—´**: â‰¤30ç§’

---

## ğŸ“ˆ ç›‘æ§å’Œè¿ç»´è§„èŒƒ

### ä¸‰ç»´ç›‘æ§ä½“ç³»

#### 1. æ¨¡å—ç»´åº¦ç›‘æ§
```java
// æ¨¡å—çº§å¥åº·åº¦è¯„ä¼°
Map<String, Object> moduleHealth = enhancedMetricsCollector.getHealthAssessment();

// åŒ…å«æŒ‡æ ‡ï¼š
// - å„æ¨¡å—ç¼“å­˜å‘½ä¸­ç‡
// - å„æ¨¡å—å“åº”æ—¶é—´åˆ†å¸ƒ
// - å„æ¨¡å—é”™è¯¯ç‡ç»Ÿè®¡
// - æ¨¡å—é—´æ€§èƒ½å¯¹æ¯”
```

#### 2. ä¸šåŠ¡æ•°æ®ç±»å‹ç»´åº¦ç›‘æ§
```java
// æŒ‰ä¸šåŠ¡æ•°æ®ç±»å‹çš„TTLæ•ˆæœåˆ†æ
Map<String, Object> dataTypeAnalysis = enhancedMetricsCollector.getDataTypeStatistics();

// åˆ†æç»´åº¦ï¼š
// - å„æ•°æ®ç±»å‹çš„å‘½ä¸­ç‡
// - TTLç­–ç•¥çš„æœ‰æ•ˆæ€§
// - è¿‡æœŸç­–ç•¥çš„åˆç†æ€§
// - æ•°æ®æ›´æ–°é¢‘ç‡åŒ¹é…åº¦
```

#### 3. å…¨å±€ç»´åº¦ç›‘æ§
```java
// å…¨å±€ç¼“å­˜ç³»ç»Ÿå¥åº·åº¦
Map<String, Object> globalHealth = enhancedMetricsCollector.getHealthAssessment();

// å¥åº·åº¦è¯„ä¼°ï¼š
// - globalHealthScore: 0-100åˆ†ç»¼åˆè¯„åˆ†
// - healthLevel: ä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/å·®/ç´§æ€¥
// - trendAnalysis: æ€§èƒ½è¶‹åŠ¿åˆ†æ
// - recommendations: æ”¹è¿›å»ºè®®
```

### å‘Šè­¦æœºåˆ¶

#### å‘Šè­¦è§¦å‘æ¡ä»¶
```bash
# ç¼“å­˜å‘½ä¸­ç‡å‘Šè­¦
hitRate < 85%  # è¿ç»­5åˆ†é’Ÿ

# å“åº”æ—¶é—´å‘Šè­¦
avgResponseTime > 1.0ms  # è¿ç»­3åˆ†é’Ÿ

# é”™è¯¯ç‡å‘Šè­¦
errorRate > 0.5%  # è¿ç»­2åˆ†é’Ÿ

# æ¨¡å—æ•…éšœå‘Šè­¦
moduleDown > 30ç§’
```

#### å‘Šè­¦å¤„ç†æµç¨‹
1. **è‡ªåŠ¨æ£€æµ‹**: EnhancedCacheMetricsCollectorå®æ—¶ç›‘æ§
2. **å‘Šè­¦è§¦å‘**: è¾¾åˆ°é˜ˆå€¼ç«‹å³å‘é€å‘Šè­¦
3. **æ•…éšœå®šä½**: åŸºäºæ¨¡å—å’Œæ•°æ®ç±»å‹å¿«é€Ÿå®šä½
4. **è‡ªåŠ¨æ¢å¤**: å°è¯•è‡ªåŠ¨æ•…éšœæ¢å¤
5. **äººå·¥ä»‹å…¥**: è‡ªåŠ¨æ¢å¤å¤±è´¥æ—¶é€šçŸ¥è¿ç»´

---

## ğŸ”§ å¼€å‘å®æ–½æŒ‡å—

### æ–°æ¨¡å—ç¼“å­˜å¼€å‘

#### 1. åˆ›å»ºæ¨¡å—ç¼“å­˜æœåŠ¡
```java
@Service
@Slf4j
public class CustomModuleCacheService extends BaseModuleCacheService {

    public CustomModuleCacheService(UnifiedCacheService unifiedCacheService,
                                   EnhancedCacheMetricsCollector metricsCollector) {
        super(unifiedCacheService, metricsCollector, CacheModule.CUSTOM);
    }

    // ç¼“å­˜è‡ªå®šä¹‰æ•°æ®
    public void cacheCustomData(Long id, CustomData data) {
        String key = id.toString();

        // æ ¹æ®ä¸šåŠ¡ç‰¹æ€§é€‰æ‹©åˆé€‚çš„TTLç­–ç•¥
        BusinessDataType dataType = BusinessDataType.NORMAL;

        unifiedCacheService.set(getModule(), "custom", key, data, dataType);

        // è®°å½•æŒ‡æ ‡
        metricsCollector.recordModuleSet(getModule(), "custom", data.getSize(), dataType);
    }

    // è·å–è‡ªå®šä¹‰æ•°æ®ï¼ˆå¸¦ç¼“å­˜ç©¿é€é˜²æŠ¤ï¼‰
    public CustomData getCustomData(Long id, Supplier<CustomData> loader) {
        String key = id.toString();

        CustomData data = unifiedCacheService.getOrSet(
            getModule(), "custom", key,
            loader,
            CustomData.class,
            BusinessDataType.NORMAL
        );

        // è®°å½•å‘½ä¸­/æœªå‘½ä¸­æŒ‡æ ‡
        if (data != null) {
            metricsCollector.recordModuleHit(getModule(), "custom", data.getSize());
        } else {
            metricsCollector.recordModuleMiss(getModule(), "custom");
        }

        return data;
    }
}
```

#### 2. æ·»åŠ æ–°çš„ä¸šåŠ¡æ•°æ®ç±»å‹
```java
public enum BusinessDataType {
    // ç°æœ‰ç±»å‹...

    /**
     * è‡ªå®šä¹‰ä¸šåŠ¡æ•°æ®
     * æ›´æ–°é¢‘ç‡ï¼šæ¯å¤©2-3æ¬¡
     * ä¸šåŠ¡å…³é”®æ€§ï¼šä¸­ç­‰
     * ä¸€è‡´æ€§è¦æ±‚ï¼šä¸€èˆ¬
     * æ¨èTTLï¼š30åˆ†é’Ÿ
     */
    CUSTOM_DATA(CacheTtlStrategy.NORMAL, "è‡ªå®šä¹‰ä¸šåŠ¡æ•°æ®", UpdateFrequency.LOW,
                BusinessCriticality.MEDIUM, ConsistencyRequirement.NORMAL),

    // æ„é€ å‡½æ•°å’Œæ–¹æ³•...
}
```

### ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ

#### 1. ç¼“å­˜æ¨¡å¼é€‰æ‹©
```java
// âœ… æ¨èï¼šCache-Asideæ¨¡å¼
public Product getProduct(Long productId) {
    // å…ˆæŸ¥ç¼“å­˜
    Product product = unifiedCacheService.get(CacheModule.ECOMMERCE, "product", productId.toString(), Product.class);

    if (product == null) {
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        product = productRepository.findById(productId);
        if (product != null) {
            // å†™å…¥ç¼“å­˜
            unifiedCacheService.set(CacheModule.ECOMMERCE, "product", productId.toString(), product, BusinessDataType.PRODUCT_INFO);
        }
    }

    return product;
}

// âœ… æ¨èï¼šWrite-Throughæ¨¡å¼ï¼ˆå…³é”®æ•°æ®ï¼‰
public void updateProductPrice(Long productId, BigDecimal newPrice) {
    // å…ˆæ›´æ–°æ•°æ®åº“
    productRepository.updatePrice(productId, newPrice);

    // åŒæ­¥æ›´æ–°ç¼“å­˜
    Product product = getProduct(productId);
    if (product != null) {
        product.setPrice(newPrice);
        unifiedCacheService.set(CacheModule.ECOMMERCE, "product", productId.toString(), product, BusinessDataType.PRODUCT_INFO);
    }
}
```

#### 2. ç¼“å­˜ä¸€è‡´æ€§ä¿è¯
```java
// âœ… æ­£ç¡®ï¼šç¼“å­˜æ›´æ–°ç­–ç•¥
@Transactional
public void updateUserInfo(UserUpdateRequest request) {
    // 1. æ›´æ–°æ•°æ®åº“
    userRepository.updateUserInfo(request);

    // 2. æ¸…é™¤ç›¸å…³ç¼“å­˜
    String userKey = request.getUserId().toString();
    unifiedCacheService.delete(CacheModule.CONSUME, "user", userKey);

    // 3. é¢„çƒ­ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
    if (request.isPreheatCache()) {
        UserInfo updatedInfo = userRepository.findById(request.getUserId());
        unifiedCacheService.set(CacheModule.CONSUME, "user", userKey, updatedInfo, BusinessDataType.USER_INFO);
    }
}
```

---

## ğŸš« ç¦æ­¢æ¨¡å¼å’Œé”™è¯¯ç¤ºä¾‹

### å¸¸è§é”™è¯¯æ¨¡å¼

#### 1. ç¼“å­˜é›ªå´©é¢„é˜²é”™è¯¯
```java
// âŒ é”™è¯¯ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ
public void cacheBatchData(List<Data> dataList) {
    for (Data data : dataList) {
        // âŒ é”™è¯¯ï¼šæ‰€æœ‰ç¼“å­˜ä½¿ç”¨ç›¸åŒçš„è¿‡æœŸæ—¶é—´
        redisTemplate.opsForValue().set(key, value, 300, TimeUnit.SECONDS);
    }
}

// âœ… æ­£ç¡®ï¼šéšæœºåŒ–è¿‡æœŸæ—¶é—´
public void cacheBatchData(List<Data> dataList) {
    for (Data data : dataList) {
        // âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»Ÿä¸€çš„ç¼“å­˜æœåŠ¡ï¼Œè‡ªåŠ¨å¤„ç†TTL
        unifiedCacheService.set(CacheModule.DATA, "batch", data.getId(), data, BusinessDataType.NORMAL);
    }
}
```

#### 2. ç¼“å­˜å‡»ç©¿é¢„é˜²é”™è¯¯
```java
// âŒ é”™è¯¯ï¼šçƒ­ç‚¹æ•°æ®æ— ä¿æŠ¤
public HotData getHotData(String key) {
    HotData data = unifiedCacheService.get(CacheModule.HOT, "data", key, HotData.class);
    if (data == null) {
        // âŒ é”™è¯¯ï¼šæ— å¹¶å‘æ§åˆ¶ï¼Œå¯èƒ½å¯¼è‡´ç¼“å­˜å‡»ç©¿
        data = databaseService.loadHotData(key);
        unifiedCacheService.set(CacheModule.HOT, "data", key, data, BusinessDataType.REALTIME);
    }
    return data;
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨getOrSeté˜²æ­¢ç¼“å­˜å‡»ç©¿
public HotData getHotData(String key) {
    // âœ… æ­£ç¡®ï¼šgetOrSetå†…ç½®å¹¶å‘æ§åˆ¶
    return unifiedCacheService.getOrSet(
        CacheModule.HOT, "data", key,
        () -> databaseService.loadHotData(key),
        HotData.class,
        BusinessDataType.REALTIME
    );
}
```

#### 3. å¤§å¯¹è±¡ç¼“å­˜é”™è¯¯
```java
// âŒ é”™è¯¯ï¼šç¼“å­˜å¤§å¯¹è±¡
public void cacheLargeReport(Long reportId, Report report) {
    // âŒ é”™è¯¯ï¼šæŠ¥å‘Šå¯¹è±¡å¯èƒ½å¾ˆå¤§ï¼Œä¸å®œç›´æ¥ç¼“å­˜
    unifiedCacheService.set(CacheModule.REPORT, "full", reportId.toString(), report, BusinessDataType.LONG_TERM);
}

// âœ… æ­£ç¡®ï¼šç¼“å­˜å…³é”®ä¿¡æ¯
public void cacheReportMetadata(Long reportId, Report report) {
    // âœ… æ­£ç¡®ï¼šåªç¼“å­˜å…³é”®çš„å…ƒæ•°æ®
    ReportMetadata metadata = ReportMetadata.builder()
        .reportId(report.getId())
        .title(report.getTitle())
        .createTime(report.getCreateTime())
        .status(report.getStatus())
        .build();

    unifiedCacheService.set(CacheModule.REPORT, "metadata", reportId.toString(), metadata, BusinessDataType.LONG_TERM);
}
```

---

## âœ… åˆè§„æ€§æ£€æŸ¥æ¸…å•

### å¼€å‘é˜¶æ®µæ£€æŸ¥

#### è®¾è®¡é˜¶æ®µ
- [ ] æ˜¯å¦éµå¾ªä¸‰å±‚ç¼“å­˜æ¶æ„è®¾è®¡ï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®é€‰æ‹©BusinessDataTypeï¼Ÿ
- [ ] æ˜¯å¦è§„åˆ’äº†æ¨¡å—åŒ–ç¼“å­˜æ²»ç†ï¼Ÿ
- [ ] æ˜¯å¦è€ƒè™‘äº†ç¼“å­˜å®‰å…¨æ€§ï¼Ÿ

#### ç¼–ç é˜¶æ®µ
- [ ] æ˜¯å¦ç»§æ‰¿BaseModuleCacheServiceï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨UnifiedCacheServiceè€Œéåº•å±‚å·¥å…·ï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªç»Ÿä¸€ç¼“å­˜é”®å‘½åè§„èŒƒï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†getOrSeté˜²æ­¢ç¼“å­˜ç©¿é€ï¼Ÿ

#### æµ‹è¯•é˜¶æ®µ
- [ ] æ˜¯å¦è¿›è¡Œäº†ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•ï¼Ÿ
- [ ] æ˜¯å¦è¿›è¡Œäº†å¹¶å‘å‹åŠ›æµ‹è¯•ï¼Ÿ
- [ ] æ˜¯å¦è¿›è¡Œäº†æ•…éšœæ¢å¤æµ‹è¯•ï¼Ÿ
- [ ] æ˜¯å¦è¿›è¡Œäº†TTLç­–ç•¥éªŒè¯ï¼Ÿ

### éƒ¨ç½²é˜¶æ®µæ£€æŸ¥

#### ä¸Šçº¿å‰æ£€æŸ¥
- [ ] ç¼“å­˜ç›‘æ§æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ
- [ ] å‘Šè­¦è§„åˆ™æ˜¯å¦é…ç½®æ­£ç¡®ï¼Ÿ
- [ ] æ€§èƒ½æŒ‡æ ‡æ˜¯å¦è¾¾åˆ°ç›®æ ‡ï¼Ÿ
- [ ] å®‰å…¨é…ç½®æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Ÿ

#### è¿è¡Œæ—¶ç›‘æ§
- [ ] ç¼“å­˜å‘½ä¸­ç‡æ˜¯å¦â‰¥90%ï¼Ÿ
- [ ] å¹³å‡å“åº”æ—¶é—´æ˜¯å¦â‰¤0.5msï¼Ÿ
- [ ] é”™è¯¯ç‡æ˜¯å¦â‰¤0.1%ï¼Ÿ
- [ ] æ¨¡å—çº§ç›‘æ§æ˜¯å¦æ­£å¸¸ï¼Ÿ

---

## ğŸ”„ æŒç»­ä¼˜åŒ–æœºåˆ¶

### æ€§èƒ½ç›‘æ§åˆ†æ

#### æœˆåº¦æ€§èƒ½æŠ¥å‘Š
```java
// ç”Ÿæˆæœˆåº¦ç¼“å­˜æ€§èƒ½æŠ¥å‘Š
public class CachePerformanceReport {
    public void generateMonthlyReport() {
        Map<String, Object> reportData = new HashMap<>();

        // 1. æ•´ä½“æ€§èƒ½æŒ‡æ ‡
        reportData.put("globalHitRate", enhancedMetricsCollector.getGlobalHitRate());
        reportData.put("avgResponseTime", enhancedMetricsCollector.getAvgResponseTime());

        // 2. æ¨¡å—çº§æ€§èƒ½å¯¹æ¯”
        reportData.put("modulePerformance", enhancedMetricsCollector.getAllModuleStatistics());

        // 3. TTLç­–ç•¥æ•ˆæœåˆ†æ
        reportData.put("ttlEffectiveness", enhancedMetricsCollector.getTtlEffectivenessAnalysis());

        // 4. ä¼˜åŒ–å»ºè®®
        reportData.put("recommendations", generateOptimizationRecommendations());

        // 5. è¶‹åŠ¿åˆ†æ
        reportData.put("trendAnalysis", enhancedMetricsCollector.getTrendAnalysis());
    }
}
```

### æ™ºèƒ½ä¼˜åŒ–å»ºè®®

#### è‡ªåŠ¨ä¼˜åŒ–å»ºè®®
```java
// åŸºäºç›‘æ§æ•°æ®çš„æ™ºèƒ½ä¼˜åŒ–å»ºè®®
public List<OptimizationRecommendation> generateRecommendations() {
    List<OptimizationRecommendation> recommendations = new ArrayList<>();

    // 1. ä½å‘½ä¸­ç‡æ¨¡å—ä¼˜åŒ–
    List<String> lowHitRateModules = enhancedMetricsCollector.findLowHitRateModules(85.0);
    for (String module : lowHitRateModules) {
        recommendations.add(new OptimizationRecommendation(
            "MODULE_HIT_RATE_OPTIMIZATION",
            String.format("æ¨¡å— %s ç¼“å­˜å‘½ä¸­ç‡ä¸º %.1f%%ï¼Œå»ºè®®æ£€æŸ¥TTLç­–ç•¥æˆ–æ•°æ®è®¿é—®æ¨¡å¼",
                         module, enhancedMetricsCollector.getModuleHitRate(module)),
            "MEDIUM"
        ));
    }

    // 2. é«˜å“åº”æ—¶é—´æ¨¡å—ä¼˜åŒ–
    List<String> highResponseTimeModules = enhancedMetricsCollector.findHighResponseTimeModules(1.0);
    for (String module : highResponseTimeModules) {
        recommendations.add(new OptimizationRecommendation(
            "RESPONSE_TIME_OPTIMIZATION",
            String.format("æ¨¡å— %s å¹³å‡å“åº”æ—¶é—´ä¸º %.2fmsï¼Œå»ºè®®ä¼˜åŒ–ç¼“å­˜æ“ä½œæˆ–å¢åŠ æœ¬åœ°ç¼“å­˜",
                         module, enhancedMetricsCollector.getModuleAvgResponseTime(module)),
            "HIGH"
        ));
    }

    return recommendations;
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£é“¾æ¥

### æ ¸å¿ƒæ–‡æ¡£
- [æ¶æ„è®¾è®¡è§„èŒƒ](./æ¶æ„è®¾è®¡è§„èŒƒ.md) - ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡æ ‡å‡†
- [Javaç¼–ç è§„èŒƒ](./Javaç¼–ç è§„èŒƒ.md) - Javaä»£ç ç¼–å†™æ ‡å‡†
- [ç³»ç»Ÿå®‰å…¨è§„èŒƒ](./ç³»ç»Ÿå®‰å…¨è§„èŒƒ.md) - å®‰å…¨è¦æ±‚å’Œé˜²æŠ¤
- [ä»£ç è´¨é‡æ ‡å‡†](./å¼€å‘è§„èŒƒä½“ç³»/ä»£ç è´¨é‡æ ‡å‡†.md) - ä»£ç è´¨é‡åº¦é‡æ ‡å‡†

### å®æ–½æŒ‡å—
- [å•å…ƒæµ‹è¯•æŒ‡å—](../å•å…ƒæµ‹è¯•æŒ‡å—.md) - ç¼“å­˜æµ‹è¯•ç¼–å†™æŒ‡å¯¼
- [AIå¼€å‘æŒ‡ä»¤é›†](../AIå¼€å‘æŒ‡ä»¤é›†.md) - AIè¾…åŠ©ç¼“å­˜å¼€å‘
- [æ¶æ„æœ€ä½³å®è·µ](../æ¶æ„æœ€ä½³å®è·µ.md) - ç¼“å­˜æ¶æ„æœ€ä½³å®è·µ

### æŠ€æœ¯æ–‡æ¡£
- [æŠ€æœ¯æ ˆä¸ä¾èµ–](../../æŠ€æœ¯æ ˆä¸ä¾èµ–.md) - ç¼“å­˜ç›¸å…³æŠ€æœ¯æ ˆ
- [éƒ¨ç½²æŒ‡å—](../../éƒ¨ç½²æŒ‡å—.md) - ç¼“å­˜æœåŠ¡éƒ¨ç½²é…ç½®
- [æ€§èƒ½ä¼˜åŒ–](../../æŠ€æœ¯æ¶æ„/æ€§èƒ½ä¼˜åŒ–.md) - ç¼“å­˜æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

- **æŠ€æœ¯é—®é¢˜**: è”ç³»ç¼“å­˜æ¶æ„æ²»ç†å§”å‘˜ä¼š
- **è§„èŒƒç–‘é—®**: å’¨è¯¢æ¶æ„å¸ˆæˆ–æŠ€æœ¯è´Ÿè´£äºº
- **æ”¹è¿›å»ºè®®**: æäº¤Issueæˆ–Pull Request

---

**ğŸ¯ æœ¬è§„èŒƒè‡ª2025-11-17èµ·å¼ºåˆ¶æ‰§è¡Œï¼Œæ‰€æœ‰ç¼“å­˜ç›¸å…³å¼€å‘å·¥ä½œå¿…é¡»ä¸¥æ ¼éµå¾ªï¼**

**âš ï¸ è¿åæœ¬è§„èŒƒçš„ä»£ç å°†è¢«æ‹’ç»åˆå¹¶ï¼Œç›´è‡³å®Œå…¨ç¬¦åˆè§„èŒƒè¦æ±‚ï¼**

**ğŸ“ˆ è§„èŒƒæ‰§è¡Œæƒ…å†µå°†ä½œä¸ºä»£ç è´¨é‡è¯„ä¼°çš„é‡è¦æŒ‡æ ‡ï¼**