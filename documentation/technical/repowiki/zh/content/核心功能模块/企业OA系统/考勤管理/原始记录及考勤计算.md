# åŸå§‹è®°å½•åŠè€ƒå‹¤è®¡ç®—è®¾è®¡

> **ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¶é—´**: 2025-11-13
> **åˆ†ç±»**: æ ¸å¿ƒåŠŸèƒ½æ¨¡å— > ä¼ä¸šOAç³»ç»Ÿ > è€ƒå‹¤ç®¡ç†
> **æ ‡ç­¾**: ["è€ƒå‹¤ç³»ç»Ÿ", "æ‰“å¡è®°å½•", "è€ƒå‹¤è®¡ç®—", "æ•°æ®é‡‡é›†", "ç®—æ³•å®ç°"]
> **ä½œè€…**: SmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
> **æè¿°**: IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°è€ƒå‹¤ç³»ç»Ÿçš„åŸå§‹è®°å½•é‡‡é›†å’Œè€ƒå‹¤è®¡ç®—å®Œæ•´è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½

**è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ**æ˜¯IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°çš„é‡è¦æ¨¡å—ï¼Œè´Ÿè´£å‘˜å·¥çš„æ‰“å¡æ•°æ®é‡‡é›†ã€è€ƒå‹¤è®¡ç®—ã€å¼‚å¸¸æ£€æµ‹å’Œç»Ÿè®¡åˆ†æã€‚ç³»ç»Ÿæ”¯æŒå¤šç§æ‰“å¡æ–¹å¼ï¼Œæä¾›çµæ´»çš„è€ƒå‹¤è§„åˆ™é…ç½®ï¼Œå®ç°è‡ªåŠ¨åŒ–è€ƒå‹¤ç®¡ç†ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **å¤šæ–¹å¼æ‰“å¡**ï¼šæ”¯æŒäººè„¸è¯†åˆ«ã€æŒ‡çº¹ã€åˆ·å¡ã€ç§»åŠ¨ç«¯æ‰“å¡
- âœ… **å®æ—¶è®¡ç®—**ï¼šæ‰“å¡åå®æ—¶è®¡ç®—è€ƒå‹¤ç»“æœ
- âœ… **çµæ´»è§„åˆ™**ï¼šæ”¯æŒè‡ªå®šä¹‰è€ƒå‹¤è§„åˆ™å’Œå¼‚å¸¸åˆ¤å®š
- âœ… **å¼‚å¸¸é¢„è­¦**ï¼šå®æ—¶æ£€æµ‹å¼‚å¸¸æƒ…å†µå¹¶é¢„è­¦
- âœ… **ç»Ÿè®¡åˆ†æ**ï¼šæä¾›å¤šç»´åº¦çš„è€ƒå‹¤ç»Ÿè®¡åˆ†æ

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. æ‰“å¡è®°å½•è¡¨ï¼ˆclock_recordsï¼‰

```sql
CREATE TABLE `clock_records` (
  `record_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'è®°å½•ID',
  `employee_id` bigint(20) NOT NULL COMMENT 'å‘˜å·¥ID',
  `employee_code` varchar(32) NOT NULL COMMENT 'å‘˜å·¥ç¼–å·',
  `employee_name` varchar(100) NOT NULL COMMENT 'å‘˜å·¥å§“å',
  `clock_type` tinyint(4) NOT NULL COMMENT 'æ‰“å¡ç±»å‹ 1-ä¸Šç­ 2-ä¸‹ç­ 3-åŠ ç­å¼€å§‹ 4-åŠ ç­ç»“æŸ',
  `clock_time` datetime NOT NULL COMMENT 'æ‰“å¡æ—¶é—´',
  `clock_location` varchar(100) DEFAULT NULL COMMENT 'æ‰“å¡åœ°ç‚¹',
  `device_id` bigint(20) DEFAULT NULL COMMENT 'è®¾å¤‡ID',
  `device_type` varchar(32) DEFAULT NULL COMMENT 'è®¾å¤‡ç±»å‹',
  `auth_method` varchar(32) DEFAULT NULL COMMENT 'è®¤è¯æ–¹å¼',
  `verify_result` varchar(32) NOT NULL COMMENT 'éªŒè¯ç»“æœ',
  `photo_path` varchar(500) DEFAULT NULL COMMENT 'ç…§ç‰‡è·¯å¾„',
  `ip_address` varchar(50) DEFAULT NULL COMMENT 'IPåœ°å€',
  `gps_location` varchar(100) DEFAULT NULL COMMENT 'GPSå®šä½',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`record_id`),
  KEY `idx_employee_id` (`employee_id`),
  KEY `idx_employee_code` (`employee_code`),
  KEY `idx_clock_time` (`clock_time`),
  KEY `idx_employee_date` (`employee_id`, DATE(clock_time)),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰“å¡è®°å½•è¡¨'
PARTITION BY RANGE (YEAR(clock_time)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 2. è€ƒå‹¤è®¡ç®—ç»“æœè¡¨ï¼ˆattendance_resultsï¼‰

```sql
CREATE TABLE `attendance_results` (
  `result_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ç»“æœID',
  `employee_id` bigint(20) NOT NULL COMMENT 'å‘˜å·¥ID',
  `employee_code` varchar(32) NOT NULL COMMENT 'å‘˜å·¥ç¼–å·',
  `employee_name` varchar(100) NOT NULL COMMENT 'å‘˜å·¥å§“å',
  `attendance_date` date NOT NULL COMMENT 'è€ƒå‹¤æ—¥æœŸ',
  `work_schedule_id` bigint(20) DEFAULT NULL COMMENT 'æ’ç­ID',
  `should_work_minutes` int(11) DEFAULT '0' COMMENT 'åº”å·¥ä½œæ—¶é•¿(åˆ†é’Ÿ)',
  `actual_work_minutes` int(11) DEFAULT '0' COMMENT 'å®é™…å·¥ä½œæ—¶é•¿(åˆ†é’Ÿ)',
  `overtime_minutes` int(11) DEFAULT '0' COMMENT 'åŠ ç­æ—¶é•¿(åˆ†é’Ÿ)',
  `late_minutes` int(11) DEFAULT '0' COMMENT 'è¿Ÿåˆ°æ—¶é•¿(åˆ†é’Ÿ)',
  `early_leave_minutes` int(11) DEFAULT '0' COMMENT 'æ—©é€€æ—¶é•¿(åˆ†é’Ÿ)',
  `leave_days` decimal(3,1) DEFAULT '0.0' COMMENT 'è¯·å‡å¤©æ•°',
  `absence_days` decimal(3,1) DEFAULT '0.0' COMMENT 'ç¼ºå‹¤å¤©æ•°',
  `attendance_status` varchar(32) NOT NULL COMMENT 'è€ƒå‹¤çŠ¶æ€',
  `is_abnormal` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦å¼‚å¸¸ 0-æ­£å¸¸ 1-å¼‚å¸¸',
  `calculate_time` datetime NOT NULL COMMENT 'è®¡ç®—æ—¶é—´',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`result_id`),
  UNIQUE KEY `uk_employee_date` (`employee_id`, `attendance_date`),
  KEY `idx_employee_code` (`employee_code`),
  KEY `idx_attendance_date` (`attendance_date`),
  KEY `idx_is_abnormal` (`is_abnormal`),
  KEY `idx_calculate_time` (`calculate_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤è®¡ç®—ç»“æœè¡¨'
PARTITION BY RANGE (YEAR(attendance_date)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 3. è€ƒå‹¤é¢„è­¦è®°å½•è¡¨ï¼ˆattendance_warning_recordsï¼‰

```sql
CREATE TABLE `attendance_warning_records` (
  `warning_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'é¢„è­¦ID',
  `employee_id` bigint(20) NOT NULL COMMENT 'å‘˜å·¥ID',
  `employee_code` varchar(32) NOT NULL COMMENT 'å‘˜å·¥ç¼–å·',
  `employee_name` varchar(100) NOT NULL COMMENT 'å‘˜å·¥å§“å',
  `warning_type` varchar(32) NOT NULL COMMENT 'é¢„è­¦ç±»å‹',
  `warning_level` varchar(32) NOT NULL COMMENT 'é¢„è­¦çº§åˆ«',
  `warning_content` varchar(500) NOT NULL COMMENT 'é¢„è­¦å†…å®¹',
  `attendance_date` date NOT NULL COMMENT 'è€ƒå‹¤æ—¥æœŸ',
  `related_record_id` bigint(20) DEFAULT NULL COMMENT 'ç›¸å…³è®°å½•ID',
  `warning_status` varchar(32) DEFAULT 'PENDING' COMMENT 'é¢„è­¦çŠ¶æ€',
  `handle_time` datetime DEFAULT NULL COMMENT 'å¤„ç†æ—¶é—´',
  `handle_user_id` bigint(20) DEFAULT NULL COMMENT 'å¤„ç†äººID',
  `handle_remark` varchar(500) DEFAULT NULL COMMENT 'å¤„ç†å¤‡æ³¨',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`warning_id`),
  KEY `idx_employee_id` (`employee_id`),
  KEY `idx_warning_type` (`warning_type`),
  KEY `idx_warning_level` (`warning_level`),
  KEY `idx_attendance_date` (`attendance_date`),
  KEY `idx_warning_status` (`warning_status`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤é¢„è­¦è®°å½•è¡¨'
PARTITION BY RANGE (YEAR(attendance_date)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

## ğŸ”„ ä¸šåŠ¡é€»è¾‘è®¾è®¡

### 1. æ‰“å¡æ•°æ®é‡‡é›†é€»è¾‘

```mermaid
sequenceDiagram
    participant E as å‘˜å·¥
    participant D as è®¾å¤‡ç»ˆç«¯
    participant A as è€ƒå‹¤æœåŠ¡
    participant V as éªŒè¯æœåŠ¡
    participant DB as æ•°æ®åº“

    E->>D: åˆ·å¡/åˆ·è„¸/æŒ‡çº¹
    D->>V: èº«ä»½éªŒè¯è¯·æ±‚
    V-->>D: éªŒè¯ç»“æœ
    D->>A: æ‰“å¡æ•°æ®ä¸ŠæŠ¥
    A->>A: æ•°æ®éªŒè¯å’Œå¤„ç†
    A->>DB: ä¿å­˜æ‰“å¡è®°å½•
    A->>A: å®æ—¶è€ƒå‹¤è®¡ç®—
    A->>DB: ä¿å­˜è®¡ç®—ç»“æœ
    A->>A: å¼‚å¸¸æ£€æµ‹
    alt å‘ç°å¼‚å¸¸
        A->>DB: ä¿å­˜é¢„è­¦è®°å½•
        A->>M: å‘é€é¢„è­¦é€šçŸ¥
    end
    A-->>D: æ‰“å¡æˆåŠŸå“åº”
    D-->>E: æ˜¾ç¤ºæ‰“å¡ç»“æœ
```

### 2. è€ƒå‹¤è®¡ç®—é€»è¾‘

```mermaid
stateDiagram-v2
    [*] --> è·å–å‘˜å·¥å½“æ—¥æ‰“å¡è®°å½•
    è·å–å‘˜å·¥å½“æ—¥æ‰“å¡è®°å½• --> éªŒè¯æ‰“å¡æ•°æ®å®Œæ•´æ€§
    éªŒè¯æ‰“å¡æ•°æ®å®Œæ•´æ€§ --> æ•°æ®å¼‚å¸¸: æ•°æ®ä¸å®Œæ•´
    éªŒè¯æ‰“å¡æ•°æ®å®Œæ•´æ€§ --> è·å–æ’ç­ä¿¡æ¯: æ•°æ®å®Œæ•´

    è·å–æ’ç­ä¿¡æ¯ --> å·¥ä½œæ—¶é•¿è®¡ç®—
    å·¥ä½œæ—¶é•¿è®¡ç®— --> è¿Ÿåˆ°æ—©é€€åˆ¤å®š
    è¿Ÿåˆ°æ—©é€€åˆ¤å®š --> åŠ ç­æ—¶é—´è®¡ç®—
    åŠ ç­æ—¶é—´è®¡ç®— --> å¼‚å¸¸çŠ¶æ€æ£€æµ‹
    å¼‚å¸¸çŠ¶æ€æ£€æµ‹ --> ç”Ÿæˆè€ƒå‹¤ç»“æœ
    ç”Ÿæˆè€ƒå‹¤ç»“æœ --> [*]

    æ•°æ®å¼‚å¸¸ --> è®°å½•å¼‚å¸¸æ—¥å¿—
    è®°å½•å¼‚å¸¸æ—¥å¿— --> ç”Ÿæˆå¼‚å¸¸é¢„è­¦
    ç”Ÿæˆå¼‚å¸¸é¢„è­¦ --> [*]
```

### 3. å¼‚å¸¸æ£€æµ‹é€»è¾‘

```java
@Component
@Slf4j
public class AttendanceAnomalyDetector {

    @Resource
    private AttendanceWarningService warningService;

    /**
     * æ£€æµ‹è€ƒå‹¤å¼‚å¸¸
     */
    public List<AttendanceWarning> detectAnomalies(AttendanceResult result) {
        List<AttendanceWarning> warnings = new ArrayList<>();

        // 1. æ£€æµ‹è¿Ÿåˆ°å¼‚å¸¸
        if (result.getLateMinutes() > 0) {
            warnings.add(this.createLateWarning(result));
        }

        // 2. æ£€æµ‹æ—©é€€å¼‚å¸¸
        if (result.getEarlyLeaveMinutes() > 0) {
            warnings.add(this.createEarlyLeaveWarning(result));
        }

        // 3. æ£€æµ‹ç¼ºå‹¤å¼‚å¸¸
        if (result.getAttendanceStatus().equals("ABSENCE")) {
            warnings.add(this.createAbsenceWarning(result));
        }

        // 4. æ£€æµ‹åŠ ç­å¼‚å¸¸
        if (result.getOvertimeMinutes() > 480) { // è¶…è¿‡8å°æ—¶
            warnings.add(this.createOvertimeWarning(result));
        }

        // 5. ä¿å­˜é¢„è­¦è®°å½•
        if (!warnings.isEmpty()) {
            warningService.saveWarnings(warnings);
        }

        return warnings;
    }

    private AttendanceWarning createLateWarning(AttendanceResult result) {
        return AttendanceWarning.builder()
                .employeeId(result.getEmployeeId())
                .employeeName(result.getEmployeeName())
                .attendanceDate(result.getAttendanceDate())
                .warningType("LATE")
                .warningLevel("MEDIUM")
                .warningContent(String.format("è¿Ÿåˆ°%dåˆ†é’Ÿ", result.getLateMinutes()))
                .build();
    }
}
```

## ğŸ§® ç®—æ³•å®ç°

### 1. å·¥ä½œæ—¶é•¿è®¡ç®—ç®—æ³•

```java
@Component
@Slf4j
public class WorkTimeCalculator {

    /**
     * è®¡ç®—å·¥ä½œæ—¶é•¿
     */
    public WorkTimeResult calculateWorkTime(List<ClockRecord> clockRecords, WorkSchedule schedule) {
        if (CollectionUtils.isEmpty(clockRecords)) {
            return WorkTimeResult.empty();
        }

        // æŒ‰æ—¶é—´æ’åºæ‰“å¡è®°å½•
        clockRecords.sort(Comparator.comparing(ClockRecord::getClockTime));

        // è®¡ç®—å·¥ä½œæ—¶é•¿
        Duration workDuration = Duration.ZERO;
        DateTime workStartTime = null;
        DateTime workEndTime = null;

        for (ClockRecord record : clockRecords) {
            if (record.getClockType() == ClockType.WORK_START) {
                workStartTime = new DateTime(record.getClockTime());
            } else if (record.getClockType() == ClockType.WORK_END) {
                workEndTime = new DateTime(record.getClockTime());

                // è®¡ç®—æ—¶é•¿
                if (workStartTime != null) {
                    workDuration = Duration.between(workStartTime, workEndTime);
                    break;
                }
            }
        }

        // è°ƒæ•´å·¥ä½œæ—¶é•¿ï¼ˆæ‰£é™¤ä¼‘æ¯æ—¶é—´ï¼‰
        Duration adjustedDuration = this.adjustWorkDuration(workDuration, schedule);

        return WorkTimeResult.builder()
                .workStartTime(workStartTime)
                .workEndTime(workEndTime)
                .originalDuration(workDuration)
                .adjustedDuration(adjustedDuration)
                .actualMinutes((int) adjustedDuration.toMinutes())
                .build();
    }

    /**
     * è°ƒæ•´å·¥ä½œæ—¶é•¿ï¼ˆæ‰£é™¤ä¼‘æ¯æ—¶é—´ï¼‰
     */
    private Duration adjustWorkDuration(Duration workDuration, WorkSchedule schedule) {
        Duration adjustedDuration = workDuration;

        // æ‰£é™¤åˆä¼‘æ—¶é—´
        if (schedule.getLunchBreakEnabled() && workDuration.toHours() >= 6) {
            Duration lunchBreak = schedule.getLunchBreakDuration();
            adjustedDuration = adjustedDuration.minus(lunchBreak);
        }

        // æ‰£é™¤å…¶ä»–ä¼‘æ¯æ—¶é—´
        if (schedule.getOtherBreaks() != null) {
            for (BreakTime breakTime : schedule.getOtherBreaks()) {
                if (this.shouldDeductBreak(workDuration, breakTime)) {
                    adjustedDuration = adjustedDuration.minus(breakTime.getDuration());
                }
            }
        }

        return adjustedDuration;
    }
}
```

### 2. è¿Ÿåˆ°æ—©é€€åˆ¤å®šç®—æ³•

```java
@Component
@Slf4j
public class LateEarlyDetector {

    /**
     * æ£€æµ‹è¿Ÿåˆ°
     */
    public LateEarlyResult detectLate(List<ClockRecord> clockRecords, WorkSchedule schedule) {
        DateTime workStartTime = this.findWorkStartTime(clockRecords);
        DateTime scheduleStartTime = new DateTime(schedule.getWorkStartTime());

        if (workStartTime == null) {
            return LateEarlyResult.notRecorded();
        }

        // è€ƒè™‘å®½å®¹æ—¶é—´
        DateTime graceEndTime = scheduleStartTime.plusMinutes(schedule.getGracePeriod());

        if (workStartTime.isAfter(graceEndTime)) {
            Duration lateDuration = Duration.between(graceEndTime, workStartTime);
            return LateEarlyResult.late((int) lateDuration.toMinutes());
        }

        return LateEarlyResult.normal();
    }

    /**
     * æ£€æµ‹æ—©é€€
     */
    public LateEarlyResult detectEarlyLeave(List<ClockRecord> clockRecords, WorkSchedule schedule) {
        DateTime workEndTime = this.findWorkEndTime(clockRecords);
        DateTime scheduleEndTime = new DateTime(schedule.getWorkEndTime());

        if (workEndTime == null) {
            return LateEarlyResult.notRecorded();
        }

        // è€ƒè™‘å®½å®¹æ—¶é—´
        DateTime graceStartTime = scheduleEndTime.minusMinutes(schedule.getGracePeriod());

        if (workEndTime.isBefore(graceStartTime)) {
            Duration earlyDuration = Duration.between(workEndTime, graceStartTime);
            return LateEarlyResult.earlyLeave((int) earlyDuration.toMinutes());
        }

        return LateEarlyResult.normal();
    }
}
```

### 3. åŠ ç­æ—¶é—´è®¡ç®—ç®—æ³•

```java
@Component
@Slf4j
public class OvertimeCalculator {

    /**
     * è®¡ç®—åŠ ç­æ—¶é•¿
     */
    public OvertimeResult calculateOvertime(List<ClockRecord> clockRecords,
                                           WorkSchedule schedule,
                                           LocalDate date) {
        List<OvertimeRecord> overtimeRecords = new ArrayList<>();

        // æŸ¥æ‰¾åŠ ç­å¼€å§‹å’Œç»“æŸè®°å½•
        DateTime overtimeStart = null;
        DateTime overtimeEnd = null;

        for (ClockRecord record : clockRecords) {
            if (record.getClockType() == ClockType.OVERTIME_START) {
                overtimeStart = new DateTime(record.getClockTime());
            } else if (record.getClockType() == ClockType.OVERTIME_END) {
                overtimeEnd = new DateTime(record.getClockTime());

                // è®¡ç®—åŠ ç­æ—¶é•¿
                if (overtimeStart != null) {
                    Duration overtimeDuration = Duration.between(overtimeStart, overtimeEnd);

                    // éªŒè¯åŠ ç­æ—¶é•¿æ˜¯å¦ç¬¦åˆè§„å®š
                    if (this.isValidOvertimeDuration(overtimeDuration)) {
                        OvertimeRecord overtimeRecord = OvertimeRecord.builder()
                                .employeeId(record.getEmployeeId())
                                .overtimeDate(date)
                                .startTime(overtimeStart)
                                .endTime(overtimeEnd)
                                .durationMinutes((int) overtimeDuration.toMinutes())
                                .build();

                        overtimeRecords.add(overtimeRecord);
                    }
                }

                // é‡ç½®åŠ ç­å¼€å§‹æ—¶é—´
                overtimeStart = null;
            }
        }

        // ç»Ÿè®¡æ€»åŠ ç­æ—¶é•¿
        int totalMinutes = overtimeRecords.stream()
                .mapToInt(OvertimeRecord::getDurationMinutes)
                .sum();

        return OvertimeResult.builder()
                .overtimeRecords(overtimeRecords)
                .totalMinutes(totalMinutes)
                .build();
    }

    /**
     * éªŒè¯åŠ ç­æ—¶é•¿æœ‰æ•ˆæ€§
     */
    private boolean isValidOvertimeDuration(Duration duration) {
        int minutes = (int) duration.toMinutes();

        // åŠ ç­æ—¶é•¿è‡³å°‘30åˆ†é’Ÿ
        if (minutes < 30) {
            return false;
        }

        // åŠ ç­æ—¶é•¿ä¸è¶…è¿‡12å°æ—¶
        if (minutes > 720) {
            return false;
        }

        return true;
    }
}
```

## ğŸ“Š ç»Ÿè®¡åˆ†æè®¾è®¡

### 1. è€ƒå‹¤ç»Ÿè®¡ç»´åº¦

```markdown
1. **æ—¶é—´ç»´åº¦ç»Ÿè®¡**
   - æ—¥ç»Ÿè®¡ï¼šæ¯æ—¥è€ƒå‹¤æƒ…å†µ
   - å‘¨ç»Ÿè®¡ï¼šæ¯å‘¨è€ƒå‹¤æ±‡æ€»
   - æœˆç»Ÿè®¡ï¼šæœˆåº¦è€ƒå‹¤åˆ†æ
   - å­£åº¦ç»Ÿè®¡ï¼šå­£åº¦è€ƒå‹¤è¶‹åŠ¿
   - å¹´ç»Ÿè®¡ï¼šå¹´åº¦è€ƒå‹¤æ€»ç»“

2. **äººå‘˜ç»´åº¦ç»Ÿè®¡**
   - ä¸ªäººè€ƒå‹¤ï¼šå‘˜å·¥ä¸ªäººè€ƒå‹¤æ˜ç»†
   - éƒ¨é—¨è€ƒå‹¤ï¼šéƒ¨é—¨è€ƒå‹¤æ±‡æ€»
   - å²—ä½è€ƒå‹¤ï¼šå²—ä½è€ƒå‹¤å¯¹æ¯”

3. **å¼‚å¸¸ç»´åº¦ç»Ÿè®¡**
   - è¿Ÿåˆ°ç»Ÿè®¡ï¼šè¿Ÿåˆ°æ¬¡æ•°ã€æ—¶é•¿ã€è¶‹åŠ¿
   - æ—©é€€ç»Ÿè®¡ï¼šæ—©é€€æ¬¡æ•°ã€æ—¶é•¿ã€è¶‹åŠ¿
   - ç¼ºå‹¤ç»Ÿè®¡ï¼šç¼ºå‹¤æ¬¡æ•°ã€å¤©æ•°ã€åŸå› 
   - åŠ ç­ç»Ÿè®¡ï¼šåŠ ç­æ—¶é•¿ã€é¢‘ç‡ã€æˆæœ¬

4. **æ•ˆç‡ç»´åº¦ç»Ÿè®¡**
   - å‡ºå‹¤ç‡ï¼šå®é™…å‡ºå‹¤/åº”å‡ºå‹¤æ¯”ä¾‹
   - å‡†æ—¶ç‡ï¼šå‡†æ—¶æ‰“å¡æ¯”ä¾‹
   - å·¥æ—¶åˆ©ç”¨ç‡ï¼šæœ‰æ•ˆå·¥ä½œæ—¶é—´/åº”å·¥ä½œæ—¶é—´
```

### 2. ç»Ÿè®¡æŠ¥è¡¨å®ç°

```java
@Service
@Slf4j
public class AttendanceStatisticsService {

    /**
     * ç”Ÿæˆæœˆåº¦è€ƒå‹¤ç»Ÿè®¡æŠ¥è¡¨
     */
    public AttendanceMonthlyReport generateMonthlyReport(Long employeeId,
                                                            int year,
                                                            int month) {
        LocalDate startDate = LocalDate.of(year, month, 1);
        LocalDate endDate = startDate.withDayOfMonth(startDate.lengthOfMonth());

        // è·å–æœˆåº¦è€ƒå‹¤æ•°æ®
        List<AttendanceResult> monthlyResults = attendanceResultDao
                .selectByEmployeeAndDateRange(employeeId, startDate, endDate);

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        AttendanceStatistics statistics = this.calculateStatistics(monthlyResults);

        // æ„å»ºæŠ¥è¡¨
        return AttendanceMonthlyReport.builder()
                .employeeId(employeeId)
                .year(year)
                .month(month)
                .statistics(statistics)
                .detailResults(monthlyResults)
                .generateTime(LocalDateTime.now())
                .build();
    }

    /**
     * è®¡ç®—è€ƒå‹¤ç»Ÿè®¡æ•°æ®
     */
    private AttendanceStatistics calculateStatistics(List<AttendanceResult> results) {
        return AttendanceStatistics.builder()
                .totalDays(results.size())
                .normalDays((int) results.stream().filter(r -> !r.getIsAbnormal()).count())
                .abnormalDays((int) results.stream().filter(AttendanceResult::getIsAbnormal).count())
                .lateCount((int) results.stream().filter(r -> r.getLateMinutes() > 0).count())
                .earlyLeaveCount((int) results.stream().filter(r -> r.getEarlyLeaveMinutes() > 0).count())
                .absenceCount((int) results.stream().filter(r -> "ABSENCE".equals(r.getAttendanceStatus())).count())
                .totalActualWorkMinutes(results.stream().mapToInt(AttendanceResult::getActualWorkMinutes).sum())
                .totalOvertimeMinutes(results.stream().mapToInt(AttendanceResult::getOvertimeMinutes).sum())
                .attendanceRate(this.calculateAttendanceRate(results))
                .build();
    }
}
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

### æŠ€æœ¯æ¶æ„æ–‡æ¡£
- [è€ƒå‹¤ç®¡ç†APIæ¥å£æ–‡æ¡£](./è€ƒå‹¤ç®¡ç†APIæ¥å£æ–‡æ¡£.md) - è€ƒå‹¤ç®¡ç†APIè¯¦ç»†è®¾è®¡
- [æ’ç­ç®¡ç†æ¨¡å—è®¾è®¡](./æ’ç­ç®¡ç†æ¨¡å—è®¾è®¡.md) - æ’ç­ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡
- [é—¨ç¦ç³»ç»Ÿé›†æˆè®¾è®¡](../é—¨ç¦ç³»ç»Ÿ/é—¨ç¦ç³»ç»Ÿé›†æˆè®¾è®¡.md) - é—¨ç¦è€ƒå‹¤é›†æˆæ–¹æ¡ˆ

### ä¸šåŠ¡æµç¨‹æ–‡æ¡£
- [å¼‚å¸¸ç®¡ç†æµç¨‹è®¾è®¡](./å¼‚å¸¸ç®¡ç†æµç¨‹è®¾è®¡.md) - è€ƒå‹¤å¼‚å¸¸å¤„ç†æµç¨‹
- [è€ƒå‹¤æ±‡æ€»æŠ¥è¡¨è®¾è®¡](./è€ƒå‹¤æ±‡æ€»æŠ¥è¡¨è®¾è®¡.md) - è€ƒå‹¤ç»Ÿè®¡æŠ¥è¡¨è®¾è®¡
- [è€ƒå‹¤è§„åˆ™é…ç½®è®¾è®¡](./è€ƒå‹¤è§„åˆ™é…ç½®è®¾è®¡.md) - è€ƒå‹¤è§„åˆ™é…ç½®ç®¡ç†

### æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [è€ƒå‹¤ç³»ç»Ÿæ•°æ®åº“è®¾è®¡](./æ•°æ®åº“è®¾è®¡.md) - å®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
- [è€ƒå‹¤ç³»ç»ŸERå›¾](./ç³»ç»ŸERå›¾.md) - å®ä½“å…³ç³»å›¾è®¾è®¡

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™æ€»ç»“

1. **æ•°æ®å®Œæ•´æ€§** - ç¡®ä¿æ‰“å¡æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
2. **è®¡ç®—å‡†ç¡®æ€§** - é‡‡ç”¨æ ‡å‡†ç®—æ³•ç¡®ä¿è€ƒå‹¤è®¡ç®—ç»“æœå‡†ç¡®
3. **å®æ—¶æ€§** - æ‰“å¡åå®æ—¶è®¡ç®—å’Œå¼‚å¸¸æ£€æµ‹
4. **çµæ´»æ€§** - æ”¯æŒå¤šç§è€ƒå‹¤è§„åˆ™å’Œè‡ªå®šä¹‰é…ç½®
5. **å¯æ‰©å±•æ€§** - æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•

## ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯

- æœ¬æ–‡æ¡£åŸºäºè€ƒå‹¤ç³»ç»ŸåŸå§‹è®°å½•åŠè€ƒå‹¤è®¡ç®—è®¾è®¡
- ç®—æ³•è®¾è®¡è´Ÿè´£äººï¼šSmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
- åˆ›å»ºæ—¥æœŸï¼š2025-11-13
- ä¸‹æ¬¡è¯„å®¡ï¼š2026-02-13

---

**ğŸ¯ IOE-DREAMåŸå§‹è®°å½•åŠè€ƒå‹¤è®¡ç®—è®¾è®¡ - å‡†ç¡®ã€å®æ—¶ã€çµæ´»çš„ä¼ä¸šçº§è€ƒå‹¤ç®¡ç†è§£å†³æ–¹æ¡ˆ**