# é—¨ç¦å®¡æ‰¹æµç¨‹ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡

> **ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¶é—´**: 2025-11-13
> **åˆ†ç±»**: æ ¸å¿ƒåŠŸèƒ½æ¨¡å— > ä¼ä¸šOAç³»ç»Ÿ > é—¨ç¦ç®¡ç†ç³»ç»Ÿ
> **æ ‡ç­¾**: ["é—¨ç¦ç³»ç»Ÿ", "å®¡æ‰¹æµç¨‹", "æƒé™ç”³è¯·", "è®¿å®¢ç®¡ç†", "å·¥ä½œæµå¼•æ“"]
> **ä½œè€…**: SmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
> **æè¿°**: IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°é—¨ç¦ç®¡ç†ç³»ç»Ÿçš„å®¡æ‰¹æµç¨‹ç®¡ç†ã€æƒé™ç”³è¯·ã€è®¿å®¢é¢„çº¦å’Œç´§æ€¥æƒé™å¤„ç†æ¨¡å—è¯¦ç»†æŠ€æœ¯è®¾è®¡

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### æ ¸å¿ƒå®šä½

**é—¨ç¦å®¡æ‰¹æµç¨‹ç®¡ç†æ¨¡å—**æ˜¯IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°çš„å·¥ä½œæµæ ¸å¿ƒï¼Œè´Ÿè´£é—¨ç¦æƒé™ç”³è¯·ã€è®¿å®¢é¢„çº¦ç®¡ç†ã€ç´§æ€¥æƒé™å¤„ç†å’Œå®¡æ‰¹æµç¨‹é…ç½®ã€‚æ¨¡å—é‡‡ç”¨çµæ´»çš„å·¥ä½œæµå¼•æ“ï¼Œæ”¯æŒæ ‡å‡†å®¡æ‰¹ã€å¿«é€Ÿå®¡æ‰¹ã€ç´§æ€¥å®¡æ‰¹å’Œè‡ªåŠ¨å®¡æ‰¹ç­‰å¤šç§æµç¨‹ç±»å‹ï¼Œç¡®ä¿æƒé™ç®¡ç†çš„è§„èŒƒæ€§å’Œå®‰å…¨æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **çµæ´»å·¥ä½œæµå¼•æ“**ï¼šæ”¯æŒä¸²è¡Œã€å¹¶è¡Œã€ä¼šç­¾ã€æˆ–ç­¾ç­‰å¤šç§å®¡æ‰¹æ¨¡å¼
- âœ… **æƒé™ç”³è¯·ç®¡ç†**ï¼šå®Œæ•´çš„æƒé™ç”³è¯·ã€è·¯ç”±ã€å®¡æ‰¹ã€ç”Ÿæ•ˆæµç¨‹
- âœ… **è®¿å®¢é¢„çº¦ç³»ç»Ÿ**ï¼šè®¿å®¢é¢„çº¦ã€å®¡æ ¸ã€æˆæƒã€æ³¨é”€å…¨æµç¨‹ç®¡ç†
- âœ… **ç´§æ€¥æƒé™å¤„ç†**ï¼šç´§æ€¥æƒ…å†µä¸‹çš„å¿«é€Ÿå®¡æ‰¹å’Œä¸´æ—¶æˆæƒæœºåˆ¶
- âœ… **æµç¨‹å¯è§†åŒ–è®¾è®¡**ï¼šæ‹–æ‹½å¼æµç¨‹è®¾è®¡å’ŒèŠ‚ç‚¹é…ç½®
- âœ… **æ™ºèƒ½å®¡æ‰¹è·¯ç”±**ï¼šåŸºäºè§„åˆ™çš„è‡ªåŠ¨å®¡æ‰¹è·¯ç”±å’Œè½¬äº¤
- âœ… **ç§»åŠ¨ç«¯å®¡æ‰¹æ”¯æŒ**ï¼šæ”¯æŒç§»åŠ¨è®¾å¤‡çš„å®¡æ‰¹æ“ä½œå’Œé€šçŸ¥

## ğŸ—ï¸ å®¡æ‰¹æµç¨‹ç®¡ç†æ¨¡å—æ¶æ„è®¾è®¡

### æ¨¡å—åŠŸèƒ½æ¶æ„å›¾

```mermaid
graph TB
    subgraph "é—¨ç¦å®¡æ‰¹æµç¨‹ç®¡ç†æ¨¡å—æ¶æ„"
        subgraph "ç”¨æˆ·äº¤äº’å±‚"
            WF[å·¥ä½œæµè®¾è®¡å™¨]
            APP[æƒé™ç”³è¯·ç•Œé¢]
            VIS[è®¿å®¢ç®¡ç†ç•Œé¢]
            EMG[ç´§æ€¥æƒé™ç•Œé¢]
            APR[å®¡æ‰¹å¤„ç†ç•Œé¢]
        end

        subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
            subgraph "æ ¸å¿ƒä¸šåŠ¡æœåŠ¡"
                APS[æƒé™ç”³è¯·æœåŠ¡]
                VMS[è®¿å®¢ç®¡ç†æœåŠ¡]
                EPS[ç´§æ€¥æƒé™æœåŠ¡]
                WFS[å·¥ä½œæµæœåŠ¡]
            end

            subgraph "å·¥ä½œæµå¼•æ“"
                WFE[å·¥ä½œæµæ‰§è¡Œå¼•æ“]
                BRE[ä¸šåŠ¡è§„åˆ™å¼•æ“]
                NTE[é€šçŸ¥å¼•æ“]
                RTE[è·¯ç”±å¼•æ“]
            end
        end

        subgraph "æ•°æ®è®¿é—®å±‚"
            APD[æƒé™ç”³è¯·æ•°æ®è®¿é—®]
            VMD[è®¿å®¢ç®¡ç†æ•°æ®è®¿é—®]
            EMD[ç´§æ€¥æƒé™æ•°æ®è®¿é—®]
            WFD[å·¥ä½œæµå®šä¹‰æ•°æ®è®¿é—®]
            WIH[å·¥ä½œæµå®ä¾‹æ•°æ®è®¿é—®]
        end

        subgraph "å¤–éƒ¨é›†æˆå±‚"
            AUTH[æƒé™ç®¡ç†ç³»ç»Ÿ]
            NOTIFY[é€šçŸ¥ç³»ç»Ÿ]
            PERSON[äººå‘˜ç®¡ç†ç³»ç»Ÿ]
            AREA[åŒºåŸŸç®¡ç†ç³»ç»Ÿ]
        end
    end

    WF --> WFS
    APP --> APS
    VIS --> VMS
    EMG --> EPS
    APR --> WFE

    APS --> WFE
    VMS --> WFE
    EPS --> WFE
    WFS --> BRE

    WFE --> RTE
    BRE --> NTE
    RTE --> AUTH
    NTE --> NOTIFY

    APS --> AUTH
    VMS --> PERSON
    EPS --> AREA
    WFS --> WFD
```

### å®¡æ‰¹æµç¨‹ç®¡ç†æ ¸å¿ƒæµç¨‹è®¾è®¡

```mermaid
graph TB
    ApproveStart(å®¡æ‰¹ç®¡ç†å¼€å§‹) --> ApproveChoose{é€‰æ‹©å®¡æ‰¹ç±»å‹}

    ApproveChoose -->|æƒé™ç”³è¯·| AuthApply
    ApproveChoose -->|è®¿å®¢é¢„çº¦| VisitorReserve
    ApproveChoose -->|ç´§æ€¥æƒé™| EmergencyAuth
    ApproveChoose -->|æµç¨‹é…ç½®| ProcessConfig

    subgraph æƒé™ç”³è¯·æµç¨‹
        AuthApply --> SubmitApply[ç”³è¯·æäº¤]
        SubmitApply --> RouteApply[ç”³è¯·è·¯ç”±]
        RouteApply --> ApproveProcess{å®¡æ‰¹æµç¨‹}
        ApproveProcess -->|é€šè¿‡| ResultNotify[ç»“æœé€šçŸ¥]
        ApproveProcess -->|æ‹’ç»| ApplyReject[ç”³è¯·æ‹’ç»]
        ResultNotify --> AuthActive[æƒé™ç”Ÿæ•ˆ]
        AuthActive --> ApplyEnd[ç”³è¯·å®Œæˆ]
        ApplyReject --> ApplyEnd
    end

    subgraph è®¿å®¢é¢„çº¦æµç¨‹
        VisitorReserve --> ReserveApply[é¢„çº¦ç”³è¯·]
        ReserveApply --> ReserveAudit[é¢„çº¦å®¡æ ¸]
        ReserveAudit -->|é€šè¿‡| AuthGenerate[æƒé™ç”Ÿæˆ]
        ReserveAudit -->|æ‹’ç»| ReserveReject[é¢„çº¦æ‹’ç»]
        AuthGenerate --> VisitAuth[è®¿é—®æˆæƒ]
        VisitAuth --> VisitEnd[è®¿ç¦»æ³¨é”€]
        VisitEnd --> ReserveEnd[é¢„çº¦å®Œæˆ]
        ReserveReject --> ReserveEnd
    end

    subgraph ç´§æ€¥æƒé™å¤„ç†æµç¨‹
        EmergencyAuth --> EmergencyApply[ç´§æ€¥ç”³è¯·]
        EmergencyApply --> QuickApprove[å¿«é€Ÿå®¡æ‰¹]
        QuickApprove --> TempAuth[ä¸´æ—¶æˆæƒ]
        TempAuth --> AutoExpire[è‡ªåŠ¨è¿‡æœŸ]
        AutoExpire --> EmergencyEnd[ç´§æ€¥æƒé™å®Œæˆ]
    end

    subgraph å®¡æ‰¹æµç¨‹é…ç½®
        ProcessConfig --> ProcessDesign[æµç¨‹è®¾è®¡]
        ProcessDesign --> NodeConfig[èŠ‚ç‚¹é…ç½®]
        NodeConfig --> RuleSet[è§„åˆ™è®¾ç½®]
        RuleSet --> TestPublish[æµ‹è¯•å‘å¸ƒ]
        TestPublish --> ConfigEnd[é…ç½®å®Œæˆ]
    end
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯¦ç»†è®¾è®¡

### 1. æƒé™ç”³è¯·æœåŠ¡

#### 1.1 æƒé™ç”³è¯·æäº¤æµç¨‹

**åŠŸèƒ½æè¿°**ï¼šç”¨æˆ·é—¨ç¦æƒé™ç”³è¯·çš„æäº¤ã€è·¯ç”±ã€å®¡æ‰¹å’Œç”Ÿæ•ˆæµç¨‹

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class PermissionApplyService {

    @Resource
    private WorkflowEngine workflowEngine;

    @Resource
    private PermissionRouteEngine routeEngine;

    @Resource
    private NotificationService notificationService;

    /**
     * æäº¤æƒé™ç”³è¯·
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<String> submitPermissionApply(PermissionApplyForm applyForm) {
        try {
            // 1. éªŒè¯ç”³è¯·è¡¨å•
            validateApplyForm(applyForm);

            // 2. åˆ›å»ºç”³è¯·è®°å½•
            PermissionApplyEntity apply = PermissionApplyEntity.builder()
                    .applyId(IdGenerator.generateId())
                    .applicantId(SmartRequestUtil.getRequestUserId())
                    .applyType(applyForm.getApplyType())
                    .applyReason(applyForm.getApplyReason())
                    .permissionScope(applyForm.getPermissionScope())
                    .validFrom(applyForm.getValidFrom())
                    .validTo(applyForm.getValidTo())
                    .emergencyContact(applyForm.getEmergencyContact())
                    .attachmentIds(applyForm.getAttachmentIds())
                    .status(ApplyStatus.PENDING)
                    .createTime(LocalDateTime.now())
                    .build();

            permissionApplyDao.insert(apply);

            // 3. è·¯ç”±ç”³è¯·åˆ°ç›¸åº”å®¡æ‰¹æµç¨‹
            WorkflowRouteResult routeResult = routeEngine.routeApplication(apply);

            // 4. å¯åŠ¨å·¥ä½œæµå®ä¾‹
            WorkflowInstance workflowInstance = workflowEngine.startWorkflow(
                    routeResult.getProcessDefinitionId(),
                    routeResult.getBusinessKey(),
                    buildWorkflowVariables(apply, routeResult));

            // 5. å…³è”å·¥ä½œæµå®ä¾‹
            apply.setWorkflowInstanceId(workflowInstance.getInstanceId());
            permissionApplyDao.updateById(apply);

            // 6. å‘é€ç”³è¯·æäº¤é€šçŸ¥
            notificationService.sendApplySubmittedNotification(apply, workflowInstance);

            log.info("æƒé™ç”³è¯·æäº¤æˆåŠŸ, applyId: {}, workflowInstanceId: {}",
                    apply.getApplyId(), workflowInstance.getInstanceId());

            return ResponseDTO.ok(apply.getApplyId());

        } catch (Exception e) {
            log.error("æäº¤æƒé™ç”³è¯·å¤±è´¥", e);
            return ResponseDTO.error("æäº¤å¤±è´¥");
        }
    }

    /**
     * å¤„ç†æƒé™ç”³è¯·å®¡æ‰¹
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> processPermissionApply(PermissionApprovalForm approvalForm) {
        try {
            Long applyId = approvalForm.getApplyId();
            String decision = approvalForm.getDecision();
            String comment = approvalForm.getComment();

            // 1. éªŒè¯å®¡æ‰¹æƒé™
            PermissionApplyEntity apply = permissionApplyDao.selectById(applyId);
            if (apply == null) {
                return ResponseDTO.error("ç”³è¯·ä¸å­˜åœ¨");
            }

            validateApprovalPermission(apply, approvalForm.getApproverId());

            // 2. å®Œæˆå·¥ä½œæµä»»åŠ¡
            WorkflowTaskResult taskResult = workflowEngine.completeTask(
                    approvalForm.getTaskId(),
                    buildTaskVariables(decision, comment));

            // 3. æ›´æ–°ç”³è¯·çŠ¶æ€
            if ("APPROVE".equals(decision)) {
                if (taskResult.isProcessCompleted()) {
                    // å®¡æ‰¹æµç¨‹å®Œæˆï¼Œæ¿€æ´»æƒé™
                    activatePermission(apply);
                    apply.setStatus(ApplyStatus.APPROVED);
                } else {
                    apply.setStatus(ApplyStatus.IN_APPROVAL);
                }
            } else {
                apply.setStatus(ApplyStatus.REJECTED);
                apply.setRejectReason(comment);
            }

            apply.setUpdateTime(LocalDateTime.now());
            permissionApplyDao.updateById(apply);

            // 4. å‘é€å®¡æ‰¹ç»“æœé€šçŸ¥
            notificationService.sendApprovalResultNotification(apply, taskResult, decision);

            log.info("æƒé™ç”³è¯·å®¡æ‰¹å¤„ç†å®Œæˆ, applyId: {}, decision: {}", applyId, decision);

            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("å¤„ç†æƒé™ç”³è¯·å®¡æ‰¹å¤±è´¥", e);
            return ResponseDTO.error("å®¡æ‰¹å¤±è´¥");
        }
    }

    /**
     * æ¿€æ´»æƒé™
     */
    private void activatePermission(PermissionApplyEntity apply) {
        try {
            // 1. æ ¹æ®ç”³è¯·èŒƒå›´åˆ›å»ºæƒé™
            List<PermissionGrant> grants = buildPermissionGrants(apply);

            // 2. æ‰¹é‡æˆæƒ
            for (PermissionGrant grant : grants) {
                permissionService.grantPermission(grant);
            }

            // 3. è®°å½•æƒé™æ¿€æ´»æ—¥å¿—
            PermissionActivationLog activationLog = PermissionActivationLog.builder()
                    .applyId(apply.getApplyId())
                    .grantCount(grants.size())
                    .activationTime(LocalDateTime.now())
                    .validFrom(apply.getValidFrom())
                    .validTo(apply.getValidTo())
                    .build();

            permissionLogService.saveActivationLog(activationLog);

        } catch (Exception e) {
            log.error("æ¿€æ´»æƒé™å¤±è´¥, applyId: {}", apply.getApplyId(), e);
            throw new RuntimeException("æƒé™æ¿€æ´»å¤±è´¥");
        }
    }

    /**
     * æ„å»ºæƒé™æˆæƒ
     */
    private List<PermissionGrant> buildPermissionGrants(PermissionApplyEntity apply) {
        List<PermissionGrant> grants = new ArrayList<>();

        PermissionScope scope = apply.getPermissionScope();

        // 1. åŒºåŸŸæƒé™
        for (Long areaId : scope.getAreaIds()) {
            PermissionGrant areaGrant = PermissionGrant.builder()
                    .userId(apply.getApplicantId())
                    .resourceType(ResourceType.AREA)
                    .resourceId(areaId)
                    .permissionType(PermissionType.ACCESS)
                    .validFrom(apply.getValidFrom())
                    .validTo(apply.getValidTo())
                    .grantSource(GrantSource.APPLY_APPROVAL)
                    .grantId(apply.getApplyId())
                    .build();
            grants.add(areaGrant);
        }

        // 2. è®¾å¤‡æƒé™
        for (Long deviceId : scope.getDeviceIds()) {
            PermissionGrant deviceGrant = PermissionGrant.builder()
                    .userId(apply.getApplicantId())
                    .resourceType(ResourceType.DEVICE)
                    .resourceId(deviceId)
                    .permissionType(PermissionType.ACCESS)
                    .validFrom(apply.getValidFrom())
                    .validTo(apply.getValidTo())
                    .grantSource(GrantSource.APPLY_APPROVAL)
                    .grantId(apply.getApplyId())
                    .build();
            grants.add(deviceGrant);
        }

        return grants;
    }
}
```

#### 1.2 å®¡æ‰¹è·¯ç”±å¼•æ“

**åŠŸèƒ½æè¿°**ï¼šåŸºäºä¸šåŠ¡è§„åˆ™çš„æ™ºèƒ½å®¡æ‰¹è·¯ç”±å’Œè½¬äº¤

**æŠ€æœ¯å®ç°**ï¼š
```java
@Component
@Slf4j
public class PermissionRouteEngine {

    @Resource
    private RouteRuleEngine ruleEngine;

    @Resource
    private OrganizationService organizationService;

    @Resource
    private RolePermissionService rolePermissionService;

    /**
     * è·¯ç”±æƒé™ç”³è¯·
     */
    public WorkflowRouteResult routeApplication(PermissionApplyEntity apply) {
        try {
            // 1. è·å–è·¯ç”±è§„åˆ™
            List<RouteRule> rules = ruleEngine.getApplicableRules(apply);

            // 2. æ‰§è¡Œè·¯ç”±è§„åˆ™
            for (RouteRule rule : rules) {
                if (rule.matches(apply)) {
                    return executeRouteRule(rule, apply);
                }
            }

            // 3. é»˜è®¤è·¯ç”±è§„åˆ™
            return executeDefaultRoute(apply);

        } catch (Exception e) {
            log.error("è·¯ç”±æƒé™ç”³è¯·å¤±è´¥", e);
            throw new RuntimeException("è·¯ç”±å¤±è´¥");
        }
    }

    /**
     * æ‰§è¡Œè·¯ç”±è§„åˆ™
     */
    private WorkflowRouteResult executeRouteRule(RouteRule rule, PermissionApplyEntity apply) {
        try {
            RouteConfiguration config = rule.getConfiguration();

            // 1. ç¡®å®šå®¡æ‰¹äºº
            List<Long> approverIds = determineApprovers(config, apply);

            // 2. é€‰æ‹©å·¥ä½œæµå®šä¹‰
            String processDefinitionId = selectProcessDefinition(config);

            // 3. æ„å»ºè·¯ç”±ç»“æœ
            return WorkflowRouteResult.builder()
                    .processDefinitionId(processDefinitionId)
                    .businessKey(generateBusinessKey(apply))
                    .approvers(approverIds)
                    .routeType(config.getRouteType())
                    .priority(config.getPriority())
                    .build();

        } catch (Exception e) {
            log.error("æ‰§è¡Œè·¯ç”±è§„åˆ™å¤±è´¥", e);
            throw new RuntimeException("è·¯ç”±è§„åˆ™æ‰§è¡Œå¤±è´¥");
        }
    }

    /**
     * ç¡®å®šå®¡æ‰¹äºº
     */
    private List<Long> determineApprovers(RouteConfiguration config, PermissionApplyEntity apply) {
        List<Long> approvers = new ArrayList<>();

        switch (config.getApproverType()) {
            case ROLE_BASED:
                // åŸºäºè§’è‰²çš„å®¡æ‰¹äºº
                approvers.addAll(rolePermissionService.getUsersByRole(
                        config.getApproverRole(), apply.getPermissionScope()));
                break;

            case ORG_BASED:
                // åŸºäºç»„ç»‡çš„å®¡æ‰¹äºº
                approvers.addAll(organizationService.getManagerByOrgAndLevel(
                        apply.getApplicantOrgId(), config.getApproverLevel()));
                break;

            case AREA_BASED:
                // åŸºäºåŒºåŸŸçš„å®¡æ‰¹äºº
                approvers.addAll(areaPermissionService.getAreaManagers(
                        apply.getPermissionScope().getAreaIds()));
                break;

            case SPECIFIC_USER:
                // æŒ‡å®šå®¡æ‰¹äºº
                approvers.addAll(config.getSpecificApprovers());
                break;

            case DYNAMIC_RULE:
                // åŠ¨æ€è§„åˆ™å®¡æ‰¹äºº
                approvers.addAll(executeDynamicApproverRule(config.getDynamicRule(), apply));
                break;
        }

        // å»é‡å¹¶éªŒè¯å®¡æ‰¹äºº
        return approvers.stream()
                .distinct()
                .filter(this::validateApprover)
                .collect(Collectors.toList());
    }
}
```

### 2. è®¿å®¢ç®¡ç†æœåŠ¡

#### 2.1 è®¿å®¢é¢„çº¦ç®¡ç†

**åŠŸèƒ½æè¿°**ï¼šè®¿å®¢é¢„çº¦ç”³è¯·ã€å®¡æ ¸ã€æˆæƒå’Œæ³¨é”€å…¨æµç¨‹ç®¡ç†

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class VisitorReservationService {

    @Resource
    private VisitorReservationDao visitorReservationDao;

    @Resource
    private WorkflowEngine workflowEngine;

    @Resource
    private TemporaryPermissionService temporaryPermissionService;

    /**
     * æäº¤è®¿å®¢é¢„çº¦ç”³è¯·
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<String> submitVisitorReservation(VisitorReservationForm reservationForm) {
        try {
            // 1. éªŒè¯é¢„çº¦è¡¨å•
            validateReservationForm(reservationForm);

            // 2. åˆ›å»ºè®¿å®¢é¢„çº¦è®°å½•
            VisitorReservationEntity reservation = VisitorReservationEntity.builder()
                    .reservationId(IdGenerator.generateId())
                    .visitorName(reservationForm.getVisitorName())
                    .visitorPhone(reservationForm.getVisitorPhone())
                    .visitorIdCard(reservationForm.getVisitorIdCard())
                    .visitorCompany(reservationForm.getVisitorCompany())
                    .visitPurpose(reservationForm.getVisitPurpose())
                    .hostUserId(reservationForm.getHostUserId())
                    .visitDate(reservationForm.getVisitDate())
                    .visitStartTime(reservationForm.getVisitStartTime())
                    .visitEndTime(reservationForm.getVisitEndTime())
                    .accessAreaIds(reservationForm.getAccessAreaIds())
                    .status(ReservationStatus.PENDING)
                    .createTime(LocalDateTime.now())
                    .build();

            visitorReservationDao.insert(reservation);

            // 3. å¯åŠ¨é¢„çº¦å®¡æ ¸å·¥ä½œæµ
            WorkflowInstance workflowInstance = workflowEngine.startWorkflow(
                    "visitor_reservation_process",
                    reservation.getReservationId(),
                    buildReservationVariables(reservation));

            // 4. å…³è”å·¥ä½œæµå®ä¾‹
            reservation.setWorkflowInstanceId(workflowInstance.getInstanceId());
            visitorReservationDao.updateById(reservation);

            // 5. å‘é€é¢„çº¦ç”³è¯·é€šçŸ¥
            notificationService.sendReservationSubmittedNotification(reservation);

            log.info("è®¿å®¢é¢„çº¦ç”³è¯·æäº¤æˆåŠŸ, reservationId: {}", reservation.getReservationId());

            return ResponseDTO.ok(reservation.getReservationId());

        } catch (Exception e) {
            log.error("æäº¤è®¿å®¢é¢„çº¦ç”³è¯·å¤±è´¥", e);
            return ResponseDTO.error("æäº¤å¤±è´¥");
        }
    }

    /**
     * å®¡æ ¸è®¿å®¢é¢„çº¦
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> approveVisitorReservation(VisitorApprovalForm approvalForm) {
        try {
            Long reservationId = approvalForm.getReservationId();
            String decision = approvalForm.getDecision();

            // 1. è·å–é¢„çº¦è®°å½•
            VisitorReservationEntity reservation = visitorReservationDao.selectById(reservationId);
            if (reservation == null) {
                return ResponseDTO.error("é¢„çº¦ä¸å­˜åœ¨");
            }

            // 2. å®Œæˆå·¥ä½œæµä»»åŠ¡
            WorkflowTaskResult taskResult = workflowEngine.completeTask(
                    approvalForm.getTaskId(),
                    buildApprovalVariables(decision, approvalForm.getComment()));

            // 3. æ›´æ–°é¢„çº¦çŠ¶æ€
            if ("APPROVE".equals(decision)) {
                reservation.setStatus(ReservationStatus.APPROVED);
                reservation.setApproverId(approvalForm.getApproverId());
                reservation.setApproveTime(LocalDateTime.now());

                // 4. ç”Ÿæˆä¸´æ—¶è®¿é—®æƒé™
                generateTemporaryPermissions(reservation);

                // 5. ç”Ÿæˆè®¿å®¢å‡­è¯
                generateVisitorCredentials(reservation);

            } else {
                reservation.setStatus(ReservationStatus.REJECTED);
                reservation.setRejectReason(approvalForm.getComment());
            }

            visitorReservationDao.updateById(reservation);

            // 6. å‘é€å®¡æ ¸ç»“æœé€šçŸ¥
            notificationService.sendReservationApprovalNotification(reservation, decision);

            log.info("è®¿å®¢é¢„çº¦å®¡æ ¸å®Œæˆ, reservationId: {}, decision: {}", reservationId, decision);

            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("å®¡æ ¸è®¿å®¢é¢„çº¦å¤±è´¥", e);
            return ResponseDTO.error("å®¡æ ¸å¤±è´¥");
        }
    }

    /**
     * ç”Ÿæˆä¸´æ—¶è®¿é—®æƒé™
     */
    private void generateTemporaryPermissions(VisitorReservationEntity reservation) {
        try {
            // 1. åˆ›å»ºè®¿å®¢ä¸´æ—¶ç”¨æˆ·
            TemporaryUser tempUser = TemporaryUser.builder()
                    .username("VISITOR_" + reservation.getReservationId())
                    .password(generateTemporaryPassword())
                    .userType(UserType.VISITOR)
                    .realName(reservation.getVisitorName())
                    .phone(reservation.getVisitorPhone())
                    .idCard(reservation.getVisitorIdCard())
                    .validFrom(reservation.getVisitStartTime())
                    .validTo(reservation.getVisitEndTime())
                    .build();

            Long tempUserId = temporaryUserService.createTempUser(tempUser);

            // 2. æˆäºˆåŒºåŸŸè®¿é—®æƒé™
            for (Long areaId : reservation.getAccessAreaIds()) {
                TemporaryPermission permission = TemporaryPermission.builder()
                        .userId(tempUserId)
                        .resourceType(ResourceType.AREA)
                        .resourceId(areaId)
                        .permissionType(PermissionType.VISITOR_ACCESS)
                        .validFrom(reservation.getVisitStartTime())
                        .validTo(reservation.getVisitEndTime())
                        .sourceId(reservation.getReservationId())
                        .sourceType(SourceType.VISITOR_RESERVATION)
                        .build();

                temporaryPermissionService.grantPermission(permission);
            }

            // 3. æ›´æ–°é¢„çº¦è®°å½•
            reservation.setTempUserId(tempUserId);
            visitorReservationDao.updateById(reservation);

            log.info("ä¸´æ—¶æƒé™ç”ŸæˆæˆåŠŸ, reservationId: {}, tempUserId: {}",
                    reservation.getReservationId(), tempUserId);

        } catch (Exception e) {
            log.error("ç”Ÿæˆä¸´æ—¶è®¿é—®æƒé™å¤±è´¥", e);
            throw new RuntimeException("ä¸´æ—¶æƒé™ç”Ÿæˆå¤±è´¥");
        }
    }

    /**
     * è®¿å®¢ç­¾åˆ°/ç­¾ç¦»
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> visitorCheckInOut(VisitorCheckInOutForm checkForm) {
        try {
            String reservationId = checkForm.getReservationId();
            CheckType checkType = checkForm.getCheckType();

            // 1. è·å–é¢„çº¦è®°å½•
            VisitorReservationEntity reservation = visitorReservationDao.selectById(reservationId);
            if (reservation == null) {
                return ResponseDTO.error("é¢„çº¦ä¸å­˜åœ¨");
            }

            // 2. éªŒè¯ç­¾åˆ°çŠ¶æ€
            validateCheckInOutStatus(reservation, checkType);

            // 3. åˆ›å»ºç­¾åˆ°è®°å½•
            VisitorCheckRecord checkRecord = VisitorCheckRecord.builder()
                    .reservationId(reservationId)
                    .checkType(checkType)
                    .checkTime(LocalDateTime.now())
                    .checkLocation(checkForm.getCheckLocation())
                    .checkDeviceId(checkForm.getCheckDeviceId())
                    .build();

            visitorCheckRecordDao.insert(checkRecord);

            // 4. æ›´æ–°é¢„çº¦çŠ¶æ€
            if (checkType == CheckType.CHECK_IN) {
                reservation.setStatus(ReservationStatus.VISITING);
                reservation.setActualCheckInTime(LocalDateTime.now());
            } else {
                reservation.setStatus(ReservationStatus.COMPLETED);
                reservation.setActualCheckOutTime(LocalDateTime.now());

                // 5. æ³¨é”€ä¸´æ—¶æƒé™
                revokeTemporaryPermissions(reservation.getTempUserId());
            }

            visitorReservationDao.updateById(reservation);

            // 6. å‘é€ç­¾åˆ°/ç­¾ç¦»é€šçŸ¥
            notificationService.sendVisitorCheckInOutNotification(reservation, checkType);

            log.info("è®¿å®¢{}å®Œæˆ, reservationId: {}", checkType.getDescription(), reservationId);

            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("è®¿å®¢ç­¾åˆ°/ç­¾ç¦»å¤±è´¥", e);
            return ResponseDTO.error("æ“ä½œå¤±è´¥");
        }
    }

    /**
     * æ³¨é”€ä¸´æ—¶æƒé™
     */
    private void revokeTemporaryPermissions(Long tempUserId) {
        try {
            // 1. æ’¤é”€æ‰€æœ‰ä¸´æ—¶æƒé™
            temporaryPermissionService.revokeAllPermissions(tempUserId);

            // 2. ç¦ç”¨ä¸´æ—¶ç”¨æˆ·
            temporaryUserService.disableTempUser(tempUserId);

            log.info("ä¸´æ—¶æƒé™æ³¨é”€æˆåŠŸ, tempUserId: {}", tempUserId);

        } catch (Exception e) {
            log.error("æ³¨é”€ä¸´æ—¶æƒé™å¤±è´¥", e);
            throw new RuntimeException("æƒé™æ³¨é”€å¤±è´¥");
        }
    }
}
```

### 3. ç´§æ€¥æƒé™æœåŠ¡

#### 3.1 ç´§æ€¥æƒé™å¤„ç†

**åŠŸèƒ½æè¿°**ï¼šç´§æ€¥æƒ…å†µä¸‹çš„å¿«é€Ÿå®¡æ‰¹å’Œä¸´æ—¶æˆæƒæœºåˆ¶

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class EmergencyPermissionService {

    @Resource
    private EmergencyPermissionDao emergencyPermissionDao;

    @Resource
    private TemporaryPermissionService temporaryPermissionService;

    @Resource
    private EmergencyNotificationService emergencyNotificationService;

    /**
     * ç”³è¯·ç´§æ€¥æƒé™
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<String> applyEmergencyPermission(EmergencyPermissionApplyForm applyForm) {
        try {
            // 1. éªŒè¯ç´§æ€¥æƒé™ç”³è¯·
            validateEmergencyApply(applyForm);

            // 2. åˆ›å»ºç´§æ€¥æƒé™è®°å½•
            EmergencyPermissionEntity emergencyPermission = EmergencyPermissionEntity.builder()
                    .permissionId(IdGenerator.generateId())
                    .applicantId(SmartRequestUtil.getRequestUserId())
                    .emergencyType(applyForm.getEmergencyType())
                    .emergencyLevel(applyForm.getEmergencyLevel())
                    .emergencyReason(applyForm.getEmergencyReason())
                    .permissionScope(applyForm.getPermissionScope())
                    .requestedDuration(applyForm.getRequestedDuration())
                    .contactPerson(applyForm.getContactPerson())
                    .contactPhone(applyForm.getContactPhone())
                    .status(EmergencyStatus.PENDING)
                    .createTime(LocalDateTime.now())
                    .build();

            emergencyPermissionDao.insert(emergencyPermission);

            // 3. ç«‹å³å‘é€ç´§æ€¥é€šçŸ¥
            emergencyNotificationService.sendEmergencyNotification(emergencyPermission);

            // 4. å¯åŠ¨å¿«é€Ÿå®¡æ‰¹æµç¨‹
            if (applyForm.getEmergencyLevel() == EmergencyLevel.CRITICAL) {
                // å…³é”®çº§åˆ«ç«‹å³æˆæƒ
                grantEmergencyPermission(emergencyPermission);
            } else {
                // å¯åŠ¨å¿«é€Ÿå®¡æ‰¹å·¥ä½œæµ
                startEmergencyApprovalWorkflow(emergencyPermission);
            }

            log.info("ç´§æ€¥æƒé™ç”³è¯·æäº¤æˆåŠŸ, permissionId: {}", emergencyPermission.getPermissionId());

            return ResponseDTO.ok(emergencyPermission.getPermissionId());

        } catch (Exception e) {
            log.error("ç”³è¯·ç´§æ€¥æƒé™å¤±è´¥", e);
            return ResponseDTO.error("ç”³è¯·å¤±è´¥");
        }
    }

    /**
     * å¿«é€Ÿå®¡æ‰¹ç´§æ€¥æƒé™
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> quickApproveEmergencyPermission(EmergencyApprovalForm approvalForm) {
        try {
            Long permissionId = approvalForm.getPermissionId();

            // 1. è·å–ç´§æ€¥æƒé™è®°å½•
            EmergencyPermissionEntity emergencyPermission = emergencyPermissionDao.selectById(permissionId);
            if (emergencyPermission == null) {
                return ResponseDTO.error("ç´§æ€¥æƒé™ä¸å­˜åœ¨");
            }

            // 2. éªŒè¯å®¡æ‰¹æƒé™
            validateEmergencyApprovalPermission(emergencyPermission, approvalForm.getApproverId());

            // 3. æ›´æ–°å®¡æ‰¹çŠ¶æ€
            emergencyPermission.setStatus(EmergencyStatus.APPROVED);
            emergencyPermission.setApproverId(approvalForm.getApproverId());
            emergencyPermission.setApproveTime(LocalDateTime.now());
            emergencyPermission.setApprovalComment(approvalForm.getComment());

            emergencyPermissionDao.updateById(emergencyPermission);

            // 4. ç«‹å³æˆäºˆæƒé™
            grantEmergencyPermission(emergencyPermission);

            // 5. å‘é€å®¡æ‰¹ç»“æœé€šçŸ¥
            emergencyNotificationService.sendEmergencyApprovalNotification(emergencyPermission);

            log.info("ç´§æ€¥æƒé™å¿«é€Ÿå®¡æ‰¹å®Œæˆ, permissionId: {}", permissionId);

            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("å¿«é€Ÿå®¡æ‰¹ç´§æ€¥æƒé™å¤±è´¥", e);
            return ResponseDTO.error("å®¡æ‰¹å¤±è´¥");
        }
    }

    /**
     * æˆäºˆç´§æ€¥æƒé™
     */
    private void grantEmergencyPermission(EmergencyPermissionEntity emergencyPermission) {
        try {
            // 1. è®¡ç®—æƒé™æœ‰æ•ˆæœŸ
            LocalDateTime validFrom = LocalDateTime.now();
            LocalDateTime validTo = validFrom.plusMinutes(emergencyPermission.getRequestedDuration());

            // 2. åˆ›å»ºä¸´æ—¶æƒé™æˆæƒ
            List<TemporaryPermission> permissions = new ArrayList<>();

            for (Long resourceId : emergencyPermission.getPermissionScope().getResourceIds()) {
                TemporaryPermission permission = TemporaryPermission.builder()
                        .userId(emergencyPermission.getApplicantId())
                        .resourceType(emergencyPermission.getPermissionScope().getResourceType())
                        .resourceId(resourceId)
                        .permissionType(PermissionType.EMERGENCY_ACCESS)
                        .validFrom(validFrom)
                        .validTo(validTo)
                        .sourceId(emergencyPermission.getPermissionId())
                        .sourceType(SourceType.EMERGENCY_PERMISSION)
                        .priority(PermissionPriority.HIGH)
                        .build();
                permissions.add(permission);
            }

            // 3. æ‰¹é‡æˆæƒ
            temporaryPermissionService.batchGrantPermissions(permissions);

            // 4. è®¾ç½®è‡ªåŠ¨è¿‡æœŸä»»åŠ¡
            schedulePermissionExpiration(emergencyPermission.getPermissionId(), validTo);

            // 5. æ›´æ–°ç´§æ€¥æƒé™çŠ¶æ€
            emergencyPermission.setStatus(EmergencyStatus.ACTIVE);
            emergencyPermission.setGrantTime(validFrom);
            emergencyPermission.setExpireTime(validTo);
            emergencyPermissionDao.updateById(emergencyPermission);

            log.info("ç´§æ€¥æƒé™æˆäºˆæˆåŠŸ, permissionId: {}, permissions: {}",
                    emergencyPermission.getPermissionId(), permissions.size());

        } catch (Exception e) {
            log.error("æˆäºˆç´§æ€¥æƒé™å¤±è´¥", e);
            throw new RuntimeException("ç´§æ€¥æƒé™æˆäºˆå¤±è´¥");
        }
    }

    /**
     * è®¾ç½®æƒé™è¿‡æœŸä»»åŠ¡
     */
    private void schedulePermissionExpiration(String permissionId, LocalDateTime expireTime) {
        try {
            // è®¡ç®—å»¶è¿Ÿæ—¶é—´
            long delay = Duration.between(LocalDateTime.now(), expireTime).toMillis();

            // è°ƒåº¦å®šæ—¶ä»»åŠ¡
            TaskScheduler scheduler = getTaskScheduler();
            scheduler.schedule(() -> {
                try {
                    expireEmergencyPermission(permissionId);
                } catch (Exception e) {
                    log.error("ç´§æ€¥æƒé™è¿‡æœŸå¤„ç†å¤±è´¥, permissionId: {}", permissionId, e);
                }
            }, new Date(System.currentTimeMillis() + delay));

        } catch (Exception e) {
            log.error("è®¾ç½®æƒé™è¿‡æœŸä»»åŠ¡å¤±è´¥", e);
        }
    }

    /**
     * è¿‡æœŸç´§æ€¥æƒé™
     */
    @Transactional(rollbackFor = Exception.class)
    public void expireEmergencyPermission(String permissionId) {
        try {
            // 1. è·å–ç´§æ€¥æƒé™è®°å½•
            EmergencyPermissionEntity emergencyPermission = emergencyPermissionDao.selectById(permissionId);
            if (emergencyPermission == null) {
                return;
            }

            // 2. æ’¤é”€ç›¸å…³æƒé™
            temporaryPermissionService.revokePermissionsBySource(
                    permissionId, SourceType.EMERGENCY_PERMISSION);

            // 3. æ›´æ–°çŠ¶æ€
            emergencyPermission.setStatus(EmergencyStatus.EXPIRED);
            emergencyPermission.setExpireTime(LocalDateTime.now());
            emergencyPermissionDao.updateById(emergencyPermission);

            // 4. å‘é€è¿‡æœŸé€šçŸ¥
            emergencyNotificationService.sendEmergencyExpirationNotification(emergencyPermission);

            log.info("ç´§æ€¥æƒé™å·²è¿‡æœŸ, permissionId: {}", permissionId);

        } catch (Exception e) {
            log.error("è¿‡æœŸç´§æ€¥æƒé™å¤±è´¥", e);
        }
    }
}
```

### 4. å·¥ä½œæµæœåŠ¡

#### 4.1 å·¥ä½œæµé…ç½®ç®¡ç†

**åŠŸèƒ½æè¿°**ï¼šå®¡æ‰¹æµç¨‹çš„è®¾è®¡ã€é…ç½®ã€æµ‹è¯•å’Œå‘å¸ƒ

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class WorkflowConfigurationService {

    @Resource
    private WorkflowDefinitionDao workflowDefinitionDao;

    @Resource
    private WorkflowEngine workflowEngine;

    @Resource
    private WorkflowTestService workflowTestService;

    /**
     * è®¾è®¡æ–°çš„å®¡æ‰¹æµç¨‹
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<String> designWorkflow(WorkflowDesignForm designForm) {
        try {
            // 1. éªŒè¯æµç¨‹è®¾è®¡
            validateWorkflowDesign(designForm);

            // 2. åˆ›å»ºå·¥ä½œæµå®šä¹‰
            WorkflowDefinitionEntity definition = WorkflowDefinitionEntity.builder()
                    .definitionId(IdGenerator.generateId())
                    .processKey(designForm.getProcessKey())
                    .processName(designForm.getProcessName())
                    .processVersion(1)
                    .processDescription(designForm.getProcessDescription())
                    .processType(designForm.getProcessType())
                    .category(designForm.getCategory())
                    .bpmnXml(generateBpmnXml(designForm))
                    .status(WorkflowStatus.DRAFT)
                    .createUserId(SmartRequestUtil.getRequestUserId())
                    .createTime(LocalDateTime.now())
                    .build();

            workflowDefinitionDao.insert(definition);

            // 3. ä¿å­˜èŠ‚ç‚¹é…ç½®
            saveWorkflowNodes(definition.getDefinitionId(), designForm.getNodes());

            // 4. ä¿å­˜æµè½¬è§„åˆ™
            saveWorkflowTransitions(definition.getDefinitionId(), designForm.getTransitions());

            // 5. ä¿å­˜æµç¨‹å˜é‡
            saveWorkflowVariables(definition.getDefinitionId(), designForm.getVariables());

            log.info("å·¥ä½œæµè®¾è®¡å®Œæˆ, definitionId: {}", definition.getDefinitionId());

            return ResponseDTO.ok(definition.getDefinitionId());

        } catch (Exception e) {
            log.error("è®¾è®¡å·¥ä½œæµå¤±è´¥", e);
            return ResponseDTO.error("è®¾è®¡å¤±è´¥");
        }
    }

    /**
     * å‘å¸ƒå·¥ä½œæµ
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> publishWorkflow(String definitionId) {
        try {
            // 1. è·å–å·¥ä½œæµå®šä¹‰
            WorkflowDefinitionEntity definition = workflowDefinitionDao.selectById(definitionId);
            if (definition == null) {
                return ResponseDTO.error("å·¥ä½œæµå®šä¹‰ä¸å­˜åœ¨");
            }

            // 2. éªŒè¯å·¥ä½œæµé…ç½®
            validateWorkflowConfiguration(definition);

            // 3. è¿è¡Œæµç¨‹æµ‹è¯•
            WorkflowTestResult testResult = workflowTestService.runWorkflowTest(definition);
            if (!testResult.isSuccess()) {
                return ResponseDTO.error("æµç¨‹æµ‹è¯•å¤±è´¥: " + testResult.getErrorMessage());
            }

            // 4. éƒ¨ç½²å·¥ä½œæµåˆ°å¼•æ“
            ProcessDefinition processDefinition = workflowEngine.deployProcessDefinition(
                    definition.getProcessKey(),
                    definition.getBpmnXml());

            // 5. æ›´æ–°å®šä¹‰çŠ¶æ€
            definition.setStatus(WorkflowStatus.PUBLISHED);
            definition.setDeploymentId(processDefinition.getId());
            definition.setPublishTime(LocalDateTime.now());
            workflowDefinitionDao.updateById(definition);

            // 6. æ¿€æ´»æµç¨‹å®šä¹‰
            workflowEngine.activateProcessDefinition(processDefinition.getId());

            log.info("å·¥ä½œæµå‘å¸ƒæˆåŠŸ, definitionId: {}", definitionId);

            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("å‘å¸ƒå·¥ä½œæµå¤±è´¥", e);
            return ResponseDTO.error("å‘å¸ƒå¤±è´¥");
        }
    }

    /**
     * ç”ŸæˆBPMN XML
     */
    private String generateBpmnXml(WorkflowDesignForm designForm) {
        try {
            // 1. åˆ›å»ºBPMNæ„å»ºå™¨
            BpmnModel bpmnModel = new BpmnModel();
            Process process = new Process();
            process.setId(designForm.getProcessKey());
            process.setName(designForm.getProcessName());

            // 2. æ·»åŠ å¼€å§‹èŠ‚ç‚¹
            StartEvent startEvent = new StartEvent();
            startEvent.setId("start");
            process.addFlowElement(startEvent);

            // 3. æ·»åŠ ç”¨æˆ·ä»»åŠ¡èŠ‚ç‚¹
            for (WorkflowNode node : designForm.getNodes()) {
                if ("userTask".equals(node.getType())) {
                    UserTask userTask = new UserTask();
                    userTask.setId(node.getId());
                    userTask.setName(node.getName());

                    // è®¾ç½®å€™é€‰ç”¨æˆ·/ç»„
                    if (CollectionUtils.isNotEmpty(node.getCandidateUsers())) {
                        userTask.setCandidateUsers(node.getCandidateUsers());
                    }
                    if (CollectionUtils.isNotEmpty(node.getCandidateGroups())) {
                        userTask.setCandidateGroups(node.getCandidateGroups());
                    }

                    process.addFlowElement(userTask);
                }
            }

            // 4. æ·»åŠ ç»“æŸèŠ‚ç‚¹
            EndEvent endEvent = new EndEvent();
            endEvent.setId("end");
            process.addFlowElement(endEvent);

            // 5. æ·»åŠ åºåˆ—æµ
            for (WorkflowTransition transition : designForm.getTransitions()) {
                SequenceFlow sequenceFlow = new SequenceFlow();
                sequenceFlow.setId(transition.getId());
                sequenceFlow.setSourceRef(transition.getSourceRef());
                sequenceFlow.setTargetRef(transition.getTargetRef());

                // æ·»åŠ æ¡ä»¶è¡¨è¾¾å¼
                if (StringUtils.isNotBlank(transition.getConditionExpression())) {
                    sequenceFlow.setConditionExpression(transition.getConditionExpression());
                }

                process.addFlowElement(sequenceFlow);
            }

            bpmnModel.addProcess(process);

            // 6. è½¬æ¢ä¸ºXML
            BpmnXMLConverter converter = new BpmnXMLConverter();
            return converter.convertToXML(bpmnModel);

        } catch (Exception e) {
            log.error("ç”ŸæˆBPMN XMLå¤±è´¥", e);
            throw new RuntimeException("BPMNç”Ÿæˆå¤±è´¥");
        }
    }
}
```

## ğŸ“Š å…³é”®æ€§èƒ½æŒ‡æ ‡

### å®¡æ‰¹æµç¨‹æ€§èƒ½è¦æ±‚

| æŒ‡æ ‡ç±»å‹ | æ€§èƒ½è¦æ±‚ | ç›‘æ§æ–¹æ³• |
|---------|---------|---------|
| æƒé™ç”³è¯·æäº¤å“åº”æ—¶é—´ | â‰¤ 2ç§’ | ç”³è¯·æäº¤è€—æ—¶ç›‘æ§ |
| å®¡æ‰¹æµç¨‹å¤„ç†æ—¶é—´ | â‰¤ 24å°æ—¶ | æµç¨‹å¤„ç†æ—¶æ•ˆç»Ÿè®¡ |
| ç´§æ€¥å®¡æ‰¹å¤„ç†æ—¶é—´ | â‰¤ 30åˆ†é’Ÿ | ç´§æ€¥å®¡æ‰¹å“åº”ç›‘æ§ |
| æƒé™ç”Ÿæ•ˆå»¶è¿Ÿ | â‰¤ 1åˆ†é’Ÿ | æƒé™ç”Ÿæ•ˆæ—¶æ•ˆæ£€æŸ¥ |
| å®¡æ‰¹é€šçŸ¥å‘é€å»¶è¿Ÿ | â‰¤ 30ç§’ | é€šçŸ¥å‘é€æ—¶æ•ˆç›‘æ§ |
| è®¿å®¢ç­¾åˆ°å¤„ç†æ—¶é—´ | â‰¤ 3ç§’ | ç­¾åˆ°æ“ä½œå“åº”æ—¶é—´ |

### ç³»ç»Ÿå®¹é‡æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | è®¾è®¡å®¹é‡ | è¯´æ˜ |
|---------|---------|------|
| æ—¥å‡æƒé™ç”³è¯·é‡ | 10,000æ¡/å¤© | æƒé™ç”³è¯·æ—¥å¸¸å¤„ç†èƒ½åŠ› |
| å¹¶å‘å®¡æ‰¹ç”¨æˆ·æ•° | 500ç”¨æˆ· | åŒæ—¶è¿›è¡Œå®¡æ‰¹æ“ä½œç”¨æˆ·æ•° |
| è®¿å®¢é¢„çº¦å¤„ç†é‡ | 5,000æ¬¡/å¤© | è®¿å®¢é¢„çº¦æ—¥å¸¸å¤„ç†é‡ |
| ç´§æ€¥æƒé™å¤„ç†é‡ | 100æ¬¡/å°æ—¶ | ç´§æ€¥æƒé™æ¯å°æ—¶å¤„ç†èƒ½åŠ› |
| å·¥ä½œæµå®ä¾‹æ•° | 50,000ä¸ª | æ´»è·ƒå·¥ä½œæµå®ä¾‹æ•°é‡ |
| å®¡æ‰¹å†å²ä¿ç•™æœŸ | 5å¹´ | å®¡æ‰¹å†å²æ•°æ®åœ¨çº¿ä¿ç•™æœŸ |

## ğŸ”— ç›¸å…³æ–‡æ¡£

### æŠ€æœ¯å®ç°æ–‡æ¡£
- [é—¨ç¦ç®¡ç†ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡](./ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡.md) - å®Œæ•´çš„ç³»ç»Ÿæ¶æ„è®¾è®¡
- [æƒé™ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡](./æƒé™ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡.md) - æƒé™ç®¡ç†æŠ€æœ¯å®ç°
- [åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡](./åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡.md) - åŒºåŸŸæƒé™ç®¡ç†è®¾è®¡

### å·¥ä½œæµæ–‡æ¡£
- [å·¥ä½œæµå¼•æ“è®¾è®¡](./å·¥ä½œæµå¼•æ“è®¾è®¡.md) - å·¥ä½œæµå¼•æ“æŠ€æœ¯æ¶æ„
- [å®¡æ‰¹è§„åˆ™å¼•æ“è®¾è®¡](./å®¡æ‰¹è§„åˆ™å¼•æ“è®¾è®¡.md) - å®¡æ‰¹è§„åˆ™å’Œè·¯ç”±å¼•æ“
- [BPMNæµç¨‹è®¾è®¡æŒ‡å—](./BPMNæµç¨‹è®¾è®¡æŒ‡å—.md) - BPMNæµç¨‹è®¾è®¡è§„èŒƒ

### é›†æˆéƒ¨ç½²æ–‡æ¡£
- [é€šçŸ¥ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ](./é€šçŸ¥ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ.md) - å¤šæ¸ é“é€šçŸ¥é›†æˆæ–¹æ¡ˆ
- [ç§»åŠ¨ç«¯å®¡æ‰¹æ–¹æ¡ˆ](./ç§»åŠ¨ç«¯å®¡æ‰¹æ–¹æ¡ˆ.md) - ç§»åŠ¨ç«¯å®¡æ‰¹åŠŸèƒ½å®ç°
- [ç³»ç»Ÿé›†æˆAPIæ–‡æ¡£](./ç³»ç»Ÿé›†æˆAPIæ–‡æ¡£.md) - å¤–éƒ¨ç³»ç»Ÿé›†æˆæ¥å£

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™æ€»ç»“

1. **æµç¨‹è§„èŒƒåŒ–** - æ ‡å‡†åŒ–çš„å®¡æ‰¹æµç¨‹ç¡®ä¿æƒé™ç®¡ç†çš„è§„èŒƒæ€§
2. **çµæ´»è·¯ç”±æœºåˆ¶** - åŸºäºè§„åˆ™çš„æ™ºèƒ½å®¡æ‰¹è·¯ç”±å’Œè½¬äº¤
3. **ç´§æ€¥å“åº”æœºåˆ¶** - ç´§æ€¥æƒ…å†µä¸‹çš„å¿«é€Ÿå®¡æ‰¹å’Œä¸´æ—¶æˆæƒ
4. **è®¿å®¢å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†** - å®Œæ•´çš„è®¿å®¢é¢„çº¦ã€å®¡æ ¸ã€æˆæƒã€æ³¨é”€æµç¨‹
5. **å¯è§†åŒ–æµç¨‹è®¾è®¡** - æ‹–æ‹½å¼æµç¨‹è®¾è®¡é™ä½é…ç½®å¤æ‚åº¦

## ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯

- æœ¬æ–‡æ¡£åŸºäºå·¥ä½œæµç®¡ç†æœ€ä½³å®è·µè®¾è®¡
- å®¡æ‰¹æµç¨‹ç®¡ç†æ¨¡å—è®¾è®¡è´Ÿè´£äººï¼šSmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
- åˆ›å»ºæ—¥æœŸï¼š2025-11-13
- ä¸‹æ¬¡è¯„å®¡ï¼š2026-02-13

---

**ğŸ¯ IOE-DREAMé—¨ç¦å®¡æ‰¹æµç¨‹ç®¡ç†æ¨¡å— - è§„èŒƒå®¡æ‰¹ã€æ™ºèƒ½è·¯ç”±ã€ç´§æ€¥å“åº”ã€å…¨æµç¨‹ç®¡ç†çš„ä¼ä¸šçº§å·¥ä½œæµè§£å†³æ–¹æ¡ˆ**