# é—¨ç¦åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡

> **ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¶é—´**: 2025-11-13
> **åˆ†ç±»**: æ ¸å¿ƒåŠŸèƒ½æ¨¡å— > ä¼ä¸šOAç³»ç»Ÿ > é—¨ç¦ç®¡ç†ç³»ç»Ÿ
> **æ ‡ç­¾**: ["é—¨ç¦ç³»ç»Ÿ", "åŒºåŸŸç®¡ç†", "æƒé™åˆ†é…", "ç©ºé—´ç®¡ç†", "æƒé™ç»§æ‰¿"]
> **ä½œè€…**: SmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
> **æè¿°**: IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°é—¨ç¦ç®¡ç†ç³»ç»Ÿçš„åŒºåŸŸç©ºé—´ç®¡ç†å’Œæƒé™åˆ†é…æ¨¡å—è¯¦ç»†æŠ€æœ¯è®¾è®¡

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### æ ¸å¿ƒå®šä½

**é—¨ç¦åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—**æ˜¯IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°çš„é‡è¦ä¸šåŠ¡æ¨¡å—ï¼ŒåŸºäºå…¬å…±åŒºåŸŸæ¨¡å—ç»Ÿä¸€ç»´æŠ¤ï¼Œä¸»è¦è´Ÿè´£é—¨ç¦ç³»ç»Ÿä¸­çš„åŒºåŸŸä¿¡æ¯ç®¡ç†ã€é—¨ç¦æƒé™åˆ†é…ã€äººå‘˜æƒé™ç®¡ç†å’ŒåŒºåŸŸé€šè¡Œç›‘æ§ã€‚æ¨¡å—é‡‡ç”¨æƒé™è‡ªåŠ¨åˆ†é…æœºåˆ¶ï¼Œå®ç°åŒºåŸŸã€äººå‘˜ã€é—¨çš„é«˜æ•ˆæƒé™ç®¡ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **ç»Ÿä¸€åŒºåŸŸç®¡ç†**ï¼šåŸºäºå…¬å…±åŒºåŸŸæ¨¡å—çš„ç»Ÿä¸€åŒºåŸŸä¿¡æ¯ç»´æŠ¤
- âœ… **æ™ºèƒ½æƒé™åˆ†é…**ï¼šæ–°å¢é—¨/äººå‘˜æ—¶è‡ªåŠ¨åˆ†é…é€šè¡Œæƒé™
- âœ… **æƒé™ç»§æ‰¿æœºåˆ¶**ï¼šäººå‘˜ç»§æ‰¿é—¨æƒé™ï¼Œé—¨ç»§æ‰¿äººå‘˜æƒé™
- âœ… **å®æ—¶åŒºåŸŸç›‘æ§**ï¼šè®¾å¤‡çŠ¶æ€ã€äººå‘˜é€šè¡Œã€åŒºåŸŸå®¹é‡ç›‘æ§
- âœ… **æƒé™çŸ©é˜µç®¡ç†**ï¼šç›´è§‚çš„äººå‘˜-é—¨æƒé™å…³ç³»ç®¡ç†
- âœ… **è®¾å¤‡ä¾èµ–éªŒè¯**ï¼šé—¨ç®¡ç†ä¾èµ–è®¾å¤‡ç®¡ç†çš„åŒºåŸŸå…³è”
- âœ… **æ•°æ®ä¸€è‡´æ€§ä¿éšœ**ï¼šæƒé™å˜æ›´å®æ—¶åŒæ­¥å’Œä¸€è‡´æ€§æ£€æŸ¥

## ğŸ—ï¸ åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—æ¶æ„è®¾è®¡

### æ¨¡å—åŠŸèƒ½æ¶æ„å›¾

```mermaid
graph TB
    subgraph "é—¨ç¦åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—æ¶æ„"
        subgraph "ç”¨æˆ·äº¤äº’å±‚"
            AM[åŒºåŸŸç®¡ç†ç•Œé¢]
            DM[é—¨ç®¡ç†ç•Œé¢]
            PM[äººå‘˜ç®¡ç†ç•Œé¢]
            AUTHM[æƒé™ç®¡ç†ç•Œé¢]
            MON[ç›‘æ§ç•Œé¢]
        end

        subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
            subgraph "æ ¸å¿ƒä¸šåŠ¡æœåŠ¡"
                AS[åŒºåŸŸä¿¡æ¯æœåŠ¡]
                DS[é—¨ç®¡ç†æœåŠ¡]
                PS[äººå‘˜ç®¡ç†æœåŠ¡]
                AUS[æƒé™ç®¡ç†æœåŠ¡]
                MS[ç›‘æ§æœåŠ¡]
            end

            subgraph "æƒé™å¼•æ“"
                AA[è‡ªåŠ¨åˆ†é…å¼•æ“]
                PE[æƒé™è¯„ä¼°å¼•æ“]
                IE[ç»§æ‰¿å¼•æ“]
                VE[éªŒè¯å¼•æ“]
            end
        end

        subgraph "æ•°æ®è®¿é—®å±‚"
            AD[åŒºåŸŸæ•°æ®è®¿é—®]
            DD[é—¨æ•°æ®è®¿é—®]
            PD[äººå‘˜æ•°æ®è®¿é—®]
            AUD[æƒé™æ•°æ®è®¿é—®]
            MD[ç›‘æ§æ•°æ®è®¿é—®]
        end

        subgraph "å¤–éƒ¨é›†æˆå±‚"
            CDM[å…¬å…±åŒºåŸŸæ¨¡å—]
            DEV_M[è®¾å¤‡ç®¡ç†æ¨¡å—]
            PERSON_M[äººå‘˜ç®¡ç†æ¨¡å—]
            BIO_M[ç”Ÿç‰©è¯†åˆ«æ¨¡å—]
        end
    end

    AM --> AS
    DM --> DS
    PM --> PS
    AUTHM --> AUS
    MON --> MS

    AS --> AA
    DS --> IE
    PS --> AA
    AUS --> PE

    AA --> AD
    IE --> DD
    PE --> AUD
    VE --> PD

    AS --> CDM
    DS --> DEV_M
    PS --> PERSON_M
    AUS --> BIO_M
```

### åŒºåŸŸç©ºé—´ç®¡ç†æ ¸å¿ƒæµç¨‹è®¾è®¡

```mermaid
graph TB
    AreaStart(åŒºåŸŸç®¡ç†å¼€å§‹) --> AreaChoose{é€‰æ‹©æ“ä½œç±»å‹}

    AreaChoose -->|åŒºåŸŸä¿¡æ¯ç®¡ç†| AreaManage
    AreaChoose -->|é—¨ç®¡ç†| DoorManage
    AreaChoose -->|äººå‘˜ç®¡ç†| PersonManage
    AreaChoose -->|æƒé™ç®¡ç†| AuthManage
    AreaChoose -->|åŒºåŸŸç›‘æ§| AreaMonitor

    subgraph åŒºåŸŸä¿¡æ¯ç®¡ç†æµç¨‹
        AreaManage --> SelectArea[é€‰æ‹©åŒºåŸŸ]
        SelectArea --> AreaInfo{åŒºåŸŸä¿¡æ¯æ“ä½œ}
        AreaInfo -->|æŸ¥è¯¢| AreaQuery[æŸ¥è¯¢åŒºåŸŸä¿¡æ¯]
        AreaInfo -->|ä¿®æ”¹| AreaEdit[ä¿®æ”¹åŒºåŸŸä¿¡æ¯]
        AreaQuery --> AreaSummary[æŸ¥çœ‹åŒºåŸŸæ¦‚è§ˆ]
        AreaEdit --> AreaSummary
        AreaSummary --> AreaEnd[åŒºåŸŸä¿¡æ¯ç®¡ç†å®Œæˆ]
    end

    subgraph é—¨ç®¡ç†æµç¨‹
        DoorManage --> SelectDoorArea[é€‰æ‹©åŒºåŸŸ]
        SelectDoorArea --> CheckAreaDevice{æ£€æŸ¥åŒºåŸŸè®¾å¤‡}
        CheckAreaDevice -->|æ— è®¾å¤‡| DoorNoDevice[æç¤ºï¼šè¯·å…ˆåœ¨è®¾å¤‡ç®¡ç†ä¸­æ·»åŠ è®¾å¤‡åˆ°åŒºåŸŸ]
        CheckAreaDevice -->|æœ‰è®¾å¤‡| ViewAreaDoors[æŸ¥çœ‹åŒºåŸŸé—¨åˆ—è¡¨]
        ViewAreaDoors --> DoorOperation{é—¨æ“ä½œç±»å‹}
        DoorOperation -->|æ–°å¢é—¨| AddDoor[æ–°å¢é—¨]
        DoorOperation -->|ç¼–è¾‘é—¨| EditDoor[ç¼–è¾‘é—¨ä¿¡æ¯]
        DoorOperation -->|åˆ é™¤é—¨| DeleteDoor[åˆ é™¤é—¨]
        AddDoor --> DoorConfig[é…ç½®é—¨å‚æ•°]
        DoorConfig --> AutoAuthPerson[è‡ªåŠ¨åˆ†é…æƒé™ç»™åŒºåŸŸäººå‘˜]
        AutoAuthPerson --> SaveDoor[ä¿å­˜é—¨ä¿¡æ¯]
        SaveDoor --> DoorEnd[é—¨ç®¡ç†å®Œæˆ]
        EditDoor --> DoorEnd
        DeleteDoor --> DoorEnd
        DoorNoDevice --> DoorEnd
    end

    subgraph äººå‘˜ç®¡ç†æµç¨‹
        PersonManage --> SelectPersonArea[é€‰æ‹©åŒºåŸŸ]
        SelectPersonArea --> ViewAreaPersons[æŸ¥çœ‹åŒºåŸŸäººå‘˜åˆ—è¡¨]
        ViewAreaPersons --> PersonOperation{äººå‘˜æ“ä½œç±»å‹}
        PersonOperation -->|æ–°å¢äººå‘˜| AddPerson[æ–°å¢äººå‘˜åˆ°åŒºåŸŸ]
        PersonOperation -->|ç¼–è¾‘äººå‘˜| EditPerson[ç¼–è¾‘äººå‘˜ä¿¡æ¯]
        PersonOperation -->|ç§»é™¤äººå‘˜| RemovePerson[ç§»é™¤äººå‘˜]
        AddPerson --> PersonConfig[é…ç½®äººå‘˜ä¿¡æ¯]
        PersonConfig --> AutoAuthDoor[è‡ªåŠ¨åˆ†é…åŒºåŸŸæ‰€æœ‰é—¨æƒé™]
        AutoAuthDoor --> SavePerson[ä¿å­˜äººå‘˜ä¿¡æ¯]
        SavePerson --> PersonEnd[äººå‘˜ç®¡ç†å®Œæˆ]
        EditPerson --> PersonEnd
        RemovePerson --> PersonEnd
    end

    subgraph æƒé™ç®¡ç†æµç¨‹
        AuthManage --> SelectAuthArea[é€‰æ‹©åŒºåŸŸ]
        SelectAuthArea --> AuthView{æƒé™æŸ¥çœ‹}
        AuthView --> PersonDoorAuth[äººå‘˜-é—¨æƒé™å…³ç³»]
        AuthView --> ViewAreaDoors2[æŸ¥çœ‹åŒºåŸŸé—¨åˆ—è¡¨]
        AuthView --> ViewAreaPersons2[æŸ¥çœ‹åŒºåŸŸäººå‘˜åˆ—è¡¨]
        PersonDoorAuth --> AuthOperation{æƒé™æ“ä½œ}
        AuthOperation -->|æƒé™è°ƒæ•´| AdjustAuth[è°ƒæ•´äººå‘˜é—¨æƒé™]
        AuthOperation -->|æƒé™å›æ”¶| RevokeAuth[å›æ”¶äººå‘˜æƒé™]
        AuthOperation -->|æ‰¹é‡æƒé™| BatchAuth[æ‰¹é‡æƒé™æ“ä½œ]
        AdjustAuth --> AuthUpdate[æ›´æ–°æƒé™é…ç½®]
        RevokeAuth --> AuthUpdate
        BatchAuth --> AuthUpdate
        AuthUpdate --> AuthEnd[æƒé™ç®¡ç†å®Œæˆ]
    end

    subgraph åŒºåŸŸç›‘æ§æµç¨‹
        AreaMonitor --> SelectMonitorArea[é€‰æ‹©åŒºåŸŸ]
        SelectMonitorArea --> MonitorType{ç›‘æ§ç±»å‹}
        MonitorType -->|è®¾å¤‡çŠ¶æ€| DeviceMonitor[ç›‘æ§åŒºåŸŸè®¾å¤‡çŠ¶æ€]
        MonitorType -->|äººå‘˜é€šè¡Œ| AccessMonitor[ç›‘æ§äººå‘˜é€šè¡Œè®°å½•]
        MonitorType -->|åŒºåŸŸå®¹é‡| CapacityMonitor[ç›‘æ§åŒºåŸŸå®¹é‡]
        MonitorType -->|é—¨çŠ¶æ€| DoorMonitor[ç›‘æ§é—¨çŠ¶æ€]
        DeviceMonitor --> DeviceAlert[è®¾å¤‡å¼‚å¸¸å‘Šè­¦]
        AccessMonitor --> AccessLog[é€šè¡Œè®°å½•ç»Ÿè®¡]
        CapacityMonitor --> CapacityAlert[å®¹é‡è¶…é™å‘Šè­¦]
        DoorMonitor --> DoorStatusLog[é—¨çŠ¶æ€æ—¥å¿—]
        DeviceAlert --> MonitorEnd[åŒºåŸŸç›‘æ§å®Œæˆ]
        AccessLog --> MonitorEnd
        CapacityAlert --> MonitorEnd
        DoorStatusLog --> MonitorEnd
    end
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯¦ç»†è®¾è®¡

### 1. æƒé™è‡ªåŠ¨åˆ†é…å¼•æ“

#### 1.1 æƒé™è‡ªåŠ¨åˆ†é…æœºåˆ¶

**åŠŸèƒ½æè¿°**ï¼šæ–°å¢é—¨æˆ–äººå‘˜æ—¶è‡ªåŠ¨åˆ†é…é€šè¡Œæƒé™

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class AutoPermissionAllocationService {

    @Resource
    private AreaPermissionService areaPermissionService;

    @Resource
    private DoorPermissionService doorPermissionService;

    @Resource
    private PersonPermissionService personPermissionService;

    /**
     * æ–°å¢é—¨åè‡ªåŠ¨åˆ†é…æƒé™ç»™åŒºåŸŸäººå‘˜
     */
    @EventListener
    @Async
    @Transactional(rollbackFor = Exception.class)
    public void handleDoorAddedEvent(DoorAddedEvent event) {
        try {
            Long doorId = event.getDoorId();
            Long areaId = event.getAreaId();

            // 1. è·å–åŒºåŸŸå†…æ‰€æœ‰äººå‘˜
            List<Long> areaPersonIds = areaPermissionService
                    .getAreaPersonIds(areaId);

            if (CollectionUtils.isEmpty(areaPersonIds)) {
                log.info("åŒºåŸŸ{}æš‚æ— äººå‘˜ï¼Œè·³è¿‡æƒé™è‡ªåŠ¨åˆ†é…", areaId);
                return;
            }

            // 2. æ‰¹é‡ä¸ºäººå‘˜åˆ†é…é—¨æƒé™
            List<PersonDoorPermission> permissions = new ArrayList<>();
            for (Long personId : areaPersonIds) {
                PersonDoorPermission permission = PersonDoorPermission.builder()
                        .personId(personId)
                        .doorId(doorId)
                        .areaId(areaId)
                        .permissionType(PermissionType.ACCESS)
                        .validFrom(LocalDateTime.now())
                        .validTo(LocalDateTime.now().plusYears(10)) // é»˜è®¤10å¹´æœ‰æ•ˆæœŸ
                        .allocationType(AllocationType.AUTO) // è‡ªåŠ¨åˆ†é…æ ‡è®°
                        .createTime(LocalDateTime.now())
                        .build();
                permissions.add(permission);
            }

            // 3. æ‰¹é‡ä¿å­˜æƒé™
            doorPermissionService.batchAddPermissions(permissions);

            log.info("é—¨æƒé™è‡ªåŠ¨åˆ†é…å®Œæˆ, doorId: {}, åˆ†é…æƒé™æ•°: {}",
                    doorId, permissions.size());

        } catch (Exception e) {
            log.error("é—¨æƒé™è‡ªåŠ¨åˆ†é…å¤±è´¥", e);
            throw new RuntimeException("æƒé™è‡ªåŠ¨åˆ†é…å¤±è´¥");
        }
    }

    /**
     * æ–°å¢äººå‘˜åè‡ªåŠ¨åˆ†é…åŒºåŸŸé—¨æƒé™
     */
    @EventListener
    @Async
    @Transactional(rollbackFor = Exception.class)
    public void handlePersonAddedEvent(PersonAddedEvent event) {
        try {
            Long personId = event.getPersonId();
            Long areaId = event.getAreaId();

            // 1. è·å–åŒºåŸŸå†…æ‰€æœ‰é—¨
            List<Long> areaDoorIds = areaPermissionService
                    .getAreaDoorIds(areaId);

            if (CollectionUtils.isEmpty(areaDoorIds)) {
                log.info("åŒºåŸŸ{}æš‚æ— é—¨ï¼Œè·³è¿‡æƒé™è‡ªåŠ¨åˆ†é…", areaId);
                return;
            }

            // 2. æ‰¹é‡ä¸ºäººå‘˜åˆ†é…é—¨æƒé™
            List<PersonDoorPermission> permissions = new ArrayList<>();
            for (Long doorId : areaDoorIds) {
                PersonDoorPermission permission = PersonDoorPermission.builder()
                        .personId(personId)
                        .doorId(doorId)
                        .areaId(areaId)
                        .permissionType(PermissionType.ACCESS)
                        .validFrom(LocalDateTime.now())
                        .validTo(LocalDateTime.now().plusYears(10))
                        .allocationType(AllocationType.AUTO)
                        .createTime(LocalDateTime.now())
                        .build();
                permissions.add(permission);
            }

            // 3. æ‰¹é‡ä¿å­˜æƒé™
            doorPermissionService.batchAddPermissions(permissions);

            log.info("äººå‘˜æƒé™è‡ªåŠ¨åˆ†é…å®Œæˆ, personId: {}, åˆ†é…æƒé™æ•°: {}",
                    personId, permissions.size());

        } catch (Exception e) {
            log.error("äººå‘˜æƒé™è‡ªåŠ¨åˆ†é…å¤±è´¥", e);
            throw new RuntimeException("æƒé™è‡ªåŠ¨åˆ†é…å¤±è´¥");
        }
    }
}
```

#### 1.2 æƒé™ç»§æ‰¿å¼•æ“

**åŠŸèƒ½æè¿°**ï¼šå¤„ç†æƒé™ç»§æ‰¿é€»è¾‘å’Œæƒé™ä¼ é€’

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class PermissionInheritanceService {

    /**
     * è®¡ç®—åŒºåŸŸäººå‘˜ç»§æ‰¿çš„é—¨æƒé™
     */
    public List<InheritedPermission> calculateInheritedPermissions(Long areaId) {
        try {
            List<InheritedPermission> inheritedPermissions = new ArrayList<>();

            // 1. è·å–åŒºåŸŸåŸºç¡€æƒé™é…ç½®
            AreaPermissionConfig areaConfig = areaPermissionService
                    .getAreaPermissionConfig(areaId);

            // 2. è·å–åŒºåŸŸå†…æ‰€æœ‰é—¨
            List<DoorEntity> areaDoors = doorService.getDoorsByArea(areaId);

            // 3. è®¡ç®—æ¯ä¸ªé—¨çš„ç»§æ‰¿æƒé™
            for (DoorEntity door : areaDoors) {
                InheritedPermission permission = InheritedPermission.builder()
                        .areaId(areaId)
                        .doorId(door.getDoorId())
                        .doorName(door.getDoorName())
                        .inheritanceType(InheritanceType.AREA_BASED)
                        .accessTimeRanges(areaConfig.getTimeRanges())
                        .accessLevels(areaConfig.getAccessLevels())
                        .verificationMethods(areaConfig.getVerificationMethods())
                        .build();
                inheritedPermissions.add(permission);
            }

            return inheritedPermissions;

        } catch (Exception e) {
            log.error("è®¡ç®—ç»§æ‰¿æƒé™å¤±è´¥, areaId: {}", areaId, e);
            return Collections.emptyList();
        }
    }

    /**
     * åº”ç”¨æƒé™ç»§æ‰¿è§„åˆ™
     */
    @Transactional(rollbackFor = Exception.class)
    public void applyInheritanceRules(Long areaId) {
        try {
            // 1. æ¸…é™¤ç°æœ‰çš„è‡ªåŠ¨åˆ†é…æƒé™
            doorPermissionService.clearAutoPermissions(areaId);

            // 2. è®¡ç®—æ–°çš„ç»§æ‰¿æƒé™
            List<InheritedPermission> inheritedPermissions =
                    calculateInheritedPermissions(areaId);

            // 3. è·å–åŒºåŸŸå†…æ‰€æœ‰äººå‘˜
            List<Long> areaPersonIds = areaPermissionService
                    .getAreaPersonIds(areaId);

            // 4. ä¸ºæ¯ä¸ªäººå‘˜åº”ç”¨ç»§æ‰¿æƒé™
            for (Long personId : areaPersonIds) {
                applyPersonInheritance(personId, inheritedPermissions);
            }

            log.info("æƒé™ç»§æ‰¿è§„åˆ™åº”ç”¨å®Œæˆ, areaId: {}", areaId);

        } catch (Exception e) {
            log.error("åº”ç”¨æƒé™ç»§æ‰¿è§„åˆ™å¤±è´¥, areaId: {}", areaId, e);
            throw new RuntimeException("ç»§æ‰¿è§„åˆ™åº”ç”¨å¤±è´¥");
        }
    }

    /**
     * ä¸ºä¸ªäººåº”ç”¨ç»§æ‰¿æƒé™
     */
    private void applyPersonInheritance(Long personId,
                                       List<InheritedPermission> inheritedPermissions) {
        List<PersonDoorPermission> permissions = new ArrayList<>();

        for (InheritedPermission inherited : inheritedPermissions) {
            PersonDoorPermission permission = PersonDoorPermission.builder()
                    .personId(personId)
                    .doorId(inherited.getDoorId())
                    .areaId(inherited.getAreaId())
                    .permissionType(PermissionType.INHERITED)
                    .validFrom(inherited.getValidFrom())
                    .validTo(inherited.getValidTo())
                    .timeRanges(inherited.getAccessTimeRanges())
                    .accessLevels(inherited.getAccessLevels())
                    .verificationMethods(inherited.getVerificationMethods())
                    .allocationType(AllocationType.INHERITED)
                    .createTime(LocalDateTime.now())
                    .build();
            permissions.add(permission);
        }

        doorPermissionService.batchAddPermissions(permissions);
    }
}
```

### 2. åŒºåŸŸä¿¡æ¯æœåŠ¡

#### 2.1 åŒºåŸŸæ¦‚è§ˆæœåŠ¡

**åŠŸèƒ½æè¿°**ï¼šæä¾›åŒºåŸŸç»¼åˆæ¦‚è§ˆå’Œç»Ÿè®¡ä¿¡æ¯

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class AreaOverviewService {

    @Resource
    private AreaDao areaDao;

    @Resource
    private DoorService doorService;

    @Resource
    private DeviceService deviceService;

    @Resource
    private PersonPermissionService personPermissionService;

    /**
     * è·å–åŒºåŸŸæ¦‚è§ˆä¿¡æ¯
     */
    public AreaOverviewVO getAreaOverview(Long areaId) {
        try {
            // 1. è·å–åŒºåŸŸåŸºæœ¬ä¿¡æ¯
            AreaEntity area = areaDao.selectById(areaId);
            if (area == null) {
                throw new BusinessException("åŒºåŸŸä¸å­˜åœ¨");
            }

            // 2. ç»Ÿè®¡åŒºåŸŸå„é¡¹æ•°æ®
            AreaOverviewVO overview = AreaOverviewVO.builder()
                    .areaId(areaId)
                    .areaName(area.getAreaName())
                    .areaType(area.getAreaType())
                    .build();

            // 3. ç»Ÿè®¡é—¨æ•°é‡
            long doorCount = doorService.countByArea(areaId);
            overview.setDoorCount(doorCount);

            // 4. ç»Ÿè®¡è®¾å¤‡æ•°é‡
            long deviceCount = deviceService.countByArea(areaId);
            overview.setDeviceCount(deviceCount);

            // 5. ç»Ÿè®¡äººå‘˜æ•°é‡
            long personCount = personPermissionService.countAreaPersons(areaId);
            overview.setPersonCount(personCount);

            // 6. ç»Ÿè®¡æƒé™é…ç½®æ•°é‡
            long permissionCount = personPermissionService
                    .countAreaPermissions(areaId);
            overview.setPermissionCount(permissionCount);

            // 7. ç»Ÿè®¡ä»Šæ—¥é€šè¡Œè®°å½•
            long todayAccessCount = accessEventService
                    .countTodayAccessByArea(areaId);
            overview.setTodayAccessCount(todayAccessCount);

            // 8. è·å–åŒºåŸŸè®¾å¤‡çŠ¶æ€ç»Ÿè®¡
            DeviceStatusStatistics deviceStats = deviceService
                    .getDeviceStatisticsByArea(areaId);
            overview.setDeviceStatusStats(deviceStats);

            // 9. è·å–åŒºåŸŸå®¹é‡ç›‘æ§
            AreaCapacityMonitor capacityMonitor = capacityMonitorService
                    .getCapacityMonitor(areaId);
            overview.setCapacityMonitor(capacityMonitor);

            return overview;

        } catch (Exception e) {
            log.error("è·å–åŒºåŸŸæ¦‚è§ˆå¤±è´¥, areaId: {}", areaId, e);
            throw new BusinessException("è·å–åŒºåŸŸæ¦‚è§ˆå¤±è´¥");
        }
    }

    /**
     * è·å–åŒºåŸŸæƒé™é…ç½®æ¦‚è§ˆ
     */
    public AreaPermissionOverviewVO getPermissionOverview(Long areaId) {
        try {
            // 1. è·å–åŒºåŸŸæƒé™é…ç½®
            AreaPermissionConfig config = areaPermissionService
                    .getPermissionConfig(areaId);

            // 2. ç»Ÿè®¡æƒé™åˆ†é…æƒ…å†µ
            PermissionAllocationStats allocationStats = PermissionAllocationStats.builder()
                    .autoAllocatedCount(doorPermissionService
                            .countAutoPermissions(areaId))
                    .manualAllocatedCount(doorPermissionService
                            .countManualPermissions(areaId))
                    .inheritedCount(doorPermissionService
                            .countInheritedPermissions(areaId))
                    .build();

            // 3. ç»Ÿè®¡æƒé™ç±»å‹åˆ†å¸ƒ
            List<PermissionTypeDistribution> typeDistributions =
                    doorPermissionService.getPermissionTypeDistribution(areaId);

            return AreaPermissionOverviewVO.builder()
                    .areaId(areaId)
                    .permissionConfig(config)
                    .allocationStats(allocationStats)
                    .typeDistributions(typeDistributions)
                    .build();

        } catch (Exception e) {
            log.error("è·å–åŒºåŸŸæƒé™æ¦‚è§ˆå¤±è´¥, areaId: {}", areaId, e);
            throw new BusinessException("è·å–æƒé™æ¦‚è§ˆå¤±è´¥");
        }
    }
}
```

### 3. é—¨ç®¡ç†æœåŠ¡

#### 3.1 é—¨ä¿¡æ¯æœåŠ¡

**åŠŸèƒ½æè¿°**ï¼šåŒºåŸŸå†…é—¨çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Transactional(rollbackFor = Exception.class)
@Slf4j
public class AreaDoorManagementService {

    @Resource
    private DoorDao doorDao;

    @Resource
    private AreaDao areaDao;

    @Resource
    private DeviceService deviceService;

    @Resource
    private AutoPermissionAllocationService autoPermissionService;

    /**
     * åœ¨åŒºåŸŸå†…æ–°å¢é—¨
     */
    public ResponseDTO<Long> addDoorToArea(DoorAddForm addForm) {
        try {
            // 1. éªŒè¯åŒºåŸŸå­˜åœ¨
            AreaEntity area = areaDao.selectById(addForm.getAreaId());
            if (area == null) {
                return ResponseDTO.error("åŒºåŸŸä¸å­˜åœ¨");
            }

            // 2. æ£€æŸ¥åŒºåŸŸæ˜¯å¦æœ‰å…³è”è®¾å¤‡
            List<DeviceInfo> areaDevices = deviceService
                    .getDevicesByArea(addForm.getAreaId());
            if (CollectionUtils.isEmpty(areaDevices)) {
                return ResponseDTO.error("åŒºåŸŸæš‚æ— å…³è”è®¾å¤‡ï¼Œè¯·å…ˆåœ¨è®¾å¤‡ç®¡ç†ä¸­æ·»åŠ è®¾å¤‡åˆ°åŒºåŸŸ");
            }

            // 3. æ£€æŸ¥é—¨åç§°å”¯ä¸€æ€§
            if (doorDao.existsByNameAndArea(addForm.getDoorName(), addForm.getAreaId())) {
                return ResponseDTO.error("é—¨åç§°å·²å­˜åœ¨");
            }

            // 4. åˆ›å»ºé—¨è®°å½•
            DoorEntity door = DoorEntity.builder()
                    .doorName(addForm.getDoorName())
                    .areaId(addForm.getAreaId())
                    .deviceId(addForm.getDeviceId())
                    .doorType(addForm.getDoorType())
                    .verificationMethods(addForm.getVerificationMethods())
                    .accessTimeRanges(addForm.getAccessTimeRanges())
                    .accessLevels(addForm.getAccessLevels())
                    .description(addForm.getDescription())
                    .enabledFlag(true)
                    .createTime(LocalDateTime.now())
                    .build();

            doorDao.insert(door);

            // 5. å‘å¸ƒé—¨æ–°å¢äº‹ä»¶ï¼Œè§¦å‘æƒé™è‡ªåŠ¨åˆ†é…
            DoorAddedEvent event = DoorAddedEvent.builder()
                    .doorId(door.getDoorId())
                    .doorName(door.getDoorName())
                    .areaId(addForm.getAreaId())
                    .createTime(LocalDateTime.now())
                    .build();
            applicationEventPublisher.publishEvent(event);

            log.info("åŒºåŸŸé—¨æ·»åŠ æˆåŠŸ, areaId: {}, doorId: {}",
                    addForm.getAreaId(), door.getDoorId());

            return ResponseDTO.ok(door.getDoorId());

        } catch (Exception e) {
            log.error("åŒºåŸŸé—¨æ·»åŠ å¤±è´¥", e);
            return ResponseDTO.error("æ·»åŠ å¤±è´¥");
        }
    }

    /**
     * è·å–åŒºåŸŸé—¨åˆ—è¡¨
     */
    public ResponseDTO<PageResult<DoorListVO>> getAreaDoors(DoorQueryForm queryForm) {
        try {
            // 1. æ„å»ºæŸ¥è¯¢æ¡ä»¶
            LambdaQueryWrapper<DoorEntity> queryWrapper = new LambdaQueryWrapper<>();
            queryWrapper.eq(DoorEntity::getAreaId, queryForm.getAreaId())
                    .eq(DoorEntity::getDeletedFlag, false)
                    .orderByDesc(DoorEntity::getCreateTime);

            // 2. åˆ†é¡µæŸ¥è¯¢
            IPage<DoorEntity> page = new Page<>(queryForm.getPageNum(), queryForm.getPageSize());
            IPage<DoorEntity> doorPage = doorDao.selectPage(page, queryWrapper);

            // 3. è½¬æ¢ä¸ºVO
            List<DoorListVO> doorList = doorPage.getRecords().stream()
                    .map(this::convertToDoorListVO)
                    .collect(Collectors.toList());

            PageResult<DoorListVO> pageResult = new PageResult<>();
            pageResult.setRows(doorList);
            pageResult.setTotal(doorPage.getTotal());
            pageResult.setPageNum(queryForm.getPageNum());
            pageResult.setPageSize(queryForm.getPageSize());

            return ResponseDTO.ok(pageResult);

        } catch (Exception e) {
            log.error("è·å–åŒºåŸŸé—¨åˆ—è¡¨å¤±è´¥", e);
            return ResponseDTO.error("æŸ¥è¯¢å¤±è´¥");
        }
    }

    /**
     * åˆ é™¤åŒºåŸŸé—¨
     */
    public ResponseDTO<Void> deleteAreaDoor(Long doorId) {
        try {
            // 1. è·å–é—¨ä¿¡æ¯
            DoorEntity door = doorDao.selectById(doorId);
            if (door == null || door.getDeletedFlag()) {
                return ResponseDTO.error("é—¨ä¸å­˜åœ¨");
            }

            // 2. æ¸…é™¤ç›¸å…³æƒé™
            doorPermissionService.revokeDoorPermissions(doorId);

            // 3. è½¯åˆ é™¤é—¨
            door.setDeletedFlag(true);
            door.setUpdateTime(LocalDateTime.now());
            doorDao.updateById(door);

            log.info("åŒºåŸŸé—¨åˆ é™¤æˆåŠŸ, doorId: {}", doorId);
            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("åˆ é™¤åŒºåŸŸé—¨å¤±è´¥", e);
            return ResponseDTO.error("åˆ é™¤å¤±è´¥");
        }
    }
}
```

### 4. äººå‘˜æƒé™ç®¡ç†æœåŠ¡

#### 4.1 äººå‘˜åŒºåŸŸæƒé™æœåŠ¡

**åŠŸèƒ½æè¿°**ï¼šåŒºåŸŸå†…äººå‘˜æƒé™çš„åˆ†é…å’Œç®¡ç†

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Transactional(rollbackFor = Exception.class)
@Slf4j
public class AreaPersonPermissionService {

    @Resource
    private PersonPermissionDao personPermissionDao;

    @Resource
    private EmployeeService employeeService;

    @Resource
    private DoorService doorService;

    @Resource
    private AutoPermissionAllocationService autoPermissionService;

    /**
     * æ·»åŠ äººå‘˜åˆ°åŒºåŸŸ
     */
    public ResponseDTO<Void> addPersonToArea(PersonAreaAddForm addForm) {
        try {
            // 1. éªŒè¯äººå‘˜å­˜åœ¨
            EmployeeEntity employee = employeeService.getById(addForm.getEmployeeId());
            if (employee == null) {
                return ResponseDTO.error("äººå‘˜ä¸å­˜åœ¨");
            }

            // 2. æ£€æŸ¥äººå‘˜æ˜¯å¦å·²åœ¨åŒºåŸŸä¸­
            if (personPermissionDao.existsPersonInArea(
                    addForm.getEmployeeId(), addForm.getAreaId())) {
                return ResponseDTO.error("äººå‘˜å·²åœ¨åŒºåŸŸä¸­");
            }

            // 3. åˆ›å»ºäººå‘˜åŒºåŸŸå…³è”
            PersonAreaEntity personArea = PersonAreaEntity.builder()
                    .employeeId(addForm.getEmployeeId())
                    .areaId(addForm.getAreaId())
                    .joinType(addForm.getJoinType())
                    .validFrom(addForm.getValidFrom())
                    .validTo(addForm.getValidTo())
                    .createTime(LocalDateTime.now())
                    .build();

            personPermissionDao.insertPersonArea(personArea);

            // 4. å‘å¸ƒäººå‘˜æ–°å¢äº‹ä»¶ï¼Œè§¦å‘æƒé™è‡ªåŠ¨åˆ†é…
            PersonAddedEvent event = PersonAddedEvent.builder()
                    .personId(addForm.getEmployeeId())
                    .personName(employee.getActualName())
                    .areaId(addForm.getAreaId())
                    .createTime(LocalDateTime.now())
                    .build();
            applicationEventPublisher.publishEvent(event);

            log.info("äººå‘˜æ·»åŠ åˆ°åŒºåŸŸæˆåŠŸ, employeeId: {}, areaId: {}",
                    addForm.getEmployeeId(), addForm.getAreaId());

            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("äººå‘˜æ·»åŠ åˆ°åŒºåŸŸå¤±è´¥", e);
            return ResponseDTO.error("æ·»åŠ å¤±è´¥");
        }
    }

    /**
     * è·å–åŒºåŸŸäººå‘˜æƒé™çŸ©é˜µ
     */
    public ResponseDTO<AreaPermissionMatrixVO> getAreaPermissionMatrix(Long areaId) {
        try {
            // 1. è·å–åŒºåŸŸæ‰€æœ‰äººå‘˜
            List<PersonPermissionMatrixRow> personRows =
                    getAreaPersonMatrixRows(areaId);

            // 2. è·å–åŒºåŸŸæ‰€æœ‰é—¨
            List<PersonPermissionMatrixColumn> doorColumns =
                    getAreaDoorMatrixColumns(areaId);

            // 3. è·å–æƒé™çŸ©é˜µæ•°æ®
            List<PermissionMatrixCell> matrixCells =
                    getPermissionMatrixCells(areaId, personRows, doorColumns);

            AreaPermissionMatrixVO matrixVO = AreaPermissionMatrixVO.builder()
                    .areaId(areaId)
                    .personRows(personRows)
                    .doorColumns(doorColumns)
                    .matrixCells(matrixCells)
                    .build();

            return ResponseDTO.ok(matrixVO);

        } catch (Exception e) {
            log.error("è·å–åŒºåŸŸæƒé™çŸ©é˜µå¤±è´¥, areaId: {}", areaId, e);
            return ResponseDTO.error("è·å–æƒé™çŸ©é˜µå¤±è´¥");
        }
    }

    /**
     * æ‰¹é‡è°ƒæ•´äººå‘˜æƒé™
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> batchAdjustPermissions(BatchPermissionAdjustForm form) {
        try {
            List<PermissionAdjustment> adjustments = form.getAdjustments();

            for (PermissionAdjustment adjustment : adjustments) {
                // 1. éªŒè¯æƒé™è°ƒæ•´è¯·æ±‚
                validatePermissionAdjustment(adjustment);

                // 2. æ‰§è¡Œæƒé™è°ƒæ•´
                executePermissionAdjustment(adjustment);
            }

            log.info("æ‰¹é‡æƒé™è°ƒæ•´å®Œæˆ, è°ƒæ•´æ•°é‡: {}", adjustments.size());
            return ResponseDTO.ok();

        } catch (Exception e) {
            log.error("æ‰¹é‡æƒé™è°ƒæ•´å¤±è´¥", e);
            return ResponseDTO.error("æƒé™è°ƒæ•´å¤±è´¥");
        }
    }

    /**
     * æ‰§è¡Œæƒé™è°ƒæ•´
     */
    private void executePermissionAdjustment(PermissionAdjustment adjustment) {
        switch (adjustment.getOperation()) {
            case GRANT:
                grantPersonDoorPermission(adjustment.getPersonId(),
                        adjustment.getDoorId(), adjustment.getPermission());
                break;
            case REVOKE:
                revokePersonDoorPermission(adjustment.getPersonId(),
                        adjustment.getDoorId());
                break;
            case MODIFY:
                modifyPersonDoorPermission(adjustment.getPersonId(),
                        adjustment.getDoorId(), adjustment.getPermission());
                break;
            default:
                throw new BusinessException("ä¸æ”¯æŒçš„æƒé™æ“ä½œ");
        }
    }
}
```

### 5. åŒºåŸŸç›‘æ§æœåŠ¡

#### 5.1 å®æ—¶ç›‘æ§æœåŠ¡

**åŠŸèƒ½æè¿°**ï¼šåŒºåŸŸå®æ—¶çŠ¶æ€ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦

**æŠ€æœ¯å®ç°**ï¼š
```java
@Service
@Slf4j
public class AreaMonitoringService {

    @Resource
    private SimpMessagingTemplate messagingTemplate;

    @Resource
    private DeviceService deviceService;

    @Resource
    private AccessEventService accessEventService;

    @Resource
    private CapacityMonitorService capacityMonitorService;

    /**
     * è·å–åŒºåŸŸå®æ—¶ç›‘æ§æ•°æ®
     */
    @Cacheable(value = "areaMonitor", key = "#areaId")
    public AreaMonitorVO getAreaMonitorData(Long areaId) {
        try {
            AreaMonitorVO monitorVO = AreaMonitorVO.builder()
                    .areaId(areaId)
                    .timestamp(LocalDateTime.now())
                    .build();

            // 1. è®¾å¤‡çŠ¶æ€ç›‘æ§
            DeviceMonitorData deviceMonitor = getDeviceMonitorData(areaId);
            monitorVO.setDeviceMonitor(deviceMonitor);

            // 2. äººå‘˜é€šè¡Œç›‘æ§
            AccessMonitorData accessMonitor = getAccessMonitorData(areaId);
            monitorVO.setAccessMonitor(accessMonitor);

            // 3. åŒºåŸŸå®¹é‡ç›‘æ§
            CapacityMonitorData capacityMonitor = getCapacityMonitorData(areaId);
            monitorVO.setCapacityMonitor(capacityMonitor);

            // 4. é—¨çŠ¶æ€ç›‘æ§
            DoorMonitorData doorMonitor = getDoorMonitorData(areaId);
            monitorVO.setDoorMonitor(doorMonitor);

            return monitorVO;

        } catch (Exception e) {
            log.error("è·å–åŒºåŸŸç›‘æ§æ•°æ®å¤±è´¥, areaId: {}", areaId, e);
            return null;
        }
    }

    /**
     * è®¾å¤‡çŠ¶æ€ç›‘æ§
     */
    private DeviceMonitorData getDeviceMonitorData(Long areaId) {
        List<DeviceInfo> areaDevices = deviceService.getDevicesByArea(areaId);

        DeviceMonitorData monitorData = DeviceMonitorData.builder()
                .totalDevices(areaDevices.size())
                .onlineDevices((int) areaDevices.stream()
                        .filter(DeviceInfo::isOnline)
                        .count())
                .offlineDevices((int) areaDevices.stream()
                        .filter(d -> !d.isOnline())
                        .count())
                .build();

        // è®¡ç®—åœ¨çº¿ç‡
        if (monitorData.getTotalDevices() > 0) {
            double onlineRate = (double) monitorData.getOnlineDevices() /
                    monitorData.getTotalDevices() * 100;
            monitorData.setOnlineRate(onlineRate);
        }

        return monitorData;
    }

    /**
     * äººå‘˜é€šè¡Œç›‘æ§
     */
    private AccessMonitorData getAccessMonitorData(Long areaId) {
        // è·å–ä»Šæ—¥é€šè¡Œç»Ÿè®¡
        LocalDate today = LocalDate.now();
        LocalDateTime startOfToday = today.atStartOfDay();
        LocalDateTime endOfToday = today.plusDays(1).atStartOfDay();

        AccessMonitorData monitorData = AccessMonitorData.builder()
                .todayAccessCount(accessEventService.countAccessByAreaAndTime(
                        areaId, startOfToday, endOfToday))
                .todaySuccessCount(accessEventService.countSuccessAccessByAreaAndTime(
                        areaId, startOfToday, endOfToday))
                .todayFailureCount(accessEventService.countFailureAccessByAreaAndTime(
                        areaId, startOfToday, endOfToday))
                .build();

        // è®¡ç®—æˆåŠŸç‡
        if (monitorData.getTodayAccessCount() > 0) {
            double successRate = (double) monitorData.getTodaySuccessCount() /
                    monitorData.getTodayAccessCount() * 100;
            monitorData.setSuccessRate(successRate);
        }

        return monitorData;
    }

    /**
     * åŒºåŸŸå®¹é‡ç›‘æ§
     */
    private CapacityMonitorData getCapacityMonitorData(Long areaId) {
        AreaCapacityMonitor capacityMonitor = capacityMonitorService
                .getCapacityMonitor(areaId);

        return CapacityMonitorData.builder()
                .maxCapacity(capacityMonitor.getMaxCapacity())
                .currentCount(capacityMonitor.getCurrentCount())
                .utilizationRate(capacityMonitor.getUtilizationRate())
                .alertLevel(capacityMonitor.getAlertLevel())
                .build();
    }

    /**
     * æ¨é€å®æ—¶ç›‘æ§æ•°æ®
     */
    @EventListener
    @Async
    public void handleAreaMonitorUpdateEvent(AreaMonitorUpdateEvent event) {
        try {
            Long areaId = event.getAreaId();

            // è·å–æœ€æ–°ç›‘æ§æ•°æ®
            AreaMonitorVO monitorData = getAreaMonitorData(areaId);

            // æ¨é€åˆ°å‰ç«¯
            messagingTemplate.convertAndSend(
                "/topic/area-monitor/" + areaId,
                monitorData
            );

            // æ£€æŸ¥å‘Šè­¦æ¡ä»¶
            checkAndSendAlerts(areaId, monitorData);

        } catch (Exception e) {
            log.error("æ¨é€åŒºåŸŸç›‘æ§æ•°æ®å¤±è´¥, areaId: {}", event.getAreaId(), e);
        }
    }

    /**
     * æ£€æŸ¥å¹¶å‘é€å‘Šè­¦
     */
    private void checkAndSendAlerts(Long areaId, AreaMonitorVO monitorData) {
        List<MonitorAlert> alerts = new ArrayList<>();

        // 1. è®¾å¤‡ç¦»çº¿å‘Šè­¦
        if (monitorData.getDeviceMonitor().getOfflineDevices() > 0) {
            alerts.add(MonitorAlert.builder()
                    .areaId(areaId)
                    .alertType(AlertType.DEVICE_OFFLINE)
                    .alertLevel(AlertLevel.WARNING)
                    .message("æœ‰è®¾å¤‡ç¦»çº¿")
                    .createTime(LocalDateTime.now())
                    .build());
        }

        // 2. åŒºåŸŸå®¹é‡å‘Šè­¦
        CapacityMonitorData capacity = monitorData.getCapacityMonitor();
        if (capacity.getUtilizationRate() > 90.0) {
            alerts.add(MonitorAlert.builder()
                    .areaId(areaId)
                    .alertType(AlertType.CAPACITY_OVERFLOW)
                    .alertLevel(AlertLevel.CRITICAL)
                    .message("åŒºåŸŸäººå‘˜å®¹é‡è¶…é™")
                    .createTime(LocalDateTime.now())
                    .build());
        }

        // å‘é€å‘Šè­¦
        for (MonitorAlert alert : alerts) {
            notificationService.sendMonitorAlert(alert);
        }
    }
}
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### åŒºåŸŸç©ºé—´ç®¡ç†ç›¸å…³è¡¨ç»“æ„

```sql
-- äººå‘˜åŒºåŸŸå…³è”è¡¨
CREATE TABLE `t_access_person_area` (
    `id` BIGINT AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `employee_id` BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    `area_id` BIGINT NOT NULL COMMENT 'åŒºåŸŸID',
    `join_type` TINYINT DEFAULT 1 COMMENT 'åŠ å…¥ç±»å‹(1:åˆ†é… 2:ç”³è¯· 3:ä¸´æ—¶)',
    `valid_from` DATETIME COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¶é—´',
    `valid_to` DATETIME COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¶é—´',
    `join_reason` VARCHAR(200) COMMENT 'åŠ å…¥åŸå› ',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºç”¨æˆ·ID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—(0:æ­£å¸¸ 1:åˆ é™¤)',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_employee_area` (`employee_id`, `area_id`),
    KEY `idx_area_id` (`area_id`),
    KEY `idx_valid_period` (`valid_from`, `valid_to`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äººå‘˜åŒºåŸŸå…³è”è¡¨';

-- äººå‘˜é—¨æƒé™è¡¨
CREATE TABLE `t_access_person_door_permission` (
    `permission_id` BIGINT AUTO_INCREMENT COMMENT 'æƒé™ID',
    `person_id` BIGINT NOT NULL COMMENT 'äººå‘˜ID',
    `door_id` BIGINT NOT NULL COMMENT 'é—¨ID',
    `area_id` BIGINT NOT NULL COMMENT 'åŒºåŸŸID',
    `permission_type` TINYINT DEFAULT 1 COMMENT 'æƒé™ç±»å‹(1:è®¿é—® 2:ç®¡ç† 3:åº”æ€¥)',
    `allocation_type` TINYINT DEFAULT 1 COMMENT 'åˆ†é…ç±»å‹(1:æ‰‹åŠ¨ 2:è‡ªåŠ¨ 3:ç»§æ‰¿)',
    `valid_from` DATETIME NOT NULL COMMENT 'ç”Ÿæ•ˆå¼€å§‹æ—¶é—´',
    `valid_to` DATETIME NOT NULL COMMENT 'ç”Ÿæ•ˆç»“æŸæ—¶é—´',
    `time_ranges` JSON COMMENT 'é€šè¡Œæ—¶é—´æ®µé…ç½®',
    `access_levels` JSON COMMENT 'è®¿é—®çº§åˆ«é…ç½®',
    `verification_methods` JSON COMMENT 'éªŒè¯æ–¹å¼é…ç½®',
    `description` VARCHAR(500) COMMENT 'æƒé™æè¿°',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºç”¨æˆ·ID',
    `deleted_flag` TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—(0:æ­£å¸¸ 1:åˆ é™¤)',
    PRIMARY KEY (`permission_id`),
    UNIQUE KEY `uk_person_door` (`person_id`, `door_id`),
    KEY `idx_area_id` (`area_id`),
    KEY `idx_permission_type` (`permission_type`),
    KEY `idx_allocation_type` (`allocation_type`),
    KEY `idx_valid_period` (`valid_from`, `valid_to`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äººå‘˜é—¨æƒé™è¡¨';

-- åŒºåŸŸæƒé™é…ç½®è¡¨
CREATE TABLE `t_access_area_permission_config` (
    `config_id` BIGINT AUTO_INCREMENT COMMENT 'é…ç½®ID',
    `area_id` BIGINT NOT NULL COMMENT 'åŒºåŸŸID',
    `config_name` VARCHAR(100) NOT NULL COMMENT 'é…ç½®åç§°',
    `default_time_ranges` JSON COMMENT 'é»˜è®¤é€šè¡Œæ—¶é—´æ®µ',
    `default_access_levels` JSON COMMENT 'é»˜è®¤è®¿é—®çº§åˆ«',
    `default_verification_methods` JSON COMMENT 'é»˜è®¤éªŒè¯æ–¹å¼',
    `permission_inheritance_enabled` TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨æƒé™ç»§æ‰¿',
    `auto_allocation_enabled` TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨è‡ªåŠ¨åˆ†é…',
    `max_valid_days` INT DEFAULT 3650 COMMENT 'æœ€å¤§æœ‰æ•ˆæœŸ(å¤©)',
    `description` VARCHAR(500) COMMENT 'é…ç½®æè¿°',
    `enabled_flag` TINYINT DEFAULT 1 COMMENT 'å¯ç”¨æ ‡å¿—(0:ç¦ç”¨ 1:å¯ç”¨)',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `create_user_id` BIGINT COMMENT 'åˆ›å»ºç”¨æˆ·ID',
    PRIMARY KEY (`config_id`),
    UNIQUE KEY `uk_area_config` (`area_id`),
    KEY `idx_enabled_flag` (`enabled_flag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒºåŸŸæƒé™é…ç½®è¡¨';

-- åŒºåŸŸå®¹é‡ç›‘æ§è¡¨
CREATE TABLE `t_access_area_capacity_monitor` (
    `monitor_id` BIGINT AUTO_INCREMENT COMMENT 'ç›‘æ§ID',
    `area_id` BIGINT NOT NULL COMMENT 'åŒºåŸŸID',
    `max_capacity` INT NOT NULL DEFAULT 0 COMMENT 'æœ€å¤§å®¹é‡',
    `current_count` INT DEFAULT 0 COMMENT 'å½“å‰äººæ•°',
    `warning_threshold` DECIMAL(5,2) DEFAULT 80.00 COMMENT 'å‘Šè­¦é˜ˆå€¼(%)',
    `critical_threshold` DECIMAL(5,2) DEFAULT 95.00 COMMENT 'ä¸¥é‡å‘Šè­¦é˜ˆå€¼(%)',
    `last_update_time` DATETIME COMMENT 'æœ€åæ›´æ–°æ—¶é—´',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`monitor_id`),
    UNIQUE KEY `uk_area_monitor` (`area_id`),
    KEY `idx_last_update` (`last_update_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒºåŸŸå®¹é‡ç›‘æ§è¡¨';

-- æƒé™æ“ä½œæ—¥å¿—è¡¨
CREATE TABLE `t_access_permission_operation_log` (
    `log_id` BIGINT AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    `area_id` BIGINT COMMENT 'åŒºåŸŸID',
    `person_id` BIGINT COMMENT 'äººå‘˜ID',
    `door_id` BIGINT COMMENT 'é—¨ID',
    `operation_type` VARCHAR(50) NOT NULL COMMENT 'æ“ä½œç±»å‹',
    `operation_content` TEXT COMMENT 'æ“ä½œå†…å®¹',
    `permission_before` JSON COMMENT 'æ“ä½œå‰æƒé™',
    `permission_after` JSON COMMENT 'æ“ä½œåæƒé™',
    `operation_result` TINYINT COMMENT 'æ“ä½œç»“æœ(1:æˆåŠŸ 2:å¤±è´¥)',
    `error_message` TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',
    `execute_user_id` BIGINT COMMENT 'æ‰§è¡Œç”¨æˆ·ID',
    `execute_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ‰§è¡Œæ—¶é—´',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`log_id`),
    KEY `idx_area_id` (`area_id`),
    KEY `idx_person_id` (`person_id`),
    KEY `idx_operation_type` (`operation_type`),
    KEY `idx_execute_time` (`execute_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æƒé™æ“ä½œæ—¥å¿—è¡¨';
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

### æŠ€æœ¯å®ç°æ–‡æ¡£
- [é—¨ç¦ç®¡ç†ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡](./ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡.md) - å®Œæ•´çš„ç³»ç»Ÿæ¶æ„è®¾è®¡
- [è®¾å¤‡ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡](./è®¾å¤‡ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡.md) - è®¾å¤‡ç®¡ç†åŠŸèƒ½è¯¦ç»†å®ç°
- [æƒé™ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡](./æƒé™ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡.md) - æƒé™ç®¡ç†æŠ€æœ¯å®ç°

### ä¸šåŠ¡åŠŸèƒ½æ–‡æ¡£
- [é—¨ç¦ç³»ç»Ÿæ¶æ„æµç¨‹å›¾](./ç³»ç»Ÿæ¶æ„æµç¨‹å›¾.md) - ç³»ç»Ÿæµç¨‹å’Œæ¨¡å—äº¤äº’
- [å®æ—¶ç›‘æ§æ¨¡å—è¯¦ç»†è®¾è®¡](./å®æ—¶ç›‘æ§æ¨¡å—è¯¦ç»†è®¾è®¡.md) - å®æ—¶ç›‘æ§åŠŸèƒ½è®¾è®¡
- [ç³»ç»Ÿé…ç½®æ¨¡å—è¯¦ç»†è®¾è®¡](./ç³»ç»Ÿé…ç½®æ¨¡å—è¯¦ç»†è®¾è®¡.md) - ç³»ç»Ÿé…ç½®åŠŸèƒ½å®ç°

### æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [é—¨ç¦ç®¡ç†æ•°æ®åº“è®¾è®¡](./æ•°æ®åº“è®¾è®¡.md) - å®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
- [æƒé™ç®¡ç†æ•°æ®åº“è®¾è®¡](./æƒé™ç®¡ç†æ•°æ®åº“è®¾è®¡.md) - æƒé™ç›¸å…³è¡¨ç»“æ„è®¾è®¡
- [ç›‘æ§æ•°æ®å­˜å‚¨è®¾è®¡](./ç›‘æ§æ•°æ®å­˜å‚¨è®¾è®¡.md) - ç›‘æ§æ•°æ®å­˜å‚¨æ–¹æ¡ˆ

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™æ€»ç»“

1. **ç»Ÿä¸€åŒºåŸŸç®¡ç†** - åŸºäºå…¬å…±åŒºåŸŸæ¨¡å—çš„ç»Ÿä¸€åŒºåŸŸä¿¡æ¯ç»´æŠ¤
2. **æ™ºèƒ½æƒé™åˆ†é…** - è‡ªåŠ¨æƒé™åˆ†é…å’Œç»§æ‰¿æœºåˆ¶ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
3. **çµæ´»æƒé™æ§åˆ¶** - æ”¯æŒæ‰‹åŠ¨ã€è‡ªåŠ¨ã€ç»§æ‰¿å¤šç§æƒé™åˆ†é…æ¨¡å¼
4. **å®æ—¶ç›‘æ§é¢„è­¦** - å…¨é¢çš„åŒºåŸŸçŠ¶æ€ç›‘æ§å’Œæ™ºèƒ½å‘Šè­¦æœºåˆ¶
5. **æƒé™çŸ©é˜µç®¡ç†** - ç›´è§‚çš„æƒé™å…³ç³»ç®¡ç†å’Œæ‰¹é‡æ“ä½œæ”¯æŒ

## ğŸ“‹ ç‰ˆæœ¬ä¿¡æ¯

- æœ¬æ–‡æ¡£åŸºäºZKBioSecurity-ACCåŒºåŸŸç®¡ç†æ¶æ„è®¾è®¡
- åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å—è®¾è®¡è´Ÿè´£äººï¼šSmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
- åˆ›å»ºæ—¥æœŸï¼š2025-11-13
- ä¸‹æ¬¡è¯„å®¡ï¼š2026-02-13

---

**ğŸ¯ IOE-DREAMé—¨ç¦åŒºåŸŸç©ºé—´ç®¡ç†æ¨¡å— - æ™ºèƒ½æƒé™åˆ†é…ã€å®æ—¶ç›‘æ§ã€é«˜æ•ˆç®¡ç†çš„ä¼ä¸šçº§åŒºåŸŸç©ºé—´è§£å†³æ–¹æ¡ˆ**