# IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°æŠ€æœ¯æ¶æ„ v3.0

## ğŸ“‹ æˆ˜ç•¥æ¶æ„å‡çº§è¯´æ˜

**é‡å¤§å‡çº§**: IOE-DREAMå¹³å°å·²å®Œæˆä»ä¼ªå¾®æœåŠ¡åˆ°**çœŸæ­£ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„**çš„æˆ˜ç•¥å‡çº§ï¼Œå®ç°å®Œå…¨çš„APIå¥‘çº¦é©±åŠ¨å’Œé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‚

### ğŸš¨ å‡çº§å‰é—®é¢˜è¯Šæ–­
åŸé¡¹ç›®å­˜åœ¨ä¸¥é‡çš„æ¶æ„åæ¨¡å¼é—®é¢˜ï¼š
- âŒ **ä¼ªå¾®æœåŠ¡æ¶æ„**: æ‰€æœ‰ä¸šåŠ¡æ¨¡å—å †ç Œåœ¨sa-adminå•ä½“ä¸­
- âŒ **åŒ…ç»“æ„æ··ä¹±**: åŸŸå¯¹è±¡ã€æœåŠ¡æ¥å£ã€å®ç°ç±»æ··æ‚æ— åº
- âŒ **ç¼ºå°‘APIå¥‘çº¦**: æ²¡æœ‰ç‹¬ç«‹çš„APIå®šä¹‰å’Œç‰ˆæœ¬ç®¡ç†æ¨¡å—
- âŒ **æ— ç‰ˆæœ¬ç®¡ç†**: ç¼ºå°‘APIç‰ˆæœ¬ç®¡ç†å’Œå…¼å®¹æ€§ç­–ç•¥
- âŒ **æ¶æ„è€¦åˆ**: ä¸šåŠ¡æ¨¡å—é—´å­˜åœ¨ä¸¥é‡çš„ç´§è€¦åˆå…³ç³»

### âœ… å‡çº§åæ ¸å¿ƒæˆæœ
- âœ… **çœŸæ­£å¾®æœåŠ¡æ¶æ„**: æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†çš„ç‹¬ç«‹å¾®æœåŠ¡
- âœ… **APIå¥‘çº¦ä¼˜å…ˆ**: APIå®šä¹‰ä¸å®ç°å®Œå…¨åˆ†ç¦»
- âœ… **ç‰ˆæœ¬åŒ–ç®¡ç†**: v0/v1/v2å¤šç‰ˆæœ¬APIæ”¯æŒ
- âœ… **DDDé¢†åŸŸé©±åŠ¨**: æŒ‰ä¸šåŠ¡é¢†åŸŸç»„ç»‡æ¶æ„
- âœ… **åŸºç¡€è®¾æ–½åˆ†ç¦»**: ç‹¬ç«‹çš„ç¼“å­˜ã€æ¶ˆæ¯ã€é…ç½®æœåŠ¡
- âœ… **ç½‘å…³ç»Ÿä¸€æ¥å…¥**: APIç½‘å…³ç»Ÿä¸€è·¯ç”±å’Œå®‰å…¨æ§åˆ¶

## ç³»ç»Ÿæ¦‚è¿°

IOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°æ˜¯ä¸€å¥—åŸºäºç°ä»£åŒ–å¾®æœåŠ¡æ¶æ„å’ŒAIæŠ€æœ¯çš„ç»¼åˆæ€§æ™ºæ…§å›­åŒºç®¡ç†è§£å†³æ–¹æ¡ˆã€‚å¹³å°é‡‡ç”¨**APIå¥‘çº¦ä¼˜å…ˆ**çš„è®¾è®¡ç†å¿µï¼ŒåŸºäº**é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)**æ¶æ„ï¼Œæä¾›é«˜å¯ç”¨ã€é«˜å®‰å…¨æ€§çš„åˆ†å¸ƒå¼æœåŠ¡ï¼Œæ•´åˆäº†å¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«ã€æ™ºèƒ½é—¨ç¦ã€è€ƒå‹¤ç®¡ç†ã€æ¶ˆè´¹ç®¡ç†ã€è§†é¢‘ç›‘æ§ã€è®¿å®¢ç®¡ç†ç­‰æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ã€‚

### ğŸš€ æŠ€æœ¯ç‰¹è‰²

#### ğŸ—ï¸ æ¶æ„è®¾è®¡ç‰¹è‰²
- **ğŸ¯ çœŸæ­£å¾®æœåŠ¡æ¶æ„**: æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†çš„ç‹¬ç«‹å¾®æœåŠ¡ï¼Œå®Œå…¨è§£è€¦
- **ğŸ“¦ APIå¥‘çº¦ä¼˜å…ˆ**: APIå®šä¹‰ä¸å®ç°å®Œå…¨åˆ†ç¦»ï¼Œæ”¯æŒå¤šç‰ˆæœ¬å¹¶å­˜
- **ğŸ”¢ ç‰ˆæœ¬åŒ–ç®¡ç†**: v0(å…¼å®¹) + v1(ç¨³å®š) + v2(æ–°åŠŸèƒ½)å®Œæ•´ç‰ˆæœ¬ç­–ç•¥
- **ğŸ¨ é¢†åŸŸé©±åŠ¨è®¾è®¡**: DDDæˆ˜ç•¥è®¾è®¡å’Œæˆ˜æœ¯è®¾è®¡å®Œæ•´å®è·µ
- **âš™ï¸ åŸºç¡€è®¾æ–½åˆ†ç¦»**: ç¼“å­˜ã€æ¶ˆæ¯ã€é…ç½®ã€ç›‘æ§ç‹¬ç«‹æœåŠ¡
- **ğŸŒ ç½‘å…³ç»Ÿä¸€æ¥å…¥**: ç»Ÿä¸€è·¯ç”±ã€é‰´æƒã€é™æµã€ç›‘æ§

#### ğŸ¤– AIæ™ºèƒ½ç‰¹è‰²
- **ğŸ‘ï¸ å¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«**: äººè„¸ã€æŒ‡çº¹ã€æŒçº¹ã€è™¹è†œã€å£°çº¹èåˆè¯†åˆ«
- **ğŸ§  æ™ºèƒ½åˆ†æå¼•æ“**: æ·±åº¦å­¦ä¹ ç®—æ³•æ”¯æŒè¡Œä¸ºåˆ†æå’Œå¼‚å¸¸æ£€æµ‹
- **ğŸ“Š å®æ—¶å†³ç­–**: AIé©±åŠ¨çš„å®æ—¶ä¸šåŠ¡å†³ç­–å’Œé¢„è­¦ç³»ç»Ÿ
- **ğŸ¯ æ™ºèƒ½æ¨è**: åŸºäºç”¨æˆ·è¡Œä¸ºçš„ä¸ªæ€§åŒ–æœåŠ¡æ¨è

#### ğŸ”’ å®‰å…¨ä¸å›½äº§åŒ–
- **ğŸ›¡ï¸ å›½å¯†ç®—æ³•æ”¯æŒ**: SM2/SM3/SM4å›½äº§åŠ å¯†ç®—æ³•é›†æˆ
- **ğŸ” å¤šå±‚å®‰å…¨é˜²æŠ¤**: ç½‘ç»œå®‰å…¨ã€åº”ç”¨å®‰å…¨ã€æ•°æ®å®‰å…¨ã€ç»ˆç«¯å®‰å…¨
- **ğŸ¢ å›½äº§åŒ–é€‚é…**: æ”¯æŒå›½äº§CPUã€æ“ä½œç³»ç»Ÿã€æ•°æ®åº“
- **ğŸ“‹ åˆè§„ä¿éšœ**: æ»¡è¶³ç­‰ä¿2.0å’Œè¡Œä¸šå®‰å…¨æ ‡å‡†

#### âš¡ æ€§èƒ½ä¸å¯é æ€§
- **ğŸš€ é«˜å¹¶å‘å¤„ç†**: æ”¯æŒä¸‡äººçº§å›­åŒºé«˜å¹¶å‘è®¿é—®
- **ğŸ”„ é«˜å¯ç”¨æ¶æ„**: å¤šæ´»æ•°æ®ä¸­å¿ƒï¼Œæ•…éšœè‡ªåŠ¨åˆ‡æ¢
- **ğŸ“ˆ å¼¹æ€§ä¼¸ç¼©**: åŸºäºKubernetesçš„è‡ªåŠ¨æ‰©ç¼©å®¹
- **ğŸ“± å¤šç«¯ååŒ**: Webã€ç§»åŠ¨ç«¯ã€è‡ªåŠ©ç»ˆç«¯ã€è®¾å¤‡ç«¯ååŒ

## ğŸ—ï¸ å…¨æ–°å¾®æœåŠ¡æ¶æ„è®¾è®¡

### æ¶æ„æ€»ä½“å¸ƒå±€

```mermaid
graph TB
    subgraph "ğŸ“± ç»ˆç«¯æ¥å…¥å±‚"
        A1[Webç®¡ç†åå°]
        A2[ç§»åŠ¨ç«¯åº”ç”¨]
        A3[è‡ªåŠ©æœåŠ¡ç»ˆç«¯]
        A4[é—¨ç¦è®¾å¤‡]
        A5[ç›‘æ§æ‘„åƒå¤´]
        A6[è€ƒå‹¤è®¾å¤‡]
        A7[æ¶ˆè´¹ç»ˆç«¯]
    end

    subgraph "ğŸŒ æ¥å…¥ç½‘å…³å±‚"
        B1[APIç½‘å…³é›†ç¾¤<br/>Spring Cloud Gateway]
        B2[è´Ÿè½½å‡è¡¡<br/>Nginx + HAProxy]
        B3[å®‰å…¨ç½‘å…³<br/>è®¤è¯æˆæƒ + é™æµç†”æ–­]
        B4[ç‰ˆæœ¬è·¯ç”±<br/>v0/v1/v2ç‰ˆæœ¬ç®¡ç†]
        B5[ç›‘æ§å®¡è®¡<br/>é“¾è·¯è¿½è¸ª + æ—¥å¿—æ”¶é›†]
    end

    subgraph "ğŸ“¦ APIå¥‘çº¦å±‚ - ç¬¬ä¸€å±‚"
        C1[ioe-dream-api-consume<br/>æ¶ˆè´¹æœåŠ¡API v1/v2]
        C2[ioe-dream-api-access<br/>é—¨ç¦æœåŠ¡API v1/v2]
        C3[ioe-dream-api-attendance<br/>è€ƒå‹¤æœåŠ¡API v1/v2]
        C4[ioe-dream-api-device<br/>è®¾å¤‡æœåŠ¡API v1/v2]
        C5[ioe-dream-api-monitor<br/>ç›‘æ§æœåŠ¡API v1]
        C6[ioe-dream-api-video<br/>è§†é¢‘æœåŠ¡API v1]
        C7[ioe-dream-api-system<br/>ç³»ç»ŸæœåŠ¡API v1]
        C8[ioe-dream-api-common<br/>å…¬å…±APIå®šä¹‰]
        C9[ioe-dream-api-auth<br/>è®¤è¯æœåŠ¡API v1]
    end

    subgraph "âš™ï¸ å¾®æœåŠ¡å®ç°å±‚ - ç¬¬äºŒå±‚"
        D1[ioe-dream-service-consume<br/>æ¶ˆè´¹æœåŠ¡å®ç°]
        D2[ioe-dream-service-access<br/>é—¨ç¦æœåŠ¡å®ç°]
        D3[ioe-dream-service-attendance<br/>è€ƒå‹¤æœåŠ¡å®ç°]
        D4[ioe-dream-service-device<br/>è®¾å¤‡æœåŠ¡å®ç°]
        D5[ioe-dream-service-monitor<br/>ç›‘æ§æœåŠ¡å®ç°]
        D6[ioe-dream-service-video<br/>è§†é¢‘æœåŠ¡å®ç°]
        D7[ioe-dream-service-system<br/>ç³»ç»ŸæœåŠ¡å®ç°]
        D8[ioe-dream-service-auth<br/>è®¤è¯æœåŠ¡å®ç°]
    end

    subgraph "ğŸ”§ åŸºç¡€è®¾æ–½å±‚ - ç¬¬ä¸‰å±‚"
        E1[ioe-dream-gateway<br/>APIç½‘å…³èšåˆ]
        E2[ioe-dream-cache<br/>åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡]
        E3[ioe-dream-messaging<br/>æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡]
        E4[ioe-dream-config<br/>é…ç½®ä¸­å¿ƒæœåŠ¡]
        E5[ioe-dream-common<br/>é€šç”¨ç»„ä»¶åº“]
        E6[ioe-dream-admin<br/>ç®¡ç†åå°èšåˆ]
    end

    A1 --> B1
    A2 --> B1
    A3 --> B1
    A4 --> B2
    A5 --> B2
    A6 --> B2
    A7 --> B1

    B1 --> B2
    B2 --> B3
    B3 --> B4
    B4 --> B5

    B5 --> C1
    B5 --> C2
    B5 --> C3
    B5 --> C4
    B5 --> C5
    B5 --> C6
    B5 --> C7
    B5 --> C8
    B5 --> C9

    C1 --> D1
    C2 --> D2
    C3 --> D3
    C4 --> D4
    C5 --> D5
    C6 --> D6
    C7 --> D7
    C8 --> E5
    C9 --> D8

    D1 --> E1
    D2 --> E2
    D3 --> E3
    D4 --> E4
    D5 --> E5
    D6 --> E1
    D7 --> E1
    D8 --> E1
```

## ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„åˆ†å±‚è®¾è®¡

### ç¬¬ä¸€å±‚ï¼šAPIå¥‘çº¦å±‚ (API Contract Layer)

**èŒè´£**: å®šä¹‰æœåŠ¡é—´æ¥å£å¥‘çº¦ï¼Œå®ç°APIä¸å®ç°çš„å®Œå…¨åˆ†ç¦»

#### æ¨¡å—ç»“æ„
```
ioe-dream-api/
â”œâ”€â”€ ioe-dream-api-consume/           # æ¶ˆè´¹æœåŠ¡API
â”‚   â”œâ”€â”€ v1/                          # ç¨³å®šç‰ˆæœ¬
â”‚   â”‚   â”œâ”€â”€ dto/                     # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ enums/                   # æšä¸¾å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ vo/                      # å€¼å¯¹è±¡
â”‚   â”‚   â””â”€â”€ ConsumeApiV1.java       # APIæ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ v2/                          # æ–°åŠŸèƒ½ç‰ˆæœ¬
â”‚   â””â”€â”€ v0/                          # å…¼å®¹æ€§ç‰ˆæœ¬
â”œâ”€â”€ ioe-dream-api-access/            # é—¨ç¦æœåŠ¡API
â”œâ”€â”€ ioe-dream-api-attendance/        # è€ƒå‹¤æœåŠ¡API
â”œâ”€â”€ ioe-dream-api-device/            # è®¾å¤‡æœåŠ¡API
â”œâ”€â”€ ioe-dream-api-monitor/           # ç›‘æ§æœåŠ¡API
â”œâ”€â”€ ioe-dream-api-video/             # è§†é¢‘æœåŠ¡API
â”œâ”€â”€ ioe-dream-api-system/            # ç³»ç»ŸæœåŠ¡API
â”œâ”€â”€ ioe-dream-api-auth/              # è®¤è¯æœåŠ¡API
â””â”€â”€ ioe-dream-api-common/            # å…¬å…±APIå®šä¹‰
```

#### è®¾è®¡åŸåˆ™
- **å¥‘çº¦ä¼˜å…ˆ**: APIè®¾è®¡å…ˆäºå®ç°
- **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒv0/v1/v2å¤šç‰ˆæœ¬å¹¶å­˜
- **å‘åå…¼å®¹**: v2æ”¯æŒv1å®¢æˆ·ç«¯
- **ç±»å‹å®‰å…¨**: å¼ºç±»å‹DTOå’Œæšä¸¾å®šä¹‰

### ç¬¬äºŒå±‚ï¼šå¾®æœåŠ¡å®ç°å±‚ (Service Implementation Layer)

**èŒè´£**: å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œéµå¾ªDDDæ¶æ„æ¨¡å¼

#### æ¶æ„æ¨¡å¼
æ¯ä¸ªå¾®æœåŠ¡é‡‡ç”¨æ ‡å‡†çš„DDDå››å±‚æ¶æ„ï¼š
```
ioe-dream-service-{module}/
â”œâ”€â”€ application/                     # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ service/                     # åº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ facade/                      # å¤–è§‚æ¨¡å¼
â”‚   â””â”€â”€ event/                       # äº‹ä»¶å¤„ç†
â”œâ”€â”€ domain/                          # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ model/                       # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ service/                     # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ repository/                  # ä»“å‚¨æ¥å£
â”‚   â””â”€â”€ event/                       # é¢†åŸŸäº‹ä»¶
â”œâ”€â”€ infrastructure/                   # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ repository/impl/             # ä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ messaging/                   # æ¶ˆæ¯å¤„ç†
â”‚   â””â”€â”€ external/                    # å¤–éƒ¨æœåŠ¡
â””â”€â”€ interfaces/                      # æ¥å£å±‚
    â”œâ”€â”€ rest/                        # RESTæ§åˆ¶å™¨
    â”œâ”€â”€ dto/                         # æ¥å£DTO
    â””â”€â”€ mapper/                      # å¯¹è±¡æ˜ å°„
```

#### æœåŠ¡åˆ—è¡¨
- **æ¶ˆè´¹æœåŠ¡**: è´¦æˆ·ç®¡ç†ã€äº¤æ˜“å¤„ç†ã€å……å€¼é€€æ¬¾
- **é—¨ç¦æœåŠ¡**: æƒé™æ§åˆ¶ã€é€šè¡Œè®°å½•ã€åŒºåŸŸç®¡ç†
- **è€ƒå‹¤æœåŠ¡**: è€ƒå‹¤è§„åˆ™ã€æ’ç­ç®¡ç†ã€ç»Ÿè®¡åˆ†æ
- **è®¾å¤‡æœåŠ¡**: è®¾å¤‡æ¥å…¥ã€çŠ¶æ€ç›‘æ§ã€é…ç½®ç®¡ç†
- **ç›‘æ§æœåŠ¡**: å®æ—¶ç›‘æ§ã€å‘Šè­¦ç®¡ç†ã€æ•°æ®é‡‡é›†
- **è§†é¢‘æœåŠ¡**: è§†é¢‘æµå¤„ç†ã€æ™ºèƒ½åˆ†æã€å­˜å‚¨ç®¡ç†
- **ç³»ç»ŸæœåŠ¡**: ç”¨æˆ·ç®¡ç†ã€æƒé™ç®¡ç†ã€ç³»ç»Ÿé…ç½®
- **è®¤è¯æœåŠ¡**: èº«ä»½è®¤è¯ã€å•ç‚¹ç™»å½•ã€ä»¤ç‰Œç®¡ç†

### ç¬¬ä¸‰å±‚ï¼šåŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)

**èŒè´£**: æä¾›é€šç”¨çš„åŸºç¡€è®¾æ–½æœåŠ¡å’ŒæŠ€æœ¯ç»„ä»¶

#### æ ¸å¿ƒç»„ä»¶
- **APIç½‘å…³**: ç»Ÿä¸€æ¥å…¥ã€è·¯ç”±ã€é‰´æƒã€é™æµ
- **ç¼“å­˜æœåŠ¡**: åˆ†å¸ƒå¼ç¼“å­˜ã€ä¼šè¯ç®¡ç†ã€æ•°æ®ç¼“å­˜
- **æ¶ˆæ¯æœåŠ¡**: å¼‚æ­¥æ¶ˆæ¯ã€äº‹ä»¶é©±åŠ¨ã€äº‹åŠ¡æ¶ˆæ¯
- **é…ç½®ä¸­å¿ƒ**: é…ç½®ç®¡ç†ã€åŠ¨æ€åˆ·æ–°ã€ç¯å¢ƒéš”ç¦»
- **é€šç”¨ç»„ä»¶**: å·¥å…·ç±»ã€åŸºç¡€ç±»ã€é€šç”¨ä¸šåŠ¡ç»„ä»¶

## ğŸ”„ æ•°æ®ä¸€è‡´æ€§æ¶æ„

### äº‹åŠ¡ç®¡ç†ç­–ç•¥

```mermaid
graph TB
    subgraph "æœ¬åœ°äº‹åŠ¡"
        A1[Springäº‹åŠ¡ç®¡ç†]
        A2[æ•°æ®åº“äº‹åŠ¡]
        A3[å›æ»šæœºåˆ¶]
    end

    subgraph "åˆ†å¸ƒå¼äº‹åŠ¡"
        B1[Sagaæ¨¡å¼]
        B2[è¡¥å¿æœºåˆ¶]
        B3[æœ€ç»ˆä¸€è‡´æ€§]
    end

    subgraph "äº‹ä»¶é©±åŠ¨"
        C1[é¢†åŸŸäº‹ä»¶]
        C2[äº‹ä»¶å­˜å‚¨]
        C3[äº‹ä»¶é‡æ”¾]
    end

    A1 --> A2
    A2 --> A3

    B1 --> B2
    B2 --> B3

    C1 --> C2
    C2 --> C3
```

#### äº‹åŠ¡è¾¹ç•Œè®¾è®¡
- **æœ¬åœ°äº‹åŠ¡**: å•æœåŠ¡å†…ä½¿ç”¨Springäº‹åŠ¡ç®¡ç†
- **åˆ†å¸ƒå¼äº‹åŠ¡**: è·¨æœåŠ¡ä½¿ç”¨Sagaæ¨¡å¼
- **æœ€ç»ˆä¸€è‡´æ€§**: é€šè¿‡äº‹ä»¶é©±åŠ¨ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´
- **è¡¥å¿æœºåˆ¶**: å¤±è´¥æ—¶æ‰§è¡Œè¡¥å¿æ“ä½œ

#### äº‹ä»¶é©±åŠ¨æ¶æ„
```java
// é¢†åŸŸäº‹ä»¶å‘å¸ƒ
@Component
public class DomainEventPublisher {

    @Resource
    private RabbitTemplate rabbitTemplate;

    public void publish(DomainEvent event) {
        // 1. ä¿å­˜äº‹ä»¶åˆ°äº‹ä»¶å­˜å‚¨
        eventStore.save(event);

        // 2. å‘å¸ƒåˆ°æ¶ˆæ¯é˜Ÿåˆ—
        rabbitTemplate.convertAndSend(
            event.getRoutingKey(),
            event
        );
    }
}

// äº‹ä»¶å¤„ç†
@RabbitListener(queues = "consume.events")
public class ConsumeEventHandler {

    @EventListener
    public void handle(AccountCreatedEvent event) {
        // å¤„ç†è´¦æˆ·åˆ›å»ºäº‹ä»¶
        notificationService.sendWelcomeMessage(event.getAccountId());
    }
}
```

## ğŸ” å®‰å…¨æ¶æ„è®¾è®¡

### å¤šå±‚å®‰å…¨é˜²æŠ¤ä½“ç³»

```mermaid
graph TB
    subgraph "ğŸŒ ç½‘ç»œå®‰å…¨å±‚"
        A1[é˜²ç«å¢™ + WAF]
        A2[DDoSé˜²æŠ¤]
        A3[å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ]
        A4[VPNå®‰å…¨æ¥å…¥]
    end

    subgraph "ğŸšª æ¥å…¥å®‰å…¨å±‚"
        B1[APIç½‘å…³é‰´æƒ]
        B2[OAuth2.0 + JWT]
        B3[APIå¯†é’¥ç®¡ç†]
        B4[è®¿é—®æ§åˆ¶ç­–ç•¥]
    end

    subgraph "ğŸ”’ åº”ç”¨å®‰å…¨å±‚"
        C1[RBACæƒé™æ§åˆ¶]
        C2[æ•°æ®åŠ å¯†ä¼ è¾“]
        C3[è¾“å…¥éªŒè¯é˜²æŠ¤]
        C4[å®‰å…¨å®¡è®¡æ—¥å¿—]
    end

    subgraph "ğŸ’¾ æ•°æ®å®‰å…¨å±‚"
        D1[æ•°æ®åº“åŠ å¯†]
        D2[å›½å¯†ç®—æ³•æ”¯æŒ]
        D3[æ•°æ®è„±æ•å¤„ç†]
        D4[å¤‡ä»½åŠ å¯†å­˜å‚¨]
    end

    subgraph "ğŸ”§ ç»ˆç«¯å®‰å…¨å±‚"
        E1[è®¾å¤‡è¯ä¹¦è®¤è¯]
        E2[ç”Ÿç‰©è¯†åˆ«éªŒè¯]
        E3[å®‰å…¨ç»ˆç«¯ç®¡ç†]
        E4[è¿œç¨‹è®¾å¤‡æ“¦é™¤]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4

    B1 --> C1
    B2 --> C2
    B3 --> C3
    B4 --> C4

    C1 --> D1
    C2 --> D2
    C3 --> D3
    C4 --> D4

    D1 --> E1
    D2 --> E2
    D3 --> E3
    D4 --> E4
```

### å›½å¯†ç®—æ³•é›†æˆå®ç°

```java
@Service
@Slf4j
public class NationalCryptographyService {

    @Resource
    private SM2KeyService sm2KeyService;

    @Resource
    private SM4EncryptionService sm4EncryptionService;

    /**
     * SM2æ•°å­—ç­¾å
     */
    public String sm2Sign(String data, String privateKey) {
        try {
            SM2Engine sm2Engine = new SM2Engine();
            SM2PrivateKey sm2PrivateKey = SM2KeyUtils.parsePrivateKey(privateKey);

            byte[] dataBytes = data.getBytes(StandardCharsets.UTF_8);
            byte[] signature = sm2Engine.sign(sm2PrivateKey, dataBytes);

            return Base64.getEncoder().encodeToString(signature);
        } catch (Exception e) {
            log.error("SM2ç­¾åå¤±è´¥", e);
            throw new CryptographicException("SM2ç­¾åå¤±è´¥", e);
        }
    }

    /**
     * SM4æ•°æ®åŠ å¯†
     */
    public String sm4Encrypt(String plainText, String key) {
        try {
            SM4Engine sm4Engine = new SM4Engine();
            byte[] keyBytes = Hex.decode(key);
            KeyParameter keyParameter = new KeyParameter(keyBytes);

            sm4Engine.init(true, keyParameter);
            byte[] plainBytes = plainText.getBytes(StandardCharsets.UTF_8);
            byte[] encryptedBytes = new byte[sm4Engine.getOutputSize(plainBytes.length)];

            int len = sm4Engine.processBytes(plainBytes, 0, plainBytes.length, encryptedBytes, 0);
            sm4Engine.doFinal(encryptedBytes, len);

            return Hex.toHexString(encryptedBytes);
        } catch (Exception e) {
            log.error("SM4åŠ å¯†å¤±è´¥", e);
            throw new CryptographicException("SM4åŠ å¯†å¤±è´¥", e);
        }
    }

    /**
     * æ•°æ®åº“å­—æ®µåŠ å¯†
     */
    @Converter(autoApply = true)
    public static class EncryptedStringConverter implements AttributeConverter<String, String> {

        @Override
        public String convertToDatabaseColumn(String attribute) {
            if (attribute == null) {
                return null;
            }
            // ä½¿ç”¨SM4åŠ å¯†æ•æ„Ÿæ•°æ®
            return nationalCryptographyService.sm4Encrypt(attribute, getEncryptionKey());
        }

        @Override
        public String convertToEntityAttribute(String dbData) {
            if (dbData == null) {
                return null;
            }
            // ä½¿ç”¨SM4è§£å¯†æ•æ„Ÿæ•°æ®
            return nationalCryptographyService.sm4Decrypt(dbData, getEncryptionKey());
        }
    }
}
```

## ğŸš€ APIç‰ˆæœ¬ç®¡ç†æ¶æ„

### ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

```mermaid
graph TB
    subgraph "v0ç‰ˆæœ¬ - å…¼å®¹æ€§å±‚"
        A1[Legacy APIæ”¯æŒ]
        A2[å‘åå…¼å®¹]
        A3[é€æ­¥åºŸå¼ƒ]
    end

    subgraph "v1ç‰ˆæœ¬ - ç¨³å®šå±‚"
        B1[å½“å‰ç¨³å®šç‰ˆæœ¬]
        B2[ç”Ÿäº§ç¯å¢ƒè¿è¡Œ]
        B3[ç»´æŠ¤å’Œä¿®å¤]
    end

    subgraph "v2ç‰ˆæœ¬ - æ–°åŠŸèƒ½å±‚"
        C1[æ–°åŠŸèƒ½å¼€å‘]
        C2[æ€§èƒ½ä¼˜åŒ–]
        C3[æµ‹è¯•ç¯å¢ƒéªŒè¯]
    end

    subgraph "ç‰ˆæœ¬è·¯ç”±ç­–ç•¥"
        D1[URLè·¯å¾„ç‰ˆæœ¬<br/>/api/v1/users]
        D2[Headerç‰ˆæœ¬<br/>X-API-Version: v1]
        D3[å‚æ•°ç‰ˆæœ¬<br/>?version=v1]
    end

    A1 --> D1
    B1 --> D2
    C1 --> D3
```

### APIç‰ˆæœ¬å®ç°ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api")
public class MultiVersionUserController {

    // v1ç‰ˆæœ¬ - ç¨³å®šç‰ˆæœ¬
    @GetMapping("/v1/users")
    public ResponseDTO<List<UserVO>> getUsersV1() {
        return ResponseDTO.ok(userService.getAllUsers());
    }

    // v2ç‰ˆæœ¬ - æ–°åŠŸèƒ½ç‰ˆæœ¬
    @GetMapping("/v2/users")
    public ResponseDTO<PageResult<UserVO>> getUsersV2(
            @RequestParam(defaultValue = "1") int page,
            @RequestParam(defaultValue = "10") int size) {
        return ResponseDTO.ok(userService.getUsersWithPagination(page, size));
    }

    // v0ç‰ˆæœ¬ - å…¼å®¹ç‰ˆæœ¬
    @GetMapping("/v0/users")
    public ResponseDTO<List<UserLegacyVO>> getUsersV0() {
        List<UserLegacyVO> legacyUsers = userService.getAllUsers().stream()
            .map(this::convertToLegacy)
            .collect(Collectors.toList());
        return ResponseDTO.ok(legacyUsers);
    }

    // ç‰ˆæœ¬å…¼å®¹å¤„ç†
    @GetMapping("/users")
    public ResponseDTO<?> getUsers(
            @RequestHeader(value = "X-API-Version", defaultValue = "v1") String version,
            @RequestParam(required = false) String versionParam) {

        String finalVersion = determineVersion(version, versionParam);

        switch (finalVersion) {
            case "v0":
                return getUsersV0();
            case "v1":
                return getUsersV1();
            case "v2":
                return getUsersV2(1, 10);
            default:
                throw new UnsupportedVersionException("ä¸æ”¯æŒçš„APIç‰ˆæœ¬: " + finalVersion);
        }
    }

    private String determineVersion(String headerVersion, String paramVersion) {
        return paramVersion != null ? paramVersion : headerVersion;
    }
}
```

## æ•°æ®æ¶æ„è®¾è®¡

### æ•°æ®å­˜å‚¨æ¶æ„

```mermaid
graph TB
    subgraph "å…³ç³»å‹æ•°æ®"
        A1[MySQLä¸»åº“]
        A2[MySQLä»åº“1]
        A3[MySQLä»åº“2]
        A4[MySQLå¤‡ä»½åº“]
    end

    subgraph "ç¼“å­˜æ•°æ®"
        B1[Redisä¸»èŠ‚ç‚¹]
        B2[Redisä»èŠ‚ç‚¹1]
        B3[Redisä»èŠ‚ç‚¹2]
        B4[Rediså“¨å…µ]
    end

    subgraph "æœç´¢æ•°æ®"
        C1[Elasticsearchä¸»èŠ‚ç‚¹]
        C2[Elasticsearchæ•°æ®èŠ‚ç‚¹1]
        C3[Elasticsearchæ•°æ®èŠ‚ç‚¹2]
        C4[Elasticsearchæ•°æ®èŠ‚ç‚¹3]
    end

    subgraph "æ–‡æ¡£æ•°æ®"
        D1[MongoDBä¸»èŠ‚ç‚¹]
        D2[MongoDBä»èŠ‚ç‚¹1]
        D3[MongoDBä»èŠ‚ç‚¹2]
    end

    subgraph "æ–‡ä»¶å­˜å‚¨"
        E1[MinIOé›†ç¾¤]
        E2[CDNåŠ é€Ÿ]
        E3[æœ¬åœ°å­˜å‚¨]
    end

    A1 --> A2
    A1 --> A3
    A1 --> A4

    B1 --> B2
    B1 --> B3
    B4 --> B1

    C1 --> C2
    C1 --> C3
    C1 --> C4

    D1 --> D2
    D1 --> D3

    E1 --> E2
    E1 --> E3
```

### æ•°æ®åº“åˆ†åº“åˆ†è¡¨ç­–ç•¥

```java
@Configuration
public class DatabaseShardingConfig {

    /**
     * ä¸€å¡é€šæ•°æ®åˆ†ç‰‡ç­–ç•¥
     */
    @Bean
    public ShardingRuleConfiguration cardShardingRule() {
        return ShardingRuleConfiguration.builder()
            .addTableRuleConfiguration(getCardTableRule())
            .addDatabaseShardingStrategyConfiguration("card_db",
                new InlineDatabaseShardingStrategyConfiguration("card_id", "card_db_${card_id % 4}"))
            .addTableShardingStrategyConfiguration("t_smart_card",
                new InlineTableShardingStrategyConfiguration("card_id", "t_smart_card_${card_id % 8}"))
            .build();
    }

    /**
     * è®¿å®¢è®°å½•åˆ†ç‰‡ç­–ç•¥ï¼ˆæŒ‰æ—¶é—´åˆ†ç‰‡ï¼‰
     */
    @Bean
    public ShardingRuleConfiguration visitorShardingRule() {
        return ShardingRuleConfiguration.builder()
            .addTableRuleConfiguration(getVisitorTableRule())
            .addTableShardingStrategyConfiguration("t_visitor_visit",
                new StandardShardingStrategyConfiguration("visit_date", VisitorDateShardingAlgorithm.class))
            .build();
    }
}

/**
 * è®¿å®¢æ—¥æœŸåˆ†ç‰‡ç®—æ³•
 */
public class VisitorDateShardingAlgorithm implements PreciseShardingAlgorithm<LocalDate> {

    @Override
    public String doSharding(Collection<String> availableTargetNames, PreciseShardingValue<LocalDate> shardingValue) {
        LocalDate date = shardingValue.getValue();
        String yearMonth = date.format(DateTimeFormatter.ofPattern("yyyyMM"));

        return availableTargetNames.stream()
            .filter(target -> target.endsWith(yearMonth))
            .findFirst()
            .orElseThrow(() -> new IllegalArgumentException("æœªæ‰¾åˆ°åŒ¹é…çš„åˆ†ç‰‡"));
    }
}
```

## å®‰å…¨æ¶æ„è®¾è®¡

### å¤šå±‚å®‰å…¨é˜²æŠ¤

```mermaid
graph TB
    subgraph "ç½‘ç»œå®‰å…¨å±‚"
        A1[é˜²ç«å¢™]
        A2[DDoSé˜²æŠ¤]
        A3[å…¥ä¾µæ£€æµ‹]
        A4[VPNæ¥å…¥]
    end

    subgraph "åº”ç”¨å®‰å…¨å±‚"
        B1[APIé‰´æƒ]
        B2[æƒé™æ§åˆ¶]
        B3[æ•°æ®åŠ å¯†]
        B4[å®‰å…¨å®¡è®¡]
    end

    subgraph "æ•°æ®å®‰å…¨å±‚"
        C1[æ•°æ®è„±æ•]
        C2[å›½å¯†ç®—æ³•]
        C3[å¯†é’¥ç®¡ç†]
        C4[å¤‡ä»½åŠ å¯†]
    end

    subgraph "ç»ˆç«¯å®‰å…¨å±‚"
        D1[è®¾å¤‡è®¤è¯]
        D2[ç”Ÿç‰©è¯†åˆ«]
        D3[å®‰å…¨ç»ˆç«¯]
        D4[è¿œç¨‹æ“¦é™¤]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4

    B1 --> C1
    B2 --> C2
    B3 --> C3
    B4 --> C4

    C1 --> D1
    C2 --> D2
    C3 --> D3
    C4 --> D4
```

### å›½å¯†ç®—æ³•é›†æˆ

```java
@Service
public class CryptographicService {

    @Resource
    private SM2KeyService sm2KeyService;

    @Resource
    private SM3DigestService sm3DigestService;

    @Resource
    private SM4EncryptionService sm4EncryptionService;

    /**
     * SM2éå¯¹ç§°åŠ å¯†
     */
    public String sm2Encrypt(String plainText, String publicKey) {
        try {
            SM2Engine sm2Engine = new SM2Engine();
            SM2PublicKey sm2PublicKey = SM2KeyUtils.parsePublicKey(publicKey);

            byte[] encryptedData = sm2Engine.encrypt(
                plainText.getBytes(StandardCharsets.UTF_8), sm2PublicKey);

            return Base64.getEncoder().encodeToString(encryptedData);
        } catch (Exception e) {
            throw new CryptographicException("SM2åŠ å¯†å¤±è´¥", e);
        }
    }

    /**
     * SM3æ¶ˆæ¯æ‘˜è¦
     */
    public String sm3Digest(String data) {
        try {
            SM3Digest sm3 = new SM3Digest();
            byte[] dataBytes = data.getBytes(StandardCharsets.UTF_8);
            sm3.update(dataBytes, 0, dataBytes.length);

            byte[] digest = new byte[sm3.getDigestSize()];
            sm3.doFinal(digest, 0);

            return Hex.toHexString(digest);
        } catch (Exception e) {
            throw new CryptographicException("SM3æ‘˜è¦è®¡ç®—å¤±è´¥", e);
        }
    }

    /**
     * SM4å¯¹ç§°åŠ å¯†
     */
    public String sm4Encrypt(String plainText, String key) {
        try {
            SM4Engine sm4Engine = new SM4Engine();
            byte[] keyBytes = Hex.decode(key);
            KeyParameter keyParameter = new KeyParameter(keyBytes);

            sm4Engine.init(true, keyParameter);
            byte[] plainBytes = plainText.getBytes(StandardCharsets.UTF_8);
            byte[] encryptedBytes = new byte[sm4Engine.getOutputSize(plainBytes.length)];

            int len = sm4Engine.processBytes(plainBytes, 0, plainBytes.length, encryptedBytes, 0);
            sm4Engine.doFinal(encryptedBytes, len);

            return Base64.getEncoder().encodeToString(encryptedBytes);
        } catch (Exception e) {
            throw new CryptographicException("SM4åŠ å¯†å¤±è´¥", e);
        }
    }
}
```

## AIæŠ€æœ¯æ¶æ„

### å¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«å¼•æ“

```mermaid
graph TB
    subgraph "æ•°æ®é‡‡é›†å±‚"
        A1[æ‘„åƒå¤´é‡‡é›†]
        A2[æŒ‡çº¹é‡‡é›†å™¨]
        A3[æŒçº¹é‡‡é›†å™¨]
        A4[è™¹è†œé‡‡é›†å™¨]
        A5[å£°çº¹é‡‡é›†å™¨]
    end

    subgraph "é¢„å¤„ç†å±‚"
        B1[å›¾åƒé¢„å¤„ç†]
        B2[å™ªå£°è¿‡æ»¤]
        B3[æ ‡å‡†åŒ–å¤„ç†]
        B4[è´¨é‡è¯„ä¼°]
    end

    subgraph "ç‰¹å¾æå–å±‚"
        C1[äººè„¸ç‰¹å¾æå–]
        C2[æŒ‡çº¹ç‰¹å¾æå–]
        C3[æŒçº¹ç‰¹å¾æå–]
        C4[è™¹è†œç‰¹å¾æå–]
        C5[å£°çº¹ç‰¹å¾æå–]
    end

    subgraph "ç‰¹å¾èåˆå±‚"
        D1[å¤šæ¨¡æ€èåˆç®—æ³•]
        D2[æƒé‡åŠ¨æ€è°ƒæ•´]
        D3[ç½®ä¿¡åº¦è®¡ç®—]
        D4[å†³ç­–ä¼˜åŒ–]
    end

    subgraph "è¯†åˆ«åŒ¹é…å±‚"
        E1[ç‰¹å¾å‘é‡åŒ¹é…]
        E2[ç›¸ä¼¼åº¦è®¡ç®—]
        E3[é˜ˆå€¼åˆ¤æ–­]
        E4[æ´»ä½“æ£€æµ‹]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4
    A5 --> B1

    B1 --> C1
    B2 --> C2
    B3 --> C3
    B4 --> C4
    B1 --> C5

    C1 --> D1
    C2 --> D1
    C3 --> D1
    C4 --> D1
    C5 --> D1

    D1 --> E1
    D2 --> E2
    D3 --> E3
    D4 --> E4
```

### AIæ¨ç†å¼•æ“

```java
@Service
public class AIInferenceEngine {

    @Resource
    private ModelManager modelManager;

    @Resource
    private ThreadPoolExecutor inferenceExecutor;

    /**
     * å¤šæ¨¡æ€ç”Ÿç‰©è¯†åˆ«æ¨ç†
     */
    public CompletableFuture<RecognitionResult> recognizeMultiModal(
            MultiModalInput input) {

        return CompletableFuture.supplyAsync(() -> {
            try {
                // 1. æ•°æ®é¢„å¤„ç†
                PreprocessedData preprocessedData = preprocessInput(input);

                // 2. å¤šæ¨¡æ€ç‰¹å¾æå–
                Map<String, FeatureVector> features = extractFeatures(preprocessedData);

                // 3. ç‰¹å¾èåˆ
                FusedFeature fusedFeature = fuseFeatures(features);

                // 4. åŒ¹é…è¯†åˆ«
                RecognitionResult result = matchWithDatabase(fusedFeature);

                // 5. åå¤„ç†
                return postprocessResult(result);

            } catch (Exception e) {
                logger.error("å¤šæ¨¡æ€è¯†åˆ«æ¨ç†å¤±è´¥", e);
                throw new InferenceException("æ¨ç†å¤±è´¥", e);
            }
        }, inferenceExecutor);
    }

    /**
     * ç‰¹å¾æå–
     */
    private Map<String, FeatureVector> extractFeatures(PreprocessedData data) {
        Map<String, FeatureVector> features = new HashMap<>();

        // äººè„¸ç‰¹å¾æå–
        if (data.getFaceImage() != null) {
            Model faceModel = modelManager.getModel("face_recognition");
            features.put("face", faceModel.inference(data.getFaceImage()));
        }

        // æŒ‡çº¹ç‰¹å¾æå–
        if (data.getFingerprintImage() != null) {
            Model fingerprintModel = modelManager.getModel("fingerprint_recognition");
            features.put("fingerprint", fingerprintModel.inference(data.getFingerprintImage()));
        }

        // æŒçº¹ç‰¹å¾æå–
        if (data.getPalmPrintImage() != null) {
            Model palmModel = modelManager.getModel("palm_print_recognition");
            features.put("palm_print", palmModel.inference(data.getPalmPrintImage()));
        }

        return features;
    }

    /**
     * ç‰¹å¾èåˆç®—æ³•
     */
    private FusedFeature fuseFeatures(Map<String, FeatureVector> features) {
        // ä½¿ç”¨åŠ æƒå¹³å‡èåˆ
        Map<String, Double> weights = getFusionWeights();
        double[] fusedVector = new double[512]; // å‡è®¾ç‰¹å¾å‘é‡ç»´åº¦ä¸º512

        for (Map.Entry<String, FeatureVector> entry : features.entrySet()) {
            String modality = entry.getKey();
            FeatureVector vector = entry.getValue();
            double weight = weights.getOrDefault(modality, 0.0);

            for (int i = 0; i < fusedVector.length; i++) {
                fusedVector[i] += vector.getValue(i) * weight;
            }
        }

        return new FusedFeature(fusedVector);
    }
}
```

## æ€§èƒ½æ¶æ„è®¾è®¡

### é«˜å¹¶å‘å¤„ç†æ¶æ„

```mermaid
graph TB
    subgraph "è´Ÿè½½å‡è¡¡å±‚"
        A1[Nginxä¸»èŠ‚ç‚¹]
        A2[Nginxå¤‡ç”¨èŠ‚ç‚¹1]
        A3[Nginxå¤‡ç”¨èŠ‚ç‚¹2]
    end

    subgraph "APIç½‘å…³é›†ç¾¤"
        B1[GatewayèŠ‚ç‚¹1]
        B2[GatewayèŠ‚ç‚¹2]
        B3[GatewayèŠ‚ç‚¹3]
    end

    subgraph "ä¸šåŠ¡æœåŠ¡é›†ç¾¤"
        C1[ä¸€å¡é€šæœåŠ¡é›†ç¾¤]
        C2[é—¨ç¦æœåŠ¡é›†ç¾¤]
        C3[è€ƒå‹¤æœåŠ¡é›†ç¾¤]
        C4[ç”Ÿç‰©è¯†åˆ«æœåŠ¡é›†ç¾¤]
    end

    subgraph "ç¼“å­˜é›†ç¾¤"
        D1[Redisä¸»èŠ‚ç‚¹]
        D2[Redisä»èŠ‚ç‚¹1]
        D3[Redisä»èŠ‚ç‚¹2]
        D4[Rediså“¨å…µé›†ç¾¤]
    end

    subgraph "æ•°æ®åº“é›†ç¾¤"
        E1[MySQLä¸»åº“]
        E2[MySQLä»åº“1]
        E3[MySQLä»åº“2]
        E4[MySQLè¯»å†™åˆ†ç¦»]
    end

    A1 --> B1
    A1 --> B2
    A1 --> B3

    B1 --> C1
    B1 --> C2
    B1 --> C3
    B1 --> C4

    C1 --> D1
    C2 --> D1
    C3 --> D1
    C4 --> D1

    D1 --> E1
    E2 --> E1
    E3 --> E1
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```java
@Configuration
@EnableAsync
@EnableCaching
public class PerformanceConfig {

    /**
     * å¼‚æ­¥ä»»åŠ¡çº¿ç¨‹æ± é…ç½®
     */
    @Bean("cardTaskExecutor")
    public ThreadPoolTaskExecutor cardTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(20);
        executor.setMaxPoolSize(100);
        executor.setQueueCapacity(1000);
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("card-task-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        executor.initialize();
        return executor;
    }

    /**
     * ç”Ÿç‰©è¯†åˆ«å¼‚æ­¥çº¿ç¨‹æ± é…ç½®
     */
    @Bean("biometricExecutor")
    public ThreadPoolTaskExecutor biometricExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(500);
        executor.setKeepAliveSeconds(30);
        executor.setThreadNamePrefix("biometric-");
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.AbortPolicy());
        executor.initialize();
        return executor;
    }

    /**
     * Redisç¼“å­˜é…ç½®
     */
    @Bean
    public RedisCacheManager cacheManager(RedisConnectionFactory connectionFactory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair
                .fromSerializer(new GenericJackson2JsonRedisSerializer()));

        return RedisCacheManager.builder(connectionFactory)
            .cacheDefaults(config)
            .transactionAware()
            .build();
    }

    /**
     * JVMæ€§èƒ½è°ƒä¼˜
     */
    @Bean
    public JvmPerformanceTuner jvmPerformanceTuner() {
        return new JvmPerformanceTuner() {
            @PostConstruct
            public void tune() {
                // å †å†…å­˜é…ç½®
                System.setProperty("heap.size", "4g");

                // GCé…ç½®
                System.setProperty("gc.algorithm", "G1GC");
                System.setProperty("gc.max.pause", "200ms");

                // JITç¼–è¯‘ä¼˜åŒ–
                System.setProperty("jit.compile.threshold", "1000");
            }
        };
    }
}
```

## è¿ç»´æ¶æ„è®¾è®¡

### ç›‘æ§ä½“ç³»æ¶æ„

```mermaid
graph TB
    subgraph "åº”ç”¨ç›‘æ§"
        A1[Spring Boot Actuator]
        A2[MicrometeræŒ‡æ ‡æ”¶é›†]
        A3[è‡ªå®šä¹‰ä¸šåŠ¡ç›‘æ§]
    end

    subgraph "åŸºç¡€ç›‘æ§"
        B1[Prometheusç›‘æ§]
        B2[Grafanaå¯è§†åŒ–]
        B3[AlertManagerå‘Šè­¦]
    end

    subgraph "æ—¥å¿—ç›‘æ§"
        C1[Logbackæ—¥å¿—]
        C2[ELK Stackæ—¥å¿—æ”¶é›†]
        C3[Kibanaæ—¥å¿—åˆ†æ]
    end

    subgraph "é“¾è·¯ç›‘æ§"
        D1[Spring Cloud Sleuth]
        D2[Zipkiné“¾è·¯è¿½è¸ª]
        D3[æ€§èƒ½åˆ†æ]
    end

    subgraph "å‘Šè­¦é€šçŸ¥"
        E1[é‚®ä»¶é€šçŸ¥]
        E2[çŸ­ä¿¡é€šçŸ¥]
        E3[å¾®ä¿¡é€šçŸ¥]
        E4[é’‰é’‰é€šçŸ¥]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3

    C1 --> C2
    C2 --> C3

    D1 --> D2
    D2 --> D3

    B3 --> E1
    C3 --> E2
    D3 --> E3
    A3 --> E4
```

### å¥åº·æ£€æŸ¥æœºåˆ¶

```java
@Component
public class SystemHealthIndicator implements HealthIndicator {

    @Resource
    private DatabaseHealthChecker databaseHealthChecker;

    @Resource
    private RedisHealthChecker redisHealthChecker;

    @Resource
    private BiometricEngineHealthChecker biometricHealthChecker;

    @Override
    public Health health() {
        Health.Builder builder = Health.up();

        // æ•°æ®åº“å¥åº·æ£€æŸ¥
        Health dbHealth = databaseHealthChecker.check();
        builder.withDetail("database", dbHealth.getStatus().getCode());

        // Rediså¥åº·æ£€æŸ¥
        Health redisHealth = redisHealthChecker.check();
        builder.withDetail("redis", redisHealth.getStatus().getCode());

        // ç”Ÿç‰©è¯†åˆ«å¼•æ“å¥åº·æ£€æŸ¥
        Health biometricHealth = biometricHealthChecker.check();
        builder.withDetail("biometric_engine", biometricHealth.getStatus().getCode());

        // ç»¼åˆå¥åº·çŠ¶æ€
        if (dbHealth.getStatus() != Status.UP ||
            redisHealth.getStatus() != Status.UP ||
            biometricHealth.getStatus() != Status.UP) {
            return Health.down()
                .withDetail("database", dbHealth.getDetails())
                .withDetail("redis", redisHealth.getDetails())
                .withDetail("biometric_engine", biometricHealth.getDetails())
                .build();
        }

        return builder
            .withDetail("system", "All systems operational")
            .withDetail("uptime", getSystemUptime())
            .build();
    }
}
```

## éƒ¨ç½²æ¶æ„è®¾è®¡

### å®¹å™¨åŒ–éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'
services:
  # APIç½‘å…³
  api-gateway:
    image: ioe-dream/api-gateway:latest
    ports:
      - "80:80"
      - "443:443"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - EUREKA_SERVERS=eureka1:8761,eureka2:8762,eureka3:8763
    depends_on:
      - eureka1
      - eureka2
      - eureka3
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

  # æ³¨å†Œä¸­å¿ƒé›†ç¾¤
  eureka1:
    image: ioe-dream/eureka-server:latest
    ports:
      - "8761:8761"
    environment:
      - SPRING_PROFILES_ACTIVE=peer1
      - EUREKA_SERVERS=eureka2:8762,eureka3:8763

  eureka2:
    image: ioe-dream/eureka-server:latest
    ports:
      - "8762:8762"
    environment:
      - SPRING_PROFILES_ACTIVE=peer2
      - EUREKA_SERVERS=eureka1:8761,eureka3:8763

  eureka3:
    image: ioe-dream/eureka-server:latest
    ports:
      - "8763:8763"
    environment:
      - SPRING_PROFILES_ACTIVE=peer3
      - EUREKA_SERVERS=eureka1:8761,eureka2:8762

  # ä¸€å¡é€šæ ¸å¿ƒæœåŠ¡
  card-service:
    image: ioe-dream/card-service:latest
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - DB_HOST=mysql-master
      - REDIS_HOST=redis-cluster
    depends_on:
      - mysql-master
      - redis-cluster
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '2.0'
          memory: 2G

  # ç”Ÿç‰©è¯†åˆ«æœåŠ¡
  biometric-service:
    image: ioe-dream/biometric-service:latest
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - AI_ENGINE_URL=http://ai-engine:9090
    depends_on:
      - ai-engine
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '4.0'
          memory: 8G
        reservations:
          cpus: '2.0'
          memory: 4G

  # AIæ¨ç†å¼•æ“
  ai-engine:
    image: ioe-dream/ai-engine:latest
    ports:
      - "9090:9090"
    volumes:
      - /opt/ai-models:/app/models
      - /opt/gpu:/dev/dri
    deploy:
      resources:
        limits:
          cpus: '8.0'
          memory: 16G
        reservations:
          cpus: '4.0'
          memory: 8G
    runtime: nvidia

  # MySQLä¸»ä»é›†ç¾¤
  mysql-master:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=secure_password
      - MYSQL_REPLICATION_MODE=master
    volumes:
      - mysql_master_data:/var/lib/mysql
      - ./mysql/conf:/etc/mysql/conf.d

  mysql-slave1:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=secure_password
      - MYSQL_REPLICATION_MODE=slave
      - MYSQL_MASTER_HOST=mysql-master
    volumes:
      - mysql_slave1_data:/var/lib/mysql

  # Redisé›†ç¾¤
  redis-cluster:
    image: redis:7-alpine
    command: redis-server --cluster-enabled yes --cluster-config-file nodes.conf
    volumes:
      - redis_cluster_data:/data

volumes:
  mysql_master_data:
  mysql_slave1_data:
  redis_cluster_data:
```

### Kuberneteséƒ¨ç½²

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ioe-dream-platform
  labels:
    app: ioe-dream-platform
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ioe-dream-platform
  template:
    metadata:
      labels:
        app: ioe-dream-platform
    spec:
      containers:
      - name: ioe-dream-platform
        image: ioe-dream/platform:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        - name: DB_HOST
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: host
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: password
        - name: REDIS_HOST
          valueFrom:
            configMapKeyRef:
              name: redis-config
              key: host
        resources:
          requests:
            memory: "2Gi"
            cpu: "1000m"
          limits:
            memory: "4Gi"
            cpu: "2000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
          timeoutSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
        volumeMounts:
        - name: config-volume
          mountPath: /app/config
        - name: logs-volume
          mountPath: /app/logs
      volumes:
      - name: config-volume
        configMap:
          name: app-config
      - name: logs-volume
        persistentVolumeClaim:
          claimName: logs-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: ioe-dream-platform-service
spec:
  selector:
    app: ioe-dream-platform
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
  type: LoadBalancer
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ioe-dream-platform-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  tls:
  - hosts:
    - ioe-dream.example.com
    secretName: ioe-dream-tls
  rules:
  - host: ioe-dream.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: ioe-dream-platform-service
            port:
              number: 80
```

## å¼€å‘æµ‹è¯•æ¶æ„

### CI/CDæµæ°´çº¿

```mermaid
graph TB
    subgraph "ä»£ç æäº¤"
        A1[Git Push]
        A2[Pull Request]
        A3[ä»£ç å®¡æŸ¥]
    end

    subgraph "æ„å»ºé˜¶æ®µ"
        B1[Mavenæ„å»º]
        B2[å•å…ƒæµ‹è¯•]
        B3[ä»£ç æ‰«æ]
        B4[Dockeræ„å»º]
    end

    subgraph "æµ‹è¯•é˜¶æ®µ"
        C1[é›†æˆæµ‹è¯•]
        C2[æ€§èƒ½æµ‹è¯•]
        C3[å®‰å…¨æµ‹è¯•]
        C4[UIè‡ªåŠ¨åŒ–æµ‹è¯•]
    end

    subgraph "éƒ¨ç½²é˜¶æ®µ"
        D1[å¼€å‘ç¯å¢ƒéƒ¨ç½²]
        D2[æµ‹è¯•ç¯å¢ƒéƒ¨ç½²]
        D3[é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²]
        D4[ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²]
    end

    subgraph "ç›‘æ§åé¦ˆ"
        E1[æ„å»ºçŠ¶æ€ç›‘æ§]
        E2[éƒ¨ç½²çŠ¶æ€ç›‘æ§]
        E3[åº”ç”¨æ€§èƒ½ç›‘æ§]
        E4[é”™è¯¯ç›‘æ§å‘Šè­¦]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3

    B1 --> C1
    B2 --> C2
    B3 --> C3
    B4 --> C4

    C1 --> D1
    C2 --> D2
    C3 --> D3
    C4 --> D4

    D1 --> E1
    D2 --> E2
    D3 --> E3
    D4 --> E4
```

é€šè¿‡ä»¥ä¸Šå…¨é¢çš„æŠ€æœ¯æ¶æ„è®¾è®¡ï¼ŒIOE-DREAMæ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°å…·å¤‡äº†é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€é«˜å®‰å…¨æ€§çš„ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§å‹æ™ºæ…§å›­åŒºçš„å¤æ‚ä¸šåŠ¡éœ€æ±‚ï¼Œä¸ºç”¨æˆ·æä¾›ç¨³å®šå¯é çš„æœåŠ¡ä½“éªŒã€‚