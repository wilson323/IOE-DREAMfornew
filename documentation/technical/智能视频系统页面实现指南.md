# æ™ºèƒ½è§†é¢‘ç³»ç»Ÿé¡µé¢å®ç°æŒ‡å—

## ğŸ“‹ é¡µé¢å®ç°è¿›åº¦

### âœ… å·²å®Œæˆçš„é¡µé¢

1. **è®¾å¤‡åˆ—è¡¨é¡µé¢** (`device-list.vue`)
   - è·¯å¾„: `/business/smart-video/device-list`
   - åŠŸèƒ½: è®¾å¤‡æŸ¥è¯¢ã€æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ã€æ‰¹é‡æ“ä½œã€å¯¼å…¥å¯¼å‡º
   - ç‰¹è‰²: å®Œæ•´çš„CRUDæ“ä½œã€è¡¨å•éªŒè¯ã€Mockæ•°æ®æ”¯æŒ

2. **è®¾å¤‡åˆ†ç»„é¡µé¢** (`device-group.vue`)
   - è·¯å¾„: `/business/smart-video/device-group`
   - åŠŸèƒ½: æ ‘å½¢åˆ†ç»„ç®¡ç†ã€è®¾å¤‡å¡ç‰‡å±•ç¤ºã€æ‹–æ‹½ç§»åŠ¨
   - ç‰¹è‰²: å·¦å³åˆ†æ å¸ƒå±€ã€è®¾å¤‡ç»Ÿè®¡

3. **è§£ç å™¨ç®¡ç†é¡µé¢** (`decoder-management.vue`)
   - è·¯å¾„: éœ€åœ¨è·¯ç”±ä¸­é…ç½®
   - åŠŸèƒ½: è§£ç å™¨è®¾å¤‡ç®¡ç†

4. **ç³»ç»Ÿæ¦‚è§ˆé¡µé¢** (`system-overview.vue`)
   - è·¯å¾„: `/business/smart-video/system-overview`
   - åŠŸèƒ½: KPIæŒ‡æ ‡å¡ç‰‡ã€EChartså›¾è¡¨ã€å®æ—¶æ•°æ®æ›´æ–°
   - ç‰¹è‰²: Dashboardæ ·å¼ã€å“åº”å¼å¸ƒå±€ã€å®šæ—¶æ•°æ®åˆ·æ–°

### ğŸ“ å¾…å®ç°çš„é¡µé¢æ¸…å•

#### è§†é¢‘ç›‘æ§æ¨¡å— (5ä¸ª)
- [ ] è§†é¢‘ç›‘æ§é¢„è§ˆé¡µé¢
- [ ] è§†é¢‘å›æ”¾é¡µé¢
- [ ] å•è·¯å›æ”¾é¡µé¢
- [ ] è§†é¢‘é¢„è§ˆé¡µé¢
- [ ] è§†é¢‘ä¸Šå¢™é¡µé¢

#### å¤§å±æ˜¾ç¤ºæ¨¡å— (2ä¸ª)
- [ ] å¤§å±ç›‘æ§é¡µé¢
- [ ] ç”µè§†å¢™ç®¡ç†é¡µé¢

#### æ™ºèƒ½åˆ†ææ¨¡å— (6ä¸ª)
- [ ] è¡Œä¸ºåˆ†æé¡µé¢
- [ ] äººè„¸æœç´¢é¡µé¢
- [ ] ç›®æ ‡æœç´¢é¡µé¢
- [ ] äººç¾¤æ€åŠ¿åˆ†æé¡µé¢
- [ ] æ™ºèƒ½ç›®æ ‡åˆ†æé¡µé¢
- [ ] ç®—æ³•æ¨¡å¼é…ç½®é¡µé¢

#### çƒ­åŠ›åˆ†ææ¨¡å— (2ä¸ª)
- [ ] çƒ­åŠ›å›¾åˆ†æé¡µé¢
- [ ] çƒ­åŠ›ç»Ÿè®¡é¡µé¢

#### å‘Šè­¦è”åŠ¨æ¨¡å— (4ä¸ª)
- [ ] å†å²å‘Šè­¦é¡µé¢
- [ ] äº‹ä»¶è®¢é˜…é¡µé¢
- [ ] è”åŠ¨é…ç½®é¡µé¢
- [ ] è”åŠ¨è®°å½•é¡µé¢

#### ç³»ç»Ÿç®¡ç†æ¨¡å— (1ä¸ª)
- [ ] ä¸‹è½½ä¸­å¿ƒé¡µé¢

## ğŸš€ å¿«é€Ÿå®ç°æ–°é¡µé¢çš„æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡µé¢æ–‡ä»¶

åœ¨ `src/views/business/smart-video/` ç›®å½•ä¸‹åˆ›å»ºæ–°é¡µé¢æ–‡ä»¶ï¼Œä¾‹å¦‚ `history-alarm.vue`:

```vue
<!--
  æ™ºèƒ½è§†é¢‘-å†å²å‘Šè­¦é¡µé¢

  @Author:    Claude Code
  @Date:      2024-11-05
  @Copyright  1024åˆ›æ–°å®éªŒå®¤ ï¼ˆ https://1024lab.net ï¼‰ï¼ŒSince 2012
-->
<template>
  <div class="history-alarm">
    <!-- æŸ¥è¯¢å·¥å…·æ  -->
    <a-card :bordered="false">
      <a-form class="smart-query-table-form">
        <a-row :gutter="16">
          <!-- æŸ¥è¯¢è¡¨å•å­—æ®µ -->
          <a-col :span="6">
            <a-form-item label="å‘Šè­¦æ—¶é—´">
              <a-range-picker
                v-model:value="queryForm.timeRange"
                style="width: 100%"
              />
            </a-form-item>
          </a-col>
          <!-- æ›´å¤šæŸ¥è¯¢å­—æ®µ... -->

          <a-col :span="6">
            <a-form-item>
              <a-space>
                <a-button type="primary" @click="queryData">
                  <template #icon><SearchOutlined /></template>
                  æŸ¥è¯¢
                </a-button>
                <a-button @click="resetQuery">
                  <template #icon><ReloadOutlined /></template>
                  é‡ç½®
                </a-button>
              </a-space>
            </a-form-item>
          </a-col>
        </a-row>
      </a-form>
    </a-card>

    <!-- æ“ä½œæŒ‰é’®åŒº -->
    <a-card :bordered="false" class="smart-margin-top10">
      <div class="smart-query-table-operation">
        <a-space>
          <a-button @click="exportData">
            <template #icon><DownloadOutlined /></template>
            å¯¼å‡º
          </a-button>
          <!-- æ›´å¤šæ“ä½œæŒ‰é’®... -->
        </a-space>
      </div>

      <!-- æ•°æ®è¡¨æ ¼ -->
      <a-table
        :columns="columns"
        :data-source="tableData"
        :pagination="pagination"
        :loading="tableLoading"
        :scroll="{ x: 1200 }"
        row-key="id"
        bordered
        @change="handleTableChange"
        class="smart-margin-top10"
      >
        <!-- è‡ªå®šä¹‰åˆ—æ¸²æŸ“ -->
        <template #bodyCell="{ column, record }">
          <template v-if="column.dataIndex === 'level'">
            <a-tag :color="getAlarmLevelColor(record.level)">
              {{ record.level }}
            </a-tag>
          </template>

          <template v-else-if="column.dataIndex === 'action'">
            <a-space>
              <a-button type="link" size="small" @click="viewDetail(record)">
                æŸ¥çœ‹è¯¦æƒ…
              </a-button>
            </a-space>
          </template>
        </template>
      </a-table>
    </a-card>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  SearchOutlined,
  ReloadOutlined,
  DownloadOutlined,
} from '@ant-design/icons-vue';

// æŸ¥è¯¢è¡¨å•
const queryForm = reactive({
  timeRange: [],
  level: '',
});

// è¡¨æ ¼æ•°æ®
const tableData = ref([]);
const tableLoading = ref(false);

// åˆ†é¡µ
const pagination = reactive({
  current: 1,
  pageSize: 20,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `å…± ${total} æ¡`,
});

// è¡¨æ ¼åˆ—é…ç½®
const columns = [
  {
    title: 'åºå·',
    dataIndex: 'index',
    key: 'index',
    width: 80,
    customRender: ({ index }) => index + 1,
  },
  {
    title: 'å‘Šè­¦æ—¶é—´',
    dataIndex: 'time',
    key: 'time',
    width: 160,
  },
  {
    title: 'è®¾å¤‡åç§°',
    dataIndex: 'deviceName',
    key: 'deviceName',
    width: 180,
  },
  {
    title: 'å‘Šè­¦çº§åˆ«',
    dataIndex: 'level',
    key: 'level',
    width: 100,
  },
  {
    title: 'å‘Šè­¦å†…å®¹',
    dataIndex: 'content',
    key: 'content',
    ellipsis: true,
  },
  {
    title: 'æ“ä½œ',
    dataIndex: 'action',
    key: 'action',
    width: 120,
    fixed: 'right',
  },
];

// Mockæ•°æ®
const mockData = [
  {
    id: 1,
    time: '2024-11-05 15:32:10',
    deviceName: 'å‰é—¨æ‘„åƒå¤´-001',
    level: 'é«˜å±',
    content: 'æ£€æµ‹åˆ°å¯ç–‘äººå‘˜å¾˜å¾Š',
  },
  // æ›´å¤šMockæ•°æ®...
];

// æŸ¥è¯¢æ•°æ®
const queryData = () => {
  tableLoading.value = true;

  setTimeout(() => {
    tableData.value = mockData;
    pagination.total = mockData.length;
    tableLoading.value = false;
  }, 300);
};

// é‡ç½®æŸ¥è¯¢
const resetQuery = () => {
  Object.assign(queryForm, {
    timeRange: [],
    level: '',
  });
  pagination.current = 1;
  queryData();
};

// è¡¨æ ¼å˜åŒ–å¤„ç†
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  queryData();
};

// å¯¼å‡ºæ•°æ®
const exportData = () => {
  message.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
};

// æŸ¥çœ‹è¯¦æƒ…
const viewDetail = (record) => {
  message.info(`æŸ¥çœ‹å‘Šè­¦è¯¦æƒ…: ${record.deviceName}`);
};

// è·å–å‘Šè­¦çº§åˆ«é¢œè‰²
const getAlarmLevelColor = (level) => {
  const colorMap = {
    'é«˜å±': 'red',
    'ä¸­å±': 'orange',
    'ä½å±': 'blue',
  };
  return colorMap[level] || 'default';
};

// åˆå§‹åŒ–
onMounted(() => {
  queryData();
});
</script>

<style scoped lang="less">
.history-alarm {
  padding: 24px;
  background-color: #f0f2f5;

  .smart-margin-top10 {
    margin-top: 10px;
  }

  .smart-query-table-form {
    margin-bottom: 0;
  }

  .smart-query-table-operation {
    margin-bottom: 16px;
  }
}
</style>
```

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ è·¯ç”±é…ç½®

åœ¨ `src/router/business/smart-video.js` ä¸­æ·»åŠ è·¯ç”±:

```javascript
{
  path: '/business/smart-video/history-alarm',
  name: 'SmartVideoHistoryAlarm',
  component: () => import('/@/views/business/smart-video/history-alarm.vue'),
  meta: {
    title: 'æ™ºèƒ½è§†é¢‘ - å†å²å‘Šè­¦',
    menuType: MENU_TYPE_ENUM.MENU.value,
    icon: 'WarningOutlined',
    hideInMenu: false,
    keepAlive: true,
  },
},
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºAPIæ¥å£ï¼ˆå¯é€‰ï¼‰

åœ¨ `src/api/business/smart-video/` ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„APIæ–‡ä»¶:

```javascript
// history-alarm-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const historyAlarmApi = {
  // æŸ¥è¯¢å†å²å‘Šè­¦
  queryHistoryAlarms: (params) => postRequest('/alarm/history/query', params),

  // å¯¼å‡ºå‘Šè­¦æ•°æ®
  exportAlarms: (params) => postRequest('/alarm/history/export', params),

  // è·å–å‘Šè­¦è¯¦æƒ…
  getAlarmDetail: (id) => getRequest(`/alarm/history/detail/${id}`),
};
```

### ç¬¬å››æ­¥ï¼šåˆ›å»ºMockæ•°æ®ï¼ˆå¼€å‘é˜¶æ®µï¼‰

åœ¨ `src/views/business/smart-video/mock/` ç›®å½•ä¸‹åˆ›å»ºMockæ•°æ®æ–‡ä»¶:

```javascript
// history-alarm-mock-data.js
export const mockHistoryAlarms = [
  {
    id: 1,
    time: '2024-11-05 15:32:10',
    deviceName: 'å‰é—¨æ‘„åƒå¤´-001',
    deviceCode: 'CAM-001',
    level: 'é«˜å±',
    type: 'è¡Œä¸ºåˆ†æ',
    content: 'æ£€æµ‹åˆ°å¯ç–‘äººå‘˜å¾˜å¾Š',
    status: 'å·²å¤„ç†',
  },
  // æ›´å¤šæ•°æ®...
];

export default {
  mockQueryHistoryAlarms: (params) => {
    let list = [...mockHistoryAlarms];

    // ç­›é€‰é€»è¾‘
    if (params.level) {
      list = list.filter(item => item.level === params.level);
    }

    // åˆ†é¡µ
    const pageNum = params.pageNum || 1;
    const pageSize = params.pageSize || 20;
    const total = list.length;
    const start = (pageNum - 1) * pageSize;
    const end = start + pageSize;

    return {
      code: 1,
      msg: 'æŸ¥è¯¢æˆåŠŸ',
      data: {
        list: list.slice(start, end),
        total,
        pageNum,
        pageSize,
      },
    };
  },
};
```

## ğŸ’¡ å¼€å‘æŠ€å·§å’Œæœ€ä½³å®è·µ

### 1. ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„æ ·å¼ç±»

é¡¹ç›®å·²æœ‰çš„æ ·å¼ç±»,å¯ç›´æ¥ä½¿ç”¨:
- `.smart-query-table-form` - æŸ¥è¯¢è¡¨å•å®¹å™¨
- `.smart-query-table-operation` - æ“ä½œæŒ‰é’®åŒº
- `.smart-margin-top10` - é¡¶éƒ¨10pxé—´è·
- `.smart-table-operate` - è¡¨æ ¼æ“ä½œåˆ—æ ·å¼

### 2. å›¾æ ‡ä½¿ç”¨è§„èŒƒ

ç¡®ä¿ä½¿ç”¨ `@ant-design/icons-vue` ä¸­å®é™…å­˜åœ¨çš„å›¾æ ‡:

```javascript
// å¸¸ç”¨å›¾æ ‡
import {
  SearchOutlined,      // æœç´¢
  ReloadOutlined,      // é‡ç½®/åˆ·æ–°
  PlusOutlined,        // æ–°å¢
  DeleteOutlined,      // åˆ é™¤
  EditOutlined,        // ç¼–è¾‘
  EyeOutlined,         // æŸ¥çœ‹
  DownloadOutlined,    // ä¸‹è½½
  UploadOutlined,      // ä¸Šä¼ 
  SettingOutlined,     // è®¾ç½®
  WarningOutlined,     // å‘Šè­¦
  CheckCircleOutlined, // æˆåŠŸ/åœ¨çº¿
  CloseCircleOutlined, // å¤±è´¥/ç¦»çº¿
} from '@ant-design/icons-vue';
```

### 3. å“åº”å¼å¸ƒå±€

ä½¿ç”¨Ant Designçš„Gridç³»ç»Ÿ:

```vue
<a-row :gutter="16">
  <a-col :span="24" :lg="12" :xl="8">
    <!-- å†…å®¹ -->
  </a-col>
</a-row>
```

### 4. è¡¨å•éªŒè¯è§„åˆ™

```javascript
const formRules = {
  deviceName: [
    { required: true, message: 'è¯·è¾“å…¥è®¾å¤‡åç§°', trigger: 'blur' },
    { min: 2, max: 50, message: 'é•¿åº¦åœ¨2-50ä¸ªå­—ç¬¦', trigger: 'blur' },
  ],
  ipAddress: [
    { required: true, message: 'è¯·è¾“å…¥IPåœ°å€', trigger: 'blur' },
    {
      pattern: /^(\d{1,3}\.){3}\d{1,3}$/,
      message: 'è¯·è¾“å…¥æ­£ç¡®çš„IPåœ°å€',
      trigger: 'blur',
    },
  ],
};
```

### 5. å¼‚æ­¥æ“ä½œå¤„ç†

```javascript
const handleSubmit = async () => {
  try {
    loading.value = true;
    const result = await api.someMethod(params);

    if (result.code === 1) {
      message.success('æ“ä½œæˆåŠŸ');
      queryData();
    } else {
      message.error(result.msg || 'æ“ä½œå¤±è´¥');
    }
  } catch (error) {
    console.error('æ“ä½œå¤±è´¥:', error);
    message.error('æ“ä½œå¤±è´¥');
  } finally {
    loading.value = false;
  }
};
```

### 6. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

```javascript
import { onMounted, onUnmounted } from 'vue';

let timer = null;

onMounted(() => {
  // åˆå§‹åŒ–
  queryData();

  // å®šæ—¶ä»»åŠ¡
  timer = setInterval(() => {
    // åˆ·æ–°æ•°æ®
  }, 30000);
});

onUnmounted(() => {
  // æ¸…ç†
  if (timer) {
    clearInterval(timer);
    timer = null;
  }
});
```

## ğŸ“š å‚è€ƒé¡µé¢å¯¹ç…§è¡¨

éœ€è¦å®ç°æ–°é¡µé¢æ—¶,å¯å‚è€ƒä»¥ä¸‹å·²å®Œæˆé¡µé¢:

| æ–°é¡µé¢ç±»å‹ | å‚è€ƒé¡µé¢ | å…³é”®ç‰¹æ€§ |
|---|---|---|
| åˆ—è¡¨æŸ¥è¯¢é¡µé¢ | device-list.vue | æŸ¥è¯¢è¡¨å•ã€æ•°æ®è¡¨æ ¼ã€åˆ†é¡µã€CRUDæ“ä½œ |
| æ ‘å½¢+åˆ—è¡¨é¡µé¢ | device-group.vue | å·¦å³åˆ†æ ã€æ ‘å½¢ç»“æ„ã€å¡ç‰‡å±•ç¤º |
| Dashboardé¡µé¢ | system-overview.vue | KPIå¡ç‰‡ã€EChartså›¾è¡¨ã€å®æ—¶æ•°æ® |
| è¡¨å•å¼¹çª—é¡µé¢ | DeviceForm.vue | è¡¨å•éªŒè¯ã€Modalç»„ä»¶ã€Propsä¼ å€¼ |

## âš ï¸ å¸¸è§é—®é¢˜å’Œæ³¨æ„äº‹é¡¹

### 1. Props v-model é—®é¢˜

âŒ é”™è¯¯:
```vue
<a-modal v-model:open="props.visible" />
```

âœ… æ­£ç¡®:
```vue
<a-modal :open="props.visible" @cancel="emit('update:visible', false)" />
```

### 2. å›¾è¡¨å†…å­˜æ³„æ¼

ç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶æ¸…ç†å›¾è¡¨å®ä¾‹:

```javascript
onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
});
```

### 3. Mockæ•°æ®åˆ‡æ¢

å¼€å‘é˜¶æ®µä½¿ç”¨Mockæ•°æ®,ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢åˆ°çœŸå®API:

```javascript
const useMock = import.meta.env.MODE === 'localhost'; // æ ¹æ®ç¯å¢ƒå˜é‡åˆ¤æ–­

if (useMock) {
  result = mockData.mockQueryData(params);
} else {
  result = await api.queryData(params);
}
```

## ğŸ¯ å®ç°ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. å†å²å‘Šè­¦é¡µé¢
2. è§†é¢‘ç›‘æ§é¢„è§ˆé¡µé¢
3. äº‹ä»¶è®¢é˜…é¡µé¢

### ä¸­ä¼˜å…ˆçº§ï¼ˆå¸¸ç”¨åŠŸèƒ½ï¼‰
4. è§†é¢‘å›æ”¾é¡µé¢
5. è”åŠ¨é…ç½®é¡µé¢
6. ä¸‹è½½ä¸­å¿ƒé¡µé¢

### ä½ä¼˜å…ˆçº§ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
7-19. å…¶ä»–æ™ºèƒ½åˆ†æå’Œç»Ÿè®¡é¡µé¢

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- SmartAdminå®˜ç½‘: https://smartadmin.vip
- å¼€å‘æ–‡æ¡£: AIå¼€å‘æ–‡æ¡£/ ç›®å½•ä¸‹å„é¡µé¢çš„è¯¦ç»†æ–‡æ¡£
- é¡¹ç›®é…ç½®: CLAUDE.md æ–‡ä»¶

## ğŸ”„ å¿«é€Ÿå¤åˆ¶ç°æœ‰é¡µé¢

æœ€å¿«çš„å®ç°æ–¹å¼:
1. å¤åˆ¶ `device-list.vue` ä½œä¸ºæ¨¡æ¿
2. ä¿®æ”¹é¡µé¢æ ‡é¢˜å’Œæ–‡ä»¶æ³¨é‡Š
3. è°ƒæ•´æŸ¥è¯¢è¡¨å•å­—æ®µ
4. ä¿®æ”¹è¡¨æ ¼åˆ—é…ç½®
5. æ›¿æ¢Mockæ•°æ®
6. æ›´æ–°è·¯ç”±é…ç½®

è¿™æ ·å¯ä»¥åœ¨10-15åˆ†é’Ÿå†…å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°é¡µé¢çš„åŸºæœ¬ç»“æ„ï¼
