# 联动记录页面功能与布局文档

## 页面概述
联动记录页面是智能视频监控系统中的联动报表模块，用于查询、展示和统计分析联动规则执行的历史记录。该页面基于SmartAdmin前端框架构建，采用Vue3 + Ant Design Vue技术栈，提供联动记录查询、执行详情查看、统计分析、图表展示和记录导出等功能。支持列表和图表两种视图模式切换。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **图表库**: Chart.js（用于统计图表）

### 项目文件组织结构
```
src/views/business/smart-video/
├── linkage-record.vue              # 联动记录主页面
├── components/
│   ├── RecordTable.vue            # 记录列表组件
│   ├── RecordFilter.vue           # 查询条件组件
│   ├── RecordDetailModal.vue     # 记录详情弹窗
│   ├── VideoPlayerModal.vue      # 视频播放弹窗
│   ├── RecordStatistics.vue      # 统计图表组件
│   └── RecordExport.vue          # 记录导出组件
├── mock/
│   └── record-mock-data.js        # 模拟数据
└── api/
    └── linkage-record-api.js      # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/linkage-record-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const linkageRecordApi = {
  // 查询联动记录列表
  queryRecords: (params) => postRequest('/linkage/record/query', params),

  // 获取记录详情
  getRecordDetail: (id) => getRequest(`/linkage/record/detail/${id}`),

  // 删除记录
  deleteRecord: (id) => getRequest(`/linkage/record/delete/${id}`),

  // 批量删除记录
  batchDeleteRecords: (ids) => postRequest('/linkage/record/batch/delete', ids),

  // 清空所有记录
  clearAllRecords: () => postRequest('/linkage/record/clear-all'),

  // 导出记录
  exportRecords: (params) => postRequest('/linkage/record/export', params),

  // 获取统计数据
  getStatistics: (params) => postRequest('/linkage/record/statistics', params),

  // 获取录像文件URL
  getVideoUrl: (recordId) => getRequest(`/linkage/record/video/${recordId}`),

  // 获取抓拍图片URL
  getCaptureUrl: (recordId) => getRequest(`/linkage/record/capture/${recordId}`),

  // 获取每日趋势数据
  getTrendData: (params) => postRequest('/linkage/record/trend', params),
};
```

## 开发注意事项与常见错误避免

### 1. Vue 3 组件开发注意事项

#### 错误用法：在 props 上使用 v-model
```vue
<!-- 错误：不能在props上使用v-model -->
<template>
  <a-modal v-model:open="visible" title="记录详情">
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean  // props是只读的，不能直接绑定v-model
});
</script>
```

#### 正确用法：使用 :open 绑定和事件
```vue
<!-- 正确：使用属性绑定和事件监听 -->
<template>
  <a-modal
    :open="visible"
    title="记录详情"
    @update:open="handleUpdateVisible"
    @cancel="handleCancel"
  >
    <!-- 内容 -->
  </a-modal>
</template>

<script setup>
const props = defineProps({
  visible: Boolean
});

const emit = defineEmits(['update:visible', 'cancel']);

const handleUpdateVisible = (value) => {
  emit('update:visible', value);
};

const handleCancel = () => {
  emit('update:visible', false);
  emit('cancel');
};
</script>
```

### 2. 图标导入注意事项

#### 正确：使用存在的图标
```vue
<script setup>
import {
  HistoryOutlined,           // 历史记录
  SearchOutlined,            // 搜索
  ReloadOutlined,            // 刷新
  DeleteOutlined,            // 删除
  DownloadOutlined,          // 导出
  UnorderedListOutlined,     // 列表视图
  BarChartOutlined,          // 图表视图
  EyeOutlined,               // 查看详情
  PlayCircleOutlined,        // 播放视频
  CameraOutlined,            // 抓拍图片
  FilterOutlined,            // 筛选
  UndoOutlined,              // 重置
  CheckCircleOutlined,       // 成功
  CloseCircleOutlined,       // 失败
  ExclamationCircleOutlined, // 警告
  CalendarOutlined,          // 时间
  EnvironmentOutlined,       // 区域
  VideoCameraOutlined,       // 视频
  PieChartOutlined,          // 饼图
  LineChartOutlined,         // 折线图
} from '@ant-design/icons-vue';
</script>
```

### 3. 联动记录数据结构

#### 记录数据结构
```javascript
const linkageRecord = {
  id: 'record001',
  occurTime: '2024-01-30 14:35:22',
  eventName: '移动侦测报警',
  linkageCondition: '周界入侵联动',
  device: 'Camera-001 前门摄像头',
  area: '主楼',
  hasVideo: true,
  hasCapture: true,
  status: 'success', // success | failed | partial
  description: '检测到人员进入限制区域，触发录像和报警',

  // 详细信息
  triggerInfo: {
    ruleId: 'link001',
    ruleName: '周界入侵联动',
    conditionType: 'intrusion_region',
    conditionName: '区域入侵',
  },

  // 执行动作
  actions: [
    {
      type: 'record',
      name: '录像',
      status: 'success',
      duration: '60s',
    },
    {
      type: 'capture',
      name: '抓拍',
      status: 'success',
      count: 3,
    },
    {
      type: 'alarm',
      name: '报警输出',
      status: 'success',
    }
  ],

  // 相关文件
  files: {
    videoUrl: '/videos/record001.mp4',
    captureUrls: [
      '/captures/record001_1.jpg',
      '/captures/record001_2.jpg',
      '/captures/record001_3.jpg',
    ],
  }
};
```

### 4. 查询条件处理

#### 查询参数示例
```javascript
const searchParams = {
  // 时间范围
  startTime: '2024-01-27 00:00:00',
  endTime: '2024-01-30 23:59:59',

  // 过滤条件
  eventName: '移动侦测',
  channelName: '前门摄像头',
  area: 'main-building',
  deviceType: 'NVR800',
  status: 'success', // success | failed | partial

  // 分页
  pageNum: 1,
  pageSize: 25,
};
```

## 页面布局结构

### 1. 页面头部（Header）
```vue
<template>
  <div class="linkage-record-header">
    <a-page-header
      title="联动报表"
      :breadcrumb="breadcrumb"
    >
      <template #extra>
        <a-space>
          <!-- 视图切换 -->
          <a-radio-group v-model:value="viewType" button-style="solid">
            <a-radio-button value="list">
              <unordered-list-outlined />
              列表
            </a-radio-button>
            <a-radio-button value="chart">
              <bar-chart-outlined />
              图表
            </a-radio-button>
          </a-radio-group>

          <!-- 清空数据 -->
          <a-button
            danger
            @click="handleClearData"
          >
            <template #icon><delete-outlined /></template>
            清空数据
          </a-button>

          <!-- 刷新 -->
          <a-button @click="handleRefresh">
            <template #icon><reload-outlined /></template>
            刷新
          </a-button>
        </a-space>
      </template>
    </a-page-header>
  </div>
</template>
```

### 2. 查询条件区域（Filter）
```vue
<template>
  <a-card class="filter-card" :bordered="false">
    <a-form
      ref="filterFormRef"
      :model="filterForm"
      layout="vertical"
    >
      <a-row :gutter="16">
        <!-- 基础查询条件 -->
        <a-col :span="6">
          <a-form-item label="开始时间" name="startTime">
            <a-date-picker
              v-model:value="filterForm.startTime"
              show-time
              format="YYYY-MM-DD HH:mm:ss"
              :style="{ width: '100%' }"
            />
          </a-form-item>
        </a-col>

        <a-col :span="6">
          <a-form-item label="结束时间" name="endTime">
            <a-date-picker
              v-model:value="filterForm.endTime"
              show-time
              format="YYYY-MM-DD HH:mm:ss"
              :style="{ width: '100%' }"
            />
          </a-form-item>
        </a-col>

        <a-col :span="6">
          <a-form-item label="事件名称" name="eventName">
            <a-input
              v-model:value="filterForm.eventName"
              placeholder="输入事件名称..."
              allow-clear
            />
          </a-form-item>
        </a-col>

        <a-col :span="6">
          <a-form-item label="通道名称" name="channelName">
            <a-input
              v-model:value="filterForm.channelName"
              placeholder="输入通道名称..."
              allow-clear
            />
          </a-form-item>
        </a-col>
      </a-row>

      <!-- 更多查询条件（可折叠） -->
      <a-collapse v-model:activeKey="moreFiltersVisible" :bordered="false">
        <a-collapse-panel key="1" header="更多查询条件">
          <a-row :gutter="16">
            <a-col :span="8">
              <a-form-item label="区域名称" name="area">
                <a-select
                  v-model:value="filterForm.area"
                  placeholder="选择区域"
                  allow-clear
                >
                  <a-select-option value="">全部区域</a-select-option>
                  <a-select-option value="main-building">主楼</a-select-option>
                  <a-select-option value="warehouse">仓库区</a-select-option>
                  <a-select-option value="parking">停车场</a-select-option>
                  <a-select-option value="entrance">出入口</a-select-option>
                </a-select>
              </a-form-item>
            </a-col>

            <a-col :span="8">
              <a-form-item label="设备类型" name="deviceType">
                <a-select
                  v-model:value="filterForm.deviceType"
                  placeholder="选择设备类型"
                  allow-clear
                >
                  <a-select-option value="">全部设备</a-select-option>
                  <a-select-option value="NVR800">NVR800</a-select-option>
                  <a-select-option value="IVS1800">IVS1800</a-select-option>
                  <a-select-option value="ZKNVR">ZKNVR</a-select-option>
                  <a-select-option value="AIBox">AI智能分析盒</a-select-option>
                </a-select>
              </a-form-item>
            </a-col>

            <a-col :span="8">
              <a-form-item label="联动状态" name="status">
                <a-select
                  v-model:value="filterForm.status"
                  placeholder="选择状态"
                  allow-clear
                >
                  <a-select-option value="">全部状态</a-select-option>
                  <a-select-option value="success">执行成功</a-select-option>
                  <a-select-option value="failed">执行失败</a-select-option>
                  <a-select-option value="partial">部分成功</a-select-option>
                </a-select>
              </a-form-item>
            </a-col>
          </a-row>
        </a-collapse-panel>
      </a-collapse>

      <!-- 操作按钮 -->
      <a-row>
        <a-col :span="24" style="text-align: right;">
          <a-space>
            <a-button type="primary" @click="handleSearch">
              <template #icon><search-outlined /></template>
              查询
            </a-button>
            <a-button @click="handleReset">
              <template #icon><undo-outlined /></template>
              重置
            </a-button>
            <a-button @click="handleExport">
              <template #icon><download-outlined /></template>
              导出
            </a-button>
          </a-space>
        </a-col>
      </a-row>
    </a-form>
  </a-card>
</template>
```

### 3. 列表视图（Table View）
```vue
<template>
  <a-card v-show="viewType === 'list'" :bordered="false" class="table-card">
    <template #title>
      <a-space>
        <unordered-list-outlined />
        <span>联动记录</span>
        <a-tag color="blue">共 {{ pagination.total }} 条记录</a-tag>
      </a-space>
    </template>

    <a-table
      :columns="columns"
      :data-source="recordList"
      :loading="loading"
      :pagination="pagination"
      :row-selection="rowSelection"
      :scroll="{ x: 1200, y: 'calc(100vh - 500px)' }"
      @change="handleTableChange"
    >
      <!-- 发生时间 -->
      <template #occurTime="{ text }">
        <a-space>
          <calendar-outlined />
          {{ text }}
        </a-space>
      </template>

      <!-- 事件名称 -->
      <template #eventName="{ record }">
        <div>
          <div class="font-medium">{{ record.eventName }}</div>
          <div class="text-gray-500 text-xs">{{ record.description }}</div>
        </div>
      </template>

      <!-- 文件 -->
      <template #files="{ record }">
        <a-space>
          <a-tooltip v-if="record.hasVideo" title="播放录像">
            <a-button
              type="link"
              size="small"
              @click="handlePlayVideo(record)"
            >
              <play-circle-outlined />
            </a-button>
          </a-tooltip>

          <a-tooltip v-if="record.hasCapture" title="查看抓拍">
            <a-button
              type="link"
              size="small"
              @click="handleViewCapture(record)"
            >
              <camera-outlined />
            </a-button>
          </a-tooltip>

          <span v-if="!record.hasVideo && !record.hasCapture" class="text-gray-400">-</span>
        </a-space>
      </template>

      <!-- 状态 -->
      <template #status="{ text }">
        <a-tag
          :color="getStatusColor(text)"
        >
          <template #icon>
            <component :is="getStatusIcon(text)" />
          </template>
          {{ getStatusText(text) }}
        </a-tag>
      </template>

      <!-- 操作 -->
      <template #action="{ record }">
        <a-space>
          <a-button
            type="link"
            size="small"
            @click="handleViewDetail(record)"
          >
            <eye-outlined />
          </a-button>

          <a-popconfirm
            title="确定要删除这条记录吗？"
            @confirm="handleDelete(record.id)"
          >
            <a-button
              type="link"
              danger
              size="small"
            >
              <delete-outlined />
            </a-button>
          </a-popconfirm>
        </a-space>
      </template>
    </a-table>
  </a-card>
</template>
```

### 4. 图表视图（Chart View）
```vue
<template>
  <a-card v-show="viewType === 'chart'" :bordered="false" class="chart-card">
    <template #title>
      <a-space>
        <bar-chart-outlined />
        <span>联动统计报表</span>
        <a-tag color="blue">共 {{ statistics.totalCount }} 条记录</a-tag>
      </a-space>
    </template>

    <!-- 统计卡片 -->
    <a-row :gutter="16" class="mb-4">
      <a-col :span="6">
        <a-statistic
          title="执行成功"
          :value="statistics.successCount"
          :value-style="{ color: '#3f8600' }"
        >
          <template #prefix>
            <check-circle-outlined />
          </template>
        </a-statistic>
      </a-col>

      <a-col :span="6">
        <a-statistic
          title="执行失败"
          :value="statistics.failedCount"
          :value-style="{ color: '#cf1322' }"
        >
          <template #prefix>
            <close-circle-outlined />
          </template>
        </a-statistic>
      </a-col>

      <a-col :span="6">
        <a-statistic
          title="部分成功"
          :value="statistics.partialCount"
          :value-style="{ color: '#fa8c16' }"
        >
          <template #prefix>
            <exclamation-circle-outlined />
          </template>
        </a-statistic>
      </a-col>

      <a-col :span="6">
        <a-statistic
          title="总记录数"
          :value="statistics.totalCount"
          :value-style="{ color: '#1890ff' }"
        >
          <template #prefix>
            <unordered-list-outlined />
          </template>
        </a-statistic>
      </a-col>
    </a-row>

    <!-- 图表区域 -->
    <a-row :gutter="16" class="mb-4">
      <a-col :span="12">
        <a-card title="联动状态分布" :bordered="false">
          <canvas ref="statusChartRef" />
        </a-card>
      </a-col>

      <a-col :span="12">
        <a-card title="事件类型统计" :bordered="false">
          <canvas ref="eventChartRef" />
        </a-card>
      </a-col>
    </a-row>

    <a-row :gutter="16">
      <a-col :span="12">
        <a-card title="区域分布" :bordered="false">
          <canvas ref="areaChartRef" />
        </a-card>
      </a-col>

      <a-col :span="12">
        <a-card title="每日联动趋势（近7天）" :bordered="false">
          <canvas ref="trendChartRef" />
        </a-card>
      </a-col>
    </a-row>
  </a-card>
</template>
```

### 5. 详情弹窗（Detail Modal）
```vue
<template>
  <a-modal
    :open="visible"
    title="联动记录详情"
    width="800px"
    :footer="null"
    @update:open="handleUpdateVisible"
  >
    <a-descriptions :column="2" bordered>
      <a-descriptions-item label="发生时间">
        {{ currentRecord?.occurTime }}
      </a-descriptions-item>

      <a-descriptions-item label="事件名称">
        {{ currentRecord?.eventName }}
      </a-descriptions-item>

      <a-descriptions-item label="联动条件">
        {{ currentRecord?.linkageCondition }}
      </a-descriptions-item>

      <a-descriptions-item label="设备/通道">
        {{ currentRecord?.device }}
      </a-descriptions-item>

      <a-descriptions-item label="区域">
        {{ currentRecord?.area }}
      </a-descriptions-item>

      <a-descriptions-item label="执行状态">
        <a-tag :color="getStatusColor(currentRecord?.status)">
          {{ getStatusText(currentRecord?.status) }}
        </a-tag>
      </a-descriptions-item>

      <a-descriptions-item label="详细描述" :span="2">
        {{ currentRecord?.description }}
      </a-descriptions-item>

      <a-descriptions-item label="相关文件" :span="2">
        <a-space>
          <a-button
            v-if="currentRecord?.hasVideo"
            type="primary"
            size="small"
            @click="handlePlayVideo(currentRecord)"
          >
            <template #icon><play-circle-outlined /></template>
            播放录像
          </a-button>

          <a-button
            v-if="currentRecord?.hasCapture"
            size="small"
            @click="handleViewCapture(currentRecord)"
          >
            <template #icon><camera-outlined /></template>
            查看抓拍
          </a-button>

          <span v-if="!currentRecord?.hasVideo && !currentRecord?.hasCapture">
            无相关文件
          </span>
        </a-space>
      </a-descriptions-item>
    </a-descriptions>
  </a-modal>
</template>
```

### 6. 视频播放弹窗（Video Modal）
```vue
<template>
  <a-modal
    :open="videoVisible"
    title="录像回放"
    width="1000px"
    :footer="null"
    @update:open="handleUpdateVideoVisible"
  >
    <div class="video-container">
      <video
        ref="videoPlayerRef"
        :src="videoUrl"
        controls
        class="w-full"
        style="max-height: 600px;"
      />
    </div>
  </a-modal>
</template>
```

## 核心功能实现

### 1. 主页面组件（linkage-record.vue）
```vue
<script setup>
import { ref, reactive, onMounted, computed } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  HistoryOutlined,
  SearchOutlined,
  ReloadOutlined,
  DeleteOutlined,
  DownloadOutlined,
  UnorderedListOutlined,
  BarChartOutlined,
  EyeOutlined,
  PlayCircleOutlined,
  CameraOutlined,
  FilterOutlined,
  UndoOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  ExclamationCircleOutlined,
  CalendarOutlined,
} from '@ant-design/icons-vue';
import { linkageRecordApi } from '/@/api/business/smart-video/linkage-record-api';
import Chart from 'chart.js/auto';

// 视图类型
const viewType = ref('list');

// 查询条件
const filterForm = reactive({
  startTime: null,
  endTime: null,
  eventName: '',
  channelName: '',
  area: '',
  deviceType: '',
  status: '',
});

// 更多筛选条件显示
const moreFiltersVisible = ref([]);

// 表格数据
const loading = ref(false);
const recordList = ref([]);
const pagination = reactive({
  current: 1,
  pageSize: 25,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `共 ${total} 条记录`,
});

// 表格列定义
const columns = [
  {
    title: '发生时间',
    dataIndex: 'occurTime',
    key: 'occurTime',
    width: 180,
    slots: { customRender: 'occurTime' },
  },
  {
    title: '事件名称',
    dataIndex: 'eventName',
    key: 'eventName',
    width: 200,
    slots: { customRender: 'eventName' },
  },
  {
    title: '联动条件',
    dataIndex: 'linkageCondition',
    key: 'linkageCondition',
    width: 150,
  },
  {
    title: '设备/通道',
    dataIndex: 'device',
    key: 'device',
    width: 200,
  },
  {
    title: '区域',
    dataIndex: 'area',
    key: 'area',
    width: 100,
  },
  {
    title: '文件',
    dataIndex: 'files',
    key: 'files',
    width: 100,
    slots: { customRender: 'files' },
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    width: 120,
    slots: { customRender: 'status' },
  },
  {
    title: '操作',
    key: 'action',
    width: 100,
    fixed: 'right',
    slots: { customRender: 'action' },
  },
];

// 行选择
const selectedRowKeys = ref([]);
const rowSelection = computed(() => ({
  selectedRowKeys: selectedRowKeys.value,
  onChange: (keys) => {
    selectedRowKeys.value = keys;
  },
}));

// 统计数据
const statistics = reactive({
  successCount: 0,
  failedCount: 0,
  partialCount: 0,
  totalCount: 0,
});

// 图表引用
const statusChartRef = ref(null);
const eventChartRef = ref(null);
const areaChartRef = ref(null);
const trendChartRef = ref(null);
let chartInstances = {};

// 详情弹窗
const detailVisible = ref(false);
const currentRecord = ref(null);

// 视频弹窗
const videoVisible = ref(false);
const videoUrl = ref('');
const videoPlayerRef = ref(null);

// 初始化
onMounted(() => {
  initTimeRange();
  loadRecords();
});

// 初始化时间范围（默认最近3天）
const initTimeRange = () => {
  const now = new Date();
  const threeDaysAgo = new Date(now.getTime() - 3 * 24 * 60 * 60 * 1000);

  filterForm.endTime = now;
  filterForm.startTime = threeDaysAgo;
};

// 加载记录列表
const loadRecords = async () => {
  loading.value = true;

  try {
    const params = {
      ...filterForm,
      pageNum: pagination.current,
      pageSize: pagination.pageSize,
    };

    const res = await linkageRecordApi.queryRecords(params);

    if (res.code === 1) {
      recordList.value = res.data.list;
      pagination.total = res.data.total;
    } else {
      message.error(res.msg || '查询失败');
    }
  } catch (error) {
    message.error('查询失败：' + error.message);
  } finally {
    loading.value = false;
  }
};

// 加载统计数据
const loadStatistics = async () => {
  try {
    const res = await linkageRecordApi.getStatistics(filterForm);

    if (res.code === 1) {
      Object.assign(statistics, res.data);
      initCharts();
    }
  } catch (error) {
    message.error('加载统计数据失败：' + error.message);
  }
};

// 初始化图表
const initCharts = () => {
  // 销毁已存在的图表
  Object.values(chartInstances).forEach(chart => chart?.destroy());
  chartInstances = {};

  // 状态分布饼图
  if (statusChartRef.value) {
    const ctx = statusChartRef.value.getContext('2d');
    chartInstances.status = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['执行成功', '执行失败', '部分成功'],
        datasets: [{
          data: [
            statistics.successCount,
            statistics.failedCount,
            statistics.partialCount,
          ],
          backgroundColor: ['#52c41a', '#ff4d4f', '#faad14'],
        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { position: 'bottom' },
        },
      },
    });
  }

  // 其他图表类似...
};

// 表格变化处理
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadRecords();
};

// 查询
const handleSearch = () => {
  pagination.current = 1;
  loadRecords();

  if (viewType.value === 'chart') {
    loadStatistics();
  }
};

// 重置
const handleReset = () => {
  Object.keys(filterForm).forEach(key => {
    filterForm[key] = '';
  });

  initTimeRange();
  moreFiltersVisible.value = [];
  handleSearch();
};

// 刷新
const handleRefresh = () => {
  loadRecords();

  if (viewType.value === 'chart') {
    loadStatistics();
  }

  message.success('数据刷新成功');
};

// 清空数据
const handleClearData = () => {
  Modal.confirm({
    title: '确定要清空所有联动记录吗？',
    content: '此操作不可恢复！',
    async onOk() {
      try {
        const res = await linkageRecordApi.clearAllRecords();

        if (res.code === 1) {
          message.success('联动记录已清空');
          loadRecords();
        } else {
          message.error(res.msg || '清空失败');
        }
      } catch (error) {
        message.error('清空失败：' + error.message);
      }
    },
  });
};

// 导出
const handleExport = async () => {
  if (selectedRowKeys.value.length === 0) {
    message.warning('请选择要导出的记录');
    return;
  }

  try {
    const params = {
      ids: selectedRowKeys.value,
    };

    const res = await linkageRecordApi.exportRecords(params);

    if (res.code === 1) {
      message.success('导出成功');
      // 处理文件下载...
    } else {
      message.error(res.msg || '导出失败');
    }
  } catch (error) {
    message.error('导出失败：' + error.message);
  }
};

// 查看详情
const handleViewDetail = (record) => {
  currentRecord.value = record;
  detailVisible.value = true;
};

// 播放视频
const handlePlayVideo = async (record) => {
  try {
    const res = await linkageRecordApi.getVideoUrl(record.id);

    if (res.code === 1) {
      videoUrl.value = res.data.url;
      videoVisible.value = true;
      detailVisible.value = false;
    } else {
      message.error(res.msg || '获取视频失败');
    }
  } catch (error) {
    message.error('获取视频失败：' + error.message);
  }
};

// 查看抓拍
const handleViewCapture = async (record) => {
  message.info('抓拍图片查看功能开发中...');
};

// 删除记录
const handleDelete = async (id) => {
  try {
    const res = await linkageRecordApi.deleteRecord(id);

    if (res.code === 1) {
      message.success('删除成功');
      loadRecords();
    } else {
      message.error(res.msg || '删除失败');
    }
  } catch (error) {
    message.error('删除失败：' + error.message);
  }
};

// 状态相关辅助方法
const getStatusColor = (status) => {
  const colorMap = {
    success: 'success',
    failed: 'error',
    partial: 'warning',
  };
  return colorMap[status] || 'default';
};

const getStatusIcon = (status) => {
  const iconMap = {
    success: CheckCircleOutlined,
    failed: CloseCircleOutlined,
    partial: ExclamationCircleOutlined,
  };
  return iconMap[status] || CheckCircleOutlined;
};

const getStatusText = (status) => {
  const textMap = {
    success: '执行成功',
    failed: '执行失败',
    partial: '部分成功',
  };
  return textMap[status] || '未知';
};
</script>

<style lang="less" scoped>
.linkage-record-header {
  margin-bottom: 16px;
}

.filter-card {
  margin-bottom: 16px;
}

.table-card,
.chart-card {
  margin-bottom: 16px;
}

.video-container {
  background: #000;
  border-radius: 4px;
  overflow: hidden;
}

.font-medium {
  font-weight: 500;
}

.text-gray-500 {
  color: rgba(0, 0, 0, 0.45);
}

.text-gray-400 {
  color: rgba(0, 0, 0, 0.25);
}

.text-xs {
  font-size: 12px;
}
</style>
```

## Mock数据示例

```javascript
// src/mock/linkage-record-mock.js
export const mockLinkageRecords = [
  {
    id: 'record001',
    occurTime: '2024-01-30 14:35:22',
    eventName: '移动侦测报警',
    linkageCondition: '周界入侵联动',
    device: 'Camera-001 前门摄像头',
    area: '主楼',
    hasVideo: true,
    hasCapture: true,
    status: 'success',
    description: '检测到人员进入限制区域，触发录像和报警',
  },
  {
    id: 'record002',
    occurTime: '2024-01-30 14:32:15',
    eventName: '人脸识别事件',
    linkageCondition: '人脸识别联动',
    device: 'Camera-002 大厅摄像头',
    area: '主楼',
    hasVideo: false,
    hasCapture: true,
    status: 'success',
    description: '识别到黑名单人员，触发报警和抓拍',
  },
  {
    id: 'record003',
    occurTime: '2024-01-30 14:28:47',
    eventName: '门禁异常',
    linkageCondition: '门禁异常联动',
    device: 'Door-001 主门',
    area: '主楼',
    hasVideo: true,
    hasCapture: false,
    status: 'failed',
    description: '门禁异常开门，联动录像失败',
  },
  {
    id: 'record004',
    occurTime: '2024-01-30 14:25:33',
    eventName: '车辆检测',
    linkageCondition: '车牌识别联动',
    device: 'Camera-016 停车场入口',
    area: '停车场',
    hasVideo: true,
    hasCapture: true,
    status: 'success',
    description: '检测到违章停车，触发录像和抓拍',
  },
  {
    id: 'record005',
    occurTime: '2024-01-30 14:22:18',
    eventName: '设备离线',
    linkageCondition: '设备异常联动',
    device: 'Camera-003 走廊摄像头',
    area: '主楼',
    hasVideo: false,
    hasCapture: false,
    status: 'failed',
    description: '设备离线，联动通知失败',
  },
];

export const mockStatistics = {
  successCount: 5,
  failedCount: 2,
  partialCount: 1,
  totalCount: 8,
  eventTypeData: {
    '移动侦测': 3,
    '人脸识别': 2,
    '门禁异常': 1,
    '车辆检测': 1,
    '设备离线': 1,
  },
  areaData: {
    '主楼': 5,
    '停车场': 1,
    '仓库区': 1,
    '出入口': 1,
  },
  trendData: {
    labels: ['01-24', '01-25', '01-26', '01-27', '01-28', '01-29', '01-30'],
    values: [12, 19, 15, 22, 18, 16, 8],
  },
};
```

## 开发提示

### 1. 时间范围处理
- 默认查询最近3天的记录
- 支持自定义时间范围查询
- 时间格式统一使用：YYYY-MM-DD HH:mm:ss

### 2. 分页处理
- 默认每页显示25条记录
- 支持切换每页显示数量：[10, 25, 50, 100]
- 支持快速跳转到指定页

### 3. 图表初始化
- 在切换到图表视图时初始化图表
- 离开图表视图时销毁图表实例，避免内存泄漏
- 使用Chart.js的responsive和maintainAspectRatio选项

### 4. 视频播放
- 支持mp4格式视频播放
- 使用HTML5 video标签
- 关闭弹窗时停止视频播放并清空src

### 5. 导出功能
- 支持导出选中的记录
- 导出格式：Excel或CSV
- 包含所有查询条件和记录详情

### 6. 性能优化
- 表格使用虚拟滚动处理大量数据
- 图表数据按需加载
- 合理使用computed和watch优化响应式性能

## 总结

本文档提供了联动记录页面的精简实现方案，包括：
1. 完整的技术架构和项目结构
2. 核心功能代码实现
3. 常见错误避免指南
4. Mock数据示例
5. 开发注意事项

开发时请严格遵循SmartAdmin规范，使用Vue3 Composition API和Ant Design Vue组件库，确保代码质量和用户体验。
