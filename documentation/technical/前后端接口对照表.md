# æ¶ˆè´¹æ¨¡å—å‰åç«¯æ¥å£å¯¹ç…§è¡¨

## ğŸ“‹ å¯¹ç…§è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†åˆ—å‡ºäº†æ¶ˆè´¹æ¨¡å—å‰åç«¯æ¥å£çš„å¯¹åº”å…³ç³»ï¼Œç¡®ä¿æ•°æ®æ ¼å¼å’Œè°ƒç”¨æ–¹å¼çš„ä¸€è‡´æ€§ã€‚

---

## ğŸ”— æ ¸å¿ƒæ¶ˆè´¹æ¥å£

| å‰ç«¯APIè°ƒç”¨ | åç«¯Controller | HTTPæ–¹æ³• | è·¯å¾„ | å‚æ•°æ ¼å¼ | å“åº”æ ¼å¼ | çŠ¶æ€ |
|-----------|---------------|---------|------|---------|---------|------|
| `consumeApi.pay(data)` | ConsumeController.pay | POST | `/api/consume/pay` | @RequestParam | ResponseDTO\<String\> | âœ… |
| `consumeApi.consume(data)` | ConsumeController.consume | POST | `/api/consume/consume` | @RequestBody | ResponseDTO\<Map\> | âœ… |
| `consumeApi.getRecords(params)` | ConsumeController.pageRecords | GET | `/api/consume/records` | PageParam + Query | ResponseDTO\<PageResult\> | âœ… |
| `consumeApi.getDetail(id)` | ConsumeController.getConsumeDetail | GET | `/api/consume/detail/{id}` | @PathVariable | ResponseDTO\<ConsumeRecordEntity\> | âœ… |
| `consumeApi.getStatistics(params)` | ConsumeController.getConsumeStatistics | GET | `/api/consume/statistics` | @RequestParam | ResponseDTO\<Map\> | âœ… |
| `consumeApi.refund(id, reason)` | ConsumeController.refundConsume | POST | `/api/consume/refund/{id}` | @PathVariable + @RequestParam | ResponseDTO\<String\> | âœ… |
| `consumeApi.getModes()` | ConsumeController.getConsumeModes | GET | `/api/consume/modes` | æ—  | ResponseDTO\<List<Map\>\> | âœ… |
| `consumeApi.getConsumeTrend(params)` | ConsumeController.getConsumeTrend | GET | `/api/consume/trend` | @RequestParam | ResponseDTO\<List<Map\>\> | âœ… |
| `consumeApi.validateConsume(params)` | ConsumeController.validateConsume | GET | `/api/consume/validate` | @RequestParam | ResponseDTO\<Map\> | âœ… |
| `consumeApi.batchConsume(data)` | ConsumeController.batchConsume | POST | `/api/consume/batch` | @RequestBody | ResponseDTO\<List<Map\>\> | âœ… |
| `consumeApi.exportRecords(params)` | ConsumeController.exportRecords | GET | `/api/consume/export` | @RequestParam | ResponseDTO\<String\> | âœ… |
| `consumeApi.cancelConsume(id, reason)` | ConsumeController.cancelConsume | POST | `/api/consume/cancel/{id}` | @PathVariable + @RequestParam | ResponseDTO\<String\> | âœ… |
| `consumeApi.getConsumeLogs(id)` | ConsumeController.getConsumeLogs | GET | `/api/consume/logs/{id}` | @PathVariable | ResponseDTO\<List<Map\>\> | âœ… |
| `consumeApi.syncConsumeData(params)` | ConsumeController.syncConsumeData | POST | `/api/consume/sync` | @RequestParam | ResponseDTO\<String\> | âœ… |

---

## ğŸ‘¤ è´¦æˆ·ç®¡ç†æ¥å£

| å‰ç«¯APIè°ƒç”¨ | åç«¯Controller | HTTPæ–¹æ³• | è·¯å¾„ | å‚æ•°æ ¼å¼ | å“åº”æ ¼å¼ | çŠ¶æ€ |
|-----------|---------------|---------|------|---------|---------|------|
| `accountApi.createAccount(data)` | AccountController.createAccount | POST | `/api/consume/account/create` | @RequestBody | ResponseDTO\<String\> | âœ… |
| `accountApi.getAccountList(params)` | AccountController.getAccountList | GET | `/api/consume/account/list` | PageParam + Query | ResponseDTO\<PageResult<AccountVO\>\> | âœ… |
| `accountApi.getAccountDetail(accountId)` | AccountController.getAccountDetail | GET | `/api/consume/account/detail/{accountId}` | @PathVariable | ResponseDTO\<AccountDetailVO\> | âœ… |
| `accountApi.updateAccount(data)` | AccountController.updateAccount | PUT | `/api/consume/account/update` | @RequestBody | ResponseDTO\<String\> | âœ… |
| `accountApi.rechargeAccount(data)` | AccountController.rechargeAccount | POST | `/api/consume/account/recharge` | @RequestBody | ResponseDTO\<String\> | âœ… |
| `accountApi.getAccountBalance(accountId)` | AccountController.getAccountBalance | GET | `/api/consume/account/balance/{accountId}` | @PathVariable | ResponseDTO\<BigDecimal\> | âœ… |
| `accountApi.freezeAccount(accountId, reason)` | AccountController.freezeAccount | POST | `/api/consume/account/freeze/{accountId}` | @PathVariable + @RequestParam | ResponseDTO\<String\> | âœ… |
| `accountApi.unfreezeAccount(accountId, reason)` | AccountController.unfreezeAccount | POST | `/api/consume/account/unfreeze/{accountId}` | @PathVariable + @RequestParam | ResponseDTO\<String\> | âœ… |
| `accountApi.getAccountTransactions(accountId, params)` | AccountController.getAccountTransactions | GET | `/api/consume/account/transactions/{accountId}` | @PathVariable + Query | ResponseDTO\<PageResult<Map\>\> | âœ… |
| `accountApi.getAccountStatistics(params)` | AccountController.getAccountStatistics | GET | `/api/consume/account/statistics` | @RequestParam | ResponseDTO\<Map\> | âœ… |
| `accountApi.exportAccounts(params)` | AccountController.exportAccounts | GET | `/api/consume/account/export` | @RequestParam | ResponseDTO\<String\> | âœ… |
| `accountApi.getAccountTypes()` | AccountController.getAccountTypes | GET | `/api/consume/account/types` | æ—  | ResponseDTO\<List<Map\>\> | âœ… |
| `accountApi.batchUpdateStatus(data)` | AccountController.batchUpdateStatus | POST | `/api/consume/account/batch/status` | @RequestParam | ResponseDTO\<String\> | âœ… |

---

## ğŸ“Š ç»Ÿè®¡æŠ¥è¡¨æ¥å£

| å‰ç«¯APIè°ƒç”¨ | åç«¯Controller | HTTPæ–¹æ³• | è·¯å¾„ | å‚æ•°æ ¼å¼ | å“åº”æ ¼å¼ | çŠ¶æ€ |
|-----------|---------------|---------|------|---------|---------|------|
| `reportApi.getConsumeSummary(params)` | ReportController.getConsumeSummary | GET | `/api/consume/report/summary` | @RequestParam | ResponseDTO\<Map\> | âœ… |
| `reportApi.getModeDistribution(params)` | ReportController.getModeDistribution | GET | `/api/consume/report/mode-distribution` | @RequestParam | ResponseDTO\<Map\> | âœ… |
| `reportApi.getDailyTrend(params)` | ReportController.getDailyTrend | GET | `/api/consume/report/daily-trend` | @RequestParam | ResponseDTO\<List<Map\>\> | âœ… |
| `reportApi.getDeviceRanking(params)` | ReportController.getDeviceRanking | GET | `/api/consume/report/device-ranking` | @RequestParam | ResponseDTO\<List<Map\>\> | âœ… |
| `reportApi.getUserRanking(params)` | ReportController.getUserRanking | GET | `/api/consume/report/user-ranking` | @RequestParam | ResponseDTO\<List<Map\>\> | âœ… |
| `reportApi.getHourlyDistribution(params)` | ReportController.getHourlyDistribution | GET | `/api/consume/report/hourly-distribution` | @RequestParam | ResponseDTO\<Map\> | âœ… |
| `reportApi.getAbnormalDetection(params)` | ReportController.getAbnormalDetection | GET | `/api/consume/report/abnormal-detection` | @RequestParam | ResponseDTO\<List<Map\>\> | âœ… |
| `reportApi.exportReport(params)` | ReportController.exportReport | GET | `/api/consume/report/export` | @RequestParam | File | âœ… |

---

## ğŸ”§ è®¾å¤‡ç®¡ç†æ¥å£

| å‰ç«¯APIè°ƒç”¨ | åç«¯Controller | HTTPæ–¹æ³• | è·¯å¾„ | å‚æ•°æ ¼å¼ | å“åº”æ ¼å¼ | çŠ¶æ€ |
|-----------|---------------|---------|------|---------|---------|------|
| `deviceApi.getDeviceList(params)` | DeviceController.getDeviceList | GET | `/api/consume/device/list` | PageParam + Query | ResponseDTO\<PageResult\> | âœ… |
| `deviceApi.getDeviceDetail(deviceId)` | DeviceController.getDeviceDetail | GET | `/api/consume/device/detail/{deviceId}` | @PathVariable | ResponseDTO\<DeviceDetailVO\> | âœ… |
| `deviceApi.addDevice(data)` | DeviceController.addDevice | POST | `/api/consume/device` | @RequestBody | ResponseDTO\<String\> | âœ… |
| `deviceApi.updateDevice(deviceId, data)` | DeviceController.updateDevice | PUT | `/api/consume/device/{deviceId}` | @PathVariable + @RequestBody | ResponseDTO\<String\> | âœ… |
| `deviceApi.deleteDevice(deviceId)` | DeviceController.deleteDevice | DELETE | `/api/consume/device/{deviceId}` | @PathVariable | ResponseDTO\<String\> | âœ… |
| `deviceApi.getDeviceStatus(deviceId)` | DeviceController.getDeviceStatus | GET | `/api/consume/device/{deviceId}/status` | @PathVariable | ResponseDTO\<Map\> | âœ… |
| `deviceApi.restartDevice(deviceId)` | DeviceController.restartDevice | POST | `/api/consume/device/{deviceId}/restart` | @PathVariable | ResponseDTO\<String\> | âœ… |
| `deviceApi.setMaintenanceMode(deviceId)` | DeviceController.setMaintenanceMode | POST | `/api/consume/device/{deviceId}/maintenance` | @PathVariable | ResponseDTO\<String\> | âœ… |
| `deviceApi.enableDevice(deviceId)` | DeviceController.enableDevice | POST | `/api/consume/device/{deviceId}/enable` | @PathVariable | ResponseDTO\<String\> | âœ… |
| `deviceApi.disableDevice(deviceId)` | DeviceController.disableDevice | POST | `/api/consume/device/{deviceId}/disable` | @PathVariable | ResponseDTO\<String\> | âœ… |
| `deviceApi.getDeviceStatistics(params)` | DeviceController.getDeviceStatistics | GET | `/api/consume/device/statistics` | @RequestParam | ResponseDTO\<Map\> | âœ… |

---

## ğŸ“ æ¥å£è°ƒç”¨è§„èŒƒ

### 1. è¯·æ±‚å‚æ•°æ ¼å¼

#### Queryå‚æ•°
```javascript
// GETè¯·æ±‚å‚æ•°æ ¼å¼
const params = {
  pageNum: 1,
  pageSize: 10,
  userId: 1001,
  startTime: '2025-11-01 00:00:00',
  endTime: '2025-11-17 23:59:59'
};
```

#### RequestBodyå‚æ•°
```javascript
// POST/PUTè¯·æ±‚å‚æ•°æ ¼å¼
const data = {
  userId: 1001,
  amount: 100.00,
  deviceId: 2001,
  consumeMode: 'FIXED_AMOUNT',
  orderNo: 'ORDER_001',
  remark: 'æµ‹è¯•æ¶ˆè´¹'
};
```

### 2. å“åº”æ•°æ®æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "ok": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“æ•°æ®å†…å®¹
  }
}
```

#### åˆ†é¡µå“åº”
```json
{
  "ok": true,
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "pageNum": 1,
    "pageSize": 10,
    "total": 100,
    "rows": [
      // æ•°æ®åˆ—è¡¨
    ]
  }
}
```

#### é”™è¯¯å“åº”
```json
{
  "ok": false,
  "code": 500,
  "message": "æ“ä½œå¤±è´¥ï¼šå…·ä½“é”™è¯¯ä¿¡æ¯",
  "data": null
}
```

### 3. æ—¶é—´æ ¼å¼è§„èŒƒ

- **å‰ç«¯ä¼ å‚**: `YYYY-MM-DD HH:mm:ss` æ ¼å¼å­—ç¬¦ä¸²
- **åç«¯æ¥æ”¶**: ä½¿ç”¨ `@DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")` æ³¨è§£
- **åç«¯è¿”å›**: ISO 8601 æ ¼å¼å­—ç¬¦ä¸²
- **å‰ç«¯å¤„ç†**: ä½¿ç”¨ `dayjs` åº“è¿›è¡Œæ—¶é—´æ ¼å¼åŒ–

### 4. é‡‘é¢æ ¼å¼è§„èŒƒ

- **ä¼ å‚æ ¼å¼**: æ•°å­—ç±»å‹ï¼Œä¿ç•™ä¸¤ä½å°æ•°
- **åç«¯å¤„ç†**: ä½¿ç”¨ `BigDecimal` ç±»å‹
- **å‰ç«¯æ˜¾ç¤º**: ä½¿ç”¨ `toFixed(2)` æ ¼å¼åŒ–æ˜¾ç¤º

### 5. åˆ†é¡µå‚æ•°è§„èŒƒ

```javascript
// æ ‡å‡†åˆ†é¡µå‚æ•°
const pageParam = {
  pageNum: 1,        // é¡µç ï¼Œä»1å¼€å§‹
  pageSize: 10,      // æ¯é¡µå¤§å°
  sortField: 'createTime', // æ’åºå­—æ®µ
  sortOrder: 'desc'  // æ’åºæ–¹å‘ï¼šasc/desc
};
```

---

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æƒé™éªŒè¯**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç™»å½•éªŒè¯ï¼Œéƒ¨åˆ†æ¥å£éœ€è¦é¢å¤–æƒé™éªŒè¯
2. **å‚æ•°æ ¡éªŒ**: åç«¯ä½¿ç”¨ `@Valid` æ³¨è§£è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œå‰ç«¯éœ€è¦ç¡®ä¿å‚æ•°æ ¼å¼æ­£ç¡®
3. **å¼‚å¸¸å¤„ç†**: åç«¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œå‰ç«¯éœ€è¦æ ¹æ®å“åº”ç è¿›è¡Œç›¸åº”å¤„ç†
4. **æ–‡ä»¶ä¸Šä¼ **: ä½¿ç”¨ `multipart/form-data` æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°é™åˆ¶10MB
5. **å¯¼å‡ºåŠŸèƒ½**: è¿”å›æ–‡ä»¶æµï¼Œå‰ç«¯éœ€è¦å¤„ç†ä¸‹è½½é€»è¾‘
6. **æ‰¹é‡æ“ä½œ**: æ‰¹é‡æ“ä½œå‚æ•°ä¸ªæ•°é™åˆ¶ä¸º1000ä¸ª
7. **æ—¶é—´èŒƒå›´**: æŸ¥è¯¢æ—¶é—´èŒƒå›´ä¸èƒ½è¶…è¿‡365å¤©

---

## âœ… éªŒè¯æ¸…å•

- [ ] æ‰€æœ‰å‰ç«¯APIè·¯å¾„ä¸åç«¯Controllerè·¯å¾„ä¸€è‡´
- [ ] è¯·æ±‚å‚æ•°æ ¼å¼ä¸åç«¯æ¥æ”¶æ–¹å¼åŒ¹é…
- [ ] å“åº”æ•°æ®æ ¼å¼è§£ææ­£ç¡®
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
- [ ] åˆ†é¡µå‚æ•°ä¼ é€’æ­£ç¡®
- [ ] æ—¶é—´æ ¼å¼è½¬æ¢æ­£ç¡®
- [ ] é‡‘é¢ç²¾åº¦ä¿æŒä¸€è‡´
- [ ] æƒé™éªŒè¯æœºåˆ¶æ­£å¸¸

---

**æ›´æ–°æ—¶é—´**: 2025-11-17
**ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤äºº**: IOE-DREAM Team