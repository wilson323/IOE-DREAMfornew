# 热力统计页面功能与布局文档

## 页面概述
热力统计页面(过热统计)是智能视频监控系统的数据分析界面,用于展示监控设备的温度统计和热度分布数据。该页面基于SmartAdmin前端框架构建,采用Vue3 + Ant Design Vue + ECharts技术栈,支持时间热度图和空间热度图两种展示模式,提供热力数据统计、多维度查询、图表展示、报表导出等功能。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **可视化库**: Apache ECharts 5.5.0
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/smart-video/
├── heat-statistics.vue              # 热力统计主页面
├── components/
│   ├── TimeHeatChart.vue           # 时间热度图组件
│   ├── SpaceHeatCanvas.vue         # 空间热度图Canvas组件
│   └── HeatLegend.vue              # 热度图例组件
├── hooks/
│   ├── useHeatData.js              # 热力数据Hook
│   └── useHeatCanvas.js            # Canvas绘制Hook
├── mock/
│   └── heat-mock-data.js           # 模拟数据
└── api/
    └── heat-api.js                 # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/heat-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const heatApi = {
  // 获取时间热度图数据
  getTimeHeatData: (params) => postRequest('/heat/time/data', params),

  // 获取空间热度图数据
  getSpaceHeatData: (params) => postRequest('/heat/space/data', params),

  // 获取设备通道列表
  getDeviceChannels: (deviceId) => getRequest(`/device/${deviceId}/channels`),

  // 导出热力数据
  exportHeatData: (params) => postRequest('/heat/export', params, {
    responseType: 'blob'
  }),
};
```

## 开发注意事项与常见错误避免

### 1. ECharts图表生命周期管理

#### ❌ 错误用法：未正确销毁图表实例
```vue
<script setup>
import * as echarts from 'echarts';
import { onMounted } from 'vue';

onMounted(() => {
  const chart = echarts.init(document.getElementById('chart'));
  chart.setOption({...});
  // ❌ 未在组件销毁时清理图表
});
</script>
```

#### ✅ 正确用法：完整的图表生命周期管理
```vue
<template>
  <div ref="chartRef" style="width: 100%; height: 400px;"></div>
</template>

<script setup>
import * as echarts from 'echarts';
import { ref, onMounted, onUnmounted } from 'vue';

const chartRef = ref(null);
let chartInstance = null;

onMounted(() => {
  chartInstance = echarts.init(chartRef.value);
  const option = { /* 图表配置 */ };
  chartInstance.setOption(option);

  // 监听窗口大小变化
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  // ✅ 销毁图表实例
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
  window.removeEventListener('resize', handleResize);
});

const handleResize = () => {
  chartInstance?.resize();
};
</script>
```

### 2. Canvas热力图绘制注意事项

#### ✅ 正确用法：正确设置Canvas尺寸和分辨率
```vue
<template>
  <div ref="containerRef" class="heatmap-container">
    <canvas ref="canvasRef" class="heatmap-canvas"></canvas>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const containerRef = ref(null);
const canvasRef = ref(null);

const initCanvas = () => {
  const canvas = canvasRef.value;
  const container = containerRef.value;
  if (!canvas || !container) return;

  // ✅ 获取容器实际尺寸
  const rect = container.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;

  // ✅ 设置Canvas实际尺寸(考虑设备像素比)
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;

  // ✅ 设置Canvas显示尺寸
  canvas.style.width = `${rect.width}px`;
  canvas.style.height = `${rect.height}px`;

  // ✅ 缩放上下文以匹配设备像素比
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
};

onMounted(() => {
  initCanvas();
});
</script>
```

### 3. 图标使用注意事项

#### ✅ 正确：使用实际存在的图标
```vue
<script setup>
import {
  FireOutlined,           // ✅ 热力/火焰图标
  ThunderboltOutlined,    // ✅ 过热图标
  EnvironmentOutlined,    // ✅ 位置/空间
  ClockCircleOutlined,    // ✅ 时间
  FilterOutlined,         // ✅ 筛选
  ReloadOutlined,         // ✅ 刷新
  SearchOutlined,         // ✅ 搜索
  RedoOutlined,           // ✅ 重置
  DownloadOutlined,       // ✅ 导出
  BarChartOutlined,       // ✅ 图表
  CameraOutlined,         // ✅ 摄像机
} from '@ant-design/icons-vue';
</script>
```

## 核心功能模块

### 1. 查询条件区域

**位置**: 页面顶部

**功能说明**:
- 设备选择：选择监控设备
- 通道选择：选择设备下的具体通道(级联)
- 统计方式：日报/周报/月报
- 统计日期：选择统计时间范围
- 热度图类型：时间热度图/空间热度图切换

**技术实现**:
```vue
<template>
  <div class="heat-statistics-page">
    <!-- 页面标题 -->
    <div class="page-header">
      <h2 class="page-title">
        <ThunderboltOutlined class="title-icon" />
        过热统计
      </h2>
      <a-button @click="handleRefresh" :loading="refreshing">
        <template #icon><ReloadOutlined /></template>
        刷新
      </a-button>
    </div>

    <!-- 查询条件 -->
    <a-card :bordered="false" class="query-card">
      <template #title>
        <FilterOutlined /> 统计条件
      </template>

      <a-form layout="inline" :model="queryForm">
        <a-row :gutter="[16, 16]" style="width: 100%;">
          <a-col :xs="24" :sm="12" :md="8" :lg="4">
            <a-form-item label="设备名称">
              <a-select
                v-model:value="queryForm.deviceId"
                placeholder="请选择设备"
                @change="handleDeviceChange"
              >
                <a-select-option
                  v-for="device in deviceList"
                  :key="device.id"
                  :value="device.id"
                >
                  {{ device.name }}
                </a-select-option>
              </a-select>
            </a-form-item>
          </a-col>

          <a-col :xs="24" :sm="12" :md="8" :lg="4">
            <a-form-item label="通道名称">
              <a-select
                v-model:value="queryForm.channelId"
                placeholder="请选择通道"
                :disabled="!queryForm.deviceId"
              >
                <a-select-option
                  v-for="channel in channelList"
                  :key="channel.id"
                  :value="channel.id"
                >
                  {{ channel.name }}
                </a-select-option>
              </a-select>
            </a-form-item>
          </a-col>

          <a-col :xs="24" :sm="12" :md="8" :lg="4">
            <a-form-item label="统计方式">
              <a-select v-model:value="queryForm.statisticsType">
                <a-select-option value="day">日报</a-select-option>
                <a-select-option value="week">周报</a-select-option>
                <a-select-option value="month">月报</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>

          <a-col :xs="24" :sm="12" :md="8" :lg="4">
            <a-form-item label="统计日期">
              <a-date-picker
                v-model:value="queryForm.statisticsDate"
                format="YYYY-MM-DD"
              />
            </a-form-item>
          </a-col>

          <a-col :xs="24" :sm="12" :md="8" :lg="4">
            <a-form-item label="热度图类型">
              <a-select v-model:value="queryForm.heatmapType">
                <a-select-option value="time">
                  <ClockCircleOutlined /> 时间热度图
                </a-select-option>
                <a-select-option value="space">
                  <EnvironmentOutlined /> 空间热度图
                </a-select-option>
              </a-select>
            </a-form-item>
          </a-col>

          <a-col :xs="24" :lg="4">
            <a-space>
              <a-button type="primary" @click="handleQuery" :loading="loading">
                <template #icon><SearchOutlined /></template>
                查询统计
              </a-button>
              <a-button @click="handleReset">
                <template #icon><RedoOutlined /></template>
                重置
              </a-button>
              <a-button type="primary" ghost @click="handleExport">
                <template #icon><DownloadOutlined /></template>
                导出
              </a-button>
            </a-space>
          </a-col>
        </a-row>
      </a-form>
    </a-card>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue';
import { message } from 'ant-design-vue';
import dayjs from 'dayjs';
import {
  ThunderboltOutlined,
  FilterOutlined,
  ReloadOutlined,
  SearchOutlined,
  RedoOutlined,
  DownloadOutlined,
  ClockCircleOutlined,
  EnvironmentOutlined,
} from '@ant-design/icons-vue';
import { heatApi } from '/@/api/business/smart-video/heat-api';

// 查询表单
const queryForm = reactive({
  deviceId: undefined,
  channelId: undefined,
  statisticsType: 'day',
  statisticsDate: dayjs(),
  heatmapType: 'time'
});

const deviceList = ref([]);
const channelList = ref([]);
const loading = ref(false);
const refreshing = ref(false);

// 设备变化处理
const handleDeviceChange = async (deviceId) => {
  queryForm.channelId = undefined;
  channelList.value = [];

  if (!deviceId) return;

  try {
    const response = await heatApi.getDeviceChannels(deviceId);
    channelList.value = response.data || [];
  } catch (error) {
    console.error('加载通道列表失败:', error);
    message.error('加载通道列表失败');
  }
};

// 查询处理
const handleQuery = async () => {
  if (!queryForm.deviceId || !queryForm.channelId) {
    message.warning('请选择设备和通道');
    return;
  }

  loading.value = true;
  try {
    if (queryForm.heatmapType === 'time') {
      await loadTimeHeatData();
    } else {
      await loadSpaceHeatData();
    }
  } finally {
    loading.value = false;
  }
};

// 重置处理
const handleReset = () => {
  queryForm.deviceId = undefined;
  queryForm.channelId = undefined;
  queryForm.statisticsType = 'day';
  queryForm.statisticsDate = dayjs();
  queryForm.heatmapType = 'time';
  channelList.value = [];
};
</script>

<style scoped lang="less">
.heat-statistics-page {
  padding: 16px;
  background: #f0f2f5;
  min-height: 100vh;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.page-title {
  font-size: 24px;
  font-weight: 600;
  color: #262626;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;

  .title-icon {
    color: #ff6b6b;
    font-size: 28px;
  }
}

.query-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 16px;
}
</style>
```

### 2. 时间热度图组件

**位置**: 统计结果区域

**功能说明**:
- 展示24小时温度变化趋势
- 使用ECharts折线图+面积图展示
- 支持平均线和警戒线标注
- 支持图表交互功能

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/TimeHeatChart.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <ClockCircleOutlined /> 时间热度图
    </template>

    <div v-if="!hasData" class="empty-container">
      <a-empty description="暂无数据，请选择条件后查询" />
    </div>

    <div v-else ref="chartRef" class="chart-container"></div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted, watch } from 'vue';
import * as echarts from 'echarts';
import { ClockCircleOutlined } from '@ant-design/icons-vue';

const props = defineProps({
  data: {
    type: Object,
    default: () => ({ hours: [], temperatures: [] })
  }
});

const chartRef = ref(null);
let chartInstance = null;
const hasData = ref(false);

// 初始化图表
const initChart = () => {
  if (!chartRef.value) return;

  chartInstance = echarts.init(chartRef.value);

  const option = {
    title: {
      text: '24小时温度变化趋势',
      left: 'center',
      textStyle: { fontSize: 16, color: '#333' }
    },
    tooltip: {
      trigger: 'axis',
      formatter: (params) => {
        const time = params[0].axisValue;
        const temp = params[0].value;
        return `${time}<br/>温度: ${temp}°C`;
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '10%',
      top: '15%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      data: props.data.hours,
      boundaryGap: false,
      axisLabel: { rotate: 45, color: '#666' }
    },
    yAxis: {
      type: 'value',
      name: '温度(°C)',
      nameGap: 50,
      axisLabel: { color: '#666' }
    },
    series: [{
      name: '温度',
      type: 'line',
      smooth: true,
      data: props.data.temperatures,
      lineStyle: { color: '#ff6b6b', width: 3 },
      areaStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          { offset: 0, color: 'rgba(255, 107, 107, 0.3)' },
          { offset: 1, color: 'rgba(255, 107, 107, 0.05)' }
        ])
      },
      markLine: {
        data: [
          { type: 'average', name: '平均温度' },
          { yAxis: 37.3, name: '警戒线', lineStyle: { color: '#ff9800' } }
        ]
      }
    }]
  };

  chartInstance.setOption(option);
};

// 监听窗口大小变化
const handleResize = () => {
  chartInstance?.resize();
};

// 监听数据变化
watch(() => props.data, () => {
  if (props.data.hours.length > 0) {
    hasData.value = true;
    if (!chartInstance) {
      initChart();
    } else {
      chartInstance.setOption({
        xAxis: { data: props.data.hours },
        series: [{ data: props.data.temperatures }]
      });
    }
  }
}, { deep: true });

onMounted(() => {
  if (props.data.hours.length > 0) {
    hasData.value = true;
    initChart();
  }
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
  window.removeEventListener('resize', handleResize);
});
</script>

<style scoped lang="less">
.chart-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.empty-container {
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.chart-container {
  width: 100%;
  height: 400px;
}
</style>
```

### 3. 空间热度图组件

**位置**: 统计结果区域

**功能说明**:
- 在监控画面背景上叠加热力图
- 显示空间位置的热度分布
- 支持显示/隐藏热力图切换
- 支持下载合成图片

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/SpaceHeatCanvas.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <EnvironmentOutlined /> 空间热度图
    </template>

    <div class="heatmap-wrapper">
      <div v-if="!hasData" class="empty-container">
        <a-empty description="暂无数据，请选择条件后查询" />
      </div>

      <div v-else class="heatmap-container">
        <!-- 背景图片 -->
        <img
          ref="bgImageRef"
          :src="backgroundImage"
          alt="监控画面"
          class="background-image"
          @load="handleImageLoad"
        />

        <!-- 热力图Canvas -->
        <canvas ref="canvasRef" class="heatmap-canvas"></canvas>

        <!-- 热度图例 -->
        <div class="heatmap-legend">
          <div class="legend-title">温度分布</div>
          <div class="legend-gradient"></div>
          <div class="legend-labels">
            <span>高</span>
            <span>中</span>
            <span>低</span>
          </div>
        </div>

        <!-- 控制按钮 -->
        <div class="heatmap-controls">
          <a-space>
            <a-button size="small" @click="toggleHeatmap">
              <template #icon><EyeOutlined v-if="showHeatmap" /></template>
              {{ showHeatmap ? '隐藏' : '显示' }}热力图
            </a-button>
            <a-button size="small" @click="downloadImage">
              <template #icon><DownloadOutlined /></template>
              下载图片
            </a-button>
          </a-space>
        </div>
      </div>
    </div>
  </a-card>
</template>

<script setup>
import { ref, watch } from 'vue';
import { message } from 'ant-design-vue';
import { EnvironmentOutlined, EyeOutlined, DownloadOutlined } from '@ant-design/icons-vue';

const props = defineProps({
  data: {
    type: Object,
    default: () => ({ backgroundImage: '', heatpoints: [] })
  }
});

const bgImageRef = ref(null);
const canvasRef = ref(null);
const hasData = ref(false);
const showHeatmap = ref(true);
const backgroundImage = ref('');

// 图片加载完成处理
const handleImageLoad = () => {
  const img = bgImageRef.value;
  const canvas = canvasRef.value;
  if (!img || !canvas) return;

  const rect = img.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  canvas.style.width = `${rect.width}px`;
  canvas.style.height = `${rect.height}px`;

  renderHeatmap();
};

// 渲染热力图
const renderHeatmap = () => {
  const canvas = canvasRef.value;
  if (!canvas || !props.data.heatpoints.length) return;

  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 绘制热点
  props.data.heatpoints.forEach(point => {
    const gradient = ctx.createRadialGradient(
      point.x, point.y, 0,
      point.x, point.y, point.radius || 50
    );

    // 根据温度值设置颜色
    const temp = point.value;
    let color1, color2;

    if (temp >= 40) {
      color1 = 'rgba(255, 0, 0, 0.6)';
      color2 = 'rgba(255, 100, 0, 0.2)';
    } else if (temp >= 38) {
      color1 = 'rgba(255, 165, 0, 0.6)';
      color2 = 'rgba(255, 200, 0, 0.2)';
    } else {
      color1 = 'rgba(255, 255, 0, 0.6)';
      color2 = 'rgba(100, 255, 0, 0.2)';
    }

    gradient.addColorStop(0, color1);
    gradient.addColorStop(1, color2);

    ctx.fillStyle = gradient;
    ctx.fillRect(
      point.x - point.radius,
      point.y - point.radius,
      point.radius * 2,
      point.radius * 2
    );
  });
};

// 切换热力图显示
const toggleHeatmap = () => {
  showHeatmap.value = !showHeatmap.value;
  if (canvasRef.value) {
    canvasRef.value.style.display = showHeatmap.value ? 'block' : 'none';
  }
};

// 下载图片
const downloadImage = () => {
  try {
    const tempCanvas = document.createElement('canvas');
    const img = bgImageRef.value;

    tempCanvas.width = img.naturalWidth;
    tempCanvas.height = img.naturalHeight;

    const ctx = tempCanvas.getContext('2d');
    ctx.drawImage(img, 0, 0);

    if (showHeatmap.value) {
      ctx.drawImage(canvasRef.value, 0, 0, tempCanvas.width, tempCanvas.height);
    }

    tempCanvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `热力图_${Date.now()}.png`;
      link.click();
      URL.revokeObjectURL(url);

      message.success('图片下载成功');
    });
  } catch (error) {
    message.error('下载图片失败');
  }
};

// 监听数据变化
watch(() => props.data, (newData) => {
  if (newData.backgroundImage && newData.heatpoints.length > 0) {
    hasData.value = true;
    backgroundImage.value = newData.backgroundImage;
  }
}, { deep: true });
</script>

<style scoped lang="less">
.heatmap-wrapper {
  min-height: 500px;
}

.empty-container {
  height: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.heatmap-container {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
  border-radius: 4px;
}

.background-image {
  display: block;
  max-width: 100%;
  max-height: 600px;
}

.heatmap-canvas {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
}

.heatmap-legend {
  position: absolute;
  top: 16px;
  right: 16px;
  background: rgba(255, 255, 255, 0.95);
  padding: 12px;
  border-radius: 6px;
  min-width: 100px;

  .legend-gradient {
    width: 30px;
    height: 120px;
    background: linear-gradient(
      to bottom,
      rgba(255, 0, 0, 0.8),
      rgba(255, 152, 0, 0.7),
      rgba(255, 235, 59, 0.6),
      rgba(76, 175, 80, 0.5)
    );
    border-radius: 4px;
    margin: 8px auto;
  }
}

.heatmap-controls {
  position: absolute;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  padding: 8px 12px;
  border-radius: 6px;
}
</style>
```

## 完整页面组装

```vue
<!-- src/views/business/smart-video/heat-statistics.vue -->
<template>
  <div class="heat-statistics-page">
    <!-- 页面标题 -->
    <div class="page-header">
      <h2 class="page-title">
        <ThunderboltOutlined class="title-icon" />
        过热统计
      </h2>
      <a-button @click="handleRefresh" :loading="refreshing">
        <template #icon><ReloadOutlined /></template>
        刷新
      </a-button>
    </div>

    <!-- 查询条件区域 -->
    <a-card :bordered="false" class="query-card">
      <template #title>
        <FilterOutlined /> 统计条件
      </template>
      <!-- 查询表单内容见上文 -->
    </a-card>

    <!-- 统计结果区域 -->
    <a-card :bordered="false" class="result-card">
      <template #title>
        <BarChartOutlined /> 统计结果 - {{ resultTypeText }}
      </template>

      <!-- 时间热度图 -->
      <TimeHeatChart
        v-if="queryForm.heatmapType === 'time'"
        :data="timeHeatData"
      />

      <!-- 空间热度图 -->
      <SpaceHeatCanvas
        v-else
        :data="spaceHeatData"
      />
    </a-card>
  </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue';
import { message } from 'ant-design-vue';
import dayjs from 'dayjs';
import {
  ThunderboltOutlined,
  FilterOutlined,
  ReloadOutlined,
  BarChartOutlined,
} from '@ant-design/icons-vue';
import TimeHeatChart from './components/TimeHeatChart.vue';
import SpaceHeatCanvas from './components/SpaceHeatCanvas.vue';

// 查询表单
const queryForm = reactive({
  deviceId: undefined,
  channelId: undefined,
  statisticsType: 'day',
  statisticsDate: dayjs(),
  heatmapType: 'time'
});

// 热力数据
const timeHeatData = ref({ hours: [], temperatures: [] });
const spaceHeatData = ref({ backgroundImage: '', heatpoints: [] });

const resultTypeText = computed(() => {
  return queryForm.heatmapType === 'time' ? '时间热度图' : '空间热度图';
});

// 加载时间热度图数据
const loadTimeHeatData = () => {
  // 模拟24小时数据
  const hours = [];
  const temperatures = [];

  for (let i = 0; i < 24; i++) {
    hours.push(`${i}:00`);
    const temp = 35 + Math.sin((i - 6) * Math.PI / 12) * 8 + Math.random() * 3;
    temperatures.push(temp.toFixed(1));
  }

  timeHeatData.value = { hours, temperatures };
  message.success('时间热度图数据加载成功');
};

// 加载空间热度图数据
const loadSpaceHeatData = () => {
  // 模拟空间热点数据
  const heatpoints = [];
  const pointCount = 8;

  for (let i = 0; i < pointCount; i++) {
    heatpoints.push({
      x: 200 + Math.random() * 400,
      y: 150 + Math.random() * 300,
      value: 35 + Math.random() * 10,
      radius: 40 + Math.random() * 20
    });
  }

  spaceHeatData.value = {
    backgroundImage: 'https://picsum.photos/seed/heatmap/704/576',
    heatpoints
  };
  message.success('空间热度图数据加载成功');
};
</script>

<style scoped lang="less">
.heat-statistics-page {
  padding: 16px;
  background: #f0f2f5;
  min-height: 100vh;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.page-title {
  font-size: 24px;
  font-weight: 600;
  color: #262626;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;

  .title-icon {
    color: #ff6b6b;
    font-size: 28px;
  }
}

.query-card,
.result-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 16px;
}
</style>
```

## 路由配置

```javascript
// src/router/modules/business.js
export default [
  {
    path: '/business/smart-video',
    name: 'SmartVideo',
    component: () => import('/@/layout/index.vue'),
    meta: { title: '智能视频', icon: 'VideoCameraOutlined' },
    children: [
      {
        path: 'heat-statistics',
        name: 'HeatStatistics',
        component: () => import('/@/views/business/smart-video/heat-statistics.vue'),
        meta: { title: '过热统计', icon: 'ThunderboltOutlined' },
      },
    ],
  },
];
```

## Mock数据示例

```javascript
// src/mock/business/smart-video/heat-mock.js
import { defineMock } from '/@/mock/base';

export default defineMock([
  {
    url: '/heat/time/data',
    method: 'post',
    response: ({ body }) => {
      const { statisticsType } = body;
      let hours = [];
      let temperatures = [];

      if (statisticsType === 'day') {
        // 24小时数据
        for (let i = 0; i < 24; i++) {
          hours.push(`${i}:00`);
          const temp = 35 + Math.sin((i - 6) * Math.PI / 12) * 8 + Math.random() * 3;
          temperatures.push(parseFloat(temp.toFixed(1)));
        }
      } else if (statisticsType === 'week') {
        // 7天数据
        hours = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
        temperatures = hours.map(() => parseFloat((35 + Math.random() * 10).toFixed(1)));
      }

      return {
        code: 0,
        message: 'success',
        data: { hours, temperatures }
      };
    }
  },
  {
    url: '/heat/space/data',
    method: 'post',
    response: () => {
      const heatpoints = [];
      for (let i = 0; i < 8; i++) {
        heatpoints.push({
          x: 100 + Math.random() * 600,
          y: 100 + Math.random() * 400,
          value: 35 + Math.random() * 10,
          radius: 40 + Math.random() * 30
        });
      }

      return {
        code: 0,
        message: 'success',
        data: {
          backgroundImage: 'https://picsum.photos/seed/heat/800/600',
          heatpoints
        }
      };
    }
  },
]);
```

## 最佳实践建议

### 1. Canvas性能优化
- 使用离屏Canvas进行复杂绘制
- 使用requestAnimationFrame优化动画渲染
- 正确设置Canvas尺寸，考虑设备像素比

### 2. 图表管理
- 在组件销毁时正确清理图表实例
- 监听窗口大小变化，动态调整图表尺寸
- 使用增量更新而非重新初始化

### 3. 用户体验
- 提供加载状态和空状态提示
- 所有异步操作都应有明确的用户反馈
- 实现响应式布局，适配不同屏幕

### 4. 数据处理
- 对数据进行必要的格式化和验证
- 实现数据缓存，减少重复请求
- 合理设置轮询间隔，平衡实时性和性能

## 常见问题与解决方案

### 问题1：Canvas绘制的热力图模糊
**解决方案**:
```javascript
const dpr = window.devicePixelRatio || 1;
canvas.width = container.width * dpr;
canvas.height = container.height * dpr;
canvas.style.width = `${container.width}px`;
canvas.style.height = `${container.height}px`;
ctx.scale(dpr, dpr);
```

### 问题2：图表不显示或显示异常
**解决方案**:
- 确保容器有明确的尺寸
- 在DOM更新完成后再初始化图表
- 检查数据格式是否正确

### 问题3：内存泄漏
**解决方案**:
- 在组件销毁时清理定时器
- 销毁图表实例
- 移除事件监听器

## 总结

热力统计页面提供了强大的温度和热度数据分析能力，通过合理的布局设计和高效的数据处理，为用户提供直观的数据可视化展示。开发时需要特别注意：

1. **图表生命周期管理** - 正确初始化和销毁图表实例
2. **Canvas绘制优化** - 处理设备像素比，优化绘制性能
3. **数据处理** - 合理处理热点数据，支持实时更新
4. **用户体验** - 提供完善的交互功能和友好提示
5. **性能优化** - 优化渲染性能，确保流畅运行

遵循本文档的规范和最佳实践，可以快速开发出高质量、高性能的热力统计页面。
