{
  "id": "snapshot_1764070548558_ci8rla24z",
  "approvalId": "approval_1764058997268_qblmdbjey",
  "approvalTitle": "考勤模块完善任务清单",
  "version": 2,
  "timestamp": "2025-11-25T11:35:48.558Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document\n\n- [x] 1.1 创建考勤区域配置扩展表\n  - File: Database migration script for t_attendance_area_config table\n  - 创建扩展基础AreaEntity的考勤功能表，支持区域考勤配置管理\n  - 实现外键关联和基础审计字段\n  - Purpose: 为考勤区域管理提供数据存储基础\n  - _Leverage: 现有数据库迁移脚本模式，参考消费模块扩展表结构_\n  - _Requirements: Requirement 1_\n  - _Prompt: Role: 后端数据库开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 创建t_attendance_area_config扩展表，严格遵循BaseEntity审计字段，不修改现有AreaEntity表结构，参考消费模块扩展表设计模式 | Restrictions: 严格遵循BaseEntity审计字段，不修改现有AreaEntity表结构，必须包含外键约束，索引优化 | Success: 扩展表创建成功，支持区域考勤配置管理，外键关联正确，索引创建完成_\n\n- [x] 1.2 创建考勤规则配置表\n  - File: Database migration script for t_attendance_rule table\n  - 创建考勤规则配置表，支持灵活的考勤规则定义\n  - 实现规则类型、触发条件、处理动作的配置管理\n  - Purpose: 提供考勤业务规则引擎的数据基础\n  - _Leverage: 参考消费模块的餐别规则设计模式，现有JSON配置字段设计_\n  - _Requirements: Requirement 4_\n  - _Prompt: Role: 后端数据库开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 创建t_attendance_rule规则配置表，支持规则类型、触发条件、处理动作的JSON配置，独立表设计不依赖其他模块规则表 | Restrictions: 必须支持JSON格式配置，规则类型枚举约束，优先级排序支持，启用状态管理 | Success: 规则表创建成功，支持灵活规则配置，JSON字段结构合理，索引优化完成_\n\n- [x] 1.3 创建考勤统计扩展表\n  - File: Database migration script for t_attendance_statistics_ext table\n  - 创建考勤统计扩展表，补充基础统计表的不足\n  - 支持多维度统计和实时计算结果存储\n  - Purpose: 为高级统计功能提供数据存储支持\n  - _Leverage: 分析现有t_attendance_statistics表结构，消费模块统计表设计模式_\n  - _Requirements: Requirement 6_\n  - _Prompt: Role: 后端数据库开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 创建t_attendance_statistics_ext统计扩展表，分析现有t_attendance_statistics表结构，支持多维度统计字段和计算结果缓存 | Restrictions: 不重复已有字段，只扩展统计功能，支持大数据量存储，查询性能优化 | Success: 扩展表创建成功，支持高级统计功能，查询性能良好，数据结构合理_\n\n- [x] 2.1 创建考勤区域配置服务\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/service/AttendanceAreaConfigService.java\n  - 开发AttendanceAreaConfigService，管理考勤区域扩展配置\n  - 继承BaseService模式，集成AreaService基础功能\n  - Purpose: 提供考勤区域配置的业务逻辑管理\n  - _Leverage: BaseService模式，AreaService基础功能，AreaCacheManager缓存管理_\n  - _Requirements: Requirement 1_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceAreaConfigService继承BaseService，集成AreaService和AreaCacheManager，实现区域考勤配置的CRUD操作和缓存管理 | Restrictions: 严格遵循四层架构，复用AreaService基础功能，不能修改AreaEntity，必须通过扩展表实现功能 | Success: 区域配置服务开发完成，支持CRUD和缓存管理，与基础区域服务完美集成_\n\n- [-] 2.2 创建考勤设备管理服务\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/manager/AttendanceDeviceManager.java\n  - 开发AttendanceDeviceManager，管理考勤设备扩展功能\n  - 继承SmartDeviceEntity，通过extensionConfig存储考勤配置\n  - Purpose: 提供考勤设备的注册、配置、管理功能\n  - _Leverage: SmartDeviceService设备管理，PersonBiometricService生物特征管理_\n  - _Requirements: Requirement 2_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceDeviceManager继承SmartDeviceEntity，通过extensionConfig存储考勤配置，集成SmartDeviceService和PersonBiometricService | Restrictions: 必须通过extensionConfig存储考勤配置，不能修改SmartDeviceEntity结构，必须复用现有设备管理功能 | Success: 设备管理服务开发完成，支持设备注册和配置管理，与基础设备管理完美集成_\n\n- [x] 2.3 创建考勤规则引擎服务\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/engine/AttendanceRuleEngine.java\n  - 开发AttendanceRuleEngine，处理考勤规则验证和应用\n  - 实现规则匹配、条件验证、动作执行的完整流程\n  - Purpose: 提供灵活的考勤业务规则处理能力\n  - _Leverage: 消费模块业务规则引擎模式，现有JSON处理工具_\n  - _Requirements: Requirement 4_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceRuleEngine参考消费模块业务规则引擎，实现规则匹配、条件验证、动作执行流程，支持优先级排序和规则冲突处理 | Restrictions: 独立的规则引擎设计，与基础服务解耦，必须支持JSON配置解析，支持规则优先级处理 | Success: 规则引擎开发完成，支持规则配置和执行，规则匹配准确，性能表现良好_\n\n- [x] 3.1 重构考勤打卡服务\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/service/AttendanceService.java (modify existing)\n  - 重构现有AttendanceService，集成扩展的配置和规则引擎\n  - 保持现有API接口不变，内部实现采用扩展架构\n  - Purpose: 将现有打卡功能升级为支持扩展配置和规则验证的完整服务\n  - _Leverage: 新开发的区域配置服务、规则引擎，现有打卡业务逻辑_\n  - _Requirements: Requirement 1, 4_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 重构现有AttendanceService，集成AttendanceAreaConfigService和AttendanceRuleEngine，保持API接口不变，内部实现扩展架构 | Restrictions: 保持现有API接口不变，不能影响现有功能，必须集成新的扩展配置和规则引擎，确保向下兼容 | Success: 考勤服务重构完成，支持扩展配置和规则验证，现有功能正常，新功能集成良好_\n\n- [x] 3.2 创建智能排班引擎\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/engine/IntelligentSchedulingEngine.java\n  - 开发智能排班引擎，基于历史数据进行智能排班建议\n  - 实现模式识别、规则应用、优化建议等核心功能\n  - Purpose: 提供智能化的排班管理能力\n  - _Leverage: 消费模块的排班模式，现有班次数据结构和缓存机制_\n  - _Requirements: Requirement 3_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发IntelligentSchedulingEngine参考消费模块排班模式，实现模式识别、规则应用、优化建议功能，支持多种排班算法 | Restrictions: 复用现有班次数据结构，不能修改核心表结构，必须支持多种排班算法，结果要有可解释性 | Success: 智能排班引擎开发完成，支持模式识别和智能建议，算法性能良好，结果准确可用_\n\n- [x] 3.3 创建异常管理服务\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/service/AttendanceExceptionService.java\n  - 开发异常申请和处理流程，参考消费模块的申请审批机制\n  - 实现申请、审批、销假的全流程管理\n  - Purpose: 提供完整的考勤异常处理能力\n  - _Leverage: 现有审批工作流程，通知服务和权限控制_\n  - _Requirements: Requirement 4_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceExceptionService参考消费模块申请审批机制，集成现有审批工作流程，实现申请、审批、销假全流程 | Restrictions: 必须遵循既有的审批工作流程，不能修改现有审批引擎，要集成通知服务和权限控制 | Success: 异常管理服务开发完成，支持申请审批全流程，与现有审批系统完美集成_\n\n- [x] 4.1 实现考勤缓存管理\n  - File: src/main/java/net/lab1024/sa/admin/module/attendance/manager/AttendanceCacheManager.java\n  - 实现多级缓存架构，优化考勤系统性能\n  - 采用Caffeine+Redis双级缓存，事件驱动失效机制\n  - Purpose: 提供高性能的考勤数据访问能力\n  - _Leverage: AreaCacheManager和ShiftCacheManager的实现模式，现有缓存基础设施_\n  - _Requirements: Requirement 5_\n  - _Prompt: Role: 后端Java开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 实现AttendanceCacheManager参考AreaCacheManager模式，采用Caffeine+Redis双级缓存，实现事件驱动失效机制 | Restrictions: 必须遵循现有缓存管理机制，使用Caffeine+Redis双级缓存，要实现事件驱动失效，缓存命中率要达到90%+ | Success: 缓存管理实现完成，性能提升90%+，缓存命中率达标，失效机制正常工作_\n\n- [x] 4.2 优化数据库查询和索引\n  - File: Database optimization scripts and indexes\n  - 优化考勤相关数据库查询，创建合适的索引\n  - 分析慢查询，针对高频查询进行优化\n  - Purpose: 提升数据库查询性能，响应时间提升80%\n  - _Leverage: 现有慢查询日志，数据库性能分析工具_\n  - _Requirements: Requirement 5_\n  - _Prompt: Role: 后端数据库工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 优化考勤相关数据库查询，分析慢查询日志，创建合适的索引，针对高频查询进行性能优化 | Restrictions: 不能修改核心表结构，只优化查询和索引，必须保证数据一致性，不能影响现有功能 | Success: 数据库查询优化完成，响应时间提升80%，索引创建合理，慢查询问题解决_\n\n- [ ] 5.1 创建考勤区域管理页面\n  - File: src/views/attendance/area/AttendanceAreaManagement.vue\n  - 开发考勤区域配置管理界面，支持树形展示和配置编辑\n  - 使用Vue3+Ant Design Vue，遵循现有前端架构\n  - Purpose: 提供用户友好的考勤区域配置管理界面\n  - _Leverage: 现有的区域管理组件和表单组件，Ant Design Vue组件库_\n  - _Requirements: Requirement 1_\n  - _Prompt: Role: 前端Vue3开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceAreaManagement.vue页面，使用Vue3+Ant Design Vue，实现区域树形展示和配置编辑功能，复用现有区域管理组件 | Restrictions: 必须使用Vue3+Ant Design Vue，遵循现有前端架构，要复用现有组件，保持界面风格一致 | Success: 区域管理页面开发完成，支持配置管理，用户体验良好，界面风格统一_\n\n- [ ] 5.2 创建考勤设备管理页面\n  - File: src/views/attendance/device/AttendanceDeviceManagement.vue\n  - 开发考勤设备管理界面，支持设备注册和配置管理\n  - 集成基础设备管理，扩展考勤特定配置\n  - Purpose: 提供完整的考勤设备管理界面\n  - _Leverage: 现有的设备管理组件和状态管理，设备管理API接口_\n  - _Requirements: Requirement 2_\n  - _Prompt: Role: 前端Vue3开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceDeviceManagement.vue页面，集成基础设备管理，扩展考勤特定配置，支持设备注册和状态监控 | Restrictions: 必须集成基础设备管理，不能重复开发基础功能，只扩展考勤特定配置，要实时显示设备状态 | Success: 设备管理页面开发完成，支持设备管理，配置功能完善，状态监控正常_\n\n- [ ] 5.3 创建考勤统计报表页面\n  - File: src/views/attendance/report/AttendanceStatisticsReport.vue\n  - 开发考勤统计报表界面，支持多维度数据展示\n  - 使用ECharts图表库，支持动态配置和导出\n  - Purpose: 提供丰富的考勤数据可视化分析能力\n  - _Leverage: 现有的报表组件和数据分析服务，ECharts图表库_\n  - _Requirements: Requirement 6_\n  - _Prompt: Role: 前端Vue3开发工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 开发AttendanceStatisticsReport.vue页面，使用ECharts图表库，实现多维度数据展示和导出功能，复用现有报表组件 | Restrictions: 必须使用ECharts图表库，支持多维度数据展示，要实现数据导出功能，性能要满足大数据量展示 | Success: 统计报表页面开发完成，支持数据可视化，导出功能正常，性能表现良好_\n\n- [ ] 6.1 系统集成测试\n  - File: Integration test suites and test reports\n  - 执行完整的系统集成测试，验证各模块协同工作\n  - 确保所有接口集成正常，数据流转正确\n  - Purpose: 验证整个考勤系统的集成性和稳定性\n  - _Leverage: 现有的测试框架和自动化测试工具，测试环境_\n  - _Requirements: All functional requirements_\n  - _Prompt: Role: 测试工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 执行完整的系统集成测试，使用现有测试框架，验证各模块协同工作，确保API集成正常，数据流转正确 | Restrictions: 必须严格遵循测试规范，确保100%功能覆盖，要包含异常场景测试，必须提供详细测试报告 | Success: 系统集成测试通过，无严重缺陷，功能覆盖完整，测试报告详尽_\n\n- [ ] 6.2 性能压测和优化\n  - File: Performance test reports and optimization results\n  - 执行性能压测，确保系统满足高并发需求\n  - 验证1000+ QPS，响应时间<200ms的性能指标\n  - Purpose: 确保系统在高负载下的稳定性能\n  - _Leverage: JMeter等压测工具，性能监控和分析工具_\n  - _Requirements: Requirement 5_\n  - _Prompt: Role: 性能测试工程师 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 执行性能压测，使用JMeter等工具，确保1000+ QPS并发，响应时间<200ms，分析性能瓶颈并提供优化方案 | Restrictions: 必须达到1000+ QPS，响应时间<200ms，要识别性能瓶颈，提供具体优化建议，要包含缓存效果验证 | Success: 性能压测通过，达到预期性能指标，瓶颈识别准确，优化方案有效_\n\n- [ ] 6.3 用户验收测试\n  - File: User acceptance test reports and feedback\n  - 执行用户验收测试，确保满足业务需求\n  - 基于用户反馈进行最终调整和优化\n  - Purpose: 确保系统满足最终用户的实际使用需求\n  - _Leverage: 用户反馈收集机制，现有UAT测试流程_\n  - _Requirements: All requirements_\n  - _Prompt: Role: 产品经理和用户代表 | Task: Implement the task for spec complete-attendance-module-with-consumption-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: 执行用户验收测试，严格按照需求文档进行验收测试，收集用户反馈并进行最终调整，确保满足业务需求 | Restrictions: 必须严格按照需求文档进行验收测试，要记录所有用户反馈，必须基于反馈进行必要的调整优化 | Success: 用户验收测试通过，项目上线准备就绪，用户满意度达标，反馈问题全部解决_",
  "fileStats": {
    "size": 17416,
    "lines": 154,
    "lastModified": "2025-11-25T10:09:02.931Z"
  },
  "comments": []
}