# 排班管理功能布局文档 - 完整版

## 功能概述

排班管理模块是考勤系统的核心排班配置中心，提供排班日历、正常排班、临时排班、智能排班、排班统计等功能。该模块支持可视化排班操作、拖拽排班调整、批量排班处理、智能排班算法等，能够满足不同企业的复杂排班需求，提高排班效率和准确性。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **日历组件**: FullCalendar.js
- **拖拽组件**: Vue.Draggable
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue

### 项目文件组织结构
```
src/views/business/attendance/scheduling/
├── index.vue                        # 排班管理主页面
├── calendar/
│   ├── index.vue                   # 排班日历页面
│   ├── components/
│   │   ├── CalendarView.vue        # 日历视图组件
│   │   ├── ScheduleCard.vue        # 排班卡片组件
│   │   ├── CalendarToolbar.vue     # 日历工具栏
│   │   └── ViewSwitcher.vue        # 视图切换组件
│   └── api/
│       └── calendar-api.js         # 日历API
├── normal/
│   ├── index.vue                   # 正常排班页面
│   ├── components/
│   │   ├── PeriodicSchedule.vue    # 周期性排班
│   │   ├── BatchSchedule.vue       # 批量排班
│   │   └── ScheduleRules.vue       # 排班规则
│   └── api/
│       └── normal-api.js           # 正常排班API
├── temporary/
│   ├── index.vue                   # 临时排班页面
│   ├── components/
│   │   ├── TempScheduleForm.vue    # 临时排班表单
│   │   ├── ScheduleConflict.vue    # 冲突检测
│   │   └── PriorityManager.vue     # 优先级管理
│   └── api/
│       └── temporary-api.js        # 临时排班API
├── intelligent/
│   ├── index.vue                   # 智能排班页面
│   ├── components/
│   │   ├── AlgorithmSettings.vue   # 算法设置
│   │   ├── AutoScheduler.vue       # 自动排班
│   │   └── ScheduleOptimizer.vue   # 排班优化
│   └── api/
│       └── intelligent-api.js      # 智能排班API
├── statistics/
│   ├── index.vue                   # 排班统计页面
│   ├── components/
│   │   ├── CompletionStats.vue     # 完成统计
│   │   ├── QualityAnalysis.vue     # 质量分析
│   │   └── ScheduleReports.vue     # 排班报表
│   └── api/
│       └── statistics-api.js       # 统计API
├── mock/
│   └── scheduling-mock.js          # 模拟数据
├── api/
│   └── scheduling-api.js            # 统一API接口
└── utils/
    ├── calendar-utils.js           # 日历工具函数
    ├── schedule-utils.js           # 排班工具函数
    └── conflict-detector.js        # 冲突检测工具
```

### API接口设计
```javascript
// src/api/business/attendance/scheduling/calendar-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const calendarApi = {
  // 排班日历
  getScheduleCalendar: (params) => getRequest('/attendance/scheduling/calendar', params),
  createScheduleItem: (params) => postRequest('/attendance/scheduling/calendar/create', params),
  updateScheduleItem: (id, params) => putRequest(`/attendance/scheduling/calendar/${id}`, params),
  deleteScheduleItem: (id) => deleteRequest(`/attendance/scheduling/calendar/${id}`),

  // 拖拽排班
  moveScheduleItem: (params) => postRequest('/attendance/scheduling/calendar/move', params),
  copyScheduleItem: (params) => postRequest('/attendance/scheduling/calendar/copy', params),

  // 批量操作
  batchCreateSchedule: (params) => postRequest('/attendance/scheduling/calendar/batch-create', params),
  batchUpdateSchedule: (params) => postRequest('/attendance/scheduling/calendar/batch-update', params),
  batchDeleteSchedule: (params) => postRequest('/attendance/scheduling/calendar/batch-delete', params),
};

// src/api/business/attendance/scheduling/normal-api.js
export const normalSchedulingApi = {
  // 周期性排班
  getPeriodicSchedules: (params) => getRequest('/attendance/scheduling/normal/periodic/list', params),
  createPeriodicSchedule: (params) => postRequest('/attendance/scheduling/normal/periodic/create', params),
  updatePeriodicSchedule: (id, params) => putRequest(`/attendance/scheduling/normal/periodic/${id}`, params),

  // 批量排班
  getBatchScheduleTemplates: () => getRequest('/attendance/scheduling/normal/batch/templates'),
  createBatchSchedule: (params) => postRequest('/attendance/scheduling/normal/batch/create', params),

  // 排班规则
  getScheduleRules: (params) => getRequest('/attendance/scheduling/normal/rules', params),
  createScheduleRule: (params) => postRequest('/attendance/scheduling/normal/rules/create', params),
};

// src/api/business/attendance/scheduling/intelligent-api.js
export const intelligentApi = {
  // 算法设置
  getAlgorithmSettings: () => getRequest('/attendance/scheduling/intelligent/settings'),
  updateAlgorithmSettings: (params) => putRequest('/attendance/scheduling/intelligent/settings', params),

  // 自动排班
  startAutoScheduling: (params) => postRequest('/attendance/scheduling/intelligent/auto-start', params),
  getSchedulingProgress: (taskId) => getRequest(`/attendance/scheduling/intelligent/progress/${taskId}`),
  stopScheduling: (taskId) => postRequest(`/attendance/scheduling/intelligent/stop/${taskId}`),

  // 排班优化
  optimizeSchedule: (params) => postRequest('/attendance/scheduling/intelligent/optimize', params),
  getOptimizationSuggestions: (params) => getRequest('/attendance/scheduling/intelligent/suggestions', params),
};
```

## 核心功能模块

### 1. 排班日历

#### 日历视图组件
```vue
<!-- src/views/business/attendance/scheduling/calendar/components/CalendarView.vue -->
<template>
  <div class="calendar-view">
    <FullCalendar
      ref="calendarRef"
      :options="calendarOptions"
      class="calendar-container"
    />

    <!-- 排班详情弹窗 -->
    <a-modal
      v-model:open="scheduleDetailVisible"
      title="排班详情"
      @ok="handleSaveSchedule"
      @cancel="handleCloseDetail"
      width="600px"
    >
      <ScheduleDetailForm
        ref="scheduleFormRef"
        :schedule-data="currentSchedule"
        :date="selectedDate"
        @employee-select="handleEmployeeSelect"
      />
    </a-modal>

    <!-- 快速排班弹窗 -->
    <a-modal
      v-model:open="quickScheduleVisible"
      title="快速排班"
      @ok="handleQuickSchedule"
      @cancel="quickScheduleVisible = false"
    >
      <QuickScheduleForm
        :date="selectedDate"
        :employees="availableEmployees"
        @success="handleQuickScheduleSuccess"
      />
    </a-modal>

    <!-- 冲突提示 -->
    <a-modal
      v-model:open="conflictVisible"
      title="排班冲突检测"
      :footer="null"
    >
      <ConflictResolver
        :conflicts="scheduleConflicts"
        @resolve="handleResolveConflict"
      />
    </a-modal>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted, watch } from 'vue';
import { message } from 'ant-design-vue';
import FullCalendar from '@fullcalendar/vue3';
import dayGridPlugin from '@fullcalendar/daygrid';
import timeGridPlugin from '@fullcalendar/timegrid';
import interactionPlugin from '@fullcalendar/interaction';
import { Calendar } from '@fullcalendar/core';
import zhLocale from '@fullcalendar/core/locales/zh-cn';
import { calendarApi } from '/@/api/business/attendance/scheduling/calendar-api';
import ScheduleDetailForm from './ScheduleDetailForm.vue';
import QuickScheduleForm from './QuickScheduleForm.vue';
import ConflictResolver from './ConflictResolver.vue';

const props = defineProps({
  viewMode: {
    type: String,
    default: 'dayGridMonth'
  },
  currentDate: {
    type: Date,
    default: () => new Date()
  },
  filters: {
    type: Object,
    default: () => ({})
  }
});

const emit = defineEmits(['view-change', 'date-change', 'schedule-change']);

const calendarRef = ref();
const scheduleDetailVisible = ref(false);
const quickScheduleVisible = ref(false);
const conflictVisible = ref(false);
const currentSchedule = ref(null);
const selectedDate = ref(null);
const availableEmployees = ref([]);
const scheduleConflicts = ref([]);
const scheduleFormRef = ref();

const calendarOptions = reactive({
  plugins: [dayGridPlugin, timeGridPlugin, interactionPlugin],
  initialView: props.viewMode,
  headerToolbar: false, // 使用自定义工具栏
  locale: zhLocale,
  height: 'auto',
  contentHeight: 600,
  editable: true,
  droppable: true,
  selectable: true,
  selectMirror: true,
  dayMaxEvents: true,
  weekends: true,
  events: [],
  eventClick: handleEventClick,
  eventDrop: handleEventDrop,
  eventResize: handleEventResize,
  select: handleDateSelect,
  drop: handleDrop,
});

// 加载排班数据
const loadScheduleData = async () => {
  try {
    const params = {
      startDate: formatDate(getCalendarStart()),
      endDate: formatDate(getCalendarEnd()),
      ...props.filters
    };

    const response = await calendarApi.getScheduleCalendar(params);
    const events = response.data.map(item => formatCalendarEvent(item));

    const calendarApi = calendarRef.value?.getApi();
    if (calendarApi) {
      calendarApi.removeAllEvents();
      calendarApi.addEventSource(events);
    }
  } catch (error) {
    console.error('加载排班数据失败:', error);
    message.error('加载排班数据失败');
  }
};

// 格式化日历事件
const formatCalendarEvent = (item) => {
  return {
    id: item.id,
    title: `${item.employeeName} - ${item.shiftName}`,
    start: `${item.date}T${item.startTime || '00:00'}`,
    end: `${item.date}T${item.endTime || '23:59'}`,
    backgroundColor: getShiftColor(item.shiftType),
    borderColor: getShiftBorderColor(item.shiftType),
    textColor: '#fff',
    extendedProps: {
      ...item,
      type: 'schedule'
    }
  };
};

// 获取班次颜色
const getShiftColor = (shiftType) => {
  const colorMap = {
    morning: '#52c41a',
    afternoon: '#1890ff',
    night: '#722ed1',
    flexible: '#fa8c16'
  };
  return colorMap[shiftType] || '#1890ff';
};

// 获取班次边框颜色
const getShiftBorderColor = (shiftType) => {
  return getShiftColor(shiftType);
};

// 事件点击处理
const handleEventClick = (info) => {
  const event = info.event;
  currentSchedule.value = event.extendedProps;
  selectedDate.value = event.start;
  scheduleDetailVisible.value = true;
};

// 事件拖拽处理
const handleEventDrop = async (info) => {
  try {
    const event = info.event;
    const newDate = formatDate(event.start);

    await calendarApi.moveScheduleItem({
      scheduleId: event.id,
      newDate: newDate,
      oldDate: formatDate(info.oldEvent.start)
    });

    message.success('排班调整成功');
    emit('schedule-change');
  } catch (error) {
    info.revert();
    message.error('排班调整失败');
  }
};

// 事件大小调整处理
const handleEventResize = async (info) => {
  try {
    const event = info.event;
    await calendarApi.updateScheduleItem(event.id, {
      startTime: formatTime(event.start),
      endTime: formatTime(event.end)
    });

    message.success('排班时间调整成功');
    emit('schedule-change');
  } catch (error) {
    info.revert();
    message.error('排班时间调整失败');
  }
};

// 日期选择处理
const handleDateSelect = (info) => {
  selectedDate.value = info.start;
  quickScheduleVisible.value = true;
};

// 拖拽处理
const handleDrop = async (info) => {
  try {
    const dateStr = formatDate(info.date);
    const employeeData = JSON.parse(info.draggedEl.dataset.employee);

    await calendarApi.createScheduleItem({
      employeeId: employeeData.id,
      date: dateStr,
      shiftId: employeeData.defaultShiftId,
      source: 'drag_drop'
    });

    message.success('排班添加成功');
    loadScheduleData();
    emit('schedule-change');
  } catch (error) {
    message.error('排班添加失败');
  }
};

// 保存排班详情
const handleSaveSchedule = async () => {
  try {
    const formData = await scheduleFormRef.value.getFormData();

    if (currentSchedule.value) {
      await calendarApi.updateScheduleItem(currentSchedule.value.id, formData);
    } else {
      await calendarApi.createScheduleItem(formData);
    }

    message.success('排班保存成功');
    scheduleDetailVisible.value = false;
    loadScheduleData();
    emit('schedule-change');
  } catch (error) {
    message.error('排班保存失败');
  }
};

// 关闭详情
const handleCloseDetail = () => {
  scheduleDetailVisible.value = false;
  currentSchedule.value = null;
};

// 快速排班
const handleQuickSchedule = () => {
  // 逻辑由QuickScheduleForm处理
};

// 快速排班成功
const handleQuickScheduleSuccess = () => {
  quickScheduleVisible.value = false;
  loadScheduleData();
  emit('schedule-change');
};

// 员工选择处理
const handleEmployeeSelect = (employee) => {
  // 处理员工选择逻辑
};

// 解决冲突
const handleResolveConflict = (resolution) => {
  conflictVisible.value = false;
  // 应用解决方案
};

// 工具函数
const formatDate = (date) => {
  return Calendar.formatDate(date, { year: 'numeric', month: '2-digit', day: '2-digit' });
};

const formatTime = (date) => {
  return Calendar.formatDate(date, { hour: '2-digit', minute: '2-digit', hour12: false });
};

const getCalendarStart = () => {
  const calendarApi = calendarRef.value?.getApi();
  return calendarApi?.view?.currentStart || new Date();
};

const getCalendarEnd = () => {
  const calendarApi = calendarRef.value?.getApi();
  return calendarApi?.view?.currentEnd || new Date();
};

// 监听props变化
watch(() => props.currentDate, () => {
  const calendarApi = calendarRef.value?.getApi();
  if (calendarApi) {
    calendarApi.gotoDate(props.currentDate);
  }
});

watch(() => props.viewMode, (newMode) => {
  const calendarApi = calendarRef.value?.getApi();
  if (calendarApi) {
    calendarApi.changeView(newMode);
  }
});

watch(() => props.filters, () => {
  loadScheduleData();
}, { deep: true });

// 暴露方法给父组件
defineExpose({
  loadScheduleData,
  getCalendarApi: () => calendarRef.value?.getApi()
});

onMounted(() => {
  loadScheduleData();
});
</script>

<style scoped lang="less">
.calendar-view {
  .calendar-container {
    :deep(.fc) {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    :deep(.fc-toolbar-title) {
      font-size: 18px;
      font-weight: 600;
    }

    :deep(.fc-button) {
      background: #fff;
      border: 1px solid #d9d9d9;
      color: rgba(0, 0, 0, 0.88);

      &:hover {
        border-color: #1890ff;
        color: #1890ff;
      }

      &.fc-button-active {
        background: #1890ff;
        border-color: #1890ff;
        color: #fff;
      }
    }

    :deep(.fc-event) {
      border-radius: 4px;
      cursor: pointer;

      &:hover {
        opacity: 0.8;
      }
    }

    :deep(.fc-daygrid-day) {
      min-height: 100px;
    }

    :deep(.fc-day-today) {
      background: #f0f8ff;
    }
  }
}
</style>
```

### 2. 智能排班

#### 自动排班组件
```vue
<!-- src/views/business/attendance/scheduling/intelligent/components/AutoScheduler.vue -->
<template>
  <div class="auto-scheduler">
    <div class="scheduler-header">
      <h3>智能自动排班</h3>
      <div class="scheduler-actions">
        <a-button @click="showSettings">
          <template #icon><SettingOutlined /></template>
          算法设置
        </a-button>
        <a-button type="primary" @click="startScheduling" :loading="scheduling">
          <template #icon><PlayCircleOutlined /></template>
          开始排班
        </a-button>
      </div>
    </div>

    <!-- 排班配置 -->
    <div class="scheduling-config">
      <a-card title="排班配置" :bordered="false">
        <a-form layout="vertical" :model="schedulingConfig">
          <a-row :gutter="16">
            <a-col :span="8">
              <a-form-item label="排班周期">
                <a-range-picker
                  v-model:value="schedulingConfig.dateRange"
                  style="width: 100%"
                />
              </a-form-item>
            </a-col>
            <a-col :span="8">
              <a-form-item label="目标部门">
                <a-select
                  v-model:value="schedulingConfig.departments"
                  mode="multiple"
                  placeholder="选择部门"
                  style="width: 100%"
                >
                  <a-select-option
                    v-for="dept in departments"
                    :key="dept.id"
                    :value="dept.id"
                  >
                    {{ dept.name }}
                  </a-select-option>
                </a-select>
              </a-form-item>
            </a-col>
            <a-col :span="8">
              <a-form-item label="排班模式">
                <a-select v-model:value="schedulingConfig.mode" style="width: 100%">
                  <a-select-option value="fill">填充空缺</a-select-option>
                  <a-select-option value="optimize">优化现有</a-select-option>
                  <a-select-option value="rebuild">重新排班</a-select-option>
                </a-select>
              </a-form-item>
            </a-col>
          </a-row>

          <a-form-item label="排班约束">
            <a-checkbox-group v-model:value="schedulingConfig.constraints">
              <a-checkbox value="workTime">工时平衡</a-checkbox>
              <a-checkbox value="skillMatch">技能匹配</a-checkbox>
              <a-checkbox value="prefMatch">偏好匹配</a-checkbox>
              <a-checkbox value="legalCompliance">合规要求</a-checkbox>
              <a-checkbox value="costOptimize">成本优化</a-checkbox>
            </a-checkbox-group>
          </a-form-item>

          <a-form-item label="优化目标">
            <a-radio-group v-model:value="schedulingConfig.objective">
              <a-radio value="balance">工作量平衡</a-radio>
              <a-radio value="coverage">覆盖率最大化</a-radio>
              <a-radio value="cost">成本最小化</a-radio>
              <a-radio value="satisfaction">员工满意度</a-radio>
            </a-radio-group>
          </a-form-item>
        </a-form>
      </a-card>
    </div>

    <!-- 排班进度 -->
    <div class="scheduling-progress" v-if="scheduling || progressVisible">
      <a-card title="排班进度" :bordered="false">
        <div class="progress-content">
          <a-progress
            :percent="progressPercent"
            :status="progressStatus"
            stroke-linecap="square"
          />

          <div class="progress-details">
            <a-descriptions :column="2" size="small">
              <a-descriptions-item label="当前步骤">
                {{ currentStep }}
              </a-descriptions-item>
              <a-descriptions-item label="预计剩余时间">
                {{ estimatedTime }}
              </a-descriptions-item>
              <a-descriptions-item label="已处理员工">
                {{ processedEmployees }}/{{ totalEmployees }}
              </a-descriptions-item>
              <a-descriptions-item label="已排班天数">
                {{ processedDays }}/{{ totalDays }}
              </a-descriptions-item>
            </a-descriptions>
          </div>

          <div class="progress-actions">
            <a-button v-if="scheduling" @click="pauseScheduling">
              <template #icon><PauseCircleOutlined /></template>
              暂停
            </a-button>
            <a-button v-if="scheduling" danger @click="stopScheduling">
              <template #icon><StopOutlined /></template>
              停止
            </a-button>
            <a-button v-if="!scheduling && progressPercent < 100" @click="resumeScheduling">
              <template #icon><PlayCircleOutlined /></template>
              继续
            </a-button>
          </div>
        </div>
      </a-card>
    </div>

    <!-- 排班结果 -->
    <div class="scheduling-results" v-if="resultsVisible">
      <a-card title="排班结果" :bordered="false">
        <template #extra>
          <a-space>
            <a-button @click="exportResults">
              <template #icon><ExportOutlined /></template>
              导出结果
            </a-button>
            <a-button @click="applyResults" type="primary">
              <template #icon><CheckOutlined /></template>
              应用排班
            </a-button>
          </a-space>
        </template>

        <a-row :gutter="16">
          <a-col :span="6">
            <a-statistic
              title="排班完成率"
              :value="results.completionRate"
              suffix="%"
              :value-style="{ color: '#52c41a' }"
            />
          </a-col>
          <a-col :span="6">
            <a-statistic
              title="覆盖率"
              :value="results.coverageRate"
              suffix="%"
              :value-style="{ color: '#1890ff' }"
            />
          </a-col>
          <a-col :span="6">
            <a-statistic
              title="平衡度得分"
              :value="results.balanceScore"
              :value-style="{ color: '#fa8c16' }"
            />
          </a-col>
          <a-col :span="6">
            <a-statistic
              title="满意度预估"
              :value="results.satisfactionScore"
              :value-style="{ color: '#722ed1' }"
            />
          </a-col>
        </a-row>

        <div class="results-charts" style="margin-top: 24px;">
          <a-tabs>
            <a-tab-pane key="distribution" tab="工作量分布">
              <WorkloadDistributionChart :data="results.workloadData" />
            </a-tab-pane>
            <a-tab-pane key="coverage" tab="覆盖分析">
              <CoverageAnalysisChart :data="results.coverageData" />
            </a-tab-pane>
            <a-tab-pane key="conflicts" tab="冲突检测">
              <ConflictDetectionChart :data="results.conflictData" />
            </a-tab-pane>
          </a-tabs>
        </div>
      </a-card>
    </div>

    <!-- 算法设置弹窗 -->
    <AlgorithmSettings
      v-model:visible="settingsVisible"
      :settings="algorithmSettings"
      @save="handleSaveSettings"
    />
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  SettingOutlined,
  PlayCircleOutlined,
  PauseCircleOutlined,
  StopOutlined,
  ExportOutlined,
  CheckOutlined
} from '@ant-design/icons-vue';
import { intelligentApi } from '/@/api/business/attendance/scheduling/intelligent-api';
import AlgorithmSettings from './AlgorithmSettings.vue';
import WorkloadDistributionChart from './WorkloadDistributionChart.vue';
import CoverageAnalysisChart from './CoverageAnalysisChart.vue';
import ConflictDetectionChart from './ConflictDetectionChart.vue';

const emit = defineEmits(['scheduling-complete', 'results-applied']);

const scheduling = ref(false);
const progressVisible = ref(false);
const resultsVisible = ref(false);
const settingsVisible = ref(false);

const progressPercent = ref(0);
const progressStatus = ref('active');
const currentStep = ref('');
const estimatedTime = ref('');
const processedEmployees = ref(0);
const totalEmployees = ref(0);
const processedDays = ref(0);
const totalDays = ref(0);

const departments = ref([]);
const algorithmSettings = ref({});

const schedulingConfig = reactive({
  dateRange: [],
  departments: [],
  mode: 'fill',
  constraints: ['workTimeBalance', 'legalCompliance'],
  objective: 'balance'
});

const results = reactive({
  completionRate: 0,
  coverageRate: 0,
  balanceScore: 0,
  satisfactionScore: 0,
  workloadData: [],
  coverageData: [],
  conflictData: []
});

let currentTaskId = null;
let progressTimer = null;

// 加载部门列表
const loadDepartments = async () => {
  try {
    const response = await intelligentApi.getDepartments();
    departments.value = response.data;
  } catch (error) {
    console.error('加载部门列表失败:', error);
  }
};

// 加载算法设置
const loadAlgorithmSettings = async () => {
  try {
    const response = await intelligentApi.getAlgorithmSettings();
    algorithmSettings.value = response.data;
  } catch (error) {
    console.error('加载算法设置失败:', error);
  }
};

// 显示设置
const showSettings = () => {
  settingsVisible.value = true;
};

// 保存设置
const handleSaveSettings = async (settings) => {
  try {
    await intelligentApi.updateAlgorithmSettings(settings);
    algorithmSettings.value = { ...settings };
    message.success('算法设置保存成功');
  } catch (error) {
    message.error('算法设置保存失败');
  }
};

// 开始排班
const startScheduling = async () => {
  if (!validateConfig()) {
    return;
  }

  scheduling.value = true;
  progressVisible.value = true;
  resultsVisible.value = false;
  progressPercent.value = 0;
  progressStatus.value = 'active';

  try {
    const response = await intelligentApi.startAutoScheduling({
      ...schedulingConfig,
      algorithmSettings: algorithmSettings.value
    });

    currentTaskId = response.data.taskId;
    startProgressMonitoring();
  } catch (error) {
    scheduling.value = false;
    progressVisible.value = false;
    message.error('启动排班失败');
  }
};

// 验证配置
const validateConfig = () => {
  if (!schedulingConfig.dateRange || schedulingConfig.dateRange.length !== 2) {
    message.warning('请选择排班周期');
    return false;
  }

  if (!schedulingConfig.departments || schedulingConfig.departments.length === 0) {
    message.warning('请选择目标部门');
    return false;
  }

  return true;
};

// 开始进度监控
const startProgressMonitoring = () => {
  progressTimer = setInterval(async () => {
    try {
      const response = await intelligentApi.getSchedulingProgress(currentTaskId);
      const progress = response.data;

      progressPercent.value = progress.percent;
      currentStep.value = progress.currentStep;
      estimatedTime.value = progress.estimatedTime;
      processedEmployees.value = progress.processedEmployees;
      totalEmployees.value = progress.totalEmployees;
      processedDays.value = progress.processedDays;
      totalDays.value = progress.totalDays;

      if (progress.status === 'completed') {
        completeScheduling(progress.results);
      } else if (progress.status === 'failed') {
        failScheduling(progress.error);
      }
    } catch (error) {
      console.error('获取进度失败:', error);
    }
  }, 2000);
};

// 完成排班
const completeScheduling = (scheduleResults) => {
  scheduling.value = false;
  progressStatus.value = 'success';
  clearInterval(progressTimer);

  // 显示结果
  Object.assign(results, scheduleResults);
  resultsVisible.value = true;

  message.success('智能排班完成');
  emit('scheduling-complete', scheduleResults);
};

// 排班失败
const failScheduling = (error) => {
  scheduling.value = false;
  progressStatus.value = 'exception';
  clearInterval(progressTimer);

  message.error(`排班失败: ${error}`);
};

// 暂停排班
const pauseScheduling = async () => {
  try {
    await intelligentApi.pauseScheduling(currentTaskId);
    scheduling.value = false;
    clearInterval(progressTimer);
    message.info('排班已暂停');
  } catch (error) {
    message.error('暂停失败');
  }
};

// 停止排班
const stopScheduling = async () => {
  try {
    await intelligentApi.stopScheduling(currentTaskId);
    scheduling.value = false;
    progressVisible.value = false;
    clearInterval(progressTimer);
    message.info('排班已停止');
  } catch (error) {
    message.error('停止失败');
  }
};

// 继续排班
const resumeScheduling = () => {
  scheduling.value = true;
  startProgressMonitoring();
};

// 导出结果
const exportResults = () => {
  // 导出排班结果
  message.info('导出功能开发中...');
};

// 应用排班
const applyResults = async () => {
  try {
    await intelligentApi.applySchedulingResults(currentTaskId);
    message.success('排班应用成功');
    emit('results-applied', results);
  } catch (error) {
    message.error('排班应用失败');
  }
};

onMounted(() => {
  loadDepartments();
  loadAlgorithmSettings();
});
</script>

<style scoped lang="less">
.auto-scheduler {
  .scheduler-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;

    h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
  }

  .scheduling-config {
    margin-bottom: 24px;
  }

  .scheduling-progress {
    margin-bottom: 24px;

    .progress-content {
      .progress-details {
        margin: 16px 0;
      }

      .progress-actions {
        display: flex;
        gap: 8px;
        justify-content: center;
      }
    }
  }

  .scheduling-results {
    .results-charts {
      min-height: 400px;
    }
  }
}
</style>
```

## Mock数据示例

```javascript
// src/mock/scheduling-mock.js
export const mockScheduleCalendar = [
  {
    id: 'schedule001',
    employeeId: 'emp001',
    employeeName: '张三',
    date: '2024-01-15',
    shiftId: 'shift001',
    shiftName: '标准早班',
    startTime: '09:00',
    endTime: '18:00',
    shiftType: 'morning',
    status: 'confirmed'
  },
  {
    id: 'schedule002',
    employeeId: 'emp002',
    employeeName: '李四',
    date: '2024-01-15',
    shiftId: 'shift002',
    shiftName: '夜班',
    startTime: '22:00',
    endTime: '06:00',
    shiftType: 'night',
    status: 'confirmed'
  }
];

export const mockSchedulingResults = {
  completionRate: 95,
  coverageRate: 98,
  balanceScore: 87,
  satisfactionScore: 82,
  workloadData: [
    { name: '张三', hours: 160, target: 160 },
    { name: '李四', hours: 168, target: 160 },
    { name: '王五', hours: 152, target: 160 }
  ],
  coverageData: [
    { date: '2024-01-15', required: 50, assigned: 50 },
    { date: '2024-01-16', required: 50, assigned: 48 },
    { date: '2024-01-17', required: 50, assigned: 50 }
  ],
  conflictData: [
    { type: 'over_time', count: 3 },
    { type: 'skill_mismatch', count: 1 },
    { type: 'preference_conflict', count: 2 }
  ]
};

export default {
  mockScheduleCalendar,
  mockSchedulingResults
};
```

## 开发注意事项总结

### 核心功能要点
1. **可视化排班** - 直观的日历界面和拖拽操作
2. **智能算法** - 多约束条件下的优化排班
3. **冲突检测** - 实时检测和解决排班冲突
4. **批量操作** - 高效的批量排班功能
5. **进度监控** - 实时显示排班进度和状态
6. **结果分析** - 详细的排班效果评估

### 性能优化建议
1. 日历数据按需加载
2. 大量排班数据虚拟滚动
3. 智能排班算法异步执行
4. 排班结果缓存机制

### 用户体验优化
1. 拖拽式操作界面
2. 实时保存和同步
3. 智能提示和建议
4. 丰富的快捷操作

## 总结

排班管理模块作为考勤系统的排班核心，需要重点关注：

- 排班操作的直观性和便捷性
- 智能算法的准确性和效率
- 冲突检测的实时性和准确性
- 批量操作的高效性
- 结果分析的全面性

通过遵循本文档的技术规范，可以构建出功能完善、智能高效的排班管理模块。