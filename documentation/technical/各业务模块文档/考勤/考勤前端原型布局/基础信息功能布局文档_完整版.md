# 基础信息功能布局文档 - 完整版

## 功能概述

基础信息管理模块是考勤管理系统的基础数据支撑，负责管理组织架构、员工档案、用户权限等核心基础数据。该模块提供完整的组织树管理、员工全生命周期管理、用户权限分配等功能，为其他业务模块提供基础数据支撑。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **表单验证**: VeeValidate 4.x

### 项目文件组织结构
```
src/views/business/attendance/basic-info/
├── index.vue                        # 基础信息主页面
├── organization/
│   ├── index.vue                   # 组织架构管理页面
│   ├── components/
│   │   ├── OrgTree.vue            # 组织树组件
│   │   ├── DeptForm.vue           # 部门表单组件
│   │   ├── PositionForm.vue       # 岗位表单组件
│   │   └── LevelForm.vue          # 职级表单组件
│   └── api/
│       └── organization-api.js     # 组织架构API
├── employee/
│   ├── index.vue                   # 员工管理页面
│   ├── components/
│   │   ├── EmployeeTable.vue      # 员工表格组件
│   │   ├── EmployeeForm.vue       # 员工表单组件
│   │   ├── ImportModal.vue        # 批量导入组件
│   │   └── PermissionModal.vue    # 权限分配组件
│   └── api/
│       └── employee-api.js         # 员工管理API
├── user/
│   ├── index.vue                   # 用户管理页面 [系统管理员]
│   ├── components/
│   │   ├── UserTable.vue          # 用户表格组件
│   │   ├── UserForm.vue           # 用户表单组件
│   │   └── RoleAssign.vue         # 角色分配组件
│   └── api/
│       └── user-api.js             # 用户管理API
├── mock/
│   └── basic-info-mock.js          # 模拟数据
├── api/
│   └── basic-info-api.js            # 统一API接口
└── utils/
    ├── org-utils.js                # 组织架构工具函数
    └── import-utils.js             # 导入工具函数
```

### API接口设计
```javascript
// src/api/business/attendance/basic-info/organization-api.js
import { postRequest, getRequest, putRequest, deleteRequest } from '/@/lib/axios';

export const organizationApi = {
  // 部门管理
  getDeptList: () => getRequest('/attendance/organization/dept/list'),
  getDeptTree: () => getRequest('/attendance/organization/dept/tree'),
  getDeptById: (id) => getRequest(`/attendance/organization/dept/${id}`),
  createDept: (params) => postRequest('/attendance/organization/dept/create', params),
  updateDept: (id, params) => putRequest(`/attendance/organization/dept/update/${id}`, params),
  deleteDept: (id) => deleteRequest(`/attendance/organization/dept/delete/${id}`),

  // 岗位管理
  getPositionList: (params) => getRequest('/attendance/organization/position/list', params),
  createPosition: (params) => postRequest('/attendance/organization/position/create', params),
  updatePosition: (id, params) => putRequest(`/attendance/organization/position/update/${id}`, params),
  deletePosition: (id) => deleteRequest(`/attendance/organization/position/delete/${id}`),

  // 职级管理
  getLevelList: (params) => getRequest('/attendance/organization/level/list', params),
  createLevel: (params) => postRequest('/attendance/organization/level/create', params),
  updateLevel: (id, params) => putRequest(`/attendance/organization/level/update/${id}`, params),
  deleteLevel: (id) => deleteRequest(`/attendance/organization/level/delete/${id}`),
};

// src/api/business/attendance/basic-info/employee-api.js
export const employeeApi = {
  // 员工管理
  getEmployeeList: (params) => getRequest('/attendance/employee/list', params),
  getEmployeeById: (id) => getRequest(`/attendance/employee/${id}`),
  createEmployee: (params) => postRequest('/attendance/employee/create', params),
  updateEmployee: (id, params) => putRequest(`/attendance/employee/update/${id}`, params),
  deleteEmployee: (id) => deleteRequest(`/attendance/employee/delete/${id}`),
  importEmployees: (formData) => postRequest('/attendance/employee/import', formData),
  downloadTemplate: () => getRequest('/attendance/employee/template'),

  // 权限管理
  getEmployeePermissions: (id) => getRequest(`/attendance/employee/${id}/permissions`),
  updateEmployeePermissions: (id, params) => putRequest(`/attendance/employee/${id}/permissions`, params),
};

// src/api/business/attendance/basic-info/user-api.js
export const userApi = {
  // 用户管理
  getUserList: (params) => getRequest('/attendance/user/list', params),
  getUserById: (id) => getRequest(`/attendance/user/${id}`),
  createUser: (params) => postRequest('/attendance/user/create', params),
  updateUser: (id, params) => putRequest(`/attendance/user/update/${id}`, params),
  deleteUser: (id) => deleteRequest(`/attendance/user/delete/${id}`),
  resetPassword: (id) => postRequest(`/attendance/user/${id}/reset-password`),
  updateUserStatus: (id, status) => putRequest(`/attendance/user/${id}/status`, { status }),

  // 角色管理
  getRoleList: () => getRequest('/attendance/user/roles'),
  assignRole: (userId, roleIds) => postRequest('/attendance/user/assign-role', { userId, roleIds }),
};
```

## 核心功能模块

### 1. 组织架构管理

#### 组织树组件
```vue
<!-- src/views/business/attendance/basic-info/organization/components/OrgTree.vue -->
<template>
  <div class="org-tree">
    <div class="tree-header">
      <h3>组织架构</h3>
      <div class="tree-actions">
        <a-button size="small" type="primary" @click="handleAddDept">
          <template #icon><PlusOutlined /></template>
          新增部门
        </a-button>
        <a-button size="small" @click="handleExpandAll">
          <template #icon><ExpandOutlined /></template>
          全部展开
        </a-button>
        <a-button size="small" @click="handleCollapseAll">
          <template #icon><CompressOutlined /></template>
          全部收起
        </a-button>
      </div>
    </div>

    <a-tree
      v-model:expandedKeys="expandedKeys"
      v-model:selectedKeys="selectedKeys"
      :tree-data="treeData"
      :field-names="{ title: 'name', key: 'id', children: 'children' }"
      show-icon
      @select="handleTreeSelect"
      @right-click="handleRightClick"
    >
      <template #icon="{ dataRef }">
        <HomeOutlined v-if="dataRef.type === 'company'" />
        <BankOutlined v-else-if="dataRef.type === 'dept'" />
        <TeamOutlined v-else />
      </template>

      <template #title="{ name, code, employeeCount }">
        <div class="tree-node-title">
          <span class="node-name">{{ name }}</span>
          <span class="node-code" v-if="code">({{ code }})</span>
          <span class="node-count" v-if="employeeCount">{{ employeeCount }}人</span>
        </div>
      </template>
    </a-tree>

    <!-- 右键菜单 -->
    <div
      v-if="contextMenuVisible"
      class="context-menu"
      :style="{ left: contextMenuX + 'px', top: contextMenuY + 'px' }"
    >
      <div class="menu-item" @click="handleAddDept">
        <PlusOutlined />
        新增子部门
      </div>
      <div class="menu-item" @click="handleEditDept">
        <EditOutlined />
        编辑部门
      </div>
      <div class="menu-item danger" @click="handleDeleteDept">
        <DeleteOutlined />
        删除部门
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  PlusOutlined,
  ExpandOutlined,
  CompressOutlined,
  HomeOutlined,
  BankOutlined,
  TeamOutlined,
  EditOutlined,
  DeleteOutlined
} from '@ant-design/icons-vue';
import { organizationApi } from '/@/api/business/attendance/basic-info/organization-api';

const emit = defineEmits(['dept-select', 'dept-add', 'dept-edit', 'dept-delete']);

const expandedKeys = ref([]);
const selectedKeys = ref([]);
const treeData = ref([]);
const contextMenuVisible = ref(false);
const contextMenuX = ref(0);
const contextMenuY = ref(0);
const currentNode = ref(null);

// 加载组织树数据
const loadOrgTree = async () => {
  try {
    const response = await organizationApi.getDeptTree();
    treeData.value = formatTreeData(response.data);
    // 默认展开到二级
    expandedKeys.value = getExpandedKeys(treeData.value, 2);
  } catch (error) {
    console.error('加载组织树失败:', error);
    message.error('加载组织树失败');
  }
};

// 格式化树数据
const formatTreeData = (data) => {
  return data.map(item => ({
    ...item,
    type: item.level === 0 ? 'company' : 'dept',
    children: item.children ? formatTreeData(item.children) : []
  }));
};

// 获取展开的节点
const getExpandedKeys = (data, level) => {
  const keys = [];
  const traverse = (nodes, currentLevel) => {
    if (currentLevel < level) {
      nodes.forEach(node => {
        keys.push(node.id);
        if (node.children && node.children.length > 0) {
          traverse(node.children, currentLevel + 1);
        }
      });
    }
  };
  traverse(data, 0);
  return keys;
};

// 树节点选择
const handleTreeSelect = (selectedKeys, { node }) => {
  emit('dept-select', node);
};

// 右键菜单
const handleRightClick = ({ event, node }) => {
  event.preventDefault();
  currentNode.value = node;
  contextMenuVisible.value = true;
  contextMenuX.value = event.clientX;
  contextMenuY.value = event.clientY;

  setTimeout(() => {
    document.addEventListener('click', () => {
      contextMenuVisible.value = false;
    }, { once: true });
  }, 100);
};

// 新增部门
const handleAddDept = () => {
  contextMenuVisible.value = false;
  const parentDept = currentNode.value || null;
  emit('dept-add', parentDept);
};

// 编辑部门
const handleEditDept = () => {
  contextMenuVisible.value = false;
  if (currentNode.value) {
    emit('dept-edit', currentNode.value);
  }
};

// 删除部门
const handleDeleteDept = () => {
  contextMenuVisible.value = false;
  if (currentNode.value) {
    emit('dept-delete', currentNode.value);
  }
};

// 全部展开
const handleExpandAll = () => {
  const getAllKeys = (data) => {
    const keys = [];
    data.forEach(node => {
      keys.push(node.id);
      if (node.children && node.children.length > 0) {
        keys.push(...getAllKeys(node.children));
      }
    });
    return keys;
  };
  expandedKeys.value = getAllKeys(treeData.value);
};

// 全部收起
const handleCollapseAll = () => {
  expandedKeys.value = [];
};

onMounted(() => {
  loadOrgTree();
});
</script>

<style scoped lang="less">
.org-tree {
  height: 100%;
  background: #fff;
  border-radius: 8px;
  padding: 16px;

  .tree-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;

    h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    .tree-actions {
      display: flex;
      gap: 8px;
    }
  }

  .tree-node-title {
    display: flex;
    align-items: center;
    gap: 8px;

    .node-name {
      font-weight: 500;
    }

    .node-code {
      color: #999;
      font-size: 12px;
    }

    .node-count {
      color: #1890ff;
      font-size: 12px;
      background: #e6f7ff;
      padding: 2px 6px;
      border-radius: 4px;
    }
  }

  .context-menu {
    position: fixed;
    background: #fff;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    padding: 4px 0;
    z-index: 1000;
    min-width: 120px;

    .menu-item {
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;

      &:hover {
        background: #f5f5f5;
      }

      &.danger {
        color: #ff4d4f;

        &:hover {
          background: #fff2f0;
        }
      }
    }
  }
}
</style>
```

#### 部门表单组件
```vue
<!-- src/views/business/attendance/basic-info/organization/components/DeptForm.vue -->
<template>
  <a-modal
    :open="visible"
    :title="isEdit ? '编辑部门' : '新增部门'"
    @ok="handleSubmit"
    @cancel="handleCancel"
    :confirm-loading="loading"
    width="600px"
  >
    <a-form
      ref="formRef"
      :model="formData"
      :rules="formRules"
      :label-col="{ span: 6 }"
      :wrapper-col="{ span: 18 }"
    >
      <a-form-item label="上级部门" name="parentId" v-if="parentDept">
        <a-input :value="parentDept.name" disabled />
      </a-form-item>

      <a-form-item label="部门名称" name="name">
        <a-input v-model:value="formData.name" placeholder="请输入部门名称" />
      </a-form-item>

      <a-form-item label="部门编码" name="code">
        <a-input v-model:value="formData.code" placeholder="请输入部门编码" />
      </a-form-item>

      <a-form-item label="部门类型" name="type">
        <a-select v-model:value="formData.type" placeholder="请选择部门类型">
          <a-select-option value="company">公司</a-select-option>
          <a-select-option value="dept">部门</a-select-option>
          <a-select-option value="team">小组</a-select-option>
        </a-select>
      </a-form-item>

      <a-form-item label="负责人" name="managerId">
        <a-select
          v-model:value="formData.managerId"
          placeholder="请选择负责人"
          show-search
          :filter-option="filterEmployeeOption"
        >
          <a-select-option
            v-for="employee in employeeList"
            :key="employee.id"
            :value="employee.id"
          >
            {{ employee.name }} - {{ employee.position }}
          </a-select-option>
        </a-select>
      </a-form-item>

      <a-form-item label="联系电话" name="phone">
        <a-input v-model:value="formData.phone" placeholder="请输入联系电话" />
      </a-form-item>

      <a-form-item label="部门地址" name="address">
        <a-textarea v-model:value="formData.address" placeholder="请输入部门地址" :rows="2" />
      </a-form-item>

      <a-form-item label="描述" name="description">
        <a-textarea v-model:value="formData.description" placeholder="请输入部门描述" :rows="3" />
      </a-form-item>

      <a-form-item label="状态" name="status">
        <a-radio-group v-model:value="formData.status">
          <a-radio value="active">启用</a-radio>
          <a-radio value="inactive">停用</a-radio>
        </a-radio-group>
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive, computed, watch } from 'vue';
import { message } from 'ant-design-vue';
import { organizationApi } from '/@/api/business/attendance/basic-info/organization-api';
import { employeeApi } from '/@/api/business/attendance/basic-info/employee-api';

const props = defineProps({
  visible: Boolean,
  isEdit: Boolean,
  deptData: Object,
  parentDept: Object,
});

const emit = defineEmits(['update:visible', 'success']);

const formRef = ref();
const loading = ref(false);
const employeeList = ref([]);

const formData = reactive({
  parentId: '',
  name: '',
  code: '',
  type: 'dept',
  managerId: '',
  phone: '',
  address: '',
  description: '',
  status: 'active',
});

const formRules = {
  name: [
    { required: true, message: '请输入部门名称', trigger: 'blur' },
    { max: 50, message: '部门名称不能超过50个字符', trigger: 'blur' }
  ],
  code: [
    { required: true, message: '请输入部门编码', trigger: 'blur' },
    { pattern: /^[A-Z0-9_-]+$/, message: '部门编码只能包含大写字母、数字、下划线和横线', trigger: 'blur' }
  ],
  type: [
    { required: true, message: '请选择部门类型', trigger: 'change' }
  ],
  phone: [
    { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }
  ]
};

// 监听props变化
watch(() => props.visible, (visible) => {
  if (visible) {
    initForm();
  }
});

// 初始化表单
const initForm = () => {
  if (props.isEdit && props.deptData) {
    Object.assign(formData, props.deptData);
  } else {
    resetForm();
    if (props.parentDept) {
      formData.parentId = props.parentDept.id;
    }
  }
  loadEmployeeList();
};

// 重置表单
const resetForm = () => {
  Object.assign(formData, {
    parentId: '',
    name: '',
    code: '',
    type: 'dept',
    managerId: '',
    phone: '',
    address: '',
    description: '',
    status: 'active',
  });
};

// 加载员工列表
const loadEmployeeList = async () => {
  try {
    const response = await employeeApi.getEmployeeList({ pageSize: 1000 });
    employeeList.value = response.data.records;
  } catch (error) {
    console.error('加载员工列表失败:', error);
  }
};

// 过滤员工选项
const filterEmployeeOption = (input, option) => {
  const employee = employeeList.value.find(emp => emp.id === option.value);
  return employee && (
    employee.name.toLowerCase().includes(input.toLowerCase()) ||
    employee.position.toLowerCase().includes(input.toLowerCase())
  );
};

// 提交表单
const handleSubmit = async () => {
  try {
    await formRef.value.validate();
    loading.value = true;

    if (props.isEdit) {
      await organizationApi.updateDept(props.deptData.id, formData);
      message.success('部门更新成功');
    } else {
      await organizationApi.createDept(formData);
      message.success('部门创建成功');
    }

    emit('success');
    handleCancel();
  } catch (error) {
    if (error.errorFields) {
      message.error('请检查表单填写是否正确');
    } else {
      message.error(props.isEdit ? '部门更新失败' : '部门创建失败');
    }
  } finally {
    loading.value = false;
  }
};

// 取消
const handleCancel = () => {
  emit('update:visible', false);
  formRef.value?.resetFields();
};
</script>
```

### 2. 员工管理

#### 员工表格组件
```vue
<!-- src/views/business/attendance/basic-info/employee/components/EmployeeTable.vue -->
<template>
  <div class="employee-table">
    <!-- 搜索工具栏 -->
    <div class="table-toolbar">
      <a-form layout="inline" :model="searchForm" @finish="handleSearch">
        <a-form-item label="姓名">
          <a-input v-model:value="searchForm.name" placeholder="请输入姓名" allow-clear />
        </a-form-item>
        <a-form-item label="工号">
          <a-input v-model:value="searchForm.employeeNo" placeholder="请输入工号" allow-clear />
        </a-form-item>
        <a-form-item label="部门">
          <a-tree-select
            v-model:value="searchForm.deptId"
            :tree-data="deptTreeData"
            placeholder="请选择部门"
            allow-clear
            tree-default-expand-all
          />
        </a-form-item>
        <a-form-item label="状态">
          <a-select v-model:value="searchForm.status" placeholder="请选择状态" allow-clear>
            <a-select-option value="active">在职</a-select-option>
            <a-select-option value="inactive">离职</a-select-option>
            <a-select-option value="pending">待入职</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item>
          <a-button type="primary" html-type="submit" :loading="loading">
            <template #icon><SearchOutlined /></template>
            搜索
          </a-button>
          <a-button @click="handleReset">
            <template #icon><ReloadOutlined /></template>
            重置
          </a-button>
        </a-form-item>
      </a-form>
    </div>

    <!-- 操作工具栏 -->
    <div class="table-actions">
      <div class="actions-left">
        <a-button type="primary" @click="handleAdd">
          <template #icon><PlusOutlined /></template>
          新增员工
        </a-button>
        <a-button @click="handleImport">
          <template #icon><UploadOutlined /></template>
          批量导入
        </a-button>
        <a-button @click="handleDownloadTemplate">
          <template #icon><DownloadOutlined /></template>
          下载模板
        </a-button>
      </div>
      <div class="actions-right">
        <a-button @click="handleRefresh" :loading="loading">
          <template #icon><ReloadOutlined /></template>
          刷新
        </a-button>
      </div>
    </div>

    <!-- 数据表格 -->
    <a-table
      :columns="columns"
      :data-source="dataSource"
      :loading="loading"
      :pagination="pagination"
      :row-selection="rowSelection"
      row-key="id"
      @change="handleTableChange"
    >
      <template #bodyCell="{ column, record }">
        <template v-if="column.key === 'avatar'">
          <a-avatar :src="record.avatar" :alt="record.name">
            {{ record.name?.charAt(0) }}
          </a-avatar>
        </template>

        <template v-else-if="column.key === 'deptName'">
          <a-tag color="blue">{{ record.deptName }}</a-tag>
        </template>

        <template v-else-if="column.key === 'status'">
          <a-badge :status="getStatusBadge(record.status)" :text="getStatusText(record.status)" />
        </template>

        <template v-else-if="column.key === 'action'">
          <a-space>
            <a-button type="link" size="small" @click="handleView(record)">查看</a-button>
            <a-button type="link" size="small" @click="handleEdit(record)">编辑</a-button>
            <a-button type="link" size="small" @click="handlePermission(record)">权限</a-button>
            <a-popconfirm
              title="确定要删除该员工吗？"
              @confirm="handleDelete(record)"
            >
              <a-button type="link" size="small" danger>删除</a-button>
            </a-popconfirm>
          </a-space>
        </template>
      </template>
    </a-table>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import {
  SearchOutlined,
  ReloadOutlined,
  PlusOutlined,
  UploadOutlined,
  DownloadOutlined
} from '@ant-design/icons-vue';
import { employeeApi } from '/@/api/business/attendance/basic-info/employee-api';
import { organizationApi } from '/@/api/business/attendance/basic-info/organization-api';

const emit = defineEmits(['add', 'edit', 'view', 'permission', 'import']);

const loading = ref(false);
const dataSource = ref([]);
const deptTreeData = ref([]);
const selectedRowKeys = ref([]);

const searchForm = reactive({
  name: '',
  employeeNo: '',
  deptId: '',
  status: '',
});

const pagination = reactive({
  current: 1,
  pageSize: 20,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `共 ${total} 条记录`,
});

const columns = [
  {
    title: '头像',
    key: 'avatar',
    width: 60,
    align: 'center',
  },
  {
    title: '姓名',
    dataIndex: 'name',
    key: 'name',
    width: 100,
  },
  {
    title: '工号',
    dataIndex: 'employeeNo',
    key: 'employeeNo',
    width: 100,
  },
  {
    title: '部门',
    dataIndex: 'deptName',
    key: 'deptName',
    width: 120,
  },
  {
    title: '岗位',
    dataIndex: 'position',
    key: 'position',
    width: 120,
  },
  {
    title: '手机号',
    dataIndex: 'phone',
    key: 'phone',
    width: 120,
  },
  {
    title: '邮箱',
    dataIndex: 'email',
    key: 'email',
    width: 180,
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    width: 80,
  },
  {
    title: '入职时间',
    dataIndex: 'hireDate',
    key: 'hireDate',
    width: 120,
  },
  {
    title: '操作',
    key: 'action',
    width: 200,
    fixed: 'right',
  },
];

const rowSelection = {
  selectedRowKeys: selectedRowKeys,
  onChange: (keys) => {
    selectedRowKeys.value = keys;
  },
};

// 获取状态徽标
const getStatusBadge = (status) => {
  const statusMap = {
    active: 'success',
    inactive: 'error',
    pending: 'warning',
  };
  return statusMap[status] || 'default';
};

// 获取状态文本
const getStatusText = (status) => {
  const statusMap = {
    active: '在职',
    inactive: '离职',
    pending: '待入职',
  };
  return statusMap[status] || '未知';
};

// 加载员工数据
const loadEmployeeData = async () => {
  loading.value = true;
  try {
    const params = {
      ...searchForm,
      page: pagination.current,
      pageSize: pagination.pageSize,
    };
    const response = await employeeApi.getEmployeeList(params);
    dataSource.value = response.data.records;
    pagination.total = response.data.total;
  } catch (error) {
    console.error('加载员工数据失败:', error);
    message.error('加载员工数据失败');
  } finally {
    loading.value = false;
  }
};

// 加载部门树数据
const loadDeptTreeData = async () => {
  try {
    const response = await organizationApi.getDeptTree();
    deptTreeData.value = formatDeptTree(response.data);
  } catch (error) {
    console.error('加载部门树失败:', error);
  }
};

// 格式化部门树
const formatDeptTree = (data) => {
  return data.map(item => ({
    title: item.name,
    value: item.id,
    key: item.id,
    children: item.children ? formatDeptTree(item.children) : [],
  }));
};

// 搜索
const handleSearch = () => {
  pagination.current = 1;
  loadEmployeeData();
};

// 重置
const handleReset = () => {
  Object.assign(searchForm, {
    name: '',
    employeeNo: '',
    deptId: '',
    status: '',
  });
  pagination.current = 1;
  loadEmployeeData();
};

// 表格变化
const handleTableChange = (pag) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadEmployeeData();
};

// 新增员工
const handleAdd = () => {
  emit('add');
};

// 编辑员工
const handleEdit = (record) => {
  emit('edit', record);
};

// 查看员工
const handleView = (record) => {
  emit('view', record);
};

// 权限管理
const handlePermission = (record) => {
  emit('permission', record);
};

// 删除员工
const handleDelete = async (record) => {
  try {
    await employeeApi.deleteEmployee(record.id);
    message.success('删除成功');
    loadEmployeeData();
  } catch (error) {
    message.error('删除失败');
  }
};

// 批量导入
const handleImport = () => {
  emit('import');
};

// 下载模板
const handleDownloadTemplate = async () => {
  try {
    const response = await employeeApi.downloadTemplate();
    // 处理文件下载
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', '员工导入模板.xlsx');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
  } catch (error) {
    message.error('下载模板失败');
  }
};

// 刷新
const handleRefresh = () => {
  loadEmployeeData();
};

onMounted(() => {
  loadEmployeeData();
  loadDeptTreeData();
});
</script>

<style scoped lang="less">
.employee-table {
  background: #fff;
  border-radius: 8px;
  padding: 16px;

  .table-toolbar {
    margin-bottom: 16px;
    padding: 16px;
    background: #fafafa;
    border-radius: 4px;
  }

  .table-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;

    .actions-left,
    .actions-right {
      display: flex;
      gap: 8px;
    }
  }
}
</style>
```

### 3. 批量导入功能

```vue
<!-- src/views/business/attendance/basic-info/employee/components/ImportModal.vue -->
<template>
  <a-modal
    :open="visible"
    title="批量导入员工"
    @ok="handleSubmit"
    @cancel="handleCancel"
    :confirm-loading="loading"
    width="800px"
  >
    <div class="import-content">
      <!-- 导入说明 -->
      <a-alert
        message="导入说明"
        description="请先下载模板，按照模板格式填写员工信息后上传。支持xlsx、xls格式文件，单次最多导入1000条记录。"
        type="info"
        show-icon
        style="margin-bottom: 16px;"
      />

      <!-- 下载模板 -->
      <div class="template-section">
        <a-button type="link" @click="handleDownloadTemplate">
          <template #icon><DownloadOutlined /></template>
          下载导入模板
        </a-button>
      </div>

      <!-- 文件上传 -->
      <a-upload-dragger
        v-model:file-list="fileList"
        :before-upload="beforeUpload"
        :remove="handleRemove"
        :accept="'.xlsx,.xls'"
        :multiple="false"
      >
        <p class="ant-upload-drag-icon">
          <InboxOutlined />
        </p>
        <p class="ant-upload-text">点击或拖拽文件到此区域上传</p>
        <p class="ant-upload-hint">支持单个文件上传，文件格式为xlsx或xls</p>
      </a-upload-dragger>

      <!-- 预览数据 -->
      <div v-if="previewData.length > 0" class="preview-section">
        <h4>数据预览</h4>
        <a-table
          :columns="previewColumns"
          :data-source="previewData"
          :pagination="false"
          :scroll="{ x: 800 }"
          size="small"
        >
          <template #bodyCell="{ column, record }">
            <template v-if="column.key === 'status'">
              <a-tag :color="record.valid ? 'success' : 'error'">
                {{ record.valid ? '正常' : '异常' }}
              </a-tag>
            </template>
            <template v-else-if="column.key === 'errorMessage'">
              <span style="color: #ff4d4f;">{{ record.errorMessage }}</span>
            </template>
          </template>
        </a-table>
      </div>
    </div>
  </a-modal>
</template>

<script setup>
import { ref } from 'vue';
import { message } from 'ant-design-vue';
import { InboxOutlined, DownloadOutlined } from '@ant-design/icons-vue';
import { employeeApi } from '/@/api/business/attendance/basic-info/employee-api';
import * as XLSX from 'xlsx';

const props = defineProps({
  visible: Boolean,
});

const emit = defineEmits(['update:visible', 'success']);

const loading = ref(false);
const fileList = ref([]);
const previewData = ref([]);

const previewColumns = [
  { title: '姓名', dataIndex: 'name', key: 'name', width: 100 },
  { title: '工号', dataIndex: 'employeeNo', key: 'employeeNo', width: 100 },
  { title: '部门', dataIndex: 'deptName', key: 'deptName', width: 120 },
  { title: '岗位', dataIndex: 'position', key: 'position', width: 120 },
  { title: '手机号', dataIndex: 'phone', key: 'phone', width: 120 },
  { title: '状态', key: 'status', width: 80 },
  { title: '错误信息', key: 'errorMessage', width: 200 },
];

// 下载模板
const handleDownloadTemplate = async () => {
  try {
    const response = await employeeApi.downloadTemplate();
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', '员工导入模板.xlsx');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
  } catch (error) {
    message.error('下载模板失败');
  }
};

// 上传前处理
const beforeUpload = (file) => {
  const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                  file.type === 'application/vnd.ms-excel';
  if (!isExcel) {
    message.error('只能上传Excel文件！');
    return false;
  }

  const isLt10M = file.size / 1024 / 1024 < 10;
  if (!isLt10M) {
    message.error('文件大小不能超过10MB！');
    return false;
  }

  readFile(file);
  return false; // 阻止自动上传
};

// 读取文件
const readFile = (file) => {
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = e.target.result;
      const workbook = XLSX.read(data, { type: 'binary' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

      // 解析数据并验证
      parseAndValidateData(jsonData);
    } catch (error) {
      message.error('文件解析失败，请检查文件格式');
    }
  };
  reader.readAsBinaryString(file);
};

// 解析并验证数据
const parseAndValidateData = (data) => {
  if (data.length < 2) {
    message.error('文件中没有有效数据');
    return;
  }

  const headers = data[0];
  const rows = data.slice(1);

  const parsedData = rows.map((row, index) => {
    const record = {
      row: index + 2,
      valid: true,
      errorMessage: '',
    };

    // 映射列数据
    headers.forEach((header, colIndex) => {
      const key = mapHeaderToField(header);
      if (key) {
        record[key] = row[colIndex] || '';
      }
    });

    // 验证必填字段
    if (!record.name) {
      record.valid = false;
      record.errorMessage += '姓名不能为空；';
    }

    if (!record.employeeNo) {
      record.valid = false;
      record.errorMessage += '工号不能为空；';
    }

    if (!record.phone) {
      record.valid = false;
      record.errorMessage += '手机号不能为空；';
    } else if (!/^1[3-9]\d{9}$/.test(record.phone)) {
      record.valid = false;
      record.errorMessage += '手机号格式错误；';
    }

    return record;
  });

  previewData.value = parsedData;
};

// 映射表头到字段
const mapHeaderToField = (header) => {
  const mapping = {
    '姓名': 'name',
    '工号': 'employeeNo',
    '部门': 'deptName',
    '岗位': 'position',
    '手机号': 'phone',
    '邮箱': 'email',
    '入职时间': 'hireDate',
  };
  return mapping[header];
};

// 移除文件
const handleRemove = () => {
  fileList.value = [];
  previewData.value = [];
};

// 提交导入
const handleSubmit = async () => {
  if (fileList.value.length === 0) {
    message.error('请选择要导入的文件');
    return;
  }

  const invalidCount = previewData.value.filter(item => !item.valid).length;
  if (invalidCount > 0) {
    message.error(`有${invalidCount}条数据验证失败，请检查数据格式`);
    return;
  }

  loading.value = true;
  try {
    const formData = new FormData();
    formData.append('file', fileList.value[0].originFileObj);

    const response = await employeeApi.importEmployees(formData);
    message.success(`成功导入${response.data.successCount}条数据`);
    emit('success');
    handleCancel();
  } catch (error) {
    message.error('导入失败');
  } finally {
    loading.value = false;
  }
};

// 取消
const handleCancel = () => {
  emit('update:visible', false);
  fileList.value = [];
  previewData.value = [];
};
</script>

<style scoped lang="less">
.import-content {
  .template-section {
    margin-bottom: 16px;
    text-align: center;
  }

  .preview-section {
    margin-top: 16px;

    h4 {
      margin-bottom: 8px;
      font-weight: 600;
    }
  }
}
</style>
```

## Mock数据示例

```javascript
// src/mock/basic-info-mock.js
export const mockDeptTree = [
  {
    id: '1',
    name: '科技有限公司',
    code: 'COMPANY',
    type: 'company',
    level: 0,
    employeeCount: 1500,
    children: [
      {
        id: '2',
        name: '技术部',
        code: 'TECH',
        type: 'dept',
        level: 1,
        employeeCount: 500,
        managerId: 'emp001',
        managerName: '张三',
        phone: '13800138000',
        children: [
          {
            id: '5',
            name: '前端组',
            code: 'FRONTEND',
            type: 'team',
            level: 2,
            employeeCount: 50,
          },
          {
            id: '6',
            name: '后端组',
            code: 'BACKEND',
            type: 'team',
            level: 2,
            employeeCount: 80,
          }
        ]
      },
      {
        id: '3',
        name: '人事部',
        code: 'HR',
        type: 'dept',
        level: 1,
        employeeCount: 50,
        managerId: 'emp002',
        managerName: '李四',
        phone: '13800138001',
      },
      {
        id: '4',
        name: '财务部',
        code: 'FINANCE',
        type: 'dept',
        level: 1,
        employeeCount: 30,
        managerId: 'emp003',
        managerName: '王五',
        phone: '13800138002',
      }
    ]
  }
];

export const mockEmployeeList = {
  records: [
    {
      id: 'emp001',
      name: '张三',
      employeeNo: 'EMP001',
      deptId: '2',
      deptName: '技术部',
      position: '技术总监',
      phone: '13800138000',
      email: 'zhangsan@company.com',
      status: 'active',
      hireDate: '2020-01-15',
      avatar: 'https://picsum.photos/seed/emp001/100/100'
    },
    {
      id: 'emp002',
      name: '李四',
      employeeNo: 'EMP002',
      deptId: '3',
      deptName: '人事部',
      position: '人事经理',
      phone: '13800138001',
      email: 'lisi@company.com',
      status: 'active',
      hireDate: '2019-03-20',
      avatar: 'https://picsum.photos/seed/emp002/100/100'
    }
  ],
  total: 1500,
  current: 1,
  pageSize: 20
};

export const mockPositionList = [
  { id: 'pos001', name: '技术总监', level: 1, description: '负责技术团队管理' },
  { id: 'pos002', name: '高级工程师', level: 2, description: '负责核心开发工作' },
  { id: 'pos003', name: '工程师', level: 3, description: '负责具体开发任务' }
];

export const mockLevelList = [
  { id: 'lvl001', name: 'P1', level: 1, description: '初级职级' },
  { id: 'lvl002', name: 'P2', level: 2, description: '中级职级' },
  { id: 'lvl003', name: 'P3', level: 3, description: '高级职级' }
];

export default {
  mockDeptTree,
  mockEmployeeList,
  mockPositionList,
  mockLevelList
};
```

## 路由配置

```javascript
// src/router/business/attendance.js
export const attendanceRouters = [
  {
    path: '/business/attendance/basic-info',
    name: 'BasicInfo',
    redirect: '/business/attendance/basic-info/organization',
    component: () => import('/@/views/business/attendance/basic-info/index.vue'),
    meta: {
      title: '考勤管理 - 基础信息',
      menuType: MENU_TYPE_ENUM.MENU.value,
      icon: 'UserOutlined',
      hideInMenu: false,
      requireAuth: true
    },
    children: [
      {
        path: '/business/attendance/basic-info/organization',
        name: 'Organization',
        component: () => import('/@/views/business/attendance/basic-info/organization/index.vue'),
        meta: {
          title: '组织架构',
          menuType: MENU_TYPE_ENUM.MENU.value,
          hideInMenu: false,
          requireAuth: true
        }
      },
      {
        path: '/business/attendance/basic-info/employee',
        name: 'Employee',
        component: () => import('/@/views/business/attendance/basic-info/employee/index.vue'),
        meta: {
          title: '员工管理',
          menuType: MENU_TYPE_ENUM.MENU.value,
          hideInMenu: false,
          requireAuth: true
        }
      },
      {
        path: '/business/attendance/basic-info/user',
        name: 'User',
        component: () => import('/@/views/business/attendance/basic-info/user/index.vue'),
        meta: {
          title: '用户管理',
          menuType: MENU_TYPE_ENUM.MENU.value,
          hideInMenu: false,
          requireAuth: true,
          roles: ['admin'] // 仅系统管理员可见
        }
      }
    ]
  }
];
```

## 开发注意事项总结

### 核心功能要点
1. **组织架构树管理** - 支持无限级组织结构
2. **员工全生命周期管理** - 从入职到离职的完整管理
3. **批量导入导出** - Excel模板化数据操作
4. **权限精细化控制** - 基于角色的权限分配
5. **数据关联性维护** - 组织与员工的关系管理
6. **状态流程管理** - 员工状态变更流程

### 性能优化建议
1. 组织树采用虚拟滚动处理大量数据
2. 员工列表分页加载，避免一次性加载过多数据
3. 批量操作采用异步处理，提供进度反馈
4. 合理使用缓存减少数据库查询

### 用户体验优化
1. 提供丰富的搜索和筛选功能
2. 支持拖拽操作调整组织结构
3. 批量导入提供数据预览和验证
4. 操作反馈及时准确

## 总结

基础信息模块作为考勤系统的数据基础，需要重点关注：

- 数据结构的合理性和扩展性
- 组织关系的清晰表达
- 员工信息的完整性管理
- 权限控制的精确性
- 批量操作的便捷性

通过遵循本文档的技术规范，可以构建出功能完善、性能优良的基础信息管理模块。