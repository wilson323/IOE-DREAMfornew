# IOE-DREAM å¾®æœåŠ¡æ¶æ„å¼€å‘äº¤æ¥æŒ‡å—

## ğŸ“‹ äº¤æ¥åŸºæœ¬ä¿¡æ¯

**æŒ‡å—ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´11æœˆ29æ—¥
**äº¤æ¥çŠ¶æ€**: å¾…éªŒæ”¶
**é€‚ç”¨å¯¹è±¡**: å¼€å‘å›¢é˜Ÿã€æ–°åŠ å…¥æŠ€æœ¯äººå‘˜

---

## ğŸ¯ äº¤æ¥ç›®æ ‡

### 1. å¼€å‘èƒ½åŠ›ä¼ æ‰¿
- æŒæ¡å¾®æœåŠ¡æ¶æ„çš„å¼€å‘ç†å¿µå’Œæ–¹æ³•
- ç†è§£ç³»ç»Ÿæ•´ä½“æ¶æ„å’ŒæœåŠ¡è®¾è®¡åŸåˆ™
- èƒ½å¤Ÿè¿›è¡Œå¾®æœåŠ¡çš„äºŒæ¬¡å¼€å‘å’ŒåŠŸèƒ½æ‰©å±•
- å…·å¤‡ä»£ç è´¨é‡å’Œæ€§èƒ½ä¼˜åŒ–èƒ½åŠ›

### 2. å¼€å‘è§„èŒƒæŒæ¡
- ç†Ÿæ‚‰é¡¹ç›®ç¼–ç è§„èŒƒå’Œæœ€ä½³å®è·µ
- æŒæ¡APIè®¾è®¡å’Œæ¥å£å¼€å‘æ ‡å‡†
- äº†è§£æ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–åŸåˆ™
- ç†Ÿæ‚‰æµ‹è¯•é©±åŠ¨å¼€å‘æ–¹æ³•

### 3. å¼€å‘å·¥å…·æŒæ¡
- ç†Ÿç»ƒä½¿ç”¨é¡¹ç›®å¼€å‘ç¯å¢ƒé…ç½®
- æŒæ¡ä»£ç æ„å»ºå’Œéƒ¨ç½²æµç¨‹
- äº†è§£è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥æŠ€å·§
- ç†Ÿæ‚‰ç‰ˆæœ¬æ§åˆ¶å’Œå·¥ä½œæµç¨‹

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ­å»º

### 1. åŸºç¡€ç¯å¢ƒè¦æ±‚

#### 1.1 ç¡¬ä»¶è¦æ±‚

| é…ç½®é¡¹ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® | è¯´æ˜ |
|--------|----------|----------|------|
| CPU | 4æ ¸ | 8æ ¸ä»¥ä¸Š | æ”¯æŒå¤šä»»åŠ¡ç¼–è¯‘å’Œæµ‹è¯• |
| å†…å­˜ | 8GB | 16GBä»¥ä¸Š | æ”¯æŒå¤šä¸ªæœåŠ¡åŒæ—¶è¿è¡Œ |
| ç¡¬ç›˜ | 100GB | 256GB SSD | SSDæå‡ç¼–è¯‘å’Œå¯åŠ¨é€Ÿåº¦ |
| ç½‘ç»œ | å®½å¸¦ | åƒå…†ç½‘ç»œ | ç¨³å®šçš„ç½‘ç»œè¿æ¥ |

#### 1.2 è½¯ä»¶è¦æ±‚

| è½¯ä»¶ç±»å‹ | ç‰ˆæœ¬è¦æ±‚ | ä¸‹è½½åœ°å€ | è¯´æ˜ |
|---------|----------|----------|------|
| æ“ä½œç³»ç»Ÿ | Windows 10+/Linux/macOS | å®˜æ–¹ç½‘ç«™ | æ¨èLinuxæˆ–macOS |
| JDK | OpenJDK 17+ | https://adoptium.net/ | å¿…é¡»ä½¿ç”¨JDK 17 |
| Maven | 3.8.0+ | https://maven.apache.org/ | é¡¹ç›®æ„å»ºå·¥å…· |
| Git | 2.30.0+ | https://git-scm.com/ | ç‰ˆæœ¬æ§åˆ¶å·¥å…· |
| Docker | 20.10+ | https://docker.com/ | å®¹å™¨åŒ–å¼€å‘ç¯å¢ƒ |
| IDE | IntelliJ IDEA 2023+ | https://jetbrains.com/ | æ¨èIDEA |
| Node.js | 18.0+ | https://nodejs.org/ | å‰ç«¯å¼€å‘ç¯å¢ƒ |
| Redis | 6.0+ | https://redis.io/ | ç¼“å­˜æœåŠ¡ |
| MySQL | 8.0+ | https://mysql.com/ | æ•°æ®åº“æœåŠ¡ |

### 2. å¼€å‘å·¥å…·å®‰è£…

#### 2.1 JDK 17 å®‰è£…

**Windowså®‰è£…**:
```powershell
# ä½¿ç”¨wingetå®‰è£…
winget install EclipseAdoptium.Temurin.17.JDK

# éªŒè¯å®‰è£…
java -version
javac -version
```

**Linuxå®‰è£…**:
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-17-jdk

# CentOS/RHEL
sudo yum install java-17-openjdk-devel

# éªŒè¯å®‰è£…
java -version
javac -version
```

**macOSå®‰è£…**:
```bash
# ä½¿ç”¨Homebrewå®‰è£…
brew install openjdk@17

# è®¾ç½®ç¯å¢ƒå˜é‡
echo 'export PATH="/usr/local/opt/openjdk@17/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc

# éªŒè¯å®‰è£…
java -version
```

#### 2.2 Mavené…ç½®

**settings.xmlé…ç½®**:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
          http://maven.apache.org/xsd/settings-1.0.0.xsd">

  <localRepository>${user.home}/.m2/repository</localRepository>

  <mirrors>
    <mirror>
      <id>aliyun-maven</id>
      <mirrorOf>central</mirrorOf>
      <name>Aliyun Maven</name>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>

  <profiles>
    <profile>
      <id>jdk-17</id>
      <activation>
        <activeByDefault>true</activeByDefault>
        <jdk>17</jdk>
      </activation>
      <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <maven.compiler.compilerVersion>17</maven.compiler.compilerVersion>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
      </properties>
    </profile>
  </profiles>
</settings>
```

#### 2.3 IntelliJ IDEAé…ç½®

**æ¨èæ’ä»¶å®‰è£…**:
```
å¿…è£…æ’ä»¶:
- Lombok Plugin (ä»£ç ç”Ÿæˆ)
- MyBatis Log Plugin (SQLæ—¥å¿—)
- Maven Helper (Mavenä¾èµ–)
- GitToolBox (Gitå¢å¼º)
- Rainbow Brackets (å½©è™¹æ‹¬å·)
- String Manipulation (å­—ç¬¦ä¸²å¤„ç†)
- Translation (ç¿»è¯‘æ’ä»¶)

å¯é€‰æ’ä»¶:
- SonarLint (ä»£ç è´¨é‡)
- Alibaba Java Coding Guidelines (ç¼–ç è§„èŒƒ)
- Docker (å®¹å™¨æ”¯æŒ)
- Kubernetes (K8sæ”¯æŒ)
- Database Navigator (æ•°æ®åº“å·¥å…·)
```

**ä»£ç æ¨¡æ¿é…ç½®**:
```java
/**
 * @author ${USER}
 * @date ${DATE} ${TIME}
 * @description ${DESCRIPTION}
 */
public class ${NAME} {
    // ç±»å†…å®¹
}
```

### 3. é¡¹ç›®ç¯å¢ƒé…ç½®

#### 3.1 å…‹éš†é¡¹ç›®ä»£ç 

```bash
# å…‹éš†ä¸»ä»“åº“
git clone https://github.com/ioedream/smart-admin.git

# å…‹éš†å¾®æœåŠ¡ä»“åº“
git clone https://github.com/ioedream/microservices.git

# å…‹éš†å‰ç«¯ä»“åº“
git clone https://github.com/ioedream/smart-admin-web-javascript.git
```

#### 3.2 æœ¬åœ°æœåŠ¡å¯åŠ¨

**å¯åŠ¨è„šæœ¬ start-dev.sh**:
```bash
#!/bin/bash

echo "å¯åŠ¨IOE-DREAMå¼€å‘ç¯å¢ƒ..."

# 1. å¯åŠ¨åŸºç¡€æœåŠ¡
echo "å¯åŠ¨åŸºç¡€æœåŠ¡..."

# å¯åŠ¨Redis
docker run -d --name ioedream-redis -p 6379:6379 redis:7.0-alpine

# å¯åŠ¨MySQL
docker run -d --name ioedream-mysql \
  -e MYSQL_ROOT_PASSWORD=ioedream@2025 \
  -e MYSQL_DATABASE=ioedream \
  -p 3306:3306 \
  -v $(pwd)/database/init:/docker-entrypoint-initdb.d \
  mysql:8.0

# å¯åŠ¨Consul
docker run -d --name ioedream-consul -p 8500:8500 consul:1.17

# 2. å¯åŠ¨å¾®æœåŠ¡
echo "å¯åŠ¨å¾®æœåŠ¡..."

# å¯åŠ¨ç½‘å…³
cd microservices/smart-gateway
mvn spring-boot:run &

# å¯åŠ¨è®¤è¯æœåŠ¡
cd ../ioedream-auth-service
mvn spring-boot:run &

# å¯åŠ¨èº«ä»½æœåŠ¡
cd ../ioedream-identity-service
mvn spring-boot:run &

# å¯åŠ¨è®¾å¤‡æœåŠ¡
cd ../ioedream-device-service
mvn spring-boot:run &

# å¯åŠ¨é—¨ç¦æœåŠ¡
cd ../ioedream-access-service
mvn spring-boot:run &

echo "å¼€å‘ç¯å¢ƒå¯åŠ¨å®Œæˆ!"
echo "è®¿é—®åœ°å€:"
echo "  å‰ç«¯: http://localhost:3100"
echo "  ç½‘å…³: http://localhost:8080"
echo "  Consul: http://localhost:8500"
echo "  æ•°æ®åº“: localhost:3306"
echo "  Redis: localhost:6379"
```

#### 3.3 ç¯å¢ƒå˜é‡é…ç½®

**application-dev.yml**:
```yaml
spring:
  profiles:
    active: dev

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/ioedream?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: ioedream@2025
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  redis:
    host: localhost
    port: 6379
    password:
    database: 0
    timeout: 5000
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5
        max-wait: 2000

  cloud:
    consul:
      host: localhost
      port: 8500
      discovery:
        service-name: ${spring.application.name}
        prefer-ip-address: true
        health-check-path: /actuator/health
        health-check-interval: 15s
      config:
        format: yaml
        data-key: data

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    call-setters-on-nulls: true
    jdbc-type-for-null: 'null'
  global-config:
    db-config:
      id-type: ASSIGN_ID
      logic-delete-field: deleted_flag
      logic-delete-value: 1
      logic-not-delete-value: 0

logging:
  level:
    net.lab1024.sa: DEBUG
    org.springframework.cloud: DEBUG
    com.netflix: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
```

---

## ğŸ“š é¡¹ç›®ç»“æ„è§£æ

### 1. æ•´ä½“é¡¹ç›®ç»“æ„

```
IOE-DREAM/
â”œâ”€â”€ smart-admin-api-java17-springboot3/    # å•ä½“åç«¯é¡¹ç›®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
â”œâ”€â”€ smart-admin-web-javascript/            # å‰ç«¯é¡¹ç›®
â”œâ”€â”€ microservices/                         # å¾®æœåŠ¡é¡¹ç›®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
â”‚   â”œâ”€â”€ smart-gateway/                     # APIç½‘å…³
â”‚   â”œâ”€â”€ microservices-common/              # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ ioedream-auth-service/             # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ ioedream-identity-service/         # èº«ä»½æœåŠ¡
â”‚   â”œâ”€â”€ ioedream-device-service/           # è®¾å¤‡æœåŠ¡
â”‚   â”œâ”€â”€ ioedream-access-service/           # é—¨ç¦æœåŠ¡
â”‚   â”œâ”€â”€ ioedream-consume-service/          # æ¶ˆè´¹æœåŠ¡
â”‚   â”œâ”€â”€ ioedream-visitor-service/          # è®¿å®¢æœåŠ¡
â”‚   â”œâ”€â”€ ioedream-attendance-service/       # è€ƒå‹¤æœåŠ¡
â”‚   â””â”€â”€ ioedream-video-service/            # è§†é¢‘æœåŠ¡
â”œâ”€â”€ database/                              # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ docs/                                  # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/                               # è„šæœ¬å·¥å…·
â””â”€â”€ technical-handover/                    # æŠ€æœ¯äº¤æ¥æ–‡æ¡£
```

### 2. å¾®æœåŠ¡æ ‡å‡†ç»“æ„

æ¯ä¸ªå¾®æœåŠ¡éƒ½éµå¾ªä»¥ä¸‹æ ‡å‡†ç»“æ„ï¼š

```
ioedream-{service-name}/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/net/lab1024/sa/{service}/
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/                # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/                   # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ impl/                 # æœåŠ¡å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ manager/                  # ä¸šåŠ¡ç®¡ç†å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ dao/                      # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â””â”€â”€ domain/                   # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚       â”œâ”€â”€ entity/               # å®ä½“ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ vo/                   # è§†å›¾å¯¹è±¡
â”‚   â”‚   â”‚       â”œâ”€â”€ dto/                  # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚       â””â”€â”€ query/                # æŸ¥è¯¢å¯¹è±¡
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml           # åº”ç”¨é…ç½®
â”‚   â”‚       â”œâ”€â”€ bootstrap.yml             # å¯åŠ¨é…ç½®
â”‚   â”‚       â”œâ”€â”€ mapper/                   # MyBatisæ˜ å°„
â”‚   â”‚       â””â”€â”€ sql/                      # SQLè„šæœ¬
â”‚   â””â”€â”€ test/                             # æµ‹è¯•ä»£ç 
â”œâ”€â”€ Dockerfile                            # Dockeré•œåƒæ„å»º
â”œâ”€â”€ pom.xml                              # Mavené…ç½®
â”œâ”€â”€ docker-compose.yml                   # Dockerç¼–æ’
â””â”€â”€ README.md                            # æœåŠ¡è¯´æ˜
```

### 3. å››å±‚æ¶æ„è¯´æ˜

#### 3.1 Controllerå±‚ï¼ˆæ§åˆ¶å™¨å±‚ï¼‰

**èŒè´£**: æ¥æ”¶HTTPè¯·æ±‚ï¼Œå‚æ•°éªŒè¯ï¼Œè¿”å›å“åº”

**ç¤ºä¾‹ä»£ç **:
```java
@RestController
@RequestMapping("/api/access")
@Validated
public class AccessController {

    @Autowired
    private AccessService accessService;

    @PostMapping("/open")
    public Response<Void> openDoor(@Valid @RequestBody OpenDoorRequest request) {
        accessService.openDoor(request.getDoorId(), request.getUserId());
        return Response.success();
    }

    @GetMapping("/records")
    public Response<PageResult<AccessRecordVO>> getAccessRecords(
            @Valid AccessRecordQuery query) {
        PageResult<AccessRecordVO> result = accessService.getAccessRecords(query);
        return Response.success(result);
    }
}
```

#### 3.2 Serviceå±‚ï¼ˆæœåŠ¡å±‚ï¼‰

**èŒè´£**: ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œäº‹åŠ¡ç®¡ç†ï¼Œæµç¨‹ç¼–æ’

**ç¤ºä¾‹ä»£ç **:
```java
@Service
@Transactional(rollbackFor = Exception.class)
public class AccessServiceImpl implements AccessService {

    @Autowired
    private AccessManager accessManager;

    @Autowired
    private AccessRecordDao accessRecordDao;

    @Autowired
    private NotificationService notificationService;

    @Override
    public void openDoor(Long doorId, Long userId) {
        // 1. éªŒè¯ç”¨æˆ·æƒé™
        accessManager.checkUserPermission(doorId, userId);

        // 2. æ‰§è¡Œå¼€é—¨æ“ä½œ
        boolean success = accessManager.executeOpenDoor(doorId);

        // 3. è®°å½•é—¨ç¦è®°å½•
        AccessRecordEntity record = new AccessRecordEntity();
        record.setDoorId(doorId);
        record.setUserId(userId);
        record.setAccessTime(new Date());
        record.setAccessType(AccessTypeEnum.OPEN);
        record.setResult(success ? AccessResultEnum.SUCCESS : AccessResultEnum.FAILED);
        accessRecordDao.insert(record);

        // 4. å‘é€é€šçŸ¥
        if (success) {
            notificationService.sendAccessNotification(doorId, userId);
        }
    }
}
```

#### 3.3 Managerå±‚ï¼ˆç®¡ç†å±‚ï¼‰

**èŒè´£**: å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œå¤–éƒ¨æœåŠ¡è°ƒç”¨ï¼Œæ•°æ®èšåˆ

**ç¤ºä¾‹ä»£ç **:
```java
@Component
public class AccessManager {

    @Autowired
    private DeviceServiceClient deviceService;

    @Autowired
    private AuthServiceClient authService;

    @Autowired
    private BiometricEngine biometricEngine;

    public boolean checkUserPermission(Long doorId, Long userId) {
        // 1. è·å–ç”¨æˆ·ä¿¡æ¯
        Response<UserInfoVO> userResponse = authService.getUserInfo(userId);
        if (!userResponse.isSuccess()) {
            throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        }

        // 2. è·å–é—¨ç¦ä¿¡æ¯
        Response<DoorInfoVO> doorResponse = deviceService.getDoorInfo(doorId);
        if (!doorResponse.isSuccess()) {
            throw new BusinessException("é—¨ç¦ä¸å­˜åœ¨");
        }

        // 3. æ£€æŸ¥æƒé™
        DoorInfoVO doorInfo = doorResponse.getData();
        UserInfoVO userInfo = userResponse.getData();

        // 4. ç”Ÿç‰©ç‰¹å¾éªŒè¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (doorInfo.getRequireBiometric()) {
            return biometricEngine.verifyBiometric(userId, doorId);
        }

        return true;
    }

    public boolean executeOpenDoor(Long doorId) {
        // è°ƒç”¨è®¾å¤‡æœåŠ¡æ‰§è¡Œå¼€é—¨æ“ä½œ
        Response<Void> response = deviceService.openDoor(doorId);
        return response.isSuccess();
    }
}
```

#### 3.4 DAOå±‚ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰

**èŒè´£**: æ•°æ®åº“æ“ä½œï¼ŒSQLæ‰§è¡Œï¼Œç»“æœæ˜ å°„

**ç¤ºä¾‹ä»£ç **:
```java
@Mapper
public interface AccessRecordDao {

    @Insert("INSERT INTO t_access_record (door_id, user_id, access_time, access_type, result, create_time) " +
            "VALUES (#{doorId}, #{userId}, #{accessTime}, #{accessType}, #{result}, #{createTime})")
    int insert(AccessRecordEntity record);

    @Select("SELECT * FROM t_access_record WHERE door_id = #{doorId} AND access_time >= #{startTime} AND access_time <= #{endTime}")
    @Results({
        @Result(property = "doorId", column = "door_id"),
        @Result(property = "userId", column = "user_id"),
        @Result(property = "accessTime", column = "access_time"),
        @Result(property = "accessType", column = "access_type"),
        @Result(property = "createTime", column = "create_time")
    })
    List<AccessRecordEntity> selectByDoorIdAndTime(@Param("doorId") Long doorId,
                                                  @Param("startTime") Date startTime,
                                                  @Param("endTime") Date endTime);

    @Select("SELECT COUNT(*) FROM t_access_record WHERE door_id = #{doorId} AND DATE(access_time) = DATE(#{date})")
    int countByDoorIdAndDate(@Param("doorId") Long doorId, @Param("date") Date date);
}
```

---

## ğŸ”§ å¼€å‘è§„èŒƒ

### 1. ç¼–ç è§„èŒƒ

#### 1.1 å‘½åè§„èŒƒ

**ç±»å‘½å**:
```java
// âœ… æ­£ç¡®çš„å‘½å
public class AccessController {
}

public class AccessServiceImpl {
}

public class AccessRecordEntity {
}

public class AccessRecordVO {
}

public class AccessRecordQuery {
}

// âŒ é”™è¯¯çš„å‘½å
public class accesscontroller {
}

public class AccessService1 {
}

public class Access {
}
```

**æ–¹æ³•å‘½å**:
```java
// âœ… æ­£ç¡®çš„å‘½å
public List<AccessRecordVO> getAccessRecords(AccessRecordQuery query) {
}

public void openDoor(Long doorId, Long userId) {
}

public boolean checkUserPermission(Long doorId, Long userId) {
}

// âŒ é”™è¯¯çš„å‘½å
public List<AccessRecordVO> getData(Query query) {
}

public void doSomething(Long id1, Long id2) {
}
```

**å˜é‡å‘½å**:
```java
// âœ… æ­£ç¡®çš„å‘½å
Long userId = 123L;
String doorName = "ä¸»é—¨ç¦";
List<AccessRecordVO> accessRecords = new ArrayList<>();

// âŒ é”™è¯¯çš„å‘½å
Long uid = 123L;
String name = "ä¸»é—¨ç¦";
List<AccessRecordVO> list = new ArrayList<>();
```

#### 1.2 æ³¨é‡Šè§„èŒƒ

**ç±»æ³¨é‡Š**:
```java
/**
 * é—¨ç¦ç®¡ç†æ§åˆ¶å™¨
 *
 * @author å¼€å‘è€…å§“å
 * @date 2025-11-29
 * @since 1.0.0
 */
@RestController
@RequestMapping("/api/access")
public class AccessController {
}
```

**æ–¹æ³•æ³¨é‡Š**:
```java
/**
 * å¼€å¯é—¨ç¦
 *
 * @param doorId é—¨ç¦ID
 * @param userId ç”¨æˆ·ID
 * @return æ“ä½œç»“æœ
 * @throws BusinessException ä¸šåŠ¡å¼‚å¸¸
 */
@PostMapping("/open")
public Response<Void> openDoor(@RequestParam Long doorId, @RequestParam Long userId) {
}
```

**å¤æ‚é€»è¾‘æ³¨é‡Š**:
```java
public boolean checkUserPermission(Long doorId, Long userId) {
    // 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä¸”çŠ¶æ€æ­£å¸¸
    UserInfoVO user = userService.getUserInfo(userId);
    if (user == null || user.getStatus() != UserStatusEnum.ACTIVE) {
        throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨æˆ–çŠ¶æ€å¼‚å¸¸");
    }

    // 2. æ£€æŸ¥é—¨ç¦æ˜¯å¦å­˜åœ¨ä¸”çŠ¶æ€æ­£å¸¸
    DoorInfoVO door = doorService.getDoorInfo(doorId);
    if (door == null || door.getStatus() != DoorStatusEnum.ACTIVE) {
        throw new BusinessException("é—¨ç¦ä¸å­˜åœ¨æˆ–çŠ¶æ€å¼‚å¸¸");
    }

    // 3. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®è¯¥é—¨ç¦çš„æƒé™
    return permissionService.hasAccessPermission(userId, doorId);
}
```

### 2. APIè®¾è®¡è§„èŒƒ

#### 2.1 RESTful APIè®¾è®¡

**URLå‘½åè§„èŒƒ**:
```java
// âœ… æ­£ç¡®çš„è®¾è®¡
@RestController
@RequestMapping("/api/access")
public class AccessController {

    @GetMapping("/doors")                     // è·å–é—¨ç¦åˆ—è¡¨
    @GetMapping("/doors/{doorId}")           // è·å–é—¨ç¦è¯¦æƒ…
    @PostMapping("/doors")                    // åˆ›å»ºé—¨ç¦
    @PutMapping("/doors/{doorId}")           // æ›´æ–°é—¨ç¦
    @DeleteMapping("/doors/{doorId}")        // åˆ é™¤é—¨ç¦

    @PostMapping("/doors/{doorId}/open")     // å¼€é—¨æ“ä½œ
    @GetMapping("/doors/{doorId}/records")   // è·å–é—¨ç¦è®°å½•
}

// âŒ é”™è¯¯çš„è®¾è®¡
@RestController
public class AccessController {

    @GetMapping("/getDoors")                 // ä¸åº”è¯¥åŒ…å«åŠ¨è¯
    @GetMapping("/doorList")                 // åº”è¯¥ä½¿ç”¨å¤æ•°
    @GetMapping("/door")                     // åº”è¯¥æ˜ç¡®æ˜¯åˆ—è¡¨è¿˜æ˜¯è¯¦æƒ…
    @PostMapping("/door/open")               // èµ„æºåµŒå¥—ä¸è§„èŒƒ
}
```

#### 2.2 ç»Ÿä¸€å“åº”æ ¼å¼

**å“åº”å¯¹è±¡å®šä¹‰**:
```java
@Data
@Builder
public class Response<T> {

    /**
     * å“åº”ç 
     */
    private Integer code;

    /**
     * å“åº”æ¶ˆæ¯
     */
    private String message;

    /**
     * å“åº”æ•°æ®
     */
    private T data;

    /**
     * æ—¶é—´æˆ³
     */
    private Long timestamp;

    /**
     * è¯·æ±‚ID
     */
    private String requestId;

    public static <T> Response<T> success() {
        return Response.<T>builder()
                .code(ResponseCode.SUCCESS.getCode())
                .message(ResponseCode.SUCCESS.getMessage())
                .timestamp(System.currentTimeMillis())
                .build();
    }

    public static <T> Response<T> success(T data) {
        return Response.<T>builder()
                .code(ResponseCode.SUCCESS.getCode())
                .message(ResponseCode.SUCCESS.getMessage())
                .data(data)
                .timestamp(System.currentTimeMillis())
                .build();
    }

    public static <T> Response<T> error(ResponseCode responseCode) {
        return Response.<T>builder()
                .code(responseCode.getCode())
                .message(responseCode.getMessage())
                .timestamp(System.currentTimeMillis())
                .build();
    }
}
```

**åˆ†é¡µå“åº”æ ¼å¼**:
```java
@Data
@Builder
public class PageResult<T> {

    /**
     * æ•°æ®åˆ—è¡¨
     */
    private List<T> records;

    /**
     * æ€»è®°å½•æ•°
     */
    private Long total;

    /**
     * å½“å‰é¡µç 
     */
    private Long current;

    /**
     * æ¯é¡µå¤§å°
     */
    private Long size;

    /**
     * æ€»é¡µæ•°
     */
    private Long pages;
}
```

#### 2.3 å‚æ•°éªŒè¯è§„èŒƒ

**è¯·æ±‚å¯¹è±¡éªŒè¯**:
```java
@Data
public class OpenDoorRequest {

    @NotNull(message = "é—¨ç¦IDä¸èƒ½ä¸ºç©º")
    @Positive(message = "é—¨ç¦IDå¿…é¡»ä¸ºæ­£æ•°")
    private Long doorId;

    @NotNull(message = "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º")
    @Positive(message = "ç”¨æˆ·IDå¿…é¡»ä¸ºæ­£æ•°")
    private Long userId;

    @Length(max = 50, message = "å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦")
    private String remark;

    @Pattern(regexp = "^[a-zA-Z0-9]*$", message = "éªŒè¯ç æ ¼å¼ä¸æ­£ç¡®")
    private String verificationCode;
}
```

**æ§åˆ¶å™¨éªŒè¯**:
```java
@PostMapping("/open")
public Response<Void> openDoor(@Valid @RequestBody OpenDoorRequest request) {
    accessService.openDoor(request.getDoorId(), request.getUserId());
    return Response.success();
}

@GetMapping("/records")
public Response<PageResult<AccessRecordVO>> getAccessRecords(@Valid AccessRecordQuery query) {
    PageResult<AccessRecordVO> result = accessService.getAccessRecords(query);
    return Response.success(result);
}
```

### 3. æ•°æ®åº“è®¾è®¡è§„èŒƒ

#### 3.1 è¡¨è®¾è®¡è§„èŒƒ

**è¡¨å‘½åè§„èŒƒ**:
```sql
-- âœ… æ­£ç¡®çš„å‘½å
CREATE TABLE t_access_record (
    door_id BIGINT NOT NULL COMMENT 'é—¨ç¦ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    access_time DATETIME NOT NULL COMMENT 'è®¿é—®æ—¶é—´',
    access_type TINYINT NOT NULL COMMENT 'è®¿é—®ç±»å‹ï¼š1-å¼€é—¨ï¼Œ2-å…³é—¨',
    result TINYINT NOT NULL COMMENT 'æ“ä½œç»“æœï¼š0-å¤±è´¥ï¼Œ1-æˆåŠŸ',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) COMMENT 'é—¨ç¦è®°å½•è¡¨';

-- âŒ é”™è¯¯çš„å‘½å
CREATE TABLE access_log (
    DoorID BIGINT NOT NULL,                    -- åº”è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿å’Œå°å†™
    UserID BIGINT NOT NULL,                    -- åº”è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿å’Œå°å†™
    AccessTime DATETIME NOT NULL,              -- åº”è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿å’Œå°å†™
    type TINYINT NOT NULL,                     -- å­—æ®µåä¸æ¸…æ™°
    success TINYINT NOT NULL,                  -- åº”è¯¥ä½¿ç”¨æ ‡å‡†å­—æ®µ
    createTime DATETIME DEFAULT NOW()          -- åº”è¯¥ä½¿ç”¨CURRENT_TIMESTAMP
);
```

**å­—æ®µè§„èŒƒ**:
```sql
-- âœ… æ­£ç¡®çš„å­—æ®µè®¾è®¡
CREATE TABLE t_door_info (
    door_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é—¨ç¦ID',
    door_name VARCHAR(100) NOT NULL COMMENT 'é—¨ç¦åç§°',
    door_type TINYINT NOT NULL DEFAULT 1 COMMENT 'é—¨ç¦ç±»å‹ï¼š1-æ™®é€šé—¨ï¼Œ2-é˜²ç›—é—¨ï¼Œ3-ç”µå­é—¨',
    location VARCHAR(200) COMMENT 'ä½ç½®æè¿°',
    ip_address VARCHAR(50) COMMENT 'è®¾å¤‡IPåœ°å€',
    port INT DEFAULT 8080 COMMENT 'è®¾å¤‡ç«¯å£',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
    deleted_flag TINYINT DEFAULT 0 COMMENT 'åˆ é™¤æ ‡å¿—ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
    create_user_id BIGINT COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_user_id BIGINT COMMENT 'æ›´æ–°äººID',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) COMMENT 'é—¨ç¦ä¿¡æ¯è¡¨';
```

#### 3.2 ç´¢å¼•è®¾è®¡è§„èŒƒ

**ç´¢å¼•åˆ›å»ºè§„èŒƒ**:
```sql
-- âœ… æ­£ç¡®çš„ç´¢å¼•è®¾è®¡
-- 1. ä¸»é”®ç´¢å¼•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
ALTER TABLE t_access_record ADD PRIMARY KEY (record_id);

-- 2. å”¯ä¸€ç´¢å¼•
ALTER TABLE t_door_info ADD UNIQUE KEY uk_door_name (door_name);

-- 3. æ™®é€šç´¢å¼•ï¼ˆæŸ¥è¯¢æ¡ä»¶å­—æ®µï¼‰
ALTER TABLE t_access_record ADD INDEX idx_door_id (door_id);
ALTER TABLE t_access_record ADD INDEX idx_user_id (user_id);
ALTER TABLE t_access_record ADD INDEX idx_access_time (access_time);

-- 4. å¤åˆç´¢å¼•ï¼ˆå¤šå­—æ®µæŸ¥è¯¢ï¼‰
ALTER TABLE t_access_record ADD INDEX idx_door_user_time (door_id, user_id, access_time);

-- 5. ç´¢å¼•å‘½åè§„èŒƒ
-- å•åˆ—ç´¢å¼•ï¼šidx_å­—æ®µå
-- å”¯ä¸€ç´¢å¼•ï¼šuk_å­—æ®µå
-- å¤åˆç´¢å¼•ï¼šidx_å­—æ®µ1_å­—æ®µ2_å­—æ®µ3
```

### 4. å¼‚å¸¸å¤„ç†è§„èŒƒ

#### 4.1 è‡ªå®šä¹‰å¼‚å¸¸

**ä¸šåŠ¡å¼‚å¸¸ç±»**:
```java
@Data
@EqualsAndHashCode(callSuper = true)
public class BusinessException extends RuntimeException {

    private Integer code;
    private String message;

    public BusinessException(String message) {
        super(message);
        this.code = ResponseCode.BUSINESS_ERROR.getCode();
        this.message = message;
    }

    public BusinessException(ResponseCode responseCode) {
        super(responseCode.getMessage());
        this.code = responseCode.getCode();
        this.message = responseCode.getMessage();
    }

    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
}
```

**å…¨å±€å¼‚å¸¸å¤„ç†**:
```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public Response<Void> handleBusinessException(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());
        return Response.error(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Response<Void> handleValidationException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult().getFieldErrors().stream()
                .map(FieldError::getDefaultMessage)
                .collect(Collectors.joining(", "));
        log.warn("å‚æ•°éªŒè¯å¼‚å¸¸ï¼š{}", message);
        return Response.error(ResponseCode.PARAM_ERROR.getCode(), message);
    }

    @ExceptionHandler(Exception.class)
    public Response<Void> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return Response.error(ResponseCode.SYSTEM_ERROR);
    }
}
```

---

## ğŸ§ª æµ‹è¯•å¼€å‘è§„èŒƒ

### 1. å•å…ƒæµ‹è¯•

#### 1.1 æµ‹è¯•ç»“æ„

**æµ‹è¯•ç±»å‘½å**:
```java
// âœ… æ­£ç¡®çš„å‘½å
@SpringBootTest
class AccessServiceTest {

}

// âŒ é”™è¯¯çš„å‘½å
@SpringBootTest
class AccessTest {

}
```

**æµ‹è¯•æ–¹æ³•å‘½å**:
```java
@Test
void testOpenDoor_Success() {
}

@Test
void testOpenDoor_UserNotExists_ThrowException() {
}

@Test
void testGetAccessRecords_HasData_ReturnCorrectResult() {
}
```

#### 1.2 æµ‹è¯•ç¤ºä¾‹

**Serviceå±‚æµ‹è¯•**:
```java
@SpringBootTest
@TestPropertySource(locations = "classpath:application-test.yml")
class AccessServiceTest {

    @Autowired
    private AccessService accessService;

    @MockBean
    private DeviceServiceClient deviceService;

    @MockBean
    private AuthServiceClient authService;

    @Test
    void testOpenDoor_Success() {
        // Given
        Long doorId = 1L;
        Long userId = 100L;

        when(deviceService.getDoorInfo(doorId))
                .thenReturn(Response.success(createDoorInfo(doorId)));
        when(authService.getUserInfo(userId))
                .thenReturn(Response.success(createUserInfo(userId)));

        // When
        accessService.openDoor(doorId, userId);

        // Then
        verify(deviceService).openDoor(doorId);
    }

    @Test
    void testOpenDoor_UserNotExists_ThrowException() {
        // Given
        Long doorId = 1L;
        Long userId = 100L;

        when(authService.getUserInfo(userId))
                .thenReturn(Response.error(ResponseCode.USER_NOT_EXISTS));

        // When & Then
        BusinessException exception = assertThrows(BusinessException.class,
                () -> accessService.openDoor(doorId, userId));
        assertEquals("ç”¨æˆ·ä¸å­˜åœ¨", exception.getMessage());
    }

    private DoorInfoVO createDoorInfo(Long doorId) {
        DoorInfoVO door = new DoorInfoVO();
        door.setDoorId(doorId);
        door.setDoorName("æµ‹è¯•é—¨ç¦");
        door.setStatus(DoorStatusEnum.ACTIVE);
        return door;
    }

    private UserInfoVO createUserInfo(Long userId) {
        UserInfoVO user = new UserInfoVO();
        user.setUserId(userId);
        user.setUsername("testuser");
        user.setStatus(UserStatusEnum.ACTIVE);
        return user;
    }
}
```

**Controllerå±‚æµ‹è¯•**:
```java
@WebMvcTest(AccessController.class)
class AccessControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private AccessService accessService;

    @Test
    void testOpenDoor_Success() throws Exception {
        // Given
        OpenDoorRequest request = new OpenDoorRequest();
        request.setDoorId(1L);
        request.setUserId(100L);

        doNothing().when(accessService).openDoor(1L, 100L);

        // When & Then
        mockMvc.perform(post("/api/access/open")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectToJson(request)))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.code").value(200))
                .andExpect(jsonPath("$.message").value("æˆåŠŸ"));
    }

    private String objectToJson(Object obj) {
        try {
            return new ObjectMapper().writeValueAsString(obj);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
```

### 2. é›†æˆæµ‹è¯•

#### 2.1 æµ‹è¯•é…ç½®

**æµ‹è¯•é…ç½®æ–‡ä»¶**:
```yaml
spring:
  profiles:
    active: test

  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1
    driver-class-name: org.h2.Driver
    username: sa
    password:

  h2:
    console:
      enabled: true

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true

mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

#### 2.2 æµ‹è¯•ç¤ºä¾‹

**é›†æˆæµ‹è¯•**:
```java
@SpringBootTest
@Transactional
@Rollback
class AccessControllerIntegrationTest {

    @Autowired
    private TestRestTemplate restTemplate;

    @Autowired
    private AccessRecordDao accessRecordDao;

    @Test
    void testGetAccessRecords_ReturnCorrectData() {
        // Given
        AccessRecordEntity record = new AccessRecordEntity();
        record.setDoorId(1L);
        record.setUserId(100L);
        record.setAccessTime(new Date());
        record.setAccessType(AccessTypeEnum.OPEN);
        record.setResult(AccessResultEnum.SUCCESS);
        accessRecordDao.insert(record);

        // When
        ResponseEntity<Response<PageResult<AccessRecordVO>>> response = restTemplate.getForEntity(
                "/api/access/records",
                new ParameterizedTypeReference<Response<PageResult<AccessRecordVO>>>() {});

        // Then
        assertEquals(HttpStatus.OK, response.getStatusCode());
        assertNotNull(response.getBody().getData());
        assertEquals(1, response.getBody().getData().getTotal().intValue());
    }
}
```

---

## ğŸ”„ Gitå·¥ä½œæµ

### 1. åˆ†æ”¯ç®¡ç†ç­–ç•¥

#### 1.1 åˆ†æ”¯ç±»å‹

```bash
# ä¸»åˆ†æ”¯
main/master          # ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼Œåªæ¥å—æ¥è‡ªreleaseåˆ†æ”¯çš„åˆå¹¶
develop              # å¼€å‘ç¯å¢ƒåˆ†æ”¯ï¼Œæ‰€æœ‰åŠŸèƒ½åˆ†æ”¯éƒ½ä»è¿™é‡Œåˆ›å»º

# æ”¯æŒåˆ†æ”¯
feature/åŠŸèƒ½åç§°     # åŠŸèƒ½å¼€å‘åˆ†æ”¯
hotfix/é—®é¢˜æè¿°      # ç´§æ€¥ä¿®å¤åˆ†æ”¯
release/ç‰ˆæœ¬å·       # å‘å¸ƒå‡†å¤‡åˆ†æ”¯

# ç¤ºä¾‹
feature/access-control-enhancement
hotfix/fix-login-bug
release/v1.1.0
```

#### 1.2 åˆ†æ”¯å‘½åè§„èŒƒ

```bash
# åŠŸèƒ½åˆ†æ”¯
feature/user-authentication
feature/door-access-control
feature/consume-payment

# ä¿®å¤åˆ†æ”¯
hotfix/fix-memory-leak
hotfix/fix-concurrent-issue

# å‘å¸ƒåˆ†æ”¯
release/v1.0.0
release/v1.1.0
```

### 2. æäº¤è§„èŒƒ

#### 2.1 æäº¤ä¿¡æ¯æ ¼å¼

```bash
<type>(<scope>): <subject>

<body>

<footer>
```

**ç±»å‹è¯´æ˜**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰
- `refactor`: é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: å¢åŠ æµ‹è¯•
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

#### 2.2 æäº¤ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½æäº¤
feat(access): æ·»åŠ é—¨ç¦å¼€é—¨åŠŸèƒ½

- å®ç°é—¨ç¦å¼€é—¨APIæ¥å£
- æ·»åŠ ç”¨æˆ·æƒé™éªŒè¯é€»è¾‘
- å¢åŠ å¼€é—¨è®°å½•å­˜å‚¨åŠŸèƒ½

Closes #123

# Bugä¿®å¤æäº¤
fix(auth): ä¿®å¤ç”¨æˆ·è®¤è¯å¤±è´¥é—®é¢˜

é—®é¢˜åŸå› ï¼šTokenè§£ææ—¶æœªå¤„ç†è¿‡æœŸæƒ…å†µ
è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ Tokenè¿‡æœŸæ£€æŸ¥å’Œå¼‚å¸¸å¤„ç†
å½±å“èŒƒå›´ï¼šæ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£

Fixes #456

# æ€§èƒ½ä¼˜åŒ–æäº¤
perf(device): ä¼˜åŒ–è®¾å¤‡æŸ¥è¯¢æ€§èƒ½

- æ·»åŠ Redisç¼“å­˜æœºåˆ¶
- ä¼˜åŒ–SQLæŸ¥è¯¢è¯­å¥
- å‡å°‘ä¸å¿…è¦çš„æ•°æ®åº“è¿æ¥

Performance improvement: 50% faster device queries
```

### 3. Code Reviewè§„èŒƒ

#### 3.1 Reviewæ£€æŸ¥æ¸…å•

**åŠŸèƒ½æ€§æ£€æŸ¥**:
- [ ] åŠŸèƒ½æ˜¯å¦æ­£ç¡®å®ç°éœ€æ±‚
- [ ] è¾¹ç•Œæ¡ä»¶æ˜¯å¦å¤„ç†
- [ ] å¼‚å¸¸æƒ…å†µæ˜¯å¦è€ƒè™‘
- [ ] æ€§èƒ½æ˜¯å¦æ»¡è¶³è¦æ±‚

**ä»£ç è´¨é‡æ£€æŸ¥**:
- [ ] ä»£ç æ˜¯å¦éµå¾ªç¼–ç è§„èŒƒ
- [ ] å‘½åæ˜¯å¦æ¸…æ™°æ˜“æ‡‚
- [ ] æ³¨é‡Šæ˜¯å¦å®Œæ•´å‡†ç¡®
- [ ] ä»£ç æ˜¯å¦ç®€æ´é«˜æ•ˆ

**å®‰å…¨æ€§æ£€æŸ¥**:
- [ ] æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥é£é™©
- [ ] æ˜¯å¦è¿›è¡Œè¾“å…¥éªŒè¯
- [ ] æ˜¯å¦å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²
- [ ] æƒé™æ§åˆ¶æ˜¯å¦æ­£ç¡®

**æµ‹è¯•æ£€æŸ¥**:
- [ ] æ˜¯å¦æœ‰è¶³å¤Ÿçš„å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦è¦†ç›–è¾¹ç•Œæƒ…å†µ
- [ ] é›†æˆæµ‹è¯•æ˜¯å¦é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•æ˜¯å¦è¾¾æ ‡

#### 3.2 Reviewæµç¨‹

```bash
# 1. åˆ›å»ºPull Request
git checkout -b feature/new-feature
# å¼€å‘å®Œæˆå
git add .
git commit -m "feat: æ–°åŠŸèƒ½å®ç°"
git push origin feature/new-feature

# 2. åœ¨GitHub/GitLabåˆ›å»ºPull Request
# æ ‡é¢˜ï¼šfeat(access): æ·»åŠ é—¨ç¦å¼€é—¨åŠŸèƒ½
# æè¿°ï¼šè¯¦ç»†è¯´æ˜åŠŸèƒ½å®ç°å’Œæµ‹è¯•æƒ…å†µ

# 3. åˆ†é…Reviewers
# è‡³å°‘éœ€è¦2ä¸ªreviewer
# åŒ…å«é¢†åŸŸä¸“å®¶å’Œæ¶æ„å¸ˆ

# 4. æ ¹æ®åé¦ˆä¿®æ”¹ä»£ç 
# ä¿®æ”¹åå†æ¬¡æäº¤
git add .
git commit -m "fix: ä¿®å¤reviewæ„è§"
git push origin feature/new-feature

# 5. åˆå¹¶ä»£ç 
# æ‰€æœ‰reviewé€šè¿‡ååˆå¹¶åˆ°developåˆ†æ”¯
git checkout develop
git pull origin develop
git merge feature/new-feature
git push origin develop

# 6. åˆ é™¤åŠŸèƒ½åˆ†æ”¯
git branch -d feature/new-feature
git push origin --delete feature/new-feature
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æŒ‡å—

### 1. æ•°æ®åº“ä¼˜åŒ–

#### 1.1 SQLä¼˜åŒ–

**ç´¢å¼•ä¼˜åŒ–**:
```sql
-- æŸ¥è¯¢æ…¢SQL
EXPLAIN SELECT * FROM t_access_record
WHERE door_id = 1 AND user_id = 100
AND access_time >= '2025-11-29 00:00:00'
AND access_time <= '2025-11-29 23:59:59';

-- æ·»åŠ å¤åˆç´¢å¼•
ALTER TABLE t_access_record
ADD INDEX idx_door_user_time (door_id, user_id, access_time);

-- éªŒè¯ç´¢å¼•ä½¿ç”¨
EXPLAIN SELECT * FROM t_access_record
WHERE door_id = 1 AND user_id = 100
AND access_time >= '2025-11-29 00:00:00'
AND access_time <= '2025-11-29 23:59:59';
```

**åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–**:
```java
// âŒ é”™è¯¯çš„åˆ†é¡µæ–¹å¼ï¼ˆæ·±åˆ†é¡µæ€§èƒ½å·®ï¼‰
public List<AccessRecordEntity> getAccessRecords(int pageNum, int pageSize) {
    int offset = (pageNum - 1) * pageSize;
    return accessRecordDao.selectByLimit(offset, pageSize);
}

// âœ… æ­£ç¡®çš„åˆ†é¡µæ–¹å¼ï¼ˆä½¿ç”¨æ¸¸æ ‡ï¼‰
public List<AccessRecordEntity> getAccessRecords(Long lastId, int pageSize) {
    return accessRecordDao.selectByIdGreaterThan(lastId, pageSize);
}
```

#### 1.2 è¿æ¥æ± ä¼˜åŒ–

**HikariCPé…ç½®ä¼˜åŒ–**:
```yaml
spring:
  datasource:
    hikari:
      # è¿æ¥æ± å¤§å°
      minimum-idle: 10              # æœ€å°ç©ºé—²è¿æ¥æ•°
      maximum-pool-size: 50          # æœ€å¤§è¿æ¥æ± å¤§å°

      # è¿æ¥è¶…æ—¶è®¾ç½®
      connection-timeout: 30000      # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      idle-timeout: 600000           # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      max-lifetime: 1800000          # è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

      # æ³„æ¼æ£€æµ‹
      leak-detection-threshold: 60000 # è¿æ¥æ³„æ¼æ£€æµ‹é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰

      # è¿æ¥éªŒè¯
      validation-timeout: 5000       # è¿æ¥éªŒè¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      connection-test-query: SELECT 1 # è¿æ¥æµ‹è¯•æŸ¥è¯¢

      # æ€§èƒ½è°ƒä¼˜
      data-source-properties:
        cachePrepStmts: true          # å¯ç”¨é¢„ç¼–è¯‘è¯­å¥ç¼“å­˜
        prepStmtCacheSize: 250        # é¢„ç¼–è¯‘è¯­å¥ç¼“å­˜å¤§å°
        prepStmtCacheSqlLimit: 2048   # é¢„ç¼–è¯‘è¯­å¥ç¼“å­˜SQLé•¿åº¦é™åˆ¶
        useServerPrepStmts: true      # ä½¿ç”¨æœåŠ¡ç«¯é¢„ç¼–è¯‘
```

### 2. ç¼“å­˜ä¼˜åŒ–

#### 2.1 Redisç¼“å­˜ç­–ç•¥

**å¤šçº§ç¼“å­˜é…ç½®**:
```java
@Configuration
@EnableCaching
public class CacheConfig {

    @Bean
    @Primary
    public CacheManager caffeineCacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager();
        cacheManager.setCaffeine(Caffeine.newBuilder()
                .initialCapacity(100)
                .maximumSize(1000)
                .expireAfterWrite(10, TimeUnit.MINUTES)
                .recordStats());
        return cacheManager;
    }

    @Bean
    public RedisCacheManager redisCacheManager(RedisConnectionFactory factory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofMinutes(30))
                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()));

        return RedisCacheManager.builder(factory)
                .cacheDefaults(config)
                .build();
    }
}
```

**ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ**:
```java
@Service
public class DeviceServiceImpl implements DeviceService {

    @Cacheable(value = "device:info", key = "#deviceId", unless = "#result == null")
    public DeviceInfoVO getDeviceInfo(Long deviceId) {
        return deviceDao.selectById(deviceId);
    }

    @CacheEvict(value = "device:info", key = "#deviceInfo.deviceId")
    public void updateDeviceInfo(DeviceInfoVO deviceInfo) {
        deviceDao.updateById(convertToEntity(deviceInfo));
    }

    @CacheEvict(value = "device:list", allEntries = true)
    public void batchUpdateDevices(List<DeviceInfoVO> devices) {
        // æ‰¹é‡æ›´æ–°é€»è¾‘
    }
}
```

### 3. JVMä¼˜åŒ–

#### 3.1 JVMå‚æ•°é…ç½®

**ç”Ÿäº§ç¯å¢ƒJVMå‚æ•°**:
```bash
-server
-Xms2g -Xmx4g
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
-XX:G1HeapRegionSize=16m
-XX:G1NewSizePercent=30
-XX:G1MaxNewSizePercent=40
-XX:+UseStringDeduplication
-XX:+OptimizeStringConcat
-XX:+UseCompressedOops
-XX:+UseCompressedClassPointers
-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCDateStamps
-Xloggc:/app/logs/gc.log
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=5
-XX:GCLogFileSize=10M
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/app/logs/
-XX:OnError=kill -9 %p
```

---

## ğŸ” è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥

### 1. æ—¥å¿—è°ƒè¯•

#### 1.1 æ—¥å¿—çº§åˆ«é…ç½®

**Logbacké…ç½®**:
```xml
<configuration>
    <!-- å¼€å‘ç¯å¢ƒ -->
    <springProfile name="dev">
        <logger name="net.lab1024.sa" level="DEBUG"/>
        <logger name="org.springframework.cloud" level="DEBUG"/>
        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
        </root>
    </springProfile>

    <!-- ç”Ÿäº§ç¯å¢ƒ -->
    <springProfile name="prod">
        <logger name="net.lab1024.sa" level="INFO"/>
        <logger name="org.springframework.cloud" level="WARN"/>
        <root level="WARN">
            <appender-ref ref="FILE"/>
            <appender-ref ref="ERROR_FILE"/>
        </root>
    </springProfile>
</configuration>
```

#### 1.2 å…³é”®æ—¥å¿—è®°å½•

**ä¸šåŠ¡æ—¥å¿—è®°å½•**:
```java
@Slf4j
@Service
public class AccessServiceImpl implements AccessService {

    @Override
    public void openDoor(Long doorId, Long userId) {
        log.info("å¼€å§‹å¼€é—¨æ“ä½œï¼Œé—¨ç¦IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", doorId, userId);

        try {
            // æ‰§è¡Œå¼€é—¨é€»è¾‘
            boolean success = executeOpenDoor(doorId, userId);

            if (success) {
                log.info("å¼€é—¨æˆåŠŸï¼Œé—¨ç¦IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", doorId, userId);
            } else {
                log.warn("å¼€é—¨å¤±è´¥ï¼Œé—¨ç¦IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", doorId, userId);
            }

        } catch (Exception e) {
            log.error("å¼€é—¨å¼‚å¸¸ï¼Œé—¨ç¦IDï¼š{}ï¼Œç”¨æˆ·IDï¼š{}", doorId, userId, e);
            throw new BusinessException("å¼€é—¨æ“ä½œå¤±è´¥");
        }
    }
}
```

### 2. è¿œç¨‹è°ƒè¯•

#### 2.1 JVMè¿œç¨‹è°ƒè¯•é…ç½®

**å¯åŠ¨å‚æ•°æ·»åŠ **:
```bash
-javaagent:lib/jdwp-agent.jar=transport=dt_socket,server=y,suspend=n,address=5005
```

**IDEAè¿œç¨‹è°ƒè¯•é…ç½®**:
```
Host: localhost
Port: 5005
Module: ioedream-access-service
Use module classpath: å‹¾é€‰
```

### 3. æ€§èƒ½åˆ†æ

#### 3.1 JProfileré…ç½®

**JVMå¯åŠ¨å‚æ•°**:
```bash
-agentpath:/path/to/jprofiler/bin/linux-x64/libjprofilerti.so=port=8849
```

**ç›‘æ§é…ç½®**:
```java
// æ–¹æ³•æ‰§è¡Œæ—¶é—´ç›‘æ§
@Timed(value = "device.open", description = "è®¾å¤‡å¼€é—¨è€—æ—¶")
public boolean openDevice(Long deviceId) {
    // å¼€é—¨é€»è¾‘
}

// JVMç›‘æ§æŒ‡æ ‡
@Component
public class JvmMonitorMetrics {

    @EventListener
    public void handleJvmInfoEvent(JvmInfoEvent event) {
        // å¤„ç†JVMä¿¡æ¯äº‹ä»¶
    }
}
```

---

## ğŸ“‹ å¼€å‘äº¤æ¥æ¸…å•

### 1. ç¯å¢ƒäº¤æ¥

- [ ] å¼€å‘ç¯å¢ƒæ­å»ºå®Œæˆ
- [ ] æœ¬åœ°æœåŠ¡å¯åŠ¨éªŒè¯
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] Redisç¼“å­˜è¿æ¥æ­£å¸¸
- [ ] IDEé…ç½®å®Œæˆ
- [ ] ä»£ç æ£€å‡ºå’Œç¼–è¯‘æˆåŠŸ

### 2. ä»£ç åº“äº¤æ¥

- [ ] é¡¹ç›®ç»“æ„ç†è§£æŒæ¡
- [ ] å››å±‚æ¶æ„è®¾è®¡ç†è§£
- [ ] ä¸šåŠ¡é€»è¾‘æ¢³ç†å®Œæˆ
- [ ] æ ¸å¿ƒæ¥å£ç†Ÿæ‚‰æŒæ¡
- [ ] æ•°æ®åº“è®¾è®¡ç†è§£
- [ ] ç¼“å­˜ç­–ç•¥ç†è§£

### 3. å¼€å‘è§„èŒƒæŒæ¡

- [ ] ç¼–ç è§„èŒƒç†è§£æŒæ¡
- [ ] APIè®¾è®¡è§„èŒƒæŒæ¡
- [ ] æ•°æ®åº“è®¾è®¡è§„èŒƒæŒæ¡
- [ ] Gitå·¥ä½œæµæŒæ¡
- [ ] ä»£ç Reviewæµç¨‹æŒæ¡
- [ ] æµ‹è¯•è§„èŒƒæŒæ¡

### 4. å·¥å…·ä½¿ç”¨æŒæ¡

- [ ] Mavenæ„å»ºå·¥å…·ä½¿ç”¨
- [ ] Dockerå®¹å™¨åŒ–å¼€å‘
- [ ] è°ƒè¯•å·¥å…·ä½¿ç”¨
- [ ] æ€§èƒ½åˆ†æå·¥å…·ä½¿ç”¨
- [ ] ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·ä½¿ç”¨
- [ ] CI/CDæµç¨‹ç†è§£

### 5. å®è·µèƒ½åŠ›éªŒè¯

- [ ] èƒ½å¤Ÿç‹¬ç«‹åˆ›å»ºæ–°çš„æ¥å£
- [ ] èƒ½å¤Ÿç‹¬ç«‹ä¿®æ”¹ä¸šåŠ¡é€»è¾‘
- [ ] èƒ½å¤Ÿè¿›è¡Œæ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–
- [ ] èƒ½å¤Ÿç¼–å†™å•å…ƒæµ‹è¯•
- [ ] èƒ½å¤Ÿè¿›è¡Œä»£ç è°ƒè¯•
- [ ] èƒ½å¤Ÿå¤„ç†å¸¸è§é—®é¢˜

---

## ğŸ“ æ”¯æŒè”ç³»æ–¹å¼

### æŠ€æœ¯æ”¯æŒ

| è§’è‰² | å§“å | è”ç³»æ–¹å¼ | æ”¯æŒå†…å®¹ |
|------|------|----------|----------|
| æ¶æ„å¸ˆ | å¼ ä¸‰ | zhangsan@ioedream.com | æ¶æ„è®¾è®¡ã€æŠ€æœ¯æ–¹æ¡ˆ |
| é«˜çº§å¼€å‘ | æå›› | lisi@ioedream.com | æ ¸å¿ƒåŠŸèƒ½ã€å¤æ‚ä¸šåŠ¡ |
| å‰ç«¯ä¸“å®¶ | ç‹äº” | wangwu@ioedream.com | å‰ç«¯å¼€å‘ã€æ¥å£å¯¹æ¥ |
| æµ‹è¯•ä¸“å®¶ | èµµå…­ | zhaoliu@ioedream.com | æµ‹è¯•æ–¹æ³•ã€è´¨é‡ä¿è¯ |

### å­¦ä¹ èµ„æº

- **å†…éƒ¨æ–‡æ¡£**: é¡¹ç›®Wikiã€æŠ€æœ¯æ–‡æ¡£
- **ä»£ç ä»“åº“**: GitHub/GitLabä»£ç ä»“åº“
- **æŠ€æœ¯åˆ†äº«**: å›¢é˜ŸæŠ€æœ¯åˆ†äº«ä¼šè®°å½•
- **æœ€ä½³å®è·µ**: é¡¹ç›®æœ€ä½³å®è·µæ¡ˆä¾‹

---

**æŒ‡å—ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´11æœˆ29æ—¥
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ29æ—¥
**æ–‡æ¡£çŠ¶æ€**: å¾…éªŒæ”¶

**é‡è¦æé†’**:
1. æœ¬æŒ‡å—æ˜¯IOE-DREAMå¼€å‘å·¥ä½œçš„æ ¸å¿ƒå‚è€ƒæ–‡æ¡£
2. æ–°å›¢é˜Ÿæˆå‘˜åº”è®¤çœŸå­¦ä¹ å¹¶æŒ‰ç…§è§„èŒƒæ‰§è¡Œ
3. é‡åˆ°é—®é¢˜åŠæ—¶å‘å¯¼å¸ˆæˆ–å›¢é˜Ÿå¯»æ±‚å¸®åŠ©
4. ç§¯æå‚ä¸ä»£ç Reviewå’ŒæŠ€æœ¯åˆ†äº«
5. æŒç»­å­¦ä¹ å’Œæå‡æŠ€æœ¯èƒ½åŠ›