# IOE-DREAM å¾®æœåŠ¡æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´11æœˆ29æ—¥
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ29æ—¥
**æ–‡æ¡£çŠ¶æ€**: å·²å®Œæˆ

---

## ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

### 1. å¾®æœåŠ¡æ¶æ„åŸåˆ™

#### 1.1 å•ä¸€èŒè´£åŸåˆ™
æ¯ä¸ªå¾®æœåŠ¡åº”è¯¥ä¸“æ³¨äºå•ä¸€çš„ä¸šåŠ¡é¢†åŸŸï¼Œå…·æœ‰æ˜ç¡®çš„ä¸šåŠ¡è¾¹ç•Œã€‚

#### 1.2 ç‹¬ç«‹éƒ¨ç½²åŸåˆ™
æ¯ä¸ªå¾®æœåŠ¡åº”è¯¥èƒ½å¤Ÿç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œæ‰©å±•ã€‚

#### 1.3 å»ä¸­å¿ƒåŒ–åŸåˆ™
æ•°æ®å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªæœåŠ¡ç®¡ç†è‡ªå·±çš„æ•°æ®å­˜å‚¨ã€‚

#### 1.4 å®¹é”™è®¾è®¡åŸåˆ™
æœåŠ¡é—´é€šè¿‡å¼‚æ­¥é€šä¿¡ï¼Œå…·å¤‡æ•…éšœéš”ç¦»å’Œé™çº§èƒ½åŠ›ã€‚

### 2. æŠ€æœ¯é€‰å‹åŸåˆ™

#### 2.1 æŠ€æœ¯æ ˆç»Ÿä¸€
- ä½¿ç”¨Spring Boot 3.5.7 + Spring Cloud 2023.0.3ç»Ÿä¸€æŠ€æœ¯æ ˆ
- é‡‡ç”¨Java 17ä½œä¸ºä¸»è¦å¼€å‘è¯­è¨€
- ä½¿ç”¨MySQLä½œä¸ºä¸»æ•°æ®å­˜å‚¨ï¼ŒRedisä½œä¸ºç¼“å­˜

#### 2.2 å¼€æºä¼˜å…ˆ
ä¼˜å…ˆé€‰æ‹©æˆç†Ÿçš„å¼€æºæŠ€æœ¯ï¼Œé¿å…æŠ€æœ¯é”å®šã€‚

#### 2.3 äº‘åŸç”Ÿè®¾è®¡
æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ï¼Œé€‚é…Kubernetesç¼–æ’ã€‚

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### 1. æ¶æ„åˆ†å±‚

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚ (Frontend Layer)"
        Web[Webåº”ç”¨<br/>Vue3 + Ant Design]
        Mobile[ç§»åŠ¨åº”ç”¨<br/>UniApp]
        API[å¼€æ”¾API<br/>RESTful Gateway]
    end

    subgraph "ç½‘å…³å±‚ (Gateway Layer)"
        Gateway[APIç½‘å…³<br/>Spring Cloud Gateway<br/>ç«¯å£: 8080]
        LB[è´Ÿè½½å‡è¡¡<br/>Nginx/HAProxy]
    end

    subgraph "æœåŠ¡å±‚ (Service Layer)"
        subgraph "è®¤è¯æœåŠ¡"
            Auth[è®¤è¯æœåŠ¡<br/>ioedream-auth-service<br/>ç«¯å£: 8081]
            Identity[èº«ä»½æƒé™æœåŠ¡<br/>ioedream-identity-service<br/>ç«¯å£: 8082]
        end

        subgraph "æ ¸å¿ƒä¸šåŠ¡æœåŠ¡"
            Device[è®¾å¤‡ç®¡ç†æœåŠ¡<br/>ioedream-device-service<br/>ç«¯å£: 8101]
            Access[é—¨ç¦ç®¡ç†æœåŠ¡<br/>ioedream-access-service<br/>ç«¯å£: 8102]
            Consume[æ¶ˆè´¹ç®¡ç†æœåŠ¡<br/>ioedream-consume-service<br/>ç«¯å£: 8103]
            Visitor[è®¿å®¢ç®¡ç†æœåŠ¡<br/>ioedream-visitor-service<br/>ç«¯å£: 8104]
            Attendance[è€ƒå‹¤ç®¡ç†æœåŠ¡<br/>ioedream-attendance-service<br/>ç«¯å£: 8105]
            Video[è§†é¢‘ç›‘æ§æœåŠ¡<br/>ioedream-video-service<br/>ç«¯å£: 8106]
        end

        subgraph "æ”¯æ’‘æœåŠ¡"
            Notification[é€šçŸ¥æœåŠ¡<br/>ioedream-notification-service<br/>ç«¯å£: 8107]
            File[æ–‡ä»¶æœåŠ¡<br/>ioedream-file-service<br/>ç«¯å£: 8108]
            Report[æŠ¥è¡¨æœåŠ¡<br/>ioedream-report-service<br/>ç«¯å£: 8109]
            HR[äººåŠ›èµ„æºæœåŠ¡<br/>hr-service<br/>ç«¯å£: 8200]
            Analytics[åˆ†ææœåŠ¡<br/>analytics-service<br/>ç«¯å£: 8201]
        end

        subgraph "è¿ç»´æœåŠ¡"
            Audit[å®¡è®¡æœåŠ¡<br/>ioedream-audit-service<br/>ç«¯å£: 8110]
            Logging[æ—¥å¿—æœåŠ¡<br/>ioedream-logging-service<br/>ç«¯å£: 8111]
            Config[é…ç½®æœåŠ¡<br/>ioedream-config-service<br/>ç«¯å£: 8112]
            Monitor[ç›‘æ§æœåŠ¡<br/>monitor-service<br/>ç«¯å£: 8300]
        end
    end

    subgraph "æ•°æ®å±‚ (Data Layer)"
        MySQL[(MySQLé›†ç¾¤<br/>ä¸»ä»å¤åˆ¶)]
        Redis[(Redisé›†ç¾¤<br/>å“¨å…µæ¨¡å¼)]
        MongoDB[(MongoDB<br/>æ–‡æ¡£æ•°æ®åº“)]
        MinIO[(MinIO<br/>å¯¹è±¡å­˜å‚¨)]
    end

    subgraph "ä¸­é—´ä»¶å±‚ (Middleware Layer)"
        Consul[Consul<br/>æœåŠ¡å‘ç°+é…ç½®ä¸­å¿ƒ]
        RabbitMQ[RabbitMQ<br/>æ¶ˆæ¯é˜Ÿåˆ—]
        Elasticsearch[Elasticsearch<br/>æœç´¢å¼•æ“]
    end

    subgraph "åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)"
        K8s[Kubernetes<br/>å®¹å™¨ç¼–æ’]
        Prometheus[Prometheus<br/>ç›‘æ§ç³»ç»Ÿ]
        Grafana[Grafana<br/>å¯è§†åŒ–]
        Jaeger[Jaeger<br/>é“¾è·¯è¿½è¸ª]
    end

    Web --> Gateway
    Mobile --> Gateway
    API --> Gateway
    LB --> Gateway

    Gateway --> Auth
    Gateway --> Identity
    Gateway --> Device
    Gateway --> Access
    Gateway --> Consume
    Gateway --> Visitor
    Gateway --> Attendance
    Gateway --> Video
    Gateway --> Notification
    Gateway --> File
    Gateway --> Report
    Gateway --> HR
    Gateway --> Analytics

    Auth --> Consul
    Identity --> Consul
    Device --> Consul
    Access --> Consul
    Consume --> Consul
    Visitor --> Consul
    Attendance --> Consul
    Video --> Consul
    Notification --> Consul
    File --> Consul
    Report --> Consul

    Auth --> MySQL
    Identity --> MySQL
    Device --> MySQL
    Access --> MySQL
    Consume --> MySQL
    Visitor --> MySQL
    Attendance --> MySQL
    HR --> MySQL

    Auth --> Redis
    Identity --> Redis
    Device --> Redis
    Access --> Redis
    Consume --> Redis
    Visitor --> Redis
    Attendance --> Redis

    Video --> MinIO
    File --> MinIO

    Gateway --> RabbitMQ
    Notification --> RabbitMQ
    Logging --> RabbitMQ
    Audit --> Elasticsearch
    Logging --> Elasticsearch
    Monitor --> Prometheus
    Gateway --> Jaeger
```

### 2. æœåŠ¡æ‹†åˆ†ç­–ç•¥

#### 2.1 ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†

| æœåŠ¡åç§° | è´Ÿè´£é¢†åŸŸ | ä¸»è¦åŠŸèƒ½ | æ•°æ®åº“ |
|---------|---------|---------|-------|
| ioedream-auth-service | è®¤è¯æˆæƒ | ç”¨æˆ·è®¤è¯ã€Tokenç®¡ç†ã€æƒé™éªŒè¯ | ioedream_auth_db |
| ioedream-identity-service | èº«ä»½ç®¡ç† | ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€æƒé™ç®¡ç† | ioedream_identity_db |
| ioedream-device-service | è®¾å¤‡ç®¡ç† | è®¾å¤‡æ³¨å†Œã€çŠ¶æ€ç›‘æ§ã€è®¾å¤‡æ§åˆ¶ | ioedream_device_db |
| ioedream-access-service | é—¨ç¦ç®¡ç† | é—¨ç¦æ§åˆ¶ã€è®¿å®¢ç®¡ç†ã€ç”Ÿç‰©è¯†åˆ« | ioedream_access_db |
| ioedream-consume-service | æ¶ˆè´¹ç®¡ç† | æ¶ˆè´¹è®°å½•ã€è´¦æˆ·ç®¡ç†ã€æ”¯ä»˜å¤„ç† | ioedream_consume_db |
| ioedream-visitor-service | è®¿å®¢ç®¡ç† | è®¿å®¢é¢„çº¦ã€è®¿å®¢ç™»è®°ã€è®¿å®¢è¿½è¸ª | ioedream_visitor_db |
| ioedream-attendance-service | è€ƒå‹¤ç®¡ç† | è€ƒå‹¤è®°å½•ã€æ’ç­ç®¡ç†ã€ç»Ÿè®¡åˆ†æ | ioedream_attendance_db |
| ioedream-video-service | è§†é¢‘ç›‘æ§ | è§†é¢‘æµç®¡ç†ã€å½•åƒå­˜å‚¨ã€æ™ºèƒ½åˆ†æ | ioedream_video_db |
| ioedream-notification-service | é€šçŸ¥æœåŠ¡ | æ¶ˆæ¯æ¨é€ã€é‚®ä»¶é€šçŸ¥ã€çŸ­ä¿¡é€šçŸ¥ | ioedream_notification_db |
| ioedream-file-service | æ–‡ä»¶æœåŠ¡ | æ–‡ä»¶ä¸Šä¼ ã€å­˜å‚¨ç®¡ç†ã€æƒé™æ§åˆ¶ | ioedream_file_db |
| ioedream-report-service | æŠ¥è¡¨æœåŠ¡ | æŠ¥è¡¨ç”Ÿæˆã€æ•°æ®åˆ†æã€å›¾è¡¨å±•ç¤º | ioedream_report_db |
| ioedream-audit-service | å®¡è®¡æœåŠ¡ | æ“ä½œå®¡è®¡ã€è¡Œä¸ºè¿½è¸ªã€åˆè§„æ£€æŸ¥ | ioedream_audit_db |
| ioedream-logging-service | æ—¥å¿—æœåŠ¡ | æ—¥å¿—æ”¶é›†ã€åˆ†æã€æ£€ç´¢ã€å‘Šè­¦ | ioedream_logging_db |
| ioedream-config-service | é…ç½®æœåŠ¡ | åŠ¨æ€é…ç½®ã€ç¯å¢ƒç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ | ioedream_config_db |

#### 2.2 æ•°æ®æ‹†åˆ†åŸåˆ™

1. **æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†**: æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“
2. **é¿å…è·¨åº“æŸ¥è¯¢**: é€šè¿‡APIè°ƒç”¨è·å–å…¶ä»–æœåŠ¡æ•°æ®
3. **æ•°æ®ä¸€è‡´æ€§**: ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æˆ–æœ€ç»ˆä¸€è‡´æ€§
4. **æ•°æ®å¤‡ä»½**: æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å¤‡ä»½ç­–ç•¥

### 3. æœåŠ¡é—´é€šä¿¡è®¾è®¡

#### 3.1 åŒæ­¥é€šä¿¡

**æŠ€æœ¯é€‰æ‹©**: OpenFeign + Spring Cloud LoadBalancer

```java
// ç¤ºä¾‹ï¼šè®¾å¤‡æœåŠ¡è°ƒç”¨é—¨ç¦æœåŠ¡
@FeignClient(name = "ioedream-access-service")
public interface AccessServiceClient {

    @GetMapping("/api/access/doors/{doorId}/status")
    Response<DoorStatusVO> getDoorStatus(@PathVariable Long doorId);

    @PostMapping("/api/access/doors/{doorId}/open")
    Response<Void> openDoor(@PathVariable Long doorId, @RequestBody OpenDoorRequest request);
}
```

**ç†”æ–­é™çº§**: ä½¿ç”¨Resilience4jå®ç°ç†”æ–­å’Œé™çº§

```java
@Component
public class AccessServiceFallback implements AccessServiceClient {

    @Override
    public Response<DoorStatusVO> getDoorStatus(Long doorId) {
        return Response.error(ResponseCode.SERVICE_UNAVAILABLE, "é—¨ç¦æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
    }

    @Override
    public Response<Void> openDoor(Long doorId, OpenDoorRequest request) {
        return Response.error(ResponseCode.SERVICE_UNAVAILABLE, "é—¨ç¦æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
    }
}
```

#### 3.2 å¼‚æ­¥é€šä¿¡

**æŠ€æœ¯é€‰æ‹©**: RabbitMQæ¶ˆæ¯é˜Ÿåˆ—

```java
// æ¶ˆæ¯å‘é€è€…
@Component
public class NotificationMessageSender {

    @Autowired
    private RabbitTemplate rabbitTemplate;

    public void sendAccessNotification(AccessNotificationMessage message) {
        rabbitTemplate.convertAndSend(
            "ioedream.access.notification.exchange",
            "access.notification.routing.key",
            message
        );
    }
}

// æ¶ˆæ¯æ¥æ”¶è€…
@RabbitListener(queues = "ioedream.access.notification.queue")
public void handleAccessNotification(AccessNotificationMessage message) {
    notificationService.sendNotification(message);
}
```

#### 3.3 äº‹ä»¶é©±åŠ¨æ¶æ„

```mermaid
graph LR
    subgraph "äº‹ä»¶å‘å¸ƒè€…"
        Access[é—¨ç¦æœåŠ¡]
        Device[è®¾å¤‡æœåŠ¡]
        Consume[æ¶ˆè´¹æœåŠ¡]
    end

    subgraph "æ¶ˆæ¯ä¸­é—´ä»¶"
        MQ[RabbitMQ<br/>äº‹ä»¶æ€»çº¿]
    end

    subgraph "äº‹ä»¶è®¢é˜…è€…"
        Audit[å®¡è®¡æœåŠ¡]
        Notification[é€šçŸ¥æœåŠ¡]
        Logging[æ—¥å¿—æœåŠ¡]
        Monitor[ç›‘æ§æœåŠ¡]
    end

    Access -->|é—¨ç¦äº‹ä»¶| MQ
    Device -->|è®¾å¤‡äº‹ä»¶| MQ
    Consume -->|æ¶ˆè´¹äº‹ä»¶| MQ

    MQ --> Audit
    MQ --> Notification
    MQ --> Logging
    MQ --> Monitor
```

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯ç»„ä»¶

### 1. æœåŠ¡æ³¨å†Œå‘ç°

#### 1.1 Consulé›†æˆ

**Consulé…ç½®**:
```yaml
spring:
  cloud:
    consul:
      host: ${CONSUL_HOST:localhost}
      port: ${CONSUL_PORT:8500}
      discovery:
        service-name: ${spring.application.name}
        instance-id: ${spring.application.name}-${spring.cloud.client.ip-address}-${server.port}
        prefer-ip-address: true
        health-check-path: /actuator/health
        health-check-interval: 15s
        health-check-timeout: 5s
        health-check-critical-timeout: 30s
      config:
        format: yaml
        default-context: application
        data-key: data
```

**æœåŠ¡æ³¨å†Œ**:
```java
@SpringBootApplication
@EnableDiscoveryClient
public class AccessServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(AccessServiceApplication.class, args);
    }
}
```

### 2. é…ç½®ç®¡ç†

#### 2.1 Consul Config

**é…ç½®ç»“æ„**:
```
consul kv
â””â”€â”€ config/
    â”œâ”€â”€ ioedream-access-service/
    â”‚   â”œâ”€â”€ data
    â”‚   â”‚   â”œâ”€â”€ database.yml
    â”‚   â”‚   â”œâ”€â”€ redis.yml
    â”‚   â”‚   â””â”€â”€ rabbitmq.yml
    â”‚   â””â”€â”€ folders/
    â”‚       â”œâ”€â”€ dev/
    â”‚       â”œâ”€â”€ test/
    â”‚       â””â”€â”€ prod/
```

**åŠ¨æ€é…ç½®åˆ·æ–°**:
```java
@RestController
@RefreshScope
public class ConfigController {

    @Value("${app.config.refresh-interval:30}")
    private Integer refreshInterval;

    @GetMapping("/config/refresh-interval")
    public Integer getRefreshInterval() {
        return refreshInterval;
    }
}
```

### 3. è´Ÿè½½å‡è¡¡

#### 3.1 å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡

```java
@Configuration
public class LoadBalancerConfig {

    @Bean
    @LoadBalanced
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }

    @Bean
    public ReactorLoadBalancer<ServiceInstance> serviceInstanceLoadBalancer(
            Environment environment,
            LoadBalancerClientFactory loadBalancerClientFactory) {
        String serviceId = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);
        return new RoundRobinLoadBalancer(
            loadBalancerClientFactory.getLazyProvider(serviceId, ServiceInstanceListSupplier.class),
            serviceId
        );
    }
}
```

### 4. ç†”æ–­é™çº§

#### 4.1 Resilience4jé…ç½®

```yaml
resilience4j:
  circuitbreaker:
    instances:
      accessService:
        failureRateThreshold: 50
        waitDurationInOpenState: 30s
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
  retry:
    instances:
      accessService:
        maxAttempts: 3
        waitDuration: 1s
        retryExceptions:
          - java.net.SocketTimeoutException
          - java.io.IOException
```

```java
@Component
public class AccessServiceCircuitBreaker {

    private final CircuitBreaker circuitBreaker;
    private final Retry retry;

    public AccessServiceCircuitBreaker(
            CircuitBreakerRegistry circuitBreakerRegistry,
            RetryRegistry retryRegistry) {
        this.circuitBreaker = circuitBreakerRegistry.circuitBreaker("accessService");
        this.retry = retryRegistry.retry("accessService");
    }

    public Response<DoorStatusVO> getDoorStatusWithFallback(Long doorId) {
        Supplier<Response<DoorStatusVO>> supplier = CircuitBreaker
            .decorateSupplier(circuitBreaker, () -> accessServiceClient.getDoorStatus(doorId));
        supplier = Retry.decorateSupplier(retry, supplier);

        return Try.ofSupplier(supplier)
            .recover(throwable -> Response.error(ResponseCode.SERVICE_UNAVAILABLE, "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨"))
            .get();
    }
}
```

---

## ğŸ—„ï¸ æ•°æ®æ¶æ„è®¾è®¡

### 1. æ•°æ®åº“è®¾è®¡

#### 1.1 æ•°æ®åº“æ‹†åˆ†ç­–ç•¥

**æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†**:
```yaml
æ•°æ®åº“è§„åˆ’:
  ioedream_auth_db:        # è®¤è¯æœåŠ¡æ•°æ®åº“
    host: mysql-auth-master
    port: 3306
    database: ioedream_auth

  ioedream_identity_db:    # èº«ä»½æœåŠ¡æ•°æ®åº“
    host: mysql-identity-master
    port: 3306
    database: ioedream_identity

  ioedream_device_db:      # è®¾å¤‡æœåŠ¡æ•°æ®åº“
    host: mysql-device-master
    port: 3306
    database: ioedream_device

  ioedream_access_db:      # é—¨ç¦æœåŠ¡æ•°æ®åº“
    host: mysql-access-master
    port: 3306
    database: ioedream_access

  ioedream_consume_db:     # æ¶ˆè´¹æœåŠ¡æ•°æ®åº“
    host: mysql-consume-master
    port: 3306
    database: ioedream_consume
```

#### 1.2 è¯»å†™åˆ†ç¦»é…ç½®

```yaml
spring:
  datasource:
    master:
      jdbc-url: jdbc:mysql://mysql-master:3306/ioedream_access
      username: ${DB_USERNAME:root}
      password: ${DB_PASSWORD:password}
      driver-class-name: com.mysql.cj.jdbc.Driver
    slave:
      jdbc-url: jdbc:mysql://mysql-slave:3306/ioedream_access
      username: ${DB_USERNAME:root}
      password: ${DB_PASSWORD:password}
      driver-class-name: com.mysql.cj.jdbc.Driver
```

#### 1.3 åˆ†åº“åˆ†è¡¨è®¾è®¡

**ç”¨æˆ·ç›¸å…³è¡¨åˆ†åº“**:
```sql
-- æŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†åº“
CREATE DATABASE ioedream_user_0;
CREATE DATABASE ioedream_user_1;
CREATE DATABASE ioedream_user_2;
CREATE DATABASE ioedream_user_3;

-- ç”¨æˆ·è¡¨åˆ†è¡¨
CREATE TABLE t_user_info_0 (
    user_id BIGINT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE t_user_info_1 (
    user_id BIGINT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ç¼“å­˜è®¾è®¡

#### 2.1 å¤šçº§ç¼“å­˜æ¶æ„

```mermaid
graph TB
    Request[å®¢æˆ·ç«¯è¯·æ±‚] --> L1[L1ç¼“å­˜<br/>æœ¬åœ°ç¼“å­˜]
    L1 --> L2[L2ç¼“å­˜<br/>Redisç¼“å­˜]
    L2 --> L3[L3ç¼“å­˜<br/>æ•°æ®åº“]

    L1 --> |ç¼“å­˜æœªå‘½ä¸­| L2
    L2 --> |ç¼“å­˜æœªå‘½ä¸­| L3
    L3 --> |æ•°æ®æ›´æ–°| L2
    L2 --> |ç¼“å­˜åŒæ­¥| L1
```

#### 2.2 Redisé›†ç¾¤é…ç½®

```yaml
spring:
  redis:
    cluster:
      nodes:
        - redis-node1:6379
        - redis-node2:6379
        - redis-node3:6379
        - redis-node4:6379
        - redis-node5:6379
        - redis-node6:6379
      max-redirects: 3
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms
```

#### 2.3 ç¼“å­˜ä½¿ç”¨ç­–ç•¥

```java
@Service
public class DeviceServiceImpl implements DeviceService {

    @Cacheable(value = "device:info", key = "#deviceId", unless = "#result == null")
    public DeviceInfo getDeviceInfo(Long deviceId) {
        return deviceDao.selectById(deviceId);
    }

    @CacheEvict(value = "device:info", key = "#deviceInfo.deviceId")
    public void updateDeviceInfo(DeviceInfo deviceInfo) {
        deviceDao.updateById(deviceInfo);
    }

    @Caching(
        cacheable = @Cacheable(value = "device:status", key = "#deviceId"),
        evict = @CacheEvict(value = "device:list", allEntries = true)
    )
    public DeviceStatus getDeviceStatus(Long deviceId) {
        return deviceStatusDao.selectByDeviceId(deviceId);
    }
}
```

### 3. æ•°æ®ä¸€è‡´æ€§

#### 3.1 åˆ†å¸ƒå¼äº‹åŠ¡

**Seataé…ç½®**:
```yaml
seata:
  enabled: true
  application-id: ioedream-access-service
  tx-service-group: ioedream-access-group
  service:
    vgroup-mapping:
      ioedream-access-group: default
    grouplist:
      default: seata-server:8091
  config:
    type: consul
    consul:
      server-addr: consul:8500
      key: seata.properties
  registry:
    type: consul
    consul:
      server-addr: consul:8500
```

**åˆ†å¸ƒå¼äº‹åŠ¡ä½¿ç”¨**:
```java
@Service
public class AccessServiceImpl implements AccessService {

    @GlobalTransactional(rollbackFor = Exception.class)
    public void processAccessEvent(AccessEvent event) {
        // 1. è®°å½•é—¨ç¦è®°å½•
        accessRecordService.insertAccessRecord(event);

        // 2. æ›´æ–°è®¾å¤‡çŠ¶æ€
        deviceService.updateDeviceStatus(event.getDeviceId(), event.getStatus());

        // 3. å‘é€é€šçŸ¥
        notificationService.sendAccessNotification(event);

        // 4. è®°å½•å®¡è®¡æ—¥å¿—
        auditService.logAccessEvent(event);
    }
}
```

#### 3.2 æœ€ç»ˆä¸€è‡´æ€§

**äº‹ä»¶æº¯æºæ¨¡å¼**:
```java
@Component
public class AccessEventProcessor {

    @EventListener
    @Async
    public void handleAccessRecordCreated(AccessRecordCreatedEvent event) {
        // å¼‚æ­¥å¤„ç†åç»­ä¸šåŠ¡é€»è¾‘

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        statisticsService.updateAccessStatistics(event);

        // æ›´æ–°ç”¨æˆ·æœ€åè®¿é—®æ—¶é—´
        userService.updateLastAccessTime(event.getUserId(), event.getAccessTime());

        // æ£€æŸ¥å¼‚å¸¸è®¿é—®
        securityService.checkAbnormalAccess(event);
    }
}
```

---

## ğŸ” å®‰å…¨æ¶æ„è®¾è®¡

### 1. è®¤è¯æˆæƒ

#### 1.1 Sa-Tokené›†æˆ

**Sa-Tokené…ç½®**:
```yaml
sa-token:
  token-name: satoken
  timeout: 2592000  # 30å¤©
  active-timeout: 1800  # 30åˆ†é’Ÿ
  is-log: true
  is-concurrent: true
  jwt-secret-key: ${JWT_SECRET:your-secret-key}
```

**è®¤è¯æœåŠ¡**:
```java
@Service
public class AuthServiceImpl implements AuthService {

    @Override
    public String login(LoginRequest request) {
        // 1. éªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.authenticate(request.getUsername(), request.getPassword());
        if (user == null) {
            throw new BusinessException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }

        // 2. ç”ŸæˆToken
        StpUtil.login(user.getUserId());
        String tokenValue = StpUtil.getTokenValue();

        // 3. è®°å½•ç™»å½•æ—¥å¿—
        loginLogService.recordLogin(user.getUserId(), request.getClientInfo());

        // 4. è¿”å›Tokenä¿¡æ¯
        return tokenValue;
    }

    @Override
    public void logout(String token) {
        // éªŒè¯Tokenå¹¶ç™»å‡º
        StpUtil.logoutByTokenValue(token);
    }
}
```

#### 1.2 æƒé™æ§åˆ¶

**RBACæƒé™æ¨¡å‹**:
```java
@RestController
@RequestMapping("/api/access")
@SaCheckRole("access_admin")
public class AccessController {

    @GetMapping("/doors")
    @SaCheckPermission("access:door:list")
    public Response<List<DoorVO>> getDoorList() {
        return Response.success(doorService.getDoorList());
    }

    @PostMapping("/doors/{doorId}/open")
    @SaCheckPermission("access:door:open")
    public Response<Void> openDoor(@PathVariable Long doorId) {
        accessService.openDoor(doorId);
        return Response.success();
    }
}
```

**æƒé™æ•°æ®æ¨¡å‹**:
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE t_user (
    user_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,
    status TINYINT DEFAULT 1,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- è§’è‰²è¡¨
CREATE TABLE t_role (
    role_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_code VARCHAR(50) NOT NULL UNIQUE,
    role_name VARCHAR(100) NOT NULL,
    description VARCHAR(200),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- æƒé™è¡¨
CREATE TABLE t_permission (
    permission_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    permission_code VARCHAR(100) NOT NULL UNIQUE,
    permission_name VARCHAR(100) NOT NULL,
    resource_type VARCHAR(20) NOT NULL,
    resource_path VARCHAR(200),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE t_user_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_role (user_id, role_id)
);

-- è§’è‰²æƒé™å…³è”è¡¨
CREATE TABLE t_role_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_role_permission (role_id, permission_id)
);
```

### 2. APIå®‰å…¨

#### 2.1 æ¥å£è®¤è¯

**æ‹¦æˆªå™¨é…ç½®**:
```java
@Configuration
public class SaTokenInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // æ”¾è¡ŒOPTIONSè¯·æ±‚
        if (HttpMethod.OPTIONS.matches(request.getMethod())) {
            return true;
        }

        // æ”¾è¡Œç™½åå•æ¥å£
        String uri = request.getRequestURI();
        if (isWhitelistUrl(uri)) {
            return true;
        }

        // éªŒè¯Token
        String token = request.getHeader("Authorization");
        if (StringUtils.isEmpty(token)) {
            response.setStatus(401);
            return false;
        }

        try {
            StpUtil.checkLogin();
            return true;
        } catch (NotLoginException e) {
            response.setStatus(401);
            return false;
        }
    }
}
```

#### 2.2 æ•°æ®æƒé™

**æ•°æ®æƒé™æ³¨è§£**:
```java
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface DataScope {

    /**
     * æ•°æ®æƒé™ç±»å‹
     */
    DataScopeType type() default DataScopeType.ALL;

    /**
     * æ•°æ®æƒé™å­—æ®µ
     */
    String field() default "create_user_id";

    /**
     * æ•°æ®æƒé™å€¼
     */
    String value() default "";
}

public enum DataScopeType {
    ALL,        // å…¨éƒ¨æ•°æ®
    DEPARTMENT, // éƒ¨é—¨æ•°æ®
    SELF,       // ä¸ªäººæ•°æ®
    CUSTOM      // è‡ªå®šä¹‰æ•°æ®
}
```

**æ•°æ®æƒé™åˆ‡é¢**:
```java
@Aspect
@Component
public class DataScopeAspect {

    @Around("@annotation(dataScope)")
    public Object around(ProceedingJoinPoint point, DataScope dataScope) throws Throwable {
        // è·å–å½“å‰ç”¨æˆ·
        User user = SecurityUtil.getCurrentUser();

        // æ ¹æ®æ•°æ®æƒé™ç±»å‹æ„å»ºæŸ¥è¯¢æ¡ä»¶
        Object[] args = point.getArgs();
        if (args.length > 0 && args[0] instanceof BaseQuery) {
            BaseQuery query = (BaseQuery) args[0];

            switch (dataScope.type()) {
                case ALL:
                    // ä¸åšé™åˆ¶
                    break;
                case DEPARTMENT:
                    query.addDataScope(dataScope.field(), user.getDepartmentId());
                    break;
                case SELF:
                    query.addDataScope(dataScope.field(), user.getUserId());
                    break;
                case CUSTOM:
                    query.addDataScope(dataScope.field(), dataScope.value());
                    break;
            }
        }

        return point.proceed(args);
    }
}
```

### 3. æ•°æ®å®‰å…¨

#### 3.1 æ•æ„Ÿæ•°æ®åŠ å¯†

**åŠ å¯†å·¥å…·ç±»**:
```java
@Component
public class DataEncryptionUtil {

    private static final String AES_KEY = "your-aes-key";
    private static final String AES_IV = "your-aes-iv";

    /**
     * AESåŠ å¯†
     */
    public static String encrypt(String plainText) {
        try {
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            SecretKeySpec keySpec = new SecretKeySpec(AES_KEY.getBytes(), "AES");
            IvParameterSpec ivSpec = new IvParameterSpec(AES_IV.getBytes());
            cipher.init(Cipher.ENCRYPT_MODE, keySpec, ivSpec);
            byte[] encrypted = cipher.doFinal(plainText.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }

    /**
     * AESè§£å¯†
     */
    public static String decrypt(String encryptedText) {
        try {
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            SecretKeySpec keySpec = new SecretKeySpec(AES_KEY.getBytes(), "AES");
            IvParameterSpec ivSpec = new IvParameterSpec(AESIV.getBytes());
            cipher.init(Cipher.DECRYPT_MODE, keySpec, ivSpec);
            byte[] encrypted = Base64.getDecoder().decode(encryptedText);
            byte[] decrypted = cipher.doFinal(encrypted);
            return new String(decrypted);
        } catch (Exception e) {
            throw new RuntimeException("è§£å¯†å¤±è´¥", e);
        }
    }
}
```

**æ•°æ®è„±æ•**:
```java
@Component
public class DataMaskingUtil {

    /**
     * æ‰‹æœºå·è„±æ•
     */
    public static String maskPhone(String phone) {
        if (StringUtils.isEmpty(phone) || phone.length() < 11) {
            return phone;
        }
        return phone.replaceAll("(\\d{3})\\d{4}(\\d{4})", "$1****$2");
    }

    /**
     * é‚®ç®±è„±æ•
     */
    public static String maskEmail(String email) {
        if (StringUtils.isEmpty(email) || !email.contains("@")) {
            return email;
        }
        String[] parts = email.split("@");
        String username = parts[0];
        if (username.length() <= 2) {
            return email;
        }
        return username.substring(0, 2) + "****@" + parts[1];
    }

    /**
     * èº«ä»½è¯å·è„±æ•
     */
    public static String maskIdCard(String idCard) {
        if (StringUtils.isEmpty(idCard) || idCard.length() < 18) {
            return idCard;
        }
        return idCard.replaceAll("(\\d{6})\\d{8}(\\d{4})", "$1********$2");
    }
}
```

---

## ğŸ“Š ç›‘æ§æ¶æ„è®¾è®¡

### 1. åº”ç”¨ç›‘æ§

#### 1.1 Prometheusé›†æˆ

**Micrometeré…ç½®**:
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: ${SPRING_PROFILES_ACTIVE:dev}
```

**è‡ªå®šä¹‰æŒ‡æ ‡**:
```java
@Component
public class AccessMetrics {

    private final Counter accessRequestCounter;
    private final Timer accessResponseTimer;
    private final Gauge deviceOnlineGauge;

    public AccessMetrics(MeterRegistry meterRegistry) {
        this.accessRequestCounter = Counter.builder("access_requests_total")
            .description("é—¨ç¦è¯·æ±‚æ€»æ•°")
            .tag("service", "access-service")
            .register(meterRegistry);

        this.accessResponseTimer = Timer.builder("access_response_duration")
            .description("é—¨ç¦å“åº”æ—¶é—´")
            .tag("service", "access-service")
            .register(meterRegistry);

        this.deviceOnlineGauge = Gauge.builder("access_devices_online")
            .description("åœ¨çº¿è®¾å¤‡æ•°é‡")
            .tag("service", "access-service")
            .register(meterRegistry, this, AccessMetrics::getOnlineDeviceCount);
    }

    public void recordAccessRequest(String result) {
        accessRequestCounter.increment(Tags.of("result", result));
    }

    public void recordAccessResponse(Duration duration) {
        accessResponseTimer.record(duration);
    }

    private double getOnlineDeviceCount() {
        return deviceService.getOnlineDeviceCount();
    }
}
```

#### 1.2 Grafanaä»ªè¡¨æ¿

**é—¨ç¦æœåŠ¡ä»ªè¡¨æ¿é…ç½®**:
```json
{
  "dashboard": {
    "title": "IOE-DREAM é—¨ç¦æœåŠ¡ç›‘æ§",
    "panels": [
      {
        "title": "è¯·æ±‚QPS",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(access_requests_total[5m])",
            "legendFormat": "QPS"
          }
        ]
      },
      {
        "title": "å“åº”æ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(access_response_duration_bucket[5m]))",
            "legendFormat": "P95å“åº”æ—¶é—´"
          },
          {
            "expr": "histogram_quantile(0.99, rate(access_response_duration_bucket[5m]))",
            "legendFormat": "P99å“åº”æ—¶é—´"
          }
        ]
      },
      {
        "title": "åœ¨çº¿è®¾å¤‡æ•°",
        "type": "singlestat",
        "targets": [
          {
            "expr": "access_devices_online",
            "legendFormat": "åœ¨çº¿è®¾å¤‡"
          }
        ]
      },
      {
        "title": "é”™è¯¯ç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(access_requests_total{result=\"error\"}[5m]) / rate(access_requests_total[5m])",
            "legendFormat": "é”™è¯¯ç‡"
          }
        ]
      }
    ]
  }
}
```

### 2. é“¾è·¯è¿½è¸ª

#### 2.1 Jaegeré›†æˆ

**Jaegeré…ç½®**:
```yaml
opentracing:
  jaeger:
    service-name: ${spring.application.name}
    sender:
      type: web
      endpoint: http://jaeger-collector:14268/api/traces
    sampler:
      type: const
      param: 1
```

**é“¾è·¯è¿½è¸ªä½¿ç”¨**:
```java
@RestController
public class AccessController {

    @GetMapping("/access/records")
    public Response<List<AccessRecordVO>> getAccessRecords(@RequestParam Long deviceId) {
        return accessService.getAccessRecords(deviceId);
    }
}

@Service
public class AccessServiceImpl implements AccessService {

    @NewSpan("get-access-records")
    public List<AccessRecordVO> getAccessRecords(@SpanTag("deviceId") Long deviceId) {
        // æŸ¥è¯¢é—¨ç¦è®°å½•
        List<AccessRecord> records = accessRecordDao.selectByDeviceId(deviceId);

        // è½¬æ¢ä¸ºVO
        return records.stream()
            .map(this::convertToVO)
            .collect(Collectors.toList());
    }
}
```

### 3. æ—¥å¿—ç›‘æ§

#### 3.1 ç»“æ„åŒ–æ—¥å¿—

**Logbacké…ç½®**:
```xml
<configuration>
    <springProfile name="!local">
        <appender name="JSON_CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
                <providers>
                    <timestamp/>
                    <logLevel/>
                    <loggerName/>
                    <mdc/>
                    <arguments/>
                    <stackTrace/>
                    <message/>
                </providers>
            </encoder>
        </appender>

        <root level="INFO">
            <appender-ref ref="JSON_CONSOLE"/>
        </root>
    </springProfile>
</configuration>
```

**MDCä¸Šä¸‹æ–‡**:
```java
@Component
public class LogMdcFilter implements Filter {

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest httpRequest = (HttpServletRequest) request;

        try {
            // æ·»åŠ è¯·æ±‚ç›¸å…³ä¿¡æ¯åˆ°MDC
            MDC.put("requestId", UUID.randomUUID().toString());
            MDC.put("userId", SecurityUtil.getCurrentUserId());
            MDC.put("userAgent", httpRequest.getHeader("User-Agent"));
            MDC.put("clientIp", getClientIp(httpRequest));
            MDC.put("uri", httpRequest.getRequestURI());
            MDC.put("method", httpRequest.getMethod());

            chain.doFilter(request, response);
        } finally {
            MDC.clear();
        }
    }
}
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„è®¾è®¡

### 1. å®¹å™¨åŒ–éƒ¨ç½²

#### 1.1 Dockeré•œåƒæ„å»º

**Dockerfile**:
```dockerfile
FROM openjdk:17-jre-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY target/ioedream-access-service.jar app.jar

# åˆ›å»ºåº”ç”¨ç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser

# è®¾ç½®JVMå‚æ•°
ENV JAVA_OPTS="-Xms512m -Xmx1024m -XX:+UseG1GC -XX:+UseContainerSupport"

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8102/actuator/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8102

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

#### 1.2 Kuberneteséƒ¨ç½²

**Deploymenté…ç½®**:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ioedream-access-service
  namespace: ioedream
  labels:
    app: ioedream-access-service
    version: v1.0.0
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: ioedream-access-service
  template:
    metadata:
      labels:
        app: ioedream-access-service
        version: v1.0.0
    spec:
      containers:
      - name: ioedream-access-service
        image: ioedream/access-service:v1.0.0
        ports:
        - containerPort: 8102
          name: http
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: CONSUL_HOST
          value: "consul-service"
        - name: DB_HOST
          value: "mysql-access-service"
        - name: REDIS_HOST
          value: "redis-service"
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health/liveness
            port: 8102
          initialDelaySeconds: 60
          periodSeconds: 30
          timeoutSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8102
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
        volumeMounts:
        - name: config-volume
          mountPath: /app/config
          readOnly: true
      volumes:
      - name: config-volume
        configMap:
          name: ioedream-access-config
```

**Serviceé…ç½®**:
```yaml
apiVersion: v1
kind: Service
metadata:
  name: ioedream-access-service
  namespace: ioedream
  labels:
    app: ioedream-access-service
spec:
  type: ClusterIP
  ports:
  - port: 8102
    targetPort: 8102
    protocol: TCP
    name: http
  selector:
    app: ioedream-access-service
```

### 2. é«˜å¯ç”¨éƒ¨ç½²

#### 2.1 å¤šå‰¯æœ¬éƒ¨ç½²

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ioedream-access-service
spec:
  replicas: 3  # 3ä¸ªå‰¯æœ¬ï¼Œä¿è¯é«˜å¯ç”¨
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1      # æ»šåŠ¨æ›´æ–°æ—¶æœ€å¤šå¢åŠ 1ä¸ªPod
      maxUnavailable: 0  # æ»šåŠ¨æ›´æ–°æ—¶æœ€å¤š0ä¸ªPodä¸å¯ç”¨
```

#### 2.2 åäº²å’Œæ€§éƒ¨ç½²

```yaml
spec:
  template:
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - ioedream-access-service
              topologyKey: kubernetes.io/hostname
```

### 3. è‡ªåŠ¨æ‰©ç¼©å®¹

#### 3.1 HPAé…ç½®

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: ioedream-access-service-hpa
  namespace: ioedream
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: ioedream-access-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
      - type: Percent
        value: 100
        periodSeconds: 15
      - type: Pods
        value: 4
        periodSeconds: 15
      selectPolicy: Max
```

---

## ğŸ“š æœ€ä½³å®è·µ

### 1. å¼€å‘æœ€ä½³å®è·µ

#### 1.1 ä»£ç è§„èŒƒ
- ç»Ÿä¸€ä½¿ç”¨Alibaba Javaç¼–ç è§„èŒƒ
- ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£

#### 1.2 APIè®¾è®¡
- éµå¾ªRESTful APIè®¾è®¡è§„èŒƒ
- ç»Ÿä¸€çš„å“åº”æ ¼å¼
- å®Œå–„çš„é”™è¯¯ç å®šä¹‰
- è¯¦ç»†çš„APIæ–‡æ¡£

#### 1.3 æ•°æ®åº“è®¾è®¡
- ç»Ÿä¸€çš„å‘½åè§„èŒƒ
- åˆç†çš„ç´¢å¼•è®¾è®¡
- å¿…è¦çš„å®¡è®¡å­—æ®µ
- è½¯åˆ é™¤ç­–ç•¥

### 2. è¿ç»´æœ€ä½³å®è·µ

#### 2.1 ç›‘æ§å‘Šè­¦
- å…¨é“¾è·¯ç›‘æ§è¦†ç›–
- åˆç†çš„å‘Šè­¦é˜ˆå€¼
- å¤šçº§å‘Šè­¦æœºåˆ¶
- è‡ªåŠ¨åŒ–æ•…éšœå¤„ç†

#### 2.2 æ—¥å¿—ç®¡ç†
- ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- ç»Ÿä¸€æ—¥å¿—æ”¶é›†
- æ—¥å¿—åˆ†çº§ç®¡ç†
- æ•æ„Ÿä¿¡æ¯è„±æ•

#### 2.3 å®‰å…¨é˜²æŠ¤
- å¤šå±‚å®‰å…¨é˜²æŠ¤
- å®šæœŸå®‰å…¨æ‰«æ
- æƒé™æœ€å°åŒ–åŸåˆ™
- å®‰å…¨å®¡è®¡æœºåˆ¶

### 3. æ€§èƒ½ä¼˜åŒ–

#### 3.1 åº”ç”¨å±‚ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- å¼‚æ­¥å¤„ç†æœºåˆ¶
- è¿æ¥æ± è°ƒä¼˜

#### 3.2 åŸºç¡€è®¾æ–½ä¼˜åŒ–
- å®¹å™¨èµ„æºä¼˜åŒ–
- ç½‘ç»œé…ç½®ä¼˜åŒ–
- å­˜å‚¨æ€§èƒ½ä¼˜åŒ–
- è´Ÿè½½å‡è¡¡ä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´11æœˆ29æ—¥
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ29æ—¥
**æ–‡æ¡£çŠ¶æ€**: å·²å®Œæˆ

**æ³¨æ„äº‹é¡¹**:
1. æœ¬æ–‡æ¡£æ˜¯IOE-DREAMå¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£
2. æ¶æ„è®¾è®¡éµå¾ªå¾®æœåŠ¡æœ€ä½³å®è·µ
3. æŠ€æœ¯é€‰å‹è€ƒè™‘äº†æˆç†Ÿåº¦å’Œå¯ç»´æŠ¤æ€§
4. å®‰å…¨è®¾è®¡é‡‡ç”¨å¤šå±‚é˜²æŠ¤ç­–ç•¥
5. ç›‘æ§ä½“ç³»è¦†ç›–å…¨é“¾è·¯è¿½è¸ª