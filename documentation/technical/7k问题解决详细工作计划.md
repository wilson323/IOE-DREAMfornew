# 7k问题解决详细工作计划

> **📋 制定时间**: 2025-11-19  
> **📋 基于文档**: 全局项目问题深度分析报告-7k问题根源分析.md  
> **📋 规范依据**: `.qoder/repowiki` 下的所有规范文档（强制遵循）  
> **📋 执行状态**: 🟢 立即执行中

---

## 🔒 规范遵循要求（最高优先级）

### 必须严格遵循的repowiki规范

1. **四层架构规范**（`.qoder/repowiki/zh/content/后端架构/四层架构详解/`）
   - Controller → Service → Manager → DAO 严格调用链
   - Controller层：接收HTTP请求，参数校验，调用Service
   - Service层：业务逻辑处理，事务管理
   - Manager层：复杂业务逻辑封装，跨模块调用
   - DAO层：数据访问，使用MyBatis-Plus

2. **依赖注入规范**（`.qoder/repowiki/zh/content/开发指南.md`）
   - ✅ 必须使用 `@Resource`，禁止使用 `@Autowired`
   - ✅ 所有生产代码必须符合此规范

3. **实体类设计规范**（`.qoder/repowiki/zh/content/后端架构/数据模型与ORM/实体类设计规范/`）
   - ✅ 必须继承 `BaseEntity`（`net.lab1024.sa.base.common.entity.BaseEntity`）
   - ✅ 禁止重复定义审计字段（createTime, updateTime, createUserId, updateUserId, deletedFlag, version）
   - ✅ 使用 `@TableField(fill = FieldFill.INSERT)` 等注解

4. **数据库设计规范**（`.qoder/repowiki/zh/content/后端架构/数据模型与ORM/数据库设计规范/`）
   - ✅ 表命名：`t_{business}_{entity}` 格式
   - ✅ 主键：`{table}_id` 格式，BIGINT AUTO_INCREMENT
   - ✅ 字符集：utf8mb4，存储引擎 InnoDB
   - ✅ 审计字段：必须包含 create_time, update_time, create_user_id, update_user_id, deleted_flag, version

5. **包名规范**（`.qoder/repowiki/zh/content/开发指南.md`）
   - ✅ Spring Boot 3.x 必须使用 `jakarta.*`，禁止使用 `javax.*`（除JDK标准库）
   - ✅ 允许保留：`javax.sql.*`、`javax.crypto.*` 等JDK标准库

6. **日志规范**（`.qoder/repowiki/zh/content/开发指南.md`）
   - ✅ 使用@Slf4j，禁止使用 System.out.println
   - ✅ 使用 `@Slf4j` 注解或手动创建 Logger

7. **命名规范**（`.qoder/repowiki/zh/content/后端架构/四层架构详解/`）
   - ✅ 包名：`net.lab1024.sa.{module}.{layer}`
   - ✅ 类名：Controller→{Module}Controller, Service→{Module}Service, Manager→{Module}Manager, DAO→{Module}Dao
   - ✅ 方法名：查询→get/query/find/list, 新增→add/create/save, 修改→update/edit, 删除→delete/remove

---

## 📊 一、问题总览

### 1.1 问题统计
- **编译错误**: 380个（🔴 P0 - 阻塞运行）
- **TODO/FIXME/BUG标记**: 1,907个
  - P0级阻塞性TODO: 2个
  - P1级高优先级TODO: 18+个
  - P2级中优先级TODO: 10+个
  - P3级低优先级TODO: 247+个
  - 其他TODO: 1,630+个
- **文档待办**: 356+个
- **代码质量问题**: 估算数千个（代码异味、规范问题等）

**总计**: 约2,977+个直接问题，7k问题可能来自代码质量扫描工具综合报告

---

## 🎯 二、执行策略

### 2.1 优先级矩阵

| 优先级 | 问题类型 | 数量 | 影响 | 修复难度 | 预计时间 | 执行阶段 |
|--------|---------|------|------|---------|---------|---------|
| 🔴 P0 | 编译错误 | 380 | 阻塞运行 | 中等 | 5-7天 | 立即执行 |
| 🔴 P0 | 阻塞性TODO | 2 | 阻塞功能 | 简单 | 1天 | 立即执行 |
| 🟡 P1 | 高优先级TODO | 18+ | 影响功能 | 中等 | 25天 | 短期执行 |
| 🟡 P2 | 中优先级TODO | 10+ | 影响体验 | 中等 | 15天 | 中期执行 |
| 🟢 P3 | 低优先级TODO | 247+ | 优化项 | 简单 | 按需 | 长期执行 |
| 🟢 其他 | 代码质量 | 1,320+ | 长期影响 | 复杂 | 持续 | 持续优化 |

---

## 🚀 三、详细执行计划

### 阶段1: 立即执行（本周内完成）

#### 任务1.1: 修复编译错误（380个）
**目标**: 将编译错误从380个降至0个

**执行步骤**:
1. **编译错误分类统计**（1小时）
   - 按错误类型分类：cannot find symbol、package not found、duplicate method等
   - 按模块分类：sa-base、sa-admin、sa-support等
   - 生成详细错误清单

2. **sa-base模块修复**（2-3天）
   - 优先修复：~200个编译错误
   - 重点：包导入路径、类缺失、接口不匹配
   - 验证：每个修复后立即编译验证

3. **sa-admin模块修复**（2-3天）
   - 修复：~150个编译错误
   - 重点：业务模块相关错误
   - 验证：模块级编译验证

4. **sa-support模块修复**（1天）
   - 修复：~30个编译错误
   - 验证：完整编译验证

5. **全项目编译验证**（0.5天）
   - 确保所有模块编译通过
   - 生成编译验证报告

**验收标准**:
- ✅ 编译错误数量 = 0
- ✅ 所有模块编译通过
- ✅ 无新增编译错误
- ✅ **严格符合repowiki规范**（四层架构、依赖注入、实体类设计、数据库设计、包名、日志、命名）

#### 任务1.2: 修复P0级阻塞性TODO（2个）
**目标**: 修复阻塞功能的TODO标记

**执行步骤**:
1. **定位P0级TODO**（0.5小时）
   - 搜索所有P0级标记
   - 分析每个TODO的阻塞原因

2. **修复阻塞性问题**（0.5天）
   - 逐个修复P0级TODO
   - 验证修复效果

**验收标准**:
- ✅ P0级TODO数量 = 0
- ✅ 阻塞功能恢复正常

---

### 阶段2: 短期执行（2周内完成）

#### 任务2.1: 修复P1级高优先级TODO（18+个）
**目标**: 修复影响功能的高优先级TODO

**执行步骤**:
1. **P1级TODO清单**（1天）
   - 收集所有P1级TODO
   - 按模块和功能分类
   - 评估修复工作量

2. **分模块修复**（20天）
   - 消费管理模块：5+个
   - 考勤管理模块：3+个
   - 门禁管理模块：2+个
   - 视频监控模块：3+个
   - 其他模块：5+个

3. **功能验证**（2天）
   - 每个修复后进行功能验证
   - 确保不影响现有功能

**验收标准**:
- ✅ P1级TODO修复率 ≥ 90%
- ✅ 相关功能正常工作
- ✅ 无回归问题

#### 任务2.2: 代码规范修复
**目标**: 修复代码规范问题

**执行步骤**:
1. **javax包名修复**（0.5天）
   - 扫描剩余javax包使用
   - 批量替换为jakarta包
   - 验证编译通过

2. **依赖注入规范**（0.5天）
   - 检查@Autowired使用（应该为0）
   - 确保全部使用@Resource
   - 验证依赖注入正常

**验收标准**:
- ✅ javax包使用 = 0（除JDK标准库）
- ✅ @Autowired使用 = 0
- ✅ 代码规范100%符合

---

### 阶段3: 中期执行（1个月内完成）

#### 任务3.1: 修复P2级中优先级TODO（10+个）
**目标**: 修复影响用户体验的中优先级TODO

**执行步骤**:
1. **P2级TODO清单**（0.5天）
   - 收集所有P2级TODO
   - 评估修复优先级

2. **分批次修复**（12天）
   - 每周修复3-4个
   - 确保修复质量

3. **用户体验验证**（2.5天）
   - 验证修复后的用户体验
   - 收集反馈并优化

**验收标准**:
- ✅ P2级TODO修复率 ≥ 80%
- ✅ 用户体验改善
- ✅ 无功能回归

#### 任务3.2: 代码质量提升
**目标**: 降低代码复杂度，减少重复代码

**执行步骤**:
1. **代码复杂度分析**（2天）
   - 使用工具分析代码复杂度
   - 识别高复杂度方法

2. **重构高复杂度代码**（持续）
   - 拆分长方法
   - 简化复杂类
   - 提取重复代码

3. **代码规范检查**（持续）
   - 修复命名不规范
   - 补充缺失注释
   - 优化异常处理

**验收标准**:
- ✅ 代码复杂度降低20%
- ✅ 重复代码减少30%
- ✅ 代码规范符合率 ≥ 90%

---

### 阶段4: 长期执行（持续优化）

#### 任务4.1: 清理P3级低优先级TODO（247+个）
**目标**: 按需清理低优先级优化项

**执行策略**:
- 每周固定时间清理5-10个
- 优先清理容易修复的
- 定期评估TODO的有效性

#### 任务4.2: 测试覆盖率提升
**目标**: 测试覆盖率 ≥ 80%

**执行步骤**:
1. **测试覆盖率分析**（1周）
   - 生成覆盖率报告
   - 识别未覆盖代码

2. **补充测试用例**（持续）
   - 为核心业务逻辑补充测试
   - 提高关键路径覆盖率

3. **建立测试规范**（持续）
   - 新功能必须包含测试
   - 测试覆盖率要求 ≥ 80%

**验收标准**:
- ✅ 测试覆盖率 ≥ 80%
- ✅ 核心业务逻辑100%覆盖
- ✅ 测试规范建立并执行

---

## 📋 四、执行检查清单

### 4.1 每个任务执行前检查
- [ ] 已阅读相关规范文档
- [ ] 已理解任务目标和验收标准
- [ ] 已准备必要的工具和脚本
- [ ] 已备份相关代码

### 4.2 每个任务执行后验证
- [ ] 编译通过（如果是代码修复）
- [ ] 功能验证通过
- [ ] 无回归问题
- [ ] 代码规范符合
- [ ] 相关文档已更新

### 4.3 阶段完成验证
- [ ] 所有任务验收标准达成
- [ ] 生成阶段完成报告
- [ ] 更新问题统计
- [ ] 准备下一阶段工作

---

## 🔧 五、工具和脚本

### 5.1 编译错误修复工具
- `./scripts/quick-check.sh` - 快速检查脚本
- `./scripts/verify-encoding.sh` - 编码验证脚本
- `./scripts/enforce-standards.sh` - 规范检查脚本

### 5.2 TODO清理工具
- 全局搜索TODO标记
- 按优先级分类
- 生成清理清单

### 5.3 代码质量工具
- SonarQube（代码质量扫描）
- PMD/Checkstyle（代码规范检查）
- SpotBugs（潜在Bug检测）

---

## 📊 六、进度跟踪

### 6.1 每日进度报告
- 完成的任务数量
- 修复的问题数量
- 遇到的问题和解决方案
- 下一步计划

### 6.2 每周进度总结
- 阶段目标完成情况
- 问题统计更新
- 风险识别和应对
- 下周工作计划

---

## 🎯 七、成功标准

### 7.1 阶段1成功标准
- ✅ 编译错误 = 0
- ✅ P0级TODO = 0
- ✅ 项目可以正常编译运行

### 7.2 阶段2成功标准
- ✅ P1级TODO修复率 ≥ 90%
- ✅ 代码规范100%符合
- ✅ 核心功能正常工作

### 7.3 阶段3成功标准
- ✅ P2级TODO修复率 ≥ 80%
- ✅ 代码质量显著提升
- ✅ 用户体验改善

### 7.4 阶段4成功标准
- ✅ 建立持续优化机制
- ✅ 测试覆盖率 ≥ 80%
- ✅ 技术债务可控

---

## 📝 八、风险识别和应对

### 8.1 主要风险
1. **修复引入新问题**
   - 应对：每个修复后立即验证
   - 应对：建立回滚机制

2. **修复时间超出预期**
   - 应对：优先修复关键问题
   - 应对：合理评估工作量

3. **修复影响现有功能**
   - 应对：充分测试验证
   - 应对：保持向后兼容

### 8.2 应急预案
- 遇到阻塞性问题立即暂停并分析
- 重大问题及时上报并讨论解决方案
- 保持代码版本控制，便于回滚

---

**📋 计划制定时间**: 2025-11-19  
**📋 计划执行状态**: 🟢 立即开始执行  
**📋 下次更新**: 每日更新进度

