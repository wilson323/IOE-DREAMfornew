# è´¨é‡åº¦é‡ä½“ç³»ï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„è´¨é‡åº¦é‡ä½“ç³»ï¼Œæ•´åˆäº†v2è´¨é‡å·¥å…·ç²¾åï¼Œæä¾›å®Œæ•´çš„è´¨é‡è¯„ä¼°æ ‡å‡†ã€‚

## ğŸ“Š åº¦é‡ä½“ç³»æ¦‚è§ˆ

### åº¦é‡ç»´åº¦
```markdown
ğŸ” ä»£ç è´¨é‡: å¤æ‚åº¦ã€é‡å¤ç‡ã€è§„èŒƒç¬¦åˆåº¦
ğŸ§ª æµ‹è¯•è´¨é‡: è¦†ç›–ç‡ã€é€šè¿‡ç‡ã€æœ‰æ•ˆæ€§
ğŸš€ æ€§èƒ½æŒ‡æ ‡: å“åº”æ—¶é—´ã€ååé‡ã€èµ„æºä½¿ç”¨
ğŸ”’ å®‰å…¨æŒ‡æ ‡: æ¼æ´æ•°é‡ã€åˆè§„æ€§ã€é£é™©ç­‰çº§
ğŸ“ˆ ä¸šåŠ¡æŒ‡æ ‡: å¯ç”¨æ€§ã€ç¨³å®šæ€§ã€ç”¨æˆ·æ»¡æ„åº¦
```

### ç›®æ ‡å€¼è®¾å®š
```markdown
ğŸ¯ ä»£ç è¦†ç›–ç‡: â‰¥ 80%
ğŸ¯ æ ¸å¿ƒä¸šåŠ¡è¦†ç›–ç‡: 100%
ğŸ¯ ä»£ç é‡å¤ç‡: â‰¤ 3%
ğŸ¯ åœˆå¤æ‚åº¦: â‰¤ 10
ğŸ¯ æ¥å£å“åº”æ—¶é—´: P95 â‰¤ 200ms
ğŸ¯ ç³»ç»Ÿå¯ç”¨æ€§: â‰¥ 99.9%
ğŸ¯ å®‰å…¨æ¼æ´: 0ä¸ªé«˜å±
ğŸ¯ ç”¨æˆ·æ»¡æ„åº¦: â‰¥ 4.5/5
```

## ğŸ” ä»£ç è´¨é‡åº¦é‡

### åŸºç¡€ä»£ç æŒ‡æ ‡

#### å¤æ‚åº¦æŒ‡æ ‡
```java
// åœˆå¤æ‚åº¦è®¡ç®—ç¤ºä¾‹
public class ComplexityMetrics {

    // å¤æ‚åº¦: 1
    public void simpleMethod() {
        System.out.println("Simple method");
    }

    // å¤æ‚åº¦: 4 (1ä¸ªif + 2ä¸ªif-else + 1ä¸ªåŸºæœ¬è·¯å¾„)
    public int calculateScore(int score) {
        if (score >= 90) {           // +1
            return 100;
        } else if (score >= 80) {    // +1
            return 90;
        } else if (score >= 60) {    // +1
            return 80;
        } else {
            return 60;
        }
    }

    // å¤æ‚åº¦è¿‡é«˜ï¼Œéœ€è¦é‡æ„
    public void complexMethod(User user, Order order, Payment payment) {
        if (user != null) {                    // +1
            if (user.getStatus() == 1) {       // +1
                if (order != null) {           // +1
                    if (order.getAmount() > 0) { // +1
                        if (payment != null) {  // +1
                            if (payment.isValid()) { // +1
                                // å¤„ç†é€»è¾‘
                            }
                        }
                    }
                }
            }
        }
    }
}
```

#### ä»£ç é‡å¤ç‡æ£€æµ‹
```xml
<!-- PMD CPDé…ç½® -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-pmd-plugin</artifactId>
    <version>3.19.0</version>
    <configuration>
        <minimumTokens>100</minimumTokens>
        <language>java</language>
        <targetJdk>17</targetJdk>
        <failOnViolation>true</failOnViolation>
        <verbose>true</verbose>
    </configuration>
    <executions>
        <execution>
            <goals>
                <goal>cpd-check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

#### ä»£ç è§„èŒƒç¬¦åˆåº¦
```java
// è§„èŒƒæ£€æŸ¥å·¥å…·é…ç½®
public class CodeStyleMetrics {

    // 1. ä¾èµ–æ³¨å…¥è§„èŒƒæ£€æŸ¥
    @Resource // âœ… æ­£ç¡®
    private UserService userService;

    @Autowired // âŒ é”™è¯¯ï¼Œç¦æ­¢ä½¿ç”¨
    private OrderService orderService;

    // 2. å‘½åè§„èŒƒæ£€æŸ¥
    public class UserController { // âœ… æ­£ç¡®
        private Long userId;       // âœ… æ­£ç¡®
        private String user_name; // âŒ é”™è¯¯ï¼Œåº”è¯¥æ˜¯userName
    }

    // 3. æ¶æ„åˆ†å±‚æ£€æŸ¥
    @RestController
    public class UserController {
        @Resource
        private UserDao userDao; // âŒ é”™è¯¯ï¼ŒControllerä¸èƒ½ç›´æ¥è®¿é—®Dao
    }
}
```

### è´¨é‡è¯„åˆ†æ ‡å‡†
```markdown
ä¼˜ç§€ (90-100åˆ†):
- ä»£ç è¦†ç›–ç‡ â‰¥ 90%
- é‡å¤ç‡ â‰¤ 1%
- åœˆå¤æ‚åº¦ â‰¤ 5
- è§„èŒƒç¬¦åˆåº¦ â‰¥ 95%

è‰¯å¥½ (80-89åˆ†):
- ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- é‡å¤ç‡ â‰¤ 3%
- åœˆå¤æ‚åº¦ â‰¤ 8
- è§„èŒƒç¬¦åˆåº¦ â‰¥ 85%

åˆæ ¼ (70-79åˆ†):
- ä»£ç è¦†ç›–ç‡ â‰¥ 70%
- é‡å¤ç‡ â‰¤ 5%
- åœˆå¤æ‚åº¦ â‰¤ 10
- è§„èŒƒç¬¦åˆåº¦ â‰¥ 75%

ä¸åˆæ ¼ (< 70åˆ†):
- ä»»ä¸€æŒ‡æ ‡æœªè¾¾åˆ°åˆæ ¼æ ‡å‡†
```

## ğŸ§ª æµ‹è¯•è´¨é‡åº¦é‡

### æµ‹è¯•è¦†ç›–ç‡æŒ‡æ ‡
```xml
<!-- JaCoCoé…ç½® -->
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.8</version>
    <configuration>
        <rules>
            <rule>
                <element>BUNDLE</element>
                <limits>
                    <limit>
                        <counter>INSTRUCTION</counter>
                        <value>COVEREDRATIO</value>
                        <minimum>0.80</minimum>
                    </limit>
                </limits>
            </rule>
        </rules>
    </configuration>
</plugin>
```

### æµ‹è¯•æœ‰æ•ˆæ€§æŒ‡æ ‡
```java
// æµ‹è¯•è´¨é‡æ£€æŸ¥ç¤ºä¾‹
@TestMethodOrder(OrderAnnotation.class)
class UserServiceTest {

    @Test
    @Order(1)
    void testAddUser_Success() {
        // Given
        UserAddForm form = new UserAddForm();
        form.setUserName("testuser");
        form.setEmail("test@example.com");

        // When
        String userId = userService.add(form);

        // Then
        assertNotNull(userId);
        UserVO user = userService.detail(Long.parseLong(userId));
        assertEquals("testuser", user.getUserName());
    }

    @Test
    @Order(2)
    void testAddUser_DuplicateName_ThrowsException() {
        // Given
        UserAddForm form = new UserAddForm();
        form.setUserName("existinguser");

        // When & Then
        assertThrows(BusinessException.class, () -> {
            userService.add(form);
        });
    }
}
```

### æµ‹è¯•è´¨é‡è¯„åˆ†
```markdown
æµ‹è¯•è¦†ç›–ç‡è¯„åˆ†:
- 100%: 100åˆ†
- 95-99%: 95åˆ†
- 90-94%: 90åˆ†
- 85-89%: 85åˆ†
- 80-84%: 80åˆ†
- < 80%: 0åˆ†

æµ‹è¯•æœ‰æ•ˆæ€§è¯„åˆ†:
- æ‰€æœ‰æµ‹è¯•é€šè¿‡: 100åˆ†
- 90-99%é€šè¿‡: 90åˆ†
- 80-89%é€šè¿‡: 80åˆ†
- < 80%é€šè¿‡: 0åˆ†
```

## ğŸš€ æ€§èƒ½æŒ‡æ ‡åº¦é‡

### å“åº”æ—¶é—´æŒ‡æ ‡
```java
// æ€§èƒ½ç›‘æ§æ³¨è§£
@RestController
public class PerformanceController {

    @Timed(value = "api.request.time", description = "APIè¯·æ±‚è€—æ—¶")
    @Counter(value = "api.request.count", description = "APIè¯·æ±‚æ¬¡æ•°")
    @GetMapping("/performance/test")
    public ResponseDTO<String> performanceTest() {
        return ResponseDTO.ok("Performance test");
    }

    // è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œ
    public void collectMetrics() {
        // æ”¶é›†å„ç§æ€§èƒ½æŒ‡æ ‡
        collectResponseTimeMetrics();
        collectMemoryMetrics();
        collectDatabaseMetrics();
    }
}
```

### èµ„æºä½¿ç”¨æŒ‡æ ‡
```java
// JVMç›‘æ§
@Component
public class JVMMetrics {

    private final MeterRegistry meterRegistry;

    public JVMMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        registerJvmMetrics();
    }

    private void registerJvmMetrics() {
        // å†…å­˜ä½¿ç”¨é‡
        Gauge.builder("jvm.memory.used")
                .register(meterRegistry, this, JVMMetrics::getUsedMemory);

        // CPUä½¿ç”¨ç‡
        Gauge.builder("system.cpu.usage")
                .register(meterRegistry, this, JVMMetrics::getCpuUsage);

        // GCæ¬¡æ•°
        Counter.builder("jvm.gc.pause")
                .register(meterRegistry);
    }

    private double getUsedMemory() {
        MemoryMXBean memoryBean = ManagementFactory.getMemoryMXBean();
        MemoryUsage heapUsage = memoryBean.getHeapMemoryUsage();
        return heapUsage.getUsed();
    }

    private double getCpuUsage() {
        OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();
        return osBean.getProcessCpuLoad();
    }
}
```

### æ€§èƒ½è¯„åˆ†æ ‡å‡†
```markdown
å“åº”æ—¶é—´è¯„åˆ†:
- P95 â‰¤ 100ms: 100åˆ†
- P95 â‰¤ 200ms: 90åˆ†
- P95 â‰¤ 500ms: 80åˆ†
- P95 â‰¤ 1000ms: 70åˆ†
- P95 > 1000ms: 0åˆ†

ååé‡è¯„åˆ†:
- QPS â‰¥ 1000: 100åˆ†
- QPS â‰¥ 500: 90åˆ†
- QPS â‰¥ 200: 80åˆ†
- QPS â‰¥ 100: 70åˆ†
- QPS < 100: 0åˆ†
```

## ğŸ”’ å®‰å…¨æŒ‡æ ‡åº¦é‡

### å®‰å…¨æ¼æ´æ‰«æ
```xml
<!-- OWASPä¾èµ–æ£€æŸ¥ -->
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <version>8.4.0</version>
    <configuration>
        <failBuildOnCVSS>7.0</failBuildOnCVSS>
        <skipProvidedScope>true</skipProvidedScope>
    </configuration>
    <executions>
        <execution>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

### å®‰å…¨åˆè§„æ£€æŸ¥
```java
// å®‰å…¨æ£€æŸ¥å·¥å…·
@Component
public class SecurityChecker {

    public SecurityReport checkSecurity() {
        SecurityReport report = new SecurityReport();

        // 1. æ£€æŸ¥SQLæ³¨å…¥é˜²æŠ¤
        report.setSqlInjectionProtection(checkSqlInjectionProtection());

        // 2. æ£€æŸ¥XSSé˜²æŠ¤
        report.setXssProtection(checkXssProtection());

        // 3. æ£€æŸ¥å¯†ç åŠ å¯†
        report.setPasswordEncryption(checkPasswordEncryption());

        // 4. æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ³„éœ²
        report.setSensitiveInfoLeakage(checkSensitiveInfoLeakage());

        return report;
    }

    private boolean checkSqlInjectionProtection() {
        // æ£€æŸ¥æ‰€æœ‰SQLè¯­å¥æ˜¯å¦ä½¿ç”¨é¢„ç¼–è¯‘
        // æ£€æŸ¥MyBatisæ˜ å°„æ–‡ä»¶æ˜¯å¦ä½¿ç”¨#{}å ä½ç¬¦
        return true; // ç®€åŒ–ç¤ºä¾‹
    }
}
```

### å®‰å…¨è¯„åˆ†æ ‡å‡†
```markdown
å®‰å…¨æ¼æ´è¯„åˆ†:
- 0ä¸ªé«˜å±æ¼æ´: 100åˆ†
- 1ä¸ªé«˜å±æ¼æ´: 0åˆ†
- 1-3ä¸ªä¸­å±æ¼æ´: 80åˆ†
- 4-6ä¸ªä¸­å±æ¼æ´: 60åˆ†
- >6ä¸ªä¸­å±æ¼æ´: 0åˆ†

å®‰å…¨é…ç½®è¯„åˆ†:
- å®Œæ•´é…ç½®HTTPS: 30åˆ†
- å®ç°CSRFé˜²æŠ¤: 20åˆ†
- é…ç½®å®‰å…¨å¤´éƒ¨: 20åˆ†
- å¯†ç ç­–ç•¥åˆç†: 20åˆ†
- å®¡è®¡æ—¥å¿—å®Œæ•´: 10åˆ†
```

## ğŸ“ˆ ç»¼åˆè´¨é‡è¯„åˆ†

### è¯„åˆ†æƒé‡åˆ†é…
```markdown
ä»£ç è´¨é‡: 30%
- ä»£ç è¦†ç›–ç‡: 10%
- ä»£ç å¤æ‚åº¦: 8%
- ä»£ç é‡å¤ç‡: 7%
- è§„èŒƒç¬¦åˆåº¦: 5%

æµ‹è¯•è´¨é‡: 25%
- æµ‹è¯•è¦†ç›–ç‡: 15%
- æµ‹è¯•æœ‰æ•ˆæ€§: 10%

æ€§èƒ½æŒ‡æ ‡: 25%
- å“åº”æ—¶é—´: 15%
- èµ„æºä½¿ç”¨: 10%

å®‰å…¨æŒ‡æ ‡: 20%
- å®‰å…¨æ¼æ´: 15%
- å®‰å…¨é…ç½®: 5%
```

### ç»¼åˆè¯„åˆ†è®¡ç®—
```java
@Component
public class QualityScoreCalculator {

    public QualityScore calculateOverallScore(CodeQualityMetrics codeMetrics,
                                             TestQualityMetrics testMetrics,
                                             PerformanceMetrics performanceMetrics,
                                             SecurityMetrics securityMetrics) {
        QualityScore score = new QualityScore();

        // ä»£ç è´¨é‡å¾—åˆ† (30%)
        double codeScore = calculateCodeScore(codeMetrics) * 0.3;

        // æµ‹è¯•è´¨é‡å¾—åˆ† (25%)
        double testScore = calculateTestScore(testMetrics) * 0.25;

        // æ€§èƒ½å¾—åˆ† (25%)
        double performanceScore = calculatePerformanceScore(performanceMetrics) * 0.25;

        // å®‰å…¨å¾—åˆ† (20%)
        double securityScore = calculateSecurityScore(securityMetrics) * 0.2;

        // ç»¼åˆå¾—åˆ†
        double overallScore = codeScore + testScore + performanceScore + securityScore;

        score.setOverallScore(Math.round(overallScore * 100) / 100.0);
        score.setGrade(determineGrade(overallScore));
        score.setCodeScore(Math.round(codeScore * 100) / 100.0);
        score.setTestScore(Math.round(testScore * 100) / 100.0);
        score.setPerformanceScore(Math.round(performanceScore * 100) / 100.0);
        score.setSecurityScore(Math.round(securityScore * 100) / 100.0);

        return score;
    }

    private String determineGrade(double score) {
        if (score >= 90) return "ä¼˜ç§€";
        if (score >= 80) return "è‰¯å¥½";
        if (score >= 70) return "åˆæ ¼";
        return "ä¸åˆæ ¼";
    }
}
```

### è´¨é‡è¶‹åŠ¿åˆ†æ
```java
// è´¨é‡è¶‹åŠ¿ç›‘æ§
@Component
public class QualityTrendAnalyzer {

    @Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
    public void analyzeQualityTrend() {
        // 1. æ”¶é›†æœ€è¿‘30å¤©çš„è´¨é‡æ•°æ®
        List<QualitySnapshot> snapshots = qualityRepository.findLast30Days();

        // 2. åˆ†æè¶‹åŠ¿
        QualityTrend trend = analyzeTrend(snapshots);

        // 3. ç”ŸæˆæŠ¥å‘Š
        QualityReport report = generateReport(trend);

        // 4. å‘é€é€šçŸ¥
        if (trend.getOverallTrend() < 0) {
            alertService.sendQualityAlert("è´¨é‡å‘ˆä¸‹é™è¶‹åŠ¿ï¼Œéœ€è¦å…³æ³¨", report);
        }

        // 5. ä¿å­˜åˆ†æç»“æœ
        qualityRepository.saveTrendAnalysis(trend);
    }
}
```

---

**ğŸ“‹ è´¨é‡åº¦é‡åŸåˆ™**ï¼š
1. **æ•°æ®é©±åŠ¨** - åŸºäºå®¢è§‚æ•°æ®è¿›è¡Œè¯„ä¼°
2. **æŒç»­ç›‘æ§** - å®æ—¶ç›‘æ§è´¨é‡æŒ‡æ ‡å˜åŒ–
3. **åŠæ—¶æ”¹è¿›** - å‘ç°é—®é¢˜åŠæ—¶é‡‡å–æªæ–½
4. **é€æ˜å…¬å¼€** - è´¨é‡æŒ‡æ ‡å¯¹å›¢é˜Ÿé€æ˜
5. **æŒç»­ä¼˜åŒ–** - æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–åº¦é‡æ ‡å‡†

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [ç¼–ç è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/ç¼–ç è§„èŒƒ.md) - ä»£ç æ ‡å‡†
- [æµ‹è¯•å®æ–½æŒ‡å—](../02-å®æ–½æŒ‡å—å±‚/æµ‹è¯•å®æ–½æŒ‡å—.md) - æµ‹è¯•æ ‡å‡†
- [å®‰å…¨è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/å®‰å…¨è§„èŒƒ.md) - å®‰å…¨æ ‡å‡†
- [æŒç»­æ”¹è¿›æœºåˆ¶](./æŒç»­æ”¹è¿›æœºåˆ¶.md) - æ”¹è¿›æµç¨‹