# æœ€ä½³å®è·µæ¡ˆä¾‹ï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„æœ€ä½³å®è·µæ¡ˆä¾‹åº“ï¼Œæ•´åˆäº†v1ã€v2ã€v3ç‰ˆæœ¬çš„å®é™…é¡¹ç›®ç»éªŒå’Œå…¸å‹åœºæ™¯ã€‚

## ğŸ“‹ æ¡ˆä¾‹æ¦‚è¿°

æœ¬æ–‡æ¡£æ”¶é›†äº†SmartAdminé¡¹ç›®åœ¨å®é™…åº”ç”¨ä¸­çš„æœ€ä½³å®è·µæ¡ˆä¾‹ï¼Œä¸ºå›¢é˜Ÿæä¾›å…·ä½“çš„å®æ–½å‚è€ƒå’Œç»éªŒåˆ†äº«ã€‚æ‰€æœ‰æ¡ˆä¾‹éƒ½ç»è¿‡å®é™…é¡¹ç›®éªŒè¯ï¼Œå…·æœ‰å¾ˆé«˜çš„å‚è€ƒä»·å€¼ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

### æ¡ˆä¾‹1: å¾®æœåŠ¡æ‹†åˆ†å®è·µ

#### èƒŒæ™¯æè¿°
æŸå¤§å‹ç”µå•†å¹³å°éœ€è¦ä»å•ä½“æ¶æ„è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„ï¼ŒåŒ…å«ç”¨æˆ·ã€å•†å“ã€è®¢å•ã€æ”¯ä»˜ã€åº“å­˜ç­‰æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ã€‚

#### å®æ–½æ–¹æ¡ˆ
```markdown
å¾®æœåŠ¡æ‹†åˆ†ç­–ç•¥:
1. æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†
   - ç”¨æˆ·æœåŠ¡: ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†
   - å•†å“æœåŠ¡: å•†å“ä¿¡æ¯ã€åˆ†ç±»ã€æœç´¢
   - è®¢å•æœåŠ¡: è®¢å•åˆ›å»ºã€çŠ¶æ€è·Ÿè¸ªã€æ”¯ä»˜é›†æˆ
   - åº“å­˜æœåŠ¡: åº“å­˜ç®¡ç†ã€é¢„è­¦ã€è¡¥è´§
   - æ”¯ä»˜æœåŠ¡: æ”¯ä»˜æµç¨‹ã€å¯¹è´¦ã€é€€æ¬¾

2. æ•°æ®åº“æ‹†åˆ†
   - æ¯ä¸ªæœåŠ¡ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹
   - é€šè¿‡ä¸šåŠ¡IDè¿›è¡Œæ•°æ®å…³è”
   - ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§ä¿è¯æ•°æ®ä¸€è‡´æ€§

3. æœåŠ¡é—´é€šä¿¡
   - åŒæ­¥è°ƒç”¨ä½¿ç”¨OpenFeign
   - å¼‚æ­¥é€šä¿¡ä½¿ç”¨RocketMQ
   - æœåŠ¡å‘ç°ä½¿ç”¨Nacos
```

#### å…³é”®ç»éªŒ
- **è¾¹ç•Œæ¸…æ™°**: ç¡®ä¿æ¯ä¸ªæœåŠ¡çš„ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°ï¼Œé¿å…æœåŠ¡é—´èŒè´£é‡å 
- **æ•°æ®ç‹¬ç«‹**: æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œé¿å…æ•°æ®è€¦åˆ
- **æ¸è¿›è¿ç§»**: é‡‡ç”¨ç»æ€è€…æ¨¡å¼é€æ­¥è¿ç§»ï¼Œé™ä½é£é™©
- **ç›‘æ§å®Œå–„**: å»ºç«‹å®Œæ•´çš„æœåŠ¡ç›‘æ§å’Œé“¾è·¯è¿½è¸ªä½“ç³»

#### å®ç°ä»£ç ç¤ºä¾‹
```java
// ç”¨æˆ·æœåŠ¡Controller
@RestController
@RequestMapping("/api/user")
@Tag(name = "ç”¨æˆ·ç®¡ç†")
public class UserController {

    @Resource
    private UserService userService;

    @Resource
    private OrderService orderService; // é€šè¿‡Feignè°ƒç”¨

    @PostMapping("/register")
    public ResponseDTO<String> register(@RequestBody @Valid UserRegisterForm form) {
        // 1. ç”¨æˆ·æ³¨å†Œ
        String userId = userService.register(form);

        // 2. å¼‚æ­¥å‘é€æ¬¢è¿æ¶ˆæ¯
        eventPublisher.publishEvent(new UserRegisteredEvent(userId));

        return ResponseDTO.ok(userId);
    }

    @GetMapping("/{userId}/orders")
    public ResponseDTO<List<OrderVO>> getUserOrders(@PathVariable Long userId) {
        // è·¨æœåŠ¡è°ƒç”¨
        return ResponseDTO.ok(orderService.getOrdersByUserId(userId));
    }
}

// æœåŠ¡é—´è°ƒç”¨é…ç½®
@FeignClient(name = "order-service", path = "/api/order")
public interface OrderService {

    @GetMapping("/user/{userId}")
    List<OrderVO> getOrdersByUserId(@PathVariable Long userId);
}
```

### æ¡ˆä¾‹2: é«˜å¹¶å‘æ¶æ„è®¾è®¡

#### èƒŒæ™¯æè¿°
æŸç”µå•†å¹³å°åœ¨ä¿ƒé”€æœŸé—´éœ€è¦æ”¯æŒ10ä¸‡+å¹¶å‘ç”¨æˆ·è®¿é—®ï¼Œç³»ç»Ÿå“åº”æ—¶é—´è¦æ±‚P95<500msã€‚

#### æ¶æ„æ–¹æ¡ˆ
```yaml
é«˜å¹¶å‘æ¶æ„è®¾è®¡:
  æ¥å…¥å±‚:
    - CDN: é™æ€èµ„æºåˆ†å‘
    - è´Ÿè½½å‡è¡¡: Nginxå¤šçº§è´Ÿè½½å‡è¡¡
    - é™æµ: ç½‘å…³å±‚é™æµæ§åˆ¶

  åº”ç”¨å±‚:
    - æœåŠ¡é›†ç¾¤: æ ¸å¿ƒæœåŠ¡å¤šå®ä¾‹éƒ¨ç½²
    - ç¼“å­˜ç­–ç•¥: å¤šçº§ç¼“å­˜æ¶æ„
    - å¼‚æ­¥å¤„ç†: æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦

  æ•°æ®å±‚:
    - æ•°æ®åº“: è¯»å†™åˆ†ç¦» + åˆ†åº“åˆ†è¡¨
    - ç¼“å­˜: Redisé›†ç¾¤
    - æœç´¢: Elasticsearché›†ç¾¤

  ç›‘æ§å±‚:
    - å®æ—¶ç›‘æ§: Prometheus + Grafana
    - å‘Šè­¦ç³»ç»Ÿ: AlertManager
    - é“¾è·¯è¿½è¸ª: Jaeger
```

#### å…³é”®æŠ€æœ¯ç‚¹
```java
// ç¼“å­˜ä½¿ç”¨ç¤ºä¾‹
@Service
public class ProductServiceImpl implements ProductService {

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    @Resource
    private ProductDao productDao;

    @Cacheable(value = "product", key = "#id", unless = "#result == null")
    public ProductVO getProduct(Long id) {
        // 1. å…ˆä»ç¼“å­˜æŸ¥è¯¢
        ProductVO cached = (ProductVO) redisTemplate.opsForValue().get("product::" + id);
        if (cached != null) {
            return cached;
        }

        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        ProductEntity entity = productDao.selectById(id);
        if (entity == null) {
            return null;
        }

        // 3. è½¬æ¢å¹¶è¿”å›
        return ProductConverter.toVO(entity);
    }

    // ç¼“å­˜é¢„çƒ­
    @PostConstruct
    public void preloadCache() {
        List<ProductEntity> hotProducts = productDao.selectHotProducts();
        hotProducts.forEach(product -> {
            redisTemplate.opsForValue().set(
                "product::" + product.getId(),
                ProductConverter.toVO(product),
                30, TimeUnit.MINUTES
            );
        });
    }
}
```

## ğŸ’» ä»£ç è´¨é‡æœ€ä½³å®è·µ

### æ¡ˆä¾‹3: ä»£ç è´¨é‡é—¨ç¦å»ºè®¾

#### èƒŒæ™¯æè¿°
å¼€å‘å›¢é˜Ÿéœ€è¦å»ºç«‹å®Œæ•´çš„ä»£ç è´¨é‡ä¿è¯ä½“ç³»ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚

#### è´¨é‡é—¨ç¦é…ç½®
```xml
<!-- pom.xml -->
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.8</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
        <execution>
            <id>check</id>
            <goals>
                <goal>check</goal>
            </goals>
            <configuration>
                <rules>
                    <rule>
                        <element>BUNDLE</element>
                        <limits>
                            <limit>
                                <counter>INSTRUCTION</counter>
                                <value>COVEREDRATIO</value>
                                <minimum>0.85</minimum>
                            </limit>
                        </limits>
                    </rule>
                </rules>
            </configuration>
        </execution>
    </executions>
</plugin>

<!-- SonarQubeä»£ç è´¨é‡æ£€æŸ¥ -->
<plugin>
    <groupId>org.sonarsource.scanner.maven</groupId>
    <artifactId>sonar-maven-plugin</artifactId>
    <version>3.9.1</version>
</plugin>
```

#### è´¨é‡æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# quality-check.sh - è´¨é‡æ£€æŸ¥è„šæœ¬

echo "å¼€å§‹æ‰§è¡Œè´¨é‡æ£€æŸ¥..."

# 1. å•å…ƒæµ‹è¯•
echo "æ‰§è¡Œå•å…ƒæµ‹è¯•..."
mvn test

# 2. ä»£ç è¦†ç›–ç‡æ£€æŸ¥
echo "æ£€æŸ¥ä»£ç è¦†ç›–ç‡..."
mvn jacoco:check

# 3. SonarQubeæ‰«æ
echo "æ‰§è¡ŒSonarQubeæ‰«æ..."
mvn sonar:sonar

# 4. ä»£ç æ ¼å¼æ£€æŸ¥
echo "æ£€æŸ¥ä»£ç æ ¼å¼..."
mvn spotless:check

# 5. ä¾èµ–å®‰å…¨æ£€æŸ¥
echo "æ£€æŸ¥ä¾èµ–å®‰å…¨æ¼æ´..."
mvn dependency-check:check

echo "è´¨é‡æ£€æŸ¥å®Œæˆ"
```

#### è´¨é‡æŒ‡æ ‡
- **ä»£ç è¦†ç›–ç‡**: â‰¥ 85%
- **é‡å¤ä»£ç ç‡**: â‰¤ 3%
- **åœˆå¤æ‚åº¦**: â‰¤ 10
- **å¯ç»´æŠ¤æ€§è¯„çº§**: Açº§
- **å®‰å…¨æ¼æ´**: 0ä¸ªé«˜å±æ¼æ´

### æ¡ˆä¾‹4: å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ

#### åœºæ™¯æè¿°
ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œæä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯å’Œå®Œå–„çš„æ—¥å¿—è®°å½•ã€‚

#### å¼‚å¸¸å¤„ç†æ¡†æ¶
```java
// è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸
@Data
@EqualsAndHashCode(callSuper = true)
public class BusinessException extends RuntimeException {
    private final String code;
    private final Object[] args;

    public BusinessException(String message) {
        super(message);
        this.code = "BUSINESS_ERROR";
        this.args = null;
    }

    public BusinessException(String code, String message, Object... args) {
        super(message);
        this.code = code;
        this.args = args;
    }

    public BusinessException(String code, String message, Throwable cause, Object... args) {
        super(message, cause);
        this.code = code;
        this.args = args;
    }

    public String getCode() {
        return code;
    }

    public Object[] getArgs() {
        return args;
    }
}

// å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public ResponseDTO<Void> handleBusinessException(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return ResponseDTO.error(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(ValidationException.class)
    public ResponseDTO<Void> handleValidationException(ValidationException e) {
        String message = e.getBindingResult().getFieldErrors().stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .collect(Collectors.joining(", "));
        log.warn("å‚æ•°éªŒè¯å¼‚å¸¸: {}", message);
        return ResponseDTO.error("VALIDATION_ERROR", message);
    }

    @ExceptionHandler(Exception.class)
    public ResponseDTO<Void> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return ResponseDTO.error("SYSTEM_ERROR", "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
    }
}

// Serviceå±‚å¼‚å¸¸å¤„ç†ç¤ºä¾‹
@Service
public class UserServiceImpl implements UserService {

    @Override
    public UserVO getUserById(Long userId) {
        // å‚æ•°éªŒè¯
        if (userId == null) {
            throw new BusinessException("USER_ID_NULL", "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        }

        try {
            // ä¸šåŠ¡é€»è¾‘
            UserEntity user = userDao.selectById(userId);
            if (user == null) {
                throw new BusinessException("USER_NOT_FOUND", "ç”¨æˆ·ä¸å­˜åœ¨", userId);
            }
            return UserConverter.toVO(user);
        } catch (Exception e) {
            log.error("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥, userId: {}", userId, e);
            throw new BusinessException("USER_QUERY_ERROR", "æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥");
        }
    }
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### æ¡ˆä¾‹5: æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

#### åœºæ™¯æè¿°
è®¢å•è¡¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸‹é™æ˜æ˜¾ã€‚

#### ä¼˜åŒ–ç­–ç•¥
```sql
-- 1. ç´¢å¼•ä¼˜åŒ–
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢æ¡ä»¶æ·»åŠ ç´¢å¼•
CREATE INDEX idx_order_user_status ON t_business_order(user_id, status);
CREATE INDEX idx_order_create_time ON t_business_order(create_time);

-- 2. åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
-- ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæ›¿ä»£ä¼ ç»ŸLIMIT OFFSET
-- ä¼ ç»Ÿåˆ†é¡µï¼ˆæ€§èƒ½å·®ï¼‰
SELECT * FROM t_business_order ORDER BY create_time DESC LIMIT 100000, 20;

-- ä¼˜åŒ–åçš„åˆ†é¡µï¼ˆæ€§èƒ½å¥½ï¼‰
SELECT * FROM t_business_order
WHERE create_time < '2024-01-01 12:00:00'
ORDER BY create_time DESC
LIMIT 20;

-- 3. è¦†ç›–ç´¢å¼•ä¼˜åŒ–
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºè¦†ç›–ç´¢å¼•
CREATE INDEX idx_order_cover ON t_business_order(order_id, order_no, user_id, status, total_amount);

-- 4. åˆ†åŒºè¡¨ä¼˜åŒ–
-- æŒ‰æ—¶é—´èŒƒå›´åˆ†åŒº
CREATE TABLE t_business_order (
    order_id BIGINT PRIMARY KEY,
    order_no VARCHAR(64) NOT NULL,
    user_id BIGINT NOT NULL,
    status TINYINT NOT NULL,
    create_time DATETIME NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL,
    -- å…¶ä»–å­—æ®µ...
    INDEX idx_user_status (user_id, status)
) PARTITION BY RANGE (YEAR(create_time)) (
    PARTITION p2023 VALUES LESS THAN ('2024-01-01'),
    PARTITION p2024 VALUES LESS THAN ('2025-01-01'),
    PARTITION p2025 VALUES LESS THAN ('2026-01-01')
);
```

#### MyBatisä¼˜åŒ–é…ç½®
```java
@Configuration
public class MyBatisPlusConfig {

    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();

        // åˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));

        // ä¹è§‚é”æ’ä»¶
        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());

        // æ•°æ®æƒé™æ’ä»¶
        interceptor.addInnerInterceptor(new DataPermissionInterceptor());

        return interceptor;
    }

    @Bean
    public ConfigurationCustomizer configurationCustomizer() {
        return configuration -> {
            configuration.setObjectWrapperFactory(new MybatisMapWrapperFactory());
            configuration.setCallSettersOnNulls(true);
            configuration.setUseDeprecatedExecutor = false;
        };
    }
}
```

### æ¡ˆä¾‹6: ç¼“å­˜ä¼˜åŒ–ç­–ç•¥

#### åœºæ™¯æè¿°
ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢é¢‘ç¹ï¼Œéœ€è¦å»ºç«‹é«˜æ•ˆçš„å¤šçº§ç¼“å­˜æ¶æ„ã€‚

#### ç¼“å­˜æ¶æ„è®¾è®¡
```java
@Component
public class CacheServiceImpl implements CacheService {

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    @Resource
    private CacheManager caffeineCacheManager;

    // å¤šçº§ç¼“å­˜æŸ¥è¯¢
    public <T> T get(String key, Class<T> clazz) {
        // 1. L1ç¼“å­˜ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰
        T value = getFromCaffeine(key, clazz);
        if (value != null) {
            return value;
        }

        // 2. L2ç¼“å­˜ï¼ˆRedisç¼“å­˜ï¼‰
        value = getFromRedis(key, clazz);
        if (value != null) {
            // å›å†™L1ç¼“å­˜
            setCaffeine(key, value);
            return value;
        }

        return null;
    }

    // å¤šçº§ç¼“å­˜è®¾ç½®
    public <T> void set(String key, T value) {
        // è®¾ç½®L1ç¼“å­˜ï¼ˆçŸ­æ—¶ï¼‰
        setCaffeine(key, value);

        // è®¾ç½®L2ç¼“å­˜ï¼ˆé•¿æ—¶ï¼‰
        setRedis(key, value, Duration.ofMinutes(30));
    }

    // ç¼“å­˜é¢„çƒ­
    @EventListener
    public void handleApplicationReady(ApplicationReadyEvent event) {
        // é¢„çƒ­çƒ­ç‚¹æ•°æ®
        preloadHotData();
    }

    private void preloadHotData() {
        // é¢„çƒ­çƒ­é—¨å•†å“
        List<ProductVO> hotProducts = productService.getHotProducts();
        hotProducts.forEach(product -> {
            set("product::" + product.getId(), product);
        });

        // é¢„çƒ­ç”¨æˆ·ä¿¡æ¯
        List<UserVO> activeUsers = userService.getActiveUsers();
        activeUsers.forEach(user -> {
            set("user::" + user.getId(), user);
        });
    }

    // ç¼“å­˜æ›´æ–°ç­–ç•¥
    @EventListener
    public void handleDataUpdateEvent(DataUpdateEvent event) {
        String cacheKey = buildCacheKey(event.getEntityType(), event.getId());

        // åˆ é™¤ç¼“å­˜
        delete(cacheKey);

        // å¦‚æœæ˜¯çƒ­ç‚¹æ•°æ®ï¼Œç«‹å³é‡æ–°åŠ è½½
        if (isHotData(event.getEntityType(), event.getId())) {
            Object newData = dataService.getById(event.getEntityType(), event.getId());
            if (newData != null) {
                set(cacheKey, newData);
            }
        }
    }
}
```

## ğŸ“Š ç›‘æ§å‘Šè­¦æœ€ä½³å®è·µ

### æ¡ˆä¾‹7: ä¸šåŠ¡ç›‘æ§æŒ‡æ ‡è®¾è®¡

#### åœºæ™¯æè¿°
ç”µå•†å¹³å°éœ€è¦å»ºç«‹å®Œæ•´çš„ä¸šåŠ¡ç›‘æ§ä½“ç³»ï¼Œå®æ—¶ç›‘æ§å…³é”®ä¸šåŠ¡æŒ‡æ ‡ã€‚

#### ç›‘æ§æŒ‡æ ‡å®šä¹‰
```java
// ä¸šåŠ¡æŒ‡æ ‡æ”¶é›†
@Component
public class MetricsCollector {

    private final MeterRegistry meterRegistry;

    // è®¢å•è®¡æ•°å™¨
    private final Counter orderCounter;

    // è®¢å•é‡‘é¢åˆ†å¸ƒ
    private final DistributionSummary orderAmount;

    // ç”¨æˆ·æ´»è·ƒåº¦
    private final Gauge activeUserCount;

    public MetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;

        this.orderCounter = Counter.builder("business.order.count")
                .description("è®¢å•æ€»æ•°")
                .tag("application", "smart-admin")
                .register(meterRegistry);

        this.orderAmount = DistributionSummary.builder("business.order.amount")
                .description("è®¢å•é‡‘é¢åˆ†å¸ƒ")
                .tag("application", "smart-admin")
                .register(meterRegistry);

        this.activeUserCount = Gauge.builder("business.user.active")
                .description("æ´»è·ƒç”¨æˆ·æ•°")
                .tag("application", "smart-admin")
                .register(meterRegistry);
    }

    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        // è®¢å•è®¡æ•°
        orderCounter.increment(
                Tags.of("status", event.getStatus().name(),
                        "type", event.getType().name())
        );

        // è®¢å•é‡‘é¢ç»Ÿè®¡
        orderAmount.record(event.getAmount());
    }

    @EventListener
    public void handleUserActivity(UserActivityEvent event) {
        // æ´»è·ƒç”¨æˆ·ç»Ÿè®¡
        activeUserCount.set(event.getActiveUserCount());
    }
}

// ä¸šåŠ¡ç›‘æ§æ³¨è§£
@Component
public class OrderService {

    @Timed(value = "order.create", description = "åˆ›å»ºè®¢å•è€—æ—¶")
    @Counted(value = "order.create.count", description = "åˆ›å»ºè®¢å•æ¬¡æ•°")
    @ExceptionMetered(value = "order.create.error", description = "åˆ›å»ºè®¢å•å¼‚å¸¸")
    public String createOrder(OrderCreateForm form) {
        try {
            // ä¸šåŠ¡é€»è¾‘
            return processOrder(form);
        } catch (Exception e) {
            log.error("åˆ›å»ºè®¢å•å¤±è´¥", e);
            throw e;
        }
    }
}
```

#### å‘Šè­¦è§„åˆ™é…ç½®
```yaml
# å‘Šè­¦è§„åˆ™é…ç½®
groups:
  - name: business.rules
    rules:
      # è®¢å•åˆ›å»ºç‡å¼‚å¸¸å‘Šè­¦
      - alert: OrderCreationRateLow
        expr: rate(order_create_count[5m]) < 10
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "è®¢å•åˆ›å»ºç‡è¿‡ä½"
          description: "5åˆ†é’Ÿå†…è®¢å•åˆ›å»ºæ¬¡æ•°ä½äº10æ¬¡"

      # è®¢å•å¤„ç†å¤±è´¥ç‡å‘Šè­¦
      - alert: OrderFailureRateHigh
        expr: rate(order_create_error[5m]) / rate(order_create_count[5m]) * 100 > 5
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "è®¢å•å¤„ç†å¤±è´¥ç‡è¿‡é«˜"
          description: "5åˆ†é’Ÿå†…è®¢å•å¤„ç†å¤±è´¥ç‡è¶…è¿‡5%"

      # æ´»è·ƒç”¨æˆ·æ•°å¼‚å¸¸å‘Šè­¦
      - alert: ActiveUserCountLow
        expr: business_user_active < 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "æ´»è·ƒç”¨æˆ·æ•°è¿‡ä½"
          description: "æ´»è·ƒç”¨æˆ·æ•°ä½äº100"
```

## ğŸ”§ DevOpsæœ€ä½³å®è·µ

### æ¡ˆä¾‹8: CI/CDæµæ°´çº¿å»ºè®¾

#### åœºæ™¯æè¿°
å¼€å‘å›¢é˜Ÿéœ€è¦å»ºç«‹è‡ªåŠ¨åŒ–çš„æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²æµæ°´çº¿ã€‚

#### æµæ°´çº¿é…ç½®
```yaml
# .gitlab-ci.yml
stages:
  - build
  - test
  - quality
  - security
  - deploy

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"
  SONAR_HOST: "https://sonar.example.com"
  SONAR_TOKEN: "$SONAR_TOKEN"

# æ„å»ºé˜¶æ®µ
build:
  stage: build
  image: maven:3.9.6-eclipse-temurin
  script:
    - mvn $MAVEN_OPTS clean compile
    - mvn $MAVEN_OPTS package -DskipTests
  artifacts:
    paths:
      - target/*.jar
    expire_in: 1 week

# æµ‹è¯•é˜¶æ®µ
test:
  stage: test
  image: maven:3.9.6-eclipse-temurin
  script:
    - mvn $MAVEN_OPTS test
  coverage: '/Coverage report:.*target/site/jacoco/index.html/'
  artifacts:
    reports:
      junit:
        - target/surefire-reports/TEST-*.xml

# ä»£ç è´¨é‡æ£€æŸ¥
quality:
  stage: quality
  image: maven:3.9.6-eclipse-temurin
  script:
    - mvn $MAVEN_OPTS sonar:sonar
  dependencies:
    - test

# å®‰å…¨æ‰«æ
security:
  stage: security
  image: owasp/dependency-check:9.0.7
  script:
    - mvn $MAVEN_OPTS dependency-check:check
  allow_failure: true
  artifacts:
    reports:
      dependency-check-report: target/dependency-check-report.html

# éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
deploy_test:
  stage: deploy
  environment:
    name: test
  image: alpine/helm:3.12.3
  before_script:
    - apk add --no-cache curl
  script:
    - echo "éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"
    - helm upgrade --install smart-admin-test ./helm-chart --set image.tag=$CI_COMMIT_SHA
  only:
    - main
```

## ğŸ“š æ–‡æ¡£ç®¡ç†æœ€ä½³å®è·µ

### æ¡ˆä¾‹9: APIæ–‡æ¡£è‡ªåŠ¨åŒ–

#### åœºæ™¯æè¿°
éœ€è¦ä¸ºREST APIç”Ÿæˆå‡†ç¡®ã€å®æ—¶çš„æ–‡æ¡£ã€‚

#### Swaggeré…ç½®
```java
@Configuration
@EnableOpenApi
public class SwaggerConfig {

    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                .info(new Info()
                        .title("SmartAdmin APIæ–‡æ¡£")
                        .version("1.0.0")
                        .description("SmartAdminå¾®æœåŠ¡ç³»ç»ŸAPIæ–‡æ¡£")
                        .contact(new Contact()
                                .name("SmartAdmin Team")
                                .email("smartadmin@example.com")
                                .url("https://smartadmin.vip")))
                .externalDocs(new ExternalDocumentation()
                        .description("é¡¹ç›®æ–‡æ¡£")
                        .url("https://docs.smartadmin.com"))
                .servers(Arrays.asList(
                        new Server()
                                .url("http://localhost:8080")
                                .description("å¼€å‘ç¯å¢ƒ"),
                        new Server()
                                .url("https://api.smartadmin.com")
                                .description("ç”Ÿäº§ç¯å¢ƒ")
                ))
                .components(new Components()
                        .addSecuritySchemes("BearerAuth",
                                new SecurityScheme()
                                        .type(SecurityScheme.Type.HTTP)
                                        .scheme("bearer")
                                        .bearerFormat("JWT")))
                .addSecurityRequirement(new SecurityRequirement()
                        .addList("BearerAuth"));
    }
}

// APIæ–‡æ¡£å¢å¼º
@RestController
@RequestMapping("/api/user")
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·ä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥æ“ä½œ")
@SecurityRequirement(name = "BearerAuth")
public class UserController {

    @Operation(
        summary = "è·å–ç”¨æˆ·è¯¦æƒ…",
        description = "æ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€è§’è‰²æƒé™ç­‰"
    )
    @ApiResponses(value = {
            @ApiResponse(responseCode = "200", description = "æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯",
                    content = @Content(mediaType = "application/json",
                            schema = @Schema(implementation = UserVO.class))),
            @ApiResponse(responseCode = "404", description = "ç”¨æˆ·ä¸å­˜åœ¨",
                    content = @Content(mediaType = "application/json",
                            schema = @Schema(implementation = ErrorVO.class))),
            @ApiResponse(responseCode = "401", description = "æœªæˆæƒ",
                    content = @Content(mediaType = "application/json",
                            schema = @Schema(implementation = ErrorVO.class)))
    })
    @GetMapping("/{id}")
    public Result<UserVO> getUser(
            @Parameter(description = "ç”¨æˆ·ID", required = true, example = "12345")
            @PathVariable Long id) {
        return Result.ok(userService.getDetail(id));
    }
}
```

---

**ğŸ“‹ æ¡ˆä¾‹æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0
**åˆ¶å®š**: SmartAdminè§„èŒƒæ²»ç†å§”å‘˜ä¼š
**å®¡æ ¸**: æœ€ä½³å®è·µä¸“å®¶ç»„
**ç”Ÿæ•ˆæ—¥æœŸ**: 2024-11-09
**æ›´æ–°å‘¨æœŸ**: å­£åº¦è¯„å®¡
**ç»´æŠ¤è´£ä»»**: æŠ€æœ¯å§”å‘˜ä¼š

**ğŸ¯ æ¡ˆä¾‹ä½¿ç”¨æŒ‡å—**ï¼š
1. **å‚è€ƒå€Ÿé‰´** - æ ¹æ®å®é™…åœºæ™¯å‚è€ƒç›¸å…³æ¡ˆä¾‹
2. **çµæ´»åº”ç”¨** - ç»“åˆå…·ä½“é¡¹ç›®æƒ…å†µçµæ´»è°ƒæ•´
3. **æŒç»­æ›´æ–°** - æ ¹æ®é¡¹ç›®å®è·µä¸æ–­å®Œå–„æ¡ˆä¾‹
4. **åˆ†äº«äº¤æµ** - ç§¯æåˆ†äº«æ–°çš„å®è·µç»éªŒ

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [æ¶æ„è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/æ¶æ„è§„èŒƒ.md) - æ¶æ„è®¾è®¡æ ‡å‡†
- [ç¼–ç è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/ç¼–ç è§„èŒƒ.md) - ä»£ç ç¼–å†™è§„èŒƒ
- [æ•…éšœæ’æŸ¥æ‰‹å†Œ](./æ•…éšœæ’æŸ¥æ‰‹å†Œ.md) - é—®é¢˜æ’æŸ¥æŒ‡å—