# ä»£ç æ¨¡æ¿åº“ï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„æ ‡å‡†ä»£ç æ¨¡æ¿åº“ï¼Œæä¾›å¯ç›´æ¥å¤ç”¨çš„ä»£ç æ¨¡æ¿ã€‚

## ğŸ—ï¸ Controllerå±‚æ¨¡æ¿

### æ ‡å‡†Controlleræ¨¡æ¿
```java
@RestController
@RequestMapping("/api/{module}")
@Tag(name = "{æ¨¡å—åç§°}ç®¡ç†", description = "{æ¨¡å—åç§°}çš„å¢åˆ æ”¹æŸ¥æ“ä½œ")
@SaCheckLogin
@Slf4j
public class {Module}Controller {

    @Resource
    private {Module}Service {module}Service;

    @Operation(summary = "æ–°å¢{å®ä½“}")
    @PostMapping("/add")
    @SaCheckPermission("{module}:add")
    public ResponseDTO<String> add(@RequestBody @Valid {Module}AddForm addForm) {
        log.info("æ–°å¢{å®ä½“}, param: {}", addForm);
        return ResponseDTO.ok({module}Service.add(addForm));
    }

    @Operation(summary = "æ›´æ–°{å®ä½“}")
    @PostMapping("/update")
    @SaCheckPermission("{module}:update")
    public ResponseDTO<String> update(@RequestBody @Valid {Module}UpdateForm updateForm) {
        log.info("æ›´æ–°{å®ä½“}, param: {}", updateForm);
        return ResponseDTO.ok({module}Service.update(updateForm));
    }

    @Operation(summary = "åˆ é™¤{å®ä½“}")
    @PostMapping("/delete")
    @SaCheckPermission("{module}:delete")
    public ResponseDTO<String> delete(@RequestBody @Valid IdForm idForm) {
        log.info("åˆ é™¤{å®ä½“}, id: {}", idForm.getId());
        return ResponseDTO.ok({module}Service.delete(idForm.getId()));
    }

    @Operation(summary = "åˆ†é¡µæŸ¥è¯¢{å®ä½“}")
    @PostMapping("/page")
    @SaCheckPermission("{module}:query")
    public ResponseDTO<PageResult<{Module}VO>> page(@RequestBody @Valid {Module}QueryForm queryForm) {
        log.info("åˆ†é¡µæŸ¥è¯¢{å®ä½“}, param: {}", queryForm);
        return ResponseDTO.ok({module}Service.page(queryForm));
    }

    @Operation(summary = "è·å–{å®ä½“}è¯¦æƒ…")
    @GetMapping("/detail/{{id}}")
    @SaCheckPermission("{module}:query")
    public ResponseDTO<{Module}VO> detail(@PathVariable Long id) {
        log.info("è·å–{å®ä½“}è¯¦æƒ…, id: {}", id);
        return ResponseDTO.ok({module}Service.detail(id));
    }
}
```

## ğŸ—ï¸ Serviceå±‚æ¨¡æ¿

### æ ‡å‡†Serviceæ¨¡æ¿
```java
@Service
@Transactional(rollbackFor = Exception.class)
@Slf4j
public class {Module}ServiceImpl implements {Module}Service {

    @Resource
    private {Module}Dao {module}Dao;

    @Resource
    private {Module}Manager {module}Manager;

    @Override
    public String add({Module}AddForm addForm) {
        // 1. å‚æ•°éªŒè¯
        this.validateAddForm(addForm);

        // 2. æ„å»ºå®ä½“
        {Module}Entity entity = SmartBeanUtil.copy(addForm, {Module}Entity.class);

        // 3. ä¿å­˜æ•°æ®
        {module}Dao.insert(entity);

        // 4. æ¸…é™¤ç¼“å­˜
        {module}Manager.removeCache();

        // 5. è®°å½•æ—¥å¿—
        log.info("æ–°å¢{å®ä½“}æˆåŠŸ, id: {}", entity.get{Module}Id());

        return ResponseStringConst.SUCCESS;
    }

    @Override
    public String update({Module}UpdateForm updateForm) {
        // 1. å‚æ•°éªŒè¯
        this.validateUpdateForm(updateForm);

        // 2. æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
        {Module}Entity existingEntity = {module}Dao.selectById(updateForm.get{Module}Id());
        if (existingEntity == null || existingEntity.getDeletedFlag()) {
            throw new BusinessException("{MODULE}_NOT_FOUND", "{å®ä½“}ä¸å­˜åœ¨");
        }

        // 3. æ„å»ºæ›´æ–°å®ä½“
        {Module}Entity updateEntity = SmartBeanUtil.copy(updateForm, {Module}Entity.class);

        // 4. æ›´æ–°æ•°æ®
        {module}Dao.updateById(updateEntity);

        // 5. æ¸…é™¤ç¼“å­˜
        {module}Manager.removeCache();

        // 6. è®°å½•æ—¥å¿—
        log.info("æ›´æ–°{å®ä½“}æˆåŠŸ, id: {}", updateForm.get{Module}Id());

        return ResponseStringConst.SUCCESS;
    }

    @Override
    public String delete(Long {moduleId}) {
        // 1. å‚æ•°éªŒè¯
        if ({moduleId} == null) {
            throw new BusinessException("PARAM_ERROR", "{å®ä½“}IDä¸èƒ½ä¸ºç©º");
        }

        // 2. æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
        {Module}Entity entity = {module}Dao.selectById({moduleId});
        if (entity == null || entity.getDeletedFlag()) {
            throw new BusinessException("{MODULE}_NOT_FOUND", "{å®ä½“}ä¸å­˜åœ¨");
        }

        // 3. è½¯åˆ é™¤
        entity.setDeletedFlag(true);
        {module}Dao.updateById(entity);

        // 4. æ¸…é™¤ç¼“å­˜
        {module}Manager.removeCache();

        // 5. è®°å½•æ—¥å¿—
        log.info("åˆ é™¤{å®ä½“}æˆåŠŸ, id: {}", {moduleId});

        return ResponseStringConst.SUCCESS;
    }

    @Override
    @Transactional(readOnly = true)
    public PageResult<{Module}VO> page({Module}QueryForm queryForm) {
        // 1. æŸ¥è¯¢æ•°æ®
        Page<{Module}Entity> page = {module}Dao.queryPage(queryForm);

        // 2. è½¬æ¢VO
        List<{Module}VO> voList = SmartBeanUtil.copyList(page.getRecords(), {Module}VO.class);

        // 3. è¿”å›ç»“æœ
        return new PageResult<>(voList, page.getTotal());
    }

    @Override
    @Transactional(readOnly = true)
    public {Module}VO detail(Long {moduleId}) {
        // 1. å‚æ•°éªŒè¯
        if ({moduleId} == null) {
            throw new BusinessException("PARAM_ERROR", "{å®ä½“}IDä¸èƒ½ä¸ºç©º");
        }

        // 2. æŸ¥è¯¢æ•°æ®
        {Module}Entity entity = {module}Manager.get{Module}({moduleId});
        if (entity == null || entity.getDeletedFlag()) {
            throw new BusinessException("{MODULE}_NOT_FOUND", "{å®ä½“}ä¸å­˜åœ¨");
        }

        // 3. è½¬æ¢VO
        return SmartBeanUtil.copy(entity, {Module}VO.class);
    }

    // ç§æœ‰æ–¹æ³•
    private void validateAddForm({Module}AddForm addForm) {
        // å‚æ•°éªŒè¯é€»è¾‘
    }

    private void validateUpdateForm({Module}UpdateForm updateForm) {
        // å‚æ•°éªŒè¯é€»è¾‘
    }
}
```

## ğŸ—ï¸ Managerå±‚æ¨¡æ¿

### æ ‡å‡†Manageræ¨¡æ¿
```java
@Component
@Slf4j
public class {Module}Manager {

    @Resource
    private {Module}Dao {module}Dao;

    // ç¼“å­˜é”®å¸¸é‡
    private static final String CACHE_PREFIX = "{module}:";
    private static final String ENTITY_SUFFIX = ":entity";
    private static final String LIST_SUFFIX = ":list";

    /**
     * è·å–{å®ä½“}ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */
    @Cacheable(value = "{MODULE}_ENTITY", key = "#{#moduleId}")
    public {Module}Entity get{Module}(Long {moduleId}) {
        if ({moduleId} == null) {
            return null;
        }

        {Module}Entity entity = {module}Dao.selectById({moduleId});
        if (entity == null || entity.getDeletedFlag()) {
            return null;
        }

        return entity;
    }

    /**
     * è·å–{å®ä½“}åˆ—è¡¨ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */
    @Cacheable(value = "{MODULE}_LIST", key = "#queryForm.hashCode()")
    public List<{Module}Entity> get{Module}List({Module}QueryForm queryForm) {
        return {module}Dao.queryList(queryForm);
    }

    /**
     * æ¸…é™¤{å®ä½“}ç›¸å…³ç¼“å­˜
     */
    @CacheEvict(value = {"{MODULE}_ENTITY", "{MODULE}_LIST"}, allEntries = true)
    public void removeCache() {
        log.info("æ¸…é™¤{å®ä½“}ç›¸å…³ç¼“å­˜");
    }

    /**
     * æ£€æŸ¥{å®ä½“}æ˜¯å¦å­˜åœ¨
     */
    public boolean exists{Module}(Long {moduleId}) {
        if ({moduleId} == null) {
            return false;
        }

        {Module}Entity entity = this.get{Module}({moduleId});
        return entity != null;
    }

    /**
     * æ£€æŸ¥{å®ä½“}åç§°æ˜¯å¦å­˜åœ¨
     */
    public boolean exists{Module}Name(String {moduleName}, Long excludeId) {
        {Module}QueryForm queryForm = new {Module}QueryForm();
        queryForm.set{ModuleName}({moduleName});
        queryForm.setExcludeId(excludeId);

        List<{Module}Entity> entityList = {module}Dao.queryList(queryForm);
        return !entityList.isEmpty();
    }
}
```

## ğŸ—ï¸ Daoå±‚æ¨¡æ¿

### æ ‡å‡†Daoæ¨¡æ¿
```java
@Mapper
public interface {Module}Dao {

    /**
     * æ’å…¥{å®ä½“}
     */
    int insert({Module}Entity entity);

    /**
     * æ›´æ–°{å®ä½“}
     */
    int updateById({Module}Entity entity);

    /**
     * æ ¹æ®IDæŸ¥è¯¢{å®ä½“}
     */
    @Select("SELECT * FROM t_{business}_{module} WHERE {moduleId} = #{#moduleId} AND deleted_flag = 0")
    {Module}Entity selectById(@Param("{moduleId}") Long {moduleId});

    /**
     * åˆ†é¡µæŸ¥è¯¢{å®ä½“}
     */
    List<{Module}Entity> queryPage({Module}QueryForm queryForm);

    /**
     * æŸ¥è¯¢{å®ä½“}åˆ—è¡¨
     */
    List<{Module}Entity> queryList({Module}QueryForm queryForm);

    /**
     * æŸ¥è¯¢{å®ä½“}æ•°é‡
     */
    Long queryCount({Module}QueryForm queryForm);

    /**
     * æ ¹æ®åç§°æŸ¥è¯¢{å®ä½“}
     */
    @Select("SELECT * FROM t_{business}_{module} WHERE {module_name} = #{#{moduleName}} " +
            "AND deleted_flag = 0 ORDER BY {moduleId} ASC")
    List<{Module}Entity> selectBy{Name}(@Param("{moduleName}") String {moduleName});

    /**
     * æ£€æŸ¥åç§°æ˜¯å¦å­˜åœ¨
     */
    @Select("SELECT COUNT(1) FROM t_{business}_{module} WHERE {module_name} = #{#{moduleName}} " +
            "AND {moduleId} != #{#excludeId} AND deleted_flag = 0")
    int countBy{Name}ExcludeId(@Param("{moduleName}") String {moduleName},
                               @Param("excludeId") Long excludeId);
}
```

## ğŸ—ï¸ Entityæ¨¡æ¿

### æ ‡å‡†Entityæ¨¡æ¿
```java
@Data
@EqualsAndHashCode(callSuper = false)
@TableName("t_{business}_{module}")
public class {Module}Entity {

    /**
     * {å®ä½“}ID
     */
    @TableId(value = "{moduleId}", type = IdType.AUTO)
    private Long {moduleId};

    /**
     * {ä¸šåŠ¡åç§°}
     */
    @TableField("{module_name}")
    private String {moduleName};

    /**
     * {ä¸šåŠ¡ç¼–ç }
     */
    @TableField("{module_code}")
    private String {moduleCode};

    /**
     * çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨
     */
    @TableField("status")
    private Integer status;

    /**
     * æ’åºå€¼
     */
    @TableField("sort_value")
    private Integer sortValue;

    /**
     * å¤‡æ³¨
     */
    @TableField("remark")
    private String remark;

    // å®¡è®¡å­—æ®µ
    /**
     * åˆ›å»ºæ—¶é—´
     */
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private LocalDateTime createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;

    /**
     * åˆ›å»ºäººID
     */
    @TableField(value = "create_user_id", fill = FieldFill.INSERT)
    private Long createUserId;

    /**
     * æ›´æ–°äººID
     */
    @TableField(value = "update_user_id", fill = FieldFill.INSERT_UPDATE)
    private Long updateUserId;

    /**
     * åˆ é™¤æ ‡è®°ï¼š0-æ­£å¸¸ 1-åˆ é™¤
     */
    @TableField(value = "deleted_flag", fill = FieldFill.INSERT)
    private Boolean deletedFlag;

    /**
     * ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰
     */
    @TableField(fill = FieldFill.INSERT)
    @Version
    private Integer version;
}
```

## ğŸ—ï¸ Form/VOæ¨¡æ¿

### Formæ¨¡æ¿
```java
// æ–°å¢Form
@Data
@ApiModel("{å®ä½“}æ–°å¢è¡¨å•")
public class {Module}AddForm {

    @ApiModelProperty(value = "{ä¸šåŠ¡åç§°}", required = true)
    @NotBlank(message = "{ä¸šåŠ¡åç§°}ä¸èƒ½ä¸ºç©º")
    @Length(max = 100, message = "{ä¸šåŠ¡åç§°}é•¿åº¦ä¸èƒ½è¶…è¿‡100")
    private String {moduleName};

    @ApiModelProperty(value = "{ä¸šåŠ¡ç¼–ç }")
    @Length(max = 50, message = "{ä¸šåŠ¡ç¼–ç }é•¿åº¦ä¸èƒ½è¶…è¿‡50")
    private String {moduleCode};

    @ApiModelProperty(value = "çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨")
    @Min(value = 0, message = "çŠ¶æ€å€¼ä¸æ­£ç¡®")
    @Max(value = 1, message = "çŠ¶æ€å€¼ä¸æ­£ç¡®")
    private Integer status = 1;

    @ApiModelProperty(value = "æ’åºå€¼")
    @Min(value = 0, message = "æ’åºå€¼ä¸èƒ½å°äº0")
    private Integer sortValue = 0;

    @ApiModelProperty(value = "å¤‡æ³¨")
    @Length(max = 500, message = "å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡500")
    private String remark;
}

// æ›´æ–°Form
@Data
@ApiModel("{å®ä½“}æ›´æ–°è¡¨å•")
public class {Module}UpdateForm {

    @ApiModelProperty(value = "{å®ä½“}ID", required = true)
    @NotNull(message = "{å®ä½“}IDä¸èƒ½ä¸ºç©º")
    @Min(value = 1, message = "{å®ä½“}IDä¸æ­£ç¡®")
    private Long {moduleId};

    @ApiModelProperty(value = "{ä¸šåŠ¡åç§°}")
    @Length(max = 100, message = "{ä¸šåŠ¡åç§°}é•¿åº¦ä¸èƒ½è¶…è¿‡100")
    private String {moduleName};

    @ApiModelProperty(value = "{ä¸šåŠ¡ç¼–ç }")
    @Length(max = 50, message = "{ä¸šåŠ¡ç¼–ç }é•¿åº¦ä¸èƒ½è¶…è¿‡50")
    private String {moduleCode};

    @ApiModelProperty(value = "çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨")
    @Min(value = 0, message = "çŠ¶æ€å€¼ä¸æ­£ç¡®")
    @Max(value = 1, message = "çŠ¶æ€å€¼ä¸æ­£ç¡®")
    private Integer status;

    @ApiModelProperty(value = "æ’åºå€¼")
    @Min(value = 0, message = "æ’åºå€¼ä¸èƒ½å°äº0")
    private Integer sortValue;

    @ApiModelProperty(value = "å¤‡æ³¨")
    @Length(max = 500, message = "å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡500")
    private String remark;
}

// æŸ¥è¯¢Form
@Data
@ApiModel("{å®ä½“}æŸ¥è¯¢è¡¨å•")
public class {Module}QueryForm extends PageForm {

    @ApiModelProperty(value = "{ä¸šåŠ¡åç§°}")
    private String {moduleName};

    @ApiModelProperty(value = "{ä¸šåŠ¡ç¼–ç }")
    private String {moduleCode};

    @ApiModelProperty(value = "çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨")
    private Integer status;

    @ApiModelProperty(value = "æ’é™¤çš„ID")
    private Long excludeId;
}
```

### VOæ¨¡æ¿
```java
@Data
@ApiModel("{å®ä½“}è§†å›¾å¯¹è±¡")
public class {Module}VO {

    @ApiModelProperty(value = "{å®ä½“}ID")
    private Long {moduleId};

    @ApiModelProperty(value = "{ä¸šåŠ¡åç§°}")
    private String {moduleName};

    @ApiModelProperty(value = "{ä¸šåŠ¡ç¼–ç }")
    private String {moduleCode};

    @ApiModelProperty(value = "çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨")
    private Integer status;

    @ApiModelProperty(value = "çŠ¶æ€åç§°")
    private String statusName;

    @ApiModelProperty(value = "æ’åºå€¼")
    private Integer sortValue;

    @ApiModelProperty(value = "å¤‡æ³¨")
    private String remark;

    @ApiModelProperty(value = "åˆ›å»ºæ—¶é—´")
    private LocalDateTime createTime;

    @ApiModelProperty(value = "æ›´æ–°æ—¶é—´")
    private LocalDateTime updateTime;

    @ApiModelProperty(value = "åˆ›å»ºäºº")
    private String createUserName;

    @ApiModelProperty(value = "æ›´æ–°äºº")
    private String updateUserName;
}
```

---

**ğŸ¯ ä½¿ç”¨è¯´æ˜**ï¼š
1. **å¤åˆ¶æ¨¡æ¿** - æ ¹æ®éœ€è¦å¤åˆ¶ç›¸åº”æ¨¡æ¿
2. **æ›¿æ¢å ä½ç¬¦** - å°†{module}æ›¿æ¢ä¸ºå®é™…æ¨¡å—å
3. **å®šåˆ¶åŒ–ä¿®æ”¹** - æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‚å½“ä¿®æ”¹
4. **éµå¾ªè§„èŒƒ** - ä¸¥æ ¼éµå¾ªSmartAdminç¼–ç è§„èŒƒ

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [æ¶æ„è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/æ¶æ„è§„èŒƒ.md) - æ¶æ„è®¾è®¡è§„èŒƒ
- [ç¼–ç è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/ç¼–ç è§„èŒƒ.md) - ä»£ç ç¼–å†™è§„èŒƒ
- [APIè§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/APIè§„èŒƒ.md) - APIæ¥å£è§„èŒƒ