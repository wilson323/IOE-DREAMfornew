# å¤šç¯å¢ƒé…ç½®è§„èŒƒï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„å”¯ä¸€å¤šç¯å¢ƒé…ç½®è§„èŒƒæƒå¨æ¥æºï¼Œæ”¯æŒdevã€testã€preã€prodå››å¥—ç¯å¢ƒï¼Œç¡®ä¿é…ç½®ç®¡ç†æ ‡å‡†åŒ–ã€‚

## âš ï¸ é…ç½®ç®¡ç†é“å¾‹ï¼ˆä¸å¯è¿åï¼‰

### ğŸš« ç»å¯¹ç¦æ­¢
```markdown
âŒ ç¦æ­¢åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é…ç½®ä¿¡æ¯
âŒ ç¦æ­¢å°†æ•æ„Ÿä¿¡æ¯æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
âŒ ç¦æ­¢ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼€å‘ç¯å¢ƒé…ç½®
âŒ ç¦æ­¢ç¼ºå°‘ç¯å¢ƒå˜é‡æ ¡éªŒæœºåˆ¶
âŒ ç¦æ­¢é…ç½®æ–‡ä»¶æ ¼å¼ä¸ç»Ÿä¸€
âŒ ç¦æ­¢ç¼ºå°‘é…ç½®æ–‡æ¡£å’Œè¯´æ˜
âŒ ç¦æ­¢ä¸åŒç¯å¢ƒé…ç½®æ··ç”¨
âŒ ç¦æ­¢ç¼ºå°‘é…ç½®å˜æ›´è®°å½•
```

### âœ… å¿…é¡»æ‰§è¡Œ
```markdown
âœ… å¿…é¡»ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†ä¸åŒé…ç½®
âœ… å¿…é¡»ä½¿ç”¨é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†é…ç½®
âœ… å¿…é¡»å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡ŒåŠ å¯†å­˜å‚¨
âœ… å¿…é¡»æœ‰é…ç½®éªŒè¯å’Œé»˜è®¤å€¼æœºåˆ¶
âœ… å¿…é¡»ä¿æŒé…ç½®æ–‡ä»¶ç»“æ„ç»Ÿä¸€
âœ… å¿…é¡»æœ‰å®Œæ•´çš„é…ç½®æ–‡æ¡£
âœ… å¿…é¡»æ”¯æŒé…ç½®çƒ­æ›´æ–°
âœ… å¿…é¡»æœ‰é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹
```

## ğŸ—ï¸ ç¯å¢ƒæ¶æ„è®¾è®¡

### ç¯å¢ƒåˆ†å±‚æ¶æ„
```markdown
ğŸ“¦ ç¯å¢ƒåˆ†å±‚ï¼š
â”œâ”€â”€ dev (å¼€å‘ç¯å¢ƒ)
â”‚   â”œâ”€â”€ æœ¬åœ°å¼€å‘è°ƒè¯•
â”‚   â”œâ”€â”€ å¿«é€Ÿè¿­ä»£æµ‹è¯•
â”‚   â””â”€â”€ å¼€å‘äººå‘˜ä½¿ç”¨
â”œâ”€â”€ test (æµ‹è¯•ç¯å¢ƒ)
â”‚   â”œâ”€â”€ åŠŸèƒ½æµ‹è¯•éªŒè¯
â”‚   â”œâ”€â”€ è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ
â”‚   â””â”€â”€ æµ‹è¯•å›¢é˜Ÿä½¿ç”¨
â”œâ”€â”€ pre (é¢„å‘å¸ƒç¯å¢ƒ)
â”‚   â”œâ”€â”€ ç”Ÿäº§å‰éªŒè¯
â”‚   â”œâ”€â”€ æ€§èƒ½å‹æµ‹ç¯å¢ƒ
â”‚   â””â”€â”€ äº§å“éªŒæ”¶ä½¿ç”¨
â””â”€â”€ prod (ç”Ÿäº§ç¯å¢ƒ)
    â”œâ”€â”€ æ­£å¼å¯¹å¤–æœåŠ¡
    â”œâ”€â”€ ç¨³å®šæ€§è¦æ±‚æœ€é«˜
    â””â”€â”€ è¿ç»´å›¢é˜Ÿç®¡ç†
```

### é…ç½®æ–‡ä»¶ç»“æ„
```
src/main/resources/
â”œâ”€â”€ application.yml                   # é€šç”¨é…ç½®
â”œâ”€â”€ application-dev.yml               # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ application-test.yml              # æµ‹è¯•ç¯å¢ƒé…ç½®
â”œâ”€â”€ application-pre.yml               # é¢„å‘å¸ƒç¯å¢ƒé…ç½®
â”œâ”€â”€ application-prod.yml              # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ config/                           # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ logback-spring.xml           # æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ druid.properties             # æ•°æ®åº“è¿æ¥æ± é…ç½®
â”‚   â””â”€â”€ redisson.yml                 # Redisé…ç½®
â””â”€â”€ bootstrap.yml                     # å¯åŠ¨é…ç½®
```

## âš™ï¸ é…ç½®æ–‡ä»¶è§„èŒƒ

### é€šç”¨é…ç½®æ–‡ä»¶ (application.yml)
```yaml
# åº”ç”¨åŸºç¡€é…ç½®
spring:
  application:
    name: smart-admin
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  # JSONé…ç½®
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

  # æ–‡ä»¶ä¸Šä¼ é…ç½®
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 100MB

  # å›½é™…åŒ–é…ç½®
  messages:
    basename: i18n/messages
    encoding: UTF-8
    cache-duration: 3600

# æœåŠ¡å™¨é…ç½®
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /
  tomcat:
    uri-encoding: UTF-8
    max-threads: 200
    min-spare-threads: 10
    accept-count: 100
    connection-timeout: 20000

# åº”ç”¨é…ç½®
app:
  # åº”ç”¨ä¿¡æ¯
  name: SmartAdminç®¡ç†ç³»ç»Ÿ
  version: 4.0.0
  description: åŸºäºSpring Boot 3.5.4çš„ä¼ä¸šçº§ç®¡ç†ç³»ç»Ÿ

  # å®‰å…¨é…ç½®
  security:
    jwt:
      secret: ${JWT_SECRET:smart-admin-jwt-secret-key}
      expiration: 86400 # 24å°æ—¶
      refresh-expiration: 604800 # 7å¤©
    captcha:
      enabled: ${CAPTCHA_ENABLED:true}
      expire-time: 300 # 5åˆ†é’Ÿ

  # æ–‡ä»¶å­˜å‚¨é…ç½®
  file:
    upload-path: ${FILE_UPLOAD_PATH:./uploads}
    max-size: 10485760 # 10MB
    allowed-types: jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx
    access-url: ${FILE_ACCESS_URL:http://localhost:8080/files}

  # ç¼“å­˜é…ç½®
  cache:
    type: ${CACHE_TYPE:redis} # redis, caffeine, both
    caffeine:
      max-size: 10000
      expire-after-write: 300000 # 5åˆ†é’Ÿ

  # æ—¥å¿—é…ç½®
  logging:
    level: ${LOG_LEVEL:INFO}
    path: ${LOG_PATH:./logs}
    max-size: 100MB
    max-history: 30

# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

# MyBatis-Plusé…ç½®
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      logic-delete-field: deletedFlag
      logic-delete-value: 1
      logic-not-delete-value: 0
      version-field: version
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.smart.admin.**.entity
```

### å¼€å‘ç¯å¢ƒé…ç½® (application-dev.yml)
```yaml
spring:
  # æ•°æ®æºé…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:smart_admin_dev}?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:root}
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=2000
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username: admin
        login-password: admin
        allow: 127.0.0.1

  # Redisé…ç½®
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: 0
    timeout: 3000
    lettuce:
      pool:
        max-active: 20
        max-wait: -1
        max-idle: 10
        min-idle: 0

  # å¼€å‘å·¥å…·é…ç½®
  devtools:
    restart:
      enabled: true
      additional-paths: src/main/java
    livereload:
      enabled: true

# åº”ç”¨é…ç½®
app:
  # å¼€å‘ç¯å¢ƒç‰¹æ®Šé…ç½®
  security:
    permit-all:
      - /druid/**
      - /actuator/**
      - /swagger-ui/**
      - /v3/api-docs/**
      - /doc.html

  # ç¼“å­˜é…ç½®
  cache:
    caffeine:
      enabled: true
      max-size: 1000
      expire-after-write: 60000 # 1åˆ†é’Ÿ

# æ—¥å¿—é…ç½®
logging:
  level:
    com.smart.admin: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG
    org.mybatis: DEBUG
    com.alibaba.druid: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Knife4jé…ç½®
knife4j:
  enable: true
  openapi:
    title: SmartAdmin APIæ–‡æ¡£ (å¼€å‘ç¯å¢ƒ)
    description: SmartAdminç®¡ç†ç³»ç»ŸAPIæ¥å£æ–‡æ¡£
    version: 4.0.0
    concat-contact: true
    contact:
      name: SmartAdmin Team
      email: smartadmin@example.com
      url: https://smartadmin.vip
    license: Apache 2.0
    license-url: https://www.apache.org/licenses/LICENSE-2.0
  setting:
    language: zh-CN
    enable-swagger-models: true
    enable-document-manage: true
    swagger-model-name: å®ä½“ç±»åˆ—è¡¨
    enable-version: true
    enable-reload-cache-parameter: false
    enable-after-script: true
    enable-filter-multipart-api-method-type: POST
    enable-filter-multipart-apis: false
    enable-request-cache: true
    enable-host: false
    enable-host-text: localhost:8080
    enable-home-custom: false
    home-custom-path: classpath:markdown/home.md
    enable-search: true
    enable-footer: false
    enable-footer-custom: true
    footer-custom-content: Copyright Â© 2024 SmartAdmin Team
    enable-dynamic-parameter: false
    enable-debug: true
    enable-open-api: true
    enable-group: true
  cors: true
  production: false
  basic:
    enable: false
    username: admin
    password: 123456
```

### æµ‹è¯•ç¯å¢ƒé…ç½® (application-test.yml)
```yaml
spring:
  # æ•°æ®æºé…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:192.168.1.100}:${DB_PORT:3306}/${DB_NAME:smart_admin_test}?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=true
    username: ${DB_USERNAME:smart_admin}
    password: ${DB_PASSWORD:smart_admin_test_2024}
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 10
      min-idle: 10
      max-active: 50
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=1000
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username: ${DRUID_USERNAME:admin}
        login-password: ${DRUID_PASSWORD:admin_test_2024}
        allow: 192.168.1.0/24

  # Redisé…ç½®
  redis:
    host: ${REDIS_HOST:192.168.1.101}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:redis_test_2024}
    database: 1
    timeout: 3000
    lettuce:
      pool:
        max-active: 50
        max-wait: -1
        max-idle: 20
        min-idle: 5

  # é‚®ä»¶é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
  mail:
    host: ${MAIL_HOST:smtp.qq.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:smart_admin_test@qq.com}
    password: ${MAIL_PASSWORD:test_mail_password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
    test-connection: true

# åº”ç”¨é…ç½®
app:
  # æµ‹è¯•ç¯å¢ƒç‰¹æ®Šé…ç½®
  security:
    permit-all:
      - /actuator/health
      - /actuator/info

  # æ–‡ä»¶å­˜å‚¨é…ç½®
  file:
    upload-path: ${FILE_UPLOAD_PATH:/data/smart-admin/uploads}
    access-url: ${FILE_ACCESS_URL:https://test.smartadmin.com/files}

  # ç¼“å­˜é…ç½®
  cache:
    type: redis
    caffeine:
      enabled: false

# æ—¥å¿—é…ç½®
logging:
  level:
    com.smart.admin: INFO
    org.springframework.security: INFO
    org.springframework.web: INFO
    org.mybatis: INFO
    com.alibaba.druid: INFO
  file:
    name: ${LOG_PATH:/data/smart-admin/logs}/smart-admin-test.log

# Knife4jé…ç½®
knife4j:
  enable: true
  openapi:
    title: SmartAdmin APIæ–‡æ¡£ (æµ‹è¯•ç¯å¢ƒ)
    description: SmartAdminç®¡ç†ç³»ç»ŸAPIæ¥å£æ–‡æ¡£ - æµ‹è¯•ç¯å¢ƒ
    version: 4.0.0
  setting:
    language: zh-CN
    enable-swagger-models: true
    enable-document-manage: true
    enable-version: true
    enable-reload-cache-parameter: false
    enable-after-script: true
    enable-filter-multipart-api-method-type: POST
    enable-filter-multipart-apis: false
    enable-request-cache: true
    enable-host: true
    enable-host-text: test.smartadmin.com
    enable-home-custom: false
    enable-search: true
    enable-footer: true
    enable-footer-custom: true
    footer-custom-content: Copyright Â© 2024 SmartAdmin Team - æµ‹è¯•ç¯å¢ƒ
    enable-dynamic-parameter: false
    enable-debug: false
    enable-open-api: true
    enable-group: true
  cors: true
  production: false
  basic:
    enable: true
    username: ${KNIFE4J_USERNAME:admin}
    password: ${KNIFE4J_PASSWORD:admin_test_2024}
```

### é¢„å‘å¸ƒç¯å¢ƒé…ç½® (application-pre.yml)
```yaml
spring:
  # æ•°æ®æºé…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:pre-db.smartadmin.com}:${DB_PORT:3306}/${DB_NAME:smart_admin_pre}?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=true
    username: ${DB_USERNAME:smart_admin_pre}
    password: ${DB_PASSWORD} # ä»ç¯å¢ƒå˜é‡è¯»å–
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 20
      min-idle: 20
      max-active: 100
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"
      stat-view-servlet:
        enabled: false # é¢„å‘å¸ƒç¯å¢ƒå…³é—­ç›‘æ§é¡µé¢

  # Redisé…ç½®
  redis:
    host: ${REDIS_HOST:pre-redis.smartadmin.com}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD} # ä»ç¯å¢ƒå˜é‡è¯»å–
    database: 2
    timeout: 3000
    lettuce:
      pool:
        max-active: 100
        max-wait: -1
        max-idle: 50
        min-idle: 10

  # é‚®ä»¶é…ç½®
  mail:
    host: ${MAIL_HOST:smtp.exmail.qq.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:noreply@smartadmin.com}
    password: ${MAIL_PASSWORD} # ä»ç¯å¢ƒå˜é‡è¯»å–
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
    test-connection: true

# åº”ç”¨é…ç½®
app:
  # é¢„å‘å¸ƒç¯å¢ƒç‰¹æ®Šé…ç½®
  security:
    permit-all:
      - /actuator/health

  # æ–‡ä»¶å­˜å‚¨é…ç½®ï¼ˆä½¿ç”¨OSSï¼‰
  file:
    upload-path: ${FILE_UPLOAD_PATH:/data/smart-admin/uploads}
    access-url: ${FILE_ACCESS_URL:https://pre.smartadmin.com/files}
    oss:
      enabled: true
      endpoint: ${OSS_ENDPOINT:https://oss-cn-beijing.aliyuncs.com}
      bucket: ${OSS_BUCKET:smart-admin-pre}
      access-key: ${OSS_ACCESS_KEY} # ä»ç¯å¢ƒå˜é‡è¯»å–
      secret-key: ${OSS_SECRET_KEY} # ä»ç¯å¢ƒå˜é‡è¯»å–

  # ç¼“å­˜é…ç½®
  cache:
    type: redis
    caffeine:
      enabled: false

# æ—¥å¿—é…ç½®
logging:
  level:
    com.smart.admin: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.mybatis: WARN
    com.alibaba.druid: WARN
    root: INFO
  file:
    name: ${LOG_PATH:/data/smart-admin/logs}/smart-admin-pre.log
    max-size: 200MB
    max-history: 60

# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: never
  metrics:
    export:
      prometheus:
        enabled: true

# Knife4jé…ç½®
knife4j:
  enable: false # é¢„å‘å¸ƒç¯å¢ƒå…³é—­æ–‡æ¡£
  production: true
```

### ç”Ÿäº§ç¯å¢ƒé…ç½® (application-prod.yml)
```yaml
spring:
  # æ•°æ®æºé…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST}:${DB_PORT:3306}/${DB_NAME}?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 50
      min-idle: 50
      max-active: 200
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=200
      web-stat-filter:
        enabled: false # ç”Ÿäº§ç¯å¢ƒå…³é—­ç›‘æ§é¡µé¢
      stat-view-servlet:
        enabled: false

  # Redisé…ç½®
  redis:
    host: ${REDIS_HOST}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD}
    database: 3
    timeout: 3000
    lettuce:
      pool:
        max-active: 200
        max-wait: -1
        max-idle: 100
        min-idle: 20

  # é‚®ä»¶é…ç½®
  mail:
    host: ${MAIL_HOST}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
    test-connection: false

# åº”ç”¨é…ç½®
app:
  # ç”Ÿäº§ç¯å¢ƒç‰¹æ®Šé…ç½®
  security:
    permit-all:
      - /actuator/health
      - /actuator/info

  # æ–‡ä»¶å­˜å‚¨é…ç½®ï¼ˆä½¿ç”¨OSSï¼‰
  file:
    upload-path: ${FILE_UPLOAD_PATH}
    access-url: ${FILE_ACCESS_URL}
    oss:
      enabled: true
      endpoint: ${OSS_ENDPOINT}
      bucket: ${OSS_BUCKET}
      access-key: ${OSS_ACCESS_KEY}
      secret-key: ${OSS_SECRET_KEY}
      cdn-url: ${OSS_CDN_URL}

  # ç¼“å­˜é…ç½®
  cache:
    type: redis
    caffeine:
      enabled: false

# æ—¥å¿—é…ç½®
logging:
  level:
    com.smart.admin: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.mybatis: WARN
    com.alibaba.druid: WARN
    root: WARN
  file:
    name: ${LOG_PATH}/smart-admin-prod.log
    max-size: 500MB
    max-history: 90
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%logger{50}] - %msg%n"

# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: never
  metrics:
    export:
      prometheus:
        enabled: true

# Knife4jé…ç½®
knife4j:
  enable: false # ç”Ÿäº§ç¯å¢ƒå…³é—­æ–‡æ¡£
  production: true
```

## ğŸ”§ ç¯å¢ƒå˜é‡ç®¡ç†

### ç¯å¢ƒå˜é‡æ¸…å•
```bash
# ===========================================
# é€šç”¨ç¯å¢ƒå˜é‡
# ===========================================
# è¿è¡Œç¯å¢ƒ
SPRING_PROFILES_ACTIVE=prod

# æœåŠ¡å™¨ç«¯å£
SERVER_PORT=8080

# JWTå¯†é’¥
JWT_SECRET=your-super-secret-jwt-key-at-least-256-bits-long

# éªŒè¯ç å¼€å…³
CAPTCHA_ENABLED=true

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=INFO
LOG_PATH=/data/smart-admin/logs

# æ–‡ä»¶ä¸Šä¼ è·¯å¾„
FILE_UPLOAD_PATH=/data/smart-admin/uploads
FILE_ACCESS_URL=https://smartadmin.com/files

# ç¼“å­˜ç±»å‹
CACHE_TYPE=redis

# ===========================================
# æ•°æ®åº“ç¯å¢ƒå˜é‡
# ===========================================
DB_HOST=localhost
DB_PORT=3306
DB_NAME=smart_admin
DB_USERNAME=smart_admin
DB_PASSWORD=your-database-password

# ===========================================
# Redisç¯å¢ƒå˜é‡
# ===========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password

# ===========================================
# é‚®ä»¶ç¯å¢ƒå˜é‡
# ===========================================
MAIL_HOST=smtp.exmail.qq.com
MAIL_PORT=587
MAIL_USERNAME=noreply@smartadmin.com
MAIL_PASSWORD=your-mail-password

# ===========================================
# OSSç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
# ===========================================
OSS_ENABLED=true
OSS_ENDPOINT=https://oss-cn-beijing.aliyuncs.com
OSS_BUCKET=smart-admin-prod
OSS_ACCESS_KEY=your-oss-access-key
OSS_SECRET_KEY=your-oss-secret-key
OSS_CDN_URL=https://cdn.smartadmin.com

# ===========================================
# ç›‘æ§ç¯å¢ƒå˜é‡
# ===========================================
ACTUATOR_ENABLED=true
PROMETHEUS_ENABLED=true

# ===========================================
# Druidç›‘æ§ç¯å¢ƒå˜é‡
# ===========================================
DRUID_USERNAME=admin
DRUID_PASSWORD=your-druid-password

# ===========================================
# Knife4jç¯å¢ƒå˜é‡
# ===========================================
KNIFE4J_ENABLED=false
KNIFE4J_USERNAME=admin
KNIFE4J_PASSWORD=your-knife4j-password
```

### Dockerç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
# .env.dev - å¼€å‘ç¯å¢ƒ
SPRING_PROFILES_ACTIVE=dev
DB_HOST=mysql-dev
REDIS_HOST=redis-dev
LOG_LEVEL=DEBUG

# .env.test - æµ‹è¯•ç¯å¢ƒ
SPRING_PROFILES_ACTIVE=test
DB_HOST=192.168.1.100
REDIS_HOST=192.168.1.101
DRUID_USERNAME=admin
DRUID_PASSWORD=admin_test_2024
KNIFE4J_USERNAME=admin
KNIFE4J_PASSWORD=admin_test_2024

# .env.pre - é¢„å‘å¸ƒç¯å¢ƒ
SPRING_PROFILES_ACTIVE=pre
DB_HOST=pre-db.smartadmin.com
REDIS_HOST=pre-redis.smartadmin.com
MAIL_HOST=smtp.exmail.qq.com
OSS_ENDPOINT=https://oss-cn-beijing.aliyuncs.com
OSS_BUCKET=smart-admin-pre

# .env.prod - ç”Ÿäº§ç¯å¢ƒ
SPRING_PROFILES_ACTIVE=prod
DB_HOST=prod-db.smartadmin.com
REDIS_HOST=prod-redis.smartadmin.com
MAIL_HOST=smtp.exmail.qq.com
OSS_ENDPOINT=https://oss-cn-beijing.aliyuncs.com
OSS_BUCKET=smart-admin-prod
OSS_CDN_URL=https://cdn.smartadmin.com
```

## ğŸš€ éƒ¨ç½²é…ç½®è§„èŒƒ

### Docker Composeé…ç½®
```yaml
# docker-compose.yml
version: '3.8'

services:
  # MySQLæœåŠ¡
  mysql:
    image: mysql:9.3.0
    container_name: smart-admin-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${DB_NAME}
      MYSQL_USER: ${DB_USERNAME}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      TZ: Asia/Shanghai
    ports:
      - "${DB_PORT:-3306}:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./config/mysql:/etc/mysql/conf.d
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    command: --default-authentication-plugin=mysql_native_password
    networks:
      - smart-admin-network

  # RedisæœåŠ¡
  redis:
    image: redis:7.0-alpine
    container_name: smart-admin-redis
    restart: unless-stopped
    command: redis-server --requirepass ${REDIS_PASSWORD}
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - redis_data:/data
      - ./config/redis.conf:/usr/local/etc/redis/redis.conf
    networks:
      - smart-admin-network

  # åº”ç”¨æœåŠ¡
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: smart-admin-app
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE}
      DB_HOST: mysql
      REDIS_HOST: redis
      # ä»ç¯å¢ƒæ–‡ä»¶åŠ è½½å…¶ä»–å˜é‡
    env_file:
      - .env.${SPRING_PROFILES_ACTIVE}
    ports:
      - "${SERVER_PORT:-8080}:8080"
    volumes:
      - app_logs:/data/smart-admin/logs
      - app_uploads:/data/smart-admin/uploads
    depends_on:
      - mysql
      - redis
    networks:
      - smart-admin-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # NginxæœåŠ¡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
  nginx:
    image: nginx:alpine
    container_name: smart-admin-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./config/nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./config/nginx/conf.d:/etc/nginx/conf.d
      - app_uploads:/var/www/uploads
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app
    networks:
      - smart-admin-network
    profiles:
      - prod

volumes:
  mysql_data:
    driver: local
  redis_data:
    driver: local
  app_logs:
    driver: local
  app_uploads:
    driver: local

networks:
  smart-admin-network:
    driver: bridge
```

### Kubernetesé…ç½®
```yaml
# k8s/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: smart-admin-config
  namespace: smart-admin
data:
  application.yml: |
    spring:
      profiles:
        active: ${SPRING_PROFILES_ACTIVE}
    server:
      port: 8080
    app:
      name: SmartAdminç®¡ç†ç³»ç»Ÿ
      version: 4.0.0

---
# k8s/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: smart-admin-secrets
  namespace: smart-admin
type: Opaque
data:
  # Base64ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
  db-password: <base64-encoded-password>
  redis-password: <base64-encoded-password>
  jwt-secret: <base64-encoded-jwt-secret>

---
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: smart-admin
  namespace: smart-admin
  labels:
    app: smart-admin
spec:
  replicas: 3
  selector:
    matchLabels:
      app: smart-admin
  template:
    metadata:
      labels:
        app: smart-admin
    spec:
      containers:
      - name: smart-admin
        image: smart-admin:4.0.0
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: DB_HOST
          value: "mysql-service"
        - name: REDIS_HOST
          value: "redis-service"
        envFrom:
        - configMapRef:
            name: smart-admin-config
        - secretRef:
            name: smart-admin-secrets
        volumeMounts:
        - name: app-logs
          mountPath: /data/smart-admin/logs
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
      volumes:
      - name: app-logs
        persistentVolumeClaim:
          claimName: app-logs-pvc

---
# k8s/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: smart-admin-service
  namespace: smart-admin
spec:
  selector:
    app: smart-admin
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP

---
# k8s/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: smart-admin-ingress
  namespace: smart-admin
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  tls:
  - hosts:
    - smartadmin.com
    secretName: smartadmin-tls
  rules:
  - host: smartadmin.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: smart-admin-service
            port:
              number: 80
```

## ğŸ“‹ é…ç½®ç®¡ç†æµç¨‹

### é…ç½®å˜æ›´æµç¨‹
```mermaid
graph TD
    A[é…ç½®å˜æ›´ç”³è¯·] --> B[å¼€å‘ç¯å¢ƒæµ‹è¯•]
    B --> C{æµ‹è¯•æ˜¯å¦é€šè¿‡}
    C -->|å¦| D[ä¿®æ”¹é…ç½®]
    D --> B
    C -->|æ˜¯| E[æäº¤å˜æ›´ç”³è¯·]
    E --> F[æŠ€æœ¯è´Ÿè´£äººå®¡æ‰¹]
    F --> G{å®¡æ‰¹æ˜¯å¦é€šè¿‡}
    G -->|å¦| H[é©³å›ä¿®æ”¹]
    H --> A
    G -->|æ˜¯| I[æµ‹è¯•ç¯å¢ƒéªŒè¯]
    I --> J{éªŒè¯æ˜¯å¦é€šè¿‡}
    J -->|å¦| K[å›æ»šé…ç½®]
    K --> A
    J -->|æ˜¯| L[é¢„å‘å¸ƒç¯å¢ƒéªŒè¯]
    L --> M{éªŒè¯æ˜¯å¦é€šè¿‡}
    M -->|å¦| K
    M -->|æ˜¯| N[ç”Ÿäº§ç¯å¢ƒå‘å¸ƒ]
    N --> O[å‘å¸ƒåéªŒè¯]
    O --> P{éªŒè¯æ˜¯å¦é€šè¿‡}
    P -->|å¦| Q[ç´§æ€¥å›æ»š]
    Q --> R[é—®é¢˜ä¿®å¤]
    R --> A
    P -->|æ˜¯| S[å˜æ›´å®Œæˆ]
```

### é…ç½®éªŒè¯è„šæœ¬
```bash
#!/bin/bash
# config-validator.sh - é…ç½®éªŒè¯è„šæœ¬

set -e

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ—¥å¿—å‡½æ•°
log_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

log_warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# å¿…éœ€çš„ç¯å¢ƒå˜é‡æ£€æŸ¥
check_required_env_vars() {
    log_info "æ£€æŸ¥å¿…éœ€çš„ç¯å¢ƒå˜é‡..."

    local required_vars=(
        "SPRING_PROFILES_ACTIVE"
        "DB_HOST"
        "DB_USERNAME"
        "DB_PASSWORD"
        "REDIS_HOST"
        "JWT_SECRET"
    )

    local missing_vars=()

    for var in "${required_vars[@]}"; do
        if [[ -z "${!var}" ]]; then
            missing_vars+=("$var")
        fi
    done

    if [[ ${#missing_vars[@]} -gt 0 ]]; then
        log_error "ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: ${missing_vars[*]}"
        return 1
    fi

    log_info "å¿…éœ€çš„ç¯å¢ƒå˜é‡æ£€æŸ¥é€šè¿‡"
}

# æ•°æ®åº“è¿æ¥æµ‹è¯•
test_database_connection() {
    log_info "æµ‹è¯•æ•°æ®åº“è¿æ¥..."

    local db_host=${DB_HOST}
    local db_port=${DB_PORT:-3306}
    local db_name=${DB_NAME}
    local db_username=${DB_USERNAME}
    local db_password=${DB_PASSWORD}

    # ä½¿ç”¨MySQLå®¢æˆ·ç«¯æµ‹è¯•è¿æ¥
    if command -v mysql &> /dev/null; then
        if mysql -h"$db_host" -P"$db_port" -u"$db_username" -p"$db_password" -e "USE $db_name; SELECT 1;" &> /dev/null; then
            log_info "æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡"
        else
            log_error "æ•°æ®åº“è¿æ¥æµ‹è¯•å¤±è´¥"
            return 1
        fi
    else
        log_warn "MySQLå®¢æˆ·ç«¯æœªå®‰è£…ï¼Œè·³è¿‡æ•°æ®åº“è¿æ¥æµ‹è¯•"
    fi
}

# Redisè¿æ¥æµ‹è¯•
test_redis_connection() {
    log_info "æµ‹è¯•Redisè¿æ¥..."

    local redis_host=${REDIS_HOST}
    local redis_port=${REDIS_PORT:-6379}
    local redis_password=${REDIS_PASSWORD}

    # ä½¿ç”¨Rediså®¢æˆ·ç«¯æµ‹è¯•è¿æ¥
    if command -v redis-cli &> /dev/null; then
        local redis_cmd="redis-cli -h $redis_host -p $redis_port"

        if [[ -n "$redis_password" ]]; then
            redis_cmd="$redis_cmd -a $redis_password"
        fi

        if $redis_cmd ping &> /dev/null; then
            log_info "Redisè¿æ¥æµ‹è¯•é€šè¿‡"
        else
            log_error "Redisè¿æ¥æµ‹è¯•å¤±è´¥"
            return 1
        fi
    else
        log_warn "Rediså®¢æˆ·ç«¯æœªå®‰è£…ï¼Œè·³è¿‡Redisè¿æ¥æµ‹è¯•"
    fi
}

# é…ç½®æ–‡ä»¶è¯­æ³•æ£€æŸ¥
check_config_syntax() {
    log_info "æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•..."

    # æ£€æŸ¥YAMLè¯­æ³•
    if command -v yamllint &> /dev/null; then
        local config_files=(
            "application.yml"
            "application-${SPRING_PROFILES_ACTIVE}.yml"
        )

        for config_file in "${config_files[@]}"; do
            if [[ -f "$config_file" ]]; then
                if yamllint "$config_file" &> /dev/null; then
                    log_info "$config_file è¯­æ³•æ£€æŸ¥é€šè¿‡"
                else
                    log_error "$config_file è¯­æ³•æ£€æŸ¥å¤±è´¥"
                    return 1
                fi
            fi
        done
    else
        log_warn "yamllintæœªå®‰è£…ï¼Œè·³è¿‡YAMLè¯­æ³•æ£€æŸ¥"
    fi
}

# å®‰å…¨é…ç½®æ£€æŸ¥
check_security_config() {
    log_info "æ£€æŸ¥å®‰å…¨é…ç½®..."

    # æ£€æŸ¥JWTå¯†é’¥é•¿åº¦
    if [[ ${#JWT_SECRET} -lt 32 ]]; then
        log_error "JWTå¯†é’¥é•¿åº¦ä¸èƒ½å°‘äº32ä¸ªå­—ç¬¦"
        return 1
    fi

    # æ£€æŸ¥æ•°æ®åº“å¯†ç å¼ºåº¦
    if [[ ${#DB_PASSWORD} -lt 8 ]]; then
        log_error "æ•°æ®åº“å¯†ç é•¿åº¦ä¸èƒ½å°‘äº8ä¸ªå­—ç¬¦"
        return 1
    fi

    # æ£€æŸ¥Rediså¯†ç 
    if [[ "$SPRING_PROFILES_ACTIVE" != "dev" && -z "$REDIS_PASSWORD" ]]; then
        log_error "éå¼€å‘ç¯å¢ƒå¿…é¡»è®¾ç½®Rediså¯†ç "
        return 1
    fi

    log_info "å®‰å…¨é…ç½®æ£€æŸ¥é€šè¿‡"
}

# ä¸»å‡½æ•°
main() {
    log_info "å¼€å§‹é…ç½®éªŒè¯..."

    check_required_env_vars || exit 1
    check_config_syntax || exit 1
    check_security_config || exit 1
    test_database_connection || exit 1
    test_redis_connection || exit 1

    log_info "é…ç½®éªŒè¯å…¨éƒ¨é€šè¿‡ï¼"
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

---

**ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼š
1. **ç¯å¢ƒéš”ç¦»** - ä¸åŒç¯å¢ƒé…ç½®ä¸¥æ ¼åˆ†ç¦»
2. **å®‰å…¨ä¼˜å…ˆ** - æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
3. **é…ç½®éªŒè¯** - è‡ªåŠ¨åŒ–é…ç½®æ£€æŸ¥å’ŒéªŒè¯
4. **å˜æ›´ç®¡ç†** - æ ‡å‡†åŒ–é…ç½®å˜æ›´æµç¨‹
5. **å¯è¿½æº¯æ€§** - å®Œæ•´çš„é…ç½®å˜æ›´è®°å½•

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [å®‰å…¨è§„èŒƒ](./å®‰å…¨è§„èŒƒ.md) - é…ç½®å®‰å…¨ç®¡ç†
- [æ•°æ®è§„èŒƒ](./æ•°æ®è§„èŒƒ.md) - æ•°æ®åº“é…ç½®è§„èŒƒ
- [ç¼“å­˜æ¶æ„è§„èŒƒ](./ç¼“å­˜æ¶æ„è§„èŒƒ.md) - ç¼“å­˜é…ç½®è§„èŒƒ