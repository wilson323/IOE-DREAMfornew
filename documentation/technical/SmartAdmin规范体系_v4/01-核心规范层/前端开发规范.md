# å‰ç«¯å¼€å‘è§„èŒƒï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„å”¯ä¸€å‰ç«¯å¼€å‘è§„èŒƒæƒå¨æ¥æºï¼ŒåŸºäºVue 3.4.27 + TypeScript + Ant Design Vue 4.2.5ã€‚

## âš ï¸ å‰ç«¯å¼€å‘é“å¾‹ï¼ˆä¸å¯è¿åï¼‰

### ğŸš« ç»å¯¹ç¦æ­¢
```markdown
âŒ ç¦æ­¢ä½¿ç”¨varå£°æ˜å˜é‡ï¼ˆå¿…é¡»ä½¿ç”¨let/constï¼‰
âŒ ç¦æ­¢ä½¿ç”¨anyç±»å‹ï¼ˆå¿…é¡»æ˜ç¡®ç±»å‹å®šä¹‰ï¼‰
âŒ ç¦æ­¢ç›´æ¥ä¿®æ”¹propsï¼ˆå¿…é¡»é€šè¿‡emité€šä¿¡ï¼‰
âŒ ç¦æ­¢åœ¨templateä¸­ç¼–å†™å¤æ‚é€»è¾‘
âŒ ç¦æ­¢ç¼ºå°‘é”™è¯¯è¾¹ç•Œå¤„ç†
âŒ ç¦æ­¢ä½¿ç”¨è¿‡æ—¶çš„Vue 2è¯­æ³•
âŒ ç¦æ­¢å…¨å±€æ ·å¼æ±¡æŸ“
âŒ ç¦æ­¢ç¼ºå°‘ç»„ä»¶æ–‡æ¡£æ³¨é‡Š
```

### âœ… å¿…é¡»æ‰§è¡Œ
```markdown
âœ… å¿…é¡»ä½¿ç”¨Vue 3 Composition API
âœ… å¿…é¡»ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
âœ… å¿…é¡»ä½¿ç”¨Ant Design Vueç»„ä»¶åº“
âœ… å¿…é¡»ä½¿ç”¨PiniaçŠ¶æ€ç®¡ç†
âœ… å¿…é¡»ä½¿ç”¨Viteæ„å»ºå·¥å…·
âœ… å¿…é¡»å®ç°å“åº”å¼è®¾è®¡
âœ… å¿…é¡»å¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€
âœ… å¿…é¡»ç¼–å†™å•å…ƒæµ‹è¯•
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„è§„èŒƒ

### æ ‡å‡†ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ api/                    # APIæ¥å£
â”œâ”€â”€ assets/                 # é™æ€èµ„æº
â”œâ”€â”€ components/             # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ common/            # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ business/          # ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ composables/           # ç»„åˆå¼å‡½æ•°
â”œâ”€â”€ layouts/               # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ pages/                 # é¡µé¢ç»„ä»¶
â”œâ”€â”€ router/                # è·¯ç”±é…ç½®
â”œâ”€â”€ stores/                # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ styles/                # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ types/                 # ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â””â”€â”€ views/                 # è§†å›¾ç»„ä»¶
```

## ğŸ¨ ç»„ä»¶å¼€å‘è§„èŒƒ

### ç»„ä»¶æ¨¡æ¿
```vue
<template>
  <div class="user-list">
    <!-- åŠ è½½çŠ¶æ€ -->
    <a-spin :spinning="loading" tip="åŠ è½½ä¸­...">
      <!-- æœç´¢åŒºåŸŸ -->
      <div class="search-form">
        <a-form :model="searchForm" layout="inline">
          <a-form-item label="ç”¨æˆ·å">
            <a-input
              v-model:value="searchForm.userName"
              placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
              allow-clear
            />
          </a-form-item>
          <a-form-item>
            <a-space>
              <a-button type="primary" @click="handleSearch">
                æœç´¢
              </a-button>
              <a-button @click="handleReset">é‡ç½®</a-button>
            </a-space>
          </a-form-item>
        </a-form>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="table-operations">
        <a-button type="primary" @click="handleAdd">
          æ–°å¢ç”¨æˆ·
        </a-button>
        <a-button
          danger
          :disabled="!hasSelected"
          @click="handleBatchDelete"
        >
          æ‰¹é‡åˆ é™¤
        </a-button>
      </div>

      <!-- æ•°æ®è¡¨æ ¼ -->
      <a-table
        :columns="columns"
        :data-source="dataSource"
        :pagination="pagination"
        :loading="loading"
        :row-selection="rowSelection"
        row-key="id"
        @change="handleTableChange"
      >
        <!-- çŠ¶æ€åˆ— -->
        <template #status="{ record }">
          <a-tag :color="record.status === 1 ? 'green' : 'red'">
            {{ record.status === 1 ? 'æ­£å¸¸' : 'ç¦ç”¨' }}
          </a-tag>
        </template>

        <!-- æ“ä½œåˆ— -->
        <template #action="{ record }">
          <a-space>
            <a-button type="link" @click="handleEdit(record)">
              ç¼–è¾‘
            </a-button>
            <a-popconfirm
              title="ç¡®å®šåˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ"
              @confirm="handleDelete(record.id)"
            >
              <a-button type="link" danger>åˆ é™¤</a-button>
            </a-popconfirm>
          </a-space>
        </template>
      </a-table>
    </a-spin>

    <!-- æ–°å¢/ç¼–è¾‘å¼¹çª— -->
    <UserModal
      v-model:visible="modalVisible"
      :user="currentUser"
      @success="handleModalSuccess"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, onMounted } from 'vue'
import { message } from 'ant-design-vue'
import type { TableColumnsType, TableProps } from 'ant-design-vue'
import { userApi } from '@/api/user'
import type { UserItem, UserQueryParams } from '@/types/user'

// ç»„åˆå¼å‡½æ•°
const { loading, execute } = useRequest()
const { confirm } = useModal()

// å“åº”å¼æ•°æ®
const searchForm = reactive<UserQueryParams>({
  userName: '',
  status: undefined,
  current: 1,
  pageSize: 10
})

const dataSource = ref<UserItem[]>([])
const total = ref(0)
const selectedRowKeys = ref<number[]>([])
const modalVisible = ref(false)
const currentUser = ref<UserItem | null>(null)

// è®¡ç®—å±æ€§
const hasSelected = computed(() => selectedRowKeys.value.length > 0)

const pagination = computed(() => ({
  total: total.value,
  current: searchForm.current,
  pageSize: searchForm.pageSize,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total: number) => `å…± ${total} æ¡`
}))

const rowSelection: TableProps<UserItem>['rowSelection'] = {
  selectedRowKeys: selectedRowKeys,
  onChange: (keys: number[]) => {
    selectedRowKeys.value = keys
  }
}

// è¡¨æ ¼åˆ—é…ç½®
const columns: TableColumnsType = [
  {
    title: 'ID',
    dataIndex: 'id',
    key: 'id',
    width: 80
  },
  {
    title: 'ç”¨æˆ·å',
    dataIndex: 'userName',
    key: 'userName'
  },
  {
    title: 'é‚®ç®±',
    dataIndex: 'email',
    key: 'email'
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    key: 'status',
    slots: { customRender: 'status' }
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createTime',
    key: 'createTime'
  },
  {
    title: 'æ“ä½œ',
    key: 'action',
    slots: { customRender: 'action' },
    width: 150
  }
]

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadData()
})

// æ–¹æ³•
const loadData = async () => {
  try {
    const response = await execute(userApi.getList, searchForm)
    dataSource.value = response.data.records
    total.value = response.data.total
  } catch (error) {
    message.error('åŠ è½½æ•°æ®å¤±è´¥')
  }
}

const handleSearch = () => {
  searchForm.current = 1
  loadData()
}

const handleReset = () => {
  Object.assign(searchForm, {
    userName: '',
    status: undefined,
    current: 1,
    pageSize: 10
  })
  loadData()
}

const handleAdd = () => {
  currentUser.value = null
  modalVisible.value = true
}

const handleEdit = (record: UserItem) => {
  currentUser.value = { ...record }
  modalVisible.value = true
}

const handleDelete = async (id: number) => {
  try {
    await execute(userApi.delete, id)
    message.success('åˆ é™¤æˆåŠŸ')
    loadData()
  } catch (error) {
    message.error('åˆ é™¤å¤±è´¥')
  }
}

const handleBatchDelete = async () => {
  if (selectedRowKeys.value.length === 0) {
    message.warning('è¯·é€‰æ‹©è¦åˆ é™¤çš„æ•°æ®')
    return
  }

  confirm({
    title: 'ç¡®è®¤åˆ é™¤',
    content: `ç¡®å®šåˆ é™¤é€‰ä¸­çš„ ${selectedRowKeys.value.length} æ¡æ•°æ®å—ï¼Ÿ`,
    async onOk() {
      try {
        await execute(userApi.batchDelete, selectedRowKeys.value)
        message.success('æ‰¹é‡åˆ é™¤æˆåŠŸ')
        selectedRowKeys.value = []
        loadData()
      } catch (error) {
        message.error('æ‰¹é‡åˆ é™¤å¤±è´¥')
      }
    }
  })
}

const handleTableChange = (pagination: any) => {
  searchForm.current = pagination.current
  searchForm.pageSize = pagination.pageSize
  loadData()
}

const handleModalSuccess = () => {
  modalVisible.value = false
  loadData()
}
</script>

<style lang="scss" scoped>
.user-list {
  padding: 24px;
  background: #fff;
  border-radius: 8px;

  .search-form {
    margin-bottom: 16px;
    padding: 16px;
    background: #fafafa;
    border-radius: 4px;
  }

  .table-operations {
    margin-bottom: 16px;
  }
}
</style>
```

## ğŸ”„ çŠ¶æ€ç®¡ç†è§„èŒƒ

### Pinia Storeæ¨¡æ¿
```typescript
// stores/user.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { userApi } from '@/api/user'
import type { UserItem, LoginForm } from '@/types/user'
import { message } from 'ant-design-vue'

export const useUserStore = defineStore('user', () => {
  // çŠ¶æ€
  const currentUser = ref<UserItem | null>(null)
  const token = ref<string>('')
  const permissions = ref<string[]>([])

  // è®¡ç®—å±æ€§
  const isLoggedIn = computed(() => !!token.value && !!currentUser.value)
  const hasPermission = computed(() => (permission: string) =>
    permissions.value.includes(permission)
  )

  // æ–¹æ³•
  const login = async (form: LoginForm): Promise<boolean> => {
    try {
      const response = await userApi.login(form)
      const { token: newToken, userInfo } = response.data

      token.value = newToken
      currentUser.value = userInfo

      // å­˜å‚¨åˆ°localStorage
      localStorage.setItem('token', newToken)
      localStorage.setItem('userInfo', JSON.stringify(userInfo))

      message.success('ç™»å½•æˆåŠŸ')
      return true
    } catch (error) {
      message.error('ç™»å½•å¤±è´¥')
      return false
    }
  }

  const logout = () => {
    currentUser.value = null
    token.value = ''
    permissions.value = []

    localStorage.removeItem('token')
    localStorage.removeItem('userInfo')
  }

  const getUserInfo = async (): Promise<boolean> => {
    try {
      const response = await userApi.getCurrent()
      currentUser.value = response.data
      localStorage.setItem('userInfo', JSON.stringify(response.data))
      return true
    } catch (error) {
      logout()
      return false
    }
  }

  const initAuth = () => {
    const savedToken = localStorage.getItem('token')
    const savedUserInfo = localStorage.getItem('userInfo')

    if (savedToken && savedUserInfo) {
      token.value = savedToken
      currentUser.value = JSON.parse(savedUserInfo)
    }
  }

  return {
    // çŠ¶æ€
    currentUser,
    token,
    permissions,

    // è®¡ç®—å±æ€§
    isLoggedIn,
    hasPermission,

    // æ–¹æ³•
    login,
    logout,
    getUserInfo,
    initAuth
  }
})
```

## ğŸ¯ APIå°è£…è§„èŒƒ

### APIæ¥å£å°è£…
```typescript
// api/user.ts
import { request } from '@/utils/request'
import type { UserItem, UserQueryParams, LoginForm } from '@/types/user'

export const userApi = {
  // ç”¨æˆ·ç™»å½•
  login: (data: LoginForm) =>
    request.post('/auth/login', data),

  // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  getCurrent: () =>
    request.get('/user/current'),

  // è·å–ç”¨æˆ·åˆ—è¡¨
  getList: (params: UserQueryParams) =>
    request.get('/user/list', { params }),

  // è·å–ç”¨æˆ·è¯¦æƒ…
  getDetail: (id: number) =>
    request.get(`/user/${id}`),

  // æ–°å¢ç”¨æˆ·
  create: (data: Omit<UserItem, 'id'>) =>
    request.post('/user', data),

  // æ›´æ–°ç”¨æˆ·
  update: (id: number, data: Partial<UserItem>) =>
    request.put(`/user/${id}`, data),

  // åˆ é™¤ç”¨æˆ·
  delete: (id: number) =>
    request.delete(`/user/${id}`),

  // æ‰¹é‡åˆ é™¤ç”¨æˆ·
  batchDelete: (ids: number[]) =>
    request.delete('/user/batch', { data: { ids } })
}
```

## ğŸ“± å“åº”å¼è®¾è®¡è§„èŒƒ

### ç§»åŠ¨ç«¯é€‚é…
```scss
// styles/responsive.scss
// æ–­ç‚¹å®šä¹‰
$breakpoints: (
  xs: 480px,
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
  xxl: 1600px
);

// åª’ä½“æŸ¥è¯¢æ··å…¥
@mixin respond-to($breakpoint) {
  @if map-has-key($breakpoints, $breakpoint) {
    @media screen and (min-width: map-get($breakpoints, $breakpoint)) {
      @content;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
.container {
  padding: 16px;

  @include respond-to(md) {
    padding: 24px;
  }

  @include respond-to(lg) {
    padding: 32px;
    max-width: 1200px;
    margin: 0 auto;
  }
}

// ç§»åŠ¨ç«¯ä¼˜å…ˆçš„è¡¨æ ¼
.table-container {
  @include respond-to(md) {
    overflow-x: auto;
  }
}

.responsive-table {
  width: 100%;

  @include respond-to(sm) {
    // å°å±å¹•éšè—éƒ¨åˆ†åˆ—
    .hide-on-mobile {
      display: none;
    }
  }
}
```

## ğŸ”§ å·¥å…·å‡½æ•°è§„èŒƒ

### é€šç”¨å·¥å…·å‡½æ•°
```typescript
// utils/index.ts
import { ref } from 'vue'
import { message } from 'ant-design-vue'

// è¯·æ±‚å·¥å…·
export function useRequest() {
  const loading = ref(false)

  const execute = async <T = any>(
    api: (...args: any[]) => Promise<T>,
    ...args: any[]
  ): Promise<T> => {
    loading.value = true
    try {
      const result = await api(...args)
      return result
    } finally {
      loading.value = false
    }
  }

  return {
    loading,
    execute
  }
}

// æ¨¡æ€æ¡†å·¥å…·
export function useModal() {
  const confirm = (options: any) => {
    return new Promise((resolve, reject) => {
      Modal.confirm({
        ...options,
        onOk: () => resolve(true),
        onCancel: () => reject(false)
      })
    })
  }

  return {
    confirm
  }
}

// æ ¼å¼åŒ–å·¥å…·
export const formatUtils = {
  // æ—¥æœŸæ ¼å¼åŒ–
  formatDate: (date: string | Date, format = 'YYYY-MM-DD HH:mm:ss') => {
    return dayjs(date).format(format)
  },

  // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
  formatFileSize: (bytes: number) => {
    if (bytes === 0) return '0 B'
    const k = 1024
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB']
    const i = Math.floor(Math.log(bytes) / Math.log(k))
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
  }
}
```

## ğŸ“‹ ç»„ä»¶æ–‡æ¡£è§„èŒƒ

### ç»„ä»¶æ³¨é‡Šæ¨¡æ¿
```vue
<!--
  ç»„ä»¶åç§°ï¼šUserList
  åŠŸèƒ½æè¿°ï¼šç”¨æˆ·åˆ—è¡¨ç»„ä»¶ï¼Œæ”¯æŒæœç´¢ã€åˆ†é¡µã€æ‰¹é‡æ“ä½œ
  ä½¿ç”¨ç¤ºä¾‹ï¼š
    <UserList @edit="handleEdit" @delete="handleDelete" />

  Props:
    - æ— 

  Events:
    - edit: ç¼–è¾‘ç”¨æˆ·äº‹ä»¶
      å‚æ•°: user: UserItem
    - delete: åˆ é™¤ç”¨æˆ·äº‹ä»¶
      å‚æ•°: id: number

  Slots:
    - æ— 

  Author: SmartAdmin Team
  Date: 2024-01-01
-->
```

---

**ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼š
1. **ç»„ä»¶åŒ–å¼€å‘** - å¯å¤ç”¨çš„ç»„ä»¶è®¾è®¡
2. **ç±»å‹å®‰å…¨** - TypeScriptä¸¥æ ¼æ¨¡å¼
3. **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯é€‚é…
4. **æ€§èƒ½ä¼˜åŒ–** - æ‡’åŠ è½½å’Œè™šæ‹Ÿæ»šåŠ¨
5. **ç”¨æˆ·ä½“éªŒ** - åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [APIè§„èŒƒ](./APIè§„èŒƒ.md) - å‰åç«¯æ¥å£è§„èŒƒ
- [å®‰å…¨è§„èŒƒ](./å®‰å…¨è§„èŒƒ.md) - å‰ç«¯å®‰å…¨è§„èŒƒ
- [ç¼–ç è§„èŒƒ](./ç¼–ç è§„èŒƒ.md) - ä»£ç é£æ ¼è§„èŒƒ