# 系统概览页面功能与布局文档

## 页面概述
系统概览页面是智能视频监控系统的数据大屏首页，用于实时展示系统整体运行状态、设备统计、告警信息、性能指标等关键数据。该页面基于SmartAdmin前端框架构建，采用Vue3 + Ant Design Vue + ECharts技术栈，提供可视化数据展示、实时数据更新、多维度统计分析等功能，为管理人员提供系统全局视图和决策支持。

## 技术架构规范

### 前端技术栈
- **核心框架**: Vue 3.4.27 (Composition API)
- **UI组件库**: Ant Design Vue 4.2.5
- **可视化库**: Apache ECharts 5.5.0
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.3.2
- **HTTP客户端**: Axios 1.6.8
- **样式预处理器**: Less 4.2.0
- **图标库**: @ant-design/icons-vue
- **实时通信**: WebSocket (可选)

### 项目文件组织结构
```
src/views/business/smart-video/
├── system-overview.vue              # 系统概览主页面
├── components/
│   ├── KpiCard.vue                 # KPI指标卡片组件
│   ├── DeviceStatusChart.vue      # 设备状态图表组件
│   ├── AlarmTrendChart.vue        # 告警趋势图表组件
│   ├── DeviceTypeChart.vue        # 设备类型分布图表组件
│   ├── SystemStatusCard.vue       # 系统状态卡片组件
│   ├── AlarmListCard.vue          # 告警列表卡片组件
│   ├── TaskQueueCard.vue          # 任务队列卡片组件
│   └── StorageStatusCard.vue      # 存储状态卡片组件
├── hooks/
│   ├── useRealTimeData.js         # 实时数据更新Hook
│   └── useChartResize.js          # 图表响应式Hook
├── mock/
│   └── overview-mock-data.js       # 模拟数据
└── api/
    └── overview-api.js              # API接口定义
```

### API接口设计
```javascript
// src/api/business/smart-video/overview-api.js
import { postRequest, getRequest } from '/@/lib/axios';

export const overviewApi = {
  // 获取系统概览数据
  getSystemOverview: () => getRequest('/overview/system'),

  // 获取设备统计数据
  getDeviceStatistics: () => getRequest('/overview/device/statistics'),

  // 获取设备状态分布
  getDeviceStatusDistribution: () => getRequest('/overview/device/status'),

  // 获取告警趋势数据
  getAlarmTrend: (params) => postRequest('/overview/alarm/trend', params),

  // 获取最新告警列表
  getLatestAlarms: (limit) => getRequest(`/overview/alarm/latest?limit=${limit}`),

  // 获取系统资源状态
  getSystemResources: () => getRequest('/overview/system/resources'),

  // 获取任务队列状态
  getTaskQueueStatus: () => getRequest('/overview/task/queue'),

  // 获取设备类型分布
  getDeviceTypeDistribution: () => getRequest('/overview/device/type'),

  // 获取存储使用情况
  getStorageUsage: () => getRequest('/overview/storage'),

  // 实时数据订阅（WebSocket）
  subscribeRealTimeData: () => getRequest('/overview/subscribe'),

  // 取消实时数据订阅
  unsubscribeRealTimeData: () => getRequest('/overview/unsubscribe'),
};
```

## ⚠️ 开发注意事项与常见错误避免

### 1. ECharts 图表使用注意事项

#### ❌ 错误用法：未正确销毁图表实例
```vue
<!-- 错误：组件销毁时未销毁图表实例，导致内存泄漏 -->
<script setup>
import * as echarts from 'echarts';
import { onMounted } from 'vue';

onMounted(() => {
  const chart = echarts.init(document.getElementById('chart'));
  chart.setOption({...});
  // ❌ 未在组件销毁时清理图表
});
</script>
```

#### ✅ 正确用法：完整的图表生命周期管理
```vue
<template>
  <div ref="chartRef" style="width: 100%; height: 400px;"></div>
</template>

<script setup>
import * as echarts from 'echarts';
import { ref, onMounted, onUnmounted, watch } from 'vue';

const chartRef = ref(null);
let chartInstance = null;

onMounted(() => {
  // 初始化图表
  chartInstance = echarts.init(chartRef.value);

  // 设置图表配置
  const option = {
    // 图表配置...
  };
  chartInstance.setOption(option);

  // 监听窗口大小变化
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  // ✅ 销毁图表实例
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
  // 移除事件监听
  window.removeEventListener('resize', handleResize);
});

const handleResize = () => {
  chartInstance?.resize();
};

// 监听数据变化更新图表
watch(() => props.data, (newData) => {
  if (chartInstance) {
    chartInstance.setOption({
      series: [{ data: newData }]
    });
  }
}, { deep: true });
</script>
```

### 2. 实时数据更新注意事项

#### ❌ 错误用法：频繁重新渲染导致性能问题
```vue
<!-- 错误：每次更新都重新渲染整个图表 -->
<script setup>
import { ref, watch } from 'vue';

const data = ref([]);

// ❌ 频繁重新初始化图表
watch(data, () => {
  chartInstance.dispose();  // 销毁
  chartInstance = echarts.init(chartRef.value);  // 重新初始化
  chartInstance.setOption(option);  // 重新设置
});
</script>
```

#### ✅ 正确用法：使用增量更新
```vue
<script setup>
import { ref, watch } from 'vue';

const data = ref([]);

// ✅ 只更新变化的数据
watch(data, (newData) => {
  if (chartInstance) {
    chartInstance.setOption({
      series: [{
        data: newData
      }]
    }, { notMerge: false });  // 使用合并模式，不重新初始化
  }
}, { deep: true });

// ✅ 使用定时器控制更新频率
let updateTimer = null;
const updateData = (newData) => {
  if (updateTimer) clearTimeout(updateTimer);

  updateTimer = setTimeout(() => {
    data.value = newData;
  }, 500);  // 500ms 防抖
};
</script>
```

### 3. 图标导入注意事项

#### ❌ 错误：使用不存在的图标
```vue
<!-- 错误：某些图标可能不存在 -->
<script setup>
import {
  SystemOutlined,      // ❌ 可能不存在
  DeviceOutlined,      // ❌ 可能不存在
  MonitorOutlined      // ❌ 可能不存在
} from '@ant-design/icons-vue';
</script>
```

#### ✅ 正确：使用实际存在的图标
```vue
<!-- 正确：使用实际存在的图标 -->
<script setup>
import {
  DesktopOutlined,        // ✅ 设备/桌面
  VideoCameraOutlined,    // ✅ 摄像机
  WifiOutlined,           // ✅ 在线状态
  BellOutlined,           // ✅ 告警
  HeartOutlined,          // ✅ 心跳/健康
  ArrowUpOutlined,        // ✅ 上升
  ArrowDownOutlined,      // ✅ 下降
  CheckCircleOutlined,    // ✅ 成功/正常
  CloseCircleOutlined,    // ✅ 失败/异常
  ReloadOutlined,         // ✅ 刷新
  SyncOutlined,           // ✅ 同步
  UnorderedListOutlined,  // ✅ 列表
  BarChartOutlined,       // ✅ 图表
  PieChartOutlined,       // ✅ 饼图
  LineChartOutlined,      // ✅ 折线图
  DatabaseOutlined,       // ✅ 存储
  CloudServerOutlined,    // ✅ 服务器
} from '@ant-design/icons-vue';
</script>
```

### 4. 响应式布局注意事项

#### ✅ 正确：使用Grid布局实现响应式
```vue
<template>
  <div class="overview-container">
    <!-- 使用Ant Design的Grid系统 -->
    <a-row :gutter="[16, 16]">
      <a-col :xs="24" :sm="12" :md="6" v-for="card in kpiCards" :key="card.key">
        <KpiCard :data="card" />
      </a-col>
    </a-row>

    <!-- 图表区域 -->
    <a-row :gutter="[16, 16]" style="margin-top: 16px;">
      <a-col :xs="24" :lg="12">
        <DeviceStatusChart :data="deviceStatusData" />
      </a-col>
      <a-col :xs="24" :lg="12">
        <AlarmTrendChart :data="alarmTrendData" />
      </a-col>
    </a-row>
  </div>
</template>

<style scoped lang="less">
// 响应式容器
.overview-container {
  padding: 16px;

  @media (max-width: 768px) {
    padding: 8px;
  }
}
</style>
```

### 5. 数据轮询注意事项

#### ✅ 正确：实现可控的数据轮询
```vue
<script setup>
import { ref, onMounted, onUnmounted } from 'vue';

let pollingTimer = null;
const pollingInterval = 5000; // 5秒轮询一次
const isPolling = ref(false);

// 启动轮询
const startPolling = () => {
  if (isPolling.value) return;

  isPolling.value = true;
  fetchData(); // 立即获取一次数据

  pollingTimer = setInterval(() => {
    fetchData();
  }, pollingInterval);
};

// 停止轮询
const stopPolling = () => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
    pollingTimer = null;
  }
  isPolling.value = false;
};

// 获取数据
const fetchData = async () => {
  try {
    const data = await overviewApi.getSystemOverview();
    // 更新数据...
  } catch (error) {
    console.error('获取数据失败:', error);
  }
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  stopPolling();
});

// 页面可见性变化时控制轮询
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    stopPolling();
  } else {
    startPolling();
  }
});
</script>
```

## 核心功能模块

### 1. KPI指标卡片

**位置**: 页面顶部，4列网格布局

**功能说明**:
- 总设备数：显示系统中注册的设备总数，包含较昨日变化趋势
- 在线设备：显示当前在线设备数量和在线率
- 今日告警：显示今日告警数量，包含较昨日变化趋势
- 系统状态：显示系统整体运行状态

**技术实现**:
```vue
<!-- src/views/business/smart-video/system-overview.vue -->
<template>
  <div class="system-overview-page">
    <!-- KPI指标卡片 -->
    <a-row :gutter="[16, 16]">
      <a-col :xs="24" :sm="12" :lg="6" v-for="kpi in kpiData" :key="kpi.key">
        <a-card :bordered="false" class="kpi-card" :class="`kpi-card-${kpi.type}`">
          <div class="kpi-card-content">
            <div class="kpi-icon">
              <component :is="kpi.icon" class="icon" />
            </div>
            <div class="kpi-info">
              <div class="kpi-label">{{ kpi.label }}</div>
              <div class="kpi-value">{{ kpi.value }}</div>
              <div class="kpi-trend" :class="kpi.trend > 0 ? 'trend-up' : 'trend-down'">
                <component :is="kpi.trend > 0 ? ArrowUpOutlined : ArrowDownOutlined" />
                <span>{{ kpi.trendText }}</span>
              </div>
            </div>
          </div>
        </a-card>
      </a-col>
    </a-row>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import {
  VideoCameraOutlined,
  WifiOutlined,
  BellOutlined,
  HeartOutlined,
  ArrowUpOutlined,
  ArrowDownOutlined,
} from '@ant-design/icons-vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

// KPI数据
const kpiData = ref([
  {
    key: 'totalDevices',
    label: '总设备数',
    value: 0,
    trend: 0,
    trendText: '较昨日 +0',
    icon: VideoCameraOutlined,
    type: 'info',
  },
  {
    key: 'onlineDevices',
    label: '在线设备',
    value: 0,
    trend: 0,
    trendText: '在线率 0%',
    icon: WifiOutlined,
    type: 'success',
  },
  {
    key: 'todayAlarms',
    label: '今日告警',
    value: 0,
    trend: 0,
    trendText: '较昨日 +0',
    icon: BellOutlined,
    type: 'warning',
  },
  {
    key: 'systemStatus',
    label: '系统状态',
    value: '正常',
    trend: 1,
    trendText: '运行稳定',
    icon: HeartOutlined,
    type: 'success',
  },
]);

// 获取设备统计数据
const fetchDeviceStatistics = async () => {
  try {
    const response = await overviewApi.getDeviceStatistics();

    kpiData.value[0].value = response.data.totalDevices || 160;
    kpiData.value[0].trend = response.data.totalDevicesTrend || 3;
    kpiData.value[0].trendText = `较昨日 ${response.data.totalDevicesTrend > 0 ? '+' : ''}${response.data.totalDevicesTrend}`;

    kpiData.value[1].value = response.data.onlineDevices || 156;
    const onlineRate = ((response.data.onlineDevices / response.data.totalDevices) * 100).toFixed(1);
    kpiData.value[1].trendText = `在线率 ${onlineRate}%`;
    kpiData.value[1].trend = 1;

    kpiData.value[2].value = response.data.todayAlarms || 23;
    kpiData.value[2].trend = response.data.todayAlarmsTrend || -5;
    kpiData.value[2].trendText = `较昨日 ${response.data.todayAlarmsTrend > 0 ? '+' : ''}${response.data.todayAlarmsTrend}`;
  } catch (error) {
    console.error('获取设备统计数据失败:', error);
  }
};

// 轮询更新数据
let pollingTimer = null;

const startPolling = () => {
  fetchDeviceStatistics();
  pollingTimer = setInterval(() => {
    fetchDeviceStatistics();
  }, 30000); // 30秒更新一次
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
  }
});
</script>

<style scoped lang="less">
.system-overview-page {
  padding: 16px;
  background: #f0f2f5;
  min-height: 100vh;
}

.kpi-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  :deep(.ant-card-body) {
    padding: 20px;
  }
}

.kpi-card-content {
  display: flex;
  align-items: center;
  gap: 16px;
}

.kpi-icon {
  width: 56px;
  height: 56px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}

.kpi-card-info .kpi-icon {
  background: #e6f4ff;
  color: #1890ff;
}

.kpi-card-success .kpi-icon {
  background: #f6ffed;
  color: #52c41a;
}

.kpi-card-warning .kpi-icon {
  background: #fffbe6;
  color: #faad14;
}

.kpi-info {
  flex: 1;
}

.kpi-label {
  font-size: 14px;
  color: #8c8c8c;
  margin-bottom: 8px;
}

.kpi-value {
  font-size: 32px;
  font-weight: 600;
  color: #262626;
  line-height: 1.2;
  margin-bottom: 4px;
}

.kpi-trend {
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 4px;

  &.trend-up {
    color: #52c41a;
  }

  &.trend-down {
    color: #ff4d4f;
  }
}
</style>
```

### 2. 设备状态分布图表（饼图）

**位置**: 第一行图表区域左侧

**功能说明**:
- 展示设备状态分布（在线、离线、故障、维护）
- 支持图表刷新
- 显示各状态的数量和百分比

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/DeviceStatusChart.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <div class="chart-title">
        <span>设备状态分布</span>
        <a-button size="small" @click="refreshChart" :loading="loading">
          <template #icon><ReloadOutlined /></template>
          刷新
        </a-button>
      </div>
    </template>

    <div ref="chartRef" class="chart-container"></div>

    <!-- 图例 -->
    <div class="chart-legend">
      <div class="legend-item" v-for="item in legendData" :key="item.name">
        <span class="legend-color" :style="{ backgroundColor: item.color }"></span>
        <span class="legend-text">{{ item.name }}: <strong>{{ item.value }}台</strong></span>
      </div>
    </div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted, watch } from 'vue';
import * as echarts from 'echarts';
import { ReloadOutlined } from '@ant-design/icons-vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const props = defineProps({
  autoRefresh: {
    type: Boolean,
    default: true,
  },
});

const chartRef = ref(null);
let chartInstance = null;
const loading = ref(false);

const chartData = ref([
  { name: '在线', value: 156, color: '#52c41a' },
  { name: '离线', value: 2, color: '#ff4d4f' },
  { name: '故障', value: 0, color: '#faad14' },
  { name: '维护', value: 2, color: '#8c8c8c' },
]);

const legendData = ref([...chartData.value]);

// 初始化图表
const initChart = () => {
  if (!chartRef.value) return;

  chartInstance = echarts.init(chartRef.value);

  const option = {
    tooltip: {
      trigger: 'item',
      formatter: '{a} <br/>{b}: {c}台 ({d}%)',
    },
    series: [
      {
        name: '设备状态',
        type: 'pie',
        radius: ['45%', '70%'],
        avoidLabelOverlap: false,
        itemStyle: {
          borderRadius: 8,
          borderColor: '#fff',
          borderWidth: 2,
        },
        label: {
          show: false,
          position: 'center',
        },
        emphasis: {
          label: {
            show: true,
            fontSize: 20,
            fontWeight: 'bold',
          },
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)',
          },
        },
        labelLine: {
          show: false,
        },
        data: chartData.value.map(item => ({
          name: item.name,
          value: item.value,
          itemStyle: { color: item.color },
        })),
      },
    ],
  };

  chartInstance.setOption(option);
};

// 获取设备状态数据
const fetchData = async () => {
  try {
    loading.value = true;
    const response = await overviewApi.getDeviceStatusDistribution();

    if (response.data) {
      chartData.value = [
        { name: '在线', value: response.data.online || 0, color: '#52c41a' },
        { name: '离线', value: response.data.offline || 0, color: '#ff4d4f' },
        { name: '故障', value: response.data.fault || 0, color: '#faad14' },
        { name: '维护', value: response.data.maintenance || 0, color: '#8c8c8c' },
      ];
      legendData.value = [...chartData.value];

      // 更新图表
      if (chartInstance) {
        chartInstance.setOption({
          series: [{
            data: chartData.value.map(item => ({
              name: item.name,
              value: item.value,
              itemStyle: { color: item.color },
            })),
          }],
        });
      }
    }
  } catch (error) {
    console.error('获取设备状态数据失败:', error);
  } finally {
    loading.value = false;
  }
};

// 刷新图表
const refreshChart = () => {
  fetchData();
};

// 监听窗口大小变化
const handleResize = () => {
  chartInstance?.resize();
};

onMounted(() => {
  initChart();
  fetchData();
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
  window.removeEventListener('resize', handleResize);
});
</script>

<style scoped lang="less">
.chart-card {
  height: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.chart-container {
  width: 100%;
  height: 320px;
}

.chart-legend {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
}

.legend-color {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.legend-text {
  color: #8c8c8c;

  strong {
    color: #262626;
  }
}
</style>
```

### 3. 告警趋势图表（折线图）

**位置**: 第一行图表区域右侧

**功能说明**:
- 展示7天或30天告警趋势
- 支持时间范围切换（7天/30天）
- 显示告警数量变化曲线

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/AlarmTrendChart.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <div class="chart-title">
        <span>告警趋势</span>
        <a-radio-group v-model:value="timeRange" button-style="solid" size="small" @change="handleTimeRangeChange">
          <a-radio-button value="7d">7天</a-radio-button>
          <a-radio-button value="30d">30天</a-radio-button>
        </a-radio-group>
      </div>
    </template>

    <div ref="chartRef" class="chart-container"></div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import * as echarts from 'echarts';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const chartRef = ref(null);
let chartInstance = null;
const timeRange = ref('7d');

const chartData = ref({
  dates: [],
  values: [],
});

// 初始化图表
const initChart = () => {
  if (!chartRef.value) return;

  chartInstance = echarts.init(chartRef.value);

  const option = {
    tooltip: {
      trigger: 'axis',
      backgroundColor: 'rgba(0, 0, 0, 0.8)',
      borderColor: 'transparent',
      textStyle: {
        color: '#fff',
      },
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      top: '10%',
      containLabel: true,
    },
    xAxis: {
      type: 'category',
      boundaryGap: false,
      data: chartData.value.dates,
      axisLine: {
        lineStyle: {
          color: '#e8e8e8',
        },
      },
      axisLabel: {
        color: '#8c8c8c',
        fontSize: 12,
      },
    },
    yAxis: {
      type: 'value',
      axisLine: {
        show: false,
      },
      axisTick: {
        show: false,
      },
      axisLabel: {
        color: '#8c8c8c',
        fontSize: 12,
      },
      splitLine: {
        lineStyle: {
          color: '#f0f0f0',
        },
      },
    },
    series: [
      {
        name: '告警数量',
        type: 'line',
        smooth: true,
        symbol: 'circle',
        symbolSize: 6,
        itemStyle: {
          color: '#1890ff',
        },
        lineStyle: {
          width: 2,
          color: '#1890ff',
        },
        areaStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            {
              offset: 0,
              color: 'rgba(24, 144, 255, 0.3)',
            },
            {
              offset: 1,
              color: 'rgba(24, 144, 255, 0.05)',
            },
          ]),
        },
        data: chartData.value.values,
      },
    ],
  };

  chartInstance.setOption(option);
};

// 获取告警趋势数据
const fetchData = async () => {
  try {
    const response = await overviewApi.getAlarmTrend({ range: timeRange.value });

    if (response.data) {
      chartData.value = {
        dates: response.data.dates || ['1/24', '1/25', '1/26', '1/27', '1/28', '1/29', '1/30'],
        values: response.data.values || [28, 32, 25, 30, 27, 22, 23],
      };

      // 更新图表
      if (chartInstance) {
        chartInstance.setOption({
          xAxis: {
            data: chartData.value.dates,
          },
          series: [{
            data: chartData.value.values,
          }],
        });
      }
    }
  } catch (error) {
    console.error('获取告警趋势数据失败:', error);
  }
};

// 时间范围变化处理
const handleTimeRangeChange = () => {
  fetchData();
};

// 监听窗口大小变化
const handleResize = () => {
  chartInstance?.resize();
};

onMounted(() => {
  initChart();
  fetchData();
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
  window.removeEventListener('resize', handleResize);
});
</script>

<style scoped lang="less">
.chart-card {
  height: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.chart-container {
  width: 100%;
  height: 320px;
}
</style>
```

### 4. 最新告警列表

**位置**: 第二行图表区域左侧

**功能说明**:
- 显示最新5条告警信息
- 不同级别的告警使用不同颜色标识
- 显示告警类型、设备信息和时间

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/AlarmListCard.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <div class="chart-title">
        <span>最新告警</span>
        <a-badge :count="newAlarmCount" :number-style="{ backgroundColor: '#ff4d4f' }">
          <span class="badge-text">{{ newAlarmCount }}个新告警</span>
        </a-badge>
      </div>
    </template>

    <div class="alarm-list">
      <div
        v-for="alarm in alarmList"
        :key="alarm.id"
        class="alarm-item"
        :class="`alarm-item-${alarm.level}`"
      >
        <div class="alarm-header">
          <span class="alarm-title">{{ alarm.title }}</span>
          <span class="alarm-time">{{ alarm.time }}</span>
        </div>
        <div class="alarm-content">{{ alarm.content }}</div>
      </div>

      <a-empty v-if="alarmList.length === 0" description="暂无告警" :image="Empty.PRESENTED_IMAGE_SIMPLE" />
    </div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import { Empty } from 'ant-design-vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const alarmList = ref([]);
const newAlarmCount = ref(0);

// 获取最新告警
const fetchAlarms = async () => {
  try {
    const response = await overviewApi.getLatestAlarms(5);

    if (response.data) {
      alarmList.value = response.data.list || [];
      newAlarmCount.value = response.data.newCount || 0;
    }
  } catch (error) {
    console.error('获取告警列表失败:', error);
  }
};

// 轮询更新告警
let pollingTimer = null;

const startPolling = () => {
  fetchAlarms();
  pollingTimer = setInterval(() => {
    fetchAlarms();
  }, 10000); // 10秒更新一次
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
  }
});
</script>

<style scoped lang="less">
.chart-card {
  height: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.badge-text {
  color: #8c8c8c;
  font-size: 12px;
}

.alarm-list {
  max-height: 360px;
  overflow-y: auto;
}

.alarm-item {
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 12px;
  border-left: 4px solid;
  transition: all 0.3s ease;

  &:hover {
    transform: translateX(4px);
  }

  &:last-child {
    margin-bottom: 0;
  }
}

.alarm-item-error {
  background: #fff1f0;
  border-color: #ff4d4f;
}

.alarm-item-warning {
  background: #fffbe6;
  border-color: #faad14;
}

.alarm-item-info {
  background: #e6f7ff;
  border-color: #1890ff;
}

.alarm-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.alarm-title {
  font-weight: 500;
  color: #262626;
  font-size: 14px;
}

.alarm-time {
  font-size: 12px;
  color: #8c8c8c;
}

.alarm-content {
  font-size: 13px;
  color: #595959;
  line-height: 1.5;
}
</style>
```

### 5. 系统状态监控

**位置**: 第二行图表区域右侧

**功能说明**:
- 显示系统资源使用情况（CPU、内存、磁盘、网络）
- 实时更新系统状态
- 使用进度条显示资源占用率

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/SystemStatusCard.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <div class="chart-title">
        <span>系统状态</span>
        <a-tag :color="systemStatus === '正常' ? 'success' : 'error'">
          <template #icon>
            <CheckCircleOutlined v-if="systemStatus === '正常'" />
            <CloseCircleOutlined v-else />
          </template>
          {{ systemStatus }}
        </a-tag>
      </div>
    </template>

    <div class="status-list">
      <div class="status-item" v-for="item in resourceData" :key="item.key">
        <div class="status-header">
          <span class="status-label">{{ item.label }}</span>
          <span class="status-value" :class="getValueClass(item.usage)">{{ item.value }}</span>
        </div>
        <a-progress
          :percent="item.usage"
          :stroke-color="getProgressColor(item.usage)"
          :show-info="false"
          :stroke-width="8"
        />
      </div>
    </div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted, computed } from 'vue';
import { CheckCircleOutlined, CloseCircleOutlined } from '@ant-design/icons-vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const resourceData = ref([
  { key: 'cpu', label: 'CPU使用率', value: '32%', usage: 32 },
  { key: 'memory', label: '内存使用率', value: '58%', usage: 58 },
  { key: 'disk', label: '磁盘使用率', value: '45%', usage: 45 },
  { key: 'network', label: '网络带宽', value: '1.2Gbps', usage: 60 },
]);

const systemStatus = computed(() => {
  const maxUsage = Math.max(...resourceData.value.map(item => item.usage));
  return maxUsage < 80 ? '正常' : '告警';
});

// 获取进度条颜色
const getProgressColor = (usage) => {
  if (usage < 60) return '#52c41a';
  if (usage < 80) return '#faad14';
  return '#ff4d4f';
};

// 获取数值样式类
const getValueClass = (usage) => {
  if (usage < 60) return 'value-normal';
  if (usage < 80) return 'value-warning';
  return 'value-danger';
};

// 获取系统资源数据
const fetchSystemResources = async () => {
  try {
    const response = await overviewApi.getSystemResources();

    if (response.data) {
      resourceData.value = [
        {
          key: 'cpu',
          label: 'CPU使用率',
          value: `${response.data.cpu}%`,
          usage: response.data.cpu,
        },
        {
          key: 'memory',
          label: '内存使用率',
          value: `${response.data.memory}%`,
          usage: response.data.memory,
        },
        {
          key: 'disk',
          label: '磁盘使用率',
          value: `${response.data.disk}%`,
          usage: response.data.disk,
        },
        {
          key: 'network',
          label: '网络带宽',
          value: response.data.network,
          usage: response.data.networkUsage || 60,
        },
      ];
    }
  } catch (error) {
    console.error('获取系统资源数据失败:', error);
  }
};

// 轮询更新
let pollingTimer = null;

const startPolling = () => {
  fetchSystemResources();
  pollingTimer = setInterval(() => {
    fetchSystemResources();
  }, 5000); // 5秒更新一次
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
  }
});
</script>

<style scoped lang="less">
.chart-card {
  height: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.status-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.status-item {
  padding: 12px;
  background: #fafafa;
  border-radius: 6px;
}

.status-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.status-label {
  font-size: 13px;
  color: #8c8c8c;
}

.status-value {
  font-size: 14px;
  font-weight: 500;

  &.value-normal {
    color: #52c41a;
  }

  &.value-warning {
    color: #faad14;
  }

  &.value-danger {
    color: #ff4d4f;
  }
}
</style>
```

### 6. 设备类型分布图表（柱状图）

**位置**: 第三行图表区域右侧

**功能说明**:
- 展示各类型设备的数量分布
- 不同设备类型使用不同颜色
- 支持鼠标悬浮查看详情

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/DeviceTypeChart.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>设备类型分布</template>

    <div ref="chartRef" class="chart-container"></div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import * as echarts from 'echarts';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const chartRef = ref(null);
let chartInstance = null;

const chartData = ref({
  categories: ['网络摄像头', '模拟摄像头', 'NVR', 'DVR', '智能分析设备'],
  values: [120, 25, 8, 4, 3],
});

// 初始化图表
const initChart = () => {
  if (!chartRef.value) return;

  chartInstance = echarts.init(chartRef.value);

  const option = {
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'shadow',
      },
      formatter: '{b}: {c}台',
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      top: '5%',
      containLabel: true,
    },
    xAxis: {
      type: 'category',
      data: chartData.value.categories,
      axisLine: {
        lineStyle: {
          color: '#e8e8e8',
        },
      },
      axisLabel: {
        color: '#8c8c8c',
        fontSize: 12,
        rotate: 15,
      },
    },
    yAxis: {
      type: 'value',
      axisLine: {
        show: false,
      },
      axisTick: {
        show: false,
      },
      axisLabel: {
        color: '#8c8c8c',
        fontSize: 12,
        formatter: '{value}台',
      },
      splitLine: {
        lineStyle: {
          color: '#f0f0f0',
        },
      },
    },
    series: [
      {
        name: '设备数量',
        type: 'bar',
        barWidth: '50%',
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: '#1890ff' },
            { offset: 1, color: '#69c0ff' },
          ]),
          borderRadius: [4, 4, 0, 0],
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#096dd9' },
              { offset: 1, color: '#1890ff' },
            ]),
          },
        },
        data: chartData.value.values,
      },
    ],
  };

  chartInstance.setOption(option);
};

// 获取设备类型分布数据
const fetchData = async () => {
  try {
    const response = await overviewApi.getDeviceTypeDistribution();

    if (response.data) {
      chartData.value = {
        categories: response.data.categories || chartData.value.categories,
        values: response.data.values || chartData.value.values,
      };

      // 更新图表
      if (chartInstance) {
        chartInstance.setOption({
          xAxis: {
            data: chartData.value.categories,
          },
          series: [{
            data: chartData.value.values,
          }],
        });
      }
    }
  } catch (error) {
    console.error('获取设备类型分布数据失败:', error);
  }
};

// 监听窗口大小变化
const handleResize = () => {
  chartInstance?.resize();
};

onMounted(() => {
  initChart();
  fetchData();
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }
  window.removeEventListener('resize', handleResize);
});
</script>

<style scoped lang="less">
.chart-card {
  height: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-container {
  width: 100%;
  height: 320px;
}
</style>
```

### 7. 任务队列状态

**位置**: 第三行图表区域左侧

**功能说明**:
- 显示当前系统中的任务队列状态
- 不同任务类型及其运行状态
- 支持查看任务详情

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/TaskQueueCard.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>
      <div class="chart-title">
        <span>任务队列</span>
        <a-button size="small" @click="showTaskDetails">
          <template #icon><UnorderedListOutlined /></template>
          详情
        </a-button>
      </div>
    </template>

    <div class="task-list">
      <div class="task-item" v-for="task in taskList" :key="task.id">
        <div class="task-info">
          <div class="task-name">{{ task.name }}</div>
          <div class="task-queue">队列中: {{ task.queueCount }}个任务</div>
        </div>
        <a-tag :color="getTaskStatusColor(task.status)">{{ task.statusText }}</a-tag>
      </div>

      <a-empty v-if="taskList.length === 0" description="暂无任务" :image="Empty.PRESENTED_IMAGE_SIMPLE" />
    </div>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import { message, Empty } from 'ant-design-vue';
import { UnorderedListOutlined } from '@ant-design/icons-vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const taskList = ref([]);

// 获取任务队列数据
const fetchTaskQueue = async () => {
  try {
    const response = await overviewApi.getTaskQueueStatus();

    if (response.data) {
      taskList.value = response.data.tasks || [];
    }
  } catch (error) {
    console.error('获取任务队列数据失败:', error);
  }
};

// 获取任务状态颜色
const getTaskStatusColor = (status) => {
  const colorMap = {
    running: 'processing',
    waiting: 'warning',
    completed: 'success',
    failed: 'error',
  };
  return colorMap[status] || 'default';
};

// 显示任务详情
const showTaskDetails = () => {
  message.info('任务详情功能开发中...');
};

// 轮询更新
let pollingTimer = null;

const startPolling = () => {
  fetchTaskQueue();
  pollingTimer = setInterval(() => {
    fetchTaskQueue();
  }, 10000); // 10秒更新一次
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
  }
});
</script>

<style scoped lang="less">
.chart-card {
  height: 100%;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.task-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.task-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: #fafafa;
  border-radius: 6px;
  transition: all 0.3s ease;

  &:hover {
    background: #f0f0f0;
  }
}

.task-info {
  flex: 1;
}

.task-name {
  font-size: 14px;
  font-weight: 500;
  color: #262626;
  margin-bottom: 4px;
}

.task-queue {
  font-size: 12px;
  color: #8c8c8c;
}
</style>
```

### 8. 存储使用详情

**位置**: 页面底部，全宽显示

**功能说明**:
- 显示主存储、备份存储、缓存存储的使用情况
- 使用进度条展示存储使用率
- 显示具体的已使用和总容量

**技术实现**:
```vue
<!-- src/views/business/smart-video/components/StorageStatusCard.vue -->
<template>
  <a-card :bordered="false" class="chart-card">
    <template #title>存储使用详情</template>

    <a-row :gutter="16">
      <a-col :xs="24" :md="8" v-for="storage in storageData" :key="storage.key">
        <div class="storage-item">
          <div class="storage-label">{{ storage.label }}</div>
          <div class="storage-info">
            <span class="storage-usage">已使用</span>
            <span class="storage-value">{{ storage.used }} / {{ storage.total }}</span>
          </div>
          <a-progress
            :percent="storage.usage"
            :stroke-color="getProgressColor(storage.usage)"
            :show-info="false"
            :stroke-width="8"
          />
        </div>
      </a-col>
    </a-row>
  </a-card>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

const storageData = ref([
  { key: 'main', label: '主存储', used: '8.5TB', total: '10TB', usage: 85 },
  { key: 'backup', label: '备份存储', used: '12TB', total: '20TB', usage: 60 },
  { key: 'cache', label: '缓存存储', used: '2.1TB', total: '5TB', usage: 42 },
]);

// 获取进度条颜色
const getProgressColor = (usage) => {
  if (usage < 60) return '#52c41a';
  if (usage < 80) return '#faad14';
  return '#ff4d4f';
};

// 获取存储使用数据
const fetchStorageData = async () => {
  try {
    const response = await overviewApi.getStorageUsage();

    if (response.data) {
      storageData.value = [
        {
          key: 'main',
          label: '主存储',
          used: response.data.main.used,
          total: response.data.main.total,
          usage: response.data.main.usage,
        },
        {
          key: 'backup',
          label: '备份存储',
          used: response.data.backup.used,
          total: response.data.backup.total,
          usage: response.data.backup.usage,
        },
        {
          key: 'cache',
          label: '缓存存储',
          used: response.data.cache.used,
          total: response.data.cache.total,
          usage: response.data.cache.usage,
        },
      ];
    }
  } catch (error) {
    console.error('获取存储数据失败:', error);
  }
};

// 轮询更新
let pollingTimer = null;

const startPolling = () => {
  fetchStorageData();
  pollingTimer = setInterval(() => {
    fetchStorageData();
  }, 30000); // 30秒更新一次
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
  }
});
</script>

<style scoped lang="less">
.chart-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-top: 16px;
}

.storage-item {
  padding: 16px;
  background: #fafafa;
  border-radius: 8px;
}

.storage-label {
  font-size: 13px;
  color: #8c8c8c;
  margin-bottom: 12px;
}

.storage-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.storage-usage {
  font-size: 13px;
  color: #8c8c8c;
}

.storage-value {
  font-size: 14px;
  font-weight: 500;
  color: #262626;
}
</style>
```

## 完整页面组装

```vue
<!-- src/views/business/smart-video/system-overview.vue -->
<template>
  <div class="system-overview-page">
    <!-- KPI指标卡片 -->
    <a-row :gutter="[16, 16]">
      <a-col :xs="24" :sm="12" :lg="6" v-for="kpi in kpiData" :key="kpi.key">
        <a-card :bordered="false" class="kpi-card" :class="`kpi-card-${kpi.type}`">
          <div class="kpi-card-content">
            <div class="kpi-icon">
              <component :is="kpi.icon" class="icon" />
            </div>
            <div class="kpi-info">
              <div class="kpi-label">{{ kpi.label }}</div>
              <div class="kpi-value">{{ kpi.value }}</div>
              <div class="kpi-trend" :class="kpi.trend > 0 ? 'trend-up' : 'trend-down'">
                <component :is="kpi.trend > 0 ? ArrowUpOutlined : ArrowDownOutlined" />
                <span>{{ kpi.trendText }}</span>
              </div>
            </div>
          </div>
        </a-card>
      </a-col>
    </a-row>

    <!-- 第一行图表：设备状态 + 告警趋势 -->
    <a-row :gutter="[16, 16]" style="margin-top: 16px;">
      <a-col :xs="24" :lg="12">
        <DeviceStatusChart />
      </a-col>
      <a-col :xs="24" :lg="12">
        <AlarmTrendChart />
      </a-col>
    </a-row>

    <!-- 第二行图表：最新告警 + 系统状态 -->
    <a-row :gutter="[16, 16]" style="margin-top: 16px;">
      <a-col :xs="24" :lg="12">
        <AlarmListCard />
      </a-col>
      <a-col :xs="24" :lg="12">
        <SystemStatusCard />
      </a-col>
    </a-row>

    <!-- 第三行图表：任务队列 + 设备类型 -->
    <a-row :gutter="[16, 16]" style="margin-top: 16px;">
      <a-col :xs="24" :lg="12">
        <TaskQueueCard />
      </a-col>
      <a-col :xs="24" :lg="12">
        <DeviceTypeChart />
      </a-col>
    </a-row>

    <!-- 存储使用详情 -->
    <StorageStatusCard />
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue';
import {
  VideoCameraOutlined,
  WifiOutlined,
  BellOutlined,
  HeartOutlined,
  ArrowUpOutlined,
  ArrowDownOutlined,
} from '@ant-design/icons-vue';
import DeviceStatusChart from './components/DeviceStatusChart.vue';
import AlarmTrendChart from './components/AlarmTrendChart.vue';
import AlarmListCard from './components/AlarmListCard.vue';
import SystemStatusCard from './components/SystemStatusCard.vue';
import TaskQueueCard from './components/TaskQueueCard.vue';
import DeviceTypeChart from './components/DeviceTypeChart.vue';
import StorageStatusCard from './components/StorageStatusCard.vue';
import { overviewApi } from '/@/api/business/smart-video/overview-api';

// KPI数据
const kpiData = ref([
  {
    key: 'totalDevices',
    label: '总设备数',
    value: 160,
    trend: 3,
    trendText: '较昨日 +3',
    icon: VideoCameraOutlined,
    type: 'info',
  },
  {
    key: 'onlineDevices',
    label: '在线设备',
    value: 156,
    trend: 1,
    trendText: '在线率 97.5%',
    icon: WifiOutlined,
    type: 'success',
  },
  {
    key: 'todayAlarms',
    label: '今日告警',
    value: 23,
    trend: -5,
    trendText: '较昨日 -5',
    icon: BellOutlined,
    type: 'warning',
  },
  {
    key: 'systemStatus',
    label: '系统状态',
    value: '正常',
    trend: 1,
    trendText: '运行稳定',
    icon: HeartOutlined,
    type: 'success',
  },
]);

// 获取系统概览数据
const fetchOverviewData = async () => {
  try {
    const response = await overviewApi.getSystemOverview();
    if (response.data) {
      // 更新KPI数据
      kpiData.value[0].value = response.data.totalDevices || 160;
      kpiData.value[1].value = response.data.onlineDevices || 156;
      kpiData.value[2].value = response.data.todayAlarms || 23;
      // 更新其他数据...
    }
  } catch (error) {
    console.error('获取系统概览数据失败:', error);
  }
};

// 轮询更新
let pollingTimer = null;

const startPolling = () => {
  fetchOverviewData();
  pollingTimer = setInterval(() => {
    fetchOverviewData();
  }, 30000); // 30秒更新一次
};

onMounted(() => {
  startPolling();
});

onUnmounted(() => {
  if (pollingTimer) {
    clearInterval(pollingTimer);
  }
});
</script>

<style scoped lang="less">
.system-overview-page {
  padding: 16px;
  background: #f0f2f5;
  min-height: 100vh;
}

.kpi-card {
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  :deep(.ant-card-body) {
    padding: 20px;
  }
}

.kpi-card-content {
  display: flex;
  align-items: center;
  gap: 16px;
}

.kpi-icon {
  width: 56px;
  height: 56px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}

.kpi-card-info .kpi-icon {
  background: #e6f4ff;
  color: #1890ff;
}

.kpi-card-success .kpi-icon {
  background: #f6ffed;
  color: #52c41a;
}

.kpi-card-warning .kpi-icon {
  background: #fffbe6;
  color: #faad14;
}

.kpi-info {
  flex: 1;
}

.kpi-label {
  font-size: 14px;
  color: #8c8c8c;
  margin-bottom: 8px;
}

.kpi-value {
  font-size: 32px;
  font-weight: 600;
  color: #262626;
  line-height: 1.2;
  margin-bottom: 4px;
}

.kpi-trend {
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 4px;

  &.trend-up {
    color: #52c41a;
  }

  &.trend-down {
    color: #ff4d4f;
  }
}
</style>
```

## 路由配置

```javascript
// src/router/modules/business.js
export default [
  {
    path: '/business/smart-video',
    name: 'SmartVideo',
    component: () => import('/@/layout/index.vue'),
    meta: {
      title: '智能视频',
      icon: 'VideoCameraOutlined',
    },
    children: [
      {
        path: 'system-overview',
        name: 'SystemOverview',
        component: () => import('/@/views/business/smart-video/system-overview.vue'),
        meta: {
          title: '系统概览',
          icon: 'DashboardOutlined',
        },
      },
      // 其他子路由...
    ],
  },
];
```

## 菜单配置

```javascript
// src/constants/menu-const.js
export const MENU_CONFIG = [
  {
    menuKey: 'smart-video',
    menuName: '智能视频',
    icon: 'VideoCameraOutlined',
    children: [
      {
        menuKey: 'system-overview',
        menuName: '系统概览',
        path: '/business/smart-video/system-overview',
        icon: 'DashboardOutlined',
      },
      // 其他菜单项...
    ],
  },
];
```

## Mock数据示例

```javascript
// src/mock/business/smart-video/overview-mock.js
import { defineMock } from '/@/mock/base';

export default defineMock([
  {
    url: '/overview/system',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          totalDevices: 160,
          onlineDevices: 156,
          todayAlarms: 23,
          systemStatus: 'normal',
          totalDevicesTrend: 3,
          todayAlarmsTrend: -5,
        },
      };
    },
  },
  {
    url: '/overview/device/statistics',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          totalDevices: 160,
          onlineDevices: 156,
          offlineDevices: 2,
          faultDevices: 0,
          maintenanceDevices: 2,
          todayAlarms: 23,
          totalDevicesTrend: 3,
          todayAlarmsTrend: -5,
        },
      };
    },
  },
  {
    url: '/overview/device/status',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          online: 156,
          offline: 2,
          fault: 0,
          maintenance: 2,
        },
      };
    },
  },
  {
    url: '/overview/alarm/trend',
    method: 'post',
    response: ({ body }) => {
      const { range } = body;

      if (range === '7d') {
        return {
          code: 0,
          message: 'success',
          data: {
            dates: ['1/24', '1/25', '1/26', '1/27', '1/28', '1/29', '1/30'],
            values: [28, 32, 25, 30, 27, 22, 23],
          },
        };
      } else {
        // 30天数据
        return {
          code: 0,
          message: 'success',
          data: {
            dates: ['1/1', '1/5', '1/10', '1/15', '1/20', '1/25', '1/30'],
            values: [35, 40, 30, 38, 32, 28, 23],
          },
        };
      }
    },
  },
  {
    url: '/overview/alarm/latest',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          newCount: 5,
          list: [
            {
              id: 1,
              title: '设备离线告警',
              content: '摄像头-大厅-01 设备连接异常',
              time: '刚刚',
              level: 'error',
            },
            {
              id: 2,
              title: '存储空间告警',
              content: 'NVR-01 存储空间使用率超过85%',
              time: '5分钟前',
              level: 'warning',
            },
            {
              id: 3,
              title: '智能分析告警',
              content: '检测到异常徘徊行为',
              time: '10分钟前',
              level: 'info',
            },
            {
              id: 4,
              title: '设备重启',
              content: '摄像头-停车场-03 自动重启完成',
              time: '15分钟前',
              level: 'error',
            },
            {
              id: 5,
              title: '网络延迟告警',
              content: '网络摄像头-厂区-02 网络延迟超过阈值',
              time: '20分钟前',
              level: 'warning',
            },
          ],
        },
      };
    },
  },
  {
    url: '/overview/system/resources',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          cpu: 32,
          memory: 58,
          disk: 45,
          network: '1.2Gbps',
          networkUsage: 60,
        },
      };
    },
  },
  {
    url: '/overview/task/queue',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          tasks: [
            {
              id: 1,
              name: '视频分析任务',
              queueCount: 12,
              status: 'running',
              statusText: '运行中',
            },
            {
              id: 2,
              name: '录像备份任务',
              queueCount: 5,
              status: 'waiting',
              statusText: '等待中',
            },
            {
              id: 3,
              name: '设备检测任务',
              queueCount: 8,
              status: 'running',
              statusText: '运行中',
            },
            {
              id: 4,
              name: '日志清理任务',
              queueCount: 3,
              status: 'completed',
              statusText: '已完成',
            },
          ],
        },
      };
    },
  },
  {
    url: '/overview/device/type',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          categories: ['网络摄像头', '模拟摄像头', 'NVR', 'DVR', '智能分析设备'],
          values: [120, 25, 8, 4, 3],
        },
      };
    },
  },
  {
    url: '/overview/storage',
    method: 'get',
    response: () => {
      return {
        code: 0,
        message: 'success',
        data: {
          main: {
            used: '8.5TB',
            total: '10TB',
            usage: 85,
          },
          backup: {
            used: '12TB',
            total: '20TB',
            usage: 60,
          },
          cache: {
            used: '2.1TB',
            total: '5TB',
            usage: 42,
          },
        },
      };
    },
  },
]);
```

## WebSocket实时数据推送（可选）

```javascript
// src/utils/websocket.js
class WebSocketClient {
  constructor(url) {
    this.url = url;
    this.ws = null;
    this.reconnectTimer = null;
    this.reconnectDelay = 5000;
    this.listeners = new Map();
  }

  connect() {
    try {
      this.ws = new WebSocket(this.url);

      this.ws.onopen = () => {
        console.log('WebSocket连接成功');
        this.clearReconnectTimer();
      };

      this.ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          this.notifyListeners(data.type, data.payload);
        } catch (error) {
          console.error('解析WebSocket消息失败:', error);
        }
      };

      this.ws.onerror = (error) => {
        console.error('WebSocket错误:', error);
      };

      this.ws.onclose = () => {
        console.log('WebSocket连接关闭');
        this.reconnect();
      };
    } catch (error) {
      console.error('WebSocket连接失败:', error);
      this.reconnect();
    }
  }

  reconnect() {
    if (this.reconnectTimer) return;

    this.reconnectTimer = setTimeout(() => {
      console.log('尝试重新连接WebSocket...');
      this.connect();
    }, this.reconnectDelay);
  }

  clearReconnectTimer() {
    if (this.reconnectTimer) {
      clearTimeout(this.reconnectTimer);
      this.reconnectTimer = null;
    }
  }

  subscribe(eventType, callback) {
    if (!this.listeners.has(eventType)) {
      this.listeners.set(eventType, []);
    }
    this.listeners.get(eventType).push(callback);
  }

  unsubscribe(eventType, callback) {
    if (!this.listeners.has(eventType)) return;

    const callbacks = this.listeners.get(eventType);
    const index = callbacks.indexOf(callback);
    if (index !== -1) {
      callbacks.splice(index, 1);
    }
  }

  notifyListeners(eventType, data) {
    if (!this.listeners.has(eventType)) return;

    this.listeners.get(eventType).forEach(callback => {
      try {
        callback(data);
      } catch (error) {
        console.error('执行回调函数失败:', error);
      }
    });
  }

  send(data) {
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(data));
    }
  }

  close() {
    this.clearReconnectTimer();
    if (this.ws) {
      this.ws.close();
      this.ws = null;
    }
  }
}

// 使用示例
export const createWebSocketClient = (url) => {
  return new WebSocketClient(url);
};
```

**在组件中使用WebSocket**:
```vue
<script setup>
import { onMounted, onUnmounted } from 'vue';
import { createWebSocketClient } from '/@/utils/websocket';

let wsClient = null;

onMounted(() => {
  // 连接WebSocket
  wsClient = createWebSocketClient('ws://localhost:8080/ws/overview');
  wsClient.connect();

  // 订阅设备状态更新事件
  wsClient.subscribe('device-status-update', (data) => {
    console.log('设备状态更新:', data);
    // 更新设备状态数据...
  });

  // 订阅告警事件
  wsClient.subscribe('alarm-update', (data) => {
    console.log('新告警:', data);
    // 更新告警列表...
  });

  // 订阅系统资源更新事件
  wsClient.subscribe('system-resource-update', (data) => {
    console.log('系统资源更新:', data);
    // 更新系统资源数据...
  });
});

onUnmounted(() => {
  if (wsClient) {
    wsClient.close();
    wsClient = null;
  }
});
</script>
```

## 最佳实践建议

### 1. 性能优化
- **图表懒加载**: 使用`v-if`配合`IntersectionObserver`实现图表的懒加载
- **数据缓存**: 对于变化不频繁的数据（如设备类型分布），实现本地缓存
- **防抖与节流**: 对窗口resize、数据更新等操作进行防抖/节流处理
- **虚拟列表**: 告警列表数据量大时使用虚拟滚动

### 2. 用户体验
- **加载状态**: 所有异步操作都应显示加载状态
- **错误处理**: 数据加载失败时显示友好的错误提示
- **空状态**: 无数据时显示Empty组件
- **响应式设计**: 确保在不同屏幕尺寸下都有良好的显示效果

### 3. 数据实时性
- **轮询间隔**: 根据数据重要性设置不同的轮询间隔
  - KPI数据: 30秒
  - 告警数据: 10秒
  - 系统资源: 5秒
- **页面可见性**: 页面隐藏时停止轮询，节省资源
- **WebSocket**: 对实时性要求高的场景使用WebSocket

### 4. 代码组织
- **组件拆分**: 将复杂页面拆分为多个小组件，提高可维护性
- **Hook复用**: 将通用逻辑（如轮询、WebSocket）封装为Hook
- **常量管理**: 将图表颜色、轮询间隔等配置统一管理

### 5. 测试建议
- **单元测试**: 测试数据处理逻辑
- **组件测试**: 测试组件渲染和交互
- **集成测试**: 测试数据流和API调用
- **E2E测试**: 测试完整的用户操作流程

## 常见问题与解决方案

### 问题1：图表不显示或显示异常
**原因**:
- 容器尺寸为0
- 数据格式不正确
- ECharts未正确初始化

**解决方案**:
```vue
<script setup>
// 确保容器有明确的尺寸
const chartRef = ref(null);

onMounted(() => {
  // 等待DOM更新完成后再初始化图表
  nextTick(() => {
    if (chartRef.value) {
      initChart();
    }
  });
});
</script>

<style scoped>
.chart-container {
  width: 100%;
  height: 400px; /* 明确指定高度 */
}
</style>
```

### 问题2：内存泄漏
**原因**:
- 定时器未清理
- 图表实例未销毁
- 事件监听器未移除

**解决方案**:
```vue
<script setup>
let pollingTimer = null;
let chartInstance = null;

onMounted(() => {
  // 启动轮询
  pollingTimer = setInterval(() => {
    fetchData();
  }, 5000);

  // 初始化图表
  chartInstance = echarts.init(chartRef.value);

  // 添加事件监听
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  // ✅ 清理定时器
  if (pollingTimer) {
    clearInterval(pollingTimer);
    pollingTimer = null;
  }

  // ✅ 销毁图表
  if (chartInstance) {
    chartInstance.dispose();
    chartInstance = null;
  }

  // ✅ 移除事件监听
  window.removeEventListener('resize', handleResize);
});
</script>
```

### 问题3：响应式布局问题
**原因**:
- 未使用响应式单位
- Grid断点设置不合理

**解决方案**:
```vue
<template>
  <!-- 使用Ant Design的响应式Grid -->
  <a-row :gutter="[16, 16]">
    <a-col
      :xs="24"    <!-- 手机：1列 -->
      :sm="12"    <!-- 平板：2列 -->
      :md="8"     <!-- 小屏：3列 -->
      :lg="6"     <!-- 大屏：4列 -->
      v-for="item in items"
      :key="item.id"
    >
      <CardComponent :data="item" />
    </a-col>
  </a-row>
</template>
```

### 问题4：数据更新不及时
**原因**:
- 轮询间隔过长
- 数据未使用响应式
- 图表未更新

**解决方案**:
```vue
<script setup>
import { ref, watch } from 'vue';

const chartData = ref([]);

// 监听数据变化，自动更新图表
watch(chartData, (newData) => {
  if (chartInstance) {
    chartInstance.setOption({
      series: [{ data: newData }]
    }, { notMerge: false }); // 使用合并模式
  }
}, { deep: true });

// 更新数据
const updateData = (newData) => {
  // ✅ 使用 .value 更新响应式数据
  chartData.value = newData;
};
</script>
```

## 总结

系统概览页面是智能视频监控系统的核心展示页面，通过合理的布局设计、高效的数据更新机制和优秀的用户体验，为管理人员提供全面的系统监控视图。在开发过程中需要特别注意：

1. **图表生命周期管理** - 正确初始化和销毁图表实例
2. **实时数据更新** - 合理使用轮询或WebSocket实现数据实时性
3. **性能优化** - 避免频繁的DOM操作和不必要的渲染
4. **响应式设计** - 确保在不同设备上都有良好的显示效果
5. **错误处理** - 完善的错误处理和用户提示机制

遵循本文档的规范和最佳实践，可以快速开发出高质量、高性能的系统概览页面。
