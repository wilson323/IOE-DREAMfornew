# ç›‘æŽ§å‘Šè­¦æœºåˆ¶éƒ¨ç½²æŒ‡å—

**ç”Ÿæˆæ—¶é—´**: 2025-01-30  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… **é…ç½®å®Œæˆï¼Œå¾…éƒ¨ç½²**

---

## ðŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›IOE-DREAMé¡¹ç›®ç›‘æŽ§å‘Šè­¦æœºåˆ¶çš„å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼ŒåŒ…æ‹¬Prometheusã€AlertManagerå’ŒGrafanaçš„é…ç½®å’Œéƒ¨ç½²æ­¥éª¤ã€‚

---

## ðŸŽ¯ éƒ¨ç½²æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Services   â”‚â”€â”€â”€â”€â–¶â”‚ Prometheus  â”‚â”€â”€â”€â”€â–¶â”‚ AlertManagerâ”‚
â”‚ (Metrics)  â”‚     â”‚  (Collect)  â”‚     â”‚  (Alert)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Grafana    â”‚
                                    â”‚ (Visualize) â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ é…ç½®æ–‡ä»¶ä½ç½®

### 1. Prometheusé…ç½®

**é…ç½®æ–‡ä»¶**: `deployment/monitoring/prometheus/prometheus.yml`

**å‘Šè­¦è§„åˆ™**: `deployment/monitoring/prometheus/rules/protocol_alerts.yml`

### 2. AlertManageré…ç½®

**é…ç½®æ–‡ä»¶**: `deployment/monitoring/alertmanager/alertmanager.yml`

### 3. Docker Composeé…ç½®

**é…ç½®æ–‡ä»¶**: `deployment/monitoring/docker-compose-monitoring.yml`

---

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: å‡†å¤‡é…ç½®æ–‡ä»¶

1. **åˆ›å»ºç›‘æŽ§ç›®å½•ç»“æž„**:
```bash
mkdir -p deployment/monitoring/{prometheus/rules,alertmanager,grafana/{dashboards,datasources}}
```

2. **å¤åˆ¶é…ç½®æ–‡ä»¶**:
   - `prometheus.yml` â†’ `deployment/monitoring/prometheus/`
   - `protocol_alerts.yml` â†’ `deployment/monitoring/prometheus/rules/`
   - `alertmanager.yml` â†’ `deployment/monitoring/alertmanager/`
   - `docker-compose-monitoring.yml` â†’ `deployment/monitoring/`

### æ­¥éª¤2: é…ç½®å‘Šè­¦é€šçŸ¥

**ç¼–è¾‘ `alertmanager.yml`**:

1. **é…ç½®SMTPæœåŠ¡å™¨**:
```yaml
global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alertmanager@ioedream.com'
  smtp_auth_username: 'alertmanager@ioedream.com'
  smtp_auth_password: 'your-password-here'
```

2. **é…ç½®é’‰é’‰æœºå™¨äºº**:
   - åœ¨é’‰é’‰ç¾¤ä¸­åˆ›å»ºè‡ªå®šä¹‰æœºå™¨äºº
   - èŽ·å–Webhook URL
   - æ›¿æ¢ `alertmanager.yml` ä¸­çš„ `your-dingtalk-token`

3. **é…ç½®æŽ¥æ”¶äººé‚®ç®±**:
   - ä¿®æ”¹ `to` å­—æ®µä¸ºå®žé™…æŽ¥æ”¶äººé‚®ç®±

### æ­¥éª¤3: å¯åŠ¨ç›‘æŽ§æœåŠ¡

```bash
cd deployment/monitoring
docker-compose -f docker-compose-monitoring.yml up -d
```

### æ­¥éª¤4: éªŒè¯éƒ¨ç½²

1. **æ£€æŸ¥Prometheus**:
   - è®¿é—®: `http://localhost:9090`
   - æ£€æŸ¥Targets: `http://localhost:9090/targets`
   - æ£€æŸ¥Alerts: `http://localhost:9090/alerts`

2. **æ£€æŸ¥AlertManager**:
   - è®¿é—®: `http://localhost:9093`
   - æ£€æŸ¥Alerts: `http://localhost:9093/#/alerts`

3. **æ£€æŸ¥Grafana**:
   - è®¿é—®: `http://localhost:3000`
   - é»˜è®¤è´¦å·: `admin` / `admin123`
   - é…ç½®Prometheusæ•°æ®æº

---

## ðŸ“Š å‘Šè­¦è§„åˆ™è¯´æ˜Ž

### 1. åè®®å¤„ç†å¤±è´¥çŽ‡å‘Šè­¦

- **Warning**: å¤±è´¥çŽ‡ > 10%ï¼ŒæŒç»­5åˆ†é’Ÿ
- **Critical**: å¤±è´¥çŽ‡ > 30%ï¼ŒæŒç»­2åˆ†é’Ÿ

### 2. åè®®å¤„ç†å»¶è¿Ÿå‘Šè­¦

- **Warning**: P99å»¶è¿Ÿ > 2ç§’ï¼ŒæŒç»­5åˆ†é’Ÿ
- **Critical**: P99å»¶è¿Ÿ > 5ç§’ï¼ŒæŒç»­2åˆ†é’Ÿ

### 3. æ¶ˆæ¯é˜Ÿåˆ—ç§¯åŽ‹å‘Šè­¦

- **Warning**: é˜Ÿåˆ—ç§¯åŽ‹ > 5000æ¡ï¼ŒæŒç»­5åˆ†é’Ÿ
- **Critical**: é˜Ÿåˆ—ç§¯åŽ‹ > 10000æ¡ï¼ŒæŒç»­2åˆ†é’Ÿ

### 4. æœåŠ¡ç†”æ–­å‘Šè­¦

- **Critical**: ç†”æ–­å™¨æ‰“å¼€ï¼ŒæŒç»­1åˆ†é’Ÿ

### 5. é™æµè§¦å‘å‘Šè­¦

- **Warning**: 5åˆ†é’Ÿå†…é™æµè§¦å‘ > 10æ¬¡

### 6. ç¼“å­˜å‘½ä¸­çŽ‡å‘Šè­¦

- **Warning**: ç¼“å­˜å‘½ä¸­çŽ‡ < 70%ï¼ŒæŒç»­10åˆ†é’Ÿ

---

## ðŸ”” å‘Šè­¦é€šçŸ¥æ¸ é“

### 1. é‚®ä»¶é€šçŸ¥

- **é»˜è®¤å‘Šè­¦**: `devops@ioedream.com`
- **ä¸¥é‡å‘Šè­¦**: `devops@ioedream.com`, `oncall@ioedream.com`
- **åè®®å‘Šè­¦**: `protocol-team@ioedream.com`

### 2. é’‰é’‰é€šçŸ¥

- é…ç½®é’‰é’‰æœºå™¨äººWebhook
- æ”¯æŒä¸¥é‡å‘Šè­¦å’Œåè®®å‘Šè­¦

### 3. çŸ­ä¿¡é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

- é€šè¿‡çŸ­ä¿¡ç½‘å…³API
- ä»…ç”¨äºŽä¸¥é‡å‘Šè­¦

---

## ðŸ§ª æµ‹è¯•å‘Šè­¦

### æ–¹æ³•1: ä½¿ç”¨Prometheus UI

1. è®¿é—® `http://localhost:9090/alerts`
2. æŸ¥çœ‹å‘Šè­¦è§„åˆ™çŠ¶æ€
3. æ‰‹åŠ¨è§¦å‘å‘Šè­¦ï¼ˆä¿®æ”¹é˜ˆå€¼ï¼‰

### æ–¹æ³•2: ä½¿ç”¨curlæµ‹è¯•AlertManager

```bash
curl -XPOST http://localhost:9093/api/v1/alerts -d '[
  {
    "labels": {
      "alertname": "TestAlert",
      "severity": "warning",
      "service": "device-comm-service"
    },
    "annotations": {
      "summary": "æµ‹è¯•å‘Šè­¦",
      "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‘Šè­¦"
    }
  }
]'
```

---

## ðŸ“ˆ Grafanaä»ªè¡¨æ¿é…ç½®

### 1. æ·»åŠ Prometheusæ•°æ®æº

1. ç™»å½•Grafana: `http://localhost:3000`
2. è¿›å…¥: Configuration â†’ Data Sources
3. æ·»åŠ Prometheusæ•°æ®æº:
   - URL: `http://prometheus:9090`
   - Access: Server (default)

### 2. åˆ›å»ºç›‘æŽ§ä»ªè¡¨æ¿

**æŽ¨èä»ªè¡¨æ¿**:
- åè®®å¤„ç†æ€§èƒ½ç›‘æŽ§
- ç³»ç»Ÿèµ„æºç›‘æŽ§
- å‘Šè­¦ç»Ÿè®¡é¢æ¿
- æœåŠ¡å¥åº·çŠ¶æ€é¢æ¿

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] Prometheusé…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] å‘Šè­¦è§„åˆ™æ–‡ä»¶å·²åˆ›å»º
- [ ] AlertManageré…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] SMTPæœåŠ¡å™¨å·²é…ç½®
- [ ] é’‰é’‰æœºå™¨äººå·²é…ç½®
- [ ] æŽ¥æ”¶äººé‚®ç®±å·²é…ç½®
- [ ] Docker Composeæ–‡ä»¶å·²é…ç½®
- [ ] ç›‘æŽ§æœåŠ¡å·²å¯åŠ¨
- [ ] Prometheus Targetsæ­£å¸¸
- [ ] AlertManageræ­£å¸¸
- [ ] Grafanaæ•°æ®æºå·²é…ç½®
- [ ] å‘Šè­¦è§„åˆ™å·²æµ‹è¯•

---

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### é—®é¢˜1: Prometheusæ— æ³•é‡‡é›†æŒ‡æ ‡

**æ£€æŸ¥é¡¹**:
1. æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. `/actuator/prometheus` ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®
3. ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜2: å‘Šè­¦æœªè§¦å‘

**æ£€æŸ¥é¡¹**:
1. å‘Šè­¦è§„åˆ™è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®
2. æŒ‡æ ‡åç§°æ˜¯å¦åŒ¹é…
3. é˜ˆå€¼è®¾ç½®æ˜¯å¦åˆç†

### é—®é¢˜3: å‘Šè­¦é€šçŸ¥æœªå‘é€

**æ£€æŸ¥é¡¹**:
1. SMTPæœåŠ¡å™¨é…ç½®æ˜¯å¦æ­£ç¡®
2. é’‰é’‰æœºå™¨äººWebhookæ˜¯å¦æœ‰æ•ˆ
3. æŽ¥æ”¶äººé‚®ç®±æ˜¯å¦æ­£ç¡®

---

## ðŸ“ ç»´æŠ¤å»ºè®®

### 1. å®šæœŸæ£€æŸ¥

- æ¯å‘¨æ£€æŸ¥å‘Šè­¦è§„åˆ™æœ‰æ•ˆæ€§
- æ¯æœˆå®¡æŸ¥å‘Šè­¦é˜ˆå€¼åˆç†æ€§
- æ¯å­£åº¦ä¼˜åŒ–å‘Šè­¦è§„åˆ™

### 2. å‘Šè­¦ä¼˜åŒ–

- æ ¹æ®å®žé™…ä¸šåŠ¡è°ƒæ•´é˜ˆå€¼
- ä¼˜åŒ–å‘Šè­¦é€šçŸ¥æ¸ é“
- å»ºç«‹å‘Šè­¦å¤„ç†æµç¨‹

### 3. æ€§èƒ½ä¼˜åŒ–

- ç›‘æŽ§Prometheuså­˜å‚¨ä½¿ç”¨
- ä¼˜åŒ–å‘Šè­¦è§„åˆ™æŸ¥è¯¢æ€§èƒ½
- å®šæœŸæ¸…ç†åŽ†å²æ•°æ®

---

**æ–‡æ¡£ç”Ÿæˆäºº**: IOE-DREAM æž¶æž„å§”å‘˜ä¼š  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… é…ç½®å®Œæˆï¼Œå¾…éƒ¨ç½²

