# 设备管理模块规格

## ADDED Requirements

### 需求1：设备添加功能
**优先级**：高
**描述**：支持手动添加Pull设备和自动发现Push设备的新增功能

#### 场景1.1：手动添加Pull设备
**Given** 用户具有设备管理权限
**When** 用户在设备管理页面点击"新增设备"并选择Pull设备类型
**And** 用户填写设备基本信息（设备编号、设备名称、IP地址、端口等）
**And** 用户选择关联的区域
**Then** 系统验证设备参数的有效性
**And** 系统测试设备连接可达性
**And** 系统保存设备信息到数据库
**And** 系统自动同步设备的门信息和读头信息
**And** 系统返回设备添加成功的响应

#### 场景1.2：自动发现Push设备
**Given** 用户具有设备管理权限
**When** 用户在设备管理页面点击"搜索设备"
**Then** 系统在网络内搜索可用的门禁设备
**And** 系统显示搜索结果列表（包含设备IP、MAC地址、设备型号等）
**And** 用户可以选择一个或多个设备进行添加
**And** 系统自动获取设备的完整配置信息
**And** 系统将设备信息保存到数据库

### 需求2：设备控制功能
**优先级**：高
**描述**：提供远程控制设备的操作功能

#### 场景2.1：远程开门
**Given** 设备在线状态正常
**And** 用户具有该设备的远程开门权限
**When** 用户在设备管理界面点击"远程开门"
**And** 用户填写操作原因（可选）
**Then** 系统验证用户权限
**And** 系统向设备发送开门命令
**And** 系统记录操作日志
**And** 系统返回操作结果

#### 场景2.2：设备重启
**Given** 设备在线状态正常
**And** 用户具有设备控制权限
**When** 用户选择设备并点击"重启设备"
**Then** 系统验证用户权限
**And** 系统向设备发送重启命令
**And** 系统监控设备重启过程
**And** 系统记录重启操作日志

#### 场景2.3：设备启用/禁用
**Given** 用户具有设备管理权限
**When** 用户点击设备状态切换按钮
**Then** 系统更新设备状态
**And** 系统向设备下发状态配置
**And** 系统记录状态变更日志
**And** 系统实时更新设备状态显示

### 需求3：设备信息同步功能
**优先级**：中
**描述**：支持设备数据的同步操作

#### 场景3.1：时间同步
**Given** 设备在线状态正常
**When** 用户选择设备并点击"同步时间"
**Then** 系统获取服务器当前时间
**And** 系统向设备发送时间同步命令
**And** 系统验证时间同步结果
**And** 系统记录同步操作日志

#### 场景3.2：权限数据同步
**Given** 设备在线状态正常
**When** 用户选择设备并点击"同步权限数据"
**Then** 系统获取该设备相关的权限数据
**And** 系统将权限数据下发给设备
**And** 系统验证数据同步结果
**And** 系统记录同步操作日志

### 需求4：设备高级设置功能
**优先级**：中
**描述**：提供设备高级参数配置功能

#### 场景4.1：验证参数配置
**Given** 用户具有设备配置权限
**When** 用户进入设备高级设置页面
**And** 用户配置验证参数（人脸识别阈值、指纹匹配阈值等）
**And** 用户点击"保存配置"
**Then** 系统验证参数有效性
**And** 系统将配置下发给设备
**And** 系统记录配置变更日志

#### 场景4.2：网络参数修改
**Given** 用户具有设备配置权限
**When** 用户在通信设置中修改设备的IP地址或端口
**Then** 系统验证新网络参数的有效性
**And** 系统测试新网络参数的连通性
**And** 系统更新设备网络配置
**And** 系统提醒用户设备可能需要重新连接

### 需求5：设备信息查看功能
**优先级**：中
**描述**：提供设备详细信息查看功能

#### 场景5.1：查看设备参数
**Given** 用户具有设备查看权限
**When** 用户点击设备列表中的"查看详情"
**Then** 系统显示设备的完整参数信息
**And** 系统显示设备的实时状态信息
**And** 系统显示设备的配置历史记录

#### 场景5.2：查看设备容量
**Given** 用户具有设备查看权限
**When** 用户点击"查看容量"
**Then** 系统从设备获取容量信息
**And** 系统显示设备的人员容量使用情况
**And** 系统显示设备的记录容量使用情况
**And** 系统显示设备的存储空间使用情况

### 需求6：设备区域关联功能
**优先级**：高
**描述**：支持设备与区域的关联管理

#### 场景6.1：添加设备时选择区域
**Given** 用户正在添加新设备
**When** 用户填写完设备基本信息
**Then** 系统要求用户选择关联的区域
**And** 系统显示可用的区域列表
**And** 系统验证选择区域的有效性
**And** 系统保存设备与区域的关联关系

#### 场景6.2：修改设备关联区域
**Given** 用户具有设备管理权限
**When** 用户选择设备并点击"修改区域"
**Then** 系统显示当前关联的区域信息
**And** 用户可以选择新的关联区域
**And** 系统更新设备区域关联关系
**And** 系统同步更新相关的权限配置

### 需求7：设备状态监控功能
**优先级**：高
**描述**：实时监控设备状态变化

#### 场景7.1：设备在线状态监控
**Given** 系统正常运行
**When** 设备连接状态发生变化
**Then** 系统检测设备状态变化
**And** 系统更新设备状态显示
**And** 系统记录状态变更日志
**And** 系统向监控页面推送状态更新

#### 场景7.2：设备故障监控
**Given** 设备发生故障或异常
**When** 系统检测到设备异常
**Then** 系统生成设备故障告警
**And** 系统通知相关管理人员
**And** 系统记录故障处理过程
**And** 系统提供故障处理指导

## MODIFIED Requirements

### 需求8：设备权限验证机制增强
**优先级**：高
**描述**：增强设备操作的权限验证机制

#### 场景8.1：多层权限验证
**Given** 用户尝试执行设备控制操作
**When** 系统接收操作请求
**Then** 系统验证用户登录状态
**And** 系统验证用户功能权限
**And** 系统验证用户对该设备的操作权限
**And** 系统记录权限验证日志
**And** 权限验证通过时执行操作，否则拒绝请求

## 数据需求

### 输入数据

#### 设备添加表单
- deviceNo: 设备编号 (必填，唯一)
- deviceName: 设备名称 (必填)
- deviceType: 设备类型 (必填，枚举值)
- ipAddress: IP地址 (必填，格式验证)
- port: 端口号 (必填，范围验证)
- protocolType: 协议类型 (必填)
- areaId: 关联区域ID (必填)
- description: 设备描述 (可选)

#### 设备控制表单
- deviceId: 设备ID (必填)
- controlType: 控制类型 (必填)
- controlParams: 控制参数 (根据控制类型而定)
- reason: 操作原因 (可选)
- operatorId: 操作人ID (系统自动获取)

#### 设备配置表单
- deviceId: 设备ID (必填)
- configType: 配置类型 (必填)
- configParams: 配置参数 (必填，JSON格式)
- applyMode: 应用模式 (立即生效/重启生效)

### 输出数据

#### 设备信息响应
- deviceId: 设备ID
- deviceNo: 设备编号
- deviceName: 设备名称
- deviceType: 设备类型
- deviceStatus: 设备状态
- ipAddress: IP地址
- port: 端口号
- areaId: 关联区域ID
- areaName: 区域名称
- createTime: 创建时间
- updateTime: 更新时间
- lastOnlineTime: 最后在线时间

#### 设备控制结果
- success: 操作是否成功
- message: 操作结果消息
- deviceId: 设备ID
- controlType: 控制类型
- executeTime: 执行时间
- operatorId: 操作人ID

#### 设备状态信息
- deviceId: 设备ID
- deviceStatus: 在线状态
- doorStatus: 门状态
- readerStatus: 读头状态
- lastHeartbeat: 最后心跳时间
- errorCount: 错误计数
- capacityInfo: 容量信息

## 性能需求

### 响应时间需求
- 设备列表加载：≤ 2秒
- 设备添加操作：≤ 3秒
- 设备控制命令：≤ 1秒
- 设备状态查询：≤ 500毫秒
- 设备搜索操作：≤ 10秒

### 并发需求
- 同时在线管理用户：≥ 50个
- 并发设备操作：≥ 20个
- 设备状态更新频率：≥ 1次/秒
- 设备搜索并发：≥ 5个

### 可用性需求
- 设备管理功能可用性：≥ 99.9%
- 设备控制成功率：≥ 99.5%
- 设备状态同步延迟：≤ 5秒
- 设备连接成功率：≥ 95%

## 安全需求

### 认证需求
- 所有操作需要用户登录认证
- 设备控制操作需要二次权限验证
- 敏感操作需要操作确认

### 授权需求
- 基于角色的访问控制
- 设备级别的操作权限控制
- 区域级别的数据访问权限

### 审计需求
- 记录所有设备操作日志
- 记录设备状态变更日志
- 记录权限验证失败日志
- 日志保存时间不少于1年

### 数据安全
- 设备密码等敏感信息加密存储
- 网络传输使用HTTPS/TLS加密
- 定期备份设备配置数据

---

**本规格文档基于门禁系统业务流程图设计，详细定义了设备管理模块的功能需求、数据需求和性能需求，为系统开发提供明确的指导。**