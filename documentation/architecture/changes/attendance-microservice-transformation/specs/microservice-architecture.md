# è€ƒå‹¤æ¨¡å—å¾®æœåŠ¡æ¶æ„è§„èŒƒ

> **è§„èŒƒç±»å‹**: å¾®æœåŠ¡æ¶æ„è®¾è®¡
> **é€‚ç”¨èŒƒå›´**: è€ƒå‹¤æ¨¡å—å¾®æœåŠ¡åŒ–æ”¹é€ 
> **åˆ›å»ºæ—¶é—´**: 2025-11-27
> **ç‰ˆæœ¬**: v1.0

---

## ğŸ“‹ è§„èŒƒæ¦‚è¿°

### ğŸ¯ è§„èŒƒç›®æ ‡
å®šä¹‰è€ƒå‹¤æ¨¡å—å¾®æœåŠ¡åŒ–çš„æ¶æ„è®¾è®¡è§„èŒƒï¼Œç¡®ä¿å¾®æœåŠ¡æ¶æ„çš„ä¸€è‡´æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºè€ƒå‹¤æ¨¡å—çš„å¾®æœåŠ¡åŒ–æ”¹é€ æä¾›æŠ€æœ¯æŒ‡å¯¼ã€‚

### ğŸ¯ é€‚ç”¨èŒƒå›´
æœ¬è§„èŒƒé€‚ç”¨äºIOE-DREAMé¡¹ç›®ä¸­è€ƒå‹¤æ¨¡å—(attendance)çš„å¾®æœåŠ¡åŒ–æ”¹é€ ï¼ŒåŒ…æ‹¬ï¼š
- å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸåˆ™
- æœåŠ¡æ‹†åˆ†ç­–ç•¥å’Œè¾¹ç•Œå®šä¹‰
- æŠ€æœ¯æ ˆé€‰å‹å’Œé…ç½®è§„èŒƒ
- æ•°æ®æ¶æ„å’Œåˆ†å¸ƒå¼äº‹åŠ¡è®¾è®¡
- APIè®¾è®¡å’ŒæœåŠ¡é—´é€šä¿¡è§„èŒƒ

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™
æ¯ä¸ªå¾®æœåŠ¡åº”è¯¥ä¸“æ³¨äºå•ä¸€çš„ä¸šåŠ¡é¢†åŸŸï¼Œå…·æœ‰æ˜ç¡®çš„ä¸šåŠ¡è¾¹ç•Œå’ŒèŒè´£èŒƒå›´ã€‚

**è€ƒå‹¤å¾®æœåŠ¡èŒè´£**:
- è€ƒå‹¤è®°å½•çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤
- æ’ç­ç®¡ç†å’Œç­æ¬¡é…ç½®
- è€ƒå‹¤è§„åˆ™çš„é…ç½®å’Œæ‰§è¡Œ
- è€ƒå‹¤ç»Ÿè®¡åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆ
- è€ƒå‹¤å¼‚å¸¸çš„æ£€æµ‹å’Œå¤„ç†

### 2. é«˜å†…èšä½è€¦åˆåŸåˆ™
- **é«˜å†…èš**: ç›¸å…³çš„ä¸šåŠ¡åŠŸèƒ½åº”è¯¥èšåˆåœ¨åŒä¸€ä¸ªå¾®æœåŠ¡å†…
- **ä½è€¦åˆ**: å¾®æœåŠ¡ä¹‹é—´é€šè¿‡å®šä¹‰è‰¯å¥½çš„æ¥å£è¿›è¡Œé€šä¿¡ï¼Œå‡å°‘ç›´æ¥ä¾èµ–

### 3. è‡ªæ²»æ€§åŸåˆ™
æ¯ä¸ªå¾®æœåŠ¡åº”è¯¥å…·å¤‡ï¼š
- **æŠ€æœ¯è‡ªæ²»**: å¯ä»¥ç‹¬ç«‹é€‰æ‹©é€‚åˆçš„æŠ€æœ¯æ ˆ
- **éƒ¨ç½²è‡ªæ²»**: å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§
- **æ•°æ®è‡ªæ²»**: æ‹¥æœ‰è‡ªå·±çš„æ•°æ®åº“å’Œæ•°æ®å­˜å‚¨
- **æ‰©å±•è‡ªæ²»**: å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç‹¬ç«‹æ‰©å±•

### 4. å®¹é”™è®¾è®¡åŸåˆ™
- **æ•…éšœéš”ç¦»**: å•ä¸ªå¾®æœåŠ¡çš„æ•…éšœä¸åº”å½±å“å…¶ä»–å¾®æœåŠ¡
- **é™çº§ç­–ç•¥**: åœ¨ä¾èµ–æœåŠ¡ä¸å¯ç”¨æ—¶æä¾›å¤‡ç”¨æ–¹æ¡ˆ
- **ç†”æ–­æœºåˆ¶**: é˜²æ­¢çº§è”æ•…éšœçš„å‘ç”Ÿ

---

## ğŸ”§ æœåŠ¡æ‹†åˆ†ç­–ç•¥

### ä¸šåŠ¡è¾¹ç•Œå®šä¹‰

#### æ ¸å¿ƒä¸šåŠ¡èƒ½åŠ›
```
è€ƒå‹¤å¾®æœåŠ¡ (Attendance Service)
â”œâ”€â”€ è€ƒå‹¤è®°å½•ç®¡ç† (Attendance Record Management)
â”‚   â”œâ”€â”€ æ‰“å¡è®°å½•å¤„ç† (Clock-in/out Processing)
â”‚   â”œâ”€â”€ è€ƒå‹¤æ•°æ®é‡‡é›† (Attendance Data Collection)
â”‚   â”œâ”€â”€ è®°å½•éªŒè¯å’Œæ ¡å‡† (Record Validation & Calibration)
â”‚   â””â”€â”€ å†å²è®°å½•æŸ¥è¯¢ (Historical Record Query)
â”œâ”€â”€ æ’ç­ç®¡ç† (Schedule Management)
â”‚   â”œâ”€â”€ ç­æ¬¡å®šä¹‰å’Œç®¡ç† (Shift Definition & Management)
â”‚   â”œâ”€â”€ æ’ç­è®¡åˆ’åˆ¶å®š (Schedule Planning)
â”‚   â”œâ”€â”€ ç­æ¬¡è°ƒæ•´å’Œå˜æ›´ (Shift Adjustment)
â”‚   â””â”€â”€ æ’ç­å†²çªæ£€æµ‹ (Schedule Conflict Detection)
â”œâ”€â”€ è€ƒå‹¤è§„åˆ™å¼•æ“ (Attendance Rule Engine)
â”‚   â”œâ”€â”€ è§„åˆ™å®šä¹‰å’Œé…ç½® (Rule Definition & Configuration)
â”‚   â”œâ”€â”€ è§„åˆ™æ‰§è¡Œå’Œè¯„ä¼° (Rule Execution & Evaluation)
â”‚   â”œâ”€â”€ å¼‚å¸¸æ£€æµ‹å’Œå¤„ç† (Exception Detection & Handling)
â”‚   â””â”€â”€ è§„åˆ™ç‰ˆæœ¬ç®¡ç† (Rule Version Management)
â”œâ”€â”€ ç»Ÿè®¡åˆ†ææœåŠ¡ (Analytics Service)
â”‚   â”œâ”€â”€ è€ƒå‹¤ç»Ÿè®¡è®¡ç®— (Attendance Statistics Calculation)
â”‚   â”œâ”€â”€ ç»©æ•ˆæŒ‡æ ‡è®¡ç®— (Performance Metrics Calculation)
â”‚   â”œâ”€â”€ æŠ¥è¡¨ç”Ÿæˆå’Œç®¡ç† (Report Generation & Management)
â”‚   â””â”€â”€ æ•°æ®å¯è§†åŒ–æ”¯æŒ (Data Visualization Support)
â””â”€â”€ å¼‚å¸¸å¤„ç†æœåŠ¡ (Exception Handling Service)
    â”œâ”€â”€ å¼‚å¸¸ç”³è¯·å¤„ç† (Exception Application Processing)
    â”œâ”€â”€ å¼‚å¸¸å®¡æ‰¹æµç¨‹ (Exception Approval Workflow)
    â”œâ”€â”€ å¼‚å¸¸æ•°æ®ç»Ÿè®¡ (Exception Data Statistics)
    â””â”€â”€ å¼‚å¸¸è¶‹åŠ¿åˆ†æ (Exception Trend Analysis)
```

#### æœåŠ¡è¾¹ç•Œæ¸…æ™°åŒ–
```
å†…éƒ¨èŒè´£ (Within Attendance Service):
âœ… è€ƒå‹¤è®°å½•çš„CRUDæ“ä½œ
âœ… æ’ç­è®¡åˆ’çš„åˆ¶å®šå’Œç®¡ç†
âœ… è€ƒå‹¤è§„åˆ™çš„é…ç½®å’Œæ‰§è¡Œ
âœ… è€ƒå‹¤æ•°æ®çš„ç»Ÿè®¡å’Œåˆ†æ
âœ… å¼‚å¸¸ç”³è¯·å’Œå¤„ç†æµç¨‹

å¤–éƒ¨ä¾èµ– (External Dependencies):
âŒ ç”¨æˆ·ä¿¡æ¯ç®¡ç† â†’ ä¾èµ–ç”¨æˆ·æœåŠ¡
âŒ è®¾å¤‡ä¿¡æ¯ç®¡ç† â†’ ä¾èµ–è®¾å¤‡æœåŠ¡
âŒ ç»„ç»‡æ¶æ„ç®¡ç† â†’ ä¾èµ–ç»„ç»‡æœåŠ¡
âŒ æƒé™æ§åˆ¶ â†’ ä¾èµ–æƒé™æœåŠ¡
âŒ é€šçŸ¥æœåŠ¡ â†’ ä¾èµ–é€šçŸ¥æœåŠ¡
```

### æ•°æ®è¾¹ç•Œå®šä¹‰

#### æ•°æ®æ‰€æœ‰æƒåŸåˆ™
- è€ƒå‹¤å¾®æœåŠ¡æ‹¥æœ‰è€ƒå‹¤ç›¸å…³çš„æ‰€æœ‰æ•°æ®
- é€šè¿‡APIæ¥å£æä¾›æ•°æ®çš„æŸ¥è¯¢å’Œæ›´æ–°
- é¿å…è·¨æœåŠ¡çš„ç›´æ¥æ•°æ®åº“è®¿é—®

#### æ•°æ®åˆ’åˆ†ç­–ç•¥
```sql
-- è€ƒå‹¤å¾®æœåŠ¡ç‹¬æœ‰æ•°æ®è¡¨
t_attendance_record          -- è€ƒå‹¤è®°å½•è¡¨
t_attendance_schedule        -- æ’ç­è¡¨
t_attendance_shift          -- ç­æ¬¡è¡¨
t_attendance_rule           -- è€ƒå‹¤è§„åˆ™è¡¨
t_attendance_exception      -- è€ƒå‹¤å¼‚å¸¸è¡¨
t_attendance_report         -- è€ƒå‹¤æŠ¥è¡¨è¡¨
t_attendance_statistics     -- è€ƒå‹¤ç»Ÿè®¡è¡¨

-- å¤–éƒ¨æœåŠ¡æ•°æ®(é€šè¿‡APIè®¿é—®)
t_user_info                 -- ç”¨æˆ·ä¿¡æ¯(ç”¨æˆ·æœåŠ¡)
t_department_info          -- éƒ¨é—¨ä¿¡æ¯(ç»„ç»‡æœåŠ¡)
t_device_info              -- è®¾å¤‡ä¿¡æ¯(è®¾å¤‡æœåŠ¡)
t_permission_info          -- æƒé™ä¿¡æ¯(æƒé™æœåŠ¡)
```

---

## ğŸ”Œ APIè®¾è®¡è§„èŒƒ

### RESTful APIè®¾è®¡

#### APIç‰ˆæœ¬ç®¡ç†
```
åŸºç¡€è·¯å¾„: /api/attendance/v1
ç‰ˆæœ¬ç­–ç•¥: URLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶
å‘åå…¼å®¹: ä¿æŒè‡³å°‘ä¸¤ä¸ªç‰ˆæœ¬çš„å…¼å®¹æ€§
å¼ƒç”¨é€šçŸ¥: æå‰3ä¸ªæœˆé€šçŸ¥APIå¼ƒç”¨
```

#### èµ„æºå‘½åè§„èŒƒ
```
# ä½¿ç”¨å¤æ•°å½¢å¼è¡¨ç¤ºèµ„æºé›†åˆ
/api/attendance/v1/records         # è€ƒå‹¤è®°å½•é›†åˆ
/api/attendance/v1/schedules       # æ’ç­è®¡åˆ’é›†åˆ
/api/attendance/v1/shifts          # ç­æ¬¡é›†åˆ
/api/attendance/v1/rules           # è§„åˆ™é›†åˆ
/api/attendance/v1/reports         # æŠ¥è¡¨é›†åˆ

# ä½¿ç”¨å…·ä½“IDæ ‡è¯†å•ä¸ªèµ„æº
/api/attendance/v1/records/{id}    # ç‰¹å®šè€ƒå‹¤è®°å½•
/api/attendance/v1/schedules/{id}  # ç‰¹å®šæ’ç­è®¡åˆ’
```

#### HTTPæ–¹æ³•ä½¿ç”¨è§„èŒƒ
```
GET    /records                    # è·å–è€ƒå‹¤è®°å½•åˆ—è¡¨
GET    /records/{id}               # è·å–ç‰¹å®šè€ƒå‹¤è®°å½•
POST   /records                    # åˆ›å»ºè€ƒå‹¤è®°å½•
PUT    /records/{id}               # æ›´æ–°è€ƒå‹¤è®°å½•
DELETE /records/{id}               # åˆ é™¤è€ƒå‹¤è®°å½•
PATCH  /records/{id}/status        # æ›´æ–°è€ƒå‹¤è®°å½•çŠ¶æ€

# å¤æ‚æŸ¥è¯¢ä½¿ç”¨Queryå‚æ•°
GET    /records?userId=123&startDate=2024-01-01&endDate=2024-01-31
GET    /records?page=1&size=20&sort=createTime,desc
```

### è¯·æ±‚å“åº”è§„èŒƒ

#### ç»Ÿä¸€å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“ä¸šåŠ¡æ•°æ®
  },
  "timestamp": "2025-11-27T10:30:00Z",
  "traceId": "abc123def456",
  "requestId": "req-789xyz"
}
```

#### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "error": {
    "type": "VALIDATION_ERROR",
    "details": [
      {
        "field": "clockTime",
        "message": "æ‰“å¡æ—¶é—´ä¸èƒ½ä¸ºç©º"
      }
    ]
  },
  "timestamp": "2025-11-27T10:30:00Z",
  "traceId": "abc123def456",
  "requestId": "req-789xyz"
}
```

#### åˆ†é¡µå“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "content": [
      // æ•°æ®åˆ—è¡¨
    ],
    "page": {
      "number": 1,
      "size": 20,
      "totalElements": 100,
      "totalPages": 5,
      "first": true,
      "last": false
    }
  },
  "timestamp": "2025-11-27T10:30:00Z"
}
```

---

## ğŸ”„ æœåŠ¡é—´é€šä¿¡è§„èŒƒ

### Feignå®¢æˆ·ç«¯è§„èŒƒ

#### å®¢æˆ·ç«¯æ¥å£å®šä¹‰
```java
@FeignClient(
    name = "user-service",
    url = "${services.user-service.url}",
    configuration = FeignConfiguration.class,
    fallback = UserServiceClientFallback.class
)
public interface UserServiceClient {

    @GetMapping("/api/user/v1/users/{userId}")
    ResponseDTO<UserVO> getUserById(@PathVariable("userId") Long userId);

    @GetMapping("/api/user/v1/users/batch")
    ResponseDTO<List<UserVO>> getUsersByIds(@RequestParam("userIds") List<Long> userIds);

    @GetMapping("/api/user/v1/departments/{deptId}")
    ResponseDTO<DepartmentVO> getDepartmentById(@PathVariable("deptId") Long deptId);
}
```

#### å®¹é”™å¤„ç†è§„èŒƒ
```java
@Component
public class UserServiceClientFallback implements UserServiceClient {

    @Override
    public ResponseDTO<UserVO> getUserById(Long userId) {
        log.warn("User service unavailable, using fallback for userId: {}", userId);
        return ResponseDTO.error(UserErrorCode.SERVICE_UNAVAILABLE);
    }

    @Override
    public ResponseDTO<List<UserVO>> getUsersByIds(List<Long> userIds) {
        log.warn("User service unavailable, using fallback for userIds: {}", userIds);
        return ResponseDTO.error(UserErrorCode.SERVICE_UNAVAILABLE);
    }

    @Override
    public ResponseDTO<DepartmentVO> getDepartmentById(Long deptId) {
        log.warn("User service unavailable, using fallback for deptId: {}", deptId);
        return ResponseDTO.error(UserErrorCode.SERVICE_UNAVAILABLE);
    }
}
```

### äº‹ä»¶é©±åŠ¨è§„èŒƒ

#### äº‹ä»¶å®šä¹‰æ ‡å‡†
```java
@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, property = "eventType")
@JsonSubTypes({
    @JsonSubTypes.Type(value = AttendanceRecordCreatedEvent.class, name = "RECORD_CREATED"),
    @JsonSubTypes.Type(value = AttendanceRecordUpdatedEvent.class, name = "RECORD_UPDATED"),
    @JsonSubTypes.Type(value = AttendanceExceptionEvent.class, name = "EXCEPTION_OCCURRED")
})
public abstract class AttendanceEvent {
    private String eventId;
    private String eventType;
    private Long timestamp;
    private String source;
    private Map<String, Object> metadata;

    // æ„é€ å‡½æ•°ã€getterã€setteræ–¹æ³•
}
```

#### äº‹ä»¶å‘å¸ƒè§„èŒƒ
```java
@Service
public class AttendanceEventPublisher {

    @Resource
    private ApplicationEventPublisher eventPublisher;

    @Resource
    private RabbitTemplate rabbitTemplate;

    public void publishAttendanceRecordCreated(AttendanceRecordEntity record) {
        // å‘å¸ƒæœ¬åœ°äº‹ä»¶
        AttendanceRecordCreatedEvent localEvent = new AttendanceRecordCreatedEvent(record);
        eventPublisher.publishEvent(localEvent);

        // å‘å¸ƒè¿œç¨‹äº‹ä»¶
        AttendanceEventMessage remoteEvent = AttendanceEventMessage.builder()
            .eventId(UUID.randomUUID().toString())
            .eventType("RECORD_CREATED")
            .payload(record)
            .timestamp(System.currentTimeMillis())
            .build();

        rabbitTemplate.convertAndSend("attendance.exchange", "attendance.record.created", remoteEvent);
    }
}
```

---

## ğŸ—„ï¸ æ•°æ®æ¶æ„è§„èŒƒ

### æ•°æ®åº“è®¾è®¡è§„èŒƒ

#### åˆ†åº“åˆ†è¡¨ç­–ç•¥
```sql
-- æŒ‰ä¸šåŠ¡åŸŸåˆ†åº“
ä¸»åº“: smart_attendance_v3 (è€ƒå‹¤ä¸šåŠ¡æ•°æ®åº“)

-- æŒ‰æ—¶é—´åˆ†è¡¨(è€ƒå‹¤è®°å½•)
t_attendance_record_2024
t_attendance_record_2025
t_attendance_record_2026

-- æŒ‰ç»´åº¦åˆ†è¡¨(ç»Ÿè®¡æ•°æ®)
t_attendance_daily_stats    -- æŒ‰å¤©ç»Ÿè®¡
t_attendance_monthly_stats  -- æŒ‰æœˆç»Ÿè®¡
t_attendance_yearly_stats   -- æŒ‰å¹´ç»Ÿè®¡
```

#### æ•°æ®ä¸€è‡´æ€§è§„èŒƒ
```java
@Service
@Transactional
public class AttendanceRecordService {

    @Resource
    private AttendanceRecordRepository recordRepository;

    @Resource
    private UserServiceClient userServiceClient;

    @GlobalTransactional
    public void createAttendanceRecord(AttendanceRecordCreateDTO dto) {
        // 1. éªŒè¯ç”¨æˆ·ä¿¡æ¯
        ResponseDTO<UserVO> userResponse = userServiceClient.getUserById(dto.getUserId());
        if (!userResponse.isSuccess()) {
            throw new SmartException(UserErrorCode.USER_NOT_FOUND);
        }

        // 2. åˆ›å»ºè€ƒå‹¤è®°å½•
        AttendanceRecordEntity record = AttendanceRecordEntity.builder()
            .userId(dto.getUserId())
            .clockTime(dto.getClockTime())
            .clockType(dto.getClockType())
            .deviceId(dto.getDeviceId())
            .build();

        recordRepository.save(record);

        // 3. å‘å¸ƒäº‹ä»¶
        eventPublisher.publishAttendanceRecordCreated(record);
    }
}
```

### ç¼“å­˜ç­–ç•¥è§„èŒƒ

#### å¤šçº§ç¼“å­˜æ¶æ„
```java
@Component
public class AttendanceCacheManager {

    @Resource
    private RedissonClient redissonClient;

    @Resource
    private Cache<String, Object> caffeineCache;

    public <T> T get(String key, Class<T> clazz) {
        // 1. å…ˆæŸ¥L1ç¼“å­˜(Caffeine)
        T value = (T) caffeineCache.getIfPresent(key);
        if (value != null) {
            return value;
        }

        // 2. æŸ¥L2ç¼“å­˜(Redis)
        RBucket<T> bucket = redissonClient.getBucket(key);
        value = bucket.get();
        if (value != null) {
            caffeineCache.put(key, value);
            return value;
        }

        return null;
    }

    public <T> void set(String key, T value, Duration ttl) {
        // 1. è®¾ç½®L1ç¼“å­˜
        caffeineCache.put(key, value);

        // 2. è®¾ç½®L2ç¼“å­˜
        RBucket<T> bucket = redissonClient.getBucket(key);
        bucket.set(value, ttl);
    }
}
```

---

## ğŸ›¡ï¸ å®‰å…¨è§„èŒƒ

### APIå®‰å…¨è§„èŒƒ

#### è®¤è¯æˆæƒ
```java
@RestController
@RequestMapping("/api/attendance/v1")
@SaCheckLogin
public class AttendanceController {

    @PostMapping("/records")
    @SaCheckPermission("attendance:record:create")
    @SaCheckRole("admin")
    public ResponseDTO<Long> createRecord(@Valid @RequestBody AttendanceRecordCreateDTO dto) {
        // ä¸šåŠ¡é€»è¾‘
    }

    @GetMapping("/records/{id}")
    @SaCheckPermission("attendance:record:query")
    public ResponseDTO<AttendanceRecordVO> getRecord(@PathVariable Long id) {
        // ä¸šåŠ¡é€»è¾‘
    }
}
```

#### æ•°æ®è„±æ•è§„èŒƒ
```java
@Data
public class AttendanceRecordVO {

    private Long recordId;

    private Long userId;

    @JsonSerialize(using = SensitiveDataSerializer.class)
    private String userName;          // è„±æ•å¤„ç†

    @JsonSerialize(using = SensitiveDataSerializer.class)
    private String idCardNumber;      // è„±æ•å¤„ç†

    private LocalDateTime clockTime;

    private Integer clockType;
}
```

### æ•°æ®å®‰å…¨è§„èŒƒ

#### æ•æ„Ÿæ•°æ®åŠ å¯†
```java
@Component
public class SensitiveDataEncryptor {

    @Value("${app.security.encrypt.key}")
    private String encryptKey;

    public String encrypt(String plainText) {
        // ä½¿ç”¨AESåŠ å¯†
        return AESUtils.encrypt(plainText, encryptKey);
    }

    public String decrypt(String encryptedText) {
        // ä½¿ç”¨AESè§£å¯†
        return AESUtils.decrypt(encryptedText, encryptKey);
    }
}
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—è§„èŒƒ

### ç›‘æ§æŒ‡æ ‡è§„èŒƒ

#### ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
```java
@Component
public class AttendanceMetrics {

    private final Counter recordCreateCounter;
    private final Timer recordProcessTimer;
    private final Gauge activeUsersGauge;

    public AttendanceMetrics(MeterRegistry meterRegistry) {
        this.recordCreateCounter = Counter.builder("attendance.record.created")
            .description("Number of attendance records created")
            .register(meterRegistry);

        this.recordProcessTimer = Timer.builder("attendance.record.process.time")
            .description("Time taken to process attendance record")
            .register(meterRegistry);

        this.activeUsersGauge = Gauge.builder("attendance.active.users")
            .description("Number of active users")
            .register(meterRegistry);
    }

    public void incrementRecordCreate() {
        recordCreateCounter.increment();
    }

    public Timer.Sample startTimer() {
        return Timer.start();
    }

    public void recordTime(Timer.Sample sample) {
        sample.stop(recordProcessTimer);
    }
}
```

### æ—¥å¿—è§„èŒƒ

#### ç»“æ„åŒ–æ—¥å¿—
```java
@Slf4j
@Service
public class AttendanceRecordService {

    public void createRecord(AttendanceRecordCreateDTO dto) {
        log.info("å¼€å§‹åˆ›å»ºè€ƒå‹¤è®°å½•, userId: {}, clockTime: {}", dto.getUserId(), dto.getClockTime());

        try {
            // ä¸šåŠ¡é€»è¾‘
            log.info("è€ƒå‹¤è®°å½•åˆ›å»ºæˆåŠŸ, recordId: {}, userId: {}", recordId, dto.getUserId());

        } catch (Exception e) {
            log.error("è€ƒå‹¤è®°å½•åˆ›å»ºå¤±è´¥, userId: {}, error: {}", dto.getUserId(), e.getMessage(), e);
            throw e;
        }
    }
}
```

---

## ğŸš€ éƒ¨ç½²è§„èŒƒ

### å®¹å™¨åŒ–è§„èŒƒ

#### Dockerfileè§„èŒƒ
```dockerfile
FROM openjdk:17-jdk-slim

LABEL maintainer="IOE-DREAM Team"
LABEL version="1.0.0"
LABEL description="Attendance Microservice"

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶jaræ–‡ä»¶
COPY target/attendance-service-*.jar app.jar

# åˆ›å»ºérootç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser

# è®¾ç½®æ–‡ä»¶æƒé™
RUN chown -R appuser:appuser /app

# åˆ‡æ¢ç”¨æˆ·
USER appuser

# è®¾ç½®JVMå‚æ•°
ENV JAVA_OPTS="-Xms512m -Xmx1024m -XX:+UseG1GC -XX:+UseContainerSupport"

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

### Kuberneteséƒ¨ç½²è§„èŒƒ

#### éƒ¨ç½²é…ç½®
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: attendance-service
  labels:
    app: attendance-service
    version: v1
spec:
  replicas: 3
  selector:
    matchLabels:
      app: attendance-service
  template:
    metadata:
      labels:
        app: attendance-service
        version: v1
    spec:
      containers:
      - name: attendance-service
        image: attendance-service:1.0.0
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: NACOS_SERVER_ADDR
          value: "nacos-server:8848"
        resources:
          requests:
            memory: "512Mi"
            cpu: "200m"
          limits:
            memory: "1024Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
```

---

## âœ… åˆè§„æ€§æ£€æŸ¥

### å¼ºåˆ¶æ€§è§„èŒƒæ£€æŸ¥æ¸…å•

#### æ¶æ„è®¾è®¡æ£€æŸ¥
- [ ] æœåŠ¡è¾¹ç•Œæ¸…æ™°ï¼Œå•ä¸€èŒè´£åŸåˆ™
- [ ] æ•°æ®æ‰€æœ‰æƒæ˜ç¡®ï¼Œæ— è·¨åº“è®¿é—®
- [ ] APIè®¾è®¡ç¬¦åˆRESTfulè§„èŒƒ
- [ ] æœåŠ¡é—´é€šä¿¡é‡‡ç”¨æ ‡å‡†åè®®
- [ ] å®¹é”™æœºåˆ¶å®Œå–„ï¼Œæ•…éšœéš”ç¦»æœ‰æ•ˆ

#### æŠ€æœ¯å®ç°æ£€æŸ¥
- [ ] ä½¿ç”¨Spring Boot 3.xå’ŒJava 17
- [ ] ç»Ÿä¸€ä½¿ç”¨jakartaåŒ…å
- [ ] ä½¿ç”¨@Resourceä¾èµ–æ³¨å…¥
- [ ] å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†
- [ ] é…ç½®å¤šçº§ç¼“å­˜ç­–ç•¥

#### å®‰å…¨åˆè§„æ£€æŸ¥
- [ ] APIæ¥å£æƒé™æ§åˆ¶å®Œæ•´
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†è„±æ•
- [ ] æ—¥å¿—è®°å½•è§„èŒƒå®Œæ•´
- [ ] ç›‘æ§æŒ‡æ ‡è¦†ç›–å…¨é¢
- [ ] éƒ¨ç½²é…ç½®å®‰å…¨å¯é 

### è¿è§„å¤„ç†æœºåˆ¶
- **ä¸¥é‡è¿è§„**: ç«‹å³åœæ­¢å®æ–½ï¼Œé‡æ–°è®¾è®¡
- **ä¸€èˆ¬è¿è§„**: ä¿®æ­£åç»§ç»­å®æ–½
- **è½»å¾®è¿è§„**: è®°å½•é—®é¢˜ï¼Œåç»­ä¼˜åŒ–

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-11-27
**è§„èŒƒç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡æ›´æ–°æ—¶é—´**: æ ¹æ®å®æ–½æƒ…å†µé€‚æ—¶æ›´æ–°