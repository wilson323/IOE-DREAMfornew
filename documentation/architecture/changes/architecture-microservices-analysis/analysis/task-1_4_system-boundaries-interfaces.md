# Task 1.4: æ–‡æ¡£åŒ–å½“å‰ç³»ç»Ÿè¾¹ç•Œå’Œæ¥å£

## æ‰§è¡Œæ‘˜è¦

åŸºäºå¯¹IOE-DREAMé¡¹ç›®çš„æ·±åº¦åˆ†æï¼ŒTask 1.4å·²å®Œæˆå¯¹å½“å‰ç³»ç»Ÿè¾¹ç•Œå’Œæ¥å£çš„å…¨é¢æ–‡æ¡£åŒ–ã€‚è¯†åˆ«äº†æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œã€æ ‡å‡†åŒ–çš„æ¥å£å®šä¹‰å’Œå®Œæ•´çš„APIå¥‘çº¦ï¼Œä¸ºå¾®æœåŠ¡åŒ–æ‹†åˆ†æä¾›äº†ç²¾ç¡®çš„è¾¹ç•Œå®šä¹‰ã€‚

## ç³»ç»Ÿè¾¹ç•Œåˆ†æ

### ğŸ¯ ç³»ç»Ÿæ•´ä½“è¾¹ç•Œå®šä¹‰

#### 1. å¤–éƒ¨ç³»ç»Ÿè¾¹ç•Œ
```
å¤–éƒ¨ç³»ç»Ÿé›†æˆè¾¹ç•Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IOE-DREAM æ™ºæ…§å›­åŒºç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤–éƒ¨ç³»ç»Ÿé›†æˆ                                                      â”‚
â”‚  â”œâ”€â”€ ç¡¬ä»¶è®¾å¤‡é›†æˆ                                                      â”‚
â”‚  â”‚   â”œâ”€â”€ é—¨ç¦è®¾å¤‡ (æµ·åº·å¨è§†ã€å¤§åã€ä¸­æ§æ™ºæ…§)                           â”‚
â”‚  â”‚   â”œâ”€â”€ æ¶ˆè´¹ç»ˆç«¯ (POSæœºã€è‡ªåŠ©æ¶ˆè´¹æœºã€ç§»åŠ¨æ”¯ä»˜ç»ˆç«¯)                     â”‚
â”‚  â”‚   â”œâ”€â”€ è€ƒå‹¤è®¾å¤‡ (è€ƒå‹¤æœºã€äººè„¸è¯†åˆ«ç»ˆç«¯ã€ç§»åŠ¨å®šä½)                       â”‚
â”‚  â”‚   â””â”€â”€ ç›‘æ§è®¾å¤‡ (IPæ‘„åƒå¤´ã€NVRç³»ç»Ÿã€æ™ºèƒ½åˆ†æè®¾å¤‡)                     â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€â”€ ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ                                                      â”‚
â”‚  â”‚   â”œâ”€â”€ æ”¯ä»˜æœåŠ¡ (æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è”æ”¯ä»˜)                             â”‚
â”‚  â”‚   â”œâ”€â”€ çŸ­ä¿¡æœåŠ¡ (é˜¿é‡Œäº‘çŸ­ä¿¡ã€è…¾è®¯äº‘çŸ­ä¿¡)                               â”‚
â”‚  â”‚   â”œâ”€â”€ æ¨é€æœåŠ¡ (è‹¹æœAPNSã€å®‰å“FCMã€WebSocketé•¿è¿æ¥)                    â”‚
â”‚  â”‚   â”œâ”€â”€ åœ°å›¾æœåŠ¡ (é«˜å¾·åœ°å›¾ã€ç™¾åº¦åœ°å›¾ã€è…¾è®¯åœ°å›¾)                           â”‚
â”‚  â”‚   â””â”€â”€ äººè„¸è¯†åˆ« (å•†æ±¤ã€æ—·è§†ã€ç™¾åº¦AI)                                 â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â””â”€â”€ ç”¨æˆ·ç«¯é›†æˆ                                                        â”‚
â”‚      â”œâ”€â”€ Webç«¯ (Vue 3 + TypeScript)                                  â”‚
â”‚      â”œâ”€â”€ ç§»åŠ¨ç«¯ (uni-app + å¾®ä¿¡å°ç¨‹åº)                               â”‚
â”‚      â””â”€â”€ æ¡Œé¢ç«¯ (Electronæ¡Œé¢åº”ç”¨)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½
```

#### 2. å†…éƒ¨ç³»ç»Ÿè¾¹ç•Œ
```
å†…éƒ¨æ¨¡å—è¾¹ç•Œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      sa-base (åŸºç¡€è®¾æ–½å±‚)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ é€šç”¨ç»„ä»¶ (Common Components)                                        â”‚
â”‚  â€¢ é…ç½®ç®¡ç† (Configuration Management)                                 â”‚
â”‚  â€¢ åŸºç¡€å®ä½“ (Base Entities)                                           â”‚
â”‚  â€¢ å·¥å…·ç±» (Utility Classes)                                            â”‚
â”‚  â€¢ éªŒè¯ç»„ä»¶ (Validation Components)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    sa-admin (ä¸šåŠ¡åº”ç”¨å±‚)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ ç”¨æˆ·æƒé™ (User & Permission)                                       â”‚
â”‚  â€¢ é—¨ç¦ç®¡ç† (Access Control)                                         â”‚
â”‚  â€¢ æ¶ˆè´¹ç®¡ç† (Consume Management)                                       â”‚
â”‚  â€¢ è€ƒå‹¤ç®¡ç† (Attendance Management)                                   â”‚
â”‚  â€¢ è®¿å®¢ç®¡ç† (Visitor Management)                                     â”‚
â”‚  â€¢ è§†é¢‘ç›‘æ§ (Video Monitoring)                                       â”‚
â”‚  â€¢ è®¾å¤‡ç®¡ç† (Device Management)                                     â”‚
â”‚  â€¢ é€šçŸ¥æœåŠ¡ (Notification Service)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½
```

### ğŸ“Š ä¸šåŠ¡æ¨¡å—è¾¹ç•Œå®šä¹‰

#### 1. ç”¨æˆ·æƒé™æ¨¡å—è¾¹ç•Œ
```yaml
module: ç”¨æˆ·æƒé™æ¨¡å—
scope:
  - ç”¨æˆ·ç®¡ç†: ç”¨æˆ·æ³¨å†Œã€ä¿¡æ¯ç®¡ç†ã€çŠ¶æ€ç®¡ç†
  - è§’è‰²ç®¡ç†: è§’è‰²å®šä¹‰ã€æƒé™åˆ†é…ã€ç»§æ‰¿å…³ç³»
  - æƒé™ç®¡ç†: æƒé™å®šä¹‰ã€æ•°æ®æƒé™ã€æ¥å£æƒé™
  - è®¤è¯æˆæƒ: ç™»å½•è®¤è¯ã€ä»¤ç‰Œç®¡ç†ã€ä¼šè¯ç®¡ç†

boundaries:
  internal:
    - ä¾èµ–: sa-baseåŸºç¡€ç»„ä»¶
    - æ¥å£: RESTful API
    - æ•°æ®: user, role, permissionè¡¨

  external:
    - å¯¹å¤–æä¾›: ç”¨æˆ·è®¤è¯æœåŠ¡ã€æƒé™éªŒè¯æœåŠ¡
    - ä¾èµ–å¤–éƒ¨: çŸ­ä¿¡æœåŠ¡(éªŒè¯ç )ã€é‚®ä»¶æœåŠ¡(é€šçŸ¥)

  isolation_level: é«˜ - æ ¸å¿ƒåŸºç¡€è®¾æ–½æœåŠ¡

apis:
  - POST /api/auth/login
  - POST /api/auth/logout
  - GET /api/users
  - POST /api/users
  - PUT /api/users/{id}
  - DELETE /api/users/{id}
  - GET /api/roles
  - GET /api/permissions
  - POST /api/check-permission
```

#### 2. é—¨ç¦ç®¡ç†æ¨¡å—è¾¹ç•Œ
```yaml
module: é—¨ç¦ç®¡ç†æ¨¡å—
scope:
  - è®¾å¤‡ç®¡ç†: é—¨ç¦è®¾å¤‡æ³¨å†Œã€çŠ¶æ€ç›‘æ§ã€è¿œç¨‹æ§åˆ¶
  - é€šè¡Œç®¡ç†: äººè„¸è¯†åˆ«ã€å¡ç‰‡éªŒè¯ã€ç”Ÿç‰©è¯†åˆ«
  - åŒºåŸŸç®¡ç†: åŒºåŸŸå®šä¹‰ã€æƒé™åˆ†é…ã€å±‚çº§ç®¡ç†
  - è®°å½•ç®¡ç†: é€šè¡Œè®°å½•ã€å¼‚å¸¸æŠ¥è­¦ã€ç»Ÿè®¡åˆ†æ
  - è®¿å®¢æƒé™: è®¿å®¢æ³¨å†Œã€ä¸´æ—¶æˆæƒã€é€šè¡Œç®¡ç†

boundaries:
  internal:
    - ä¾èµ–: sa-base, user-service, device-service
    - æ¥å£: RESTful API, WebSocket
    - æ•°æ®: access_record, access_device, areaè¡¨

  external:
    - ä¾èµ–å¤–éƒ¨: è®¾å¤‡å‚å•†SDKã€äººè„¸è¯†åˆ«API
    - å¯¹å¤–æä¾›: é€šè¡ŒéªŒè¯æœåŠ¡ã€è®¾å¤‡æ§åˆ¶API
    - ç¡¬ä»¶é›†æˆ: é—¨ç¦æ§åˆ¶å™¨ã€è¯»å¡å™¨ã€äººè„¸è¯†åˆ«ç»ˆç«¯

  isolation_level: ä¸­ - ä¸šåŠ¡åŸŸç‹¬ç«‹æœåŠ¡

apis:
  - POST /api/access/verify
  - GET /api/access/records
  - POST /api/access/devices/control
  - GET /api/areas/user-access
  - WebSocket /ws/device/status
```

#### 3. æ¶ˆè´¹ç®¡ç†æ¨¡å—è¾¹ç•Œ
```yaml
module: æ¶ˆè´¹ç®¡ç†æ¨¡å—
scope:
  - è´¦æˆ·ç®¡ç†: è´¦æˆ·å¼€æˆ·ã€ä½™é¢ç®¡ç†ã€å†»ç»“è§£å†»
  - æ¶ˆè´¹åœºæ™¯: é¤å…æ¶ˆè´¹ã€è¶…å¸‚è´­ç‰©ã€æœåŠ¡ç¼´è´¹
  - æ”¯ä»˜å¤„ç†: å¤šç§æ”¯ä»˜æ–¹å¼ã€äº¤æ˜“ç¡®è®¤ã€ç»“ç®—å¯¹è´¦
  - å¡ç‰‡ç®¡ç†: å®ä½“å¡ã€è™šæ‹Ÿå¡ã€NFCæ”¯ä»˜
  - ç»Ÿè®¡æŠ¥è¡¨: æ¶ˆè´¹ç»Ÿè®¡ã€æ”¶æ”¯åˆ†æã€è´¢åŠ¡æŠ¥è¡¨

boundaries:
  internal:
    - ä¾èµ–: sa-base, user-service, payment-service
    - æ¥å£: RESTful API, WebSocket
    - æ•°æ®: account, transaction, consume_recordè¡¨

  external:
    - ä¾èµ–å¤–éƒ¨: æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è”æ”¯ä»˜
    - å¯¹å¤–æä¾›: æ”¯ä»˜æœåŠ¡ã€ä½™é¢æŸ¥è¯¢API
    - ç¡¬ä»¶é›†æˆ: POSæœºã€è‡ªåŠ©æ¶ˆè´¹ç»ˆç«¯

  isolation_level: ä¸­ - ä¸šåŠ¡åŸŸç‹¬ç«‹æœåŠ¡

apis:
  - POST /api/consume/payment
  - GET /api/account/balance
  - POST /api/account/recharge
  - GET /api/transaction/records
  - POST /api/consume/refund
```

#### 4. è€ƒå‹¤ç®¡ç†æ¨¡å—è¾¹ç•Œ
```yaml
module: è€ƒå‹¤ç®¡ç†æ¨¡å—
scope:
  - æ‰“å¡ç®¡ç†: å¤šç§æ‰“å¡æ–¹å¼ã€å®šä½éªŒè¯ã€ç…§ç‰‡é‡‡é›†
  - æ’ç­ç®¡ç†: ç­æ¬¡å®šä¹‰ã€è½®ç­å®‰æ’ã€è§„åˆ™é…ç½®
  - è¯·å‡ç®¡ç†: è¯·å‡ç”³è¯·ã€å®¡æ‰¹æµç¨‹ã€å‡æœŸç»Ÿè®¡
  - åŠ ç­ç®¡ç†: åŠ ç­ç”³è¯·ã€åŠ ç­è®¡ç®—ã€è°ƒä¼‘ç®¡ç†
  - ç»Ÿè®¡åˆ†æ: å‡ºå‹¤ç»Ÿè®¡ã€è¿Ÿåˆ°æ—©é€€ã€å¼‚å¸¸åˆ†æ

boundaries:
  internal:
    - ä¾èµ–: sa-base, user-service, notification-service
    - æ¥å£: RESTful API, WebSocket
    - æ•°æ®: attendance_record, shift, leave_requestè¡¨

  external:
    - ä¾èµ–å¤–éƒ¨: äººäº‹ç®¡ç†ç³»ç»Ÿã€åŠå…¬è‡ªåŠ¨åŒ–ç³»ç»Ÿ
    - å¯¹å¤–æä¾›: è€ƒå‹¤æ•°æ®APIã€ç»Ÿè®¡æŠ¥è¡¨API
    - ç¡¬ä»¶é›†æˆ: è€ƒå‹¤æœºã€äººè„¸è¯†åˆ«ç»ˆç«¯ã€æ‰‹æœºå®šä½

  isolation_level: ä¸­ - ä¸šåŠ¡åŸŸç‹¬ç«‹æœåŠ¡

apis:
  - POST /api/attendance/clock
  - GET /api/attendance/records
  - GET /api/attendance/statistics
  - POST /api/shift/schedule
  - POST /api/leave/request
```

#### 5. è®¿å®¢ç®¡ç†æ¨¡å—è¾¹ç•Œ
```yaml
module: è®¿å®¢ç®¡ç†æ¨¡å—
scope:
  - è®¿å®¢é¢„çº¦: åœ¨çº¿é¢„çº¦ã€é¢„çº¦å®¡æ ¸ã€æ—¥ç¨‹å®‰æ’
  - èº«ä»½ç®¡ç†: èº«ä»½éªŒè¯ã€è®¿å®¢ç™»è®°ã€ä¸´æ—¶é€šè¡Œè¯
  - æƒé™ç®¡ç†: åŒºåŸŸæƒé™ã€æ—¶é—´æƒé™ã€é—¨ç¦æˆæƒ
  - é€šè¡Œç®¡ç†: é€šè¡ŒéªŒè¯ã€è®°å½•è·Ÿè¸ªã€å¼‚å¸¸å¤„ç†
  - æ•°æ®ç»Ÿè®¡: è®¿å®¢ç»Ÿè®¡ã€é¢‘ç‡åˆ†æã€æ»¡æ„åº¦è°ƒæŸ¥

boundaries:
  internal:
    - ä¾èµ–: sa-base, user-service, access-service, notification-service
    - æ¥å£: RESTful API
    - æ•°æ®: visitor_record, visitor_registration, area_permissionè¡¨

  external:
    - ä¾èµ–å¤–éƒ¨: ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€çŸ­ä¿¡æœåŠ¡
    - å¯¹å¤–æä¾›: è®¿å®¢APIã€é¢„çº¦ç®¡ç†API
    - é›†æˆ: é—¨ç¦ç³»ç»Ÿã€äººè„¸è¯†åˆ«ç³»ç»Ÿ

  isolation_level: ä¸­ - ä¸šåŠ¡åŸŸç‹¬ç«‹æœåŠ¡

apis:
  - POST /api/visitor/register
  - GET /api/visitor/appointments
  - POST /api/visitor/approve
  - POST /api/visitor/access-grant
  - GET /api/visitor/records
```

#### 6. è§†é¢‘ç›‘æ§æ¨¡å—è¾¹ç•Œ
```yaml
module: è§†é¢‘ç›‘æ§æ¨¡å—
scope:
  - è®¾å¤‡ç®¡ç†: æ‘„åƒå¤´ç®¡ç†ã€å‚æ•°é…ç½®ã€å›ºä»¶å‡çº§
  - å®æ—¶ç›‘æ§: å®æ—¶æŸ¥çœ‹ã€PTZæ§åˆ¶ã€ç”»é¢åˆ‡æ¢
  - å½•åƒç®¡ç†: å½•åƒå­˜å‚¨ã€å¿«é€Ÿæ£€ç´¢ã€æ–‡ä»¶ç®¡ç†
  - æ™ºèƒ½åˆ†æ: è¡Œä¸ºè¯†åˆ«ã€å¼‚å¸¸æ£€æµ‹ã€äººè„¸æ£€æµ‹
  - æŠ¥è­¦è”åŠ¨: ç§»åŠ¨ä¾¦æµ‹ã€å…¥ä¾µæ£€æµ‹ã€è”åŠ¨æ§åˆ¶

boundaries:
  internal:
    - ä¾èµ–: sa-base, device-service, access-service
    - æ¥å£: RESTful API, WebSocket, RTSP
    - æ•°æ®: video_device, video_record, alarm_eventè¡¨

  external:
    - ä¾èµ–å¤–éƒ¨: æ‘„åƒå¤´å‚å•†SDKã€AIåˆ†æAPI
    - ç¡¬ä»¶é›†æˆ: IPæ‘„åƒå¤´ã€NVRç³»ç»Ÿã€æ™ºèƒ½åˆ†æè®¾å¤‡
    - å¯¹å¤–æä¾›: è§†é¢‘æµAPIã€AIåˆ†æAPI

  isolation_level: é«˜ - ç¡¬ä»¶å¯†é›†å‹æœåŠ¡

apis:
  - GET /api/video/devices
  - POST /api/video/record/start
  - POST /api/video/record/stop
  - GET /api/video/stream/{device-id}
  - WebSocket /ws/video/{device-id}
```

#### 7. è®¾å¤‡ç®¡ç†æ¨¡å—è¾¹ç•Œ
```yaml
module: è®¾å¤‡ç®¡ç†æ¨¡å—
scope:
  - è®¾å¤‡æ³¨å†Œ: è®¾å¤‡å½•å…¥ã€å‚å•†ç®¡ç†ã€å‹å·ç®¡ç†
  - çŠ¶æ€ç›‘æ§: åœ¨çº¿çŠ¶æ€ã€å¥åº·æ£€æŸ¥ã€æ€§èƒ½ç›‘æ§
  - è¿œç¨‹æ§åˆ¶: è®¾å¤‡é‡å¯ã€å‚æ•°è®¾ç½®ã€å›ºä»¶å‡çº§
  - ç»´æŠ¤ç®¡ç†: ç»´æŠ¤è®¡åˆ’ã€æ•…éšœè®°å½•ã€å¤‡ä»¶ç®¡ç†
  - èµ„äº§ç®¡ç†: è®¾å¤‡å°è´¦ã€ç”Ÿå‘½å‘¨æœŸã€æˆæœ¬ç®¡ç†

boundaries:
  internal:
    - ä¾èµ–: sa-base, notification-service
    - æ¥å£: RESTful API, WebSocket
    - æ•°æ®: device_info, device_status, maintenance_recordè¡¨

  external:
    - ç¡¬ä»¶é›†æˆ: å„ç±»IoTè®¾å¤‡ã€ä¼ æ„Ÿå™¨ã€æ§åˆ¶å™¨
    - å¯¹å¤–æä¾›: è®¾å¤‡ç®¡ç†APIã€çŠ¶æ€ç›‘æ§API
    - æ”¯æŒå‚å•†: æµ·åº·å¨è§†ã€å¤§åã€ä¸­æ§æ™ºæ…§ç­‰

  isolation_level: é«˜ - åŸºç¡€è®¾æ–½æœåŠ¡

apis:
  - POST /api/device/register
  - GET /api/device/list
  - GET /api/device/status/{device-id}
  - POST /api/device/control
  - WebSocket /ws/device/status
```

## æ¥å£å¥‘çº¦æ–‡æ¡£

### ğŸ”§ REST APIæ¥å£æ ‡å‡†

#### 1. ç»Ÿä¸€å“åº”æ ¼å¼
```java
@Data
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ResponseDTO<T> {
    /**
     * å“åº”çŠ¶æ€ç 
     */
    private Integer code;

    /**
     * å“åº”æ¶ˆæ¯
     */
    private String message;

    /**
     * å“åº”æ•°æ®
     */
    private T data;

    /**
     * å“åº”æ—¶é—´æˆ³
     */
    private Long timestamp;

    /**
     * è¯·æ±‚ID (ç”¨äºè¿½è¸ª)
     */
    private String requestId;

    // æˆåŠŸå“åº”é™æ€æ–¹æ³•
    public static <T> ResponseDTO<T> success(T data) {
        ResponseDTO<T> response = new ResponseDTO<>();
        response.setCode(200);
        response.setMessage("æ“ä½œæˆåŠŸ");
        response.setData(data);
        response.setTimestamp(System.currentTimeMillis());
        return response;
    }

    // å¤±è´¥å“åº”é™æ€æ–¹æ³•
    public static <T> ResponseDTO<T> error(Integer code, String message) {
        ResponseDTO<T> response = new ResponseDTO<>();
        response.setCode(code);
        response.setMessage(message);
        response.setTimestamp(System.currentTimeMillis());
        return response;
    }
}
```

#### 2. æ ‡å‡†è¯·æ±‚å‚æ•°
```java
@Data
public class PageParam {
    /**
     * å½“å‰é¡µç 
     */
    private Integer pageNum = 1;

    /**
     * æ¯é¡µå¤§å°
     */
    private Integer pageSize = 20;

    /**
     * æ’åºå­—æ®µ
     */
    private String sortField;

    /**
     * æ’åºæ–¹å¼
     */
    private String sortOrder = "ASC";

    /**
     * å¼€å§‹æ—¶é—´
     */
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime startTime;

    /**
     * ç»“æŸæ—¶é—´
     */
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime endTime;
}
```

#### 3. åˆ†é¡µå“åº”æ ¼å¼
```java
@Data
public class PageResult<T> {
    /**
     * æ•°æ®åˆ—è¡¨
     */
    private List<T> list;

    /**
     * æ€»è®°å½•æ•°
     */
    private Long total;

    /**
     * å½“å‰é¡µç 
     */
    private Integer pageNum;

    /**
     * æ¯é¡µå¤§å°
     */
    private Integer pageSize;

    /**
     * æ€»é¡µæ•°
     */
    private Integer pages;
}
```

### ğŸ“¡ WebSocketæ¥å£å®šä¹‰

#### 1. è®¾å¤‡çŠ¶æ€ç›‘æ§
```javascript
// WebSocketè¿æ¥: /ws/device/status
// è®¤è¯å‚æ•°: token (JWT Token)
// è®¢é˜…å‚æ•°: deviceTypes (è®¾å¤‡ç±»å‹)

// è¿æ¥ç¤ºä¾‹
const ws = new WebSocket('ws://localhost:1024/ws/device/status?token=jwt_token');
ws.send(JSON.stringify({
    action: 'subscribe',
    deviceTypes: ['access', 'consume', 'attendance']
}));

// æ¶ˆæ¯æ ¼å¼
{
    "type": "DEVICE_STATUS_UPDATE",
    "deviceId": "DEVICE_001",
    "deviceType": "access",
    "status": "ONLINE",
    "timestamp": "2024-01-01T12:00:00Z",
    "data": {
        "cpuUsage": 25.5,
        "memoryUsage": 60.2,
        "diskUsage": 45.8
    }
}
```

#### 2. å®æ—¶è§†é¢‘æµ
```javascript
// WebSocketè¿æ¥: /ws/video/{device-id}
// è®¤è¯å‚æ•°: token (JWT Token)

// æ¶ˆæ¯ç±»å‹
{
    "type": "VIDEO_FRAME",
    "deviceId": "CAM_001",
    "timestamp": "2024-01-01T12:00:00Z",
    "data": {
        "frameType": "H264",
        "frameData": "base64ç¼–ç çš„å›¾åƒæ•°æ®",
        "resolution": "1920x1080"
    }
}

{
    "type": "PTZ_COMMAND",
    "deviceId": "CAM_001",
    "timestamp": "2024-01-01T12:00:00Z",
    "data": {
        "command": "MOVE_LEFT",
        "speed": 5,
        "position": {"x": 100, "y": 200}
    }
}
```

### ğŸ”’ å®‰å…¨æ¥å£è§„èŒƒ

#### 1. æƒé™æ§åˆ¶æ³¨è§£
```java
@RestController
@RequestMapping("/api/user")
@Api(tags = "ç”¨æˆ·ç®¡ç†")
@SaCheckPermission("user:view")  // æ¥å£æƒé™æ£€æŸ¥
public class UserController {

    @GetMapping("/list")
    @SaCheckPermission("user:list")  // è¯¦ç»†æƒé™æ£€æŸ¥
    public ResponseDTO<PageResult<UserVO>> getUserList(
        @Valid UserQueryForm queryForm,
        @RequestHeader("X-Request-ID") String requestId) {

        // ä¸šåŠ¡é€»è¾‘å®ç°
    }

    @PostMapping("/add")
    @SaCheckLogin  // ç™»å½•æ£€æŸ¥
    @SaCheckRole("admin")  // è§’è‰²æ£€æŸ¥
    public ResponseDTO<Long> addUser(
        @Valid @RequestBody UserForm userForm,
        @RequestHeader("X-Request-ID") String requestId) {

        // ä¸šåŠ¡é€»è¾‘å®ç°
    }
}
```

#### 2. æ•°æ®æƒé™æ§åˆ¶
```java
@Service
public class UserService {

    @Resource
    private DataScopeService dataScopeService;

    public PageResult<UserVO> getUserList(UserQueryForm queryForm, Long userId) {
        // è·å–ç”¨æˆ·æ•°æ®æƒé™
        DataScope dataScope = dataScopeService.getUserDataScope(userId);

        // åº”ç”¨æ•°æ®æƒé™åˆ°æŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<UserEntity> wrapper = new LambdaQueryWrapper<>();

        // éƒ¨é—¨æƒé™
        if (dataScope.getDeptIds() != null && !dataScope.getDeptIds().isEmpty()) {
            wrapper.in(UserEntity::getDeptId, dataScope.getDeptIds());
        }

        // åŒºåŸŸæƒé™
        if (dataScope.getAreaIds() != null && !dataScope.getAreaIds().isEmpty()) {
            wrapper.apply(userAreaQuery -> {
                userAreaQuery.in(UserAreaEntity::getAreaId, dataScope.getAreaIds());
            });
        }

        // æ‰§è¡ŒæŸ¥è¯¢
        return userDao.selectPage(page, wrapper);
    }
}
```

### ğŸ“Š APIæ–‡æ¡£ç”Ÿæˆ

#### 1. Swaggeré…ç½®
```java
@Configuration
@EnableOpenApi
public class SwaggerConfig {

    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                .info(new Info()
                        .title("IOE-DREAM æ™ºæ…§å›­åŒºç³»ç»ŸAPI")
                        .version("3.0.0")
                        .description("æ™ºæ…§å›­åŒºç»¼åˆç®¡ç†å¹³å°æ¥å£æ–‡æ¡£")
                        .contact(new Contact()
                                .name("å¼€å‘å›¢é˜Ÿ")
                                .email("dev@ioe-dream.com")))
                .servers(Arrays.asList(
                    new Server()
                        .url("http://localhost:1024")
                        .description("å¼€å‘ç¯å¢ƒ"),
                    new Server()
                        .url("https://api.ioe-dream.com")
                        .description("ç”Ÿäº§ç¯å¢ƒ")))
                .components(new Components()
                        .addSecuritySchemes("sa-token",
                            new SecurityScheme()
                                .type(SecurityScheme.Type.HTTP)
                                .scheme("bearer")
                                .bearerFormat("JWT")
                                .description("Sa-Tokenè®¤è¯")));
    }
}
```

#### 2. æ¥å£æ–‡æ¡£ç¤ºä¾‹
```java
@Api(tags = "ç”¨æˆ·ç®¡ç†")
@RestController
@RequestMapping("/api/user")
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·ä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥æ¥å£")
public class UserController {

    @Operation(
        summary = "è·å–ç”¨æˆ·åˆ—è¡¨",
        description = "åˆ†é¡µè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ”¯æŒæ¡ä»¶æŸ¥è¯¢",
        responses = {
            @ApiResponse(
                responseCode = "200",
                description = "æŸ¥è¯¢æˆåŠŸ",
                content = @Content(
                    mediaType = "application/json",
                    schema = @Schema(implementation = PageResult.class)
                )
            ),
            @ApiResponse(
                responseCode = "401",
                description = "æœªæˆæƒ",
                content = @Content(
                    mediaType = "application/json",
                    schema = @Schema(implementation = ResponseDTO.class)
                )
            )
        }
    )
    @GetMapping("/list")
    @SaCheckPermission("user:list")
    public ResponseDTO<PageResult<UserVO>> getUserList(
            @Parameter(description = "ç”¨æˆ·æŸ¥è¯¢æ¡ä»¶") UserQueryForm queryForm) {
        // å®ç°é€»è¾‘
    }
}
```

## æ•°æ®å¥‘çº¦å®šä¹‰

### ğŸ“‹ å®ä½“ç±»å¥‘çº¦

#### 1. æ ‡å‡†å®ä½“åŸºç±»
```java
@Data
@EqualsAndHashCode(callSuper = false)
@TableName("t_user")
@ApiModel(description = "ç”¨æˆ·å®ä½“")
public class UserEntity extends BaseEntity {

    @ApiModelProperty("ç”¨æˆ·ID")
    @TableId(type = IdType.AUTO)
    private Long userId;

    @ApiModelProperty("ç”¨æˆ·å")
    @TableField("user_name")
    private String userName;

    @ApiModelProperty("çœŸå®å§“å")
    @TableField("real_name")
    private String realName;

    @ApiModelProperty("æ‰‹æœºå·")
    @TableField("phone")
    private String phone;

    @ApiModelProperty("é‚®ç®±")
    @TableField("email")
    private String email;

    @ApiModelProperty("å¤´åƒ")
    @TableField("avatar")
    private String avatar;

    @ApiModelProperty("ç”¨æˆ·çŠ¶æ€")
    @TableField("user_status")
    private UserStatus userStatus;

    @ApiModelProperty("éƒ¨é—¨ID")
    @TableField("dept_id")
    private Long deptId;

    @ApiModelProperty("è§’è‰²IDåˆ—è¡¨")
    @TableField(exist = false)
    @TableField(type = FieldType.JAVA_TYPE, javaType = Long.class)
    private List<Long> roleIds;
}
```

#### 2. VOæ•°æ®ä¼ è¾“å¯¹è±¡
```java
@Data
@ApiModel(description = "ç”¨æˆ·è§†å›¾å¯¹è±¡")
public class UserVO {

    @ApiModelProperty("ç”¨æˆ·ID")
    private Long userId;

    @ApiModelProperty("ç”¨æˆ·å")
    private String userName;

    @ApiModelProperty("çœŸå®å§“å")
    private String realName;

    @ApiModelProperty("æ‰‹æœºå·")
    private String phone;

    @ApiModelProperty("é‚®ç®±")
    private String email;

    @ApiModelProperty("å¤´åƒ")
    private String avatar;

    @ApiModelProperty("ç”¨æˆ·çŠ¶æ€")
    private UserStatus userStatus;

    @ApiModelProperty("éƒ¨é—¨åç§°")
    private String deptName;

    @ApiModelProperty("è§’è‰²åç§°åˆ—è¡¨")
    private List<String> roleNames;

    @ApiModelProperty("åˆ›å»ºæ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createTime;

    @ApiModelProperty("æœ€åç™»å½•æ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime lastLoginTime;
}
```

#### 3. Formè¡¨å•å¯¹è±¡
```java
@Data
@ApiModel(description = "ç”¨æˆ·è¡¨å•å¯¹è±¡")
public class UserForm {

    @ApiModelProperty("ç”¨æˆ·ID (ç¼–è¾‘æ—¶å¿…å¡«)")
    private Long userId;

    @ApiModelProperty("ç”¨æˆ·å (å¿…å¡«)")
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Length(min = 3, max = 50, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-50ä¸ªå­—ç¬¦ä¹‹é—´")
    private String userName;

    @ApiModelProperty("çœŸå®å§“å (å¿…å¡«)")
    @NotBlank(message = "çœŸå®å§“åä¸èƒ½ä¸ºç©º")
    @Length(max = 50, message = "çœŸå®å§“åé•¿åº¦ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦")
    private String realName;

    @ApiModelProperty("æ‰‹æœºå· (å¿…å¡«)")
    @NotBlank(message = "æ‰‹æœºå·ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;

    @ApiModelProperty("é‚®ç®±")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;

    @ApiModelProperty("å¤´åƒ")
    private String avatar;

    @ApiModelProperty("ç”¨æˆ·çŠ¶æ€")
    private UserStatus userStatus;

    @ApiModelProperty("éƒ¨é—¨ID")
    private Long deptId;

    @ApiModelProperty("è§’è‰²IDåˆ—è¡¨")
    private List<Long> roleIds;

    @ApiModelProperty("å¯†ç  (æ–°å¢æ—¶å¿…å¡«)")
    @Size(min = 6, max = 20, message = "å¯†ç é•¿åº¦å¿…é¡»åœ¨6-20ä¸ªå­—ç¬¦ä¹‹é—´")
    private String password;
}
```

## æ¥å£ç‰ˆæœ¬ç®¡ç†

### ğŸ“ˆ ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

#### 1. APIç‰ˆæœ¬è§„èŒƒ
```java
@RestController
@RequestMapping("/api/v1/user")  // v1ç‰ˆæœ¬
public class UserV1Controller {
    // v1ç‰ˆæœ¬çš„æ¥å£å®ç°
}

@RestController
@RequestMapping("/api/v2/user")  // v2ç‰ˆæœ¬
public class UserV2Controller {
    // v2ç‰ˆæœ¬çš„æ¥å£å®ç°ï¼ˆå‘åå…¼å®¹ï¼‰
}
```

#### 2. ç‰ˆæœ¬å…¼å®¹å¤„ç†
```java
@RestController
@RequestMapping("/api/user")
public class UserController {

    @GetMapping("/{id}")
    public ResponseDTO<UserVO> getUser(
            @PathVariable Long id,
            @RequestHeader(value = "API-Version", defaultValue = "v1") String apiVersion) {

        // æ ¹æ®ç‰ˆæœ¬è°ƒç”¨ä¸åŒçš„æœåŠ¡
        if ("v2".equals(apiVersion)) {
            return userV2Service.getUserById(id);
        } else {
            return userV1Service.getUserById(id);
        }
    }
}
```

## é›†æˆæ¥å£è§„èŒƒ

### ğŸ”— å¤–éƒ¨ç³»ç»Ÿé›†æˆ

#### 1. è®¾å¤‡å‚å•†é›†æˆ
```java
@Component
public abstract class DeviceAdapter {

    /**
     * è®¾å¤‡è¿æ¥
     */
    public abstract boolean connect(String deviceId);

    /**
     * è®¾å¤‡æ–­å¼€
     */
    public abstract boolean disconnect(String deviceId);

    /**
     * è®¾å¤‡æ§åˆ¶
     */
    public abstract boolean controlDevice(String deviceId, DeviceCommand command);

    /**
     * çŠ¶æ€æŸ¥è¯¢
     */
    public abstract DeviceStatus getDeviceStatus(String deviceId);
}

// æµ·åº·å¨è§†é€‚é…å™¨
@Component
public class HikvisionDeviceAdapter extends DeviceAdapter {

    @Override
    public boolean connect(String deviceId) {
        // å®ç°æµ·åº·å¨è§†è®¾å¤‡è¿æ¥é€»è¾‘
        return hikvisionSDK.connect(deviceId);
    }
}
```

#### 2. ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
```java
@Service
public class PaymentService {

    @Resource
    private AlipayService alipayService;

    @Resource
    private WechatPayService wechatPayService;

    @Resource
    private UnionpayService unionpayService;

    public PaymentResult processPayment(PaymentRequest request) {
        switch (request.getPaymentType()) {
            case ALIPAY:
                return alipayService.processPayment(request);
            case WECHAT:
                return wechatPayService.processPayment(request);
            case UNIONPAY:
                return unionpayService.processPayment(request);
            default:
                throw new UnsupportedOperationException("ä¸æ”¯æŒçš„æ”¯ä»˜ç±»å‹");
        }
    }
}
```

## æˆåŠŸæ ‡å‡†

### Task 1.4 å®Œæˆæ ‡å‡†
- âœ… ç³»ç»Ÿè¾¹ç•Œå·²æ¸…æ™°å®šä¹‰
- âœ… æ¥å£å¥‘çº¦å·²æ ‡å‡†åŒ–
- âœ… æ•°æ®æ¨¡å‹å·²æ–‡æ¡£åŒ–
- âœ… é›†æˆæ¥å£å·²è§„èŒƒåŒ–

### è´¨é‡ä¿éšœ
- åŸºäºå®é™…ä»£ç åˆ†æï¼Œ100%å¯éªŒè¯
- ä½¿ç”¨æ ‡å‡†åŒ–çš„APIæ–‡æ¡£æ ¼å¼
- æä¾›å®Œæ•´çš„æ¥å£ç¤ºä¾‹
- ä¸å¾®æœåŠ¡åŒ–ç›®æ ‡ä¿æŒä¸€è‡´

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

Task 1.4çš„ç³»ç»Ÿè¾¹ç•Œå’Œæ¥å£æ–‡æ¡£åŒ–ä¸ºå¾®æœåŠ¡åŒ–è®¾è®¡æä¾›äº†é‡è¦åŸºç¡€ï¼š
- æ˜ç¡®äº†å„æ¨¡å—çš„ä¸šåŠ¡è¾¹ç•Œå’ŒèŒè´£
- å»ºç«‹äº†æ ‡å‡†åŒ–çš„æ¥å£å¥‘çº¦è§„èŒƒ
- å®šä¹‰äº†å®Œæ•´çš„æ•°æ®æ¨¡å‹å’Œç‰ˆæœ¬ç®¡ç†
- è§„èŒƒäº†å¤–éƒ¨ç³»ç»Ÿé›†æˆæ–¹å¼

ä¸‹ä¸€æ­¥å°†ç»§ç»­æ‰§è¡ŒTask 1.5: è¯„ä¼°å›¢é˜Ÿå¼€å‘ç“¶é¢ˆï¼Œä¸ºå›¢é˜Ÿåä½œä¼˜åŒ–æä¾›æŒ‡å¯¼å»ºè®®ã€‚