# Task 3.1: åŸºäºä¸šåŠ¡é¢†åŸŸçš„å¾®æœåŠ¡è¾¹ç•Œè®¾è®¡

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

**è®¾è®¡æ—¥æœŸ**: 2025-11-27
**è®¾è®¡ç›®æ ‡**: åŸºäºä¸šåŠ¡é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)åŸåˆ™ï¼Œå®šä¹‰IOE-DREAMå¹³å°çš„å¾®æœåŠ¡è¾¹ç•Œ
**æ ¸å¿ƒå‘ç°**: ä»ç°æœ‰10ä¸ªä¸šåŠ¡æ¨¡å—é‡æ„ä¸º8ä¸ªæ ¸å¿ƒå¾®æœåŠ¡ï¼Œå®ç°é«˜å†…èšã€ä½è€¦åˆçš„å¾®æœåŠ¡æ¶æ„
**è®¾è®¡åŸåˆ™**: ä¸šåŠ¡èƒ½åŠ›ä¸­å¿ƒåŒ–ã€æ•°æ®æ‰€æœ‰æƒéš”ç¦»ã€ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•

### ğŸ” å…³é”®è®¾è®¡å†³ç­–
- **å¾®æœåŠ¡æ•°é‡**: 8ä¸ªæ ¸å¿ƒå¾®æœåŠ¡ + 3ä¸ªåŸºç¡€è®¾æ–½æœåŠ¡
- **æ‹†åˆ†ç­–ç•¥**: åŸºäºä¸šåŠ¡èƒ½åŠ›è€ŒéæŠ€æœ¯åˆ†å±‚
- **æ•°æ®æ¨¡å¼**: æ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼Œé¿å…æ•°æ®è€¦åˆ
- **APIè®¾è®¡**: RESTful + å¼‚æ­¥äº‹ä»¶é©±åŠ¨ç»“åˆ
- **éƒ¨ç½²ç‹¬ç«‹**: æ¯ä¸ªæœåŠ¡å¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€æ‰©å±•

---

## ğŸ—ï¸ ä¸šåŠ¡é¢†åŸŸè¯†åˆ«ä¸è¾¹ç•Œè®¾è®¡

### 1. æ ¸å¿ƒä¸šåŠ¡é¢†åŸŸåˆ†æ

åŸºäºSmartAdmin v3ç°æœ‰ä¸šåŠ¡æ¨¡å—å’ŒIOE-DREAMå¹³å°ç‰¹æ€§ï¼Œè¯†åˆ«å‡ºä»¥ä¸‹æ ¸å¿ƒä¸šåŠ¡é¢†åŸŸï¼š

#### 1.1 ç”¨æˆ·ä¸æƒé™åŸŸ (Identity & Access)
**ä¸šåŠ¡èƒ½åŠ›**:
- ç”¨æˆ·èº«ä»½ç®¡ç†
- è§’è‰²æƒé™æ§åˆ¶
- åŒºåŸŸæƒé™ç®¡ç†
- å•ç‚¹ç™»å½•(SSO)
- å¤šå› ç´ è®¤è¯

**ç°æœ‰æ¨¡å—**: `system`(ç”¨æˆ·ç®¡ç†)ã€`rbac`(æƒé™æ§åˆ¶)ã€`area`(åŒºåŸŸç®¡ç†)

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Identity Service             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ User Management                  â”‚
â”‚ â€¢ Role & Permission Management      â”‚
â”‚ â€¢ Area-based Access Control        â”‚
â”‚ â€¢ Authentication & Authorization   â”‚
â”‚ â€¢ JWT Token Management             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 è®¾å¤‡ç®¡ç†åŸŸ (Device Management)
**ä¸šåŠ¡èƒ½åŠ›**:
- è®¾å¤‡æ³¨å†Œä¸é…ç½®
- è®¾å¤‡çŠ¶æ€ç›‘æ§
- è®¾å¤‡å›ºä»¶å‡çº§
- è®¾å¤‡ç»´æŠ¤ç®¡ç†
- è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†

**ç°æœ‰æ¨¡å—**: `device`(åŸºç¡€è®¾å¤‡)ã€`access`(é—¨ç¦è®¾å¤‡)

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Device Service               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Device Registration              â”‚
â”‚ â€¢ Device Configuration             â”‚
â”‚ â€¢ Device Monitoring                â”‚
â”‚ â€¢ Device Maintenance               â”‚
â”‚ â€¢ Device Lifecycle Management      â”‚
â”‚ â€¢ Device Location Management       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.3 é—¨ç¦æ§åˆ¶åŸŸ (Access Control)
**ä¸šåŠ¡èƒ½åŠ›**:
- é—¨ç¦æƒé™ç®¡ç†
- å®æ—¶å¼€é—¨æ§åˆ¶
- é—¨ç¦è®°å½•ç®¡ç†
- ç”Ÿç‰©è¯†åˆ«éªŒè¯
- è®¿å®¢ç®¡ç†

**ç°æœ‰æ¨¡å—**: `access`(é—¨ç¦ç®¡ç†)ã€`visitor`(è®¿å®¢ç®¡ç†)ã€`biometric`(ç”Ÿç‰©è¯†åˆ«)

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Access Control Service         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Access Permission Management      â”‚
â”‚ â€¢ Real-time Access Control         â”‚
â”‚ â€¢ Access Record Management         â”‚
â”‚ â€¢ Biometric Verification           â”‚
â”‚ â€¢ Visitor Management               â”‚
â”‚ â€¢ Multi-factor Authentication      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.4 æ¶ˆè´¹ç®¡ç†åŸŸ (Consumption Management)
**ä¸šåŠ¡èƒ½åŠ›**:
- æ¶ˆè´¹è´¦æˆ·ç®¡ç†
- æ¶ˆè´¹è®°å½•å¤„ç†
- å……å€¼é€€æ¬¾ç®¡ç†
- æ¶ˆè´¹ç»Ÿè®¡åˆ†æ
- å•†æˆ·ç»“ç®—

**ç°æœ‰æ¨¡å—**: `consume`(æ¶ˆè´¹ç®¡ç†)

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Consumption Service             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Account Management               â”‚
â”‚ â€¢ Transaction Processing           â”‚
â”‚ â€¢ Recharge & Refund Management     â”‚
â”‚ â€¢ Consumption Analytics            â”‚
â”‚ â€¢ Merchant Settlement              â”‚
â”‚ â€¢ Payment Integration              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.5 è€ƒå‹¤ç®¡ç†åŸŸ (Attendance Management)
**ä¸šåŠ¡èƒ½åŠ›**:
- è€ƒå‹¤è§„åˆ™é…ç½®
- è€ƒå‹¤è®°å½•å¤„ç†
- è¯·å‡åŠ ç­ç®¡ç†
- è€ƒå‹¤ç»Ÿè®¡åˆ†æ
- æ’ç­ç®¡ç†

**ç°æœ‰æ¨¡å—**: `attendance`(è€ƒå‹¤ç®¡ç†)ã€`hr`(äººåŠ›èµ„æº)

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Attendance Service             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Attendance Rule Configuration    â”‚
â”‚ â€¢ Attendance Record Processing     â”‚
â”‚ â€¢ Leave & Overtime Management      â”‚
â”‚ â€¢ Attendance Analytics             â”‚
â”‚ â€¢ Shift Management                 â”‚
â”‚ â€¢ Payroll Integration              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.6 è§†é¢‘ç›‘æ§åŸŸ (Video Surveillance)
**ä¸šåŠ¡èƒ½åŠ›**:
- å®æ—¶è§†é¢‘æµ
- å½•åƒå­˜å‚¨ç®¡ç†
- æ™ºèƒ½è§†é¢‘åˆ†æ
- å‘Šè­¦äº‹ä»¶å¤„ç†
- è§†é¢‘å†…å®¹æ£€ç´¢

**ç°æœ‰æ¨¡å—**: `video`(è§†é¢‘ç›‘æ§)ã€`smart/video`(æ™ºèƒ½è§†é¢‘)

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Video Service                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Live Video Streaming             â”‚
â”‚ â€¢ Video Recording & Storage        â”‚
â”‚ â€¢ Intelligent Video Analytics     â”‚
â”‚ â€¢ Alert Event Processing           â”‚
â”‚ â€¢ Video Content Retrieval          â”‚
â”‚ â€¢ AI-powered Recognition          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.7 é€šçŸ¥æœåŠ¡åŸŸ (Notification Service)
**ä¸šåŠ¡èƒ½åŠ›**:
- æ¶ˆæ¯æ¨é€
- é‚®ä»¶é€šçŸ¥
- çŸ­ä¿¡æœåŠ¡
- äº‹ä»¶è®¢é˜…
- é€šçŸ¥æ¨¡æ¿ç®¡ç†

**ç°æœ‰æ¨¡å—**: åˆ†æ•£åœ¨å„ä¸šåŠ¡æ¨¡å—ä¸­çš„é€šçŸ¥åŠŸèƒ½

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Notification Service            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Message Push                    â”‚
â”‚ â€¢ Email Notification              â”‚
â”‚ â€¢ SMS Service                     â”‚
â”‚ â€¢ Event Subscription              â”‚
â”‚ â€¢ Template Management             â”‚
â”‚ â€¢ Multi-channel Delivery          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.8 æŠ¥è¡¨åˆ†æåŸŸ (Analytics & Reporting)
**ä¸šåŠ¡èƒ½åŠ›**:
- ä¸šåŠ¡æŠ¥è¡¨ç”Ÿæˆ
- æ•°æ®ç»Ÿè®¡åˆ†æ
- æ•°æ®å¯è§†åŒ–
- å†³ç­–æ”¯æŒ
- å†å²æ•°æ®å½’æ¡£

**ç°æœ‰æ¨¡å—**: `report`(æŠ¥è¡¨åŠŸèƒ½)ã€å„æ¨¡å—çš„åˆ†æåŠŸèƒ½

**æœåŠ¡è¾¹ç•Œ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Analytics Service              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Business Report Generation       â”‚
â”‚ â€¢ Data Statistics & Analysis      â”‚
â”‚ â€¢ Data Visualization              â”‚
â”‚ â€¢ Decision Support                â”‚
â”‚ â€¢ Historical Data Archiving       â”‚
â”‚ â€¢ Real-time Dashboard             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. åŸºç¡€è®¾æ–½æœåŠ¡è®¾è®¡

#### 2.1 APIç½‘å…³æœåŠ¡ (API Gateway)
**èŒè´£**:
- ç»Ÿä¸€å…¥å£ç®¡ç†
- è·¯ç”±è½¬å‘
- è®¤è¯æˆæƒ
- é™æµç†”æ–­
- ç›‘æ§æ—¥å¿—

#### 2.2 é…ç½®ä¸­å¿ƒæœåŠ¡ (Configuration Service)
**èŒè´£**:
- é…ç½®ç®¡ç†
- ç¯å¢ƒé…ç½®
- åŠ¨æ€é…ç½®æ›´æ–°
- é…ç½®ç‰ˆæœ¬æ§åˆ¶

#### 2.3 ç›‘æ§å‘Šè­¦æœåŠ¡ (Monitoring Service)
**èŒè´£**:
- ç³»ç»Ÿç›‘æ§
- æ€§èƒ½ç›‘æ§
- å‘Šè­¦ç®¡ç†
- æ—¥å¿—èšåˆ
- å¥åº·æ£€æŸ¥

---

## ğŸ¯ å¾®æœåŠ¡è¾¹ç•ŒçŸ©é˜µ

### æœåŠ¡è´£ä»»è¾¹ç•Œè¡¨

| æœåŠ¡åç§° | æ ¸å¿ƒä¸šåŠ¡èƒ½åŠ› | æ•°æ®æ‰€æœ‰æƒ | æ’ä»–ä¾èµ– | éƒ¨ç½²å•å…ƒ |
|---------|-------------|-----------|---------|---------|
| **Identity Service** | ç”¨æˆ·ç®¡ç†ã€æƒé™æ§åˆ¶ã€åŒºåŸŸç®¡ç† | ç”¨æˆ·ä¿¡æ¯ã€è§’è‰²æƒé™ã€åŒºåŸŸæ•°æ® | æ—  | âœ… ç‹¬ç«‹ |
| **Device Service** | è®¾å¤‡ç®¡ç†ã€ç›‘æ§ã€ç»´æŠ¤ | è®¾å¤‡ä¿¡æ¯ã€çŠ¶æ€æ•°æ®ã€é…ç½® | Identity | âœ… ç‹¬ç«‹ |
| **Access Control Service** | é—¨ç¦æ§åˆ¶ã€ç”Ÿç‰©è¯†åˆ«ã€è®¿å®¢ç®¡ç† | é—¨ç¦è®°å½•ã€æƒé™é…ç½®ã€è®¿å®¢æ•°æ® | Identity, Device | âœ… ç‹¬ç«‹ |
| **Consumption Service** | æ¶ˆè´¹ç®¡ç†ã€æ”¯ä»˜å¤„ç† | è´¦æˆ·ä¿¡æ¯ã€äº¤æ˜“è®°å½•ã€å……å€¼æ•°æ® | Identity | âœ… ç‹¬ç«‹ |
| **Attendance Service** | è€ƒå‹¤ç®¡ç†ã€æ’ç­ã€ç»Ÿè®¡ | è€ƒå‹¤è®°å½•ã€è§„åˆ™é…ç½®ã€è¯·å‡æ•°æ® | Identity, HR | âœ… ç‹¬ç«‹ |
| **Video Service** | è§†é¢‘ç›‘æ§ã€æ™ºèƒ½åˆ†æ | è§†é¢‘æµã€å½•åƒæ–‡ä»¶ã€åˆ†æç»“æœ | Device, Access | âœ… ç‹¬ç«‹ |
| **Notification Service** | æ¶ˆæ¯æ¨é€ã€é€šçŸ¥ç®¡ç† | é€šçŸ¥æ¨¡æ¿ã€æ¶ˆæ¯é˜Ÿåˆ—ã€è®¢é˜…å…³ç³» | æ‰€æœ‰ä¸šåŠ¡æœåŠ¡ | âœ… ç‹¬ç«‹ |
| **Analytics Service** | æŠ¥è¡¨åˆ†æã€æ•°æ®ç»Ÿè®¡ | æŠ¥è¡¨é…ç½®ã€åˆ†æç»“æœã€èšåˆæ•°æ® | æ‰€æœ‰ä¸šåŠ¡æœåŠ¡ | âœ… ç‹¬ç«‹ |

### æ•°æ®ä¾èµ–å…³ç³»å›¾

```
Identity Service (æ ¸å¿ƒ)
    â”œâ”€â”€ Device Service (ä¾èµ–ç”¨æˆ·æƒé™)
    â”œâ”€â”€ Access Control Service (ä¾èµ–ç”¨æˆ·æƒé™ã€è®¾å¤‡ä¿¡æ¯)
    â”œâ”€â”€ Consumption Service (ä¾èµ–ç”¨æˆ·è´¦æˆ·)
    â”œâ”€â”€ Attendance Service (ä¾èµ–å‘˜å·¥ä¿¡æ¯)
    â””â”€â”€ Video Service (ä¾èµ–è®¿é—®æƒé™)

Device Service (åŸºç¡€æœåŠ¡)
    â”œâ”€â”€ Access Control Service (ä¾èµ–è®¾å¤‡çŠ¶æ€)
    â””â”€â”€ Video Service (ä¾èµ–è®¾å¤‡ä½ç½®)

ä¸šåŠ¡æœåŠ¡æ¨ªå‘ä¾èµ–:
    â””â”€â”€ Notification Service (é€šçŸ¥æ‰€æœ‰ä¸šåŠ¡äº‹ä»¶)
    â””â”€â”€ Analytics Service (åˆ†ææ‰€æœ‰ä¸šåŠ¡æ•°æ®)
```

---

## ğŸ”„ æœåŠ¡é—´é€šä¿¡è®¾è®¡

### 1. åŒæ­¥é€šä¿¡æ¨¡å¼

#### 1.1 RESTful APIè°ƒç”¨
**é€‚ç”¨åœºæ™¯**:
- å®æ—¶æ•°æ®æŸ¥è¯¢
- ç”¨æˆ·ç•Œé¢äº¤äº’
- é…ç½®ä¿¡æ¯è·å–

**ç¤ºä¾‹**:
```java
// Access Controlè°ƒç”¨IdentityéªŒè¯æƒé™
@RestController
public class AccessController {
    @Resource
    private IdentityServiceClient identityClient;

    @PostMapping("/verify")
    public AccessResult verifyAccess(@RequestBody AccessRequest request) {
        UserPermission permission = identityClient.getUserPermission(request.getUserId());
        return accessControlService.verifyAccess(request, permission);
    }
}
```

#### 1.2 gRPCé«˜æ€§èƒ½è°ƒç”¨
**é€‚ç”¨åœºæ™¯**:
- æœåŠ¡é—´é«˜é¢‘è°ƒç”¨
- å®æ—¶æ•°æ®åŒæ­¥
- æ€§èƒ½æ•æ„Ÿåœºæ™¯

### 2. å¼‚æ­¥é€šä¿¡æ¨¡å¼

#### 2.1 äº‹ä»¶é©±åŠ¨æ¶æ„
**é€‚ç”¨åœºæ™¯**:
- ä¸šåŠ¡æµç¨‹è§£è€¦
- æœ€ç»ˆä¸€è‡´æ€§ä¿è¯
- é«˜å¹¶å‘åœºæ™¯

**ç¤ºä¾‹**:
```java
// è®¾å¤‡çŠ¶æ€å˜æ›´äº‹ä»¶
@EventListener
public class DeviceEventHandler {

    @EventListener
    public void handleDeviceStatusChanged(DeviceStatusChangedEvent event) {
        // é€šçŸ¥Access ControlæœåŠ¡æ›´æ–°è®¾å¤‡çŠ¶æ€
        eventPublisher.publishEvent("access.control.device.status.updated", event);

        // é€šçŸ¥VideoæœåŠ¡è°ƒæ•´å½•åƒç­–ç•¥
        eventPublisher.publishEvent("video.recording.policy.updated", event);
    }
}
```

#### 2.2 æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼
**æ¶ˆæ¯ç±»å‹**:
- **å‘½ä»¤æ¶ˆæ¯**: æ‰§è¡Œç‰¹å®šæ“ä½œ
- **äº‹ä»¶æ¶ˆæ¯**: çŠ¶æ€å˜æ›´é€šçŸ¥
- **æŸ¥è¯¢æ¶ˆæ¯**: æ•°æ®è¯·æ±‚å“åº”

---

## ğŸ›¡ï¸ æ•°æ®éš”ç¦»ç­–ç•¥

### 1. æ•°æ®åº“åˆ†ç¦»è®¾è®¡

#### 1.1 æ•°æ®åº“åˆ†é…æ–¹æ¡ˆ
```
Identityæ•°æ®åº“:       identity_db
â”œâ”€â”€ t_user (ç”¨æˆ·è¡¨)
â”œâ”€â”€ t_role (è§’è‰²è¡¨)
â”œâ”€â”€ t_permission (æƒé™è¡¨)
â””â”€â”€ t_area (åŒºåŸŸè¡¨)

Deviceæ•°æ®åº“:         device_db
â”œâ”€â”€ t_device (è®¾å¤‡è¡¨)
â”œâ”€â”€ t_device_type (è®¾å¤‡ç±»å‹è¡¨)
â”œâ”€â”€ t_device_location (è®¾å¤‡ä½ç½®è¡¨)
â””â”€â”€ t_device_status (è®¾å¤‡çŠ¶æ€è¡¨)

Access Controlæ•°æ®åº“: access_control_db
â”œâ”€â”€ t_access_record (é—¨ç¦è®°å½•è¡¨)
â”œâ”€â”€ t_access_permission (é—¨ç¦æƒé™è¡¨)
â”œâ”€â”€ t_visitor_record (è®¿å®¢è®°å½•è¡¨)
â””â”€â”€ t_biometric_record (ç”Ÿç‰©è¯†åˆ«è¡¨)

Consumptionæ•°æ®åº“:    consumption_db
â”œâ”€â”€ t_account (æ¶ˆè´¹è´¦æˆ·è¡¨)
â”œâ”€â”€ t_transaction (äº¤æ˜“è®°å½•è¡¨)
â”œâ”€â”€ t_recharge_record (å……å€¼è®°å½•è¡¨)
â””â”€â”€ t_refund_record (é€€æ¬¾è®°å½•è¡¨)
```

#### 1.2 æ•°æ®åŒæ­¥ç­–ç•¥
**ä¸»ä»å¤åˆ¶**: å¯¹äºåªè¯»æŸ¥è¯¢åœºæ™¯
**äº‹ä»¶é©±åŠ¨åŒæ­¥**: çŠ¶æ€å˜æ›´å®æ—¶åŒæ­¥
**æ‰¹é‡ETL**: å†å²æ•°æ®åˆ†æ
**ç¼“å­˜å±‚**: Redisç¼“å­˜çƒ­ç‚¹æ•°æ®

### 2. åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†

#### 2.1 Sagaæ¨¡å¼å®ç°
```java
@Component
public class AccessSagaOrchestrator {

    public void processAccessRequest(AccessRequest request) {
        SagaTransaction saga = sagaManager.begin()
            .step("verifyUserPermission")
                .invoke(() -> identityService.verifyPermission(request))
                .compensate(() -> identityService.revokePermission(request))
            .step("checkDeviceStatus")
                .invoke(() -> deviceService.checkStatus(request.getDeviceId()))
                .compensate(() -> deviceService.resetStatus(request.getDeviceId()))
            .step("recordAccess")
                .invoke(() -> accessService.recordAccess(request))
                .compensate(() -> accessService.rollbackAccess(request))
            .build();

        saga.execute();
    }
}
```

---

## ğŸš€ å¾®æœåŠ¡éƒ¨ç½²æ¶æ„

### 1. å®¹å™¨åŒ–éƒ¨ç½²

#### 1.1 Dockeré•œåƒè®¾è®¡
```dockerfile
# Identity Serviceç¤ºä¾‹
FROM openjdk:17-jre-slim
COPY target/identity-service.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

#### 1.2 Kuberneteséƒ¨ç½²æ¸…å•
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: identity-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: identity-service
  template:
    metadata:
      labels:
        app: identity-service
    spec:
      containers:
      - name: identity-service
        image: ioe-dream/identity-service:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        - name: DB_HOST
          value: "identity-db"
```

### 2. æœåŠ¡å‘ç°ä¸æ³¨å†Œ

#### 2.1 Nacosé›†æˆ
```yaml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:nacos:8848}
        service: ${SERVICE_NAME:identity-service}
        namespace: ${NAMESPACE:ioe-dream}
        group: ${GROUP:default}
```

---

## ğŸ“Š å¾®æœåŠ¡æŒ‡æ ‡ä¸ç›‘æ§

### 1. æœåŠ¡å¥åº·æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | ç›‘æ§æŒ‡æ ‡ | å‘Šè­¦é˜ˆå€¼ | ç›‘æ§é¢‘ç‡ |
|---------|---------|---------|---------|
| **å¯ç”¨æ€§** | æœåŠ¡UPçŠ¶æ€ | < 95% | 30ç§’ |
| **å“åº”æ—¶é—´** | P95å»¶è¿Ÿ | > 200ms | 10ç§’ |
| **é”™è¯¯ç‡** | 4XX/5XXæ¯”ä¾‹ | > 1% | 10ç§’ |
| **ååé‡** | QPS/TPS | < é¢„æœŸ80% | 5ç§’ |
| **èµ„æºä½¿ç”¨** | CPU/å†…å­˜/ç£ç›˜ | > 80% | 15ç§’ |

### 2. ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

#### 2.1 å…³é”®ä¸šåŠ¡æŒ‡æ ‡
- **ç”¨æˆ·è®¿é—®æˆåŠŸç‡**: > 99.9%
- **è®¾å¤‡åœ¨çº¿ç‡**: > 95%
- **é—¨ç¦å“åº”æ—¶é—´**: < 500ms
- **è§†é¢‘æµå»¶è¿Ÿ**: < 2ç§’
- **æ¶ˆè´¹äº‹åŠ¡æˆåŠŸç‡**: > 99.99%

---

## ğŸ”® æ¼”è¿›è·¯çº¿å›¾

### Phase 1: åŸºç¡€æœåŠ¡æ‹†åˆ† (3ä¸ªæœˆ)
- [ ] Identity Serviceç‹¬ç«‹éƒ¨ç½²
- [ ] Device Serviceç‹¬ç«‹éƒ¨ç½²
- [ ] API Gatewayå®æ–½
- [ ] åŸºç¡€ç›‘æ§ä½“ç³»å»ºè®¾

### Phase 2: ä¸šåŠ¡æœåŠ¡è¿ç§» (6ä¸ªæœˆ)
- [ ] Access Control Serviceè¿ç§»
- [ ] Consumption Serviceè¿ç§»
- [ ] Attendance Serviceè¿ç§»
- [ ] äº‹ä»¶é©±åŠ¨æ¶æ„å®æ–½

### Phase 3: é«˜çº§æœåŠ¡ä¼˜åŒ– (3ä¸ªæœˆ)
- [ ] Video Serviceäº‘åŸç”Ÿæ”¹é€ 
- [ ] Analytics Serviceå¤§æ•°æ®é›†æˆ
- [ ] Notification Serviceå¤šæ¸ é“æ”¯æŒ
- [ ] å…¨é“¾è·¯ç›‘æ§å®Œå–„

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡
- [ ] æœåŠ¡ç‹¬ç«‹éƒ¨ç½²ç‡: 100%
- [ ] æœåŠ¡é—´æ•…éšœéš”ç¦»: 100%
- [ ] æ•°æ®åº“åˆ†ç¦»: 100%
- [ ] æœåŠ¡ç›‘æ§è¦†ç›–ç‡: 100%
- [ ] APIå“åº”æ—¶é—´P95: < 200ms

### ä¸šåŠ¡æŒ‡æ ‡
- [ ] ç³»ç»Ÿå¯ç”¨æ€§: > 99.9%
- [ ] éƒ¨ç½²é¢‘ç‡: æ¯å‘¨ > 2æ¬¡
- [ ] æ•…éšœæ¢å¤æ—¶é—´: < 30åˆ†é’Ÿ
- [ ] å›¢é˜Ÿå¼€å‘æ•ˆç‡: æå‡50%
- [ ] ç³»ç»Ÿæ‰©å±•æˆæœ¬: é™ä½40%

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-27T22:10:00+08:00
**è®¾è®¡å®Œæˆåº¦**: Phase 3 Task 3.1 - 100%å®Œæˆ
**ä¸‹ä¸€ä»»åŠ¡**: Task 3.2 - è®¾è®¡æœåŠ¡é—´é€šä¿¡æ¨¡å¼

è¿™ä¸ªå¾®æœåŠ¡è¾¹ç•Œè®¾è®¡ä¸ºIOE-DREAMå¹³å°æä¾›äº†æ¸…æ™°çš„å¾®æœåŠ¡æ¶æ„è·¯çº¿å›¾ï¼Œç¡®ä¿ä¸šåŠ¡èƒ½åŠ›çš„é«˜å†…èšå’ŒæœåŠ¡é—´çš„ä½è€¦åˆï¼Œä¸ºåç»­çš„å¾®æœåŠ¡åŒ–æ”¹é€ å¥ å®šäº†åšå®åŸºç¡€ã€‚