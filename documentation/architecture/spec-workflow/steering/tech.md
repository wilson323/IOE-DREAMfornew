# IOE-DREAM 技术架构文档

## 项目类型

IOE-DREAM是一个基于**企业级Web应用架构**的智慧园区综合管理平台，采用**前后端分离**的现代化架构模式，支持多租户SaaS部署和私有化部署两种模式。

## 核心技术栈

### 主要编程语言

- **后端语言**: Java 17 (LTS版本)
- **前端语言**: JavaScript (ES2022) + TypeScript 5.0+
- **数据库语言**: SQL (MySQL 8.0+) + NoSQL (Redis 7.0+)
- **脚本语言**: Shell Script + PowerShell

### 关键依赖库和框架

#### 后端核心框架
- **Spring Boot**: 3.1.5 (企业级应用框架)
- **Spring Security**: 6.1 (安全认证和授权)
- **Spring Data JPA**: 3.1 (数据访问层)
- **Spring Cloud**: 2022.0.4 (微服务架构)
- **MyBatis-Plus**: 3.5.3 (ORM增强框架)
- **Sa-Token**: 1.37 (轻量级权限框架)

#### 前端核心框架
- **Vue.js**: 3.3 (渐进式JavaScript框架)
- **Vite**: 4.4 (构建工具)
- **Pinia**: 2.1 (状态管理)
- **Ant Design Vue**: 4.0 (UI组件库)
- **Vue Router**: 4.2 (路由管理)
- **TypeScript**: 5.0 (类型安全)

#### 数据存储和缓存
- **MySQL**: 8.0 (主数据库)
- **Redis**: 7.0 (缓存和会话存储)
- **MinIO**: 分布式对象存储
- **Elasticsearch**: 8.8 (搜索引擎和日志分析)

### 应用架构

#### 当前架构模式
**单体分层架构** (四层架构模式)
```
前端层 (Vue 3 + TypeScript)
    ↓
控制器层 (Spring MVC Controllers)
    ↓
业务逻辑层 (Spring Services)
    ↓
数据访问层 (MyBatis-Plus Mappers)
    ↓
数据存储层 (MySQL + Redis)
```

#### 计划架构模式
**微服务架构** (基于Spring Cloud)
```
API网关 (Spring Cloud Gateway)
    ↓
微服务集群
├── 用户权限服务 (User Service)
├── 门禁管理服务 (Access Service)
├── 消费管理服务 (Consume Service)
├── 考勤管理服务 (Attendance Service)
├── 访客管理服务 (Visitor Service)
├── 视频监控服务 (Video Service)
├── 设备管理服务 (Device Service)
└── 通知服务 (Notification Service)
    ↓
服务注册发现 (Nacos)
    ↓
配置中心 (Nacos Config)
    ↓
消息中间件 (RabbitMQ/Kafka)
```

### 外部集成系统

#### 硬件设备集成
- **门禁设备**: 支持多品牌门禁控制器 (海康威视、大华、中控智慧)
- **消费终端**: POS机、自助消费机、移动支付终端
- **考勤设备**: 考勤机、人脸识别终端、移动定位
- **监控设备**: IP摄像头、NVR系统、智能分析设备

#### 第三方服务集成
- **支付服务**: 支付宝、微信支付、银联支付
- **短信服务**: 阿里云短信、腾讯云短信
- **推送服务**: 苹果APNS、安卓FCM、WebSocket长连接
- **地图服务**: 高德地图、百度地图、腾讯地图
- **人脸识别**: 商汤、旷视、百度AI

### 监控和运维技术

#### 监控系统
- **应用监控**: Prometheus + Grafana
- **日志管理**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **链路追踪**: SkyWalking
- **健康检查**: Spring Boot Actuator
- **告警通知**: AlertManager + 钉钉/企业微信

#### 运维工具
- **容器化**: Docker + Docker Compose
- **编排管理**: Kubernetes
- **CI/CD**: Jenkins + GitLab CI
- **配置管理**: Ansible
- **自动化测试**: JUnit + Mockito + Selenium

## 开发环境

### 构建和开发工具

#### 后端开发工具
- **构建系统**: Maven 3.9+
- **依赖管理**: Maven Central + 私有仓库
- **开发环境**: IntelliJ IDEA Ultimate 2023+
- **代码热重载**: Spring Boot DevTools
- **数据库工具**: Navicat Premium + Redis Desktop Manager

#### 前端开发工具
- **包管理器**: npm 9+ + yarn 1.22+
- **构建工具**: Vite 4.4+
- **开发服务器**: Vite Dev Server (端口8081)
- **代码格式化**: Prettier + ESLint
- **代码热重载**: Vite HMR (Hot Module Replacement)

### 代码质量工具

#### 静态分析工具
- **后端**: SpotBugs + PMD + SonarQube
- **前端**: ESLint + TypeScript + Vue TSC
- **安全扫描**: OWASP Dependency Check + Snyk
- **代码覆盖率**: JaCoCo + Jest

#### 代码规范工具
- **格式化**: Google Java Format + Prettier
- **提交检查**: Pre-commit hooks + Husky
- **代码审查**: GitHub Code Review + Sonar Code Review
- **文档生成**: Javadoc + VuePress

### 版本控制和协作

#### 版本控制系统
- **VCS**: Git 2.40+
- **托管平台**: GitLab (私有部署)
- **分支策略**: GitFlow
- **代码审查**: GitLab Merge Request

#### 协作流程
- **项目管理**: Jira + Confluence
- **持续集成**: GitLab CI/CD
- **发布流程**: GitLab CI + Docker Registry
- **文档协作**: GitLab Wiki + Confluence

## 部署和分发

### 目标平台

#### 云平台支持
- **私有云**: OpenStack + VMware vSphere
- **公有云**: 阿里云 + 腾讯云 + 华为云
- **混合云**: 统一管理平台
- **边缘计算**: 支持边缘节点部署

#### 部署模式
- **SaaS模式**: 多租户架构，按需付费
- **私有化部署**: 单租户架构，一次性许可
- **混合部署**: 核心SaaS + 边缘私有化

### 分发方式

#### 软件分发
- **容器镜像**: Docker Hub + 私有Registry
- **包管理**: Helm Charts + Kustomize
- **二进制包**: Windows Installer + Linux DEB/RPM
- **云端部署**: Kubernetes YAML + Terraform

### 安装要求

#### 系统要求
- **操作系统**: CentOS 8+, Ubuntu 20.04+, Windows Server 2019+
- **Java版本**: OpenJDK 17+ 或 Oracle JDK 17+
- **数据库**: MySQL 8.0+ 或 MariaDB 10.6+
- **缓存**: Redis 6.0+
- **最小内存**: 8GB RAM
- **最小存储**: 100GB SSD

### 更新机制

#### 自动更新
- **热更新**: 支持滚动更新，零停机时间
- **蓝绿部署**: 支持多环境灰度发布
- **版本回滚**: 支持快速回滚到历史版本
- **配置热更新**: 支持运行时配置更新

## 技术要求和约束

### 性能要求

#### 响应时间要求
- **API平均响应时间**: < 500ms (P95)
- **页面加载时间**: < 2秒
- **数据库查询时间**: < 100ms (P95)
- **文件上传速度**: > 10MB/s

#### 并发能力要求
- **同时在线用户**: 10,000+
- **并发API请求**: 5,000 QPS
- **数据库连接池**: 最大1000连接
- **缓存命中率**: > 90%

### 兼容性要求

#### 浏览器支持
- **Chrome**: 90+ (推荐)
- **Firefox**: 88+
- **Safari**: 14+
- **Edge**: 90+
- **移动端**: iOS Safari 14+, Android Chrome 90+

#### 数据库兼容性
- **MySQL**: 8.0+ (主要支持)
- **MariaDB**: 10.6+ (兼容支持)
- **PostgreSQL**: 13+ (计划支持)

### 安全和合规要求

#### 安全要求
- **身份认证**: 多因素认证 (MFA)
- **数据加密**: AES-256 + TLS 1.3
- **访问控制**: RBAC + ABAC权限模型
- **安全审计**: 完整的操作日志和审计追踪

#### 合规标准
- **数据保护**: 符合GDPR和网络安全法要求
- **等级保护**: 通过等保三级认证
- **密码安全**: 符合国密算法要求
- **隐私保护**: 遵循个人信息保护法

### 可扩展性和可靠性

#### 扩展性要求
- **水平扩展**: 支持服务水平扩展
- **数据扩展**: 支持数据库分库分表
- **缓存扩展**: 支持Redis集群
- **存储扩展**: 支持分布式文件存储

#### 可靠性要求
- **服务可用性**: 99.9% (年停机时间<8.76小时)
- **数据持久性**: 99.999% (年数据丢失概率<0.001%)
- **故障恢复**: RTO < 30分钟, RPO < 5分钟
- **容灾备份**: 支持异地多活

## 技术决策和理由

### 决策日志

#### 1. 选择Spring Boot 3.x作为核心框架
**决策**: 采用Spring Boot 3.1.5作为核心应用框架
**理由**:
- 企业级成熟度，社区活跃，生态完善
- 内置大量生产级特性(监控、健康检查、配置管理)
- 支持响应式编程，性能优秀
- 与现有技术栈兼容性好
**替代方案**: 考虑过Quarkus、Micronaut，但生态成熟度不如Spring Boot

#### 2. 采用Vue 3 + TypeScript前端技术栈
**决策**: 使用Vue 3 Composition API + TypeScript 5.0
**理由**:
- Vue 3性能优秀，组合式API更易维护
- TypeScript提供类型安全，降低运行时错误
- 与团队技术栈匹配，学习成本低
- 丰富的生态系统和组件库
**替代方案**: 考虑过React，但Vue更符合团队习惯

#### 3. 选择MySQL + Redis数据存储方案
**决策**: 主数据库使用MySQL 8.0，缓存使用Redis 7.0
**理由**:
- MySQL是企业级关系型数据库，稳定可靠
- Redis高性能缓存，支持丰富数据结构
- 两者都有成熟的运维经验和工具
- 成本可控，开源方案
**替代方案**: 考虑过PostgreSQL，但MySQL更符合团队经验

#### 4. 实施微服务架构转型计划
**决策**: 从单体架构逐步转向微服务架构
**理由**:
- 当前单体架构已出现性能和扩展性瓶颈
- 业务模块边界清晰，适合微服务拆分
- 支持团队独立开发和部署
- 提高系统可用性和故障隔离能力
**实施策略**: 渐进式拆分，先拆核心业务，后拆支撑服务

#### 5. 容器化部署和Kubernetes编排
**决策**: 采用Docker容器化和Kubernetes编排
**理由**:
- 标准化部署环境，避免环境差异问题
- 支持自动化部署和扩缩容
- 提供服务发现和负载均衡
- 便于多环境管理和版本控制
**替代方案**: 考虑过Docker Swarm，但Kubernetes生态更成熟

#### 6. 选择Nacos作为服务治理中心
**决策**: 使用Alibaba Nacos作为服务注册发现和配置中心
**理由**:
- 阿里巴巴开源，生产级稳定性
- 集成服务发现、配置管理、动态DNS
- 与Spring Cloud生态集成良好
- 支持多环境和多租户
**替代方案**: 考虑过Consul、Eureka，但Nacos功能更全面

## 已知限制和技术债务

### 当前技术债务

#### 1. 编译错误问题
**问题描述**: 381个编译错误，主要由于包路径不匹配
**影响**: 阻塞开发，影响代码质量
**解决方案**:
- 短期：自动化脚本批量修复
- 中期：建立代码质量门禁
- 长期：完善IDE配置和开发规范

#### 2. 安全漏洞问题
**问题描述**: 存在密码明文存储等高风险安全问题
**影响**: 数据安全风险，合规性问题
**解决方案**:
- 立即：修复已知安全漏洞
- 短期：建立安全扫描机制
- 长期：完善安全开发流程

#### 3. 性能瓶颈问题
**问题描述**: 数据库连接不足，API响应时间过长
**影响**: 用户体验差，系统可扩展性受限
**解决方案**:
- 短期：优化数据库配置和查询
- 中期：实施缓存策略
- 长期：架构优化和微服务拆分

### 架构限制

#### 1. 单体架构局限性
**问题描述**: 单体架构扩展性差，团队协作困难
**影响**: 开发效率低，发布风险高
**解决方案**: 微服务架构转型，已制定详细转型计划

#### 2. 技术栈复杂度
**问题描述**: 技术栈要求过高，新员工学习成本大
**影响**: 团队组建困难，培训成本高
**解决方案**:
- 简化技术栈，专注核心能力
- 建立完善的培训体系
- 提供详细的技术文档

### 未来改进计划

#### 短期计划 (1-3个月)
- 修复所有编译错误和安全漏洞
- 优化数据库性能和缓存策略
- 完善监控和日志系统
- 建立自动化测试和部署流程

#### 中期计划 (3-6个月)
- 开始微服务架构拆分
- 实施容器化部署
- 完善DevOps工具链
- 建立性能基准测试

#### 长期计划 (6-12个月)
- 完成微服务架构转型
- 实施云原生部署
- 引入AI和机器学习能力
- 建立完整的技术标准体系

通过持续的技术改进和架构优化，IOE-DREAM将建成一个现代化、高可用、可扩展的智慧园区管理平台，为用户提供卓越的服务体验。