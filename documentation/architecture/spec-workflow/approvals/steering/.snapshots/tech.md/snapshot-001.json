{
  "id": "snapshot_1764168462650_e0bhiqwzk",
  "approvalId": "approval_1764168462454_474070uiu",
  "approvalTitle": "技术架构文档审批",
  "version": 1,
  "timestamp": "2025-11-26T14:47:42.650Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# IOE-DREAM 技术架构文档\r\n\r\n## 项目类型\r\n\r\nIOE-DREAM是一个基于**企业级Web应用架构**的智慧园区综合管理平台，采用**前后端分离**的现代化架构模式，支持多租户SaaS部署和私有化部署两种模式。\r\n\r\n## 核心技术栈\r\n\r\n### 主要编程语言\r\n\r\n- **后端语言**: Java 17 (LTS版本)\r\n- **前端语言**: JavaScript (ES2022) + TypeScript 5.0+\r\n- **数据库语言**: SQL (MySQL 8.0+) + NoSQL (Redis 7.0+)\r\n- **脚本语言**: Shell Script + PowerShell\r\n\r\n### 关键依赖库和框架\r\n\r\n#### 后端核心框架\r\n- **Spring Boot**: 3.1.5 (企业级应用框架)\r\n- **Spring Security**: 6.1 (安全认证和授权)\r\n- **Spring Data JPA**: 3.1 (数据访问层)\r\n- **Spring Cloud**: 2022.0.4 (微服务架构)\r\n- **MyBatis-Plus**: 3.5.3 (ORM增强框架)\r\n- **Sa-Token**: 1.37 (轻量级权限框架)\r\n\r\n#### 前端核心框架\r\n- **Vue.js**: 3.3 (渐进式JavaScript框架)\r\n- **Vite**: 4.4 (构建工具)\r\n- **Pinia**: 2.1 (状态管理)\r\n- **Ant Design Vue**: 4.0 (UI组件库)\r\n- **Vue Router**: 4.2 (路由管理)\r\n- **TypeScript**: 5.0 (类型安全)\r\n\r\n#### 数据存储和缓存\r\n- **MySQL**: 8.0 (主数据库)\r\n- **Redis**: 7.0 (缓存和会话存储)\r\n- **MinIO**: 分布式对象存储\r\n- **Elasticsearch**: 8.8 (搜索引擎和日志分析)\r\n\r\n### 应用架构\r\n\r\n#### 当前架构模式\r\n**单体分层架构** (四层架构模式)\r\n```\r\n前端层 (Vue 3 + TypeScript)\r\n    ↓\r\n控制器层 (Spring MVC Controllers)\r\n    ↓\r\n业务逻辑层 (Spring Services)\r\n    ↓\r\n数据访问层 (MyBatis-Plus Mappers)\r\n    ↓\r\n数据存储层 (MySQL + Redis)\r\n```\r\n\r\n#### 计划架构模式\r\n**微服务架构** (基于Spring Cloud)\r\n```\r\nAPI网关 (Spring Cloud Gateway)\r\n    ↓\r\n微服务集群\r\n├── 用户权限服务 (User Service)\r\n├── 门禁管理服务 (Access Service)\r\n├── 消费管理服务 (Consume Service)\r\n├── 考勤管理服务 (Attendance Service)\r\n├── 访客管理服务 (Visitor Service)\r\n├── 视频监控服务 (Video Service)\r\n├── 设备管理服务 (Device Service)\r\n└── 通知服务 (Notification Service)\r\n    ↓\r\n服务注册发现 (Nacos)\r\n    ↓\r\n配置中心 (Nacos Config)\r\n    ↓\r\n消息中间件 (RabbitMQ/Kafka)\r\n```\r\n\r\n### 外部集成系统\r\n\r\n#### 硬件设备集成\r\n- **门禁设备**: 支持多品牌门禁控制器 (海康威视、大华、中控智慧)\r\n- **消费终端**: POS机、自助消费机、移动支付终端\r\n- **考勤设备**: 考勤机、人脸识别终端、移动定位\r\n- **监控设备**: IP摄像头、NVR系统、智能分析设备\r\n\r\n#### 第三方服务集成\r\n- **支付服务**: 支付宝、微信支付、银联支付\r\n- **短信服务**: 阿里云短信、腾讯云短信\r\n- **推送服务**: 苹果APNS、安卓FCM、WebSocket长连接\r\n- **地图服务**: 高德地图、百度地图、腾讯地图\r\n- **人脸识别**: 商汤、旷视、百度AI\r\n\r\n### 监控和运维技术\r\n\r\n#### 监控系统\r\n- **应用监控**: Prometheus + Grafana\r\n- **日志管理**: ELK Stack (Elasticsearch + Logstash + Kibana)\r\n- **链路追踪**: SkyWalking\r\n- **健康检查**: Spring Boot Actuator\r\n- **告警通知**: AlertManager + 钉钉/企业微信\r\n\r\n#### 运维工具\r\n- **容器化**: Docker + Docker Compose\r\n- **编排管理**: Kubernetes\r\n- **CI/CD**: Jenkins + GitLab CI\r\n- **配置管理**: Ansible\r\n- **自动化测试**: JUnit + Mockito + Selenium\r\n\r\n## 开发环境\r\n\r\n### 构建和开发工具\r\n\r\n#### 后端开发工具\r\n- **构建系统**: Maven 3.9+\r\n- **依赖管理**: Maven Central + 私有仓库\r\n- **开发环境**: IntelliJ IDEA Ultimate 2023+\r\n- **代码热重载**: Spring Boot DevTools\r\n- **数据库工具**: Navicat Premium + Redis Desktop Manager\r\n\r\n#### 前端开发工具\r\n- **包管理器**: npm 9+ + yarn 1.22+\r\n- **构建工具**: Vite 4.4+\r\n- **开发服务器**: Vite Dev Server (端口8081)\r\n- **代码格式化**: Prettier + ESLint\r\n- **代码热重载**: Vite HMR (Hot Module Replacement)\r\n\r\n### 代码质量工具\r\n\r\n#### 静态分析工具\r\n- **后端**: SpotBugs + PMD + SonarQube\r\n- **前端**: ESLint + TypeScript + Vue TSC\r\n- **安全扫描**: OWASP Dependency Check + Snyk\r\n- **代码覆盖率**: JaCoCo + Jest\r\n\r\n#### 代码规范工具\r\n- **格式化**: Google Java Format + Prettier\r\n- **提交检查**: Pre-commit hooks + Husky\r\n- **代码审查**: GitHub Code Review + Sonar Code Review\r\n- **文档生成**: Javadoc + VuePress\r\n\r\n### 版本控制和协作\r\n\r\n#### 版本控制系统\r\n- **VCS**: Git 2.40+\r\n- **托管平台**: GitLab (私有部署)\r\n- **分支策略**: GitFlow\r\n- **代码审查**: GitLab Merge Request\r\n\r\n#### 协作流程\r\n- **项目管理**: Jira + Confluence\r\n- **持续集成**: GitLab CI/CD\r\n- **发布流程**: GitLab CI + Docker Registry\r\n- **文档协作**: GitLab Wiki + Confluence\r\n\r\n## 部署和分发\r\n\r\n### 目标平台\r\n\r\n#### 云平台支持\r\n- **私有云**: OpenStack + VMware vSphere\r\n- **公有云**: 阿里云 + 腾讯云 + 华为云\r\n- **混合云**: 统一管理平台\r\n- **边缘计算**: 支持边缘节点部署\r\n\r\n#### 部署模式\r\n- **SaaS模式**: 多租户架构，按需付费\r\n- **私有化部署**: 单租户架构，一次性许可\r\n- **混合部署**: 核心SaaS + 边缘私有化\r\n\r\n### 分发方式\r\n\r\n#### 软件分发\r\n- **容器镜像**: Docker Hub + 私有Registry\r\n- **包管理**: Helm Charts + Kustomize\r\n- **二进制包**: Windows Installer + Linux DEB/RPM\r\n- **云端部署**: Kubernetes YAML + Terraform\r\n\r\n### 安装要求\r\n\r\n#### 系统要求\r\n- **操作系统**: CentOS 8+, Ubuntu 20.04+, Windows Server 2019+\r\n- **Java版本**: OpenJDK 17+ 或 Oracle JDK 17+\r\n- **数据库**: MySQL 8.0+ 或 MariaDB 10.6+\r\n- **缓存**: Redis 6.0+\r\n- **最小内存**: 8GB RAM\r\n- **最小存储**: 100GB SSD\r\n\r\n### 更新机制\r\n\r\n#### 自动更新\r\n- **热更新**: 支持滚动更新，零停机时间\r\n- **蓝绿部署**: 支持多环境灰度发布\r\n- **版本回滚**: 支持快速回滚到历史版本\r\n- **配置热更新**: 支持运行时配置更新\r\n\r\n## 技术要求和约束\r\n\r\n### 性能要求\r\n\r\n#### 响应时间要求\r\n- **API平均响应时间**: < 500ms (P95)\r\n- **页面加载时间**: < 2秒\r\n- **数据库查询时间**: < 100ms (P95)\r\n- **文件上传速度**: > 10MB/s\r\n\r\n#### 并发能力要求\r\n- **同时在线用户**: 10,000+\r\n- **并发API请求**: 5,000 QPS\r\n- **数据库连接池**: 最大1000连接\r\n- **缓存命中率**: > 90%\r\n\r\n### 兼容性要求\r\n\r\n#### 浏览器支持\r\n- **Chrome**: 90+ (推荐)\r\n- **Firefox**: 88+\r\n- **Safari**: 14+\r\n- **Edge**: 90+\r\n- **移动端**: iOS Safari 14+, Android Chrome 90+\r\n\r\n#### 数据库兼容性\r\n- **MySQL**: 8.0+ (主要支持)\r\n- **MariaDB**: 10.6+ (兼容支持)\r\n- **PostgreSQL**: 13+ (计划支持)\r\n\r\n### 安全和合规要求\r\n\r\n#### 安全要求\r\n- **身份认证**: 多因素认证 (MFA)\r\n- **数据加密**: AES-256 + TLS 1.3\r\n- **访问控制**: RBAC + ABAC权限模型\r\n- **安全审计**: 完整的操作日志和审计追踪\r\n\r\n#### 合规标准\r\n- **数据保护**: 符合GDPR和网络安全法要求\r\n- **等级保护**: 通过等保三级认证\r\n- **密码安全**: 符合国密算法要求\r\n- **隐私保护**: 遵循个人信息保护法\r\n\r\n### 可扩展性和可靠性\r\n\r\n#### 扩展性要求\r\n- **水平扩展**: 支持服务水平扩展\r\n- **数据扩展**: 支持数据库分库分表\r\n- **缓存扩展**: 支持Redis集群\r\n- **存储扩展**: 支持分布式文件存储\r\n\r\n#### 可靠性要求\r\n- **服务可用性**: 99.9% (年停机时间<8.76小时)\r\n- **数据持久性**: 99.999% (年数据丢失概率<0.001%)\r\n- **故障恢复**: RTO < 30分钟, RPO < 5分钟\r\n- **容灾备份**: 支持异地多活\r\n\r\n## 技术决策和理由\r\n\r\n### 决策日志\r\n\r\n#### 1. 选择Spring Boot 3.x作为核心框架\r\n**决策**: 采用Spring Boot 3.1.5作为核心应用框架\r\n**理由**:\r\n- 企业级成熟度，社区活跃，生态完善\r\n- 内置大量生产级特性(监控、健康检查、配置管理)\r\n- 支持响应式编程，性能优秀\r\n- 与现有技术栈兼容性好\r\n**替代方案**: 考虑过Quarkus、Micronaut，但生态成熟度不如Spring Boot\r\n\r\n#### 2. 采用Vue 3 + TypeScript前端技术栈\r\n**决策**: 使用Vue 3 Composition API + TypeScript 5.0\r\n**理由**:\r\n- Vue 3性能优秀，组合式API更易维护\r\n- TypeScript提供类型安全，降低运行时错误\r\n- 与团队技术栈匹配，学习成本低\r\n- 丰富的生态系统和组件库\r\n**替代方案**: 考虑过React，但Vue更符合团队习惯\r\n\r\n#### 3. 选择MySQL + Redis数据存储方案\r\n**决策**: 主数据库使用MySQL 8.0，缓存使用Redis 7.0\r\n**理由**:\r\n- MySQL是企业级关系型数据库，稳定可靠\r\n- Redis高性能缓存，支持丰富数据结构\r\n- 两者都有成熟的运维经验和工具\r\n- 成本可控，开源方案\r\n**替代方案**: 考虑过PostgreSQL，但MySQL更符合团队经验\r\n\r\n#### 4. 实施微服务架构转型计划\r\n**决策**: 从单体架构逐步转向微服务架构\r\n**理由**:\r\n- 当前单体架构已出现性能和扩展性瓶颈\r\n- 业务模块边界清晰，适合微服务拆分\r\n- 支持团队独立开发和部署\r\n- 提高系统可用性和故障隔离能力\r\n**实施策略**: 渐进式拆分，先拆核心业务，后拆支撑服务\r\n\r\n#### 5. 容器化部署和Kubernetes编排\r\n**决策**: 采用Docker容器化和Kubernetes编排\r\n**理由**:\r\n- 标准化部署环境，避免环境差异问题\r\n- 支持自动化部署和扩缩容\r\n- 提供服务发现和负载均衡\r\n- 便于多环境管理和版本控制\r\n**替代方案**: 考虑过Docker Swarm，但Kubernetes生态更成熟\r\n\r\n#### 6. 选择Nacos作为服务治理中心\r\n**决策**: 使用Alibaba Nacos作为服务注册发现和配置中心\r\n**理由**:\r\n- 阿里巴巴开源，生产级稳定性\r\n- 集成服务发现、配置管理、动态DNS\r\n- 与Spring Cloud生态集成良好\r\n- 支持多环境和多租户\r\n**替代方案**: 考虑过Consul、Eureka，但Nacos功能更全面\r\n\r\n## 已知限制和技术债务\r\n\r\n### 当前技术债务\r\n\r\n#### 1. 编译错误问题\r\n**问题描述**: 381个编译错误，主要由于包路径不匹配\r\n**影响**: 阻塞开发，影响代码质量\r\n**解决方案**:\r\n- 短期：自动化脚本批量修复\r\n- 中期：建立代码质量门禁\r\n- 长期：完善IDE配置和开发规范\r\n\r\n#### 2. 安全漏洞问题\r\n**问题描述**: 存在密码明文存储等高风险安全问题\r\n**影响**: 数据安全风险，合规性问题\r\n**解决方案**:\r\n- 立即：修复已知安全漏洞\r\n- 短期：建立安全扫描机制\r\n- 长期：完善安全开发流程\r\n\r\n#### 3. 性能瓶颈问题\r\n**问题描述**: 数据库连接不足，API响应时间过长\r\n**影响**: 用户体验差，系统可扩展性受限\r\n**解决方案**:\r\n- 短期：优化数据库配置和查询\r\n- 中期：实施缓存策略\r\n- 长期：架构优化和微服务拆分\r\n\r\n### 架构限制\r\n\r\n#### 1. 单体架构局限性\r\n**问题描述**: 单体架构扩展性差，团队协作困难\r\n**影响**: 开发效率低，发布风险高\r\n**解决方案**: 微服务架构转型，已制定详细转型计划\r\n\r\n#### 2. 技术栈复杂度\r\n**问题描述**: 技术栈要求过高，新员工学习成本大\r\n**影响**: 团队组建困难，培训成本高\r\n**解决方案**:\r\n- 简化技术栈，专注核心能力\r\n- 建立完善的培训体系\r\n- 提供详细的技术文档\r\n\r\n### 未来改进计划\r\n\r\n#### 短期计划 (1-3个月)\r\n- 修复所有编译错误和安全漏洞\r\n- 优化数据库性能和缓存策略\r\n- 完善监控和日志系统\r\n- 建立自动化测试和部署流程\r\n\r\n#### 中期计划 (3-6个月)\r\n- 开始微服务架构拆分\r\n- 实施容器化部署\r\n- 完善DevOps工具链\r\n- 建立性能基准测试\r\n\r\n#### 长期计划 (6-12个月)\r\n- 完成微服务架构转型\r\n- 实施云原生部署\r\n- 引入AI和机器学习能力\r\n- 建立完整的技术标准体系\r\n\r\n通过持续的技术改进和架构优化，IOE-DREAM将建成一个现代化、高可用、可扩展的智慧园区管理平台，为用户提供卓越的服务体验。",
  "fileStats": {
    "size": 12091,
    "lines": 375,
    "lastModified": "2025-11-26T14:47:38.353Z"
  },
  "comments": []
}