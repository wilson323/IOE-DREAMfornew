# 需求文档：基于消费模块模式的考勤系统完善

**创建日期**: 2025-11-25
**最后更新**: 2025-11-25
**状态**: 待审批
**版本**: 1.0

## 项目概述

### 目标
基于消费模块的成功架构模式，完善考勤系统功能，严格遵循既有的基础架构（SmartDeviceEntity、AreaEntity、PersonBiometricEntity），通过扩展表机制实现考勤特定功能。

### 核心原则
**🎯 基于现有的增强和完善，而不是从零创建**：
- ✅ **复用基础架构**: 严格使用现有的SmartDeviceEntity、AreaEntity、PersonBiometricEntity
- ✅ **复用现有服务**: 充分利用SmartDeviceService、AreaService、PersonBiometricService的成熟功能
- ✅ **扩展表机制**: 通过独立扩展表实现考勤特定功能，避免修改核心表结构
- ✅ **避免重复开发**: 识别并复用项目中现有的优质组件和服务

## 用户故事

### 业务管理员
- **作为一名业务管理员**，我希望能够基于现有的区域管理功能，快速配置考勤区域的具体要求，以便灵活管理不同区域的考勤规则。
- **作为一名业务管理员**，我希望能够复用现有的设备管理体系，将考勤设备无缝集成到现有平台中，避免重复的设备管理工作。
- **作为一名业务管理员**，我希望能够利用现有的生物特征管理功能，为考勤系统提供统一的身份验证体验。

### 系统用户
- **作为一名员工**，我希望能够使用已经注册的生物特征进行考勤打卡，无需重新注册。
- **作为一名员工**，我希望考勤系统能够智能识别我的工作区域，自动应用相应的考勤规则。
- **作为一名员工**，我希望能够通过现有的移动应用进行考勤，获得与其他业务功能一致的用户体验。

### 技术管理员
- **作为一名技术管理员**，我希望考勤系统能够完全复用现有的缓存机制和性能优化方案。
- **作为一名技术管理员**，我希望能够利用现有的监控和日志系统，统一管理考勤系统。
- **作为一名技术管理员**，我希望考勤系统的API能够遵循现有的RESTful规范，便于系统集成。

## 功能需求

### REQ-001: 区域考勤配置扩展
**优先级**: 高
**用户故事**: 作为业务管理员，我希望能够为不同区域配置考勤要求，以便灵活管理各区域的考勤规则。

**验收标准**:
- [ ] 基于现有AreaEntity，通过t_attendance_area_config扩展表实现
- [ ] 支持配置上班打卡要求和下班打卡要求
- [ ] 支持配置GPS验证、拍照验证、电子围栏等验证方式
- [ ] 支持设置工作时间和考勤规则关联
- [ ] 提供区域考勤配置的CRUD API接口

### REQ-002: 设备管理功能扩展
**优先级**: 高
**用户故事**: 作为系统管理员，我希望能够将考勤设备注册到现有平台，利用现有的设备管理基础设施。

**验收标准**:
- [ ] 复用SmartDeviceEntity作为考勤设备的基础实体
- [ ] 通过extensionConfig字段存储考勤特定配置（打卡模式、GPS开关、拍照功能等）
- [ ] 复用SmartDeviceService的设备注册、心跳、配置下发功能
- [ ] 复用PersonBiometricService进行员工生物特征验证
- [ ] 提供考勤设备专用的管理界面和API接口

### REQ-003: 考勤规则引擎
**优先级**: 中
**用户故事**: 作为业务管理员，我希望能够灵活配置考勤规则，自动处理各种考勤异常情况。

**验收标准**:
- [ ] 创建独立的考勤规则配置表t_attendance_rule
- [ ] 支持多种规则类型：迟到、早退、缺勤、加班等
- [ ] 支持规则的条件配置和处理动作配置
- [ ] 支持规则的应用范围配置（全部/部门/区域/员工）
- [ ] 提供规则引擎服务，支持规则的动态加载和执行

### REQ-004: 智能排班功能
**优先级**: 中
**用户故事**: 作为业务管理员，我希望系统能够基于历史数据提供智能排班建议，减少人工排班工作量。

**验收标准**:
- [ ] 分析历史考勤数据，识别排班模式
- [ ] 基于员工工作和休息模式生成排班建议
- [ ] 支持排班冲突检测和解决建议
- [ ] 提供排班方案的导入导出功能
- [ ] 支持排班结果的确认和调整

### REQ-005: 异常申请管理
**优先级**: 中
**用户故事**: 作为员工，我希望能够方便地申请考勤异常处理，提高异常处理效率。

**验收标准**:
- [ ] 复用现有的申请审批工作流程引擎
- [ ] 支持各类考勤异常的申请类型（迟到、早退、缺勤、外勤等）
- [ ] 支持申请流程的在线跟踪和状态查询
- [ ] 支持审批人员的批量审批操作
- [ ] 集成现有的通知系统，提供实时状态通知

### REQ-006: 考勤统计报表
**优先级**: 高
**用户故事**: 作为业务管理员，我希望能够查看多维度的考勤统计报表，支持数据导出和自定义分析。

**验收标准**:
- [ ] 复用现有的图表组件库，避免重复开发
- [ ] 提供多维度统计：个人、部门、公司、时间维度
- [ ] 支持趋势分析、分布分析、对比分析等可视化功能
- [ ] 复用现有的导出功能，支持Excel、PDF、CSV格式
- [ ] 支持报表配置的保存和加载
- [ ] 提供实时数据刷新和预警功能

## 非功能性需求

### NFR-001: 性能要求
- **响应时间**: API响应时间P95≤200ms
- **并发能力**: 支持1000+ QPS并发
- **缓存命中率**: 缓存命中率≥90%
- **数据处理**: 单次查询处理≤10万条记录

### NFR-002: 可用性要求
- **系统可用性**: 99.9%以上
- **故障恢复**: 故障恢复时间≤30分钟
- **数据备份**: 每日自动备份，保留30天
- **容错处理**: 关键服务故障时自动降级

### NFR-003: 安全要求
- **权限控制**: 所有接口使用@SaCheckPermission权限控制
- **数据加密**: 敏感数据加密存储
- **输入验证**: 严格的输入验证和输出脱敏
- **操作审计**: 完整的操作日志记录

### NFR-004: 兼容性要求
- **向后兼容**: 保持现有API接口不变，确保向下兼容
- **技术栈兼容**: 使用现有技术栈（Java 17、Spring Boot 3.x、Vue3）
- **数据库兼容**: 基于现有数据库结构，通过扩展表实现新功能
- **集成兼容**: 与现有系统无缝集成

## 约束条件

### 技术约束
- 必须使用现有的SmartDeviceEntity、AreaEntity、PersonBiometricEntity基础架构
- 必须遵循四层架构规范：Controller → Service → Manager → DAO
- 必须使用@Resource依赖注入，禁止使用@Autowired
- 必须使用jakarta包名，禁止使用javax包名
- 必须遵循现有的缓存管理机制和数据权限控制

### 业务约束
- 不能修改现有的基础实体表结构
- 不能破坏现有的业务逻辑和API接口
- 必须保持与消费模块架构的一致性
- 必须复用现有的通知和审批工作流程

### 资源约束
- 开发团队：4-6人（2后端+1前端+1测试）
- 开发周期：20-30个工作日
- 测试环境：使用现有的开发和测试环境
- 部署环境：使用现有的部署基础设施

## 验收标准

### 功能验收
- [ ] 所有用户故事对应的功能100%实现
- [ ] 所有API接口通过功能测试
- [ ] 所有页面通过用户体验测试
- [ ] 所有业务流程通过端到端测试

### 性能验收
- [ ] 满足所有性能指标要求
- [ ] 通过性能压测和负载测试
- [ ] 内存和CPU使用率在合理范围内
- [ ] 数据库查询优化达到预期效果

### 安全验收
- [ ] 通过安全漏洞扫描
- [ ] 所有敏感操作都有权限控制
- [ ] 数据加密和脱敏机制正常工作
- [ ] 操作日志完整记录和审计

### 代码质量验收
- [ ] 代码覆盖率≥80%
- [ ] 100%遵循架构规范
- [ ] 通过代码质量检查
- [ ] 无严重技术债务

## 项目里程碑

### 里程碑1: 基础扩展完成 (Week 1-2)
- [ ] 所有扩展表创建完成
- [ ] 基础服务层开发完成
- [ ] 核心功能验证通过

### 里程碑2: 业务逻辑重构完成 (Week 3-4)
- [ ] 考勤服务重构完成
- [ ] 规则引擎开发完成
- [ ] 智能排班引擎开发完成

### 里程碑3: 前端功能完成 (Week 5-6)
- [ ] 所有管理页面开发完成
- [ ] 用户界面优化完成
- [ ] 移动端适配完成

### 4: 系统集成完成 (Week 7)
- [ ] 系统集成测试通过
- [ ] 性能压测通过
- [ ] 用户验收测试通过

## 风险评估

### 技术风险
- **架构适配风险**: 通过严格遵循现有架构降低风险
- **性能影响风险**: 通过多级缓存架构保证性能
- **集成复杂度风险**: 通过复用现有集成模式降低复杂度

### 业务风险
- **需求变更风险**: 通过分阶段交付降低变更影响
- **用户接受度风险**: 通过基于现有功能增强提高接受度
- **培训成本风险**: 通过复用现有用户体验降低培训成本

### 时间风险
- **开发进度风险**: 通过基于现有组件减少开发时间
- **测试时间风险**: 通过复用现有测试环境减少测试时间
- **部署时间风险**: 通过复用现有部署流程减少部署时间

---

**批准要求**: 请在审阅此需求文档后，通过OpenSpec审批系统进行正式审批，然后进入设计阶段。