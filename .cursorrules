# IOE-DREAM é¡¹ç›® Cursor Rules
# ç‰ˆæœ¬: v1.1.0
# æ›´æ–°æ—¥æœŸ: 2025-12-10
# é€‚ç”¨èŒƒå›´: IOE-DREAMæ™ºèƒ½ç®¡ç†ç³»ç»Ÿå…¨éƒ¨ä»£ç 
# é‡è¦æ›´æ–°: æ–°å¢PowerShellè„šæœ¬å¼€å‘è§„èŒƒï¼ˆåŸºäºå¼‚å¸¸æ ¹æœ¬åŸå› åˆ†æï¼‰

## ğŸ¯ æ ¸å¿ƒæ¶æ„åŸåˆ™

### 1. ä¸ƒå¾®æœåŠ¡æ¶æ„ (å¼ºåˆ¶)
```
ä¿ç•™çš„7ä¸ªæ ¸å¿ƒå¾®æœåŠ¡:
- ioedream-gateway-service (8080) - APIç½‘å…³
- ioedream-common-service (8088) - å…¬å…±ä¸šåŠ¡æœåŠ¡
- ioedream-device-comm-service (8087) - è®¾å¤‡é€šè®¯æœåŠ¡
- ioedream-access-service (8090) - é—¨ç¦æœåŠ¡
- ioedream-attendance-service (8091) - è€ƒå‹¤æœåŠ¡
- ioedream-consume-service (8094) - æ¶ˆè´¹æœåŠ¡
- ioedream-visitor-service (8095) - è®¿å®¢æœåŠ¡
- ioedream-video-service (8092) - è§†é¢‘æœåŠ¡

å…¬å…±åº“(èšåˆ):
- microservices-common - å…¬å…±åº“èšåˆçˆ¶æ¨¡å—ï¼Œè¢«æ‰€æœ‰å¾®æœåŠ¡ä¾èµ–  
  ç›®æ ‡æ‹†åˆ†: common-core / common-spring(common-web) / common-starter-* / *-domain-api
```

### 2. å››å±‚æ¶æ„ (å¼ºåˆ¶)
```
Controller â†’ Service â†’ Manager â†’ DAO

- Controller: æ¥æ”¶è¯·æ±‚ã€å‚æ•°éªŒè¯ã€è¿”å›å“åº”
- Service: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†
- Manager: å¤æ‚æµç¨‹ç¼–æ’ã€ç¼“å­˜ç®¡ç†ã€ç¬¬ä¸‰æ–¹é›†æˆ
- DAO: æ•°æ®åº“è®¿é—®ã€ç»§æ‰¿BaseMapper
```

### 3. ç¦æ­¢äº‹é¡¹
```
âŒ ç¦æ­¢è·¨å±‚è®¿é—® (Controllerç›´æ¥è°ƒç”¨DAO)
âŒ ç¦æ­¢ä½¿ç”¨ @Autowired (ç»Ÿä¸€ä½¿ç”¨ @Resource)
âŒ ç¦æ­¢ä½¿ç”¨ @Repository (ç»Ÿä¸€ä½¿ç”¨ @Mapper)
âŒ ç¦æ­¢ä½¿ç”¨ Repository åç¼€ (ç»Ÿä¸€ä½¿ç”¨ Dao)
âŒ ç¦æ­¢ä½¿ç”¨ javax.* åŒ… (ç»Ÿä¸€ä½¿ç”¨ jakarta.*)
âŒ ç¦æ­¢ä½¿ç”¨ HikariCP (ç»Ÿä¸€ä½¿ç”¨ Druid)
âŒ ç¦æ­¢æœªç»ç™½åå•çš„æœåŠ¡ç›´è¿ï¼ˆé»˜è®¤é€šè¿‡ GatewayServiceClientï¼›åŒåŸŸé«˜é¢‘çƒ­è·¯å¾„ä»…å¯é€šè¿‡ç»Ÿä¸€ç›´è¿ Client ç›´è¿ï¼‰
âŒ ç¦æ­¢ç›´æ¥è®¿é—®å…¶ä»–æœåŠ¡æ•°æ®åº“
âŒ ç¦æ­¢åœ¨Controllerä¸­å¤„ç†äº‹åŠ¡
âŒ ç¦æ­¢åœ¨DAOä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘
```

## ğŸ“ ä»£ç è§„èŒƒ

### Javaç¼–ç è§„èŒƒ

#### ç±»å‘½å
```java
// Entity: XxxEntity
public class UserEntity extends BaseEntity { }

// DAO: XxxDao + @Mapper
@Mapper
public interface UserDao extends BaseMapper<UserEntity> { }

// Serviceæ¥å£: XxxService
public interface UserService { }

// Serviceå®ç°: XxxServiceImpl
@Service
public class UserServiceImpl implements UserService { }

// Manager: XxxManager (åœ¨microservices-commonä¸­ä¸ä½¿ç”¨Springæ³¨è§£)
// æ³¨æ„ï¼šManagerç±»åœ¨microservices-commonä¸­æ˜¯çº¯Javaç±»ï¼Œä¸ä½¿ç”¨@Component
// Managerå®ä¾‹åœ¨å¾®æœåŠ¡ä¸­é€šè¿‡Serviceå±‚æ‰‹åŠ¨åˆ›å»ºæˆ–é€šè¿‡é…ç½®ç±»æ³¨å†Œä¸ºSpring Bean
public class UserManager {
    // é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    private final UserDao userDao;

    public UserManager(UserDao userDao) {
        this.userDao = userDao;
    }
}

// Controller: XxxController
@RestController
public class UserController { }

// Form: XxxAddForm, XxxUpdateForm, XxxQueryForm
public class UserAddForm { }

// VO: XxxVO, XxxDetailVO
public class UserVO { }
```

#### ä¾èµ–æ³¨å…¥
```java
// âœ… æ­£ç¡®
@Resource
private UserDao userDao;

// âŒ é”™è¯¯
@Autowired
private UserDao userDao;
```

#### äº‹åŠ¡ç®¡ç†
```java
// Serviceå±‚å†™æ“ä½œ
@Service
@Transactional(rollbackFor = Exception.class)
public class UserServiceImpl implements UserService { }

// DAOå±‚æŸ¥è¯¢
@Transactional(readOnly = true)
List<UserEntity> selectByCondition(Wrapper<UserEntity> wrapper);
```

#### åŒ…å¼•ç”¨
```java
// âœ… æ­£ç¡® - Jakarta EE 3.0+
import jakarta.annotation.Resource;
import jakarta.validation.Valid;

// âŒ é”™è¯¯ - æ—§ç‰ˆjavax
import javax.annotation.Resource;
import javax.validation.Valid;
```

### APIè®¾è®¡è§„èŒƒ

#### RESTfulè®¾è®¡
```java
// âœ… æ­£ç¡®
@GetMapping("/api/v1/users/{id}")      // æŸ¥è¯¢
@PostMapping("/api/v1/users")          // åˆ›å»º
@PutMapping("/api/v1/users/{id}")      // æ›´æ–°
@DeleteMapping("/api/v1/users/{id}")   // åˆ é™¤

// âŒ é”™è¯¯
@PostMapping("/getUserInfo")           // æŸ¥è¯¢ä¸åº”ç”¨POST
@PostMapping("/updateUser")            // ç¼ºå°‘è·¯å¾„å‚æ•°
```

#### å“åº”æ ¼å¼
```java
// ç»Ÿä¸€ä½¿ç”¨ ResponseDTO
@GetMapping("/{id}")
public ResponseDTO<UserVO> getById(@PathVariable Long id) {
    return ResponseDTO.ok(userService.getById(id));
}

// åˆ†é¡µä½¿ç”¨ PageResult
@GetMapping("/page")
public ResponseDTO<PageResult<UserVO>> page(@Valid UserQueryForm form) {
    return ResponseDTO.ok(userService.queryPage(form));
}
```

### æ•°æ®åº“è§„èŒƒ

#### è¡¨å‘½å
```sql
-- å…¬å…±è¡¨: t_common_
t_common_user, t_common_department

-- ä¸šåŠ¡è¡¨: t_{module}_
t_access_record, t_attendance_record, t_consume_record
```

#### å¿…éœ€å­—æ®µ
```sql
id              BIGINT PRIMARY KEY AUTO_INCREMENT,
create_time     DATETIME NOT NULL,
update_time     DATETIME NOT NULL,
deleted_flag    TINYINT DEFAULT 0,
version         INT DEFAULT 0
```

#### ç´¢å¼•å‘½å
```sql
-- ä¸»é”®: pk_{è¡¨å}
-- å”¯ä¸€ç´¢å¼•: uk_{è¡¨å}_{å­—æ®µ}
-- æ™®é€šç´¢å¼•: idx_{è¡¨å}_{å­—æ®µ}
```

### MyBatis-Plusè§„èŒƒ

#### LambdaQueryWrapperä½¿ç”¨
```java
// âœ… æ­£ç¡® - ä½¿ç”¨Lambdaè¡¨è¾¾å¼
LambdaQueryWrapper<UserEntity> wrapper = new LambdaQueryWrapper<>();
wrapper.eq(UserEntity::getStatus, 1)
       .orderByDesc(UserEntity::getCreateTime);

// âŒ é”™è¯¯ - ä½¿ç”¨å­—ç¬¦ä¸²
QueryWrapper<UserEntity> wrapper = new QueryWrapper<>();
wrapper.eq("status", 1)
       .orderByDesc("create_time");
```

#### åˆ†é¡µæŸ¥è¯¢
```java
// âœ… æ­£ç¡® - ä½¿ç”¨PageHelperæˆ–MyBatis-Plusåˆ†é¡µ
Page<UserEntity> page = new Page<>(pageNum, pageSize);
IPage<UserEntity> result = userDao.selectPage(page, wrapper);

// âŒ é”™è¯¯ - æ·±åº¦åˆ†é¡µ
SELECT * FROM user LIMIT 100000, 20;
```

## ğŸ”’ å®‰å…¨è§„èŒƒ

### å‚æ•°éªŒè¯
```java
// Controllerå±‚ä½¿ç”¨@Valid
@PostMapping
public ResponseDTO<Long> add(@Valid @RequestBody UserAddForm form) { }

// Formç±»ä½¿ç”¨éªŒè¯æ³¨è§£
public class UserAddForm {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(max = 50, message = "ç”¨æˆ·åæœ€é•¿50å­—ç¬¦")
    private String username;
}
```

### æ•°æ®è„±æ•
```java
// æ•æ„Ÿå­—æ®µè„±æ•è¾“å‡º
@JsonSerialize(using = PhoneMaskSerializer.class)
private String phone;

@JsonSerialize(using = IdCardMaskSerializer.class)
private String idCard;
```

### SQLæ³¨å…¥é˜²æŠ¤
```java
// âœ… æ­£ç¡® - å‚æ•°åŒ–æŸ¥è¯¢
@Select("SELECT * FROM user WHERE username = #{username}")
UserEntity selectByUsername(@Param("username") String username);

// âŒ é”™è¯¯ - å­—ç¬¦ä¸²æ‹¼æ¥
@Select("SELECT * FROM user WHERE username = '" + username + "'")
```

## ğŸ“Š æ—¥å¿—è§„èŒƒ

### æ—¥å¿—æ ¼å¼
```java
@Slf4j
public class UserServiceImpl {

    public void createUser(UserAddForm form) {
        // âœ… æ­£ç¡® - ä½¿ç”¨å ä½ç¬¦
        log.info("[ç”¨æˆ·åˆ›å»º] å¼€å§‹åˆ›å»ºç”¨æˆ·, username={}", form.getUsername());

        // âŒ é”™è¯¯ - å­—ç¬¦ä¸²æ‹¼æ¥
        log.info("åˆ›å»ºç”¨æˆ·: " + form.getUsername());
    }
}
```

### æ—¥å¿—çº§åˆ«
```
ERROR: ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸æ•è·
WARN:  è­¦å‘Šä¿¡æ¯ã€æ½œåœ¨é—®é¢˜
INFO:  ä¸šåŠ¡å…³é”®èŠ‚ç‚¹
DEBUG: è°ƒè¯•ä¿¡æ¯
```

## âœ… ä»£ç è´¨é‡æ ‡å‡†

### è´¨é‡æŒ‡æ ‡
```
- ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- é‡å¤ä»£ç ç‡ â‰¤ 3%
- åœˆå¤æ‚åº¦ â‰¤ 10
- æ–¹æ³•è¡Œæ•° â‰¤ 50
- ç±»è¡Œæ•° â‰¤ 500
```

### æäº¤å‰æ£€æŸ¥
```
[ ] éµå¾ªå››å±‚æ¶æ„
[ ] ä½¿ç”¨@Resourceæ³¨å…¥
[ ] ä½¿ç”¨@Mapper + Daoå‘½å
[ ] ä½¿ç”¨jakarta.*åŒ…
[ ] æ— ç¡¬ç¼–ç é…ç½®
[ ] æœ‰å®Œæ•´æ—¥å¿—è®°å½•
[ ] æœ‰å‚æ•°éªŒè¯
[ ] æ— SQLæ³¨å…¥é£é™©
[ ] ç¼–è¯‘0é”™è¯¯0è­¦å‘Š
```

## ğŸš€ å¾®æœåŠ¡è°ƒç”¨è§„èŒƒï¼ˆæ··åˆæ¨¡å¼ï¼‰

- å—åŒ—å‘ï¼ˆå¤–éƒ¨/å‰ç«¯â†’æœåŠ¡ï¼‰ï¼šå¿…é¡»ç»ç½‘å…³ç»Ÿä¸€æ²»ç†  
- ä¸œè¥¿å‘ä½é¢‘æˆ–è·¨åŸŸåŒæ­¥è°ƒç”¨ï¼šç»ç½‘å…³ï¼ˆ`GatewayServiceClient`ï¼‰  
- ä¸œè¥¿å‘åŒåŸŸé«˜é¢‘çƒ­è·¯å¾„ï¼šç™½åå•ç›´è¿ï¼ˆç»Ÿä¸€ç›´è¿ Client + S2S é‰´æƒ + Resilience4j + Tracing/Metricsï¼‰

### é»˜è®¤ç»ç½‘å…³è°ƒç”¨
```java
// âœ… æ­£ç¡® - ä½¿ç”¨GatewayServiceClient
@Resource
private GatewayServiceClient gatewayServiceClient;

public UserVO getUser(Long userId) {
    return gatewayServiceClient.callCommonService(
        "/api/v1/users/" + userId,
        HttpMethod.GET,
        null,
        UserVO.class
    );
}

// âŒ é”™è¯¯ - éç™½åå•ç›´è¿ï¼ˆç›´æ¥ä½¿ç”¨FeignClientï¼‰
@FeignClient(name = "ioedream-common-service")
public interface UserClient { }
```

## ğŸ“ æ–‡ä»¶ç»„ç»‡è§„èŒƒ

### microservices-common (å…¬å…±åº“èšåˆ)
```
ç›®æ ‡æ‹†åˆ†: common-core / common-spring(common-web) / common-starter-* / *-domain-api
å…è®¸: Entity, DAO, Manager, Form, VO, Config, Constant, Enum, Exception, Util
ç¦æ­¢: @Serviceå®ç°, @RestController, spring-boot-starter-webï¼ˆcommon-starter-*é™¤å¤–ï¼‰
```

### ioedream-common-service (å¾®æœåŠ¡)
```
å…è®¸: Controller, Serviceæ¥å£, ServiceImpl, æœåŠ¡é…ç½®
ä¾èµ–: microservices-common
```

### ä¸šåŠ¡å¾®æœåŠ¡
```
å…è®¸: ä¸šåŠ¡ç‰¹å®šçš„Controller, Service, Manager, Entity
ä¾èµ–: microservices-common
è°ƒç”¨: é»˜è®¤é€šè¿‡GatewayServiceClientï¼›çƒ­è·¯å¾„ç™½åå•å¯ç›´è¿ï¼ˆç»Ÿä¸€ç›´è¿ Clientï¼‰
```

## ğŸ”§ IDEé…ç½®å»ºè®®

### ä»£ç æ ¼å¼åŒ–
```
- ä½¿ç”¨UTF-8ç¼–ç  (æ— BOM)
- ç¼©è¿›: 4ç©ºæ ¼
- è¡Œå®½: 120å­—ç¬¦
- å¯¼å…¥æ’åº: java, jakarta, org, com, net
```

### è‡ªåŠ¨æ£€æŸ¥
```
- ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
- æäº¤å‰è¿è¡Œlintæ£€æŸ¥
- ç¼–è¯‘æ—¶æ£€æŸ¥æœªä½¿ç”¨çš„å¯¼å…¥
```

## ğŸ”§ PowerShellè„šæœ¬å¼€å‘è§„èŒƒ (2025-12-10æ–°å¢)

### æ ¹æœ¬åŸå› åˆ†æ

**PowerShellè„šæœ¬å¼‚å¸¸çš„æ ¹æœ¬åŸå› **ï¼š
1. **å­—ç¬¦ä¸²è½¬ä¹‰é—®é¢˜**ï¼šå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ç±»è½¬ä¹‰å¯¼è‡´è§£æå™¨æ··æ·†
2. **è§£æå™¨è¾¹ç•Œè¯†åˆ«**ï¼šPowerShellè§£æå™¨åœ¨é‡åˆ°å¤æ‚æ­£åˆ™è¡¨è¾¾å¼æ—¶å¯èƒ½è¯¯åˆ¤å­—ç¬¦ä¸²è¾¹ç•Œ
3. **ç¼–ç å…¼å®¹æ€§**ï¼šæ–‡ä»¶ç¼–ç ï¼ˆUTF-8 BOM vs UTF-8 without BOMï¼‰å¯èƒ½å¯¼è‡´è§£æå·®å¼‚

### æ–‡ä»¶ç¼–ç è§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

```
âœ… æ–‡ä»¶ç¼–ç : UTF-8 without BOM
âœ… è¡Œç»“æŸç¬¦: CRLF (Windowsæ ‡å‡†)
âœ… ç¼©è¿›: 4ä¸ªç©ºæ ¼
âŒ ç¦æ­¢: UTF-8 with BOM
âŒ ç¦æ­¢: LFè¡Œç»“æŸç¬¦ï¼ˆé™¤éæ˜ç¡®éœ€è¦è·¨å¹³å°ï¼‰
```

### PowerShellæ­£åˆ™è¡¨è¾¾å¼è§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

#### è§„åˆ™1: ç®€å•æ¨¡å¼ä½¿ç”¨ `-match` æ“ä½œç¬¦

```powershell
# âœ… æ­£ç¡® - ç®€å•æ¨¡å¼
if ($content -match "ioedream") {
    # åŒ¹é…æˆåŠŸ
}

# âœ… æ­£ç¡® - ç®€å•æ­£åˆ™è¡¨è¾¾å¼
if ($content -match "common-database\.yaml") {
    # åŒ¹é…æˆåŠŸ
}
```

#### è§„åˆ™2: å¤æ‚æ¨¡å¼ä½¿ç”¨ `[regex]::new()` æ„é€ å‡½æ•°

```powershell
# âœ… æ­£ç¡® - å¤æ‚æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ [regex]::new()
$jdbcRegex = [regex]::new("jdbc:mysql://[^/]+/([^?]+)")
$match = $jdbcRegex.Match($content)
if ($match.Success) {
    $dbName = $match.Groups[1].Value
}

# âœ… æ­£ç¡® - ç¯å¢ƒå˜é‡åŒ¹é…
$envVarRegex = [regex]::new("\$\{.*ioedream\}")
if ($envVarRegex.IsMatch($dbName)) {
    # åŒ¹é…æˆåŠŸ
}

# âŒ é”™è¯¯ - å•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å¤æ‚è½¬ä¹‰
if ($content -match 'jdbc:mysql://[^/]+/([^?''"]+)') {
    # å¯èƒ½å¯¼è‡´è§£æé”™è¯¯
}
```

#### è§„åˆ™3: å­—ç¬¦ä¸²é€‰æ‹©åŸåˆ™

```powershell
# âœ… æ¨è - åŒå¼•å·å­—ç¬¦ä¸²ï¼ˆæ”¯æŒå˜é‡æ’å€¼ï¼‰
$message = "Database: $dbName"
$pattern = [regex]::new("jdbc:mysql://[^/]+/([^?]+)")

# âœ… å…è®¸ - å•å¼•å·å­—ç¬¦ä¸²ç”¨äºçº¯æ–‡æœ¬
$text = 'This is a simple text'

# âŒ ç¦æ­¢ - å•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å¤æ‚æ­£åˆ™è¡¨è¾¾å¼è½¬ä¹‰
$pattern = '\$\{.*ioedream\}'
```

#### è§„åˆ™4: è½¬ä¹‰å­—ç¬¦ä½¿ç”¨

```powershell
# âœ… æ­£ç¡® - åŒå¼•å·å­—ç¬¦ä¸²ä¸­ä½¿ç”¨åå¼•å·è½¬ä¹‰
$path = "C:\Program Files\App"
$message = "He said, `"Hello`""

# âœ… æ­£ç¡® - æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨åæ–œæ è½¬ä¹‰
$regex = [regex]::new("\$\{.*\}")
$regex = [regex]::new("file\.txt")

# âŒ é”™è¯¯ - å•å¼•å·å­—ç¬¦ä¸²ä¸­åæ–œæ æ˜¯å­—é¢é‡
$pattern = '\d+'  # è¿™é‡Œçš„ \d ä¸ä¼šè¢«è½¬ä¹‰
```

### PowerShellè„šæœ¬ç»“æ„è§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

#### è„šæœ¬å¤´éƒ¨æ¨¡æ¿

```powershell
# =====================================================
# è„šæœ¬åç§°
# ç‰ˆæœ¬: v1.0.0
# æè¿°: è„šæœ¬åŠŸèƒ½æè¿°
# åˆ›å»ºæ—¶é—´: YYYY-MM-DD
# =====================================================

param(
    [Parameter(Mandatory=$false)]
    [string]$Param1 = "default",

    [Parameter(Mandatory=$false)]
    [switch]$Flag
)

$ErrorActionPreference = "Stop"
```

#### é”™è¯¯å¤„ç†è§„èŒƒ

```powershell
# âœ… æ­£ç¡® - ä½¿ç”¨ try-catch å¤„ç†å¼‚å¸¸
try {
    $result = Execute-Operation
    Write-Host "Success: $result" -ForegroundColor Green
} catch {
    Write-Host "Error: $($_.Exception.Message)" -ForegroundColor Red
    exit 1
}

# âœ… æ­£ç¡® - è®¾ç½®é”™è¯¯å¤„ç†åå¥½
$ErrorActionPreference = "Stop"
```

#### æ—¥å¿—è¾“å‡ºè§„èŒƒ

```powershell
# âœ… æ­£ç¡® - ä½¿ç”¨é¢œè‰²è¾“å‡ºå‡½æ•°
function Write-ColorOutput($ForegroundColor) {
    $fc = $host.UI.RawUI.ForegroundColor
    $host.UI.RawUI.ForegroundColor = $ForegroundColor
    if ($args) {
        Write-Output $args
    }
    $host.UI.RawUI.ForegroundColor = $fc
}

# âœ… æ­£ç¡® - ä½¿ç”¨æ ‡è®°è€ŒéUnicodeå­—ç¬¦
Write-Host "[OK] Operation successful" -ForegroundColor Green
Write-Host "[WARN] Warning message" -ForegroundColor Yellow
Write-Host "[ERROR] Error message" -ForegroundColor Red

# âŒ ç¦æ­¢ - Unicodeå­—ç¬¦å¯èƒ½å¯¼è‡´ç¼–ç é—®é¢˜
Write-Host "âœ… Operation successful"  # å¯èƒ½å¯¼è‡´è§£æé”™è¯¯
```

### é¡¹ç›®ç‰¹å®šPowerShellè„šæœ¬è§„èŒƒ

#### æ•°æ®åº“è„šæœ¬è§„èŒƒ

```powershell
# âœ… æ­£ç¡® - æ•°æ®åº“è„šæœ¬ç›®å½•ç»“æ„
scripts/database/
â”œâ”€â”€ validate-*.ps1          # éªŒè¯è„šæœ¬
â”œâ”€â”€ version-manager.ps1     # ç‰ˆæœ¬ç®¡ç†è„šæœ¬
â””â”€â”€ versions/               # ç‰ˆæœ¬è„šæœ¬ç›®å½•
    â””â”€â”€ version-*.ps1       # ç‰ˆæœ¬å¤„ç†è„šæœ¬

# âœ… æ­£ç¡® - ç‰ˆæœ¬è„šæœ¬æ¨¡æ¿
function Invoke-VersionVXXX {
    $scriptPath = "deployment\mysql\init\XX-version-*.sql"
    if (-not (Test-Path $scriptPath)) {
        Write-Host "[ERROR] Script not found: $scriptPath" -ForegroundColor Red
        return $false
    }

    # ä½¿ç”¨ [regex]::new() è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥
    $checkRegex = [regex]::new("V\d+\.\d+\.\d+")
    # ... æ‰§è¡Œé€»è¾‘
}
```

#### éªŒè¯è„šæœ¬è§„èŒƒ

```powershell
# âœ… æ­£ç¡® - éªŒè¯è„šæœ¬ç»“æ„
param(
    [Parameter(Mandatory=$false)]
    [switch]$GenerateReport
)

$ErrorActionPreference = "Stop"

# ä½¿ç”¨ [regex]::new() è¿›è¡Œæ¨¡å¼åŒ¹é…
$jdbcRegex = [regex]::new("jdbc:mysql://[^/]+/([^?]+)")
$match = $jdbcRegex.Match($content)
if ($match.Success) {
    # å¤„ç†åŒ¹é…ç»“æœ
}
```

### PowerShellè„šæœ¬ç¦æ­¢äº‹é¡¹ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

```
âŒ ç¦æ­¢åœ¨å•å¼•å·å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼è½¬ä¹‰
âŒ ç¦æ­¢ä½¿ç”¨Unicodeå­—ç¬¦ï¼ˆâœ…ã€âš ï¸ã€âŒç­‰ï¼‰åœ¨è„šæœ¬ä¸­
âŒ ç¦æ­¢ä½¿ç”¨UTF-8 with BOMç¼–ç 
âŒ ç¦æ­¢åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨æœªè½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦
âŒ ç¦æ­¢ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ„å»ºæ­£åˆ™è¡¨è¾¾å¼
âŒ ç¦æ­¢ç¼ºå°‘é”™è¯¯å¤„ç†çš„è„šæœ¬
âŒ ç¦æ­¢ç¼ºå°‘å‚æ•°éªŒè¯çš„è„šæœ¬
```

### PowerShellè„šæœ¬æ£€æŸ¥æ¸…å•

```
[ ] æ–‡ä»¶ç¼–ç ä¸º UTF-8 without BOM
[ ] ä½¿ç”¨ [regex]::new() å¤„ç†å¤æ‚æ­£åˆ™è¡¨è¾¾å¼
[ ] ç®€å•æ¨¡å¼ä½¿ç”¨ -match æ“ä½œç¬¦
[ ] ä½¿ç”¨åŒå¼•å·å­—ç¬¦ä¸²é…åˆ [regex]::new()
[ ] é¿å…å•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å¤æ‚è½¬ä¹‰
[ ] ä½¿ç”¨ try-catch å¤„ç†å¼‚å¸¸
[ ] è®¾ç½® $ErrorActionPreference = "Stop"
[ ] ä½¿ç”¨ [OK]/[WARN]/[ERROR] æ ‡è®°è€ŒéUnicodeå­—ç¬¦
[ ] æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
[ ] è„šæœ¬å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼ˆä¸ä¾èµ–å¤–éƒ¨çŠ¶æ€ï¼‰
```

### PowerShellè„šæœ¬æœ€ä½³å®è·µç¤ºä¾‹

```powershell
# =====================================================
# ç¤ºä¾‹ï¼šæ­£ç¡®çš„PowerShellè„šæœ¬
# =====================================================

param(
    [Parameter(Mandatory=$false)]
    [string]$Database = "ioedream"
)

$ErrorActionPreference = "Stop"

# âœ… ä½¿ç”¨ [regex]::new() åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
$jdbcPattern = [regex]::new("jdbc:mysql://[^/]+/([^?]+)")
$envVarPattern = [regex]::new("\$\{.*ioedream\}")

function Test-DatabaseConfig {
    param([string]$ConfigPath)

    if (-not (Test-Path $ConfigPath)) {
        Write-Host "[ERROR] Config file not found: $ConfigPath" -ForegroundColor Red
        return $false
    }

    try {
        $content = Get-Content $ConfigPath -Raw -ErrorAction Stop

        # âœ… ä½¿ç”¨é¢„ç¼–è¯‘çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡
        $match = $jdbcPattern.Match($content)
        if ($match.Success) {
            $dbName = $match.Groups[1].Value
            if ($dbName -eq $Database -or $envVarPattern.IsMatch($dbName)) {
                Write-Host "[OK] Database config correct" -ForegroundColor Green
                return $true
            }
        }

        return $false
    } catch {
        Write-Host "[ERROR] Failed to read config: $($_.Exception.Message)" -ForegroundColor Red
        return $false
    }
}
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- CLAUDE.md - é¡¹ç›®æ ¸å¿ƒæ¶æ„è§„èŒƒ
- documentation/architecture/OPTIMAL_ARCHITECTURE_DESIGN.md - æœ€ä¼˜æ¶æ„è®¾è®¡
- documentation/architecture/ARCHITECTURE_REFACTORING_PLAN.md - é‡æ„è®¡åˆ’
- documentation/technical/POWERSHELL_SCRIPT_FIX_REPORT.md - PowerShellè„šæœ¬ä¿®å¤æŠ¥å‘Š
- documentation/technical/POWERSHELL_REGEX_FIX_SUMMARY.md - PowerShellæ­£åˆ™è¡¨è¾¾å¼ä¿®å¤æ€»ç»“

