# IOE-DREAM é¡¹ç›® Cursor Rules
# ç‰ˆæœ¬: v1.0.0
# æ›´æ–°æ—¥æœŸ: 2025-12-02
# é€‚ç”¨èŒƒå›´: IOE-DREAMæ™ºèƒ½ç®¡ç†ç³»ç»Ÿå…¨éƒ¨ä»£ç 

## ğŸ¯ æ ¸å¿ƒæ¶æ„åŸåˆ™

### 1. ä¸ƒå¾®æœåŠ¡æ¶æ„ (å¼ºåˆ¶)
```
ä¿ç•™çš„7ä¸ªæ ¸å¿ƒå¾®æœåŠ¡:
- ioedream-gateway-service (8080) - APIç½‘å…³
- ioedream-common-service (8088) - å…¬å…±ä¸šåŠ¡æœåŠ¡
- ioedream-device-comm-service (8087) - è®¾å¤‡é€šè®¯æœåŠ¡
- ioedream-access-service (8090) - é—¨ç¦æœåŠ¡
- ioedream-attendance-service (8091) - è€ƒå‹¤æœåŠ¡
- ioedream-consume-service (8094) - æ¶ˆè´¹æœåŠ¡
- ioedream-visitor-service (8095) - è®¿å®¢æœåŠ¡
- ioedream-video-service (8092) - è§†é¢‘æœåŠ¡

å…¬å…±JARåº“:
- microservices-common - è¢«æ‰€æœ‰å¾®æœåŠ¡ä¾èµ–
```

### 2. å››å±‚æ¶æ„ (å¼ºåˆ¶)
```
Controller â†’ Service â†’ Manager â†’ DAO

- Controller: æ¥æ”¶è¯·æ±‚ã€å‚æ•°éªŒè¯ã€è¿”å›å“åº”
- Service: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†
- Manager: å¤æ‚æµç¨‹ç¼–æ’ã€ç¼“å­˜ç®¡ç†ã€ç¬¬ä¸‰æ–¹é›†æˆ
- DAO: æ•°æ®åº“è®¿é—®ã€ç»§æ‰¿BaseMapper
```

### 3. ç¦æ­¢äº‹é¡¹
```
âŒ ç¦æ­¢è·¨å±‚è®¿é—® (Controllerç›´æ¥è°ƒç”¨DAO)
âŒ ç¦æ­¢ä½¿ç”¨ @Autowired (ç»Ÿä¸€ä½¿ç”¨ @Resource)
âŒ ç¦æ­¢ä½¿ç”¨ @Repository (ç»Ÿä¸€ä½¿ç”¨ @Mapper)
âŒ ç¦æ­¢ä½¿ç”¨ Repository åç¼€ (ç»Ÿä¸€ä½¿ç”¨ Dao)
âŒ ç¦æ­¢ä½¿ç”¨ javax.* åŒ… (ç»Ÿä¸€ä½¿ç”¨ jakarta.*)
âŒ ç¦æ­¢ä½¿ç”¨ HikariCP (ç»Ÿä¸€ä½¿ç”¨ Druid)
âŒ ç¦æ­¢ä½¿ç”¨ FeignClient ç›´è¿ (ç»Ÿä¸€é€šè¿‡ GatewayServiceClient)
âŒ ç¦æ­¢ç›´æ¥è®¿é—®å…¶ä»–æœåŠ¡æ•°æ®åº“
âŒ ç¦æ­¢åœ¨Controllerä¸­å¤„ç†äº‹åŠ¡
âŒ ç¦æ­¢åœ¨DAOä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘
```

## ğŸ“ ä»£ç è§„èŒƒ

### Javaç¼–ç è§„èŒƒ

#### ç±»å‘½å
```java
// Entity: XxxEntity
public class UserEntity extends BaseEntity { }

// DAO: XxxDao + @Mapper
@Mapper
public interface UserDao extends BaseMapper<UserEntity> { }

// Serviceæ¥å£: XxxService
public interface UserService { }

// Serviceå®ç°: XxxServiceImpl
@Service
public class UserServiceImpl implements UserService { }

// Manager: XxxManager (åœ¨microservices-commonä¸­ä¸ä½¿ç”¨Springæ³¨è§£)
// æ³¨æ„ï¼šManagerç±»åœ¨microservices-commonä¸­æ˜¯çº¯Javaç±»ï¼Œä¸ä½¿ç”¨@Component
// Managerå®ä¾‹åœ¨å¾®æœåŠ¡ä¸­é€šè¿‡Serviceå±‚æ‰‹åŠ¨åˆ›å»ºæˆ–é€šè¿‡é…ç½®ç±»æ³¨å†Œä¸ºSpring Bean
public class UserManager {
    // é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    private final UserDao userDao;
    
    public UserManager(UserDao userDao) {
        this.userDao = userDao;
    }
}

// Controller: XxxController
@RestController
public class UserController { }

// Form: XxxAddForm, XxxUpdateForm, XxxQueryForm
public class UserAddForm { }

// VO: XxxVO, XxxDetailVO
public class UserVO { }
```

#### ä¾èµ–æ³¨å…¥
```java
// âœ… æ­£ç¡®
@Resource
private UserDao userDao;

// âŒ é”™è¯¯
@Autowired
private UserDao userDao;
```

#### äº‹åŠ¡ç®¡ç†
```java
// Serviceå±‚å†™æ“ä½œ
@Service
@Transactional(rollbackFor = Exception.class)
public class UserServiceImpl implements UserService { }

// DAOå±‚æŸ¥è¯¢
@Transactional(readOnly = true)
List<UserEntity> selectByCondition(Wrapper<UserEntity> wrapper);
```

#### åŒ…å¼•ç”¨
```java
// âœ… æ­£ç¡® - Jakarta EE 3.0+
import jakarta.annotation.Resource;
import jakarta.validation.Valid;

// âŒ é”™è¯¯ - æ—§ç‰ˆjavax
import javax.annotation.Resource;
import javax.validation.Valid;
```

### APIè®¾è®¡è§„èŒƒ

#### RESTfulè®¾è®¡
```java
// âœ… æ­£ç¡®
@GetMapping("/api/v1/users/{id}")      // æŸ¥è¯¢
@PostMapping("/api/v1/users")          // åˆ›å»º
@PutMapping("/api/v1/users/{id}")      // æ›´æ–°
@DeleteMapping("/api/v1/users/{id}")   // åˆ é™¤

// âŒ é”™è¯¯
@PostMapping("/getUserInfo")           // æŸ¥è¯¢ä¸åº”ç”¨POST
@PostMapping("/updateUser")            // ç¼ºå°‘è·¯å¾„å‚æ•°
```

#### å“åº”æ ¼å¼
```java
// ç»Ÿä¸€ä½¿ç”¨ ResponseDTO
@GetMapping("/{id}")
public ResponseDTO<UserVO> getById(@PathVariable Long id) {
    return ResponseDTO.ok(userService.getById(id));
}

// åˆ†é¡µä½¿ç”¨ PageResult
@GetMapping("/page")
public ResponseDTO<PageResult<UserVO>> page(@Valid UserQueryForm form) {
    return ResponseDTO.ok(userService.queryPage(form));
}
```

### æ•°æ®åº“è§„èŒƒ

#### è¡¨å‘½å
```sql
-- å…¬å…±è¡¨: t_common_
t_common_user, t_common_department

-- ä¸šåŠ¡è¡¨: t_{module}_
t_access_record, t_attendance_record, t_consume_record
```

#### å¿…éœ€å­—æ®µ
```sql
id              BIGINT PRIMARY KEY AUTO_INCREMENT,
create_time     DATETIME NOT NULL,
update_time     DATETIME NOT NULL,
deleted_flag    TINYINT DEFAULT 0,
version         INT DEFAULT 0
```

#### ç´¢å¼•å‘½å
```sql
-- ä¸»é”®: pk_{è¡¨å}
-- å”¯ä¸€ç´¢å¼•: uk_{è¡¨å}_{å­—æ®µ}
-- æ™®é€šç´¢å¼•: idx_{è¡¨å}_{å­—æ®µ}
```

### MyBatis-Plusè§„èŒƒ

#### LambdaQueryWrapperä½¿ç”¨
```java
// âœ… æ­£ç¡® - ä½¿ç”¨Lambdaè¡¨è¾¾å¼
LambdaQueryWrapper<UserEntity> wrapper = new LambdaQueryWrapper<>();
wrapper.eq(UserEntity::getStatus, 1)
       .orderByDesc(UserEntity::getCreateTime);

// âŒ é”™è¯¯ - ä½¿ç”¨å­—ç¬¦ä¸²
QueryWrapper<UserEntity> wrapper = new QueryWrapper<>();
wrapper.eq("status", 1)
       .orderByDesc("create_time");
```

#### åˆ†é¡µæŸ¥è¯¢
```java
// âœ… æ­£ç¡® - ä½¿ç”¨PageHelperæˆ–MyBatis-Plusåˆ†é¡µ
Page<UserEntity> page = new Page<>(pageNum, pageSize);
IPage<UserEntity> result = userDao.selectPage(page, wrapper);

// âŒ é”™è¯¯ - æ·±åº¦åˆ†é¡µ
SELECT * FROM user LIMIT 100000, 20;
```

## ğŸ”’ å®‰å…¨è§„èŒƒ

### å‚æ•°éªŒè¯
```java
// Controllerå±‚ä½¿ç”¨@Valid
@PostMapping
public ResponseDTO<Long> add(@Valid @RequestBody UserAddForm form) { }

// Formç±»ä½¿ç”¨éªŒè¯æ³¨è§£
public class UserAddForm {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(max = 50, message = "ç”¨æˆ·åæœ€é•¿50å­—ç¬¦")
    private String username;
}
```

### æ•°æ®è„±æ•
```java
// æ•æ„Ÿå­—æ®µè„±æ•è¾“å‡º
@JsonSerialize(using = PhoneMaskSerializer.class)
private String phone;

@JsonSerialize(using = IdCardMaskSerializer.class)
private String idCard;
```

### SQLæ³¨å…¥é˜²æŠ¤
```java
// âœ… æ­£ç¡® - å‚æ•°åŒ–æŸ¥è¯¢
@Select("SELECT * FROM user WHERE username = #{username}")
UserEntity selectByUsername(@Param("username") String username);

// âŒ é”™è¯¯ - å­—ç¬¦ä¸²æ‹¼æ¥
@Select("SELECT * FROM user WHERE username = '" + username + "'")
```

## ğŸ“Š æ—¥å¿—è§„èŒƒ

### æ—¥å¿—æ ¼å¼
```java
@Slf4j
public class UserServiceImpl {

    public void createUser(UserAddForm form) {
        // âœ… æ­£ç¡® - ä½¿ç”¨å ä½ç¬¦
        log.info("[ç”¨æˆ·åˆ›å»º] å¼€å§‹åˆ›å»ºç”¨æˆ·, username={}", form.getUsername());

        // âŒ é”™è¯¯ - å­—ç¬¦ä¸²æ‹¼æ¥
        log.info("åˆ›å»ºç”¨æˆ·: " + form.getUsername());
    }
}
```

### æ—¥å¿—çº§åˆ«
```
ERROR: ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸æ•è·
WARN:  è­¦å‘Šä¿¡æ¯ã€æ½œåœ¨é—®é¢˜
INFO:  ä¸šåŠ¡å…³é”®èŠ‚ç‚¹
DEBUG: è°ƒè¯•ä¿¡æ¯
```

## âœ… ä»£ç è´¨é‡æ ‡å‡†

### è´¨é‡æŒ‡æ ‡
```
- ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- é‡å¤ä»£ç ç‡ â‰¤ 3%
- åœˆå¤æ‚åº¦ â‰¤ 10
- æ–¹æ³•è¡Œæ•° â‰¤ 50
- ç±»è¡Œæ•° â‰¤ 500
```

### æäº¤å‰æ£€æŸ¥
```
[ ] éµå¾ªå››å±‚æ¶æ„
[ ] ä½¿ç”¨@Resourceæ³¨å…¥
[ ] ä½¿ç”¨@Mapper + Daoå‘½å
[ ] ä½¿ç”¨jakarta.*åŒ…
[ ] æ— ç¡¬ç¼–ç é…ç½®
[ ] æœ‰å®Œæ•´æ—¥å¿—è®°å½•
[ ] æœ‰å‚æ•°éªŒè¯
[ ] æ— SQLæ³¨å…¥é£é™©
[ ] ç¼–è¯‘0é”™è¯¯0è­¦å‘Š
```

## ğŸš€ å¾®æœåŠ¡è°ƒç”¨è§„èŒƒ

### é€šè¿‡ç½‘å…³è°ƒç”¨
```java
// âœ… æ­£ç¡® - ä½¿ç”¨GatewayServiceClient
@Resource
private GatewayServiceClient gatewayServiceClient;

public UserVO getUser(Long userId) {
    return gatewayServiceClient.callCommonService(
        "/api/v1/users/" + userId,
        HttpMethod.GET,
        null,
        UserVO.class
    );
}

// âŒ é”™è¯¯ - ç›´æ¥ä½¿ç”¨FeignClient
@FeignClient(name = "ioedream-common-service")
public interface UserClient { }
```

## ğŸ“ æ–‡ä»¶ç»„ç»‡è§„èŒƒ

### microservices-common (å…¬å…±JAR)
```
å…è®¸: Entity, DAO, Manager, Form, VO, Config, Constant, Enum, Exception, Util
ç¦æ­¢: @Serviceå®ç°, @RestController, spring-boot-starter-web
```

### ioedream-common-service (å¾®æœåŠ¡)
```
å…è®¸: Controller, Serviceæ¥å£, ServiceImpl, æœåŠ¡é…ç½®
ä¾èµ–: microservices-common
```

### ä¸šåŠ¡å¾®æœåŠ¡
```
å…è®¸: ä¸šåŠ¡ç‰¹å®šçš„Controller, Service, Manager, Entity
ä¾èµ–: microservices-common
è°ƒç”¨: é€šè¿‡GatewayServiceClientè°ƒç”¨å…¶ä»–æœåŠ¡
```

## ğŸ”§ IDEé…ç½®å»ºè®®

### ä»£ç æ ¼å¼åŒ–
```
- ä½¿ç”¨UTF-8ç¼–ç  (æ— BOM)
- ç¼©è¿›: 4ç©ºæ ¼
- è¡Œå®½: 120å­—ç¬¦
- å¯¼å…¥æ’åº: java, jakarta, org, com, net
```

### è‡ªåŠ¨æ£€æŸ¥
```
- ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
- æäº¤å‰è¿è¡Œlintæ£€æŸ¥
- ç¼–è¯‘æ—¶æ£€æŸ¥æœªä½¿ç”¨çš„å¯¼å…¥
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- CLAUDE.md - é¡¹ç›®æ ¸å¿ƒæ¶æ„è§„èŒƒ
- documentation/architecture/OPTIMAL_ARCHITECTURE_DESIGN.md - æœ€ä¼˜æ¶æ„è®¾è®¡
- documentation/architecture/ARCHITECTURE_REFACTORING_PLAN.md - é‡æ„è®¡åˆ’

