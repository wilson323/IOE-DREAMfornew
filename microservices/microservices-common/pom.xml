<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>net.lab1024.sa</groupId>
    <artifactId>ioedream-microservices-parent</artifactId>
    <version>1.0.0</version>
    <relativePath>../pom.xml</relativePath>
  </parent>

  <artifactId>microservices-common</artifactId>
  <packaging>jar</packaging>

  <name>IOE-DREAM Common Module</name>
  <description>公共模块，包含Entity、DAO、Manager等公共组件</description>

  <dependencies>
    <!-- ==================== 核心基础模块 ==================== -->
    <!-- Common Core (最小稳定内核) -->
    <dependency>
      <groupId>net.lab1024.sa</groupId>
      <artifactId>microservices-common-core</artifactId>
      <version>${project.version}</version>
    </dependency>

    <!-- ==================== 配置类所需的最小依赖 ==================== -->
    <!--
      注意：microservices-common作为配置类和工具类容器，只保留配置类所需的依赖。
      所有细粒度模块的聚合依赖已移除，各服务直接依赖需要的细粒度模块。
      所有框架依赖（MyBatis-Plus、Redis、Druid、Flyway等）已迁移到对应的细粒度模块。
    -->

    <!-- Spring Boot Starter (用于配置类：@ConfigurationProperties、@Component、@Bean) -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter</artifactId>
    </dependency>

    <!-- Spring Web (用于其他配置类和Web相关功能) -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- Jackson (用于JacksonConfiguration配置类的ObjectMapper) -->
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-databind</artifactId>
      <version>${jackson.version}</version>
    </dependency>

    <!-- Swagger/OpenAPI (用于OpenApiConfiguration配置类) -->
    <dependency>
      <groupId>io.swagger.core.v3</groupId>
      <artifactId>swagger-annotations</artifactId>
      <version>${swagger.version}</version>
    </dependency>
    <dependency>
      <groupId>io.swagger.core.v3</groupId>
      <artifactId>swagger-models</artifactId>
      <version>${swagger.version}</version>
    </dependency>

    <!-- Micrometer (用于CommonComponentsConfiguration配置类) -->
    <dependency>
      <groupId>io.micrometer</groupId>
      <artifactId>micrometer-core</artifactId>
      <version>${micrometer.version}</version>
    </dependency>

    <!-- Micrometer Tracing (用于CommonComponentsConfiguration配置类) -->
    <dependency>
      <groupId>io.micrometer</groupId>
      <artifactId>micrometer-tracing-bridge-brave</artifactId>
    </dependency>
    <dependency>
      <groupId>io.micrometer</groupId>
      <artifactId>micrometer-observation</artifactId>
      <version>${micrometer.version}</version>
    </dependency>

    <!-- Lombok (用于IoeDreamGatewayProperties的@Data注解) -->
    <dependency>
      <groupId>org.projectlombok</groupId>
      <artifactId>lombok</artifactId>
      <optional>true</optional>
    </dependency>

    <!-- Spring Cloud Commons (服务发现，用于其他组件) -->
    <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-commons</artifactId>
    </dependency>

    <!--
      架构重构说明：
      1. ExceptionMetricsCollector已迁移到microservices-common-monitor模块
      2. StrategyFactory已迁移到microservices-common-business模块
      3. 业务服务直接依赖对应的细粒度模块，符合架构规范
      4. microservices-common作为配置类容器，不再依赖细粒度模块
    -->

    <!-- Jakarta Validation API (用于验证注解) -->
    <dependency>
      <groupId>jakarta.validation</groupId>
      <artifactId>jakarta.validation-api</artifactId>
    </dependency>

    <!-- ==================== 测试依赖 ==================== -->
    <!-- JUnit 5 (测试框架) -->
    <dependency>
      <groupId>org.junit.jupiter</groupId>
      <artifactId>junit-jupiter</artifactId>
      <version>${junit.version}</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-test</artifactId>
      <scope>test</scope>
    </dependency>

    <!-- H2 Database (测试环境使用内存数据库) -->
    <dependency>
      <groupId>com.h2database</groupId>
      <artifactId>h2</artifactId>
      <scope>test</scope>
    </dependency>

  </dependencies>

  <build>
    <plugins>
      <!-- Maven Compiler Plugin配置由父POM统一管理 -->

      <!-- Spring Boot Maven Plugin - 跳过repackage，因为这是公共库而非可执行应用 -->
      <plugin>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-maven-plugin</artifactId>
        <version>${spring-boot.version}</version>
        <configuration>
          <!-- 跳过repackage，因为microservices-common是公共JAR库，不是可执行应用 -->
          <skip>true</skip>
        </configuration>
      </plugin>
    </plugins>
  </build>
</project>