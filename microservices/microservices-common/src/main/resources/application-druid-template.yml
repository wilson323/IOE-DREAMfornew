# ============================================================
# Druid连接池配置模板
# 
# @Author:    IOE-DREAM Team
# @Date:      2025-01-30
# @Copyright  IOE-DREAM智慧园区一卡通管理平台
# 
# 说明: 此文件为Druid连接池配置模板，各微服务应参考此模板配置
# ============================================================

spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    # Druid连接池配置（Alibaba Druid标准配置）
    # 注意：IDE可能显示"Unknown property 'spring.datasource.druid'"警告，
    # 但这是Druid连接池的标准配置，可以忽略
    druid:
      # ==================== 核心连接池配置 ====================
      initial-size: 10          # 初始连接数（根据并发量调整）
      min-idle: 10              # 最小空闲连接数
      max-active: 50            # 最大活跃连接数（根据数据库性能调整）
      max-wait: 60000           # 获取连接最大等待时间（毫秒）
      
      # ==================== 连接有效性检测 ====================
      validation-query: SELECT 1
      test-while-idle: true     # 空闲时检测连接有效性
      test-on-borrow: false     # 借用时检测（性能开销大，不推荐）
      test-on-return: false     # 归还时检测（性能开销大，不推荐）
      
      # ==================== 连接回收配置 ====================
      time-between-eviction-runs-millis: 60000  # 连接回收间隔（60秒）
      min-evictable-idle-time-millis: 300000    # 连接最小空闲时间（5分钟）
      
      # ==================== 性能优化配置 ====================
      pool-prepared-statements: true             # 开启预编译语句池
      max-pool-prepared-statement-per-connection-size: 20  # 每个连接最大预编译语句数
      
      # ==================== 监控配置 ====================
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username: admin
        login-password: admin
        reset-enable: false  # 禁用重置功能（生产环境）
      
      # ==================== 慢查询监控 ====================
      filter:
        stat:
          enabled: true
          slow-sql-millis: 1000      # 慢查询阈值（1秒）
          log-slow-sql: true          # 记录慢SQL
          merge-sql: true             # 合并相同SQL统计
        wall:
          enabled: true               # SQL防火墙
          config:
            multi-statement-allow: false  # 禁止多语句执行

