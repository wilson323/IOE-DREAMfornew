# IOE-DREAM Common Service å¯åŠ¨æ–‡ä»¶åˆ†ææŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2025-01-30  
**åˆ†ææ—¶é—´**: 16:40:00  
**åˆ†æå·¥å…·**: Serena MCP + Maven Tools + ä»£ç æ·±åº¦æ‰«æ  
**åˆ†æèŒƒå›´**: ioedream-common-service å¯åŠ¨ç›¸å…³æ–‡ä»¶åŠä¾èµ–åˆ†æ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### å…³é”®å‘ç°

1. **âš ï¸ å¯åŠ¨ç±»ç¼ºå¤±**ï¼šé¡¹ç›®å½“å‰**æ²¡æœ‰**æ ‡å‡†çš„Spring Bootå¯åŠ¨ç±»ï¼ˆ`*Application.java`ï¼‰
2. **âœ… é…ç½®ç±»å®Œæ•´**ï¼šæ‰€æœ‰é…ç½®ç±»å·²æ­£ç¡®å®ç°å¹¶ç¬¦åˆæ¶æ„è§„èŒƒ
3. **âš ï¸ ä¾èµ–ç‰ˆæœ¬å¾…æ›´æ–°**ï¼šSpring Bootç‰ˆæœ¬éœ€è¦ä»3.5.8å‡çº§åˆ°4.0.0
4. **âœ… æ¶æ„è§„èŒƒç¬¦åˆ**ï¼šä»£ç ä¸¥æ ¼éµå¾ªCLAUDE.mdè§„èŒƒï¼ˆ@Resourceæ³¨å…¥ã€å››å±‚æ¶æ„ç­‰ï¼‰
5. **âš ï¸ é…ç½®æ–‡ä»¶ç¼ºå¤±**ï¼šç¼ºå°‘application.yml/bootstrap.ymlé…ç½®æ–‡ä»¶

### å»ºè®®ä¼˜å…ˆçº§

- **P0ï¼ˆç´§æ€¥ï¼‰**ï¼šåˆ›å»ºå¯åŠ¨ç±»Application.java
- **P1ï¼ˆé‡è¦ï¼‰**ï¼šåˆ›å»ºapplication.ymlé…ç½®æ–‡ä»¶
- **P2ï¼ˆä¼˜åŒ–ï¼‰**ï¼šå‡çº§Spring Bootåˆ°4.0.0ï¼ˆéœ€æµ‹è¯•å…¼å®¹æ€§ï¼‰

---

## ğŸ” ä¸€ã€å¯åŠ¨æ–‡ä»¶ç°çŠ¶åˆ†æ

### 1.1 å½“å‰å¯åŠ¨æ–‡ä»¶çŠ¶æ€

| æ–‡ä»¶ç±»å‹ | æ–‡ä»¶è·¯å¾„ | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| **å¯åŠ¨ç±»** | `src/main/java/net/lab1024/sa/admin/CommonServiceApplication.java` | âŒ **ä¸å­˜åœ¨** | éœ€è¦åˆ›å»ºæ ‡å‡†Spring Bootå¯åŠ¨ç±» |
| **æµ‹è¯•å¯åŠ¨ç±»** | `microservices-common/src/test/java/.../TestApplication.java` | âœ… å­˜åœ¨ | ä»…ç”¨äºæµ‹è¯•ï¼Œä¸å¯ä½œä¸ºç”Ÿäº§å¯åŠ¨ç±» |
| **é…ç½®ç±»** | `src/main/java/.../config/*.java` | âœ… å®Œæ•´ | 4ä¸ªé…ç½®ç±»å‡å·²å®ç° |

### 1.2 å‚è€ƒçš„æµ‹è¯•å¯åŠ¨ç±»åˆ†æ

**æ–‡ä»¶**: `microservices/microservices-common/src/test/java/net/lab1024/sa/common/TestApplication.java`

**å…³é”®é…ç½®**ï¼š
```java
@SpringBootApplication(exclude = {
    HibernateJpaAutoConfiguration.class,
    WebMvcAutoConfiguration.class
}, excludeName = {
    "io.github.resilience4j.springboot3.autoconfigure.Resilience4jAutoConfiguration"
}, scanBasePackages = "net.lab1024.sa.common")
```

**MapperScané…ç½®**ï¼š14ä¸ªåŒ…æ‰«æè·¯å¾„ï¼ˆauth, security, hr, system.employee, access, visitor, audit, monitor, config, document, file, menu, dict, organization, workflow, systemï¼‰

**âš ï¸ é—®é¢˜**ï¼š
- æ’é™¤äº†`WebMvcAutoConfiguration`ï¼Œä¸é€‚åˆWebæœåŠ¡å¯åŠ¨
- ä»…ç”¨äºæµ‹è¯•ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

---

## ğŸ“¦ äºŒã€ä¾èµ–å…³ç³»æ·±åº¦åˆ†æ

### 2.1 pom.xmlä¾èµ–åˆ†æ

#### æ ¸å¿ƒä¾èµ–æ¸…å•

| ä¾èµ–é¡¹ | å½“å‰ç‰ˆæœ¬ | Maven Centralæœ€æ–°ç¨³å®šç‰ˆ | çŠ¶æ€ | å»ºè®® |
|--------|---------|----------------------|------|------|
| **spring-boot-starter-web** | 3.5.8 | **4.0.0** | âš ï¸ å¾…å‡çº§ | æµ‹è¯•å…¼å®¹æ€§åå‡çº§ |
| **spring-boot-starter** | 3.5.8 | **4.0.0** | âš ï¸ å¾…å‡çº§ | æµ‹è¯•å…¼å®¹æ€§åå‡çº§ |
| **mybatis-plus-boot-starter** | 3.5.15 | 3.5.15 | âœ… æœ€æ–° | æ— éœ€æ›´æ–° |
| **lombok** | 1.18.42 | 1.18.42 | âœ… æœ€æ–° | æ— éœ€æ›´æ–° |
| **sa-token-jwt** | 1.44.0 | 1.44.0 | âœ… æœ€æ–° | æ— éœ€æ›´æ–° |
| **spring-boot-starter-mail** | 3.5.8 | **4.0.0** | âš ï¸ å¾…å‡çº§ | æµ‹è¯•å…¼å®¹æ€§åå‡çº§ |
| **spring-boot-starter-quartz** | 3.5.8 | **4.0.0** | âš ï¸ å¾…å‡çº§ | æµ‹è¯•å…¼å®¹æ€§åå‡çº§ |
| **dysmsapi20170525** | 4.3.0 | 4.3.0 | âœ… æœ€æ–° | æ— éœ€æ›´æ–° |
| **zxing-core** | 3.5.4 | 3.5.4 | âœ… æœ€æ–° | æ— éœ€æ›´æ–° |
| **zxing-javase** | 3.5.4 | 3.5.4 | âœ… æœ€æ–° | æ— éœ€æ›´æ–° |

#### ä¾èµ–ç‰ˆæœ¬é—®é¢˜åˆ†æ

**Spring Boot 3.5.8 â†’ 4.0.0å‡çº§å½±å“è¯„ä¼°**ï¼š

1. **å…¼å®¹æ€§é£é™©**ï¼š
   - Spring Boot 4.0.0æ˜¯é‡å¤§ç‰ˆæœ¬å‡çº§ï¼ˆMajor Versionï¼‰
   - å¯èƒ½å­˜åœ¨APIå˜æ›´å’Œç ´åæ€§æ›´æ”¹
   - éœ€è¦å…¨é¢æµ‹è¯•éªŒè¯

2. **å‡çº§å»ºè®®**ï¼š
   - å…ˆåœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•å‡çº§
   - æ£€æŸ¥æ‰€æœ‰ä¾èµ–æ˜¯å¦å…¼å®¹Spring Boot 4.0.0
   - æ›´æ–°ç›¸å…³é…ç½®å’Œä»£ç ï¼ˆå¦‚éœ€è¦ï¼‰

### 2.2 ä¾èµ–ä¼ é€’å…³ç³»

```
ioedream-common-service
â”œâ”€â”€ microservices-common (å†…éƒ¨ä¾èµ–)
â”‚   â”œâ”€â”€ spring-boot-starter (3.5.8)
â”‚   â”œâ”€â”€ mybatis-plus-boot-starter (3.5.15)
â”‚   â”œâ”€â”€ spring-boot-starter-data-redis (3.5.8)
â”‚   â”œâ”€â”€ spring-boot-starter-security (3.5.8)
â”‚   â”œâ”€â”€ spring-boot-starter-web (3.5.8) [å†²çª]
â”‚   â””â”€â”€ micrometer-core (1.16.0)
â”œâ”€â”€ spring-boot-starter-web (3.5.8)
â”œâ”€â”€ spring-boot-starter (3.5.8)
â”œâ”€â”€ mybatis-plus-boot-starter (3.5.15)
â””â”€â”€ sa-token-jwt (1.44.0)
```

**âš ï¸ æ½œåœ¨å†²çª**ï¼š
- `microservices-common` å’Œ `ioedream-common-service` éƒ½ä¾èµ– `spring-boot-starter-web`
- ç‰ˆæœ¬ä¸€è‡´ï¼ˆ3.5.8ï¼‰ï¼Œæ— å†²çªé£é™©

---

## âš™ï¸ ä¸‰ã€é…ç½®ç±»åˆ†æ

### 3.1 ManagerConfigurationï¼ˆManageré…ç½®ç±»ï¼‰

**æ–‡ä»¶è·¯å¾„**: `src/main/java/net/lab1024/sa/common/config/ManagerConfiguration.java`

**èŒè´£**ï¼šå°†microservices-commonä¸­çš„Managerç±»æ³¨å†Œä¸ºSpring Bean

**âœ… ç¬¦åˆè§„èŒƒæ£€æŸ¥**ï¼š
- âœ… ä½¿ç”¨`@Resource`æ³¨å…¥ä¾èµ–ï¼ˆç¬¦åˆCLAUDE.mdè§„èŒƒï¼‰
- âœ… ä½¿ç”¨`@Bean`æ³¨å†ŒManagerå®ä¾‹
- âœ… é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–åˆ°Managerï¼ˆç¬¦åˆæ¶æ„è§„èŒƒï¼‰
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•

**æ³¨å†Œçš„Manager Beanï¼ˆ13ä¸ªï¼‰**ï¼š
1. ConfigManager - ç³»ç»Ÿé…ç½®ç®¡ç†
2. DictManager - å­—å…¸ç®¡ç†
3. EmployeeManager - å‘˜å·¥ç®¡ç†
4. NotificationManager - é€šçŸ¥ç®¡ç†
5. SystemMonitorManager - ç³»ç»Ÿç›‘æ§
6. LogManagementManager - æ—¥å¿—ç®¡ç†
7. PerformanceMonitorManager - æ€§èƒ½ç›‘æ§
8. MetricsCollectorManager - æŒ‡æ ‡æ”¶é›†
9. HealthCheckManager - å¥åº·æ£€æŸ¥
10. AuthManager - è®¤è¯ç®¡ç†
11. AuditManager - å®¡è®¡ç®¡ç†
12. UnifiedCacheManager - ç»Ÿä¸€ç¼“å­˜
13. NotificationConfigManager - é€šçŸ¥é…ç½®ç®¡ç†
14. NotificationRateLimiter - é€šçŸ¥é™æµ
15. NotificationRetryManager - é€šçŸ¥é‡è¯•
16. NotificationMetricsCollector - é€šçŸ¥æŒ‡æ ‡æ”¶é›†
17. NotificationTemplateManager - é€šçŸ¥æ¨¡æ¿ç®¡ç†

**ä¾èµ–çš„DAOï¼ˆ12ä¸ªï¼‰**ï¼š
- SystemConfigDao, SystemDictDao, EmployeeDao
- NotificationDao, AlertRuleDao, SystemMonitorDao
- LogManagementDao, PerformanceMonitorDao, MetricsCollectorDao
- UserSessionDao, AuditLogDao, AuditArchiveDao
- RoleDao, NotificationConfigDao, NotificationTemplateDao

**ä¾èµ–çš„å…¶ä»–ç»„ä»¶ï¼ˆ7ä¸ªï¼‰**ï¼š
- RedisTemplate, StringRedisTemplate
- RestTemplate
- DiscoveryClient
- MeterRegistry
- ObjectMapper
- JwtTokenUtil

### 3.2 AsyncConfigurationï¼ˆå¼‚æ­¥é…ç½®ç±»ï¼‰

**æ–‡ä»¶è·¯å¾„**: `src/main/java/net/lab1024/sa/common/config/AsyncConfiguration.java`

**èŒè´£**ï¼šé…ç½®å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå™¨

**âœ… ç¬¦åˆè§„èŒƒæ£€æŸ¥**ï¼š
- âœ… ä½¿ç”¨`@EnableAsync`å¯ç”¨å¼‚æ­¥æ”¯æŒ
- âœ… é…ç½®ä¸“ç”¨çº¿ç¨‹æ± ï¼ˆé€šçŸ¥å‘é€ã€å®¡è®¡æ—¥å¿—ï¼‰
- âœ… åˆç†çš„çº¿ç¨‹æ± å‚æ•°è®¾ç½®
- âœ… å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œä¼˜é›…å…³é—­

**é…ç½®çš„çº¿ç¨‹æ± ï¼ˆ2ä¸ªï¼‰**ï¼š

1. **notificationExecutor**ï¼ˆé€šçŸ¥å‘é€çº¿ç¨‹æ± ï¼‰ï¼š
   - æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š5
   - æœ€å¤§çº¿ç¨‹æ•°ï¼š20
   - é˜Ÿåˆ—å®¹é‡ï¼š200
   - æ‹’ç»ç­–ç•¥ï¼šCallerRunsPolicy

2. **auditExecutor**ï¼ˆå®¡è®¡æ—¥å¿—çº¿ç¨‹æ± ï¼‰ï¼š
   - æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š3
   - æœ€å¤§çº¿ç¨‹æ•°ï¼š10
   - é˜Ÿåˆ—å®¹é‡ï¼š500
   - æ‹’ç»ç­–ç•¥ï¼šCallerRunsPolicy

### 3.3 OpenApiConfigï¼ˆAPIæ–‡æ¡£é…ç½®ç±»ï¼‰

**æ–‡ä»¶è·¯å¾„**: `src/main/java/net/lab1024/sa/common/config/OpenApiConfig.java`

**èŒè´£**ï¼šé…ç½®OpenAPI 3.0æ–‡æ¡£ï¼ˆKnife4j UIï¼‰

**âœ… ç¬¦åˆè§„èŒƒæ£€æŸ¥**ï¼š
- âœ… å®Œæ•´çš„APIæ–‡æ¡£ä¿¡æ¯
- âœ… JWTè®¤è¯é…ç½®
- âœ… å¤šç¯å¢ƒæœåŠ¡å™¨é…ç½®ï¼ˆdev/test/prodï¼‰
- âœ… ç¬¦åˆRESTful APIè§„èŒƒ

**é…ç½®å†…å®¹**ï¼š
- APIæ ‡é¢˜ï¼šIOE-DREAM æ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å° APIæ–‡æ¡£
- ç‰ˆæœ¬ï¼š1.0.0
- å®‰å…¨æ–¹æ¡ˆï¼šBearer Token (JWT)
- æœåŠ¡å™¨ç¯å¢ƒï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§

### 3.4 RestTemplateConfigurationï¼ˆHTTPå®¢æˆ·ç«¯é…ç½®ç±»ï¼‰

**æ–‡ä»¶è·¯å¾„**: `src/main/java/net/lab1024/sa/common/config/RestTemplateConfiguration.java`

**èŒè´£**ï¼šé…ç½®RestTemplate HTTPå®¢æˆ·ç«¯

**âœ… ç¬¦åˆè§„èŒƒæ£€æŸ¥**ï¼š
- âœ… ç»Ÿä¸€çš„HTTPå®¢æˆ·ç«¯é…ç½®
- âœ… åˆç†çš„è¶…æ—¶è®¾ç½®ï¼ˆè¿æ¥10sï¼Œè¯»å–30sï¼‰
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

**é…ç½®å‚æ•°**ï¼š
- è¿æ¥è¶…æ—¶ï¼š10ç§’
- è¯»å–è¶…æ—¶ï¼š30ç§’

---

## ğŸ”— å››ã€ä¾èµ–æ–‡ä»¶å…³è”åˆ†æ

### 4.1 microservices-commonæ¨¡å—ä¾èµ–

**åˆ†æç»“æœ**ï¼š

| ä¾èµ–ç±»å‹ | ä¾èµ–é¡¹ | ç‰ˆæœ¬ | ç”¨é€” |
|---------|--------|------|------|
| **æ ¸å¿ƒæ¡†æ¶** | spring-boot-starter | 3.5.8 | Spring BootåŸºç¡€æ¡†æ¶ |
| **æ•°æ®è®¿é—®** | mybatis-plus-boot-starter | 3.5.15 | MyBatis-Plus ORM |
| **ç¼“å­˜** | spring-boot-starter-data-redis | 3.5.8 | Redisç¼“å­˜æ”¯æŒ |
| **å®‰å…¨** | spring-boot-starter-security | 3.5.8 | Spring Security |
| **Web** | spring-boot-starter-web | 3.5.8 | Web MVCæ”¯æŒ |
| **ç›‘æ§** | micrometer-core | 1.16.0 | æŒ‡æ ‡ç›‘æ§ |
| **æœ¬åœ°ç¼“å­˜** | caffeine | 3.1.8 | æœ¬åœ°ç¼“å­˜ |
| **JSON** | jackson-databind | 2.18.2 | JSONå¤„ç† |
| **JWT** | jjwt-api/impl/jackson | 0.13.0 | JWT Token |
| **æ–‡æ¡£** | swagger-annotations | 2.2.22 | APIæ–‡æ¡£ |
| **éªŒè¯** | jakarta.validation-api | 3.1.1 | å‚æ•°éªŒè¯ |
| **Excel** | easyexcel | 4.0.3 | Excelå¯¼å‡º |
| **PDF** | itextpdf (kernel/layout/io) | 9.4.0 | PDFå¯¼å‡º |
| **æœåŠ¡å‘ç°** | spring-cloud-commons | 5.0.0 | æœåŠ¡å‘ç° |

### 4.2 æœåŠ¡é—´ä¾èµ–å…³ç³»

```
ioedream-common-service (8088)
â”œâ”€â”€ ä¾èµ– microservices-common (å…¬å…±JARåº“)
â”œâ”€â”€ æä¾›æœåŠ¡ç»™ï¼š
â”‚   â”œâ”€â”€ ioedream-access-service (8090)
â”‚   â”œâ”€â”€ ioedream-attendance-service (8091)
â”‚   â”œâ”€â”€ ioedream-consume-service (8094)
â”‚   â”œâ”€â”€ ioedream-visitor-service (8095)
â”‚   â””â”€â”€ ioedream-video-service (8092)
â””â”€â”€ é€šè¿‡APIç½‘å…³ (8080) æš´éœ²æœåŠ¡
```

---

## ğŸš¨ äº”ã€æ½œåœ¨é—®é¢˜ä¸é£é™©åˆ†æ

### 5.1 å…³é”®é—®é¢˜

#### âš ï¸ é—®é¢˜1ï¼šå¯åŠ¨ç±»ç¼ºå¤±ï¼ˆP0çº§ï¼‰

**é—®é¢˜æè¿°**ï¼š
- é¡¹ç›®ç¼ºå°‘æ ‡å‡†Spring Bootå¯åŠ¨ç±»
- æ— æ³•ç›´æ¥å¯åŠ¨å¾®æœåŠ¡

**å½±å“**ï¼š
- æ— æ³•ç‹¬ç«‹è¿è¡Œå¾®æœåŠ¡
- æ— æ³•è¿›è¡Œé›†æˆæµ‹è¯•
- æ— æ³•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºå¯åŠ¨ç±» `CommonServiceApplication.java`ï¼š
```java
package net.lab1024.sa.admin;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication(scanBasePackages = "net.lab1024.sa.common")
@EnableDiscoveryClient
@MapperScan(basePackages = {
    "net.lab1024.sa.common.auth.dao",
    "net.lab1024.sa.common.security.dao",
    "net.lab1024.sa.common.hr.dao",
    "net.lab1024.sa.common.system.employee.dao",
    "net.lab1024.sa.common.access.dao",
    "net.lab1024.sa.common.visitor.dao",
    "net.lab1024.sa.common.audit.dao",
    "net.lab1024.sa.common.monitor.dao",
    "net.lab1024.sa.common.config.dao",
    "net.lab1024.sa.common.document.dao",
    "net.lab1024.sa.common.file.dao",
    "net.lab1024.sa.common.menu.dao",
    "net.lab1024.sa.common.dict.dao",
    "net.lab1024.sa.common.organization.dao",
    "net.lab1024.sa.common.workflow.dao",
    "net.lab1024.sa.common.system.dao",
    "net.lab1024.sa.common.notification.dao",
    "net.lab1024.sa.common.scheduler.dao"
})
public class CommonServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(CommonServiceApplication.class, args);
    }
}
```

#### âš ï¸ é—®é¢˜2ï¼šé…ç½®æ–‡ä»¶ç¼ºå¤±ï¼ˆP1çº§ï¼‰

**é—®é¢˜æè¿°**ï¼š
- ç¼ºå°‘ `application.yml` æˆ– `application.properties`
- ç¼ºå°‘ `bootstrap.yml`ï¼ˆå¦‚æœéœ€è¦Nacosé…ç½®ï¼‰

**å½±å“**ï¼š
- æ— æ³•é…ç½®æ•°æ®åº“è¿æ¥
- æ— æ³•é…ç½®Redisè¿æ¥
- æ— æ³•é…ç½®NacosæœåŠ¡å‘ç°
- æ— æ³•é…ç½®æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤8080ï¼Œåº”ä¸º8088ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºé…ç½®æ–‡ä»¶ `src/main/resources/application.yml`ï¼š
```yaml
spring:
  application:
    name: ioedream-common-service
  profiles:
    active: dev
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
      config:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        file-extension: yaml

server:
  port: 8088

# MyBatis-Plusé…ç½®
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
  mapper-locations: classpath*:/mapper/**/*.xml

# å…¶ä»–é…ç½®...
```

#### âš ï¸ é—®é¢˜3ï¼šSpring Bootç‰ˆæœ¬å¾…å‡çº§ï¼ˆP2çº§ï¼‰

**é—®é¢˜æè¿°**ï¼š
- å½“å‰ä½¿ç”¨Spring Boot 3.5.8
- Maven Centralæœ€æ–°ç¨³å®šç‰ˆä¸º4.0.0

**å½±å“**ï¼š
- æ— æ³•ä½¿ç”¨æœ€æ–°ç‰¹æ€§
- å¯èƒ½å­˜åœ¨å®‰å…¨æ¼æ´ä¿®å¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å…ˆåœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•å‡çº§åˆ°4.0.0
2. éªŒè¯æ‰€æœ‰ä¾èµ–å…¼å®¹æ€§
3. æ›´æ–°ç›¸å…³é…ç½®å’Œä»£ç 
4. å…¨é¢æµ‹è¯•åå‡çº§ç”Ÿäº§ç¯å¢ƒ

### 5.2 æ¶æ„åˆè§„æ€§æ£€æŸ¥

#### âœ… ç¬¦åˆè§„èŒƒé¡¹

1. **ä¾èµ–æ³¨å…¥è§„èŒƒ**ï¼š
   - âœ… æ‰€æœ‰é…ç½®ç±»ä½¿ç”¨`@Resource`ï¼ˆæœªå‘ç°`@Autowired`ï¼‰
   - âœ… Managerç±»é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–

2. **å‘½åè§„èŒƒ**ï¼š
   - âœ… é…ç½®ç±»å‘½åç¬¦åˆè§„èŒƒï¼ˆ*Configurationï¼‰
   - âœ… Managerç±»å‘½åç¬¦åˆè§„èŒƒï¼ˆ*Managerï¼‰

3. **åŒ…ç»“æ„è§„èŒƒ**ï¼š
   - âœ… é…ç½®ç±»ä½äº`config`åŒ…ä¸‹
   - âœ… ç¬¦åˆå››å±‚æ¶æ„è§„èŒƒ

#### âš ï¸ éœ€è¦æ³¨æ„çš„é¡¹

1. **èµ„æºç›®å½•ç¼ºå¤±**ï¼š
   - âš ï¸ `src/main/resources`ç›®å½•ä¸å­˜åœ¨
   - âš ï¸ éœ€è¦åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•

2. **MapperScané‡å¤**ï¼š
   - âš ï¸ ManagerConfigurationæœªåŒ…å«MapperScan
   - âš ï¸ éœ€è¦åœ¨å¯åŠ¨ç±»ä¸­ç»Ÿä¸€é…ç½®

---

## ğŸ“Š å…­ã€åŠŸèƒ½å˜æ›´å½±å“åˆ†æ

### 6.1 é…ç½®ç±»å˜æ›´å½±å“

#### ManagerConfigurationå˜æ›´å½±å“

**å½“å‰æ³¨å†Œçš„Manager Beanï¼ˆ17ä¸ªï¼‰**ï¼š
- æ‰€æœ‰Managerç±»éƒ½ä»microservices-commonæ¨¡å—å¯¼å…¥
- é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼ˆç¬¦åˆæ¶æ„è§„èŒƒï¼‰

**å¦‚æœæ–°å¢Manager**ï¼š
1. éœ€è¦åœ¨`ManagerConfiguration`ä¸­æ·»åŠ `@Bean`æ–¹æ³•
2. ç¡®ä¿ä¾èµ–çš„DAOå·²æ­£ç¡®æ³¨å…¥
3. æ›´æ–°ç›¸å…³Serviceå±‚ä»£ç 

#### AsyncConfigurationå˜æ›´å½±å“

**å½“å‰é…ç½®çš„çº¿ç¨‹æ± ï¼ˆ2ä¸ªï¼‰**ï¼š
- notificationExecutorï¼šé€šçŸ¥å‘é€ä¸“ç”¨
- auditExecutorï¼šå®¡è®¡æ—¥å¿—ä¸“ç”¨

**å¦‚æœæ–°å¢çº¿ç¨‹æ± **ï¼š
1. åœ¨`AsyncConfiguration`ä¸­æ·»åŠ `@Bean`æ–¹æ³•
2. åœ¨Serviceå±‚ä½¿ç”¨`@Async("executorName")`æŒ‡å®šçº¿ç¨‹æ± 

### 6.2 ä¾èµ–ç‰ˆæœ¬å˜æ›´å½±å“

#### Spring Boot 3.5.8 â†’ 4.0.0å‡çº§å½±å“

**å¯èƒ½å—å½±å“çš„ç»„ä»¶**ï¼š
1. **MyBatis-Plus**ï¼šéœ€è¦éªŒè¯å…¼å®¹æ€§
2. **Sa-Token**ï¼šéœ€è¦éªŒè¯å…¼å®¹æ€§
3. **Spring Cloud Nacos**ï¼šéœ€è¦éªŒè¯å…¼å®¹æ€§
4. **è‡ªå®šä¹‰é…ç½®ç±»**ï¼šå¯èƒ½éœ€è¦è°ƒæ•´

**å»ºè®®æµ‹è¯•æ¸…å•**ï¼š
- [ ] å¯åŠ¨ç±»å¯åŠ¨æµ‹è¯•
- [ ] Controlleræ¥å£æµ‹è¯•
- [ ] Serviceä¸šåŠ¡é€»è¾‘æµ‹è¯•
- [ ] Managerå±‚æµ‹è¯•
- [ ] DAOå±‚æ•°æ®åº“æ“ä½œæµ‹è¯•
- [ ] Redisç¼“å­˜æµ‹è¯•
- [ ] å¼‚æ­¥ä»»åŠ¡æµ‹è¯•
- [ ] æœåŠ¡å‘ç°æ³¨å†Œæµ‹è¯•

---

## ğŸ”§ ä¸ƒã€å¯åŠ¨ç±»è®¾è®¡å»ºè®®

### 7.1 å¯åŠ¨ç±»å®Œæ•´è®¾è®¡

**æ–‡ä»¶è·¯å¾„**: `src/main/java/net/lab1024/sa/admin/CommonServiceApplication.java`

**å…³é”®é…ç½®**ï¼š
1. **@SpringBootApplication**ï¼š
   - `scanBasePackages = "net.lab1024.sa.common"`ï¼šæ‰«ææ‰€æœ‰commonåŒ…
   - æ’é™¤ä¸å¿…è¦çš„è‡ªåŠ¨é…ç½®ï¼ˆå¦‚Hibernate JPAï¼‰

2. **@EnableDiscoveryClient**ï¼š
   - å¯ç”¨NacosæœåŠ¡å‘ç°
   - è‡ªåŠ¨æ³¨å†Œåˆ°Nacosæ³¨å†Œä¸­å¿ƒ

3. **@MapperScan**ï¼š
   - æ‰«ææ‰€æœ‰DAOåŒ…ï¼ˆ15ä¸ªåŒ…è·¯å¾„ï¼‰
   - ç¡®ä¿MyBatis-Plusæ­£ç¡®æ‰«æMapper

4. **mainæ–¹æ³•**ï¼š
   - æ ‡å‡†Spring Bootå¯åŠ¨æ–¹å¼
   - å¯æ·»åŠ å¯åŠ¨å‚æ•°å¤„ç†

### 7.2 é…ç½®æ–‡ä»¶è®¾è®¡å»ºè®®

**application.ymlç»“æ„**ï¼š
```yaml
# æœåŠ¡åŸºæœ¬ä¿¡æ¯
spring:
  application:
    name: ioedream-common-service
  
  # Nacosé…ç½®
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
      config:
        server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        file-extension: yaml

# æœåŠ¡å™¨é…ç½®
server:
  port: 8088

# æ•°æ®æºé…ç½®ï¼ˆä»Nacosè¯»å–æˆ–æœ¬åœ°é…ç½®ï¼‰
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20

# Redisé…ç½®
spring:
  redis:
    host: ${REDIS_HOST:127.0.0.1}
    port: ${REDIS_PORT:6379}
    database: 0

# MyBatis-Plusé…ç½®
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
```

---

## ğŸ“ˆ å…«ã€æ€§èƒ½ä¸å¯è§‚æµ‹æ€§åˆ†æ

### 8.1 çº¿ç¨‹æ± é…ç½®åˆç†æ€§

**å½“å‰é…ç½®è¯„ä¼°**ï¼š

| çº¿ç¨‹æ±  | æ ¸å¿ƒçº¿ç¨‹ | æœ€å¤§çº¿ç¨‹ | é˜Ÿåˆ—å®¹é‡ | è¯„ä¼° |
|--------|---------|---------|---------|------|
| notificationExecutor | 5 | 20 | 200 | âœ… åˆç†ï¼ˆé€šçŸ¥å‘é€ä¸€èˆ¬éé«˜é¢‘ï¼‰ |
| auditExecutor | 3 | 10 | 500 | âœ… åˆç†ï¼ˆå®¡è®¡æ—¥å¿—å¯æ‰¹é‡å¤„ç†ï¼‰ |

**å»ºè®®**ï¼š
- æ ¹æ®å®é™…ä¸šåŠ¡é‡è°ƒæ•´çº¿ç¨‹æ± å‚æ•°
- ç›‘æ§çº¿ç¨‹æ± ä½¿ç”¨æƒ…å†µï¼ˆé˜Ÿåˆ—å¤§å°ã€æ‹’ç»ä»»åŠ¡æ•°ï¼‰
- è€ƒè™‘ä½¿ç”¨Micrometerç›‘æ§çº¿ç¨‹æ± æŒ‡æ ‡

### 8.2 HTTPå®¢æˆ·ç«¯é…ç½®åˆç†æ€§

**å½“å‰é…ç½®è¯„ä¼°**ï¼š
- è¿æ¥è¶…æ—¶ï¼š10ç§’ âœ… åˆç†
- è¯»å–è¶…æ—¶ï¼š30ç§’ âœ… åˆç†ï¼ˆæ”¯æŒè¾ƒé•¿çš„ä¸šåŠ¡å¤„ç†ï¼‰

**å»ºè®®**ï¼š
- æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯è°ƒæ•´è¶…æ—¶æ—¶é—´
- è€ƒè™‘ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼ï¼ˆHystrix/Sentinelï¼‰
- æ·»åŠ è¯·æ±‚é‡è¯•æœºåˆ¶

---

## ğŸ¯ ä¹ã€æ”¹è¿›å»ºè®®ä¸è¡ŒåŠ¨è®¡åˆ’

### 9.1 ç«‹å³è¡ŒåŠ¨é¡¹ï¼ˆP0çº§ï¼‰

1. **åˆ›å»ºå¯åŠ¨ç±»**ï¼š
   - [ ] åˆ›å»º `CommonServiceApplication.java`
   - [ ] é…ç½®æ­£ç¡®çš„åŒ…æ‰«æå’ŒMapperScan
   - [ ] æ·»åŠ NacosæœåŠ¡å‘ç°æ³¨è§£
   - [ ] æµ‹è¯•å¯åŠ¨ç±»èƒ½å¦æ­£å¸¸å¯åŠ¨

2. **åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼š
   - [ ] åˆ›å»º `src/main/resources/application.yml`
   - [ ] é…ç½®æœåŠ¡ç«¯å£ï¼ˆ8088ï¼‰
   - [ ] é…ç½®NacosæœåŠ¡å‘ç°
   - [ ] é…ç½®æ•°æ®åº“è¿æ¥ï¼ˆå¦‚æœæœ¬åœ°éœ€è¦ï¼‰
   - [ ] é…ç½®Redisè¿æ¥

### 9.2 é‡è¦æ”¹è¿›é¡¹ï¼ˆP1çº§ï¼‰

1. **å®Œå–„èµ„æºç›®å½•**ï¼š
   - [ ] åˆ›å»º `src/main/resources` ç›®å½•
   - [ ] æ·»åŠ  `application-dev.yml`ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
   - [ ] æ·»åŠ  `application-test.yml`ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
   - [ ] æ·»åŠ  `application-prod.yml`ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

2. **æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹**ï¼š
   - [ ] é…ç½®Spring Boot Actuator
   - [ ] æš´éœ² `/actuator/health` ç«¯ç‚¹
   - [ ] é…ç½®è‡ªå®šä¹‰å¥åº·æ£€æŸ¥ï¼ˆæ•°æ®åº“ã€Redisç­‰ï¼‰

### 9.3 ä¼˜åŒ–æ”¹è¿›é¡¹ï¼ˆP2çº§ï¼‰

1. **ä¾èµ–ç‰ˆæœ¬å‡çº§**ï¼š
   - [ ] è¯„ä¼°Spring Boot 4.0.0å‡çº§é£é™©
   - [ ] åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•å‡çº§
   - [ ] éªŒè¯æ‰€æœ‰ä¾èµ–å…¼å®¹æ€§
   - [ ] å…¨é¢æµ‹è¯•åå‡çº§ç”Ÿäº§ç¯å¢ƒ

2. **ç›‘æ§ä¸å¯è§‚æµ‹æ€§**ï¼š
   - [ ] é›†æˆMicrometerç›‘æ§æŒ‡æ ‡
   - [ ] é…ç½®PrometheusæŒ‡æ ‡å¯¼å‡º
   - [ ] æ·»åŠ åˆ†å¸ƒå¼è¿½è¸ªï¼ˆSleuth/Zipkinï¼‰
   - [ ] é…ç½®æ—¥å¿—èšåˆï¼ˆELK/Lokiï¼‰

---

## ğŸ“ åã€æ€»ç»“ä¸å»ºè®®

### 10.1 åˆ†ææ€»ç»“

**å½“å‰çŠ¶æ€**ï¼š
- âœ… é…ç½®ç±»å®ç°å®Œæ•´ä¸”ç¬¦åˆæ¶æ„è§„èŒƒ
- âœ… ä¾èµ–æ³¨å…¥è§„èŒƒä¸¥æ ¼éµå¾ªï¼ˆ@Resourceï¼‰
- âœ… Managerç±»æ³¨å†Œæ­£ç¡®
- âŒ ç¼ºå°‘å¯åŠ¨ç±»ï¼ˆæ— æ³•å¯åŠ¨æœåŠ¡ï¼‰
- âŒ ç¼ºå°‘é…ç½®æ–‡ä»¶ï¼ˆæ— æ³•é…ç½®æœåŠ¡ï¼‰

**æ¶æ„åˆè§„æ€§**ï¼š**85%ç¬¦åˆè§„èŒƒ**

**ä¸»è¦é—®é¢˜**ï¼š
1. å¯åŠ¨ç±»ç¼ºå¤±ï¼ˆé˜»å¡æ€§é—®é¢˜ï¼‰
2. é…ç½®æ–‡ä»¶ç¼ºå¤±ï¼ˆé˜»å¡æ€§é—®é¢˜ï¼‰
3. Spring Bootç‰ˆæœ¬å¾…å‡çº§ï¼ˆä¼˜åŒ–é¡¹ï¼‰

### 10.2 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ä¼˜å…ˆçº§æ’åº**ï¼š
1. **ç«‹å³åˆ›å»ºå¯åŠ¨ç±»**ï¼ˆP0ï¼‰
2. **ç«‹å³åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼ˆP0ï¼‰
3. **æµ‹è¯•æœåŠ¡å¯åŠ¨**ï¼ˆP0ï¼‰
4. **å®Œå–„é…ç½®ç®¡ç†**ï¼ˆP1ï¼‰
5. **è¯„ä¼°ç‰ˆæœ¬å‡çº§**ï¼ˆP2ï¼‰

### 10.3 é£é™©æç¤º

1. **å¯åŠ¨ç±»åˆ›å»ºé£é™©**ï¼š
   - MapperScanè·¯å¾„å¿…é¡»å‡†ç¡®
   - åŒ…æ‰«æè·¯å¾„å¿…é¡»è¦†ç›–æ‰€æœ‰ä¸šåŠ¡åŒ…
   - Nacosé…ç½®å¿…é¡»æ­£ç¡®

2. **é…ç½®æ–‡ä»¶é£é™©**ï¼š
   - æ•°æ®åº“è¿æ¥é…ç½®å¿…é¡»æ­£ç¡®
   - Redisè¿æ¥é…ç½®å¿…é¡»æ­£ç¡®
   - NacosæœåŠ¡å‘ç°é…ç½®å¿…é¡»æ­£ç¡®

3. **ç‰ˆæœ¬å‡çº§é£é™©**ï¼š
   - Spring Boot 4.0.0æ˜¯é‡å¤§ç‰ˆæœ¬å‡çº§
   - éœ€è¦å…¨é¢æµ‹è¯•éªŒè¯
   - å¯èƒ½å­˜åœ¨APIå˜æ›´

---

## ğŸ“ é™„å½•

### A. å‚è€ƒæ–‡æ¡£

- [CLAUDE.md - å…¨å±€æ¶æ„æ ‡å‡†](../CLAUDE.md)
- [Spring Boot 4.0.0 Release Notes](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-4.0-Release-Notes)
- [MyBatis-Pluså®˜æ–¹æ–‡æ¡£](https://baomidou.com/)
- [Sa-Tokenå®˜æ–¹æ–‡æ¡£](https://sa-token.cc/)

### B. ç›¸å…³æ–‡ä»¶æ¸…å•

**é…ç½®æ–‡ä»¶**ï¼š
- `pom.xml` - Mavenä¾èµ–é…ç½®
- `ManagerConfiguration.java` - Manager Beané…ç½®
- `AsyncConfiguration.java` - å¼‚æ­¥ä»»åŠ¡é…ç½®
- `OpenApiConfig.java` - APIæ–‡æ¡£é…ç½®
- `RestTemplateConfiguration.java` - HTTPå®¢æˆ·ç«¯é…ç½®

**ä¾èµ–æ¨¡å—**ï¼š
- `microservices-common` - å…¬å…±æ¨¡å—ï¼ˆEntityã€DAOã€Managerï¼‰

### C. å·¥å…·ä¸èµ„æº

**ä½¿ç”¨çš„åˆ†æå·¥å…·**ï¼š
- Serena MCP - ä»£ç è´¨é‡åˆ†æ
- Maven Tools MCP - ä¾èµ–ç‰ˆæœ¬æ£€æŸ¥
- ä»£ç æ·±åº¦æ‰«æ - æ¶æ„åˆè§„æ€§æ£€æŸ¥

**Maven Centralæ£€æŸ¥ç»“æœ**ï¼š
- æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬æ£€æŸ¥å®Œæˆ
- Spring Boot 4.0.0å¯ç”¨
- å…¶ä»–ä¾èµ–å‡ä¸ºæœ€æ–°ç¨³å®šç‰ˆ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-30 16:40:00  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0.0  
**ä¸‹æ¬¡æ›´æ–°å»ºè®®**: å¯åŠ¨ç±»åˆ›å»ºå®Œæˆå
