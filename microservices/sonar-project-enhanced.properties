# ===================================================================
# IOE-DREAM SonarQube 增强配置文件
# 专注于企业级代码质量标准，提高质量门禁要求
# ===================================================================

# ===================================================================
# 项目基本信息配置
# ===================================================================

# 项目唯一标识符
sonar.projectKey=ioedream-microservices-enhanced

# 项目名称
sonar.projectName=IOE-DREAM 智慧园区一卡通管理平台 (增强版)

# 项目版本号
sonar.projectVersion=1.0.0

# 项目描述
sonar.projectDescription=企业级智慧安防管理平台增强质量分析，集成多模态生物识别、一卡通管理、智能门禁等核心功能。基于Spring Boot 3.5.8 + Spring Cloud 2025.0.0的微服务架构。

# ===================================================================
# 源代码配置
# ===================================================================

# 源代码编码格式
sonar.sourceEncoding=UTF-8

# 源代码目录
sonar.sources=src/main/java

# 测试源代码目录
sonar.tests=src/test/java

# 资源文件目录
sonar.resources=src/main/resources

# 测试资源文件目录
sonar.testResources=src/test/resources

# Java版本
sonar.java.source=17
sonar.java.target=17

# ===================================================================
# 代码包含和排除配置（优化版）
# ===================================================================

# 包含的文件模式
sonar.inclusions=**/*.java,**/*.xml,**/*.yml,**/*.yaml,**/*.properties

# 排除的文件和目录（精简版）
sonar.exclusions=\
  **/target/**,\
  **/node_modules/**,\
  **/dist/**,\
  **/build/**,\
  **/out/**,\
  **/.idea/**,\
  **/.vscode/**,\
  **/.git/**,\
  **/*.log,\
  **/*.tmp,\
  **/logs/**,\
  **/temp/**,\
  **/test-output/**,\
  **/generated/**,\
  **/docs/**,\
  **/documentation/**,\
  **/*.md,\
  **/scripts/**,\
  **/*.sh,\
  **/*.ps1,\
  **/*.bat

# 排除的测试文件模式
sonar.test.exclusions=\
  **/target/**,\
  **/build/**,\
  **/out/**,\
  **/logs/**,\
  **/temp/**,\
  **/test-output/**,\
  **/*Test.java,\
  **/*Tests.java,\
  **/integration/**/*Test*.java,\
  **/performance/**/*Test*.java

# ===================================================================
# 代码覆盖率配置（提高标准）
# ===================================================================

# JaCoCo 配置
sonar.jacoco.reportPaths=target/jacoco.exec,target/site/jacoco/jacoco.xml

# 覆盖率排除
sonar.coverage.exclusions=\
  **/*Test*.java,\
  **/test/**,\
  **/integration/**,\
  **/performance/**,\
  **/config/**,\
  **/*Application.java,\
  **/*Config*.java,\
  **/dto/**,\
  **/vo/**,\
  **/form/**,\
  **/entity/**,\
  **/constant/**

# 单元测试包含
sonar.unitTest.inclusions=**/*Test.java

# 集成测试包含
sonar.integrationTest.inclusions=**/integration/**/*Test.java

# ===================================================================
# 质量门禁标准（企业级要求）
# ===================================================================

# 等待质量门禁结果
sonar.qualitygate.wait=true

# 新代码分析周期
sonar.newCodePeriod=30d

# ===================================================================
# 复杂度和可维护性配置
# ===================================================================

# 重复代码检测
sonar.cpd.exclusions=**/*Test*.java,**/test/**,**/integration/**,**/performance/**
sonar.cpd.minimumTokens=50
sonar.cpd.ignoreLiterals=false

# 复杂度阈值（更严格）
sonar.java.metrics.complexityMethodThreshold=15
sonar.java.metrics.complexityClassThreshold=150
sonar.java.metrics.squidComplexityThreshold=80
sonar.java.metrics.nclocDataFunctionThreshold=40

# 认知复杂度（新增）
sonar.java.metrics.cognitiveComplexityMethodThreshold=10
sonar.java.metrics.cognitiveComplexityClassThreshold=100

# ===================================================================
# 安全分析配置（增强版）
# ===================================================================

# 启用安全热点分析
sonar.java.security.hotspots.enabled=true

# 依赖项安全分析
sonar.dependencyCheck.enabled=true
sonar.dependencyCheck.skipProvidedScope=true
sonar.dependencyCheck.skipRuntimeScope=false
sonar.dependencyCheck.skipTestScope=true
sonar.dependencyCheck.failBuildOnCVSS=7

# 安全规则配置
sonar.java.security.jirahub.enabled=false

# ===================================================================
# 技术债务配置
# ===================================================================

# 技术债务计算
sonar.technicalDebt.hoursInDay=8

# 代码行数限制
sonar.size.metric=ncloc

# 技术债务比率阈值
sonar.technicalDebt.ratingGrid=A:0.05;B:0.1;C:0.2;D:0.5

# ===================================================================
# 微服务架构特定配置
# ===================================================================

# 多模块项目配置
sonar.moduleKey=${project.groupId}:${project.artifactId}

# 服务包分析
sonar.java.packageNamingConvention=true

# 分层架构检查
sonar.java.checkPackage=true

# ===================================================================
# 性能配置
# ===================================================================

# 分析超时时间（分钟）
sonar.ws.timeout=600

# 并行分析
sonar.analysis.mode=publish

# 跳过一些耗时的分析以提高速度
sonar.scanner.skipPackageDesign=true

# ===================================================================
# IOE-DREAM 特定配置（增强版）
# ===================================================================

# 四层架构复杂度阈值（更严格）
ioedream.complexity.controller.method.threshold=10
ioedream.complexity.service.method.threshold=15
ioedream.complexity.manager.method.threshold=18
ioedream.complexity.dao.method.threshold=8

# 架构合规性检查
ioedream.architecture.strict.mode=true

# 业务规则验证
ioedream.business.rules.check=true

# API质量检查
ioedream.api.quality.check=true

# 数据库访问质量
ioedream.database.access.quality.check=true

# ===================================================================
# 报告和输出配置
# ===================================================================

# 启用详细报告
sonar.issuesReport.html.enable=true
sonar.issuesReport.json.enable=true

# 报告输出目录
sonar.report.export.path=target/sonar-reports

# 生成可视化报告
sonar.pdf.enable=false

# ===================================================================
# CI/CD 集成配置
# ===================================================================

# Git集成（如果使用Git）
# sonar.scm.provider=git
# sonar.scm.exclusions.disabled=false

# 分支分析
# sonar.branch.name=${env.GIT_BRANCH}
# sonar.branch.target=main

# Pull Request分析
# sonar.pullrequest.provider=github
# sonar.pullrequest.github.repository=your-org/IOE-DREAM
# sonar.pullrequest.key=${env.PR_NUMBER}
# sonar.pullrequest.branch=${env.PR_BRANCH}

# ===================================================================
# 自定义质量配置
# ===================================================================

# 自定义规则集
sonar.issue.ignore.multicriteria=e1,e2,e3,e4,e5

# e1: 忽略测试文件中的某些规则
e1.ruleKey=squid:S00116
e1.resourceKey=**/*Test.java

# e2: 忽略DTO/VO类的某些规则
e2.ruleKey=squid:S1068
e2.resourceKey=**/dto/**,**/vo/**

# e3: 忽略实体类的某些规则
e3.ruleKey=squid:S1155
e3.resourceKey=**/entity/**

# e4: 忽略配置类的某些规则
e4.ruleKey=squid:S1118
e4.resourceKey=**/config/**

# e5: 忽略常量类的某些规则
e5.ruleKey=squid:S1313
e5.resourceKey=**/constant/**