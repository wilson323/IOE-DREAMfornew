package net.lab1024.sa.common.storage;

/**
 * IOE-DREAM 统一文件存储架构说明
 *
 * ============================================================
 * 项目定位: 中小企业智慧园区安防综合管理平台 (5000-10000人)
 * 核心目标: 低内存占用 + 高可扩展性 + 企业级高质量
 * ============================================================
 *
 * 一、架构设计原则
 * ============================================================
 *
 * 1. 策略模式: 通过FileStorageStrategy接口统一不同存储实现
 * 2. 环境变量驱动: 通过file.storage.type配置切换存储方案
 * 3. 默认本地存储: 中小企业推荐,节省1GB内存,运维简单
 * 4. 可选MinIO: 大型企业(>20000人)或多园区部署时升级
 * 5. 自动清理: 定时清理过期文件,节省存储空间
 * 6. 流式处理: 避免文件完全加载到内存,降低内存占用
 *
 * ============================================================
 * 二、存储需求评估 (5000-10000人场景)
 * ============================================================
 *
 * 业务规模:
 * - 正式员工: 3000-6000人
 * - 门禁闸机: 50-100台
 * - 考勤机: 30-60台
 * - 监控摄像头: 200-400个
 * - 日均门禁: 15000次
 * - 日均考勤: 12000次
 *
 * 存储需求:
 * - 日增量: ~60GB/天
 * - 核心存储(90天): 5.5TB
 * - 归档存储(OA 5年): 1.83TB
 * - 建议配置: 8TB可用存储
 *
 * 内存占用:
 * - 应用层: 2.35GB (所有微服务总和)
 * - 中间件: 4GB (MySQL+Redis+Nacos+RabbitMQ)
 * - 总内存: 6.35GB (8GB服务器50%利用率)
 *
 * ============================================================
 * ============================================================
 * 三、业务场景详细分析
 * ============================================================
 *
 * 【门禁服务 - access-service:8090】
 * - 场景1: 门禁通行抓拍 (15000次/天)
 * - 文件: 1-2MB/张 (1920×1080 JPEG)
 * - 日增: 22.7GB/天
 * - 保留: 30天 = 693GB
 * - 场景2: 异常抓拍 (100次/天)
 * - 文件: 2MB/张
 * - 日增: 200MB/天
 * - 保留: 90天 = 18GB
 * - 推荐方案: 本地存储 (频率适中)
 *
 * 【考勤服务 - attendance-service:8091】
 * - 场景: 考勤打卡照片 (12000次/天)
 * - 文件: 1MB/张
 * - 日增: 12GB/天
 * - 保留: 180天 = 2.16TB
 * - 推荐方案: 本地存储 (半年归档)
 *
 * 【视频服务 - video-service:8092】 ✅ 需要Edge
 * - 场景1: 关键帧抓拍 (9000帧/天)
 * - 文件: 2MB/帧
 * - 日增: 18GB/天
 * - 保留: 30天 = 540GB
 * - 场景2: 告警视频片段 (30次/天)
 * - 文件: 50MB/片段 (30秒H.264)
 * - 日增: 1.5GB/天
 * - 保留: 90天 = 135GB
 * - 推荐方案: 本地存储 + Edge AI分析
 *
 * 【消费服务 - consume-service:8094】
 * - 场景: 消费小票 (3000次/天)
 * - 文件: 500KB/张
 * - 日增: 1.5GB/天
 * - 保留: 30天 = 45GB
 * - 推荐方案: 本地存储 (小文件)
 *
 * 【访客服务 - visitor-service:8095】
 * - 场景: 访客登记照片 (50人/天)
 * - 文件: 1.5MB/张
 * - 日增: 75MB/天
 * - 保留: 365天 = 27GB
 * - 推荐方案: 本地存储 (1年归档)
 *
 * 【OA服务 - oa-service:8089】
 * - 场景: 审批附件 (200次/天)
 * - 文件: Word/PDF/Excel, 平均5MB/个
 * - 日增: 1GB/天
 * - 保留: 5年 = 1.83TB
 * - 推荐方案: 本地存储 (长期归档)
 *
 * 【人员管理 - common-service:8088】
 * - 场景1: 人员头像 (10000人)
 * - 文件: 500KB/张
 * - 总存储: 5GB
 * - 场景2: 身份证照片 (10000人)
 * - 文件: 1MB×2(正反面)
 * - 总存储: 20GB
 * - 推荐方案: 本地存储 + CDN加速(头像)
 *
 * ============================================================
 *
 * 【门禁服务 - access-service:8090】
 * - 场景: 门禁通行触发摄像头抓拍
 * - 文件: 抓拍照片 1-2MB/张
 * - 频率: 10000次/天
 * - 存储: 15GB/天,保存30天=450GB
 * - 是否需要Edge? ❌ 不需要 (设备自带AI)
 * - 推荐方案: MinIO (支持URL预签名,减轻服务器压力)
 *
 * 【视频服务 - video-service:8092】
 * - 场景: 视频监控AI分析
 * - 文件: 关键帧截图 + 告警视频片段
 * - 频率: 100个摄像头 × 600MB/天 = 60GB/天
 * - 是否需要Edge? ✅ 需要 (Edge AI盒子实时分析)
 * - 推荐方案: MinIO (分块上传大文件)
 *
 * 【考勤服务 - attendance-service:8091】
 * - 场景: 打卡照片
 * - 文件: 1MB/张
 * - 频率: 5000次/天 = 5GB/天
 * - 推荐方案: MinIO 或 本地存储
 *
 * 【消费服务 - consume-service:8094】
 * - 场景: 消费小票
 * - 文件: 500KB/张
 * - 频率: 1000次/天 = 500MB/天
 * - 推荐方案: 本地存储 或 MinIO
 *
 * 【访客服务 - visitor-service:8095】
 * - 场景: 访客登记照片
 * - 文件: 1.5MB/张
 * - 频率: 200人/天 = 300MB/天
 * - 推荐方案: 本地存储 或 MinIO
 *
 * 【OA服务 - oa-service:8089】
 * - 场景: 工作流审批附件(Word/PDF/Excel/图片)
 * - 文件: 5-20MB/个
 * - 频率: 500次/天 = 5GB/天
 * - 推荐方案: MinIO(支持大文件,需要版本管理)
 *
 * 【设备管理 - 全局】
 * - 场景: 设备上传抓拍照片(门禁联动摄像头/考勤抓拍/视频截图)
 * - 文件: 1-5MB/张
 * - 频率: 20000张/天 = 50GB/天
 * - 推荐方案: MinIO(高频上传,需要CDN加速)
 *
 * 【人员管理 - common-service:8088】
 * - 场景: 人员头像照片
 * - 文件: 200KB-1MB/张
 * - 频率: 新增100人/月 = 3MB/天
 * - 推荐方案: 本地存储 或 MinIO(头像需要快速访问)
 *
 * ============================================================
 * 三、存储方案对比
 * ============================================================
 *
 * 【本地文件系统 - LocalFileStorageImpl】
 * 适用场景:
 *   - 开发测试环境
 *   - 单机部署
 *   - 小规模应用 (<1000张照片/天)
 *
 * 优点:
 *   ✅ 简单快速,无需额外服务
 *   ✅ 内存占用极小 (~50MB)
 *   ✅ 无网络开销
 *
 * 缺点:
 *   ❌ 不支持分布式
 *   ❌ 无法水平扩展
 *   ❌ 需要定期清理
 *
 * 配置示例:
 * ```yaml
 * file:
 *   storage:
 *     type: local
 *     local:
 *       base-path: /data/ioedream/files
 *       url-prefix: http://localhost:8080/files
 * ```
 *
 * 【MinIO对象存储 - MinIOStorageImpl】
 * 适用场景:
 *   - 生产环境
 *   - 分布式部署
 *   - 任意规模应用
 *
 * 优点:
 *   ✅ 支持分布式,可水平扩展
 *   ✅ S3兼容,生态丰富
 *   ✅ 支持预签名URL,设备直传
 *   ✅ 分块上传,支持超大文件
 *   ✅ 数据持久化,高可用
 *
 * 缺点:
 *   ⚠️ 需要独立部署MinIO服务
 *   ⚠️ 内存占用 ~200MB (MinIO独立进程)
 *
 * 配置示例:
 * ```yaml
 * file:
 *   storage:
 *     type: minio
 *     minio:
 *       endpoint: http://minio:9000
 *       access-key: minioadmin
 *       secret-key: minioadmin
 *       bucket-name: ioedream
 * ```
 *
 * 【阿里云OSS - AliyunOSSImpl】
 * 适用场景:
 *   - 公有云部署
 *   - 需要CDN加速
 *
 * 优点:
 *   ✅ 稳定可靠,官方维护
 *   ✅ CDN全球加速
 *   ✅ 自动备份
 *
 * 缺点:
 *   ❌ 按量收费
 *   ❌ 厂商锁定
 *
 * ============================================================
 * 四、内存占用分析
 * ============================================================
 *
 * 【最小内存占用方案】(推荐生产环境)
 *
 * 应用服务器(access-service/video-service等):
 *   - 文件上传: 流式处理,不占用堆内存
 *   - MultipartFile: Tomcat临时文件,磁盘存储
 *   - 预签名URL: 设备直传MinIO,零内存占用
 *   - 估算: 应用服务器文件处理内存 < 100MB
 *
 * MinIO服务器(独立部署):
 *   - 基础内存: ~200MB
 *   - 每个连接: ~2MB
 *   - 100并发: ~400MB
 *   - 推荐配置: 1GB内存
 *
 * 总内存占用:
 *   - 开发环境(local): 应用 + 0 = ~50MB
 *   - 生产环境(minio): 应用100MB + MinIO1GB = ~1.1GB
 *
 * ============================================================
 * 五、部署建议
 * ============================================================
 *
 * 【开发环境】
 * ```bash
 * export FILE_STORAGE_TYPE=local
 * export FILE_LOCAL_BASE_PATH=/tmp/ioedream/files
 * ```
 *
 * 【测试环境】
 * ```bash
 * # 方案1: 本地存储
 * export FILE_STORAGE_TYPE=local
 *
 * # 方案2: MinIO (推荐)
 * docker run -d \
 *   -p 9000:9000 \
 *   -p 9001:9001 \
 *   -e MINIO_ROOT_USER=minioadmin \
 *   -e MINIO_ROOT_PASSWORD=minioadmin123 \
 *   minio/minio server /data --console-address ":9001"
 *
 * export FILE_STORAGE_TYPE=minio
 * export MINIO_ENDPOINT=http://localhost:9000
 * ```
 *
 * 【生产环境】
 * ```bash
 * # 使用MinIO集群
 * export FILE_STORAGE_TYPE=minio
 * export MINIO_ENDPOINT=http://minio-cluster:9000
 * export MINIO_ACCESS_KEY=your-access-key
 * export MINIO_SECRET_KEY=your-secret-key
 * export MINIO_BUCKET=ioedream-prod
 * ```
 *
 * ============================================================
 * 六、Edge边缘计算说明
 * ============================================================
 *
 * 【Edge与文件存储的关系】
 *
 * Edge边缘计算 != 文件存储
 *
 * Edge的职责:
 *   - 视频流实时AI分析(人脸识别/行为检测)
 *   - 在边缘设备完成推理,减少带宽
 *   - 只上传分析结果(JSON) + 关键帧
 *
 * 文件存储的职责:
 *   - 存储Edge上传的关键帧截图
 *   - 存储告警触发的视频片段
 *   - 存储门禁/考勤的抓拍照片
 *
 * 【哪些服务需要Edge?】
 * ✅ video-service: 需要Edge AI盒子(普通摄像头无AI)
 * ❌ access-service: 不需要Edge(门禁设备自带AI)
 * ❌ attendance-service: 不需要Edge(考勤机自带AI)
 * ❌ consume-service: 不需要Edge
 * ❌ visitor-service: 不需要Edge
 *
 * 【Edge模块代码位置】
 * microservices-common/edge/  ← 仅用于video-service
 *   ├── model/      (EdgeDevice, InferenceRequest等)
 *   ├── form/       (表单类)
 *   └── vo/         (VO类)
 *
 * ============================================================
 * 七、最佳实践建议
 * ============================================================
 *
 * 1. 【小规模部署(<5000张照片/天)】
 *    - 使用本地文件系统
 *    - 定时清理过期文件
 *    - 内存占用: ~50MB
 *
 * 2. 【中等规模(5000-50000张照片/天)】
 *    - 使用MinIO单机模式
 *    - 配置1GB内存
 *    - 定期备份
 *
 * 3. 【大规模(>50000张照片/天)】
 *    - 使用MinIO集群模式
 *    - 至少3节点
 *    - 每节点2GB内存
 *    - 配置对象生命周期(自动清理)
 *
 * 4. 【公有云部署】
 *    - 使用阿里云OSS
 *    - 配置CDN加速
 *    - 注意成本控制
 *
 * ============================================================
 * 八、使用示例
 * ============================================================
 *
 * ```java
 * @RestController
 * @RequestMapping("/api/v1/access")
 * public class AccessSnapshotController {
 *
 *     @Resource
 *     private FileStorageStrategy fileStorage; // 自动注入对应实现
 *
 *     @PostMapping("/snapshot/upload")
 *     public ResponseDTO<String> upload(@RequestParam MultipartFile file) {
 *         // 自动根据配置选择存储方式,代码无需修改
 *         String url = fileStorage.uploadFile(file, "access/snapshots");
 *         return ResponseDTO.ok(url);
 *     }
 * }
 * ```
 *
 * ============================================================
 *
 * @author IOE-DREAM Team
 * @since 2025-12-18
 */
public interface FileStorageArchitectureDoc {
    // 此接口仅用于存放架构说明文档,不包含任何方法
}
