# ============================================================
# IOE-DREAM 轻量化数据库性能优化配置
#
# 设计原则:
# 1. 避免过度复杂的连接池配置
# 2. 针对消费业务场景优化
# 3. 最小化资源占用
# 4. 保持高性能响应
# ============================================================

# 数据库连接池配置 - Druid轻量化设置
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.druid.initial-size=5
spring.datasource.druid.min-idle=5
spring.datasource.druid.max-active=20
spring.datasource.druid.max-wait=60000

# 连接验证配置
spring.datasource.druid.validation-query=SELECT 1
spring.datasource.druid.test-while-idle=true
spring.datasource.druid.test-on-borrow=false
spring.datasource.druid.test-on-return=false

# 连接泄露检测 - 轻量化设置
spring.datasource.druid.remove-abandoned=true
spring.datasource.druid.remove-abandoned-timeout=300

# 监控配置 - 仅启用必要功能
spring.datasource.druid.stat-view-servlet.enabled=false
spring.datasource.druid.web-stat-filter.enabled=false
spring.datasource.druid.filter.stat.enabled=true
spring.datasource.druid.filter.stat.log-slow-sql=true
spring.datasource.druid.filter.stat.slow-sql-millis=1000

# Redis缓存配置 - 轻量化设置
spring.data.redis.host=${REDIS_HOST:127.0.0.1}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=0
spring.data.redis.timeout=3000

# 连接池配置
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0
spring.data.redis.lettuce.pool.max-wait=-1ms

# 轻量化缓存设置
spring.data.redis.cache.null-values=false
spring.data.redis.cache.use-key-prefix=true

# MyBatis-Plus性能优化
mybatis-plus.configuration.cache-enabled=true
mybatis-plus.configuration.lazy-loading-enabled=false
mybatis-plus.configuration.multiple-result-sets-enabled=false
mybatis-plus.configuration.use-column-label=true

# 批量操作优化
mybatis-plus.configuration.default-fetch-size=1000
mybatis-plus.configuration.default-statement-timeout=30

# 日志性能优化 - 轻量化配置
logging.level.org.springframework.cache=INFO
logging.level.com.alibaba.druid=WARN
logging.level.com.zaxxer.hikari=INFO

# JVM性能优化参数建议
# -Xms512m -Xmx2g
# -XX:+UseG1GC
# -XX:MaxGCPauseMillis=200
# -XX:+PrintGCDetails
# -XX:+UseStringDeduplication