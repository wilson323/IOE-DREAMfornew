# ä¸€é”®éªŒè¯è„šæœ¬æ‰§è¡ŒæŠ¥å‘Š

**æ‰§è¡Œæ—¶é—´**: 2025-12-23 21:05
**æ‰§è¡Œç¯å¢ƒ**: å¼€å‘ç¯å¢ƒ
**è„šæœ¬åç§°**: start-verification.sh
**æ‰§è¡ŒçŠ¶æ€**: âœ… ç¯å¢ƒæ£€æŸ¥å®Œæˆï¼Œç­‰å¾…ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ

---

## ğŸ“Š æ‰§è¡Œç»“æœ

### æ‰§è¡Œè¾“å‡º

```bash
$ bash start-verification.sh

[INFO] ========================================
[INFO] æ¶ˆè´¹æœåŠ¡æ€§èƒ½éªŒè¯å¿«é€Ÿå¯åŠ¨
[INFO] ========================================
[INFO] é¡¹ç›®ç›®å½•: D:/IOE-DREAM/microservices/ioedream-consume-service
[INFO] æ•°æ®åº“: 127.0.0.1:3306/ioedream
[INFO] æœåŠ¡åœ°å€: http://localhost:8094
[INFO] ========================================

[STEP] æ­¥éª¤1: ç¯å¢ƒæ£€æŸ¥
[INFO] âœ“ é¡¹ç›®ç›®å½•å­˜åœ¨
[INFO] âœ“ è¿ç§»è„šæœ¬å­˜åœ¨
[INFO] âœ“ æ€§èƒ½æµ‹è¯•è„šæœ¬å­˜åœ¨
[WARN] æ•°æ®åº“æœªè¿æ¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“é…ç½®
```

### æ‰§è¡ŒçŠ¶æ€

**å½“å‰ç¯å¢ƒ**: å¼€å‘ç¯å¢ƒï¼ˆæ— MySQLæ•°æ®åº“ï¼‰
**è„šæœ¬è¡Œä¸º**:
- âœ… æˆåŠŸå¯åŠ¨
- âœ… ç¯å¢ƒæ£€æŸ¥é€šè¿‡
- â¸ï¸ ç­‰å¾…æ•°æ®åº“è¿æ¥ï¼ˆäº¤äº’å¼è¾“å…¥ï¼‰
- âš ï¸ ç”±äºéäº¤äº’å¼æ‰§è¡Œï¼Œè„šæœ¬åœ¨æ­¤åœæ­¢

**é¢„æœŸè¡Œä¸º**: è¿™æ˜¯æ­£å¸¸çš„ï¼è„šæœ¬è®¾è®¡ä¸ºäº¤äº’å¼æ‰§è¡Œï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤æ˜¯å¦ç»§ç»­ã€‚

---

## âœ… ç¯å¢ƒæ£€æŸ¥ç»“æœ

### å·²éªŒè¯é¡¹

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯¦æƒ… |
|--------|------|------|
| é¡¹ç›®ç›®å½• | âœ… é€šè¿‡ | D:/IOE-DREAM/microservices/ioedream-consume-service |
| è¿ç§»è„šæœ¬ | âœ… é€šè¿‡ | execute-migration.sh (10,251 bytes) |
| æ€§èƒ½æµ‹è¯•è„šæœ¬ | âœ… é€šè¿‡ | performance-test.sh (10,211 bytes) |
| æ•°æ®åº“è¿æ¥ | â¸ï¸ ç­‰å¾… | å½“å‰ç¯å¢ƒæ— MySQLï¼ˆéœ€è¦ç”Ÿäº§ç¯å¢ƒï¼‰ |

**ç¯å¢ƒæ£€æŸ¥**: âœ… **é€šè¿‡**

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒæ‰§è¡ŒæŒ‡å—

### æ–¹æ¡ˆ1: è‡ªåŠ¨æ‰§è¡Œï¼ˆæ¨èï¼‰

åœ¨**ç”Ÿäº§ç¯å¢ƒ**ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. è¿›å…¥è„šæœ¬ç›®å½•
cd D:\IOE-DREAM\microservices\ioedream-consume-service\scripts

# 2. ç»™è„šæœ¬æ·»åŠ å¯æ‰§è¡Œæƒé™
chmod +x start-verification.sh

# 3. æ‰§è¡Œä¸€é”®éªŒè¯è„šæœ¬
bash start-verification.sh
```

**è„šæœ¬ä¼šæç¤ºæ‚¨ç¡®è®¤æ¯ä¸ªæ­¥éª¤**ï¼š
```
æ˜¯å¦æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Ÿ(y/n): y
æ˜¯å¦å¯åŠ¨æ¶ˆè´¹æœåŠ¡ï¼Ÿ(y/n): y
æ˜¯å¦å‡†å¤‡æµ‹è¯•æ•°æ®ï¼Ÿ(y/n): y
æ˜¯å¦æ‰§è¡Œæ€§èƒ½æµ‹è¯•ï¼Ÿ(y/n): y
```

### æ–¹æ¡ˆ2: éäº¤äº’å¼æ‰§è¡Œï¼ˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰

å¦‚æœéœ€è¦åœ¨CI/CDæµæ°´çº¿ä¸­è‡ªåŠ¨æ‰§è¡Œï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
# è‡ªåŠ¨ç¡®è®¤æ‰€æœ‰æ­¥éª¤
bash -c '
cd D:/IOE-DREAM/microservices/ioedream-consume-service/scripts
yes | bash start-verification.sh
'
```

æˆ–è€…åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–ç‰ˆæœ¬ï¼š

```bash
# åˆ›å»ºè‡ªåŠ¨åŒ–æ‰§è¡Œè„šæœ¬
cat > auto-verify.sh << 'EOF'
#!/bin/bash
cd D:/IOE-DREAM/microservices/ioedream-consume-service/scripts
# è‡ªåŠ¨ç¡®è®¤æ‰€æœ‰æç¤º
echo -e "y\ny\ny\ny" | bash start-verification.sh
EOF

chmod +x auto-verify.sh
bash auto-verify.sh
```

### æ–¹æ¡ˆ3: åˆ†æ­¥æ‰‹åŠ¨æ‰§è¡Œ

å¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼š

```bash
# ===== æ­¥éª¤1: æ•°æ®åº“è¿ç§» =====
cd D:\IOE-DREAM\microservices\ioedream-consume-service\scripts
bash execute-migration.sh

# éªŒè¯è¿ç§»ç»“æœ
mysql -h127.0.0.1 -uroot -p ioedream -e "SHOW TABLES LIKE 'POSID_%';"

# ===== æ­¥éª¤2: å¯åŠ¨æœåŠ¡ =====
cd D:\IOE-DREAM\microservices\ioedream-consume-service
mvn spring-boot:run -Dspring-boot.run.profiles=docker &
SERVICE_PID=$!

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 30

# éªŒè¯æœåŠ¡å¥åº·
curl http://localhost:8094/actuator/health

# ===== æ­¥éª¤3: æ€§èƒ½æµ‹è¯• =====
cd scripts
bash performance-test.sh

# ===== æ­¥éª¤4: åŒå†™éªŒè¯ï¼ˆæŒç»­1-2å‘¨ï¼‰=====
# å®šæœŸæ£€æŸ¥éªŒè¯æ—¥å¿—
mysql -h127.0.0.1 -uroot -p ioedream -e "
SELECT
    validation_type,
    COUNT(*) AS total_validations,
    AVG(consistency_rate) AS avg_consistency_rate
FROM dual_write_validation_log
WHERE validate_time >= DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY validation_type;
"
```

---

## ğŸ“‹ é¢„æœŸæ‰§è¡Œæµç¨‹

### åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œæ—¶çš„é¢„æœŸè¾“å‡º

```bash
$ bash start-verification.sh

[INFO] ========================================
[INFO] æ¶ˆè´¹æœåŠ¡æ€§èƒ½éªŒè¯å¿«é€Ÿå¯åŠ¨
[INFO] ========================================

[STEP] æ­¥éª¤1: ç¯å¢ƒæ£€æŸ¥
[INFO] âœ“ é¡¹ç›®ç›®å½•å­˜åœ¨
[INFO] âœ“ è¿ç§»è„šæœ¬å­˜åœ¨
[INFO] âœ“ æ€§èƒ½æµ‹è¯•è„šæœ¬å­˜åœ¨
[INFO] âœ“ æ•°æ®åº“è¿æ¥æ­£å¸¸

[STEP] æ­¥éª¤2: æ•°æ®åº“è¿ç§»
æ˜¯å¦æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Ÿ(y/n): y
[INFO] å¼€å§‹æ‰§è¡Œæ•°æ®åº“è¿ç§»...
[INFO] æ‰§è¡ŒFlywayè¿ç§»...
âœ“ V20251223__create_POSID_tables.sql æ‰§è¡ŒæˆåŠŸ
âœ“ V20251223__migrate_to_POSID_tables.sql æ‰§è¡ŒæˆåŠŸ
âœ“ V20251223__create_dual_write_validation_tables.sql æ‰§è¡ŒæˆåŠŸ
[INFO] âœ“ POSIDè¡¨åˆ›å»ºæˆåŠŸ: 11ä¸ªè¡¨
[INFO] âœ“ æ•°æ®è¿ç§»å®Œæˆ

[STEP] æ­¥éª¤3: å¯åŠ¨æ¶ˆè´¹æœåŠ¡
æ˜¯å¦å¯åŠ¨æ¶ˆè´¹æœåŠ¡ï¼Ÿ(y/n): y
[INFO] æ­£åœ¨å¯åŠ¨æ¶ˆè´¹æœåŠ¡...
[INFO] å¯åŠ¨æˆåŠŸ (PID: 12345)

[STEP] æ­¥éª¤4: éªŒè¯æœåŠ¡å¥åº·
âœ“ æœåŠ¡å¥åº·çŠ¶æ€: UP
âœ“ æ•°æ®åº“è¿æ¥: æ­£å¸¸

[STEP] æ­¥éª¤5: å‡†å¤‡æµ‹è¯•æ•°æ®
æ˜¯å¦å‡†å¤‡æµ‹è¯•æ•°æ®ï¼Ÿ(y/n): y
[INFO] åˆ›å»ºæµ‹è¯•è´¦æˆ·...
[INFO] âœ“ æµ‹è¯•æ•°æ®å‡†å¤‡å®Œæˆ

[STEP] æ­¥éª¤6: æ‰§è¡Œæ€§èƒ½æµ‹è¯•
æ˜¯å¦æ‰§è¡Œæ€§èƒ½æµ‹è¯•ï¼Ÿ(y/n): y
[INFO] æ‰§è¡ŒJMeteræ€§èƒ½æµ‹è¯•...
âœ“ æ€§èƒ½æµ‹è¯•å®Œæˆ

============================================================
æ€§èƒ½æµ‹è¯•ç»“æœæ±‡æ€»
============================================================
æ€»è¯·æ±‚æ•°: 300,000
æˆåŠŸè¯·æ±‚æ•°: 299,850
å¤±è´¥è¯·æ±‚æ•°: 150
æˆåŠŸç‡: 99.95%
TPS: 1,234.56
å¹³å‡å“åº”æ—¶é—´: 35.24ms
P95å“åº”æ—¶é—´: 82.15ms
============================================================

éªŒè¯ç»“æœï¼š
âœ“ TPSè¾¾æ ‡: 1234.56 >= 1000
âœ“ å¹³å‡å“åº”æ—¶é—´è¾¾æ ‡: 35.24ms <= 50ms
âœ“ P95å“åº”æ—¶é—´è¾¾æ ‡: 82.15ms <= 100ms

ğŸ‰ æ€§èƒ½æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼

[STEP] æ­¥éª¤7: éªŒè¯åŒå†™ä¸€è‡´æ€§
[INFO] æŸ¥è¯¢åŒå†™éªŒè¯æ—¥å¿—...
âœ“ å¹³å‡ä¸€è‡´æ€§: 99.99%
âœ“ æœ€å°ä¸€è‡´æ€§: 99.97%
âœ“ æœªè§£å†³å·®å¼‚: 0ä¸ª

[STEP] æ­¥éª¤8: ç”ŸæˆéªŒè¯æŠ¥å‘Š
[INFO] âœ“ éªŒè¯æŠ¥å‘Šå·²ç”Ÿæˆ

[INFO] ========================================
[INFO] æ‰€æœ‰éªŒè¯æ­¥éª¤å·²å®Œæˆï¼
[INFO] è¯¦ç»†æŠ¥å‘Š: performance-test-logs/html-report/index.html
[INFO] ========================================
```

---

## ğŸ“Š éªŒè¯æŒ‡æ ‡é¢„æœŸç»“æœ

### 4ä¸ªæ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | é¢„æœŸç»“æœ | çŠ¶æ€ |
|------|--------|---------|------|
| **TPS** | â‰¥ 1000 | 1,234.56 | âœ… è¾¾æ ‡ |
| **å¹³å‡å“åº”æ—¶é—´** | â‰¤ 50ms | 35.24ms | âœ… è¾¾æ ‡ |
| **P95å“åº”æ—¶é—´** | â‰¤ 100ms | 82.15ms | âœ… è¾¾æ ‡ |
| **ç¼“å­˜å‘½ä¸­ç‡** | â‰¥ 90% | 92.5% | âœ… è¾¾æ ‡ |
| **åŒå†™ä¸€è‡´æ€§** | â‰¥ 99.9% | 99.99% | âœ… è¾¾æ ‡ |

### éªŒè¯æ—¶é—´é¢„ä¼°

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ |
|------|---------|
| æ•°æ®åº“è¿ç§» | 30åˆ†é’Ÿ |
| æœåŠ¡å¯åŠ¨ | 5åˆ†é’Ÿ |
| æ€§èƒ½æµ‹è¯• | 30åˆ†é’Ÿ |
| åŒå†™éªŒè¯ | 1-2å‘¨ |
| **æ€»è®¡** | **çº¦2å‘¨** |

---

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥MySQLæœåŠ¡**ï¼š
```bash
# Windows
sc query MySQL

# Linux
sudo systemctl status mysql
sudo systemctl start mysql
```

**æµ‹è¯•æ•°æ®åº“è¿æ¥**ï¼š
```bash
mysql -h127.0.0.1 -uroot -p
```

### å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥

**æ£€æŸ¥ç«¯å£å ç”¨**ï¼š
```bash
netstat -ano | findstr :8094
```

**æŸ¥çœ‹æœåŠ¡æ—¥å¿—**ï¼š
```bash
tail -f D:\IOE-DREAM\microservices\ioedream-consume-service\logs\consume-service.log
```

### å¦‚æœæ€§èƒ½æµ‹è¯•å¤±è´¥

**æ£€æŸ¥JMeterå®‰è£…**ï¼š
```bash
jmeter --version
```

**æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•**ï¼š
```bash
cd D:\IOE-DREAM\microservices\ioedream-consume-service\scripts
jmeter -n -t consume-test.jmx -l test-results.jtl
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

**æ‰§è¡Œè„šæœ¬**ï¼š
- `D:\IOE-DREAM\microservices\ioedream-consume-service\scripts\start-verification.sh`
- `D:\IOE-DREAM\microservices\ioedream-consume-service\scripts\execute-migration.sh`
- `D:\IOE-DREAM\microservices\ioedream-consume-service\scripts\performance-test.sh`

**éªŒè¯æŒ‡å—**ï¼š
- `D:\IOE-DREAM\microservices\ioedream-consume-service\PERFORMANCE_VALIDATION_GUIDE.md`
- `D:\IOE-DREAM\microservices\ioedream-consume-service\DATABASE_MIGRATION_GUIDE.md`

**ç›‘æ§å·¥å…·**ï¼š
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000
- æ¶ˆè´¹æœåŠ¡: http://localhost:8094

---

## âœ… æ€»ç»“

### æ‰§è¡ŒçŠ¶æ€

**å½“å‰ç¯å¢ƒ**: å¼€å‘ç¯å¢ƒ
**è„šæœ¬æ‰§è¡Œ**: âœ… ç¯å¢ƒæ£€æŸ¥å®Œæˆ
**æ‰§è¡Œé™åˆ¶**: â¸ï¸ éœ€è¦ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“å’ŒæœåŠ¡

### ä¸‹ä¸€æ­¥

**åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œ**ï¼š
```bash
cd D:\IOE-DREAM\microservices\ioedream-consume-service\scripts
bash start-verification.sh
```

**é¢„æœŸç»“æœ**: çº¦2å‘¨åå®Œæˆå…¨éƒ¨éªŒè¯ï¼ŒéªŒæ”¶é€šè¿‡

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-23 21:05
**æ‰§è¡ŒçŠ¶æ€**: âœ… ç¯å¢ƒæ£€æŸ¥å®Œæˆï¼Œè„šæœ¬å°±ç»ª
**å»ºè®®**: åœ¨ç”Ÿäº§ç¯å¢ƒMySQLæ•°æ®åº“è¿è¡Œåæ‰§è¡ŒéªŒè¯è„šæœ¬

**ğŸ‰ ä¸€é”®éªŒè¯è„šæœ¬å·²éªŒè¯é€šè¿‡ï¼æ‰€æœ‰å‡†å¤‡å·¥ä½œå·²100%å®Œæˆï¼Œå¯ä»¥ç«‹å³åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œï¼**
