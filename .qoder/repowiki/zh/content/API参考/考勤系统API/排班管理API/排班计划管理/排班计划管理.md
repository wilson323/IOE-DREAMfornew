# 排班计划管理

<cite>
**本文档引用的文件**   
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)
- [考勤前端原型布局\排班管理功能布局文档_完整版.md](file://documentation\03-业务模块\考勤\考勤前端原型布局\排班管理功能布局文档_完整版.md)
- [AttendanceScheduleController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_AttendanceScheduleController.java)
- [ShiftsController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_ShiftsController.java)
</cite>

## 目录
1. [简介](#简介)
2. [核心数据结构](#核心数据结构)
3. [排班计划API接口](#排班计划api接口)
4. [排班计划与班次配置关联](#排班计划与班次配置关联)
5. [特殊场景处理](#特殊场景处理)
6. [新员工排班计划继承](#新员工排班计划继承)
7. [排班计划与考勤记录关联](#排班计划与考勤记录关联)
8. [前端可视化展示](#前端可视化展示)

## 简介
排班计划管理功能是考勤系统的核心模块，负责管理员工的排班安排。该功能支持为单个员工、部门或全公司批量设置排班计划，提供灵活的排班策略和自动化排班能力。系统通过排班模板实现标准化排班配置，支持临时调班等特殊场景，并与考勤记录生成机制紧密关联，确保考勤数据的准确性和完整性。

**Section sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

## 核心数据结构
排班计划管理功能涉及三个核心数据表：排班记录表、排班模板表和临时排班覆盖表。这些表通过员工、班次和部门等实体建立关联，形成完整的排班管理体系。

```mermaid
erDiagram
schedule_records {
bigint id PK
bigint employee_id FK
date schedule_date
bigint shift_id FK
varchar schedule_type
tinyint is_temporary
text reason
tinyint status
datetime create_time
datetime update_time
}
schedule_templates {
bigint id PK
varchar template_name
varchar template_type
bigint department_id FK
json template_config_json
tinyint status
datetime create_time
datetime update_time
}
schedule_overrides {
bigint id PK
bigint employee_id FK
date schedule_date
bigint shift_id FK
bigint period_id FK
time start_time
time end_time
varchar source
int priority
text reason
tinyint status
datetime create_time
datetime update_time
}
employees ||--o{ schedule_records : "employee_id"
employees ||--o{ schedule_overrides : "employee_id"
shifts ||--o{ schedule_records : "shift_id"
shifts ||--o{ schedule_overrides : "shift_id"
departments ||--o{ schedule_templates : "department_id"
time_periods ||--o{ schedule_overrides : "period_id"
```

**Diagram sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

**Section sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

## 排班计划API接口
排班计划管理功能提供了一套完整的RESTful API接口，支持创建、查询、更新和删除排班计划。这些接口遵循统一的响应格式和权限控制机制，确保系统的安全性和一致性。

### 排班记录接口
排班记录接口用于管理单个员工的排班计划，支持基本的CRUD操作和批量操作。

```mermaid
sequenceDiagram
participant 前端 as 前端应用
participant 网关 as API网关
participant 考勤服务 as 考勤服务
participant 数据库 as 数据库
前端->>网关 : POST /api/attendance/schedules
网关->>考勤服务 : 转发创建排班请求
考勤服务->>数据库 : 保存排班记录
数据库-->>考勤服务 : 返回保存结果
考勤服务-->>网关 : 返回响应
网关-->>前端 : 返回创建结果
```

**Diagram sources**
- [AttendanceScheduleController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_AttendanceScheduleController.java)

### 排班模板接口
排班模板接口用于管理排班模板，支持模板的创建、更新、应用和复制等操作。

```mermaid
sequenceDiagram
participant 前端 as 前端应用
participant 网关 as API网关
participant 考勤服务 as 考勤服务
participant 数据库 as 数据库
前端->>网关 : POST /api/attendance/schedules/templates
网关->>考勤服务 : 转发创建模板请求
考勤服务->>数据库 : 保存模板配置
数据库-->>考勤服务 : 返回保存结果
考勤服务-->>网关 : 返回响应
网关-->>前端 : 返回创建结果
```

**Diagram sources**
- [AttendanceScheduleController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_AttendanceScheduleController.java)

### 临时排班接口
临时排班接口用于处理临时调班等特殊场景，支持临时排班的创建、更新和删除。

```mermaid
sequenceDiagram
participant 前端 as 前端应用
participant 网关 as API网关
participant 考勤服务 as 考勤服务
participant 数据库 as 数据库
前端->>网关 : POST /api/attendance/schedules/overrides
网关->>考勤服务 : 转发创建临时排班请求
考勤服务->>数据库 : 保存临时排班记录
数据库-->>考勤服务 : 返回保存结果
考勤服务-->>网关 : 返回响应
网关-->>前端 : 返回创建结果
```

**Diagram sources**
- [AttendanceScheduleController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_AttendanceScheduleController.java)

**Section sources**
- [AttendanceScheduleController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_AttendanceScheduleController.java)

## 排班计划与班次配置关联
排班计划与班次配置通过班次ID建立关联关系。每个排班记录都关联一个具体的班次配置，该配置定义了工作时间、休息时间、考勤规则等详细信息。

```mermaid
classDiagram
class ScheduleRecord {
+long scheduleId
+long employeeId
+Date scheduleDate
+long shiftId
+String scheduleType
+boolean isTemporary
+String reason
+int status
+Date createTime
+Date updateTime
}
class ShiftConfig {
+long shiftId
+String shiftName
+String shiftCode
+String shiftType
+String cycleUnit
+int cycleCount
+double flexibleHours
+double coreHours
+String shiftConfigJson
+int status
+Date createTime
+Date updateTime
}
ScheduleRecord --> ShiftConfig : "关联班次配置"
```

**Diagram sources**
- [ShiftsController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_ShiftsController.java)

**Section sources**
- [ShiftsController.java](file://restful_refactor_backup_20251202_014224\microservices_ioedream-attendance-service_src_main_java_net_lab1024_sa_attendance_controller_ShiftsController.java)

## 特殊场景处理
排班计划管理功能需要处理跨月排班、临时调班等特殊场景，确保排班计划的灵活性和准确性。

### 跨月排班处理
跨月排班通过将排班周期分解为多个单月排班计划来处理。系统会自动识别跨月情况，并生成相应的排班记录。

```mermaid
flowchart TD
开始[开始排班设置] --> 输入[输入排班周期]
输入 --> 判断{是否跨月?}
判断 --> |是| 分解[分解为单月排班]
判断 --> |否| 直接生成[直接生成排班]
分解 --> 生成[生成各月排班记录]
直接生成 --> 生成
生成 --> 保存[保存排班记录]
保存 --> 结束[完成]
```

**Diagram sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

### 临时调班处理
临时调班通过临时排班覆盖表实现，具有更高的优先级。当临时排班与正常排班冲突时，系统会优先采用临时排班。

```mermaid
flowchart TD
开始[临时调班请求] --> 验证[验证员工和日期]
验证 --> 检查{是否存在正常排班?}
检查 --> |是| 覆盖[创建临时排班覆盖]
检查 --> |否| 创建[创建临时排班]
覆盖 --> 设置[设置高优先级]
创建 --> 设置
设置 --> 保存[保存临时排班]
保存 --> 通知[通知相关人员]
通知 --> 结束[完成]
```

**Diagram sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

**Section sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

## 新员工排班计划继承
新员工入职时，系统会自动继承其所在部门的排班计划。这一过程通过部门排班模板实现，确保新员工能够快速融入团队工作安排。

```mermaid
sequenceDiagram
participant HR as 人力资源系统
participant 考勤服务 as 考勤服务
participant 数据库 as 数据库
HR->>考勤服务 : 新员工入职通知
考勤服务->>数据库 : 查询部门排班模板
数据库-->>考勤服务 : 返回模板信息
考勤服务->>数据库 : 创建员工排班记录
数据库-->>考勤服务 : 返回创建结果
考勤服务-->>HR : 返回处理结果
```

**Diagram sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

**Section sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

## 排班计划与考勤记录关联
排班计划与考勤记录生成机制紧密关联。系统根据排班计划生成考勤记录模板，并在考勤周期结束后进行数据核对和统计分析。

```mermaid
classDiagram
class ScheduleRecord {
+long scheduleId
+long employeeId
+Date scheduleDate
+long shiftId
+String scheduleType
+boolean isTemporary
+String reason
+int status
+Date createTime
+Date updateTime
}
class AttendanceRecord {
+long recordId
+long employeeId
+Date recordDate
+String punchInTime
+String punchOutTime
+String status
+String remarks
+Date createTime
+Date updateTime
}
class ShiftConfig {
+long shiftId
+String shiftName
+String shiftCode
+String shiftType
+String cycleUnit
+int cycleCount
+double flexibleHours
+double coreHours
+String shiftConfigJson
+int status
+Date createTime
+Date updateTime
}
ScheduleRecord --> AttendanceRecord : "生成"
ScheduleRecord --> ShiftConfig : "关联"
AttendanceRecord --> ShiftConfig : "验证"
```

**Diagram sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

**Section sources**
- [排班管理.md](file://documentation\03-业务模块\各业务模块文档\考勤\排班管理.md)

## 前端可视化展示
排班计划在前端通过日历视图进行可视化展示，支持月视图、周视图和日视图等多种展示方式。用户可以通过拖拽操作进行排班调整，并实时查看排班冲突。

```mermaid
flowchart TD
日历视图[日历视图] --> 月视图[月视图]
日历视图 --> 周视图[周视图]
日历视图 --> 日视图[日视图]
月视图 --> 拖拽[拖拽排班]
周视图 --> 拖拽
日视图 --> 拖拽
拖拽 --> 冲突检测[冲突检测]
冲突检测 --> 提示[冲突提示]
提示 --> 调整[调整排班]
调整 --> 保存[保存排班]
```

**Diagram sources**
- [考勤前端原型布局\排班管理功能布局文档_完整版.md](file://documentation\03-业务模块\考勤\考勤前端原型布局\排班管理功能布局文档_完整版.md)

**Section sources**
- [考勤前端原型布局\排班管理功能布局文档_完整版.md](file://documentation\03-业务模块\考勤\考勤前端原型布局\排班管理功能布局文档_完整版.md)