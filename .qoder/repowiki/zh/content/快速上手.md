# 快速上手

<cite>
**本文档引用的文件**  
- [README.md](file://README.md)
- [pom.xml](file://microservices/pom.xml)
- [docker-compose-services.yml](file://docker-compose-services.yml)
- [start-all-services.ps1](file://scripts/start-all-services.ps1)
- [test-startup.ps1](file://scripts/test-startup.ps1)
- [README_BUILD.md](file://scripts/README_BUILD.md)
- [.env.development](file://smart-admin-web-javascript/.env.development)
- [.env.production](file://smart-admin-web-javascript/.env.production)
- [ENVIRONMENT_VARIABLES.md](file://documentation/deployment/ENVIRONMENT_VARIABLES.md)
- [package.json](file://smart-admin-web-javascript/package.json)
- [package.json](file://smart-app/package.json)
</cite>

## 目录
1. [简介](#简介)
2. [开发环境准备](#开发环境准备)
3. [项目依赖安装](#项目依赖安装)
4. [服务启动](#服务启动)
5. [功能验证](#功能验证)
6. [常见问题与解决方案](#常见问题与解决方案)
7. [总结](#总结)

## 简介

本指南旨在帮助新开发者快速搭建IOE-DREAM项目的开发环境并成功运行。项目采用微服务架构，包含多个后端服务和前端应用，涉及Java、JavaScript、MySQL、Redis、Nacos等技术栈。通过本指南，您将能够完成环境配置、依赖安装、服务启动和基础功能验证。

**Section sources**
- [README.md](file://README.md)

## 开发环境准备

### JDK 17 安装

根据项目根目录下的 `pom.xml` 文件，项目要求使用Java 17：

```xml
<properties>
    <maven.compiler.source>17</maven.compiler.source>
    <maven.compiler.target>17</maven.compiler.target>
    <java.version>17</java.version>
</properties>
```

请确保已安装JDK 17，并配置JAVA_HOME环境变量。

### Node.js 安装

前端项目位于 `smart-admin-web-javascript` 和 `smart-app` 目录下，根据 `package.json` 文件，Node.js版本要求如下：

- `smart-admin-web-javascript` 要求 Node.js >=18
- `smart-app` 未明确指定版本，建议使用LTS版本

### MySQL 安装与配置

创建数据库并导入初始化脚本：
1. 创建名为 `ioedream_db` 的数据库
2. 执行 `database-scripts/common-service/` 目录下的SQL脚本进行表结构初始化
3. 确保MySQL服务运行在默认端口3306

### Redis 安装

使用Docker快速启动Redis服务，项目提供了 `docker-compose-services.yml` 配置：

```yaml
redis:
  image: redis:7-alpine
  container_name: ioedream-redis
  ports:
    - "6379:6379"
```

执行命令启动Redis：
```bash
docker-compose -f docker-compose-services.yml up -d redis
```

### Nacos 安装

Nacos作为配置中心，同样通过Docker部署：

```yaml
nacos:
  image: nacos/nacos-server:v2.3.0
  container_name: ioedream-nacos
  ports:
    - "8848:8848"
```

启动Nacos服务：
```bash
docker-compose -f docker-compose-services.yml up -d nacos
```

### 环境变量配置

根据 `documentation/deployment/ENVIRONMENT_VARIABLES.md` 文件，需要配置以下关键环境变量：

```bash
# 数据库配置
DB_URL=jdbc:mysql://localhost:3306/ioedream_db?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
DB_USERNAME=root
DB_PASSWORD=your_secure_password_here

# Redis配置
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# Nacos配置
NACOS_SERVER_ADDR=127.0.0.1:8848
NACOS_NAMESPACE=dev
NACOS_GROUP=IOE-DREAM
NACOS_PASSWORD=nacos

# JWT配置
JWT_SECRET=your_jwt_secret_key_at_least_256_bits
SA_JWT_SECRET=your_satoken_secret_key
```

**Section sources**
- [pom.xml](file://microservices/pom.xml#L16-L21)
- [docker-compose-services.yml](file://docker-compose-services.yml#L5-L33)
- [ENVIRONMENT_VARIABLES.md](file://documentation/deployment/ENVIRONMENT_VARIABLES.md#L1-L107)

## 项目依赖安装

### 后端依赖安装

项目使用Maven进行依赖管理，根目录的 `pom.xml` 文件定义了所有微服务模块：

```xml
<modules>
    <module>microservices-common</module>
    <module>ioedream-gateway-service</module>
    <module>ioedream-common-service</module>
    <!-- 其他服务... -->
</modules>
```

使用提供的构建脚本安装依赖：

```bash
# 构建所有服务
.\scripts\build-all.ps1

# 或构建指定服务
.\scripts\build-all.ps1 -Service ioedream-access-service
```

### 前端依赖安装

进入前端项目目录安装NPM依赖：

```bash
# 安装主前端应用依赖
cd smart-admin-web-javascript
npm install

# 安装移动端应用依赖
cd ../smart-app
npm install
```

**Section sources**
- [pom.xml](file://microservices/pom.xml#L117-L128)
- [README_BUILD.md](file://scripts/README_BUILD.md#L1-L98)
- [package.json](file://smart-admin-web-javascript/package.json)
- [package.json](file://smart-app/package.json)

## 服务启动

### 后端微服务启动

使用提供的PowerShell脚本按依赖顺序启动所有微服务：

```bash
# 检查服务状态
.\scripts\start-all-services.ps1 -CheckOnly

# 启动所有服务
.\scripts\start-all-services.ps1
```

脚本会按照以下顺序启动服务：
1. 基础设施服务（配置服务、网关服务）
2. 公共模块服务
3. 认证和身份服务
4. 业务服务（门禁、考勤、消费等）

### 前端应用启动

启动前端开发服务器：

```bash
# 启动Web前端
cd smart-admin-web-javascript
npm run dev

# 启动移动端开发服务器
cd ../smart-app
npm run dev:h5
```

前端应用的API地址配置在环境变量文件中，如 `.env.development`：

```bash
VITE_APP_API_URL='http://127.0.0.1:1024'
```

**Section sources**
- [start-all-services.ps1](file://scripts/start-all-services.ps1#L1-L99)
- [.env.development](file://smart-admin-web-javascript/.env.development#L1-L3)
- [.env.development](file://smart-app/.env.development#L1-L4)

## 功能验证

### API接口调用演示

服务启动后，可以通过以下步骤验证基础功能：

1. 访问前端页面：`http://localhost:3000`（Vite默认端口）
2. 使用Postman或curl调用健康检查API：

```bash
curl -X GET http://127.0.0.1:1024/health
```

预期返回：
```json
{
  "status": "UP",
  "details": {
    "db": "connected",
    "redis": "connected"
  }
}
```

3. 验证用户登录接口：

```bash
curl -X POST http://127.0.0.1:1024/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password"}'
```

### 启动验证脚本

使用提供的测试脚本验证环境配置：

```bash
.\scripts\test-startup.ps1
```

该脚本会检查：
- Maven是否安装
- microservices-common目录是否存在
- Nacos、MySQL、Redis服务是否运行
- 所有微服务目录是否存在

**Section sources**
- [test-startup.ps1](file://scripts/test-startup.ps1#L1-L95)

## 常见问题与解决方案

### 端口冲突

**问题**：服务启动时提示端口被占用。

**解决方案**：
1. 检查端口占用情况：
   ```bash
   # Windows
   netstat -ano | findstr :8080
   
   # Linux/Mac
   lsof -i :8080
   ```
2. 修改服务端口配置，在 `ENVIRONMENT_VARIABLES.md` 中调整相应服务的端口变量
3. 终止占用端口的进程

### 依赖下载失败

**问题**：Maven依赖下载失败或超时。

**解决方案**：
1. 配置Maven镜像源，在 `settings.xml` 中添加阿里云镜像：
   ```xml
   <mirror>
     <id>aliyunmaven</id>
     <mirrorOf>*</mirrorOf>
     <name>阿里云公共仓库</name>
     <url>https://maven.aliyun.com/repository/public</url>
   </mirror>
   ```
2. 清理本地仓库缓存：
   ```bash
   mvn dependency:purge-local-repository
   ```
3. 使用脚本强制重新下载：
   ```bash
   .\scripts\force-download-dependencies.ps1
   ```

### PowerShell脚本执行策略

**问题**：PowerShell脚本无法执行，提示执行策略限制。

**解决方案**：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Nacos连接失败

**问题**：微服务无法连接Nacos配置中心。

**解决方案**：
1. 确认Nacos服务已启动：`docker ps | grep nacos`
2. 检查Nacos地址配置：`NACOS_SERVER_ADDR=127.0.0.1:8848`
3. 验证网络连接：`telnet 127.0.0.1 8848`

**Section sources**
- [ENVIRONMENT_VARIABLES.md](file://documentation/deployment/ENVIRONMENT_VARIABLES.md#L1-L107)
- [docker-compose-services.yml](file://docker-compose-services.yml#L1-L41)

## 总结

通过本指南，您已经完成了IOE-DREAM项目的环境搭建、依赖安装、服务启动和基础验证。项目采用现代化的微服务架构，结合Spring Boot 3、Vue3等技术栈，提供了完整的开发环境配置方案。建议在开发过程中参考项目提供的各种文档和检查清单，确保遵循最佳实践。