<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.lab1024.sa.base.module.support.rbac.dao.EmployeeDeptDao">

    <!-- 根据员工ID查询部门ID列表（包含直接部门和上级部门） -->
    <select id="getDepartmentIdsByEmployeeId" resultType="java.lang.Long">
        SELECT DISTINCT d.department_id
        FROM t_hr_employee e
        INNER JOIN t_department d ON e.department_id = d.department_id
        WHERE e.employee_id = #{employeeId}
          AND e.deleted_flag = 0
          AND e.status = 1
          AND d.deleted_flag = 0
        UNION
        -- 查询一级上级部门
        SELECT DISTINCT d1.department_id
        FROM t_hr_employee e
        INNER JOIN t_department d ON e.department_id = d.department_id
        INNER JOIN t_department d1 ON d.parent_id = d1.department_id
        WHERE e.employee_id = #{employeeId}
          AND e.deleted_flag = 0
          AND e.status = 1
          AND d.deleted_flag = 0
          AND d1.deleted_flag = 0
        UNION
        -- 查询二级上级部门
        SELECT DISTINCT d2.department_id
        FROM t_hr_employee e
        INNER JOIN t_department d ON e.department_id = d.department_id
        INNER JOIN t_department d1 ON d.parent_id = d1.department_id
        INNER JOIN t_department d2 ON d1.parent_id = d2.department_id
        WHERE e.employee_id = #{employeeId}
          AND e.deleted_flag = 0
          AND e.status = 1
          AND d.deleted_flag = 0
          AND d1.deleted_flag = 0
          AND d2.deleted_flag = 0
    </select>

    <!-- 根据员工ID查询直接部门ID -->
    <select id="getDirectDepartmentIdByEmployeeId" resultType="java.lang.Long">
        SELECT e.department_id
        FROM t_hr_employee e
        WHERE e.employee_id = #{employeeId}
          AND e.deleted_flag = 0
          AND e.status = 1
          AND e.department_id IS NOT NULL
        LIMIT 1
    </select>

</mapper>
