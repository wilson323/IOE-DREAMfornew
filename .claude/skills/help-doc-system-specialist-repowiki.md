# åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿä¸“å®¶ (Repowikiæ ‡å‡†ç‰ˆ)

## ğŸ¯ æŠ€èƒ½å®šä½
**æ ¸å¿ƒèŒè´£**: åŸºäº `.qoder/repowiki` ä¸­çš„ã€Šåœ¨çº¿æ–‡æ¡£ä¸å¸®åŠ©ç³»ç»Ÿè¯¦è§£ã€‹è§„èŒƒï¼Œç¡®ä¿IOE-DREAMé¡¹ç›®åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿä¸¥æ ¼éµå¾ªç°ä»£åŒ–æ–‡æ¡£ç®¡ç†æ¶æ„ï¼Œæä¾›å®Œæ•´ã€é«˜æ•ˆã€ç”¨æˆ·å‹å¥½çš„æ–‡æ¡£ç®¡ç†å’ŒæœåŠ¡èƒ½åŠ›

**âš¡ æŠ€èƒ½ç­‰çº§**: â˜…â˜…â˜…â˜…â˜… (åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿä¸“å®¶)
**ğŸ¯ é€‚ç”¨åœºæ™¯**: åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè®¾è®¡ã€æ–‡æ¡£å†…å®¹ç®¡ç†ã€å¯Œæ–‡æœ¬ç¼–è¾‘ã€å…¨æ–‡æœç´¢ã€è®¿é—®ç»Ÿè®¡åˆ†æ
**ğŸ“Š æŠ€èƒ½è¦†ç›–**: æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç† | å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ | åˆ†ç±»ä½“ç³»ç®¡ç† | å…¨æ–‡æœç´¢ | ç‰ˆæœ¬æ§åˆ¶ | è®¿é—®ç»Ÿè®¡

---

## ğŸ“‹ æŠ€èƒ½æ¦‚è¿° (åŸºäºRepowikiè§„èŒƒ)

### **æ ¸å¿ƒä¸“é•¿ (åŸºäº.qoder/repowiki/zh/content/é«˜çº§ç‰¹æ€§/åœ¨çº¿æ–‡æ¡£ä¸å¸®åŠ©ç³»ç»Ÿ.md)**
- **åœ¨çº¿æ–‡æ¡£å®ˆæŠ¤**: ä¸¥æ ¼ç¡®ä¿ç°ä»£åŒ–æ–‡æ¡£ç®¡ç†æ¶æ„å’Œç”¨æˆ·ä½“éªŒ
- **å†…å®¹ç®¡ç†ä¼˜åŒ–**: å®Œå–„çš„æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
- **å¯Œæ–‡æœ¬ç¼–è¾‘**: æ‰€è§å³æ‰€å¾—çš„æ–‡æ¡£ç¼–è¾‘å’Œå¤šåª’ä½“å†…å®¹æ”¯æŒ
- **æœç´¢å’Œå‘ç°**: å¼ºå¤§çš„å…¨æ–‡æœç´¢å’Œæ™ºèƒ½æ–‡æ¡£æ¨è
- **ç”¨æˆ·è¡Œä¸ºåˆ†æ**: è¯¦ç»†çš„æ–‡æ¡£è®¿é—®ç»Ÿè®¡å’Œç”¨æˆ·è¡Œä¸ºåˆ†æ

### **è§£å†³èƒ½åŠ›**
- **æ–‡æ¡£ç³»ç»Ÿæ¶æ„åˆè§„æ€§**: 100%ç¬¦åˆrepowikiåœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè§„èŒƒ
- **å†…å®¹ç®¡ç†æ•ˆç‡**: æä¾›é«˜æ•ˆçš„æ–‡æ¡£åˆ›å»ºã€ç¼–è¾‘ã€å‘å¸ƒå’Œç®¡ç†
- **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**: å‹å¥½çš„æ–‡æ¡£æµè§ˆã€æœç´¢å’Œäº¤äº’ä½“éªŒ
- **å†…å®¹è´¨é‡æ§åˆ¶**: å®Œå–„çš„æ–‡æ¡£å®¡æ ¸ã€ç‰ˆæœ¬ç®¡ç†å’Œè´¨é‡æ§åˆ¶
- **æ•°æ®é©±åŠ¨ä¼˜åŒ–**: åŸºäºè®¿é—®ç»Ÿè®¡çš„æ–‡æ¡£ä¼˜åŒ–å’Œå†…å®¹æ¨è

---

## ğŸ—ï¸ Repowikiåœ¨çº¿æ–‡æ¡£ç³»ç»Ÿæ¶æ„è§„èŒƒ

### **æ ¸å¿ƒæ¶æ„ç»„ä»¶**

#### **æ–‡æ¡£ç®¡ç†æœåŠ¡æ¶æ„**
```mermaid
classDiagram
class HelpDocService {
+addDoc(form) ResponseDTO
+updateDoc(form) ResponseDTO
+deleteDoc(docId) ResponseDTO
+getDocDetail(docId) ResponseDTO
+queryDocList(queryForm) ResponseDTO
+searchDoc(keyword) ResponseDTO
+updateViewCount(docId) void
+getDocStatistics() ResponseDTO
}
class HelpDocEntity {
+Long docId
+String title
+String content
+Long categoryId
+Integer status
+Long viewCount
+String tags
+LocalDateTime createTime
+LocalDateTime updateTime
}
class HelpDocCategoryEntity {
+Long categoryId
+String categoryName
+Long parentId
+Integer sort
+String path
}
HelpDocService --> HelpDocEntity
HelpDocService --> HelpDocCategoryEntity
```

#### **æ–‡æ¡£ç®¡ç†å·¥ä½œæµç¨‹**
```mermaid
flowchart TD
Start([æ–‡æ¡£åˆ›å»º]) --> CategorySelect["é€‰æ‹©æ–‡æ¡£åˆ†ç±»"]
CategorySelect --> ContentEdit["å†…å®¹ç¼–è¾‘"]
ContentEdit --> RichTextEditor["å¯Œæ–‡æœ¬ç¼–è¾‘å™¨"]
RichTextEditor --> TagAssignment["æ ‡ç­¾åˆ†é…"]
TagAssignment --> PreviewDoc["é¢„è§ˆæ–‡æ¡£"]
PreviewDoc --> SubmitReview["æäº¤å®¡æ ¸"]
SubmitReview --> |é€šè¿‡| PublishDoc["å‘å¸ƒæ–‡æ¡£"]
SubmitReview --> |é©³å›| ReturnEdit["è¿”å›ç¼–è¾‘"]
PublishDoc --> StatisticsTrack["ç»Ÿè®¡è¿½è¸ª"]
ReturnEdit --> ContentEdit
StatisticsTrack --> End([å®Œæˆ])
```

### **æ–‡æ¡£ç®¡ç†ä½“ç³»è§„èŒƒ**

#### **åˆ†ç±»ä½“ç³»ç®¡ç†**
- **å±‚çº§ç»“æ„**: æ”¯æŒæ— é™å±‚çº§çš„åˆ†ç±»åµŒå¥—å’Œè·¯å¾„ç®¡ç†
- **çµæ´»é…ç½®**: åŠ¨æ€è°ƒæ•´åˆ†ç±»ç»“æ„å’Œæ˜¾ç¤ºé¡ºåº
- **å…³è”ç®¡ç†**: æ–‡æ¡£ä¸åˆ†ç±»çš„ä¸€å¯¹å¤šå…³ç³»ç»´æŠ¤
- **æƒé™æ§åˆ¶**: åŸºäºåˆ†ç±»çš„è®¿é—®å’Œç¼–è¾‘æƒé™

#### **å†…å®¹ç®¡ç†åŠŸèƒ½**
- **å¯Œæ–‡æœ¬ç¼–è¾‘**: æ‰€è§å³æ‰€å¾—çš„ç›´è§‚ç¼–è¾‘ä½“éªŒ
- **å¤šåª’ä½“æ”¯æŒ**: å›¾ç‰‡ã€è§†é¢‘ã€é™„ä»¶çš„ä¸Šä¼ å’Œç®¡ç†
- **ç‰ˆæœ¬æ§åˆ¶**: æ–‡æ¡£å†å²ç‰ˆæœ¬ç®¡ç†å’Œå›æ»š
- **åä½œç¼–è¾‘**: å¤šäººåŒæ—¶ç¼–è¾‘å’Œå†²çªè§£å†³

---

## ğŸ› ï¸ æ ¸å¿ƒå·¥ä½œæµç¨‹ (åŸºäºRepowiki)

### **Phase 1: åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿåˆè§„æ€§è¯Šæ–­**
```bash
# æ£€æŸ¥åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿæ¶æ„åˆè§„æ€§
./scripts/check-help-doc-architecture.sh

# æ£€æµ‹å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é…ç½®
./scripts/analyze-rich-text-editor.sh

# éªŒè¯å…¨æ–‡æœç´¢åŠŸèƒ½
./scripts/validate-full-text-search.sh

# æ£€æŸ¥è®¿é—®ç»Ÿè®¡åˆ†æ
./scripts/check-access-analytics.sh
```

### **Phase 2: åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿä¼˜åŒ–**
```bash
# æ–‡æ¡£ç®¡ç†ä¼˜åŒ–
./scripts/optimize-document-management.sh

# æœç´¢å¼•æ“ä¼˜åŒ–
./scripts/optimize-search-engine.sh

# ç”¨æˆ·ç•Œé¢ä¼˜åŒ–
./scripts/optimize-user-interface.sh

# æ€§èƒ½ä¼˜åŒ–
./scripts/optimize-system-performance.sh
```

### **Phase 3: åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè´¨é‡ä¿éšœ**
```bash
# æ–‡æ¡£ç®¡ç†åŠŸèƒ½æµ‹è¯•
npm run test:help-doc

# å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æµ‹è¯•
npm run test:rich-text-editor

# æœç´¢åŠŸèƒ½æµ‹è¯•
npm run test:search-functionality

# æ€§èƒ½å‹åŠ›æµ‹è¯•
npm run test:performance-stress
```

---

## ğŸ” åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿåˆè§„æ€§æ£€æŸ¥æ¸…å• (åŸºäºRepowiki)

### **âœ… å¼ºåˆ¶æ€§è§„èŒƒ (å¿…é¡»100%éµå¾ª)**

#### **æ¶æ„è®¾è®¡è§„èŒƒ**
- [ ] ä¸¥æ ¼éµå¾ªServiceâ†’Entityâ†’Categoryåˆ†å±‚æ¶æ„
- [ ] å®ç°å®Œæ•´çš„æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] æä¾›å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½
- [ ] æ”¯æŒå¤šå±‚æ¬¡çš„æ–‡æ¡£åˆ†ç±»ä½“ç³»
- [ ] å®ç°å…¨æ–‡æœç´¢å’Œæ™ºèƒ½æ¨è

#### **å†…å®¹ç®¡ç†è§„èŒƒ**
- [ ] æ”¯æŒæ‰€è§å³æ‰€å¾—çš„å¯Œæ–‡æœ¬ç¼–è¾‘
- [ ] æä¾›å¤šåª’ä½“å†…å®¹çš„ä¸Šä¼ å’Œç®¡ç†
- [ ] å®ç°æ–‡æ¡£çš„ç‰ˆæœ¬æ§åˆ¶å’Œå†å²ç®¡ç†
- [ ] æ”¯æŒæ ‡ç­¾ç³»ç»Ÿå’Œå†…å®¹åˆ†ç±»
- [ ] æä¾›æ–‡æ¡£çš„é¢„è§ˆå’Œå‘å¸ƒæœºåˆ¶

#### **æœç´¢å’Œå‘ç°è§„èŒƒ**
- [ ] å®ç°å…¨æ–‡æœç´¢å’Œå…³é”®è¯é«˜äº®
- [ ] æä¾›æ™ºèƒ½çš„æœç´¢ç»“æœæ’åº
- [ ] æ”¯æŒåˆ†ç±»ç­›é€‰å’Œæ ‡ç­¾è¿‡æ»¤
- [ ] æä¾›æœç´¢å»ºè®®å’Œè‡ªåŠ¨è¡¥å…¨
- [ ] å®ç°ç›¸å…³æ–‡æ¡£çš„æ¨èåŠŸèƒ½

### **âš ï¸ æ¨èæ€§è§„èŒƒ**

#### **ç”¨æˆ·ä½“éªŒè§„èŒƒ**
- [ ] æä¾›å“åº”å¼çš„æ–‡æ¡£é˜…è¯»ç•Œé¢
- [ ] æ”¯æŒæ–‡æ¡£çš„ç›®å½•å¯¼èˆªå’Œå¿«é€Ÿå®šä½
- [ ] å®ç°æ–‡æ¡£æ”¶è—å’Œä¸ªæ€§åŒ–æ¨è
- [ ] æä¾›æ–‡æ¡£çš„æ‰“å°å’Œå¯¼å‡ºåŠŸèƒ½
- [ ] æ”¯æŒæ–‡æ¡£çš„åˆ†äº«å’Œç¤¾äº¤åŠŸèƒ½

#### **åˆ†æç»Ÿè®¡è§„èŒƒ**
- [ ] å®ç°è¯¦ç»†çš„è®¿é—®ç»Ÿè®¡å’Œåˆ†æ
- [ ] æä¾›ç”¨æˆ·è¡Œä¸ºè¿½è¸ªå’Œåˆ†æ
- [ ] æ”¯æŒæ–‡æ¡£æ•ˆæœçš„è¯„ä¼°å’Œåé¦ˆ
- [ ] æä¾›æ•°æ®å¯è§†åŒ–çš„ç»Ÿè®¡æŠ¥è¡¨
- [ ] æ”¯æŒA/Bæµ‹è¯•å’Œæ•ˆæœä¼˜åŒ–

---

## ğŸš€ åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿæœ€ä½³å®è·µ

### **æ ¸å¿ƒæ–‡æ¡£ç®¡ç†æœåŠ¡å®ç°ç¤ºä¾‹**
```java
// HelpDocService.java - æ ¸å¿ƒæ–‡æ¡£ç®¡ç†æœåŠ¡
@Service
@Slf4j
public class HelpDocService {

    private final HelpDocMapper helpDocMapper;
    private final HelpDocCategoryMapper categoryMapper;
    private final SearchService searchService;
    private final StatisticsService statisticsService;

    /**
     * æ·»åŠ æ–‡æ¡£
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Long> addDoc(HelpDocAddForm addForm) {
        try {
            // å‚æ•°éªŒè¯
            validateAddForm(addForm);

            // æ„å»ºæ–‡æ¡£å®ä½“
            HelpDocEntity doc = new HelpDocEntity();
            BeanUtils.copyProperties(addForm, doc);
            doc.setCreateTime(LocalDateTime.now());
            doc.setUpdateTime(LocalDateTime.now());
            doc.setStatus(DocStatus.DRAFT.getValue());

            // å¤„ç†åˆ†ç±»è·¯å¾„
            updateCategoryPath(doc);

            // ä¿å­˜æ–‡æ¡£
            helpDocMapper.insert(doc);

            // æå–æ ‡ç­¾
            extractTags(doc);

            // æ›´æ–°æœç´¢ç´¢å¼•
            searchService.addDocument(doc);

            log.info("Help document added successfully: docId={}, title={}", doc.getDocId(), doc.getTitle());

            return ResponseDTO.ok(doc.getDocId());
        } catch (Exception e) {
            log.error("Failed to add help document", e);
            throw new HelpDocException("Add help document failed", e);
        }
    }

    /**
     * æ›´æ–°æ–‡æ¡£
     */
    @Transactional(rollbackFor = Exception.class)
    public ResponseDTO<Void> updateDoc(HelpDocUpdateForm updateForm) {
        try {
            // è·å–åŸæœ‰æ–‡æ¡£
            HelpDocEntity existingDoc = helpDocMapper.selectById(updateForm.getDocId());
            if (existingDoc == null) {
                throw new HelpDocException("Document not found: " + updateForm.getDocId());
            }

            // æ£€æŸ¥æƒé™
            checkUpdatePermission(existingDoc, updateForm);

            // ä¿å­˜å†å²ç‰ˆæœ¬
            saveDocVersion(existingDoc);

            // æ›´æ–°æ–‡æ¡£ä¿¡æ¯
            BeanUtils.copyProperties(updateForm, existingDoc);
            existingDoc.setUpdateTime(LocalDateTime.now());

            // å¤„ç†åˆ†ç±»å˜æ›´
            if (!Objects.equals(existingDoc.getCategoryId(), updateForm.getCategoryId())) {
                updateCategoryPath(existingDoc);
            }

            // æ›´æ–°æ–‡æ¡£
            helpDocMapper.updateById(existingDoc);

            // æå–æ–°æ ‡ç­¾
            extractTags(existingDoc);

            // æ›´æ–°æœç´¢ç´¢å¼•
            searchService.updateDocument(existingDoc);

            log.info("Help document updated successfully: docId={}, title={}", existingDoc.getDocId(), existingDoc.getTitle());

            return ResponseDTO.ok();
        } catch (Exception e) {
            log.error("Failed to update help document: docId={}", updateForm.getDocId(), e);
            throw new HelpDocException("Update help document failed", e);
        }
    }

    /**
     * è·å–æ–‡æ¡£è¯¦æƒ…
     */
    public ResponseDTO<HelpDocDetailVO> getDocDetail(Long docId) {
        try {
            // è·å–æ–‡æ¡£
            HelpDocEntity doc = helpDocMapper.selectById(docId);
            if (doc == null) {
                throw new HelpDocException("Document not found: " + docId);
            }

            // æ£€æŸ¥è®¿é—®æƒé™
            checkViewPermission(doc);

            // æ›´æ–°æµè§ˆæ¬¡æ•°
            updateViewCount(docId);

            // æ„å»ºè¯¦æƒ…VO
            HelpDocDetailVO detailVO = new HelpDocDetailVO();
            BeanUtils.copyProperties(doc, detailVO);

            // è·å–åˆ†ç±»ä¿¡æ¯
            if (doc.getCategoryId() != null) {
                HelpDocCategoryEntity category = categoryMapper.selectById(doc.getCategoryId());
                if (category != null) {
                    detailVO.setCategoryName(category.getCategoryName());
                }
            }

            // è·å–ç›¸å…³æ–‡æ¡£
            List<HelpDocEntity> relatedDocs = getRelatedDocuments(doc);
            detailVO.setRelatedDocs(convertToSimpleVOList(relatedDocs));

            // è®°å½•è®¿é—®ç»Ÿè®¡
            recordAccessStatistics(docId);

            return ResponseDTO.ok(detailVO);
        } catch (Exception e) {
            log.error("Failed to get help document detail: docId={}", docId, e);
            throw new HelpDocException("Get help document detail failed", e);
        }
    }

    /**
     * æœç´¢æ–‡æ¡£
     */
    public ResponseDTO<PageResult<HelpDocSimpleVO>> searchDoc(HelpDocSearchForm searchForm) {
        try {
            // å‚æ•°éªŒè¯
            validateSearchForm(searchForm);

            // æ‰§è¡Œæœç´¢
            PageResult<HelpDocEntity> searchResult = searchService.searchDocuments(searchForm);

            // è½¬æ¢ä¸ºVO
            List<HelpDocSimpleVO> voList = searchResult.getRecords().stream()
                .map(this::convertToSimpleVO)
                .collect(Collectors.toList());

            PageResult<HelpDocSimpleVO> result = new PageResult<>();
            result.setRecords(voList);
            result.setTotal(searchResult.getTotal());
            result.setCurrent(searchResult.getCurrent());
            result.setSize(searchResult.getSize());

            // è®°å½•æœç´¢ç»Ÿè®¡
            recordSearchStatistics(searchForm, result.getTotal());

            return ResponseDTO.ok(result);
        } catch (Exception e) {
            log.error("Failed to search help documents", e);
            throw new HelpDocException("Search help documents failed", e);
        }
    }

    /**
     * æ›´æ–°æµè§ˆæ¬¡æ•°
     */
    private void updateViewCount(Long docId) {
        try {
            helpDocMapper.updateViewCount(docId);
        } catch (Exception e) {
            log.warn("Failed to update view count: docId={}", docId, e);
        }
    }

    /**
     * æå–æ ‡ç­¾
     */
    private void extractTags(HelpDocEntity doc) {
        try {
            // ä»å†…å®¹ä¸­æå–æ ‡ç­¾
            List<String> extractedTags = TagExtractor.extractFromContent(doc.getContent());

            // åˆå¹¶æ‰‹åŠ¨æ ‡ç­¾å’Œæå–æ ‡ç­¾
            List<String> allTags = new ArrayList<>();
            if (StringUtils.isNotBlank(doc.getTags())) {
                allTags.addAll(Arrays.asList(doc.getTags().split(",")));
            }
            allTags.addAll(extractedTags);

            // å»é‡å¹¶æ’åº
            List<String> uniqueTags = allTags.stream()
                .distinct()
                .sorted()
                .collect(Collectors.toList());

            // æ›´æ–°æ ‡ç­¾
            doc.setTags(String.join(",", uniqueTags));
            helpDocMapper.updateById(doc);

        } catch (Exception e) {
            log.warn("Failed to extract tags: docId={}", doc.getDocId(), e);
        }
    }
}
```

### **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é›†æˆå®ç°ç¤ºä¾‹**
```java
// RichTextEditorController.java - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ§åˆ¶å™¨
@RestController
@RequestMapping("/api/help/doc/editor")
@Slf4j
public class RichTextEditorController {

    private final FileUploadService fileUploadService;
    private final ImageProcessService imageProcessService;

    /**
     * ä¸Šä¼ å›¾ç‰‡
     */
    @PostMapping("/upload/image")
    public ResponseDTO<RichTextUploadResult> uploadImage(
            @RequestParam("file") MultipartFile file,
            @RequestParam(value = "compress", defaultValue = "true") Boolean compress) {
        try {
            // æ–‡ä»¶éªŒè¯
            validateImageFile(file);

            // å›¾ç‰‡å¤„ç†
            String processedImageUrl;
            if (compress) {
                processedImageUrl = imageProcessService.compressAndUpload(file);
            } else {
                processedImageUrl = fileUploadService.uploadFile(file, "images");
            }

            // æ„å»ºä¸Šä¼ ç»“æœ
            RichTextUploadResult result = new RichTextUploadResult();
            result.setUrl(processedImageUrl);
            result.setOriginalName(file.getOriginalFilename());
            result.setSize(file.getSize());
            result.setContentType(file.getContentType());

            log.info("Image uploaded successfully: {}", processedImageUrl);

            return ResponseDTO.ok(result);
        } catch (Exception e) {
            log.error("Failed to upload image", e);
            throw new RichTextEditorException("Image upload failed", e);
        }
    }

    /**
     * ä¸Šä¼ é™„ä»¶
     */
    @PostMapping("/upload/attachment")
    public ResponseDTO<RichTextUploadResult> uploadAttachment(@RequestParam("file") MultipartFile file) {
        try {
            // æ–‡ä»¶éªŒè¯
            validateAttachmentFile(file);

            // ä¸Šä¼ æ–‡ä»¶
            String attachmentUrl = fileUploadService.uploadFile(file, "attachments");

            // æ„å»ºä¸Šä¼ ç»“æœ
            RichTextUploadResult result = new RichTextUploadResult();
            result.setUrl(attachmentUrl);
            result.setOriginalName(file.getOriginalFilename());
            result.setSize(file.getSize());
            result.setContentType(file.getContentType());
            result.setAttachment(true);

            log.info("Attachment uploaded successfully: {}", attachmentUrl);

            return ResponseDTO.ok(result);
        } catch (Exception e) {
            log.error("Failed to upload attachment", e);
            throw new RichTextEditorException("Attachment upload failed", e);
        }
    }

    /**
     * è·å–ç¼–è¾‘å™¨é…ç½®
     */
    @GetMapping("/config")
    public ResponseDTO<RichTextEditorConfig> getEditorConfig() {
        try {
            RichTextEditorConfig config = new RichTextEditorConfig();

            // å·¥å…·æ é…ç½®
            config.setToolbar(getToolbarConfig());

            // æ’ä»¶é…ç½®
            config.setPlugins(getPluginConfig());

            // ä¸Šä¼ é…ç½®
            config.setUpload(getUploadConfig());

            // ä¸»é¢˜é…ç½®
            config.setTheme(getThemeConfig());

            return ResponseDTO.ok(config);
        } catch (Exception e) {
            log.error("Failed to get editor config", e);
            throw new RichTextEditorException("Get editor config failed", e);
        }
    }

    /**
     * éªŒè¯å›¾ç‰‡æ–‡ä»¶
     */
    private void validateImageFile(MultipartFile file) {
        if (file == null || file.isEmpty()) {
            throw new IllegalArgumentException("File cannot be empty");
        }

        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        String contentType = file.getContentType();
        if (!isAllowedImageType(contentType)) {
            throw new IllegalArgumentException("Unsupported image type: " + contentType);
        }

        // æ£€æŸ¥æ–‡ä»¶å¤§å°
        if (file.getSize() > getMaxImageSize()) {
            throw new IllegalArgumentException("Image file too large");
        }
    }

    private boolean isAllowedImageType(String contentType) {
        List<String> allowedTypes = Arrays.asList(
            "image/jpeg",
            "image/jpg",
            "image/png",
            "image/gif",
            "image/webp"
        );
        return allowedTypes.contains(contentType);
    }

    private long getMaxImageSize() {
        return 5 * 1024 * 1024; // 5MB
    }
}
```

### **æœç´¢æœåŠ¡å®ç°ç¤ºä¾‹**
```java
// SearchService.java - æœç´¢æœåŠ¡
@Service
@Slf4j
public class SearchService {

    private final ElasticsearchTemplate elasticsearchTemplate;
    private final HelpDocMapper helpDocMapper;

    /**
     * æœç´¢æ–‡æ¡£
     */
    public PageResult<HelpDocEntity> searchDocuments(HelpDocSearchForm searchForm) {
        try {
            // æ„å»ºæœç´¢æŸ¥è¯¢
            BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();

            // å…³é”®è¯æœç´¢
            if (StringUtils.isNotBlank(searchForm.getKeyword())) {
                boolQuery.must(QueryBuilders.multiMatchQuery(searchForm.getKeyword())
                    .field("title", 2.0f)
                    .field("content", 1.0f)
                    .field("tags", 1.5f)
                    .type(MultiMatchQueryBuilder.Type.BEST_FIELDS));
            }

            // åˆ†ç±»è¿‡æ»¤
            if (searchForm.getCategoryId() != null) {
                boolQuery.filter(QueryBuilders.termQuery("categoryId", searchForm.getCategoryId()));
            }

            // çŠ¶æ€è¿‡æ»¤
            if (searchForm.getStatus() != null) {
                boolQuery.filter(QueryBuilders.termQuery("status", searchForm.getStatus()));
            }

            // æ ‡ç­¾è¿‡æ»¤
            if (StringUtils.isNotBlank(searchForm.getTag())) {
                boolQuery.filter(QueryBuilders.termQuery("tags", searchForm.getTag()));
            }

            // æ—¶é—´èŒƒå›´è¿‡æ»¤
            if (searchForm.getStartTime() != null || searchForm.getEndTime() != null) {
                RangeQueryBuilder timeRange = QueryBuilders.rangeQuery("createTime");
                if (searchForm.getStartTime() != null) {
                    timeRange.gte(searchForm.getStartTime());
                }
                if (searchForm.getEndTime() != null) {
                    timeRange.lte(searchForm.getEndTime());
                }
                boolQuery.filter(timeRange);
            }

            // æ„å»ºæœç´¢è¯·æ±‚
            NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder()
                .withQuery(boolQuery)
                .withPageable(PageRequest.of(
                    searchForm.getCurrent() - 1,
                    searchForm.getPageSize(),
                    Sort.by(Sort.Direction.DESC, "createTime")
                ))
                .withHighlightFields(
                    new HighlightBuilder.Field("title")
                        .preTags("<em>")
                        .postTags("</em>")
                        .fragmentSize(100),
                    new HighlightBuilder.Field("content")
                        .preTags("<em>")
                        .postTags("</em>")
                        .fragmentSize(150)
                        .numberOfFragments(3)
                );

            // æ‰§è¡Œæœç´¢
            SearchHits<HelpDocEntity> searchHits = elasticsearchTemplate
                .search(queryBuilder.build(), HelpDocEntity.class);

            // å¤„ç†æœç´¢ç»“æœ
            List<HelpDocEntity> results = new ArrayList<>();
            for (SearchHit<HelpDocEntity> hit : searchHits) {
                HelpDocEntity doc = hit.getContent();

                // è®¾ç½®é«˜äº®å†…å®¹
                Map<String, List<String>> highlightFields = hit.getHighlightFields();
                if (highlightFields != null) {
                    doc.setHighlightedTitle(getHighlightValue(highlightFields, "title"));
                    doc.setHighlightedContent(getHighlightValue(highlightFields, "content"));
                }

                results.add(doc);
            }

            // æ„å»ºåˆ†é¡µç»“æœ
            PageResult<HelpDocEntity> pageResult = new PageResult<>();
            pageResult.setRecords(results);
            pageResult.setTotal(searchHits.getTotalHits());
            pageResult.setCurrent(searchForm.getCurrent());
            pageResult.setSize(searchForm.getPageSize());

            return pageResult;
        } catch (Exception e) {
            log.error("Failed to search documents", e);
            throw new SearchException("Document search failed", e);
        }
    }

    /**
     * æ·»åŠ æ–‡æ¡£åˆ°æœç´¢ç´¢å¼•
     */
    public void addDocument(HelpDocEntity doc) {
        try {
            IndexQuery indexQuery = new IndexQueryBuilder()
                .withId(doc.getDocId().toString())
                .withObject(doc);

            elasticsearchTemplate.index(indexQuery, IndexCoordinates.of("help_docs"));
            log.debug("Document added to search index: {}", doc.getDocId());
        } catch (Exception e) {
            log.error("Failed to add document to search index: docId={}", doc.getDocId(), e);
        }
    }

    /**
     * æ›´æ–°æœç´¢ç´¢å¼•ä¸­çš„æ–‡æ¡£
     */
    public void updateDocument(HelpDocEntity doc) {
        try {
            addDocument(doc); // Elasticsearchä¼šè‡ªåŠ¨å¤„ç†æ›´æ–°
            log.debug("Document updated in search index: {}", doc.getDocId());
        } catch (Exception e) {
            log.error("Failed to update document in search index: docId={}", doc.getDocId(), e);
        }
    }

    /**
     * ä»æœç´¢ç´¢å¼•åˆ é™¤æ–‡æ¡£
     */
    public void deleteDocument(Long docId) {
        try {
            elasticsearchTemplate.delete(
                docId.toString(),
                IndexCoordinates.of("help_docs")
            );
            log.debug("Document deleted from search index: {}", docId);
        } catch (Exception e) {
            log.error("Failed to delete document from search index: docId={}", docId, e);
        }
    }

    /**
     * è·å–é«˜äº®å€¼
     */
    private String getHighlightValue(Map<String, List<String>> highlightFields, String fieldName) {
        List<String> highlights = highlightFields.get(fieldName);
        if (highlights != null && !highlights.isEmpty()) {
            return String.join("...", highlights);
        }
        return null;
    }
}
```

### **è®¿é—®ç»Ÿè®¡æœåŠ¡å®ç°ç¤ºä¾‹**
```java
// StatisticsService.java - è®¿é—®ç»Ÿè®¡æœåŠ¡
@Service
@Slf4j
public class StatisticsService {

    private final HelpDocAccessMapper accessMapper;
    private final HelpDocMapper helpDocMapper;

    /**
     * è·å–æ–‡æ¡£ç»Ÿè®¡ä¿¡æ¯
     */
    public HelpDocStatisticsVO getDocStatistics(Long docId) {
        try {
            HelpDocStatisticsVO statistics = new HelpDocStatisticsVO();

            // è·å–æ–‡æ¡£åŸºæœ¬ä¿¡æ¯
            HelpDocEntity doc = helpDocMapper.selectById(docId);
            if (doc != null) {
                statistics.setDocId(docId);
                statistics.setTitle(doc.getTitle());
                statistics.setTotalViews(doc.getViewCount());
            }

            // è·å–ä»Šæ—¥è®¿é—®ç»Ÿè®¡
            LocalDate today = LocalDate.now();
            Long todayViews = accessMapper.countViewsByDate(docId, today);
            statistics.setTodayViews(todayViews);

            // è·å–æœ¬å‘¨è®¿é—®ç»Ÿè®¡
            LocalDate weekStart = today.minusDays(today.getDayOfWeek().getValue() - 1);
            LocalDate weekEnd = today;
            Long weekViews = accessMapper.countViewsByDateRange(docId, weekStart, weekEnd);
            statistics.setWeekViews(weekViews);

            // è·å–æœ¬æœˆè®¿é—®ç»Ÿè®¡
            LocalDate monthStart = today.withDayOfMonth(1);
            LocalDate monthEnd = today;
            Long monthViews = accessMapper.countViewsByDateRange(docId, monthStart, monthEnd);
            statistics.setMonthViews(monthViews);

            // è·å–è®¿é—®è¶‹åŠ¿
            List<DocAccessTrendVO> trend = getAccessTrend(docId, 30);
            statistics.setAccessTrend(trend);

            // è·å–çƒ­é—¨æ—¶é—´æ®µ
            List<AccessTimeSlotVO> timeSlots = getPopularTimeSlots(docId);
            statistics.setPopularTimeSlots(timeSlots);

            return statistics;
        } catch (Exception e) {
            log.error("Failed to get document statistics: docId={}", docId, e);
            throw new StatisticsException("Get document statistics failed", e);
        }
    }

    /**
     * è®°å½•æ–‡æ¡£è®¿é—®
     */
    @Async("statisticsExecutor")
    public void recordDocumentAccess(Long docId, HttpServletRequest request) {
        try {
            HelpDocAccessEntity access = new HelpDocAccessEntity();
            access.setDocId(docId);
            access.setAccessTime(LocalDateTime.now());
            access.setIpAddress(getClientIpAddress(request));
            access.setUserAgent(request.getHeader("User-Agent"));
            access.setReferer(request.getHeader("Referer"));

            // è·å–ç”¨æˆ·ä¿¡æ¯
            UserContext userContext = UserContextHolder.get();
            if (userContext != null) {
                access.setUserId(userContext.getUserId());
                access.setUserType(userContext.getUserType());
            }

            accessMapper.insert(access);
        } catch (Exception e) {
            log.warn("Failed to record document access: docId={}", docId, e);
        }
    }

    /**
     * è·å–è®¿é—®è¶‹åŠ¿
     */
    private List<DocAccessTrendVO> getAccessTrend(Long docId, int days) {
        LocalDate endDate = LocalDate.now();
        LocalDate startDate = endDate.minusDays(days - 1);

        List<Map<String, Object>> rawData = accessMapper.selectAccessTrend(docId, startDate, endDate);

        return rawData.stream()
            .map(this::convertToTrendVO)
            .collect(Collectors.toList());
    }

    /**
     * è·å–çƒ­é—¨æ—¶é—´æ®µ
     */
    private List<AccessTimeSlotVO> getPopularTimeSlots(Long docId) {
        List<Map<String, Object>> rawData = accessMapper.selectPopularTimeSlots(docId);

        return rawData.stream()
            .map(this::convertToTimeSlotVO)
            .collect(Collectors.toList());
    }

    /**
     * è·å–æ€»ä½“ç»Ÿè®¡
     */
    public SystemStatisticsVO getSystemStatistics() {
        try {
            SystemStatisticsVO statistics = new SystemStatisticsVO();

            // æ€»æ–‡æ¡£æ•°
            Long totalDocs = helpDocMapper.selectCount(null);
            statistics.setTotalDocs(totalDocs);

            // ä»Šæ—¥è®¿é—®æ•°
            LocalDate today = LocalDate.now();
            Long todayViews = accessMapper.countTotalViewsByDate(today);
            statistics.setTodayViews(todayViews);

            // æœ¬å‘¨è®¿é—®æ•°
            LocalDate weekStart = today.minusDays(today.getDayOfWeek().getValue() - 1);
            Long weekViews = accessMapper.countTotalViewsByDateRange(weekStart, today);
            statistics.setWeekViews(weekViews);

            // æœ¬æœˆè®¿é—®æ•°
            LocalDate monthStart = today.withDayOfMonth(1);
            Long monthViews = accessMapper.countTotalViewsByDateRange(monthStart, today);
            statistics.setMonthViews(monthViews);

            // çƒ­é—¨æ–‡æ¡£
            List<Map<String, Object>> topDocs = accessMapper.selectTopDocuments(10);
            statistics.setTopDocuments(convertToTopDocs(topDocs));

            return statistics;
        } catch (Exception e) {
            log.error("Failed to get system statistics", e);
            throw new StatisticsException("Get system statistics failed", e);
        }
    }
}
```

---

## ğŸ“Š åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè´¨é‡è¯„ä¼°æ ‡å‡†

### **åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè¯„åˆ†**
| ç»´åº¦ | æƒé‡ | è¯„åˆ†æ ‡å‡† |
|------|------|----------|
| æ–‡æ¡£ç®¡ç†æ¶æ„åˆè§„æ€§ | 30% | å®Œå…¨ç¬¦åˆæ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†è§„èŒƒ |
| å†…å®¹ç¼–è¾‘åŠŸèƒ½ | 25% | å¯Œæ–‡æœ¬ç¼–è¾‘å’Œå¤šåª’ä½“æ”¯æŒèƒ½åŠ› |
| æœç´¢å‘ç°åŠŸèƒ½ | 20% | å…¨æ–‡æœç´¢å’Œæ™ºèƒ½æ¨èæ•ˆæœ |
| ç”¨æˆ·ä½“éªŒè´¨é‡ | 15% | ç•Œé¢å‹å¥½æ€§å’Œäº¤äº’ä½“éªŒ |
| åˆ†æç»Ÿè®¡èƒ½åŠ› | 10% | è®¿é—®ç»Ÿè®¡å’Œæ•°æ®é©±åŠ¨ä¼˜åŒ– |

### **è´¨é‡ç­‰çº§**
- **Açº§ (90-100åˆ†)**: å®Œå…¨ç¬¦åˆrepowikiåœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè§„èŒƒ
- **Bçº§ (80-89åˆ†)**: åŸºæœ¬åˆè§„ï¼Œå­˜åœ¨è½»å¾®ä¼˜åŒ–ç©ºé—´
- **Cçº§ (70-79åˆ†)**: éƒ¨åˆ†åˆè§„ï¼Œéœ€è¦é‡ç‚¹æ”¹è¿›
- **Dçº§ (60-69åˆ†)**: æ–‡æ¡£ç³»ç»Ÿè®¾è®¡æ··ä¹±ï¼Œéœ€è¦é‡æ„
- **Eçº§ (0-59åˆ†)**: ä¸¥é‡è¿ååœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè§„èŒƒ

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### **ä½•æ—¶è°ƒç”¨**
- åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿæ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹æ—¶
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é›†æˆå’Œé…ç½®æ—¶
- å…¨æ–‡æœç´¢å¼•æ“å®ç°æ—¶
- æ–‡æ¡£åˆ†ç±»å’Œå†…å®¹ç®¡ç†æ—¶
- è®¿é—®ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½å®ç°æ—¶

### **è°ƒç”¨æ–¹å¼**
```bash
# åŸºäºrepowikiçš„åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿä¸“å®¶
Skill("help-doc-system-specialist-repowiki")

# å°†ç«‹å³æ‰§è¡Œï¼š
# 1. åŸºäº.qoder/repowikiåœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè§„èŒƒæ£€æŸ¥
# 2. æ–‡æ¡£ç®¡ç†å’Œå†…å®¹ç¼–è¾‘ç³»ç»ŸéªŒè¯
# 3. æœç´¢å¼•æ“å’Œå‘ç°åŠŸèƒ½åˆ†æ
# 4. ç”¨æˆ·ä½“éªŒå’Œç»Ÿè®¡åˆ†æä¼˜åŒ–å»ºè®®
```

### **é¢„æœŸç»“æœ**
- 100%ç¬¦åˆ`.qoder/repowiki`åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿè§„èŒƒ
- å®Œæ•´çš„æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿ
- å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘å’Œå¤šåª’ä½“æ”¯æŒ
- é«˜æ•ˆçš„å…¨æ–‡æœç´¢å’Œæ™ºèƒ½æ¨è
- è¯¦ç»†çš„è®¿é—®ç»Ÿè®¡å’Œç”¨æˆ·è¡Œä¸ºåˆ†æ

---

**ğŸ† æŠ€èƒ½ç­‰çº§**: åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿä¸“å®¶ (â˜…â˜…â˜…â˜…â˜…)
**â° é¢„æœŸæ•ˆæœ**: åŸºäº249ä¸ªrepowikiæƒå¨æ–‡æ¡£ï¼Œç¡®ä¿IOE-DREAMåœ¨çº¿æ–‡æ¡£ç³»ç»Ÿ100%ç¬¦åˆç°ä»£åŒ–æ–‡æ¡£ç®¡ç†æ ‡å‡†
**ğŸ¯ æ ¸å¿ƒä»·å€¼**: çŸ¥è¯†ç®¡ç†ä¼˜åŒ–ï¼Œç”¨æˆ·ä½“éªŒæå‡ï¼Œå†…å®¹åä½œæ”¯æŒ