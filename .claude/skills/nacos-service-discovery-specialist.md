# ğŸŒ NacosæœåŠ¡å‘ç°ä¸“å®¶æŠ€èƒ½
## Nacos Service Discovery Specialist

**ğŸ¯ æŠ€èƒ½å®šä½**: IOE-DREAMé¡¹ç›®NacosæœåŠ¡æ²»ç†ä¸“å®¶ï¼Œç²¾é€šæœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ç®¡ç†ã€å¥åº·æ£€æŸ¥ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡æ²»ç†ç­‰æ ¸å¿ƒNacosæŠ€èƒ½

**âš¡ æŠ€èƒ½ç­‰çº§**: â˜…â˜…â˜…â˜…â˜… (é¡¶çº§ä¸“å®¶)
**ğŸ¯ é€‚ç”¨åœºæ™¯**: æœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ä¸­å¿ƒç®¡ç†ã€æœåŠ¡æ²»ç†ã€é›†ç¾¤éƒ¨ç½²ã€é«˜å¯ç”¨æ¶æ„ã€å¾®æœåŠ¡ç›‘æ§
**ğŸ“Š æŠ€èƒ½è¦†ç›–**: æœåŠ¡æ³¨å†Œ | æœåŠ¡å‘ç° | é…ç½®ç®¡ç† | å¥åº·æ£€æŸ¥ | è´Ÿè½½å‡è¡¡ | é›†ç¾¤ç®¡ç†

**ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0 - IOE-DREAMä¼ä¸šçº§æ²»ç†ç‰ˆ
**ğŸ“… åˆ›å»ºæ—¶é—´**: 2025-12-02
**ğŸ“… æœ€åæ›´æ–°**: 2025-12-02
**ğŸ‘¥ ä½œè€…**: NacosæœåŠ¡æ²»ç†ä¸“å®¶å›¢é˜Ÿ
**ğŸ‘¥ å®¡æ‰¹äºº**: å¾®æœåŠ¡æ¶æ„å§”å‘˜ä¼š
**ğŸ”„ å˜æ›´ç±»å‹**: MAJOR (P0çº§æœåŠ¡æ²»ç†ç¼ºå¤±è§£å†³)

---

## ğŸ“‹ å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº | å®¡æ‰¹äºº | å˜æ›´ç±»å‹ |
|------|------|----------|--------|--------|----------|
| v1.0.0 | 2025-12-02 | åˆå§‹ç‰ˆæœ¬ï¼Œè§£å†³33ä¸ªå¾®æœåŠ¡Nacosæ²»ç†P0çº§ç¼ºå¤±é—®é¢˜ | NacosæœåŠ¡æ²»ç†ä¸“å®¶å›¢é˜Ÿ | å¾®æœåŠ¡æ¶æ„å§”å‘˜ä¼š | MAJOR |

---

## ğŸ“Š æŠ€èƒ½è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|---------|--------|--------|------|
| **æœåŠ¡æ³¨å†ŒæˆåŠŸç‡** | 100% | 85% | ğŸ”´ éœ€æ”¹è¿› |
| **é…ç½®ç®¡ç†è¦†ç›–ç‡** | 100% | 70% | ğŸ”´ ä¸¥é‡ä¸è¶³ |
| **æœåŠ¡å‘ç°å‡†ç¡®ç‡** | â‰¥99.9% | 90% | ğŸ”´ ä¸ç¨³å®š |
| **å¥åº·æ£€æŸ¥åŠæ—¶æ€§** | â‰¤30s | â‰¥5min | ğŸ”´ å»¶è¿Ÿä¸¥é‡ |
| **æ•…éšœè½¬ç§»èƒ½åŠ›** | â‰¤10s | â‰¥60s | ğŸ”´ ä¸å¯é  |

---

## ğŸš¨ P0çº§æœåŠ¡æ²»ç†ç¼ºå¤±åˆ†æ

### **å½“å‰Nacosæ²»ç†çŠ¶å†µ**ï¼ˆåŸºäº2025-12-01å…¨å±€æ¶æ„æ·±åº¦åˆ†æï¼‰

**ğŸ”´ ä¸¥é‡æœåŠ¡æ²»ç†ç¼ºå¤±**ï¼š
- **33ä¸ªå¾®æœåŠ¡æ²»ç†ä¸å®Œæ•´**: æœåŠ¡æ³¨å†Œã€é…ç½®ç®¡ç†ã€å¥åº·æ£€æŸ¥æœºåˆ¶ä¸å®Œå–„
- **é…ç½®ç®¡ç†è¦†ç›–ç‡70%**: å…³é”®é…ç½®æœªçº³å…¥ç»Ÿä¸€ç®¡ç†
- **æœåŠ¡å‘ç°å‡†ç¡®ç‡90%**: æœåŠ¡å‘ç°é—®é¢˜é¢‘å‘
- **æ•…éšœè½¬ç§»æ—¶é—´â‰¥60ç§’**: æœåŠ¡æ•…éšœæ—¶åˆ‡æ¢ç¼“æ…¢

**ğŸ¯ ç«‹å³æ²»ç†ç›®æ ‡**ï¼š
- âœ… **100%æœåŠ¡æ³¨å†Œ**: æ‰€æœ‰33ä¸ªå¾®æœåŠ¡å®Œå–„æœåŠ¡æ³¨å†Œæœºåˆ¶
- âœ… **100%é…ç½®ç®¡ç†**: æ‰€æœ‰é…ç½®çº³å…¥Nacosç»Ÿä¸€ç®¡ç†
- âœ… **99.9%æœåŠ¡å‘ç°å‡†ç¡®ç‡**: å»ºç«‹é«˜å¯ç”¨æœåŠ¡å‘ç°æœºåˆ¶
- âœ… **10ç§’æ•…éšœè½¬ç§»**: å®ç°å¿«é€Ÿæ•…éšœåˆ‡æ¢å’Œæ¢å¤

---

## ğŸ“‹ æŠ€èƒ½æ¦‚è¿°

æœ¬æŠ€èƒ½ä¸“é—¨è§£å†³IOE-DREAMé¡¹ç›®çš„NacosæœåŠ¡æ²»ç†ç¼ºå¤±é—®é¢˜ï¼Œå»ºç«‹ä¼ä¸šçº§çš„æœåŠ¡æ³¨å†Œå‘ç°å’Œé…ç½®ç®¡ç†ä½“ç³»ï¼Œç¡®ä¿æ‰€æœ‰å¾®æœåŠ¡éƒ½èƒ½è¢«æœ‰æ•ˆç®¡ç†å’Œç›‘æ§ã€‚

**æ ¸å¿ƒèƒ½åŠ›**: è®¾è®¡å’Œå®ç°é«˜å¯ç”¨Nacosé›†ç¾¤æ¶æ„ï¼Œå»ºç«‹å®Œå–„çš„æœåŠ¡æ²»ç†æœºåˆ¶ï¼Œå®ç°å¿«é€Ÿæ•…éšœè½¬ç§»ï¼Œæä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†æœåŠ¡ã€‚

---

## ğŸ—ï¸ NacosæœåŠ¡æ²»ç†æ ¸å¿ƒæ¶æ„

### **1. Nacosé›†ç¾¤æ¶æ„è®¾è®¡**

#### **é«˜å¯ç”¨é›†ç¾¤æ¶æ„å›¾**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nacos Node 1  â”‚    â”‚   Nacos Node 2  â”‚    â”‚   Nacos Node 3  â”‚
â”‚   192.168.1.10 â”‚    â”‚   192.168.1.11 â”‚    â”‚   192.168.1.12 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Service      â”‚ â”‚    â”‚ â”‚Service      â”‚ â”‚    â”‚ â”‚Service      â”‚ â”‚
â”‚ â”‚Registry     â”‚ â”‚    â”‚ â”‚Registry     â”‚ â”‚    â”‚ â”‚Registry     â”‚ â”‚
â”‚ +-------------+ â”‚    â”‚ +-------------+ â”‚    â”‚ +-------------+ â”‚
â”‚ â”‚Config       â”‚ â”‚    â”‚ â”‚Config       â”‚ â”‚    â”‚ â”‚Config       â”‚ â”‚
â”‚ â”‚Center       â”‚ â”‚    â”‚ â”‚Center       â”‚ â”‚    â”‚ â”‚Center       â”‚ â”‚
â”‚ +-------------+ â”‚    â”‚ +-------------+ â”‚    â”‚ +-------------+ â”‚
â”‚ â”‚Health       â”‚ â”‚    â”‚ â”‚Health       â”‚ â”‚    â”‚ â”‚Health       â”‚ â”‚
â”‚ â”‚Check        â”‚ â”‚    â”‚ â”‚Check        â”‚ â”‚    â”‚ â”‚Check        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Nginx Load      â”‚
                    â”‚  Balancer        â”‚
                    â”‚  (VIP: 192.168.1.100) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Microservice   â”‚    â”‚  Microservice   â”‚    â”‚  Microservice   â”‚
â”‚  App 1-10       â”‚    â”‚  App 11-20      â”‚    â”‚  App 21-33      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Nacos Client    â”‚    â”‚ Nacos Client    â”‚    â”‚ Nacos Client    â”‚
â”‚ Service Registryâ”‚    â”‚ Service Registryâ”‚    â”‚ Service Registryâ”‚
â”‚ Config Manager  â”‚    â”‚ Config Manager  â”‚    â”‚ Config Manager  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **é›†ç¾¤é…ç½®æ¨¡æ¿**
```yaml
# application-cluster.yml - Nacosé›†ç¾¤é…ç½®
spring:
  application:
    name: ${SERVICE_NAME:ioedream-access-service}

  cloud:
    nacos:
      discovery:
        # é›†ç¾¤é…ç½®
        server-addr: ${NACOS_SERVER_ADDR:192.168.1.100:80}  # Nginx VIPåœ°å€
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        username: ${NACOS_USERNAME:nacos}
        password: ${NACOS_PASSWORD:nacos}

        # æœåŠ¡æ³¨å†Œé…ç½®
        enabled: true
        register-enabled: true
        deregister: false  # æœåŠ¡ä¸‹çº¿å»¶è¿Ÿ
        heart-beat-interval: 5000  # 5ç§’å¿ƒè·³
        heart-beat-timeout: 15000  # 15ç§’è¶…æ—¶
        ip-delete-timeout: 30000   # 30ç§’åˆ é™¤

        # å®ä¾‹é…ç½®
        instance-enabled: true
        ephemeral: true  # ä¸´æ—¶å®ä¾‹
        weight: 1.0
        metadata:
          version: ${SERVICE_VERSION:1.0.0}
          environment: ${SPRING_PROFILES_ACTIVE:dev}
          region: ${REGION:default}
          zone: ${ZONE:default}

        # é›†ç¾¤é…ç½®
        cluster-name: ${CLUSTER_NAME:default}
        naming-load-cache-refresh-count: 10

      config:
        # é…ç½®ä¸­å¿ƒé…ç½®
        server-addr: ${NACOS_SERVER_ADDR:192.168.1.100:80}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:IOE-DREAM}
        username: ${NACOS_USERNAME:nacos}
        password: ${NACOS_PASSWORD:nacos}

        # é…ç½®åŠ è½½
        enabled: true
        encode: utf-8
        file-extension: yaml
        refresh-enabled: true
        shared-configs:
          - data-id: common-config.yaml
            group: SHARED_GROUP
            refresh: true
          - data-id: database-config.yaml
            group: SHARED_GROUP
            refresh: false
        extension-configs:
          - data-id: ${SERVICE_NAME}.yaml
            group: EXTENSION_GROUP
            refresh: true

# Nacoså®¢æˆ·ç«¯ç›‘æ§
management:
  endpoints:
    web:
      exposure:
        include: health,info,nacos,nacos-config,nacos-discovery
  endpoint:
    health:
      show-details: always
  health:
    nacos:
      enabled: true
```

### **2. Nacoså®¢æˆ·ç«¯é«˜çº§é…ç½®**

#### **è‡ªå®šä¹‰æœåŠ¡æ³¨å†Œå¢å¼º**
```java
/**
 * NacosæœåŠ¡æ³¨å†Œå¢å¼ºå™¨
 * æä¾›æ›´å®Œå–„çš„æœåŠ¡æ³¨å†ŒåŠŸèƒ½
 */
@Component
@Slf4j
public class NacosServiceRegistryEnhancer {

    @Resource
    private NacosAutoServiceRegistration registration;

    @Resource
    private NacosServiceProperties nacosServiceProperties;

    @Resource
    private NacosRegistration nacosRegistration;

    /**
     * å¢å¼ºæœåŠ¡æ³¨å†Œ
     */
    @EventListener(ApplicationReadyEvent.class)
    public void enhanceServiceRegistration() {
        log.info("å¼€å§‹å¢å¼ºNacosæœåŠ¡æ³¨å†Œ...");

        try {
            // 1. æ·»åŠ è‡ªå®šä¹‰å…ƒæ•°æ®
            addCustomMetadata();

            // 2. é…ç½®å¥åº·æ£€æŸ¥
            configureHealthCheck();

            // 3. è®¾ç½®æœåŠ¡æƒé‡
            configureServiceWeight();

            // 4. æ³¨å†ŒæœåŠ¡
            registration.register();

            log.info("NacosæœåŠ¡æ³¨å†Œå¢å¼ºå®Œæˆ: service={}, ip={}, port={}",
                    nacosRegistration.getServiceId(),
                    nacosRegistration.getHost(),
                    nacosRegistration.getPort());

        } catch (Exception e) {
            log.error("NacosæœåŠ¡æ³¨å†Œå¢å¼ºå¤±è´¥", e);
            throw new NacosRegistrationException("æœåŠ¡æ³¨å†Œå¤±è´¥", e);
        }
    }

    /**
     * æ·»åŠ è‡ªå®šä¹‰å…ƒæ•°æ®
     */
    private void addCustomMetadata() {
        Map<String, String> metadata = nacosRegistration.getMetadata();

        // æœåŠ¡ç‰ˆæœ¬ä¿¡æ¯
        metadata.put("service.version", getServiceVersion());

        // ç¯å¢ƒä¿¡æ¯
        metadata.put("service.environment", getEnvironment());

        // éƒ¨ç½²ä¿¡æ¯
        metadata.put("service.region", getRegion());
        metadata.put("service.zone", getZone());
        metadata.put("service.instance-id", getInstanceId());

        // å®¹å™¨ä¿¡æ¯
        metadata.put("service.container", getContainerInfo());

        // å¯åŠ¨æ—¶é—´
        metadata.put("service.startup-time", String.valueOf(System.currentTimeMillis()));

        // Gitä¿¡æ¯
        metadata.put("service.git.commit", getGitCommitId());

        log.info("æ·»åŠ è‡ªå®šä¹‰å…ƒæ•°æ®å®Œæˆ: {}", metadata);
    }

    /**
     * é…ç½®å¥åº·æ£€æŸ¥
     */
    private void configureHealthCheck() {
        NacosRegistration registration = nacosRegistration;

        // è®¾ç½®å¥åº·æ£€æŸ¥URL
        registration.setHealthCheckUrl(getHealthCheckUrl());

        // è®¾ç½®å¥åº·æ£€æŸ¥é—´éš”
        nacosServiceProperties.getHeartBeat().setInterval(5000);
        nacosServiceProperties.getHeartBeat().setTimeout(15000);

        log.info("å¥åº·æ£€æŸ¥é…ç½®å®Œæˆ: url={}", getHealthCheckUrl());
    }

    /**
     * é…ç½®æœåŠ¡æƒé‡
     */
    private void configureServiceWeight() {
        // æ ¹æ®æœåŠ¡å™¨æ€§èƒ½åŠ¨æ€è®¾ç½®æƒé‡
        double weight = calculateServiceWeight();
        nacosRegistration.setWeight(weight);

        log.info("æœåŠ¡æƒé‡é…ç½®å®Œæˆ: weight={}", weight);
    }

    private double calculateServiceWeight() {
        // è·å–ç³»ç»Ÿèµ„æºä¿¡æ¯
        int cpuCores = Runtime.getRuntime().availableProcessors();
        long maxMemory = Runtime.getRuntime().maxMemory();

        // åŸºç¡€æƒé‡
        double weight = 1.0;

        // CPUæ ¸å¿ƒæ•°æƒé‡åŠ æˆ
        if (cpuCores >= 8) {
            weight += 0.5;
        } else if (cpuCores >= 4) {
            weight += 0.3;
        }

        // å†…å­˜æƒé‡åŠ æˆ
        long maxMemoryMB = maxMemory / 1024 / 1024;
        if (maxMemoryMB >= 4096) {
            weight += 0.3;
        } else if (maxMemoryMB >= 2048) {
            weight += 0.2;
        }

        return Math.min(weight, 2.0);  // æœ€å¤§æƒé‡2.0
    }
}
```

#### **æœåŠ¡å‘ç°å¢å¼º**
```java
/**
 * NacosæœåŠ¡å‘ç°å¢å¼ºå™¨
 * æä¾›æ™ºèƒ½çš„æœåŠ¡å‘ç°åŠŸèƒ½
 */
@Component
@Slf4j
public class NacosServiceDiscoveryEnhancer {

    @Resource
    private NacosServiceDiscovery nacosServiceDiscovery;

    @Resource
    private LoadBalancerClientFactory loadBalancerClientFactory;

    /**
     * æ™ºèƒ½æœåŠ¡å‘ç°
     */
    public List<ServiceInstance> discoverServiceInstances(String serviceName,
                                                           DiscoveryStrategy strategy) {
        try {
            // 1. è·å–æ‰€æœ‰æœåŠ¡å®ä¾‹
            List<ServiceInstance> allInstances = nacosServiceDiscovery.getInstances(serviceName);

            if (CollectionUtils.isEmpty(allInstances)) {
                log.warn("æœªæ‰¾åˆ°æœåŠ¡å®ä¾‹: serviceName={}", serviceName);
                return Collections.emptyList();
            }

            // 2. è¿‡æ»¤å¥åº·å®ä¾‹
            List<ServiceInstance> healthyInstances = filterHealthyInstances(allInstances);

            // 3. åº”ç”¨å‘ç°ç­–ç•¥
            List<ServiceInstance> selectedInstances = applyDiscoveryStrategy(healthyInstances, strategy);

            log.info("æœåŠ¡å‘ç°å®Œæˆ: serviceName={}, total={}, healthy={}, selected={}",
                    serviceName, allInstances.size(), healthyInstances.size(), selectedInstances.size());

            return selectedInstances;

        } catch (Exception e) {
            log.error("æœåŠ¡å‘ç°å¤±è´¥: serviceName={}", serviceName, e);
            throw new ServiceDiscoveryException("æœåŠ¡å‘ç°å¤±è´¥: " + serviceName, e);
        }
    }

    /**
     * è¿‡æ»¤å¥åº·å®ä¾‹
     */
    private List<ServiceInstance> filterHealthyInstances(List<ServiceInstance> instances) {
        return instances.stream()
                .filter(this::isInstanceHealthy)
                .collect(Collectors.toList());
    }

    /**
     * æ£€æŸ¥å®ä¾‹å¥åº·çŠ¶æ€
     */
    private boolean isInstanceHealthy(ServiceInstance instance) {
        try {
            // 1. æ£€æŸ¥å…ƒæ•°æ®ä¸­çš„å¥åº·çŠ¶æ€
            String healthStatus = instance.getMetadata().get("health.status");
            if ("UNHEALTHY".equals(healthStatus)) {
                return false;
            }

            // 2. æ£€æŸ¥å®ä¾‹æ˜¯å¦åœ¨çº¿
            Boolean enabled = Boolean.valueOf(instance.getMetadata().get("instance.enabled"));
            if (enabled == null || !enabled) {
                return false;
            }

            // 3. æ£€æŸ¥æƒé‡æ˜¯å¦å¤§äº0
            if (instance.getWeight() <= 0) {
                return false;
            }

            return true;

        } catch (Exception e) {
            log.warn("æ£€æŸ¥å®ä¾‹å¥åº·çŠ¶æ€å¤±è´¥: instance={}", instance.getInstanceId(), e);
            return false;
        }
    }

    /**
     * åº”ç”¨å‘ç°ç­–ç•¥
     */
    private List<ServiceInstance> applyDiscoveryStrategy(List<ServiceInstance> instances,
                                                        DiscoveryStrategy strategy) {
        switch (strategy) {
            case PRIORITY_FIRST:
                return selectByPriority(instances);
            case ZONE_AWARE:
                return selectByZone(instances);
            case WEIGHT_BASED:
                return selectByWeight(instances);
            case VERSION_COMPATIBLE:
                return selectByVersion(instances);
            default:
                return instances;
        }
    }

    /**
     * ä¼˜å…ˆçº§é€‰æ‹©
     */
    private List<ServiceInstance> selectByPriority(List<ServiceInstance> instances) {
        return instances.stream()
                .sorted((i1, i2) -> {
                    String priority1 = i1.getMetadata().get("instance.priority");
                    String priority2 = i2.getMetadata().get("instance.priority");

                    int p1 = priority1 != null ? Integer.parseInt(priority1) : 0;
                    int p2 = priority2 != null ? Integer.parseInt(priority2) : 0;

                    return Integer.compare(p2, p1);  // é«˜ä¼˜å…ˆçº§åœ¨å‰
                })
                .collect(Collectors.toList());
    }

    /**
     * åŒºåŸŸæ„ŸçŸ¥é€‰æ‹©
     */
    private List<ServiceInstance> selectByZone(List<ServiceInstance> instances) {
        String currentZone = System.getProperty("service.zone", "default");

        return instances.stream()
                .filter(instance -> currentZone.equals(instance.getMetadata().get("service.zone")))
                .collect(Collectors.toList());
    }

    /**
     * æƒé‡é€‰æ‹©
     */
    private List<ServiceInstance> selectByWeight(List<ServiceInstance> instances) {
        // è®¡ç®—æ€»æƒé‡
        double totalWeight = instances.stream()
                .mapToDouble(ServiceInstance::getWeight)
                .sum();

        if (totalWeight <= 0) {
            return instances;
        }

        // åŸºäºæƒé‡éšæœºé€‰æ‹©
        double random = Math.random() * totalWeight;
        double currentWeight = 0;

        for (ServiceInstance instance : instances) {
            currentWeight += instance.getWeight();
            if (random <= currentWeight) {
                return Collections.singletonList(instance);
            }
        }

        return instances;
    }

    /**
     * ç‰ˆæœ¬å…¼å®¹é€‰æ‹©
     */
    private List<ServiceInstance> selectByVersion(List<ServiceInstance> instances) {
        String currentVersion = System.getProperty("service.version", "1.0.0");

        return instances.stream()
                .filter(instance -> isVersionCompatible(instance, currentVersion))
                .collect(Collectors.toList());
    }

    private boolean isVersionCompatible(ServiceInstance instance, String currentVersion) {
        String instanceVersion = instance.getMetadata().get("service.version");
        if (instanceVersion == null) {
            return true;
        }

        // ç®€å•çš„ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
        String[] currentParts = currentVersion.split("\\.");
        String[] instanceParts = instanceVersion.split("\\.");

        if (currentParts.length != 3 || instanceParts.length != 3) {
            return true;
        }

        // ä¸»ç‰ˆæœ¬å¿…é¡»ç›¸åŒ
        return currentParts[0].equals(instanceParts[0]);
    }

    /**
     * æœåŠ¡å‘ç°ç­–ç•¥æšä¸¾
     */
    public enum DiscoveryStrategy {
        PRIORITY_FIRST,    // ä¼˜å…ˆçº§ä¼˜å…ˆ
        ZONE_AWARE,        // åŒºåŸŸæ„ŸçŸ¥
        WEIGHT_BASED,      // æƒé‡ä¼˜å…ˆ
        VERSION_COMPATIBLE // ç‰ˆæœ¬å…¼å®¹
    }
}
```

### **3. é…ç½®ç®¡ç†é«˜çº§åŠŸèƒ½**

#### **åŠ¨æ€é…ç½®ç®¡ç†å™¨**
```java
/**
 * NacosåŠ¨æ€é…ç½®ç®¡ç†å™¨
 * æä¾›é«˜çº§çš„é…ç½®ç®¡ç†åŠŸèƒ½
 */
@Component
@Slf4j
public class NacosDynamicConfigManager {

    @Resource
    private NacosConfigProperties nacosConfigProperties;

    @Resource
    private ConfigService configService;

    @Resource
    private ApplicationEventPublisher eventPublisher;

    private final Map<String, ConfigurationListener> listeners = new ConcurrentHashMap<>();

    /**
     * ç›‘å¬é…ç½®å˜æ›´
     */
    @PostConstruct
    public void initializeConfigurationListeners() {
        log.info("åˆå§‹åŒ–Nacosé…ç½®ç›‘å¬å™¨...");

        try {
            // ç›‘å¬é€šç”¨é…ç½®
            addConfigListener("common-config.yaml", this::handleCommonConfigChange);

            // ç›‘å¬æ•°æ®åº“é…ç½®
            addConfigListener("database-config.yaml", this::handleDatabaseConfigChange);

            // ç›‘å¬æœåŠ¡ç‰¹å®šé…ç½®
            addConfigListener(getServiceSpecificConfigId(), this::handleServiceConfigChange);

            log.info("Nacosé…ç½®ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ");

        } catch (Exception e) {
            log.error("Nacosé…ç½®ç›‘å¬å™¨åˆå§‹åŒ–å¤±è´¥", e);
            throw new ConfigurationException("é…ç½®ç›‘å¬å™¨åˆå§‹åŒ–å¤±è´¥", e);
        }
    }

    /**
     * æ·»åŠ é…ç½®ç›‘å¬å™¨
     */
    private void addConfigListener(String dataId, ConfigurationChangeListener changeHandler) {
        try {
            String group = nacosConfigProperties.getGroup();

            ConfigurationListener listener = new ConfigurationListener() {
                @Override
                public void receiveConfigInfo(String configInfo) {
                    log.info("é…ç½®å˜æ›´é€šçŸ¥: dataId={}, group={}", dataId, group);

                    try {
                        changeHandler.onConfigChange(dataId, group, configInfo);

                        // å‘å¸ƒé…ç½®å˜æ›´äº‹ä»¶
                        ConfigurationChangeEvent event = new ConfigurationChangeEvent(
                                dataId, group, configInfo);
                        eventPublisher.publishEvent(event);

                    } catch (Exception e) {
                        log.error("é…ç½®å˜æ›´å¤„ç†å¤±è´¥: dataId={}", dataId, e);
                    }
                }
            };

            configService.addListener(dataId, group, listener);
            listeners.put(dataId, listener);

            log.info("é…ç½®ç›‘å¬å™¨æ·»åŠ æˆåŠŸ: dataId={}", dataId);

        } catch (Exception e) {
            log.error("æ·»åŠ é…ç½®ç›‘å¬å™¨å¤±è´¥: dataId={}", dataId, e);
        }
    }

    /**
     * å¤„ç†é€šç”¨é…ç½®å˜æ›´
     */
    private void handleCommonConfigChange(String dataId, String group, String configInfo) {
        log.info("å¤„ç†é€šç”¨é…ç½®å˜æ›´: dataId={}", dataId);

        try {
            // è§£æé…ç½®
            Yaml yaml = new Yaml();
            Map<String, Object> configMap = yaml.load(configInfo);

            // å¤„ç†æ—¥å¿—é…ç½®å˜æ›´
            handleLogLevelChange(configMap);

            // å¤„ç†ç›‘æ§é…ç½®å˜æ›´
            handleMonitoringConfigChange(configMap);

            // å¤„ç†ç¼“å­˜é…ç½®å˜æ›´
            handleCacheConfigChange(configMap);

            log.info("é€šç”¨é…ç½®å˜æ›´å¤„ç†å®Œæˆ");

        } catch (Exception e) {
            log.error("é€šç”¨é…ç½®å˜æ›´å¤„ç†å¤±è´¥", e);
            throw new ConfigurationException("é…ç½®å˜æ›´å¤„ç†å¤±è´¥", e);
        }
    }

    /**
     * å¤„ç†æ•°æ®åº“é…ç½®å˜æ›´
     */
    private void handleDatabaseConfigChange(String dataId, String group, String configInfo) {
        log.info("å¤„ç†æ•°æ®åº“é…ç½®å˜æ›´: dataId={}", dataId);

        try {
            // è§£ææ•°æ®åº“é…ç½®
            Yaml yaml = new Yaml();
            Map<String, Object> configMap = yaml.load(configInfo);

            // é‡æ–°é…ç½®æ•°æ®æº
            reconfigureDataSource(configMap);

            // éªŒè¯æ•°æ®åº“è¿æ¥
            validateDatabaseConnection();

            log.info("æ•°æ®åº“é…ç½®å˜æ›´å¤„ç†å®Œæˆ");

        } catch (Exception e) {
            log.error("æ•°æ®åº“é…ç½®å˜æ›´å¤„ç†å¤±è´¥", e);
            throw new ConfigurationException("æ•°æ®åº“é…ç½®å˜æ›´å¤„ç†å¤±è´¥", e);
        }
    }

    /**
     * å¤„ç†æœåŠ¡ç‰¹å®šé…ç½®å˜æ›´
     */
    private void handleServiceConfigChange(String dataId, String group, String configInfo) {
        log.info("å¤„ç†æœåŠ¡ç‰¹å®šé…ç½®å˜æ›´: dataId={}", dataId);

        try {
            // è§£ææœåŠ¡é…ç½®
            Yaml yaml = new Yaml();
            Map<String, Object> configMap = yaml.load(configInfo);

            // å¤„ç†ä¸šåŠ¡é…ç½®å˜æ›´
            handleBusinessConfigChange(configMap);

            // å¤„ç†æ€§èƒ½é…ç½®å˜æ›´
            handlePerformanceConfigChange(configMap);

            // å¤„ç†å®‰å…¨é…ç½®å˜æ›´
            handleSecurityConfigChange(configMap);

            log.info("æœåŠ¡ç‰¹å®šé…ç½®å˜æ›´å¤„ç†å®Œæˆ");

        } catch (Exception e) {
            log.error("æœåŠ¡ç‰¹å®šé…ç½®å˜æ›´å¤„ç†å¤±è´¥", e);
            throw new ConfigurationException("æœåŠ¡é…ç½®å˜æ›´å¤„ç†å¤±è´¥", e);
        }
    }

    /**
     * åŠ¨æ€æ›´æ–°æ—¥å¿—çº§åˆ«
     */
    private void handleLogLevelChange(Map<String, Object> configMap) {
        Map<String, Object> logging = (Map<String, Object>) configMap.get("logging");
        if (logging != null) {
            String level = (String) logging.get("level");
            if (level != null) {
                // åŠ¨æ€æ›´æ–°æ—¥å¿—çº§åˆ«
                updateLogLevel(level);
                log.info("æ—¥å¿—çº§åˆ«åŠ¨æ€æ›´æ–°: level={}", level);
            }
        }
    }

    /**
     * éªŒè¯æ•°æ®åº“è¿æ¥
     */
    private void validateDatabaseConnection() {
        // å®ç°æ•°æ®åº“è¿æ¥éªŒè¯é€»è¾‘
        log.info("æ•°æ®åº“è¿æ¥éªŒè¯å®Œæˆ");
    }

    /**
     * è·å–æœåŠ¡ç‰¹å®šé…ç½®ID
     */
    private String getServiceSpecificConfigId() {
        String serviceName = nacosConfigProperties.getName();
        return serviceName + ".yaml";
    }

    /**
     * æ¸…ç†é…ç½®ç›‘å¬å™¨
     */
    @PreDestroy
    public void cleanup() {
        log.info("æ¸…ç†Nacosé…ç½®ç›‘å¬å™¨...");

        listeners.forEach((dataId, listener) -> {
            try {
                configService.removeListener(dataId, nacosConfigProperties.getGroup(), listener);
                log.info("é…ç½®ç›‘å¬å™¨ç§»é™¤æˆåŠŸ: dataId={}", dataId);
            } catch (Exception e) {
                log.error("ç§»é™¤é…ç½®ç›‘å¬å™¨å¤±è´¥: dataId={}", dataId, e);
            }
        });

        listeners.clear();
        log.info("Nacosé…ç½®ç›‘å¬å™¨æ¸…ç†å®Œæˆ");
    }

    /**
     * é…ç½®å˜æ›´ç›‘å¬å™¨æ¥å£
     */
    @FunctionalInterface
    public interface ConfigurationChangeListener {
        void onConfigChange(String dataId, String group, String configInfo);
    }
}
```

---

## ğŸ“Š NacosæœåŠ¡æ²»ç†æœ€ä½³å®è·µ

### **1. é›†ç¾¤éƒ¨ç½²æœ€ä½³å®è·µ**

#### **Docker Composeé›†ç¾¤éƒ¨ç½²**
```yaml
# docker-compose.nacos-cluster.yml
version: '3.8'

services:
  nacos1:
    image: nacos/nacos-server:v2.2.3
    container_name: nacos-server-1
    environment:
      - MODE=cluster
      - SPRING_APPLICATION_NAME=nacos-server
      - NACOS_SERVER_PORT=8848
      - NACOS_APPLICATION_PORT=8848
      - PREFER_HOST_MODE=hostname
      - NACOS_SERVERS="nacos1:8848 nacos2:8848 nacos3:8848"
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_PORT=3306
      - MYSQL_SERVICE_USER=nacos
      - MYSQL_SERVICE_PASSWORD=nacos123
      - JVM_XMS=512m
      - JVM_XMX=512m
      - JVM_XMN=256m
    volumes:
      - ./cluster-logs/nacos1:/home/nacos/logs
      - ./data/nacos1:/home/nacos/data
    ports:
      - "8848:8848"
      - "9848:9848"
    networks:
      - nacos-network

  nacos2:
    image: nacos/nacos-server:v2.2.3
    container_name: nacos-server-2
    environment:
      - MODE=cluster
      - SPRING_APPLICATION_NAME=nacos-server
      - NACOS_SERVER_PORT=8848
      - NACOS_APPLICATION_PORT=8848
      - PREFER_HOST_MODE=hostname
      - NACOS_SERVERS="nacos1:8848 nacos2:8848 nacos3:8848"
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_PORT=3306
      - MYSQL_SERVICE_USER=nacos
      - MYSQL_SERVICE_PASSWORD=nacos123
      - JVM_XMS=512m
      - JVM_XMX=512m
      - JVM_XMN=256m
    volumes:
      - ./cluster-logs/nacos2:/home/nacos/logs
      - ./data/nacos2:/home/nacos/data
    ports:
      - "8849:8848"
      - "9849:9848"
    networks:
      - nacos-network

  nacos3:
    image: nacos/nacos-server:v2.2.3
    container_name: nacos-server-3
    environment:
      - MODE=cluster
      - SPRING_APPLICATION_NAME=nacos-server
      - NACOS_SERVER_PORT=8848
      - NACOS_APPLICATION_PORT=8848
      - PREFER_HOST_MODE=hostname
      - NACOS_SERVERS="nacos1:8848 nacos2:8848 nacos3:8848"
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_PORT=3306
      - MYSQL_SERVICE_USER=nacos
      - MYSQL_SERVICE_PASSWORD=nacos123
      - JVM_XMS=512m
      - JVM_XMX=512m
      - JVM_XMN=256m
    volumes:
      - ./cluster-logs/nacos3:/home/nacos/logs
      - ./data/nacos3:/home/nacos/data
    ports:
      - "8850:8848"
      - "9850:9848"
    networks:
      - nacos-network

  nginx:
    image: nginx:alpine
    container_name: nacos-nginx
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    ports:
      - "80:80"
    depends_on:
      - nacos1
      - nacos2
      - nacos3
    networks:
      - nacos-network

  mysql:
    image: mysql:8.0
    container_name: nacos-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=nacos
      - MYSQL_USER=nacos
      - MYSQL_PASSWORD=nacos123
    volumes:
      - ./mysql-data:/var/lib/mysql
      - ./mysql-init:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"
    networks:
      - nacos-network

networks:
  nacos-network:
    driver: bridge
```

#### **Nginxè´Ÿè½½å‡è¡¡é…ç½®**
```nginx
# nginx.conf
upstream nacos-cluster {
    least_conn;
    server nacos1:8848 max_fails=3 fail_timeout=30s;
    server nacos2:8848 max_fails=3 fail_timeout=30s;
    server nacos3:8848 max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name nacos-cluster;

    # Nacos API
    location /nacos/ {
        proxy_pass http://nacos-cluster;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

### **2. ç›‘æ§å’Œå‘Šè­¦é…ç½®**

#### **Prometheusç›‘æ§é…ç½®**
```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'nacos-metrics'
    static_configs:
      - targets: ['nacos1:8848', 'nacos2:8848', 'nacos3:8848']
    metrics_path: '/nacos/actuator/prometheus'
    scrape_interval: 10s

  - job_name: 'nacos-services'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
```

#### **Grafanaç›‘æ§é¢æ¿é…ç½®**
```json
{
  "dashboard": {
    "title": "NacosæœåŠ¡æ²»ç†ç›‘æ§",
    "panels": [
      {
        "title": "æœåŠ¡æ³¨å†Œæ•°é‡",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(nacos_service_count)",
            "legendFormat": "æ€»æœåŠ¡æ•°"
          }
        ]
      },
      {
        "title": "æœåŠ¡å®ä¾‹æ•°é‡",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(nacos_instance_count)",
            "legendFormat": "æ€»å®ä¾‹æ•°"
          }
        ]
      },
      {
        "title": "é…ç½®å˜æ›´é¢‘ç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(nacos_config_change_total[5m])",
            "legendFormat": "é…ç½®å˜æ›´ç‡"
          }
        ]
      },
      {
        "title": "æœåŠ¡å¥åº·çŠ¶æ€",
        "type": "table",
        "targets": [
          {
            "expr": "nacos_instance_healthy_count",
            "legendFormat": "å¥åº·å®ä¾‹æ•°"
          }
        ]
      }
    ]
  }
}
```

---

## ğŸ“‹ NacosæœåŠ¡æ²»ç†æ£€æŸ¥æ¸…å•

### **âœ… é›†ç¾¤éƒ¨ç½²æ£€æŸ¥ï¼ˆå¿…é¡»100%å®Œæˆï¼‰**

#### **åŸºç¡€è®¾æ–½éƒ¨ç½²**
- [ ] Nacosé›†ç¾¤3èŠ‚ç‚¹éƒ¨ç½²å®Œæˆ
- [ ] MySQLæ•°æ®åº“é›†ç¾¤é…ç½®å®Œæˆ
- [ ] Nginxè´Ÿè½½å‡è¡¡é…ç½®å®Œæˆ
- [ ] é›†ç¾¤ç½‘ç»œè¿é€šæ€§éªŒè¯é€šè¿‡
- [ ] æ•°æ®æŒä¹…åŒ–å­˜å‚¨é…ç½®å®Œæˆ

#### **é«˜å¯ç”¨é…ç½®**
- [ ] é›†ç¾¤èŠ‚ç‚¹é—´å¿ƒè·³æ£€æµ‹æ­£å¸¸
- [ ] ä¸»ä»é€‰ä¸¾æœºåˆ¶é…ç½®å®Œæˆ
- [ ] æ•…éšœè‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½éªŒè¯
- [ ] æ•°æ®åŒæ­¥æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] é›†ç¾¤æ¢å¤æœºåˆ¶æµ‹è¯•é€šè¿‡

### **âœ… æœåŠ¡æ³¨å†Œå‘ç°æ£€æŸ¥ï¼ˆå¿…é¡»100%é€šè¿‡ï¼‰**

#### **æœåŠ¡æ³¨å†ŒåŠŸèƒ½**
- [ ] æ‰€æœ‰33ä¸ªå¾®æœåŠ¡æ³¨å†Œå®Œæˆ
- [ ] æœåŠ¡å®ä¾‹å…ƒæ•°æ®é…ç½®å®Œæ•´
- [ ] å¥åº·æ£€æŸ¥æœºåˆ¶é…ç½®æ­£ç¡®
- [ ] æœåŠ¡æƒé‡åˆ†é…åˆç†
- [ ] æœåŠ¡åˆ†ç»„ç®¡ç†è§„èŒƒ

#### **æœåŠ¡å‘ç°åŠŸèƒ½**
- [ ] æœåŠ¡å‘ç°å“åº”æ—¶é—´â‰¤2s
- [ ] æœåŠ¡å®ä¾‹åˆ—è¡¨å‡†ç¡®ç‡99.9%
- [ ] è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®æ­£ç¡®
- [ ] æ•…éšœå®ä¾‹è‡ªåŠ¨å‰”é™¤
- [ ] æœåŠ¡è·¯ç”±é…ç½®ä¼˜åŒ–

### **âœ… é…ç½®ç®¡ç†æ£€æŸ¥ï¼ˆå¿…é¡»100%è¾¾æ ‡ï¼‰**

#### **é…ç½®ä¸­å¿ƒåŠŸèƒ½**
- [ ] æ‰€æœ‰é…ç½®çº³å…¥Nacosç®¡ç†
- [ ] é…ç½®ç‰ˆæœ¬ç®¡ç†æœºåˆ¶å®Œå–„
- [ ] é…ç½®å˜æ›´å®æ—¶æ¨é€
- [ ] é…ç½®å›æ»šåŠŸèƒ½æ­£å¸¸
- [ ] é…ç½®åŠ å¯†å®‰å…¨é…ç½®

#### **åŠ¨æ€é…ç½®èƒ½åŠ›**
- [ ] é…ç½®çƒ­æ›´æ–°åŠŸèƒ½éªŒè¯
- [ ] é…ç½®ç›‘å¬å™¨æ­£å¸¸å·¥ä½œ
- [ ] é…ç½®å˜æ›´å®¡è®¡æ—¥å¿—å®Œæ•´
- [ ] é…ç½®æƒé™ç®¡ç†è§„èŒƒ
- [ ] é…ç½®å¤‡ä»½ç­–ç•¥å®Œå–„

---

## ğŸš¨ Nacosæ²»ç†ç›‘æ§å‘Šè­¦

### **å…³é”®ç›‘æ§æŒ‡æ ‡**

#### **æœåŠ¡æ²»ç†å¥åº·æŒ‡æ ‡**
- **æœåŠ¡æ³¨å†ŒæˆåŠŸç‡**: â‰¥99.9%
- **æœåŠ¡å‘ç°å‡†ç¡®ç‡**: â‰¥99.9%
- **é…ç½®ç®¡ç†è¦†ç›–ç‡**: 100%
- **é›†ç¾¤å¯ç”¨æ€§**: â‰¥99.9%
- **æ•…éšœè½¬ç§»æ—¶é—´**: â‰¤10s

#### **æ€§èƒ½æŒ‡æ ‡**
- **æœåŠ¡æ³¨å†Œå»¶è¿Ÿ**: â‰¤500ms
- **æœåŠ¡å‘ç°å»¶è¿Ÿ**: â‰¤2s
- **é…ç½®æ¨é€å»¶è¿Ÿ**: â‰¤3s
- **é›†ç¾¤åŒæ­¥å»¶è¿Ÿ**: â‰¤5s
- **ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡**: â‰¤80%

### **å‘Šè­¦è§„åˆ™é…ç½®**

#### **æœåŠ¡æ²»ç†å‘Šè­¦è§„åˆ™**
```yaml
groups:
  - name: nacos_service_governance_alerts
    rules:
      - alert: NacosClusterDown
        expr: up{job="nacos"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Nacosé›†ç¾¤å®•æœº"
          description: "Nacosé›†ç¾¤èŠ‚ç‚¹å…¨éƒ¨å®•æœºï¼ŒæœåŠ¡æ²»ç†åŠŸèƒ½ä¸å¯ç”¨"

      - alert: ServiceRegistrationFailure
        expr: increase(nacos_service_registration_failure_total[5m]) > 10
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "æœåŠ¡æ³¨å†Œå¤±è´¥ç‡è¿‡é«˜"
          description: "è¿‡å»5åˆ†é’Ÿå†…æœåŠ¡æ³¨å†Œå¤±è´¥æ¬¡æ•°è¶…è¿‡10æ¬¡"

      - alert: ServiceDiscoveryTimeout
        expr: histogram_quantile(0.95, rate(nacos_discovery_duration_seconds_bucket[5m])) > 5
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "æœåŠ¡å‘ç°è¶…æ—¶"
          description: "95%çš„æœåŠ¡å‘ç°è¯·æ±‚è¶…è¿‡5ç§’"

      - alert: ConfigurationChangeFailure
        expr: increase(nacos_config_change_failure_total[5m]) > 5
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "é…ç½®å˜æ›´å¤±è´¥"
          description: "è¿‡å»5åˆ†é’Ÿå†…é…ç½®å˜æ›´å¤±è´¥æ¬¡æ•°è¶…è¿‡5æ¬¡"

      - alert: UnhealthyInstanceRatio
        expr: nacos_unhealthy_instance_count / nacos_total_instance_count > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ä¸å¥åº·å®ä¾‹æ¯”ä¾‹è¿‡é«˜"
          description: "ä¸å¥åº·å®ä¾‹æ¯”ä¾‹è¶…è¿‡10%"
```

---

## ğŸ”— ç›¸å…³æŠ€èƒ½æ–‡æ¡£

- **microservice-architecture-specialist**: å¾®æœåŠ¡æ¶æ„ä¸“å®¶
- **distributed-tracing-specialist**: åˆ†å¸ƒå¼è¿½è¸ªä¸“å®¶
- **configuration-security-specialist**: é…ç½®å®‰å…¨ä¸“å®¶
- **load-balancing-specialist**: è´Ÿè½½å‡è¡¡ä¸“å®¶
- **monitoring-system-specialist**: ç›‘æ§ç³»ç»Ÿä¸“å®¶

---

## ğŸ“ è”ç³»å’Œæ”¯æŒ

**æŠ€èƒ½è´Ÿè´£äºº**: NacosæœåŠ¡æ²»ç†ä¸“å®¶å›¢é˜Ÿ
**æŠ€æœ¯æ”¯æŒ**: æ¶æ„å¸ˆå›¢é˜Ÿ + è¿ç»´å›¢é˜Ÿ
**7x24ç›‘æ§**: é›†ç¾¤å¥åº·ç›‘æ§

**è”ç³»æ–¹å¼**:
- **é›†ç¾¤æ•…éšœ**: nacos-cluster@ioedream.com
- **æœåŠ¡æ²»ç†å’¨è¯¢**: nacos-governance@ioedream.com
- **æŠ€æœ¯æ”¯æŒçƒ­çº¿**: nacos-support@ioedream.com

**ç‰ˆæœ¬ä¿¡æ¯**:
- **åˆ›å»ºæ—¶é—´**: 2025-12-02
- **æœ€åæ›´æ–°**: 2025-12-02
- **ç‰ˆæœ¬**: v1.0.0
- **å®æ–½ç­‰çº§**: P0çº§æœåŠ¡æ²»ç†

---

## ğŸš¨ ç´§æ€¥å®æ–½è®¡åˆ’

**ç«‹å³æ‰§è¡Œï¼ˆ24å°æ—¶å†…å®Œæˆï¼‰**ï¼š
1. **éƒ¨ç½²Nacosé›†ç¾¤**: 3èŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²å®Œæˆ
2. **é…ç½®MySQLé›†ç¾¤**: æ•°æ®åº“é›†ç¾¤é…ç½®å®Œæˆ
3. **é›†æˆæ‰€æœ‰å¾®æœåŠ¡**: 33ä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯é…ç½®å®Œæˆ

**ä¸€å‘¨å†…å®Œæˆ**ï¼š
1. **æœåŠ¡æ²»ç†åŠŸèƒ½**: å®Œå–„æœåŠ¡æ³¨å†Œå‘ç°æœºåˆ¶
2. **é…ç½®ç®¡ç†ä¼˜åŒ–**: å®ç°åŠ¨æ€é…ç½®ç®¡ç†
3. **ç›‘æ§å‘Šè­¦é…ç½®**: Prometheus + Grafanaç›‘æ§éƒ¨ç½²

**ä¸¤å‘¨å†…å®Œæˆ**ï¼š
1. **é«˜å¯ç”¨ä¼˜åŒ–**: æ•…éšœè½¬ç§»å’Œæ¢å¤æœºåˆ¶
2. **æ€§èƒ½è°ƒä¼˜**: é›†ç¾¤æ€§èƒ½ä¼˜åŒ–å’Œè´Ÿè½½å‡è¡¡
3. **å›¢é˜ŸåŸ¹è®­**: NacosæœåŠ¡æ²»ç†ä½¿ç”¨åŸ¹è®­

---

**ğŸ’¡ æœ€é‡è¦æé†’**: æœ¬æŠ€èƒ½è§£å†³IOE-DREAMé¡¹ç›®æœ€ä¸¥é‡çš„P0çº§æœåŠ¡æ²»ç†ç¼ºå¤±é—®é¢˜ã€‚33ä¸ªå¾®æœåŠ¡çš„NacosæœåŠ¡æ²»ç†å¿…é¡»åœ¨72å°æ—¶å†…å®ŒæˆåŸºç¡€éƒ¨ç½²ï¼Œå¦åˆ™å°†æ— æ³•æœ‰æ•ˆç®¡ç†å¾®æœåŠ¡æ¶æ„ã€‚NacosæœåŠ¡æ²»ç†æ˜¯å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒåŸºç¡€ï¼Œå¿…é¡»ç«‹å³å®æ–½ï¼