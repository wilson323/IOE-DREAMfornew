# è€ƒå‹¤ç®¡ç†ä¸“å®¶ - Attendance Management Specialist

**ğŸ¯ æŠ€èƒ½å®šä½**: ä¸“ç²¾äºä¼ä¸šçº§è€ƒå‹¤ç®¡ç†ç³»ç»Ÿçš„è®¾è®¡ã€å¼€å‘å’Œè¿ç»´æŠ€æœ¯ä¸“å®¶

**âš¡ æŠ€èƒ½ç­‰çº§**: â˜…â˜…â˜… (é«˜çº§ä¸“å®¶)
**ğŸ¯ é€‚ç”¨åœºæ™¯**: æ™ºæ…§å›­åŒºè€ƒå‹¤ç®¡ç†ã€ä¼ä¸šOAç³»ç»Ÿã€äººåŠ›èµ„æºç®¡ç†ç³»ç»Ÿ
**ğŸ“Š æŠ€èƒ½è¦†ç›–**: Attendance Management | Time Tracking | Leave Management | Workforce Analytics

---

## ğŸ“‹ æŠ€èƒ½æ¦‚è¿°

### **æ ¸å¿ƒä¸“é•¿**
- **è€ƒå‹¤ç³»ç»Ÿè®¾è®¡**: ä¼ä¸šçº§è€ƒå‹¤ç®¡ç†ç³»ç»Ÿçš„æ¶æ„è®¾è®¡å’ŒåŠŸèƒ½å®ç°
- **è€ƒå‹¤è§„åˆ™å¼•æ“**: çµæ´»çš„è€ƒå‹¤è§„åˆ™é…ç½®å’Œæ‰§è¡Œæœºåˆ¶
- **è®¾å¤‡é›†æˆ**: å¤šç§è€ƒå‹¤è®¾å¤‡ï¼ˆæŒ‡çº¹ã€äººè„¸ã€ICå¡ã€æ‰‹æœºAPPï¼‰çš„ç»Ÿä¸€æ¥å…¥
- **æ•°æ®åˆ†æ**: è€ƒå‹¤æ•°æ®ç»Ÿè®¡åˆ†æã€å¼‚å¸¸æ£€æµ‹ã€æŠ¥è¡¨ç”Ÿæˆ
- **è¯·å‡ç®¡ç†**: è¯·å‡æµç¨‹è®¾è®¡ã€å®¡æ‰¹æµç¨‹ã€å‡æœŸç»Ÿè®¡ç®¡ç†

### **è§£å†³èƒ½åŠ›**
- **å¤šè®¾å¤‡è€ƒå‹¤**: æ”¯æŒæŒ‡çº¹æœºã€äººè„¸è¯†åˆ«æœºã€ICå¡è¯»å¡å™¨ã€ç§»åŠ¨APPç­‰
- **çµæ´»è€ƒå‹¤è§„åˆ™**: æ”¯æŒæ ‡å‡†å·¥æ—¶ã€å¼¹æ€§å·¥æ—¶ã€è½®ç­åˆ¶ã€å¤–å‹¤ç­‰å¤šç§è€ƒå‹¤æ¨¡å¼
- **å¼‚å¸¸å¤„ç†**: è¿Ÿåˆ°ã€æ—©é€€ã€æ—·å·¥ã€åŠ ç­ç­‰å¼‚å¸¸æƒ…å†µçš„è‡ªåŠ¨è¯†åˆ«å’Œå¤„ç†
- **æ•°æ®åˆ†æ**: è€ƒå‹¤æ•°æ®çš„å¤šç»´åº¦ç»Ÿè®¡åˆ†æï¼Œä¸ºäººåŠ›èµ„æºå†³ç­–æä¾›æ”¯æŒ

---

## ğŸ› ï¸ æŠ€æœ¯èƒ½åŠ›çŸ©é˜µ

### **è€ƒå‹¤æŠ€æœ¯æ ˆ**
```
ğŸ”´ æ ¸å¿ƒæŠ€æœ¯ (ç²¾é€š)
â”œâ”€â”€ è€ƒå‹¤ç®—æ³•: åŠ ç­è®¡ç®—ã€è¿Ÿåˆ°åˆ¤æ–­ã€å·¥æ—¶ç»Ÿè®¡
â”œâ”€â”€ è®¾å¤‡åè®®: è€ƒå‹¤æœºé€šè®¯åè®®ã€æ•°æ®åŒæ­¥
â”œâ”€â”€ è§„åˆ™å¼•æ“: è€ƒå‹¤è§„åˆ™é…ç½®ã€æ‰§è¡Œå¼•æ“
â”œâ”€â”€ æ•°æ®åˆ†æ: è€ƒå‹¤ç»Ÿè®¡ã€å¼‚å¸¸æ£€æµ‹ã€è¶‹åŠ¿åˆ†æ
â”œâ”€â”€ ç§»åŠ¨ç«¯: æ‰‹æœºæ‰“å¡ã€å®šä½è€ƒå‹¤ã€è“ç‰™è€ƒå‹¤

ğŸŸ¡ æ¶æ„è®¾è®¡ (ç†Ÿç»ƒ)
â”œâ”€â”€ å¾®æœåŠ¡æ¶æ„: è€ƒå‹¤æœåŠ¡ã€è®¾å¤‡æœåŠ¡ã€æ•°æ®åˆ†ææœåŠ¡
â”œâ”€â”€ æ•°æ®åº“è®¾è®¡: è€ƒå‹¤è®°å½•ã€è§„åˆ™é…ç½®ã€ç»Ÿè®¡æ•°æ®
â”œâ”€â”€ ç¼“å­˜ç­–ç•¥: è€ƒå‹¤æ•°æ®ç¼“å­˜ã€è§„åˆ™ç¼“å­˜
â”œâ”€â”€ æ¶ˆæ¯é˜Ÿåˆ—: è®¾å¤‡æ•°æ®åŒæ­¥ã€å¼‚æ­¥å¤„ç†

ğŸŸ¢ ä¸šåŠ¡é›†æˆ (æŒæ¡)
â”œâ”€â”€ äººèµ„ç³»ç»Ÿ: å‘˜å·¥ä¿¡æ¯ã€è–ªèµ„è®¡ç®—ã€ç»©æ•ˆç®¡ç†
â”œâ”€â”€ OAç³»ç»Ÿ: è¯·å‡å®¡æ‰¹ã€å·¥ä½œæµé›†æˆ
â”œâ”€â”€ ç¬¬ä¸‰æ–¹é›†æˆ: é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰è€ƒå‹¤é›†æˆ
â””â”€â”€ æŠ¥è¡¨ç³»ç»Ÿ: è€ƒå‹¤æŠ¥è¡¨å¯¼å‡ºã€æ•°æ®å¯è§†åŒ–
```

### **ä¸šåŠ¡åœºæ™¯è¦†ç›–**
```
âœ… ä¼ä¸šæ ‡å‡†è€ƒå‹¤ (1000+å‘˜å·¥)
âœ… è¿é”é—¨åº—è€ƒå‹¤ç®¡ç†
âœ… å¤–å‹¤äººå‘˜ç§»åŠ¨è€ƒå‹¤
âœ… å¼¹æ€§å·¥ä½œåˆ¶è€ƒå‹¤
âœ… è½®ç­åˆ¶è€ƒå‹¤ç®¡ç†
âœ… å­¦æ ¡è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ
```

---

## ğŸ¨ æ ¸å¿ƒä¸šåŠ¡æ¨¡å—

### **1. è€ƒå‹¤è®°å½•ç®¡ç†**
```java
@RestController
@RequestMapping("/api/attendance/record")
@Tag(name = "è€ƒå‹¤è®°å½•ç®¡ç†", description = "è€ƒå‹¤æ‰“å¡è®°å½•ç›¸å…³æ“ä½œ")
@Slf4j
public class AttendanceRecordController {

    @Resource
    private AttendanceRecordService attendanceRecordService;

    @PostMapping("/clock-in")
    @Operation(summary = "å‘˜å·¥æ‰“å¡ç­¾åˆ°")
    @SaCheckPermission("attendance:record:clock-in")
    public ResponseDTO<AttendanceClockResult> clockIn(@RequestBody @Valid AttendanceClockInForm form) {
        log.info("å‘˜å·¥æ‰“å¡ç­¾åˆ°: employeeId={}, location={}", form.getEmployeeId(), form.getLocation());

        try {
            AttendanceClockResult result = attendanceRecordService.clockIn(form);

            // ä½¿ç”¨ç»Ÿä¸€ç¼“å­˜æ¶æ„å­˜å‚¨æ‰“å¡è®°å½•ï¼Œä½¿ç”¨å®æ—¶æ•°æ®ç±»å‹
            cacheService.set(CacheModule.ATTENDANCE, "clock-in",
                "record:" + result.getRecordId(), result, BusinessDataType.REALTIME);

            return ResponseDTO.ok(result, "æ‰“å¡æˆåŠŸ");
        } catch (Exception e) {
            log.error("æ‰“å¡å¤±è´¥: employeeId={}", form.getEmployeeId(), e);
            return ResponseDTO.error(SystemErrorCode.SYSTEM_ERROR, "æ‰“å¡å¤±è´¥: " + e.getMessage());
        }
    }

    @PostMapping("/clock-out")
    @Operation(summary = "å‘˜å·¥æ‰“å¡ç­¾é€€")
    @SaCheckPermission("attendance:record:clock-out")
    public ResponseDTO<AttendanceClockResult> clockOut(@RequestBody @Valid AttendanceClockOutForm form) {
        log.info("å‘˜å·¥æ‰“å¡ç­¾é€€: employeeId={}", form.getEmployeeId());

        try {
            AttendanceClockResult result = attendanceRecordService.clockOut(form);
            return ResponseDTO.ok(result, "ç­¾é€€æˆåŠŸ");
        } catch (Exception e) {
            log.error("ç­¾é€€å¤±è´¥: employeeId={}", form.getEmployeeId(), e);
            return ResponseDTO.error(SystemErrorCode.SYSTEM_ERROR, "ç­¾é€€å¤±è´¥: " + e.getMessage());
        }
    }

    @GetMapping("/query")
    @Operation(summary = "æŸ¥è¯¢è€ƒå‹¤è®°å½•")
    @SaCheckPermission("attendance:record:query")
    public ResponseDTO<PageResult<AttendanceRecordVO>> queryRecords(
            @Valid PageParam pageParam,
            @RequestParam(required = false) Long employeeId,
            @RequestParam(required = false) @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate startDate,
            @RequestParam(required = false) @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate endDate) {

        AttendanceQueryForm queryForm = AttendanceQueryForm.builder()
            .employeeId(employeeId)
            .startDate(startDate)
            .endDate(endDate)
            .build();

        PageResult<AttendanceRecordVO> result = attendanceRecordService.queryRecords(pageParam, queryForm);
        return ResponseDTO.ok(result);
    }
}
```

### **2. è€ƒå‹¤è§„åˆ™å¼•æ“**
```java
@Service
@Slf4j
public class AttendanceRuleEngineService {

    @Resource
    private UnifiedCacheService cacheService;

    @Resource
    private AttendanceRuleRepository ruleRepository;

    /**
     * è€ƒå‹¤è§„åˆ™éªŒè¯
     */
    public AttendanceValidationResult validateAttendance(AttendanceRecordEntity record) {
        try {
            // 1. è·å–é€‚ç”¨çš„è€ƒå‹¤è§„åˆ™
            List<AttendanceRuleEntity> rules = getApplicableRules(record.getEmployeeId(), record.getRecordDate());

            // 2. è§„åˆ™éªŒè¯
            AttendanceValidationResult result = AttendanceValidationResult.builder()
                .recordId(record.getRecordId())
                .employeeId(record.getEmployeeId())
                .recordDate(record.getRecordDate())
                .build();

            for (AttendanceRuleEntity rule : rules) {
                ValidationResult validationResult = validateRule(record, rule);
                result.addValidationResult(validationResult);
            }

            // 3. å¼‚å¸¸æ£€æµ‹
            detectAnomalies(record, result);

            // 4. ç¼“å­˜éªŒè¯ç»“æœï¼Œä½¿ç”¨è¿‘å®æ—¶æ•°æ®ç±»å‹
            cacheService.set(CacheModule.ATTENDANCE, "validation",
                "result:" + record.getRecordId(), result, BusinessDataType.NEAR_REALTIME);

            return result;
        } catch (Exception e) {
            log.error("è€ƒå‹¤è§„åˆ™éªŒè¯å¤±è´¥: recordId={}", record.getRecordId(), e);
            return AttendanceValidationResult.error("è§„åˆ™éªŒè¯å¤±è´¥");
        }
    }

    /**
     * è¿Ÿåˆ°æ—©é€€æ£€æµ‹
     */
    private void detectAnomalies(AttendanceRecordEntity record, AttendanceValidationResult result) {
        try {
            // 1. è·å–å½“å¤©æ ‡å‡†å·¥ä½œå®‰æ’
            WorkScheduleEntity schedule = getWorkSchedule(record.getEmployeeId(), record.getRecordDate());

            if (schedule == null) {
                result.addAnomaly(AttendanceAnomaly.NO_SCHEDULE);
                return;
            }

            // 2. ä¸Šç­æ—¶é—´æ£€æŸ¥
            if (record.getClockInTime() != null && record.getClockInTime().isAfter(schedule.getWorkStartTime())) {
                long lateMinutes = ChronoUnit.MINUTES.between(schedule.getWorkStartTime(), record.getClockInTime());
                if (lateMinutes > schedule.getLateTolerance()) {
                    result.addAnomaly(AttendanceAnomaly.LATE, lateMinutes);
                }
            }

            // 3. ä¸‹ç­æ—¶é—´æ£€æŸ¥
            if (record.getClockOutTime() != null && record.getClockOutTime().isBefore(schedule.getWorkEndTime())) {
                long earlyMinutes = ChronoUnit.MINUTES.between(record.getClockOutTime(), schedule.getWorkEndTime());
                if (earlyMinutes > schedule.getEarlyTolerance()) {
                    result.addAnomaly(AttendanceAnomaly.EARLY_LEAVE, earlyMinutes);
                }
            }

        } catch (Exception e) {
            log.error("å¼‚å¸¸æ£€æµ‹å¤±è´¥: recordId={}", record.getRecordId(), e);
        }
    }

    /**
     * åŠ ç­æ—¶é—´è®¡ç®—
     */
    public OvertimeCalculationResult calculateOvertime(AttendanceRecordEntity record) {
        try {
            WorkScheduleEntity schedule = getWorkSchedule(record.getEmployeeId(), record.getRecordDate());

            if (record.getClockOutTime() == null || schedule == null) {
                return OvertimeCalculationResult.noOvertime();
            }

            // è®¡ç®—å·¥ä½œæ—¶é•¿
            long workDuration = ChronoUnit.MINUTES.between(record.getClockInTime(), record.getClockOutTime());
            long standardWorkMinutes = ChronoUnit.MINUTES.between(schedule.getWorkStartTime(), schedule.getWorkEndTime());

            // åˆ¤æ–­æ˜¯å¦åŠ ç­
            if (workDuration > standardWorkMinutes) {
                long overtimeMinutes = workDuration - standardWorkMinutes;

                // æ ¹æ®åŠ ç­è§„åˆ™è®¡ç®—åŠ ç­è´¹
                OvertimeRuleEntity overtimeRule = getOvertimeRule(record.getEmployeeId());
                BigDecimal overtimePay = calculateOvertimePay(overtimeMinutes, overtimeRule);

                return OvertimeCalculationResult.builder()
                    .hasOvertime(true)
                    .overtimeMinutes(overtimeMinutes)
                    .overtimePay(overtimePay)
                    .overtimeRate(overtimeRule.getRate())
                    .build();
            }

            return OvertimeCalculationResult.noOvertime();
        } catch (Exception e) {
            log.error("åŠ ç­è®¡ç®—å¤±è´¥: recordId={}", record.getRecordId(), e);
            return OvertimeCalculationResult.noOvertime();
        }
    }
}
```

### **3. è®¾å¤‡æ•°æ®åŒæ­¥**
```java
@Service
@Slf4j
public class AttendanceDeviceSyncService {

    @Resource
    private UnifiedCacheService cacheService;

    @Resource
    private DeviceCommunicationService deviceService;

    /**
     * è®¾å¤‡æ•°æ®åŒæ­¥
     */
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void syncDeviceData() {
        try {
            // 1. è·å–æ‰€æœ‰æ´»è·ƒè®¾å¤‡
            List<AttendanceDeviceEntity> devices = getActiveDevices();

            for (AttendanceDeviceEntity device : devices) {
                syncDeviceData(device);
            }

            log.info("è®¾å¤‡æ•°æ®åŒæ­¥å®Œæˆ: {}ä¸ªè®¾å¤‡", devices.size());
        } catch (Exception e) {
            log.error("è®¾å¤‡æ•°æ®åŒæ­¥å¤±è´¥", e);
        }
    }

    private void syncDeviceData(AttendanceDeviceEntity device) {
        try {
            // 1. ä»è®¾å¤‡è·å–è€ƒå‹¤è®°å½•
            List<DeviceAttendanceRecord> deviceRecords = deviceService.fetchRecords(device);

            // 2. è½¬æ¢ä¸ºç³»ç»Ÿè®°å½•æ ¼å¼
            List<AttendanceRecordEntity> attendanceRecords = deviceRecords.stream()
                .map(record -> convertDeviceRecord(record, device))
                .collect(Collectors.toList());

            // 3. æ‰¹é‡ä¿å­˜è€ƒå‹¤è®°å½•
            if (!attendanceRecords.isEmpty()) {
                attendanceRecordRepository.batchInsert(attendanceRecords);

                // 4. æ›´æ–°è®¾å¤‡çŠ¶æ€
                updateDeviceStatus(device, DeviceStatus.SYNCED);

                // 5. ç¼“å­˜æœ€æ–°åŒæ­¥æ—¶é—´ï¼Œä½¿ç”¨ç¨³å®šæ•°æ®ç±»å‹
                cacheService.set(CacheModule.ATTENDANCE, "device-sync",
                    "last-sync:" + device.getDeviceId(),
                    System.currentTimeMillis(),
                    BusinessDataType.STABLE);
            }

        } catch (Exception e) {
            log.error("è®¾å¤‡æ•°æ®åŒæ­¥å¤±è´¥: deviceId={}", device.getDeviceId(), e);
            updateDeviceStatus(device, DeviceStatus.SYNC_FAILED);
        }
    }

    /**
     * ç§»åŠ¨ç«¯è€ƒå‹¤æ•°æ®åŒæ­¥
     */
    public void syncMobileAttendance(MobileAttendanceRecord mobileRecord) {
        try {
            // 1. éªŒè¯ä½ç½®ä¿¡æ¯
            if (!validateLocation(mobileRecord)) {
                throw new AttendanceException("ä½ç½®éªŒè¯å¤±è´¥");
            }

            // 2. è½¬æ¢ç§»åŠ¨ç«¯è®°å½•
            AttendanceRecordEntity attendanceRecord = AttendanceRecordEntity.builder()
                .employeeId(mobileRecord.getEmployeeId())
                .recordType(mobileRecord.getRecordType())
                .recordTime(mobileRecord.getRecordTime())
                .location(mobileRecord.getLocation())
                .deviceType(DeviceType.MOBILE)
                .latitude(mobileRecord.getLatitude())
                .longitude(mobileRecord.getLongitude())
                .build();

            // 3. ä¿å­˜è®°å½•
            attendanceRecordService.saveRecord(attendanceRecord);

            // 4. ç¼“å­˜ç§»åŠ¨ç«¯è®°å½•ï¼Œä½¿ç”¨å®æ—¶æ•°æ®ç±»å‹
            cacheService.set(CacheModule.ATTENDANCE, "mobile",
                "record:" + attendanceRecord.getRecordId(),
                attendanceRecord,
                BusinessDataType.REALTIME);

            log.info("ç§»åŠ¨ç«¯è€ƒå‹¤åŒæ­¥æˆåŠŸ: employeeId={}, recordType={}",
                     mobileRecord.getEmployeeId(), mobileRecord.getRecordType());

        } catch (Exception e) {
            log.error("ç§»åŠ¨ç«¯è€ƒå‹¤åŒæ­¥å¤±è´¥: employeeId={}", mobileRecord.getEmployeeId(), e);
            throw new AttendanceException("ç§»åŠ¨ç«¯è€ƒå‹¤åŒæ­¥å¤±è´¥: " + e.getMessage());
        }
    }
}
```

### **4. è€ƒå‹¤ç»Ÿè®¡åˆ†æ**
```java
@Service
@Slf4j
public class AttendanceAnalyticsService {

    @Resource
    private AttendanceRecordRepository recordRepository;

    @Resource
    private UnifiedCacheService cacheService;

    /**
     * å‘˜å·¥è€ƒå‹¤ç»Ÿè®¡
     */
    public AttendanceStatistics calculateEmployeeStatistics(Long employeeId, LocalDate startDate, LocalDate endDate) {
        try {
            // 1. æŸ¥è¯¢è€ƒå‹¤è®°å½•
            List<AttendanceRecordEntity> records = recordRepository.queryByEmployee(employeeId, startDate, endDate);

            // 2. ç»Ÿè®¡åˆ†æ
            AttendanceStatistics statistics = AttendanceStatistics.builder()
                .employeeId(employeeId)
                .statisticsPeriod(StatisticsPeriod.CUSTOM)
                .startDate(startDate)
                .endDate(endDate)
                .build();

            // 3. åŸºæœ¬ç»Ÿè®¡
            statistics.setTotalDays(records.size());
            statistics.setPresentDays(countPresentDays(records));
            statistics.setAbsentDays(countAbsentDays(records));
            statistics.setLateDays(countLateDays(records));
            statistics.setEarlyLeaveDays(countEarlyLeaveDays(records));

            // 4. å·¥æ—¶ç»Ÿè®¡
            statistics.setTotalWorkMinutes(calculateTotalWorkMinutes(records));
            statistics.setAverageWorkMinutes(calculateAverageWorkMinutes(records));
            statistics.setTotalOvertimeMinutes(calculateTotalOvertimeMinutes(records));

            // 5. å‡ºå‹¤ç‡è®¡ç®—
            statistics.setAttendanceRate(calculateAttendanceRate(statistics));

            // 6. ç¼“å­˜ç»Ÿè®¡ç»“æœï¼Œä½¿ç”¨æ­£å¸¸æ•°æ®ç±»å‹
            String cacheKey = "statistics:" + employeeId + ":" + startDate + ":" + endDate;
            cacheService.set(CacheModule.ATTENDANCE, "analytics",
                cacheKey, statistics, BusinessDataType.NORMAL);

            return statistics;
        } catch (Exception e) {
            log.error("å‘˜å·¥è€ƒå‹¤ç»Ÿè®¡å¤±è´¥: employeeId={}", employeeId, e);
            return null;
        }
    }

    /**
     * éƒ¨é—¨è€ƒå‹¤ç»Ÿè®¡
     */
    public DepartmentAttendanceStatistics calculateDepartmentStatistics(Long departmentId, LocalDate startDate, LocalDate endDate) {
        try {
            // 1. è·å–éƒ¨é—¨å‘˜å·¥
            List<Long> employeeIds = employeeService.getEmployeeIdsByDepartment(departmentId);

            // 2. å¹¶è¡Œç»Ÿè®¡
            List<AttendanceStatistics> employeeStatistics = employeeIds.parallelStream()
                .map(employeeId -> calculateEmployeeStatistics(employeeId, startDate, endDate))
                .filter(Objects::nonNull)
                .collect(Collectors.toList());

            // 3. éƒ¨é—¨æ±‡æ€»ç»Ÿè®¡
            DepartmentAttendanceStatistics departmentStats = DepartmentAttendanceStatistics.builder()
                .departmentId(departmentId)
                .startDate(startDate)
                .endDate(endDate)
                .build();

            // 4. æ±‡æ€»å„é¡¹æŒ‡æ ‡
            departmentStats.setEmployeeCount(employeeIds.size());
            departmentStats.setTotalWorkDays(employeeStatistics.stream().mapToLong(AttendanceStatistics::getTotalDays).sum());
            departmentStats.setTotalPresentDays(employeeStatistics.stream().mapToLong(AttendanceStatistics::getPresentDays).sum());
            departmentStats.setTotalAbsentDays(employeeStatistics.stream().mapToLong(AttendanceStatistics::getAbsentDays).sum());
            departmentStats.setTotalLateDays(employeeStatistics.stream().mapToLong(AttendanceStatistics::getLateDays).sum());
            departmentStats.setTotalOvertimeMinutes(employeeStatistics.stream().mapToLong(AttendanceStatistics::getTotalOvertimeMinutes).sum());

            // 5. è®¡ç®—éƒ¨é—¨æŒ‡æ ‡
            departmentStats.setDepartmentAttendanceRate(calculateDepartmentAttendanceRate(departmentStats));
            departmentStats.setAverageAttendanceRate(calculateAverageAttendanceRate(employeeStatistics));

            return departmentStats;
        } catch (Exception e) {
            log.error("éƒ¨é—¨è€ƒå‹¤ç»Ÿè®¡å¤±è´¥: departmentId={}", departmentId, e);
            return null;
        }
    }
}
```

---

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### **è€ƒå‹¤æ•°æ®ç¼“å­˜ä¼˜åŒ–**
```java
@Configuration
public class AttendanceCacheConfig {

    @Bean
    public AttendanceCacheManager cacheManager() {
        return AttendanceCacheManager.builder()
            .employeeInfoCacheDuration(Duration.ofHours(2))
            .ruleCacheDuration(Duration.ofMinutes(30))
            .statisticsCacheDuration(Duration.ofHours(1))
            .recordCacheDuration(Duration.ofMinutes(10))
            .build();
    }

    @Bean
    public AttendanceCacheEvictionScheduler cacheEvictionScheduler() {
        return new AttendanceCacheEvictionScheduler();
    }
}
```

### **æ‰¹é‡æ•°æ®å¤„ç†ä¼˜åŒ–**
```java
@Service
@Slf4j
public class AttendanceBatchProcessor {

    @Resource
    private AttendanceRecordRepository recordRepository;

    /**
     * æ‰¹é‡å¤„ç†è€ƒå‹¤è®°å½•
     */
    @Async
    public CompletableFuture<Void> batchProcessRecords(List<AttendanceRecordEntity> records) {
        return CompletableFuture.runAsync(() -> {
            try {
                // 1. åˆ†æ‰¹å¤„ç†
                int batchSize = 1000;
                for (int i = 0; i < records.size(); i += batchSize) {
                    int endIndex = Math.min(i + batchSize, records.size());
                    List<AttendanceRecordEntity> batch = records.subList(i, endIndex);

                    // 2. æ‰¹é‡éªŒè¯
                    validateBatchRecords(batch);

                    // 3. æ‰¹é‡ä¿å­˜
                    recordRepository.batchInsert(batch);

                    log.info("æ‰¹é‡å¤„ç†è€ƒå‹¤è®°å½•: {} æ¡", batch.size());
                }
            } catch (Exception e) {
                log.error("æ‰¹é‡å¤„ç†è€ƒå‹¤è®°å½•å¤±è´¥", e);
            }
        });
    }
}
```

---

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### **è€ƒå‹¤ç³»ç»Ÿç›‘æ§**
```java
@Component
@Slf4j
public class AttendanceSystemMonitor {

    @Resource
    private EnhancedCacheMetricsCollector metricsCollector;

    /**
     * è®¾å¤‡è¿æ¥ç›‘æ§
     */
    @Scheduled(fixedRate = 300000) // 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void monitorDeviceConnections() {
        try {
            List<AttendanceDeviceEntity> devices = deviceService.getAllDevices();

            for (AttendanceDeviceEntity device : devices) {
                boolean isConnected = deviceService.checkConnection(device);

                metricsCollector.recordModuleGauge(
                    CacheModule.ATTENDANCE,
                    "device_connection_status",
                    isConnected ? 1 : 0,
                    "device_type", device.getDeviceType().name(),
                    "device_id", device.getDeviceId().toString()
                );

                if (!isConnected) {
                    log.warn("è®¾å¤‡è¿æ¥å¼‚å¸¸: deviceId={}, deviceType={}",
                             device.getDeviceId(), device.getDeviceType());
                }
            }
        } catch (Exception e) {
            log.error("è®¾å¤‡è¿æ¥ç›‘æ§å¤±è´¥", e);
        }
    }

    /**
     * è€ƒå‹¤æ•°æ®è´¨é‡ç›‘æ§
     */
    @Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
    public void monitorDataQuality() {
        try {
            LocalDate yesterday = LocalDate.now().minusDays(1);

            // 1. æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
            DataQualityReport qualityReport = generateDataQualityReport(yesterday);

            // 2. æ£€æŸ¥å¼‚å¸¸æ•°æ®
            long anomalyCount = countAnomalyRecords(yesterday);

            metricsCollector.recordModuleGauge(
                CacheModule.ATTENDANCE,
                "data_quality_score",
                qualityReport.getQualityScore(),
                "date", yesterday.toString()
            );

            metricsCollector.recordModuleCounter(
                CacheModule.ATTENDANCE,
                "daily_anomaly_count",
                anomalyCount,
                "date", yesterday.toString()
            );

            log.info("æ•°æ®è´¨é‡ç›‘æ§å®Œæˆ: date={}, score={}, anomalies={}",
                     yesterday, qualityReport.getQualityScore(), anomalyCount);

        } catch (Exception e) {
            log.error("æ•°æ®è´¨é‡ç›‘æ§å¤±è´¥", e);
        }
    }
}
```

---

## ğŸ“ˆ å…³é”®æ€§èƒ½æŒ‡æ ‡

### **æ€§èƒ½ç›®æ ‡**
- **æ‰“å¡å“åº”æ—¶é—´**: â‰¤ 2ç§’
- **è§„åˆ™éªŒè¯æ—¶é—´**: â‰¤ 500ms
- **ç»Ÿè®¡åˆ†æå“åº”**: â‰¤ 3ç§’
- **è®¾å¤‡æ•°æ®åŒæ­¥**: â‰¤ 1åˆ†é’Ÿ
- **å¹¶å‘æ”¯æŒ**: 1000+ TPS

### **è´¨é‡æŒ‡æ ‡**
- **æ•°æ®å‡†ç¡®æ€§**: 99.9%
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.9%
- **è§„åˆ™è¦†ç›–åº¦**: 100%
- **å¼‚å¸¸æ£€æµ‹ç‡**: 95%+

---

## ğŸ“š æŠ€èƒ½åº”ç”¨æŒ‡å—

### **ä½¿ç”¨æ—¶æœº**
- **è€ƒå‹¤ç³»ç»Ÿå»ºè®¾**: è®¾è®¡å’Œéƒ¨ç½²ä¼ä¸šçº§è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ
- **è€ƒå‹¤è§„åˆ™é…ç½®**: é…ç½®å¤æ‚çš„è€ƒå‹¤è§„åˆ™å’Œå‡æœŸå®‰æ’
- **è®¾å¤‡é›†æˆ**: æ¥å…¥å„ç§è€ƒå‹¤è®¾å¤‡å’Œç§»åŠ¨ç«¯åº”ç”¨
- **æ•°æ®åˆ†æ**: è€ƒå‹¤æ•°æ®åˆ†æå’ŒäººåŠ›èµ„æºå†³ç­–æ”¯æŒ

### **è°ƒç”¨æ–¹å¼**
```bash
# è€ƒå‹¤ç³»ç»Ÿè®¾è®¡
Skill("attendance-management-specialist")

# è€ƒå‹¤è§„åˆ™é…ç½®
Skill("attendance-management-specialist")

# è®¾å¤‡é›†æˆå¼€å‘
Skill("attendance-management-specialist")
```

### **é¢„æœŸç»“æœ**
- **å®Œæ•´è€ƒå‹¤ç³»ç»Ÿ**: æ”¯æŒå¤šè®¾å¤‡ã€å¤šè§„åˆ™çš„è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ
- **æ™ºèƒ½è§„åˆ™å¼•æ“**: çµæ´»é…ç½®å’Œæ‰§è¡Œçš„è€ƒå‹¤è§„åˆ™ç³»ç»Ÿ
- **æ•°æ®åˆ†æèƒ½åŠ›**: å®Œæ•´çš„è€ƒå‹¤æ•°æ®åˆ†æå’ŒæŠ¥è¡¨åŠŸèƒ½
- **é«˜å¯ç”¨æ¶æ„**: å…·å¤‡æ•…éšœæ¢å¤å’Œæ€§èƒ½ä¼˜åŒ–çš„ç³»ç»Ÿè®¾è®¡

---

**æŒæ¡æ­¤æŠ€èƒ½ï¼Œæ‚¨å°†æˆä¸ºä¼ä¸šçº§è€ƒå‹¤ç®¡ç†ç³»ç»Ÿçš„æŠ€æœ¯ä¸“å®¶ï¼Œèƒ½å¤Ÿè®¾è®¡å’Œå®ç°åŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜ç§€çš„è€ƒå‹¤ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚**