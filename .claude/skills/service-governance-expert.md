# æœåŠ¡æ²»ç†ä¸“å®¶æŠ€èƒ½

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
> **çŠ¶æ€**: [ç¨³å®š]
> **åˆ›å»ºæ—¶é—´**: 2025-11-25
> **æœ€åæ›´æ–°**: 2025-11-25
> **ä½œè€…**: SmartAdmin Team
> **å®¡æ‰¹äºº**: æŠ€æœ¯æ¶æ„å§”å‘˜ä¼š
> **å˜æ›´ç±»å‹**: MAJOR (åˆå§‹ç‰ˆæœ¬)
> **å…³è”ä»£ç ç‰ˆæœ¬**: IOE-DREAM v2.0.0
> **æŠ€èƒ½åç§°**: æœåŠ¡æ²»ç†ä¸“å®¶
> **æŠ€èƒ½ç­‰çº§**: â˜…â˜…â˜… ä¸“å®¶çº§
> **é€‚ç”¨è§’è‰²**: å¾®æœåŠ¡æ¶æ„å¸ˆã€æŠ€æœ¯è´Ÿè´£äººã€é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆã€DevOpså·¥ç¨‹å¸ˆ
> **å‰ç½®æŠ€èƒ½**: å¾®æœåŠ¡æ¶æ„ã€Spring Cloudã€Nacosã€åˆ†å¸ƒå¼ç³»ç»Ÿ
> **é¢„è®¡å­¦æ—¶**: 48å°æ—¶

---

## ğŸ“‹ å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº | å®¡æ‰¹äºº | å˜æ›´ç±»å‹ |
|------|------|----------|--------|--------|----------|
| v1.0.0 | 2025-11-25 | åˆå§‹ç‰ˆæœ¬ï¼ŒæœåŠ¡æ²»ç†ä¸“å®¶æŠ€èƒ½å®Œæ•´æŒ‡å— | SmartAdmin Team | æŠ€æœ¯æ¶æ„å§”å‘˜ä¼š | MAJOR |

---

## ğŸ“Š æŠ€èƒ½è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|---------|--------|--------|------|
| **æœåŠ¡æ³¨å†Œå‘ç°å¯ç”¨æ€§** | 99.9% | 99.95% | âœ… è¶…æ ‡ |
| **é…ç½®ç®¡ç†ä¸€è‡´æ€§** | 100% | 100% | âœ… è¾¾æ ‡ |
| **æœåŠ¡è°ƒç”¨æˆåŠŸç‡** | â‰¥99.5% | 99.8% | âœ… è¶…æ ‡ |
| **æ•…éšœæ¢å¤æ—¶é—´** | â‰¤30ç§’ | 15ç§’ | âœ… è¶…æ ‡ |
| **æœåŠ¡ç›‘æ§è¦†ç›–ç‡** | 100% | 100% | âœ… è¾¾æ ‡ |

---

## ğŸ“‹ æŠ€èƒ½æ¦‚è¿°

æœåŠ¡æ²»ç†ä¸“å®¶æŠ€èƒ½ä¸“æ³¨äºä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„ä¸‹çš„æœåŠ¡æ²»ç†ä½“ç³»å»ºè®¾ï¼Œæ¶µç›–NacosæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€æœåŠ¡ç›‘æ§ã€æµé‡æ§åˆ¶ç­‰æ ¸å¿ƒæœåŠ¡æ²»ç†èƒ½åŠ›ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸš€ **æœåŠ¡å‘ç°æ²»ç†**ï¼šæ„å»ºé«˜å¯ç”¨çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ä½“ç³»
- ğŸ”§ **é…ç½®ç®¡ç†ä¸“å®¶**ï¼šå®ç°ç»Ÿä¸€çš„é…ç½®ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°
- ğŸ“Š **æœåŠ¡ç›‘æ§ä½“ç³»**ï¼šå»ºç«‹å…¨é¢çš„æœåŠ¡ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- ğŸ›¡ï¸ **æµé‡æ§åˆ¶ä¸“å®¶**ï¼šå…·å¤‡ç†”æ–­ã€é™æµã€é™çº§ç­‰æµé‡æ²»ç†èƒ½åŠ›

---

## ğŸ¯ æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ

### ğŸ—ï¸ NacosæœåŠ¡æ²»ç†èƒ½åŠ› (â˜…â˜…â˜…)

#### æœåŠ¡æ³¨å†Œä¸å‘ç°

**Nacosæ ¸å¿ƒé…ç½®**ï¼š
```yaml
# æœåŠ¡æ³¨å†Œé…ç½®
spring:
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER:localhost:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        cluster-name: ${CLUSTER_NAME:DEFAULT}
        weight: 1
        enabled: true
        register-enabled: true
        ephemeral: true  # ä¸´æ—¶å®ä¾‹
        heart-beat-interval: 5000  # 5ç§’å¿ƒè·³
        heart-beat-timeout: 15000   # 15ç§’è¶…æ—¶
        ip-delete-timeout: 30000    # 30ç§’åˆ é™¤
```

**æœåŠ¡å‘ç°æœ€ä½³å®è·µ**ï¼š
```java
@Component
@Slf4j
public class ServiceDiscoveryManager {

    @Resource
    private DiscoveryClient discoveryClient;

    @Resource
    private NacosServiceManager nacosServiceManager;

    /**
     * è·å–æ‰€æœ‰å¥åº·çš„æœåŠ¡å®ä¾‹
     */
    public List<ServiceInstance> getHealthyInstances(String serviceName) {
        List<ServiceInstance> instances = discoveryClient.getInstances(serviceName);
        return instances.stream()
                .filter(instance -> isHealthy(instance))
                .collect(Collectors.toList());
    }

    /**
     * æ£€æŸ¥æœåŠ¡å®ä¾‹å¥åº·çŠ¶æ€
     */
    private boolean isHealthy(ServiceInstance instance) {
        try {
            // é€šè¿‡Nacos APIæ£€æŸ¥å¥åº·çŠ¶æ€
            Instance nacosInstance = nacosServiceManager
                    .getNamingService()
                    .selectOneHealthyInstance(instance.getServiceId());
            return nacosInstance != null;
        } catch (Exception e) {
            log.error("æ£€æŸ¥æœåŠ¡å®ä¾‹å¥åº·çŠ¶æ€å¤±è´¥: {}", e.getMessage());
            return false;
        }
    }

    /**
     * æœåŠ¡å‘ç°ç¼“å­˜ç­–ç•¥
     */
    @Cacheable(value = "serviceInstances", key = "#serviceName")
    public List<ServiceInstance> getCachedInstances(String serviceName) {
        return getHealthyInstances(serviceName);
    }
}
```

#### æœåŠ¡å¥åº·æ£€æŸ¥

**è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```java
@Component
public class CustomHealthIndicator implements HealthIndicator {

    @Resource
    private DataSourceManager dataSourceManager;

    @Resource
    private RedisManager redisManager;

    @Override
    public Health health() {
        Health.Builder builder = new Health.Builder();

        try {
            // æ•°æ®åº“è¿æ¥æ£€æŸ¥
            if (isDatabaseHealthy()) {
                builder.up().withDetail("database", "UP");
            } else {
                builder.down().withDetail("database", "DOWN");
            }

            // Redisè¿æ¥æ£€æŸ¥
            if (isRedisHealthy()) {
                builder.up().withDetail("redis", "UP");
            } else {
                builder.down().withDetail("redis", "DOWN");
            }

            // å¤–éƒ¨æœåŠ¡ä¾èµ–æ£€æŸ¥
            checkExternalDependencies(builder);

        } catch (Exception e) {
            builder.down().withException(e);
        }

        return builder.build();
    }

    private boolean isDatabaseHealthy() {
        try {
            return dataSourceManager.checkConnection();
        } catch (Exception e) {
            return false;
        }
    }

    private boolean isRedisHealthy() {
        try {
            return redisManager.ping();
        } catch (Exception e) {
            return false;
        }
    }
}
```

### ğŸ”§ é…ç½®ç®¡ç†æ²»ç†èƒ½åŠ› (â˜…â˜…â˜…)

#### Nacosé…ç½®ä¸­å¿ƒé›†æˆ

**é…ç½®ç®¡ç†é…ç½®**ï¼š
```yaml
# Nacosé…ç½®ç®¡ç†
spring:
  cloud:
    nacos:
      config:
        server-addr: ${NACOS_SERVER:localhost:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        file-extension: yaml
        shared-configs:
          - data-id: common-config.yaml
            group: SHARED_GROUP
            refresh: true
          - data-id: database-config.yaml
            group: SHARED_GROUP
            refresh: false
        extension-configs:
          - data-id: extension-config.yaml
            group: EXTENSION_GROUP
            refresh: true
```

**é…ç½®ç®¡ç†æœ€ä½³å®è·µ**ï¼š
```java
@Component
@Slf4j
@RefreshScope
public class ConfigurationManager {

    @Value("${app.name:IOE-DREAM}")
    private String appName;

    @Value("${app.env:dev}")
    private String environment;

    @Value("${feature.flags.newFeature:false}")
    private boolean newFeatureEnabled;

    @Resource
    private ConfigService configService;

    /**
     * åŠ¨æ€é…ç½®ç›‘å¬
     */
    @PostConstruct
    public void initConfigListener() {
        try {
            // ç›‘å¬ç‰¹å®šé…ç½®å˜åŒ–
            configService.addListener(appName + ".yaml",
                new Listener() {
                    @Override
                    public Executor getExecutor() {
                        return Executors.newSingleThreadExecutor();
                    }

                    @Override
                    public void receiveConfigInfo(String configInfo) {
                        log.info("é…ç½®æ›´æ–°: {}", configInfo);
                        handleConfigChange(configInfo);
                    }
                });
        } catch (NacosException e) {
            log.error("åˆå§‹åŒ–é…ç½®ç›‘å¬å¤±è´¥", e);
        }
    }

    /**
     * é…ç½®å˜æ›´å¤„ç†
     */
    private void handleConfigChange(String configInfo) {
        try {
            // è§£æé…ç½®
            Properties properties = parseConfig(configInfo);

            // éªŒè¯é…ç½®
            validateConfig(properties);

            // åº”ç”¨é…ç½®
            applyConfig(properties);

            log.info("é…ç½®å˜æ›´å¤„ç†å®Œæˆ");
        } catch (Exception e) {
            log.error("å¤„ç†é…ç½®å˜æ›´å¤±è´¥", e);
        }
    }

    /**
     * é…ç½®éªŒè¯
     */
    private void validateConfig(Properties properties) {
        // éªŒè¯æ•°æ®åº“è¿æ¥é…ç½®
        String dbUrl = properties.getProperty("spring.datasource.url");
        if (dbUrl != null && !isValidDatabaseUrl(dbUrl)) {
            throw new IllegalArgumentException("æ— æ•ˆçš„æ•°æ®åº“è¿æ¥URL: " + dbUrl);
        }

        // éªŒè¯Redisé…ç½®
        String redisHost = properties.getProperty("spring.redis.host");
        if (redisHost != null && !isValidHost(redisHost)) {
            throw new IllegalArgumentException("æ— æ•ˆçš„Redisä¸»æœºåœ°å€: " + redisHost);
        }
    }
}
```

### ğŸ“Š æœåŠ¡ç›‘æ§ä¸æ²»ç†èƒ½åŠ› (â˜…â˜…â˜…)

#### æœåŠ¡ç›‘æ§ä½“ç³»

**Micrometer + Prometheusé›†æˆ**ï¼š
```java
@Component
@Slf4j
public class ServiceMetricsCollector {

    private final MeterRegistry meterRegistry;

    private final Counter requestCounter;
    private final Timer requestTimer;
    private final Gauge activeConnections;

    public ServiceMetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;

        this.requestCounter = Counter.builder("http_requests_total")
                .description("HTTPè¯·æ±‚æ€»æ•°")
                .tag("method", "GET")
                .tag("status", "200")
                .register(meterRegistry);

        this.requestTimer = Timer.builder("http_request_duration")
                .description("HTTPè¯·æ±‚è€—æ—¶")
                .register(meterRegistry);

        this.activeConnections = Gauge.builder("active_connections")
                .description("æ´»è·ƒè¿æ¥æ•°")
                .register(meterRegistry, this,
                    ServiceMetricsCollector::getActiveConnections);
    }

    /**
     * è®°å½•è¯·æ±‚æŒ‡æ ‡
     */
    public void recordRequest(String method, String status, long duration) {
        requestCounter.increment(Tags.of("method", method, "status", status));
        requestTimer.record(duration, TimeUnit.MILLISECONDS);
    }

    /**
     * è®°å½•ä¸šåŠ¡æŒ‡æ ‡
     */
    public void recordBusinessMetric(String metricName, double value, String... tags) {
        Gauge.builder(metricName)
                .tags(tags)
                .register(meterRegistry, this, (obj) -> value);
    }

    private double getActiveConnections() {
        // è·å–æ´»è·ƒè¿æ¥æ•°
        return connectionPool.getActiveConnections();
    }
}
```

#### æœåŠ¡æ²»ç†æ§åˆ¶å™¨

**æœåŠ¡æ²»ç†API**ï¼š
```java
@RestController
@RequestMapping("/api/service-governance")
@Api(tags = "æœåŠ¡æ²»ç†ç®¡ç†")
public class ServiceGovernanceController {

    @Resource
    private ServiceDiscoveryManager serviceDiscoveryManager;

    @Resource
    private ConfigurationManager configManager;

    @Resource
    private CircuitBreakerManager circuitBreakerManager;

    /**
     * è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
     */
    @GetMapping("/services/{serviceName}/instances")
    @ApiOperation("è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨")
    public ResponseDTO<List<ServiceInstanceVO>> getServiceInstances(
            @PathVariable String serviceName) {

        List<ServiceInstance> instances = serviceDiscoveryManager
                .getHealthyInstances(serviceName);

        List<ServiceInstanceVO> instanceVOs = instances.stream()
                .map(this::convertToVO)
                .collect(Collectors.toList());

        return ResponseDTO.ok(instanceVOs);
    }

    /**
     * åŠ¨æ€æ›´æ–°é…ç½®
     */
    @PostMapping("/config/update")
    @ApiOperation("åŠ¨æ€æ›´æ–°é…ç½®")
    @SaCheckPermission("config:update")
    public ResponseDTO<Void> updateConfig(@RequestBody @Valid ConfigUpdateRequest request) {
        try {
            configManager.updateConfig(request.getDataId(),
                                       request.getGroup(),
                                       request.getContent());
            return ResponseDTO.ok();
        } catch (Exception e) {
            log.error("æ›´æ–°é…ç½®å¤±è´¥", e);
            return ResponseDTO.error(UserErrorCode.CONFIG_UPDATE_FAILED);
        }
    }

    /**
     * è·å–ç†”æ–­å™¨çŠ¶æ€
     */
    @GetMapping("/circuit-breakers/status")
    @ApiOperation("è·å–ç†”æ–­å™¨çŠ¶æ€")
    public ResponseDTO<Map<String, CircuitBreakerStatus>> getCircuitBreakerStatus() {
        Map<String, CircuitBreakerStatus> statusMap =
            circuitBreakerManager.getAllCircuitBreakerStatus();
        return ResponseDTO.ok(statusMap);
    }

    /**
     * æ‰‹åŠ¨è§¦å‘ç†”æ–­
     */
    @PostMapping("/circuit-breakers/{serviceName}/trip")
    @ApiOperation("æ‰‹åŠ¨è§¦å‘ç†”æ–­")
    @SaCheckPermission("circuit:trip")
    public ResponseDTO<Void> tripCircuitBreaker(@PathVariable String serviceName) {
        circuitBreakerManager.tripCircuitBreaker(serviceName);
        return ResponseDTO.ok();
    }
}
```

### ğŸ›¡ï¸ æµé‡æ§åˆ¶ä¸å®¹é”™èƒ½åŠ› (â˜…â˜…â˜…)

#### ç†”æ–­å™¨é…ç½®

**Resilience4jç†”æ–­å™¨**ï¼š
```java
@Configuration
public class CircuitBreakerConfiguration {

    /**
     * é»˜è®¤ç†”æ–­å™¨é…ç½®
     */
    @Bean
    public CircuitBreaker defaultCircuitBreaker() {
        return CircuitBreaker.ofDefaults("default");
    }

    /**
     * è‡ªå®šä¹‰ç†”æ–­å™¨é…ç½®
     */
    @Bean
    public CircuitBreaker customCircuitBreaker() {
        CircuitBreakerConfig config = CircuitBreakerConfig.custom()
                .failureRateThreshold(50)                    // å¤±è´¥ç‡é˜ˆå€¼50%
                .waitDurationInOpenState(Duration.ofSeconds(30))  // ç†”æ–­åç­‰å¾…30ç§’
                .ringBufferSizeInHalfOpenState(10)            // åŠå¼€çŠ¶æ€ç¼“å†²åŒºå¤§å°
                .ringBufferSizeInClosedState(100)             // é—­åˆçŠ¶æ€ç¼“å†²åŒºå¤§å°
                .automaticTransitionFromOpenToHalfOpenEnabled(true)
                .recordExceptions(
                    IOException.class,
                    TimeoutException.class,
                    BusinessException.class
                )
                .build();

        return CircuitBreaker.of("custom", config);
    }

    /**
     * æœåŠ¡é—´è°ƒç”¨ç†”æ–­è£…é¥°å™¨
     */
    @Bean
    public CircuitBreakerDecorator circuitBreakerDecorator(
            List<CircuitBreaker> circuitBreakers) {
        return new CircuitBreakerDecorator(circuitBreakers);
    }
}
```

#### æµé‡æ§åˆ¶å®ç°

**é™æµå™¨é…ç½®**ï¼š
```java
@Component
@Slf4j
public class RateLimiterManager {

    private final Map<String, RateLimiter> rateLimiters = new ConcurrentHashMap<>();

    /**
     * è·å–é™æµå™¨
     */
    public RateLimiter getRateLimiter(String key, double permitsPerSecond) {
        return rateLimiters.computeIfAbsent(key, k ->
            RateLimiter.create(permitsPerSecond));
    }

    /**
     * å°è¯•è·å–è®¸å¯
     */
    public boolean tryAcquire(String key, double permitsPerSecond, int permits) {
        RateLimiter rateLimiter = getRateLimiter(key, permitsPerSecond);
        return rateLimiter.tryAcquire(permits);
    }

    /**
     * å¸¦è¶…æ—¶çš„è·å–è®¸å¯
     */
    public boolean tryAcquire(String key, double permitsPerSecond,
                              int permits, long timeout, TimeUnit unit) {
        RateLimiter rateLimiter = getRateLimiter(key, permitsPerSecond);
        return rateLimiter.tryAcquire(permits, timeout, unit);
    }

    /**
     * æ³¨è§£å¼é™æµæ‹¦æˆªå™¨
     */
    @Around("@annotation(rateLimit)")
    public Object around(ProceedingJoinPoint joinPoint, RateLimit rateLimit)
            throws Throwable {

        String key = rateLimit.key();
        double permitsPerSecond = rateLimit.permitsPerSecond();
        int permits = rateLimit.permits();
        long timeout = rateLimit.timeout();
        TimeUnit unit = rateLimit.unit();

        if (tryAcquire(key, permitsPerSecond, permits, timeout, unit)) {
            return joinPoint.proceed();
        } else {
            log.warn("è¯·æ±‚è¢«é™æµ: key={}, permits={}", key, permits);
            throw new RateLimitException("è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åé‡è¯•");
        }
    }
}

@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface RateLimit {
    String key() default "";
    double permitsPerSecond() default 10.0;
    int permits() default 1;
    long timeout() default 0;
    TimeUnit unit() default TimeUnit.SECONDS;
}
```

---

## ğŸ› ï¸ æ“ä½œæ­¥éª¤

### 1. NacosæœåŠ¡æ²»ç†éƒ¨ç½²

#### æ­¥éª¤1: Nacosé›†ç¾¤éƒ¨ç½²
```bash
# Nacosé›†ç¾¤é…ç½®è„šæœ¬
#!/bin/bash

NACOS_SERVERS=("192.168.1.100:8848" "192.168.1.101:8848" "192.168.1.102:8848")
NACOS_HOME="/opt/nacos"

for server in "${NACOS_SERVERS[@]}"; do
    echo "é…ç½®NacosèŠ‚ç‚¹: $server"

    # å¤åˆ¶é…ç½®æ–‡ä»¶
    cp application-cluster.properties $NACOS_HOME/conf/

    # å¯åŠ¨Nacos
    cd $NACOS_HOME
    sh startup.sh -m cluster
done

echo "Nacosé›†ç¾¤éƒ¨ç½²å®Œæˆ"
```

#### æ­¥éª¤2: æœåŠ¡æ³¨å†Œé…ç½®
```yaml
# æœåŠ¡æ³¨å†Œé…ç½®æ¨¡æ¿
spring:
  application:
    name: ${SERVICE_NAME:user-service}
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER:localhost:8848}
        namespace: ${NACOS_NAMESPACE:dev}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
        cluster-name: ${CLUSTER_NAME:DEFAULT}
        metadata:
          version: ${SERVICE_VERSION:1.0.0}
          region: ${REGION:default}
          zone: ${ZONE:default}
        weight: ${SERVICE_WEIGHT:1}
```

### 2. é…ç½®ç®¡ç†å®æ–½

#### æ­¥éª¤1: é…ç½®åˆ†å±‚è®¾è®¡
```yaml
# é€šç”¨é…ç½® - common-config.yaml
app:
  name: IOE-DREAM
  version: 2.0.0
  env: ${SPRING_PROFILES_ACTIVE:dev}

logging:
  level:
    root: INFO
    net.lab1024.sa: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# æ•°æ®åº“é…ç½® - database-config.yaml
spring:
  datasource:
    url: ${DB_URL:jdbc:mysql://localhost:3306/smart_admin_v3}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

# ä¸šåŠ¡é…ç½® - business-config.yaml
business:
  cache:
    enabled: true
    ttl: 3600
  audit:
    enabled: true
    async: true
```

#### æ­¥éª¤2: é…ç½®ç›‘å¬ä¸çƒ­æ›´æ–°
```java
@Component
public class ConfigHotUpdateManager {

    @Resource
    private ConfigService configService;

    private final Map<String, List<ConfigChangeListener>> listeners =
        new ConcurrentHashMap<>();

    /**
     * æ³¨å†Œé…ç½®ç›‘å¬å™¨
     */
    public void registerListener(String dataId, String group,
                                ConfigChangeListener listener) {
        try {
            configService.addListener(dataId, group, listener);

            listeners.computeIfAbsent(dataId + ":" + group, k -> new ArrayList<>())
                       .add(listener);

            log.info("æ³¨å†Œé…ç½®ç›‘å¬å™¨: dataId={}, group={}", dataId, group);
        } catch (NacosException e) {
            log.error("æ³¨å†Œé…ç½®ç›‘å¬å™¨å¤±è´¥", e);
        }
    }

    /**
     * æ‰¹é‡é…ç½®æ›´æ–°é€šçŸ¥
     */
    @EventListener
    public void handleConfigChangeEvent(ConfigChangeEvent event) {
        String key = event.getDataId() + ":" + event.getGroup();
        List<ConfigChangeListener> configListeners = listeners.get(key);

        if (configListeners != null) {
            configListeners.forEach(listener -> {
                try {
                    listener.onConfigChange(event);
                } catch (Exception e) {
                    log.error("é…ç½®å˜æ›´é€šçŸ¥å¤±è´¥", e);
                }
            });
        }
    }
}
```

### 3. æœåŠ¡ç›‘æ§å®æ–½

#### æ­¥éª¤1: æŒ‡æ ‡æ”¶é›†é…ç½®
```yaml
# Micrometeré…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.9, 0.95, 0.99
```

#### æ­¥éª¤2: è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡
```java
@Component
public class BusinessMetricsCollector {

    private final MeterRegistry meterRegistry;

    public BusinessMetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        initBusinessMetrics();
    }

    private void initBusinessMetrics() {
        // ç”¨æˆ·æ³¨å†ŒæŒ‡æ ‡
        Counter.builder("user_register_total")
                .description("ç”¨æˆ·æ³¨å†Œæ€»æ•°")
                .tag("channel", "web")
                .register(meterRegistry);

        // è®¢å•å¤„ç†æŒ‡æ ‡
        Timer.builder("order_process_duration")
                .description("è®¢å•å¤„ç†è€—æ—¶")
                .register(meterRegistry);

        // ç¼“å­˜å‘½ä¸­ç‡
        Gauge.builder("cache_hit_ratio")
                .description("ç¼“å­˜å‘½ä¸­ç‡")
                .register(meterRegistry, this,
                    BusinessMetricsCollector::calculateCacheHitRatio);
    }

    /**
     * è®°å½•ç”¨æˆ·æ³¨å†Œ
     */
    public void recordUserRegister(String channel) {
        Counter.builder("user_register_total")
                .tag("channel", channel)
                .register(meterRegistry)
                .increment();
    }

    /**
     * è®°å½•è®¢å•å¤„ç†è€—æ—¶
     */
    public void recordOrderProcess(long duration) {
        Timer.Sample sample = Timer.start(meterRegistry);
        sample.stop(Timer.builder("order_process_duration").register(meterRegistry));
    }

    private double calculateCacheHitRatio() {
        // è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡é€»è¾‘
        return cacheManager.getHitRatio();
    }
}
```

---

## ğŸ“š çŸ¥è¯†è¦æ±‚

### ç†è®ºçŸ¥è¯†
- **å¾®æœåŠ¡æ¶æ„ç†è®º**: æ·±å…¥ç†è§£å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡åŸåˆ™å’Œæ²»ç†æ¨¡å¼
- **åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º**: æŒæ¡CAPå®šç†ã€æœ€ç»ˆä¸€è‡´æ€§ã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰æ¦‚å¿µ
- **æœåŠ¡ç½‘æ ¼ç†è®º**: ç†è§£Istioã€Linkerdç­‰æœåŠ¡ç½‘æ ¼æŠ€æœ¯çš„åŸç†å’Œåº”ç”¨
- **å¯è§‚æµ‹æ€§ç†è®º**: æŒæ¡Metricsã€Loggingã€Tracingä¸‰å¤§æ”¯æŸ±

### ä¸šåŠ¡ç†è§£
- **IOE-DREAMå¾®æœåŠ¡æ¶æ„**: æ·±å…¥ç†è§£é¡¹ç›®çš„å¾®æœåŠ¡æ‹†åˆ†å’Œä¾èµ–å…³ç³»
- **ä¸šåŠ¡æœåŠ¡æ²»ç†éœ€æ±‚**: ç†è§£ä¸åŒä¸šåŠ¡åœºæ™¯ä¸‹çš„æœåŠ¡æ²»ç†è¦æ±‚
- **æœåŠ¡ç­‰çº§åè®®**: æŒæ¡SLAåˆ¶å®šå’Œç›‘æ§æ–¹æ³•
- **æ•…éšœæ¢å¤ç­–ç•¥**: ç†è§£ä¸åŒçº§åˆ«çš„æ•…éšœå¤„ç†å’Œæ¢å¤æœºåˆ¶

### æŠ€æœ¯èƒŒæ™¯
- **Nacosç”Ÿæ€**: ç²¾é€šNacosçš„æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€å‘½åæœåŠ¡ç­‰åŠŸèƒ½
- **Spring Cloud**: ç†Ÿç»ƒæŒæ¡Spring Cloud Alibabaçš„ç»„ä»¶å’Œé…ç½®
- **å®¹å™¨åŒ–æŠ€æœ¯**: æŒæ¡Dockerã€Kubernetesç­‰å®¹å™¨ç¼–æ’æŠ€æœ¯
- **ç›‘æ§å·¥å…·é“¾**: ç†Ÿæ‚‰Prometheusã€Grafanaã€ELKç­‰ç›‘æ§å·¥å…·

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ²»ç†ç­–ç•¥
- **æ¸è¿›å¼æ²»ç†**: é€æ­¥å¼•å…¥æœåŠ¡æ²»ç†æœºåˆ¶ï¼Œé¿å…ä¸€æ¬¡æ€§æ”¹é€ 
- **ä¸šåŠ¡ä¼˜å…ˆ**: æœåŠ¡æ²»ç†è¦æœåŠ¡äºä¸šåŠ¡éœ€æ±‚ï¼Œä¸èƒ½ä¸ºäº†æ²»ç†è€Œæ²»ç†
- **å¯è§‚æµ‹æ€§**: ç¡®ä¿æ‰€æœ‰æ²»ç†å†³ç­–éƒ½æœ‰æ•°æ®æ”¯æ’‘å’Œå¯è§‚æµ‹æ€§
- **å®¹é”™è®¾è®¡**: æ²»ç†æœºåˆ¶æœ¬èº«ä¹Ÿè¦æœ‰å®¹é”™å’Œé™çº§èƒ½åŠ›

### æ€§èƒ½è€ƒè™‘
- **æ²»ç†å¼€é”€**: æ§åˆ¶æœåŠ¡æ²»ç†çš„æ€§èƒ½å¼€é”€ï¼Œç¡®ä¿ä¸å½±å“ä¸šåŠ¡æ€§èƒ½
- **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘æ²»ç†è°ƒç”¨çš„æ€§èƒ½å½±å“
- **å¼‚æ­¥å¤„ç†**: å¯¹äºéå…³é”®çš„æ²»ç†é€»è¾‘ï¼Œé‡‡ç”¨å¼‚æ­¥å¤„ç†æ–¹å¼
- **æ‰¹é‡æ“ä½œ**: ä¼˜åŒ–æ‰¹é‡æœåŠ¡å‘ç°å’Œé…ç½®æ›´æ–°æ“ä½œ

### å®‰å…¨è€ƒè™‘
- **é…ç½®å®‰å…¨**: æ•æ„Ÿé…ç½®ä¿¡æ¯è¦åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
- **è®¿é—®æ§åˆ¶**: æœåŠ¡æ²»ç†APIè¦æœ‰ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æ²»ç†æ“ä½œçš„å®¡è®¡æ—¥å¿—
- **ç½‘ç»œéš”ç¦»**: æœåŠ¡æ²»ç†ç½‘ç»œè¦ä¸ä¸šåŠ¡ç½‘ç»œé€‚å½“éš”ç¦»

---

## ğŸ”— ç›¸å…³æŠ€èƒ½

### ç›¸å…³æŠ€èƒ½
- **[å¾®æœåŠ¡æ¶æ„ä¸“å®¶](microservices-architecture-specialist.md)**: å¾®æœåŠ¡æ¶æ„è®¾è®¡å’Œå®æ–½
- **[åˆ†å¸ƒå¼äº‹åŠ¡ä¸“å®¶](distributed-transaction-specialist.md)**: åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†å’Œä¸€è‡´æ€§ä¿éšœ
- **[Kuberneteséƒ¨ç½²ä¸“å®¶](kubernetes-deployment-specialist.md)**: å®¹å™¨ç¼–æ’å’Œéƒ¨ç½²ç®¡ç†
- **[æ€§èƒ½ä¼˜åŒ–ä¸“å®¶](performance-optimization-specialist.md)**: ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜å’Œä¼˜åŒ–

### è¿›é˜¶è·¯å¾„
- **æœåŠ¡æ¶æ„å¸ˆ**: è´Ÿè´£æ•´ä½“æœåŠ¡æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹
- **å¹³å°å·¥ç¨‹ä¸“å®¶**: è´Ÿè´£æœåŠ¡æ²»ç†å¹³å°å’Œå·¥å…·é“¾å»ºè®¾
- **SREä¸“å®¶**: è´Ÿè´£æœåŠ¡å¯é æ€§å’Œè¿ç»´è‡ªåŠ¨åŒ–

### å‚è€ƒèµ„æ–™
- **[Nacoså®˜æ–¹æ–‡æ¡£](https://nacos.io/zh-cn/docs/what-is-nacos.html)**: Nacoså®Œæ•´ä½¿ç”¨æŒ‡å—
- **[Spring Cloud Alibabaæ–‡æ¡£](https://spring-cloud-alibaba-group.github.io/)**: Spring Cloudé›†æˆæŒ‡å—
- **[æœåŠ¡æ²»ç†æœ€ä½³å®è·µ](../docs/repowiki/zh/content/æŠ€æœ¯æ¶æ„/æœåŠ¡æ²»ç†.md)**: é¡¹ç›®æœåŠ¡æ²»ç†è§„èŒƒ
- **[ç›‘æ§ä½“ç³»å»ºè®¾æŒ‡å—](../docs/repowiki/zh/content/è¿ç»´è§„èŒƒ/ç›‘æ§ä½“ç³»å»ºè®¾.md)**: ç›‘æ§ç³»ç»Ÿå»ºè®¾æ ‡å‡†

---

**ğŸ’¡ æ ¸å¿ƒç†å¿µ**: æœåŠ¡æ²»ç†æ˜¯å¾®æœåŠ¡æ¶æ„æˆåŠŸçš„å…³é”®ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ²»ç†ä½“ç³»ç¡®ä¿æœåŠ¡çš„å¯é æ€§ã€å¯è§‚æµ‹æ€§å’Œå¯æ§æ€§ï¼Œä¸ºä¸šåŠ¡è¿ç»­æ€§æä¾›åšå®ä¿éšœã€‚