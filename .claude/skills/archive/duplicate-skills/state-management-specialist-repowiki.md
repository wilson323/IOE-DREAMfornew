# çŠ¶æ€ç®¡ç†ä¸“å®¶ (Repowikiæ ‡å‡†ç‰ˆ)

## ğŸ¯ æŠ€èƒ½å®šä½
**æ ¸å¿ƒèŒè´£**: åŸºäº `.qoder/repowiki` ä¸­çš„ã€ŠçŠ¶æ€ç®¡ç†è¯¦è§£ã€‹è§„èŒƒï¼Œç¡®ä¿IOE-DREAMé¡¹ç›®çŠ¶æ€ç®¡ç†ä¸¥æ ¼éµå¾ªPiniaæœ€ä½³å®è·µï¼Œæ„å»ºé«˜æ•ˆã€å¯ç»´æŠ¤çš„çŠ¶æ€ç®¡ç†ä½“ç³»

**âš¡ æŠ€èƒ½ç­‰çº§**: â˜…â˜…â˜…â˜…â˜… (çŠ¶æ€ç®¡ç†ä¸“å®¶)
**ğŸ¯ é€‚ç”¨åœºæ™¯**: çŠ¶æ€æ¶æ„è®¾è®¡ã€PiniaçŠ¶æ€ç®¡ç†ã€æ•°æ®æµä¼˜åŒ–ã€çŠ¶æ€æŒä¹…åŒ–ã€çŠ¶æ€æ€§èƒ½è°ƒä¼˜
**ğŸ“Š æŠ€èƒ½è¦†ç›–**: Piniaæ¶æ„è®¾è®¡ | çŠ¶æ€åˆ†å±‚ç®¡ç† | æ•°æ®æµæ§åˆ¶ | çŠ¶æ€æŒä¹…åŒ– | çŠ¶æ€æ€§èƒ½ä¼˜åŒ– | å¼€å‘ä½“éªŒä¼˜åŒ–

---

## ğŸ“‹ æŠ€èƒ½æ¦‚è¿° (åŸºäºRepowikiè§„èŒƒ)

### **æ ¸å¿ƒä¸“é•¿ (åŸºäº.qoder/repowiki/zh/content/å‰ç«¯æ¶æ„/çŠ¶æ€ç®¡ç†/)**
- **Piniaæ¶æ„å®ˆæŠ¤**: ä¸¥æ ¼ç¡®ä¿PiniaçŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ
- **çŠ¶æ€åˆ†å±‚è®¾è®¡**: æŒ‰ä¸šåŠ¡åŸŸè¿›è¡ŒçŠ¶æ€æ¨¡å—åŒ–åˆ†å±‚
- **æ•°æ®æµè§„èŒƒ**: å•å‘æ•°æ®æµå’ŒçŠ¶æ€å˜æ›´è§„èŒƒåŒ–
- **çŠ¶æ€æŒä¹…åŒ–**: æ™ºèƒ½çŠ¶æ€æŒä¹…åŒ–å’Œæ¢å¤æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**: çŠ¶æ€ç®¡ç†æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†

### **è§£å†³èƒ½åŠ›**
- **çŠ¶æ€æ¶æ„åˆè§„æ€§**: 100%ç¬¦åˆrepowikiçŠ¶æ€ç®¡ç†è§„èŒƒ
- **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**: ç§‘å­¦çš„çŠ¶æ€åˆ†å±‚å’Œæ•°æ®æµè®¾è®¡
- **çŠ¶æ€æ€§èƒ½é—®é¢˜**: çŠ¶æ€æ›´æ–°æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ä¼˜åŒ–
- **çŠ¶æ€æŒä¹…åŒ–**: æ™ºèƒ½çš„çŠ¶æ€æŒä¹…åŒ–å’Œæ¢å¤ç­–ç•¥
- **å¼€å‘ä½“éªŒ**: å®Œå–„çš„çŠ¶æ€ç®¡ç†å¼€å‘å·¥å…·å’Œè°ƒè¯•

---

## ğŸ—ï¸ RepowikiçŠ¶æ€ç®¡ç†è§„èŒƒ

### **çŠ¶æ€ç®¡ç†æ ¸å¿ƒåŸåˆ™**

#### **å•ä¸€æ•°æ®æºåŸåˆ™**
- **å…¨å±€çŠ¶æ€**: ä½¿ç”¨Piniaä½œä¸ºåº”ç”¨å”¯ä¸€çš„çŠ¶æ€ç®¡ç†ä¸­å¿ƒ
- **æ¨¡å—åŒ–è®¾è®¡**: æŒ‰ä¸šåŠ¡åŸŸå°†çŠ¶æ€åˆ†å‰²ä¸ºç‹¬ç«‹çš„storeæ¨¡å—
- **çŠ¶æ€éš”ç¦»**: å„æ¨¡å—çŠ¶æ€ç›¸äº’ç‹¬ç«‹ï¼Œé¿å…äº¤å‰ä¾èµ–
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨TypeScriptç¡®ä¿çŠ¶æ€ç±»å‹å®‰å…¨

#### **å•å‘æ•°æ®æµåŸåˆ™**
```
User Action â†’ Component â†’ Action â†’ Mutation â†’ State â†’ Component Update
     â†‘                                                              â†“
     â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI Update â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ State Change â†â”€â”€â”€â”€â”€â”€â”€â”€
```

#### **çŠ¶æ€åˆ†å±‚æ¶æ„**
```
src/stores/
â”œâ”€â”€ modules/               # ä¸šåŠ¡æ¨¡å—çŠ¶æ€
â”‚   â”œâ”€â”€ user/             # ç”¨æˆ·çŠ¶æ€æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ index.ts      # storeä¸»æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ types.ts      # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ actions.ts    # å¼‚æ­¥æ“ä½œ
â”‚   â”‚   â””â”€â”€ getters.ts    # è®¡ç®—å±æ€§
â”‚   â”œâ”€â”€ auth/             # è®¤è¯çŠ¶æ€æ¨¡å—
â”‚   â”œâ”€â”€ app/              # åº”ç”¨çŠ¶æ€æ¨¡å—
â”‚   â””â”€â”€ business/         # ä¸šåŠ¡çŠ¶æ€æ¨¡å—
â”œâ”€â”€ plugins/              # Piniaæ’ä»¶
â”‚   â”œâ”€â”€ persistence.ts    # çŠ¶æ€æŒä¹…åŒ–æ’ä»¶
â”‚   â”œâ”€â”€ logger.ts         # çŠ¶æ€å˜æ›´æ—¥å¿—æ’ä»¶
â”‚   â””â”€â”€ devtools.ts       # å¼€å‘å·¥å…·æ’ä»¶
â””â”€â”€ index.ts              # storeé…ç½®å’Œå¯¼å‡º
```

### **çŠ¶æ€æ¨¡å—åˆ†ç±»**

#### **1. æ ¸å¿ƒçŠ¶æ€æ¨¡å— (Core State)**
- **ç”¨æˆ·çŠ¶æ€**: ç™»å½•ä¿¡æ¯ã€æƒé™ã€ä¸ªäººè®¾ç½®
- **è®¤è¯çŠ¶æ€**: ç™»å½•çŠ¶æ€ã€tokenã€sessionç®¡ç†
- **åº”ç”¨çŠ¶æ€**: ä¸»é¢˜ã€è¯­è¨€ã€å¸ƒå±€é…ç½®

#### **2. ä¸šåŠ¡çŠ¶æ€æ¨¡å— (Business State)**
- **é¡µé¢çŠ¶æ€**: è¡¨å•æ•°æ®ã€åˆ—è¡¨çŠ¶æ€ã€ç­›é€‰æ¡ä»¶
- **UIçŠ¶æ€**: åŠ è½½çŠ¶æ€ã€é”™è¯¯çŠ¶æ€ã€å¼¹çª—çŠ¶æ€
- **ç¼“å­˜çŠ¶æ€**: APIæ•°æ®ç¼“å­˜ã€è®¡ç®—ç»“æœç¼“å­˜

#### **3. ä¸´æ—¶çŠ¶æ€æ¨¡å— (Temporary State)**
- **ç»„ä»¶çŠ¶æ€**: ç»„ä»¶å†…éƒ¨çŠ¶æ€ï¼Œä¸å­˜å‚¨åœ¨storeä¸­
- **ä¼šè¯çŠ¶æ€**: å½“å‰ä¼šè¯ç›¸å…³çš„ä¸´æ—¶æ•°æ®
- **å¯¼èˆªçŠ¶æ€**: è·¯ç”±å‚æ•°ã€é¡µé¢çŠ¶æ€

---

## ğŸ› ï¸ æ ¸å¿ƒå·¥ä½œæµç¨‹ (åŸºäºRepowiki)

### **Phase 1: çŠ¶æ€ç®¡ç†åˆè§„æ€§è¯Šæ–­**
```bash
# æ£€æŸ¥Piniaæ¶æ„åˆè§„æ€§
./scripts/check-pinia-architecture.sh

# æ£€æµ‹çŠ¶æ€æ¨¡å—è®¾è®¡
./scripts/analyze-state-modules.sh

# éªŒè¯çŠ¶æ€ç±»å‹å®‰å…¨
./scripts/validate-state-types.sh

# æ£€æŸ¥çŠ¶æ€æ€§èƒ½é—®é¢˜
./scripts/analyze-state-performance.sh
```

### **Phase 2: çŠ¶æ€æ¶æ„ä¼˜åŒ–**
```bash
# çŠ¶æ€æ¨¡å—é‡æ„
./scripts/refactor-state-modules.sh

# çŠ¶æ€ä¾èµ–ä¼˜åŒ–
./scripts/optimize-state-dependencies.sh

# çŠ¶æ€æŒä¹…åŒ–é…ç½®
./scripts/configure-state-persistence.sh

# çŠ¶æ€å¼€å‘å·¥å…·é…ç½®
./scripts/setup-state-devtools.sh
```

### **Phase 3: çŠ¶æ€è´¨é‡ä¿éšœ**
```bash
# çŠ¶æ€ç®¡ç†æµ‹è¯•
npm run test:state

# çŠ¶æ€å˜æ›´æµ‹è¯•
npm run test:state-mutations

# çŠ¶æ€æ€§èƒ½æµ‹è¯•
npm run test:state-performance

# çŠ¶æ€ä¸€è‡´æ€§æµ‹è¯•
npm run test:state-consistency
```

---

## ğŸ” çŠ¶æ€ç®¡ç†åˆè§„æ€§æ£€æŸ¥æ¸…å• (åŸºäºRepowiki)

### **âœ… å¼ºåˆ¶æ€§è§„èŒƒ (å¿…é¡»100%éµå¾ª)**

#### **Piniaä½¿ç”¨è§„èŒƒ**
- [ ] ä¸¥æ ¼ä½¿ç”¨Piniaè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œç¦ç”¨Vuex
- [ ] ä½¿ç”¨Composition APIé£æ ¼å®šä¹‰store (`defineStore`)
- [ ] çŠ¶æ€æ¨¡å—æŒ‰ä¸šåŠ¡åŸŸåˆ†å±‚ï¼Œé¿å…å•ä¸€å·¨å‹store
- [ ] çŠ¶æ€å˜æ›´å¿…é¡»é€šè¿‡actionsï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹çŠ¶æ€
- [ ] ä½¿ç”¨TypeScriptå®šä¹‰çŠ¶æ€ç±»å‹ï¼Œç¦æ­¢anyç±»å‹

#### **çŠ¶æ€è®¾è®¡è§„èŒƒ**
- [ ] çŠ¶æ€å‘½åè¯­ä¹‰åŒ–ï¼Œä½¿ç”¨camelCaseå‘½å
- [ ] çŠ¶æ€ç»“æ„æ‰å¹³åŒ–ï¼Œé¿å…æ·±å±‚åµŒå¥—
- [ ] è®¡ç®—å±æ€§ä½¿ç”¨getterï¼Œé¿å…åœ¨ç»„ä»¶ä¸­é‡å¤è®¡ç®—
- [ ] å¼‚æ­¥æ“ä½œä½¿ç”¨async/awaitï¼Œé”™è¯¯å¤„ç†å®Œå–„
- [ ] çŠ¶æ€å˜æ›´å¯é¢„æµ‹ï¼Œæ”¯æŒæ—¶é—´æ—…è¡Œè°ƒè¯•

#### **ç±»å‹å®‰å…¨è§„èŒƒ**
- [ ] å®šä¹‰å®Œæ•´çš„Stateã€Gettersã€Actionsæ¥å£
- [ ] ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼ï¼Œç¦æ­¢éšå¼any
- [ ] Actionå‚æ•°å’Œè¿”å›å€¼ç±»å‹æ˜ç¡®
- [ ] è®¡ç®—å±æ€§è¿”å›å€¼ç±»å‹å®šä¹‰å®Œæ•´
- [ ] æŒä¹…åŒ–æ•°æ®ç±»å‹éªŒè¯

### **âš ï¸ æ¨èæ€§è§„èŒƒ**

#### **æ€§èƒ½ä¼˜åŒ–è§„èŒƒ**
- [ ] å¤§å‹çŠ¶æ€å¯¹è±¡ä½¿ç”¨shallowRefä¼˜åŒ–
- [ ] é¢‘ç¹å˜æ›´çš„çŠ¶æ€ä½¿ç”¨computedç¼“å­˜
- [ ] çŠ¶æ€è®¢é˜…ä½¿ç”¨store.$subscribeé¿å…é‡å¤ç›‘å¬
- [ ] æŒ‰éœ€åŠ è½½çŠ¶æ€æ¨¡å—ï¼Œå‡å°‘åˆå§‹åŠ è½½æ—¶é—´
- [ ] çŠ¶æ€å˜æ›´æ‰¹é‡å¤„ç†ï¼Œé¿å…é¢‘ç¹æ›´æ–°

#### **å¼€å‘ä½“éªŒè§„èŒƒ**
- [ ] é…ç½®Vue DevToolsçŠ¶æ€ç®¡ç†æ’ä»¶
- [ ] æ·»åŠ çŠ¶æ€å˜æ›´æ—¥å¿—å’Œé”™è¯¯è¿½è¸ª
- [ ] æä¾›çŠ¶æ€ç®¡ç†çš„å•å…ƒæµ‹è¯•
- [ ] ä½¿ç”¨çŠ¶æ€ç®¡ç†ä¸­é—´ä»¶å¢å¼ºåŠŸèƒ½
- [ ] æä¾›çŠ¶æ€é‡ç½®å’Œè°ƒè¯•å·¥å…·

---

## ğŸš€ çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ

### **ç”¨æˆ·çŠ¶æ€ç®¡ç†ç¤ºä¾‹**
```typescript
// stores/modules/user/index.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { UserState, UserInfo, UserPermissions } from './types'
import { userApi } from '@/api/user'
import { useRouter } from 'vue-router'

export const useUserStore = defineStore('user', () => {
  // çŠ¶æ€å®šä¹‰
  const state = ref<UserState>({
    userInfo: null,
    permissions: [],
    settings: {
      theme: 'light',
      language: 'zh-CN',
      sidebarCollapsed: false
    },
    lastLoginTime: null
  })

  // è®¡ç®—å±æ€§
  const isLoggedIn = computed(() => !!state.value.userInfo)
  const userName = computed(() => state.value.userInfo?.name || 'Guest')
  const userAvatar = computed(() => state.value.userInfo?.avatar || '')
  const hasPermission = computed(() =>
    (permission: string) => state.value.permissions.some(p => p.code === permission)
  )
  const isAdmin = computed(() =>
    state.value.permissions.some(p => p.role === 'admin')
  )

  // å¼‚æ­¥æ“ä½œ
  const fetchUserInfo = async () => {
    try {
      const response = await userApi.getUserInfo()
      state.value.userInfo = response.data
      state.value.lastLoginTime = new Date().toISOString()
      return response.data
    } catch (error) {
      console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
      throw error
    }
  }

  const fetchUserPermissions = async () => {
    try {
      const response = await userApi.getUserPermissions()
      state.value.permissions = response.data
      return response.data
    } catch (error) {
      console.error('è·å–ç”¨æˆ·æƒé™å¤±è´¥:', error)
      throw error
    }
  }

  const login = async (credentials: LoginCredentials) => {
    try {
      const response = await userApi.login(credentials)
      const { token, user, permissions } = response.data

      // æ›´æ–°çŠ¶æ€
      state.value.userInfo = user
      state.value.permissions = permissions
      state.value.lastLoginTime = new Date().toISOString()

      // å­˜å‚¨token
      localStorage.setItem('auth_token', token)

      return response.data
    } catch (error) {
      console.error('ç™»å½•å¤±è´¥:', error)
      throw error
    }
  }

  const logout = async () => {
    try {
      await userApi.logout()
    } catch (error) {
      console.error('é€€å‡ºç™»å½•å¤±è´¥:', error)
    } finally {
      // æ¸…é™¤çŠ¶æ€
      state.value.userInfo = null
      state.value.permissions = []
      state.value.lastLoginTime = null

      // æ¸…é™¤token
      localStorage.removeItem('auth_token')
    }
  }

  const updateUserInfo = async (userInfo: Partial<UserInfo>) => {
    try {
      const response = await userApi.updateUserInfo(userInfo)
      state.value.userInfo = { ...state.value.userInfo!, ...response.data }
      return response.data
    } catch (error) {
      console.error('æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
      throw error
    }
  }

  const updateSettings = (settings: Partial<UserState['settings']>) => {
    state.value.settings = { ...state.value.settings, ...settings }
    // æŒä¹…åŒ–è®¾ç½®
    localStorage.setItem('user_settings', JSON.stringify(state.value.settings))
  }

  // é‡ç½®çŠ¶æ€
  const resetState = () => {
    state.value = {
      userInfo: null,
      permissions: [],
      settings: {
        theme: 'light',
        language: 'zh-CN',
        sidebarCollapsed: false
      },
      lastLoginTime: null
    }
  }

  return {
    // çŠ¶æ€
    state: readonly(state),

    // è®¡ç®—å±æ€§
    isLoggedIn,
    userName,
    userAvatar,
    hasPermission,
    isAdmin,

    // æ“ä½œ
    fetchUserInfo,
    fetchUserPermissions,
    login,
    logout,
    updateUserInfo,
    updateSettings,
    resetState
  }
})
```

### **ä¸šåŠ¡çŠ¶æ€ç®¡ç†ç¤ºä¾‹**
```typescript
// stores/modules/business/consume.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { ConsumeState, ConsumeRecord, ConsumeFilters } from './types'
import { consumeApi } from '@/api/consume'

export const useConsumeStore = defineStore('consume', () => {
  // çŠ¶æ€å®šä¹‰
  const state = ref<ConsumeState>({
    records: [],
    filters: {
      keyword: '',
      dateRange: [],
      status: '',
      category: ''
    },
    pagination: {
      current: 1,
      pageSize: 20,
      total: 0
    },
    loading: false,
    error: null
  })

  // è®¡ç®—å±æ€§
  const filteredRecords = computed(() => {
    let records = state.value.records

    // å…³é”®è¯è¿‡æ»¤
    if (state.value.filters.keyword) {
      records = records.filter(record =>
        record.description.includes(state.value.filters.keyword)
      )
    }

    // çŠ¶æ€è¿‡æ»¤
    if (state.value.filters.status) {
      records = records.filter(record => record.status === state.value.filters.status)
    }

    // åˆ†ç±»è¿‡æ»¤
    if (state.value.filters.category) {
      records = records.filter(record => record.category === state.value.filters.category)
    }

    // æ—¥æœŸèŒƒå›´è¿‡æ»¤
    if (state.value.filters.dateRange.length === 2) {
      const [startDate, endDate] = state.value.filters.dateRange
      records = records.filter(record => {
        const recordDate = new Date(record.createTime)
        return recordDate >= startDate && recordDate <= endDate
      })
    }

    return records
  })

  const totalAmount = computed(() => {
    return filteredRecords.value.reduce((sum, record) => sum + record.amount, 0)
  })

  const statistics = computed(() => {
    const records = filteredRecords.value
    return {
      totalCount: records.length,
      totalAmount: totalAmount.value,
      averageAmount: records.length > 0 ? totalAmount.value / records.length : 0,
      categories: [...new Set(records.map(r => r.category))]
    }
  })

  // å¼‚æ­¥æ“ä½œ
  const fetchRecords = async (params?: any) => {
    state.value.loading = true
    state.value.error = null

    try {
      const response = await consumeApi.getRecords({
        ...state.value.filters,
        ...state.value.pagination,
        ...params
      })

      state.value.records = response.data.records
      state.value.pagination.total = response.data.total

      return response.data
    } catch (error) {
      state.value.error = error as Error
      console.error('è·å–æ¶ˆè´¹è®°å½•å¤±è´¥:', error)
      throw error
    } finally {
      state.value.loading = false
    }
  }

  const createRecord = async (record: Omit<ConsumeRecord, 'id' | 'createTime'>) => {
    try {
      const response = await consumeApi.createRecord(record)

      // æ·»åŠ åˆ°æœ¬åœ°çŠ¶æ€
      state.value.records.unshift(response.data)

      // æ›´æ–°åˆ†é¡µ
      state.value.pagination.total += 1

      return response.data
    } catch (error) {
      console.error('åˆ›å»ºæ¶ˆè´¹è®°å½•å¤±è´¥:', error)
      throw error
    }
  }

  const updateRecord = async (id: string, updates: Partial<ConsumeRecord>) => {
    try {
      const response = await consumeApi.updateRecord(id, updates)

      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      const index = state.value.records.findIndex(r => r.id === id)
      if (index !== -1) {
        state.value.records[index] = response.data
      }

      return response.data
    } catch (error) {
      console.error('æ›´æ–°æ¶ˆè´¹è®°å½•å¤±è´¥:', error)
      throw error
    }
  }

  const deleteRecord = async (id: string) => {
    try {
      await consumeApi.deleteRecord(id)

      // ä»æœ¬åœ°çŠ¶æ€ç§»é™¤
      state.value.records = state.value.records.filter(r => r.id !== id)

      // æ›´æ–°åˆ†é¡µ
      state.value.pagination.total -= 1
    } catch (error) {
      console.error('åˆ é™¤æ¶ˆè´¹è®°å½•å¤±è´¥:', error)
      throw error
    }
  }

  const updateFilters = (filters: Partial<ConsumeFilters>) => {
    state.value.filters = { ...state.value.filters, ...filters }
    state.value.pagination.current = 1 // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
  }

  const resetFilters = () => {
    state.value.filters = {
      keyword: '',
      dateRange: [],
      status: '',
      category: ''
    }
    state.value.pagination.current = 1
  }

  return {
    // çŠ¶æ€
    state: readonly(state),

    // è®¡ç®—å±æ€§
    filteredRecords,
    totalAmount,
    statistics,

    // æ“ä½œ
    fetchRecords,
    createRecord,
    updateRecord,
    deleteRecord,
    updateFilters,
    resetFilters
  }
})
```

### **çŠ¶æ€æŒä¹…åŒ–æ’ä»¶ç¤ºä¾‹**
```typescript
// stores/plugins/persistence.ts
import type { PiniaPluginContext } from 'pinia'

interface PersistenceOptions {
  key?: string
  storage?: Storage
  paths?: string[]
  serializer?: {
    serialize: (state: any) => string
    deserialize: (value: string) => any
  }
}

export const createPersistencePlugin = (options: PersistenceOptions = {}) => {
  const {
    key = 'pinia',
    storage = localStorage,
    paths = [],
    serializer = {
      serialize: JSON.stringify,
      deserialize: JSON.parse
    }
  } = options

  return ({ store }: PiniaPluginContext) => {
    const storeKey = `${key}_${store.$id}`

    // æ¢å¤çŠ¶æ€
    const storedState = storage.getItem(storeKey)
    if (storedState) {
      try {
        const parsedState = serializer.deserialize(storedState)
        if (paths.length > 0) {
          // åªæ¢å¤æŒ‡å®šè·¯å¾„çš„çŠ¶æ€
          paths.forEach(path => {
            if (parsedState[path] !== undefined) {
              store.$state[path] = parsedState[path]
            }
          })
        } else {
          // æ¢å¤å…¨éƒ¨çŠ¶æ€
          store.$patch(parsedState)
        }
      } catch (error) {
        console.warn(`Failed to restore state for store ${store.$id}:`, error)
      }
    }

    // æŒä¹…åŒ–çŠ¶æ€
    store.$subscribe((mutation, state) => {
      try {
        let stateToPersist = state

        if (paths.length > 0) {
          // åªæŒä¹…åŒ–æŒ‡å®šè·¯å¾„çš„çŠ¶æ€
          stateToPersist = {}
          paths.forEach(path => {
            if (state[path] !== undefined) {
              stateToPersist[path] = state[path]
            }
          })
        }

        storage.setItem(storeKey, serializer.serialize(stateToPersist))
      } catch (error) {
        console.warn(`Failed to persist state for store ${store.$id}:`, error)
      }
    })
  }
}
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†è´¨é‡è¯„ä¼°æ ‡å‡†

### **çŠ¶æ€æ¶æ„è¯„åˆ†**
| ç»´åº¦ | æƒé‡ | è¯„åˆ†æ ‡å‡† |
|------|------|----------|
| Piniaè§„èŒƒéµå¾ªåº¦ | 30% | å®Œå…¨ç¬¦åˆPiniaæœ€ä½³å®è·µ |
| çŠ¶æ€æ¨¡å—è®¾è®¡ | 25% | æ¨¡å—åŒ–ç¨‹åº¦å’Œä¾èµ–å…³ç³»åˆç† |
| ç±»å‹å®‰å…¨ä¿éšœ | 20% | TypeScriptç±»å‹å®šä¹‰å®Œæ•´å‡†ç¡® |
| æ€§èƒ½ä¼˜åŒ–ç¨‹åº¦ | 15% | çŠ¶æ€æ›´æ–°æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ |
| å¼€å‘ä½“éªŒ | 10% | è°ƒè¯•å·¥å…·å’Œå¼€å‘æ•ˆç‡ |

### **è´¨é‡ç­‰çº§**
- **Açº§ (90-100åˆ†)**: å®Œå…¨ç¬¦åˆrepowikiçŠ¶æ€ç®¡ç†è§„èŒƒ
- **Bçº§ (80-89åˆ†)**: åŸºæœ¬åˆè§„ï¼Œå­˜åœ¨è½»å¾®ä¼˜åŒ–ç©ºé—´
- **Cçº§ (70-79åˆ†)**: éƒ¨åˆ†åˆè§„ï¼Œéœ€è¦é‡ç‚¹æ”¹è¿›
- **Dçº§ (60-69åˆ†)**: çŠ¶æ€ç®¡ç†æ··ä¹±ï¼Œéœ€è¦é‡æ„
- **Eçº§ (0-59åˆ†)**: ä¸¥é‡è¿åçŠ¶æ€ç®¡ç†è§„èŒƒ

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### **ä½•æ—¶è°ƒç”¨**
- çŠ¶æ€ç®¡ç†æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹æ—¶
- çŠ¶æ€æ¨¡å—é‡æ„å’Œä¼˜åŒ–æ—¶
- çŠ¶æ€æ€§èƒ½é—®é¢˜è¯Šæ–­å’Œä¼˜åŒ–æ—¶
- çŠ¶æ€æŒä¹…åŒ–å’Œæ¢å¤ç­–ç•¥åˆ¶å®šæ—¶
- çŠ¶æ€ç®¡ç†å¼€å‘è§„èŒƒåˆ¶å®šæ—¶

### **è°ƒç”¨æ–¹å¼**
```bash
# åŸºäºrepowikiçš„çŠ¶æ€ç®¡ç†ä¸“å®¶
Skill("state-management-specialist-repowiki")

# å°†ç«‹å³æ‰§è¡Œï¼š
# 1. åŸºäº.qoder/repowikiçŠ¶æ€ç®¡ç†è§„èŒƒæ£€æŸ¥
# 2. Piniaæ¶æ„åˆè§„æ€§éªŒè¯
# 3. çŠ¶æ€æ¨¡å—è®¾è®¡å’Œä¾èµ–åˆ†æ
# 4. çŠ¶æ€æ€§èƒ½ä¼˜åŒ–å»ºè®®å’Œå®æ–½
```

### **é¢„æœŸç»“æœ**
- 100%ç¬¦åˆ`.qoder/repowiki`çŠ¶æ€ç®¡ç†è§„èŒƒ
- ç§‘å­¦çš„çŠ¶æ€åˆ†å±‚å’Œæ•°æ®æµè®¾è®¡
- é«˜æ€§èƒ½ã€å¯ç»´æŠ¤çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿ
- å®Œå–„çš„çŠ¶æ€æŒä¹…åŒ–å’Œè°ƒè¯•å·¥å…·

---

**ğŸ† æŠ€èƒ½ç­‰çº§**: çŠ¶æ€ç®¡ç†ä¸“å®¶ (â˜…â˜…â˜…â˜…â˜…)
**â° é¢„æœŸæ•ˆæœ**: åŸºäº249ä¸ªrepowikiæƒå¨æ–‡æ¡£ï¼Œç¡®ä¿IOE-DREAMçŠ¶æ€ç®¡ç†100%ç¬¦åˆPiniaæœ€ä½³å®è·µ
**ğŸ¯ æ ¸å¿ƒä»·å€¼**: Piniaæ¶æ„å®ˆæŠ¤ï¼ŒçŠ¶æ€ç®¡ç†ä¼˜åŒ–ï¼Œå¼€å‘æ•ˆç‡æå‡