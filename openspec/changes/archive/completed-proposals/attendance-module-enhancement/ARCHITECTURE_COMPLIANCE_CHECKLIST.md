# 考勤模块企业级架构合规检查清单

**版本**: v2.0.0 - 企业级增强版
**检查依据**: CLAUDE.md v2.0.0 + UNIFIED_MICROSERVICES_STANDARDS.md v3.0.0
**最后更新**: 2025-12-01

---

## 🚨 强制合规要求（零容忍）

### 四层架构合规
- [ ] **Controller → Service → Manager → DAO**: 严格遵循四层架构，禁止跨层访问
- [ ] **禁止跨层访问**: Controller 不能直接调用 Manager/DAO，Service 不能直接调用 DAO
- [ ] **层级职责清晰**: 每层职责单一明确，无业务逻辑混入

### 依赖注入规范
- [ ] **统一使用 @Resource**: 禁止使用 @Autowired，禁止构造函数注入
- [ ] **注解使用正确**: jakarta.annotation.Resource，禁止 javax.annotation.Resource

### DAO层规范
- [ ] **Dao 后缀**: 统一使用 Dao 后缀，禁止 Repository 后缀
- [ ] **@Mapper 注解**: 统一使用 @Mapper 注解，禁止 @Repository 注解
- [ ] **继承 BaseMapper**: 必须继承 BaseMapper<Entity>

### Jakarta EE包名规范
- [ ] **jakarta.* 包**: 100% 使用 jakarta.* 包名
- [ ] **禁止 javax.* 包**: 禁止使用任何 javax.* 包名

### 服务间调用规范
- [ ] **GatewayServiceClient**: 统一通过 GatewayServiceClient 调用其他微服务
- [ ] **禁止直接调用**: 禁止使用 FeignClient 直接调用其他服务

---

## 🏗️ 企业级特性要求

### 多级缓存架构
- [ ] **L1 本地缓存**: Caffeine 本地缓存，毫秒级响应
- [ ] **L2 Redis缓存**: Redis 分布式缓存，数据一致性
- [ ] **L3 网关缓存**: 服务间调用缓存，减少网络开销
- [ ] **缓存击穿防护**: 互斥锁防止缓存击穿
- [ ] **缓存雪崩防护**: 随机过期时间防止雪崩

### SAGA分布式事务
- [ ] **事务编排**: 使用 SAGA 模式实现分布式事务
- [ ] **补偿机制**: 每个步骤都有对应的补偿操作
- [ ] **事务状态跟踪**: 完整的事务状态跟踪和监控
- [ ] **失败重试**: 自动重试和人工干预机制

### 服务降级熔断
- [ ] **@CircuitBreaker**: 关键服务配置熔断机制
- [ ] **@RateLimiter**: 接口防刷限流机制
- [ ] **降级策略**: 服务异常时的降级处理策略
- [ ] **超时控制**: 服务调用超时控制

### 异步处理机制
- [ ] **@Async 注解**: 耗时操作使用异步处理
- [ ] **消息队列**: RabbitMQ 处理异步任务
- [ ] **事件驱动**: Spring Event 事件发布订阅
- [ ] **线程池配置**: 合理的线程池配置和监控

### 无状态服务设计
- [ ] **无状态 Controller**: Controller 不存储任何实例变量
- [ ] **会话管理**: 会话信息存储在 Redis 中
- [ ] **ThreadLocal 清理**: 使用 ThreadLocal 后及时清理
- [ ] **水平扩展**: 支持动态扩缩容

---

## 🔒 安全设计要求

### 数据安全
- [ ] **敏感数据加密**: AES 加密存储生物特征数据
- [ ] **传输安全**: HTTPS 强制传输
- [ ] **数据脱敏**: 敏感信息脱敏输出
- [ ] **审计日志**: 完整记录敏感操作

### API安全
- [ ] **身份认证**: JWT Token 身份认证
- [ ] **权限控制**: @SaCheckPermission 细粒度权限控制
- [ ] **防刷机制**: 接口防刷和限流
- [ ] **输入验证**: @Valid 参数验证和 XSS 防护

---

## ⚡ 性能优化要求

### 数据库优化
- [ ] **索引优化**: 为所有查询条件建立合适索引
- [ ] **慢查询优化**: 避免全表扫描和深度分页
- [ ] **连接池优化**: Druid 连接池参数优化
- [ ] **事务优化**: 合理使用事务边界

### 缓存优化
- [ ] **缓存策略**: 合理设置缓存过期时间
- [ ] **缓存预热**: 系统启动时缓存热点数据
- [ ] **缓存监控**: 缓存命中率和性能监控
- [ ] **缓存一致性**: 多级缓存一致性保证

### JVM优化
- [ ] **G1GC 配置**: 生产环境 G1GC 参数优化
- [ ] **内存配置**: 合理的堆内存和元空间配置
- [ ] **GC日志**: GC 日志分析和优化
- [ ] **内存泄漏**: 内存泄漏检测和预防

---

## 📊 监控告警要求

### 业务监控
- [ ] **关键指标**: 打卡成功率、处理延迟、异常率
- [ ] **自定义指标**: Micrometer 暴露自定义业务指标
- [ ] **性能基线**: 建立性能基线和告警阈值
- [ ] **趋势分析**: 业务数据趋势分析

### 系统监控
- [ ] **系统指标**: CPU、内存、GC、线程池监控
- [ ] **健康检查**: /actuator/health 端点配置
- [ ] **分布式追踪**: Spring Cloud Sleuth 链路追踪
- [ ] **日志聚合**: ELK Stack 日志聚合分析

---

## 🐳 部署运维要求

### 容器化部署
- [ ] **Docker 最佳实践**: 多阶段构建，最小化镜像
- [ ] **Kubernetes**: K8s 部署配置和资源限制
- [ ] **配置管理**: ConfigMap 和 Secret 使用
- [ ] **健康检查**: 容器健康检查配置

### 高可用架构
- [ ] **服务高可用**: 多实例部署，负载均衡
- [ ] **数据库高可用**: 主从复制，读写分离
- [ ] **缓存高可用**: Redis Sentinel 集群
- [ ] **跨机房部署**: 多可用区部署

---

## ✅ 代码质量要求

### 编码规范
- [ ] **代码注释**: 完整的 JavaDoc 注释
- [ ] **异常处理**: 完善的异常处理机制
- [ ] **日志记录**: SLF4J 日志记录规范
- [ ] **代码审查**: SonarQube 代码质量扫描

### 测试覆盖
- [ ] **单元测试**: JUnit 5 + Mockito，覆盖率 ≥85%
- [ ] **集成测试**: 完整业务流程测试
- [ ] **性能测试**: JMeter 压力测试
- [ ] **安全测试**: OWASP ZAP 安全扫描

---

## 📋 检查流程

### 开发阶段检查
1. **编码前**: 确认理解架构规范
2. **编码中**: 实时检查合规性
3. **提交前**: 自动化合规检查脚本
4. **代码审查**: 人工架构合规审查

### 部署阶段检查
1. **测试环境**: 完整功能和性能测试
2. **预发环境**: 生产环境模拟测试
3. **生产部署**: 部署前最终合规检查
4. **上线后**: 监控和告警验证

---

## 🚫 常见违规项

### 架构违规
- ❌ Controller 直接调用 DAO
- ❌ Service 包含业务逻辑外的逻辑
- ❌ Manager 包含事务管理
- ❌ DAO 包含业务逻辑

### 编码违规
- ❌ 使用 @Autowired
- ❌ 使用 Repository 后缀
- ❌ 使用 javax.* 包名
- ❌ 硬编码配置值

### 安全违规
- ❌ 明文传输敏感数据
- ❌ SQL 注入漏洞
- ❌ XSS 攻击漏洞
- ❌ 权限控制缺失

---

**检查负责人**: 架构委员会
**检查频率**: 每次代码提交 + 每周定期检查
**违规处理**: 立即修复 + 通报 + 培训

**企业级架构是质量的基石，零容忍违规行为！** 🚀