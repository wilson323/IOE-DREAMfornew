## MODIFIED Requirements

### Requirement: 门禁微服务架构适配
ioedream-access-service SHALL适配到新的7微服务架构，运行在端口8090，专注于门禁业务功能，设备通讯功能转移到设备通讯微服务。

#### Scenario: 服务适配验证
- **WHEN** 门禁微服务适配新架构时
- **THEN** 在端口8090成功启动
- **AND** 移除设备通讯相关功能
- **AND** 保留门禁业务核心功能
- **AND** 通过网关调用设备通讯服务

#### Scenario: 功能职责验证
- **WHEN** 验证门禁微服务职责时
- **THEN** 专注门禁权限管理
- **AND** 专注出入记录管理
- **AND** 专注门禁规则配置
- **AND** 不包含设备连接管理

### Requirement: 设备调用适配
门禁微服务 SHALL通过API网关调用设备通讯微服务，实现设备相关功能。

#### Scenario: 设备状态查询适配
- **WHEN** 门禁服务查询设备状态时
- **THEN** 通过GatewayServiceClient调用设备通讯服务
- **AND** 设备状态数据正确获取
- **AND** 调用异常时正确处理

#### Scenario: 设备控制适配
- **WHEN** 门禁服务控制设备时
- **THEN** 通过网关调用设备通讯服务
- **AND** 设备指令正确下发
- **AND** 设备响应正确处理

### Requirement: 区域权限管理
门禁微服务 SHALL提供完整的区域权限管理功能，支持区域定义、权限分配、规则配置。

#### Scenario: 区域管理验证
- **WHEN** 管理员配置门禁区域时
- **THEN** 区域信息正确保存
- **AND** 区域层级关系正确
- **AND** 区域属性配置完整

#### Scenario: 权限分配验证
- **WHEN** 分配用户门禁权限时
- **THEN** 权限规则正确匹配
- **AND** 时间权限正确设置
- **AND** 区域权限正确配置

#### Scenario: 规则配置验证
- **WHEN** 配置门禁规则时
- **THEN** 规则条件正确设置
- **AND** 规则动作准确定义
- **AND** 规则优先级正确排序

### Requirement: 出入记录管理
门禁微服务 SHALL提供完整的出入记录管理功能，支持记录采集、查询、统计分析。

#### Scenario: 记录采集验证
- **WHEN** 用户刷卡/人脸识别时
- **THEN** 出入记录自动创建
- **AND** 记录信息完整准确
- **AND** 记录时间正确同步

#### Scenario: 记录查询验证
- **WHEN** 查询出入记录时
- **THEN** 支持多条件组合查询
- **AND** 分页查询性能良好
- **AND** 查询结果准确完整

#### Scenario: 统计分析验证
- **WHEN** 生成出入统计时
- **THEN** 统计数据准确计算
- **AND** 统计图表正确展示
- **AND** 统计导出功能正常

### Requirement: 生物识别集成
门禁微服务 SHALL集成生物识别功能，支持人脸、指纹、虹膜等多模态识别。

#### Scenario: 人脸识别验证
- **WHEN** 用户人脸识别开门时
- **THEN** 人脸特征正确比对
- **AND** 识别结果准确返回
- **AND** 识别过程快速响应

#### Scenario: 指纹识别验证
- **WHEN** 用户指纹识别开门时
- **THEN** 指纹特征正确匹配
- **AND** 识别准确率达标
- **AND** 识别速度满足要求

#### Scenario: 虹膜识别验证
- **WHEN** 用户虹膜识别开门时
- **THEN** 虹膜特征准确比对
- **AND** 识别安全性保障
- **AND** 识别体验良好

### Requirement: 访客管理集成
门禁微服务 SHALL与访客管理微服务集成，支持访客权限验证和临时门禁授权。

#### Scenario: 访客权限验证
- **WHEN** 访客尝试开门时
- **THEN** 调用访客服务验证权限
- **AND** 临时权限正确识别
- **AND** 权限过期及时阻止

#### Scenario: 访客记录管理
- **WHEN** 访客进出记录时
- **THEN** 访客记录正确关联
- **AND** 访客信息脱敏处理
- **AND** 记录查询权限控制

### Requirement: 实时监控功能
门禁微服务 SHALL提供实时监控功能，支持门禁状态监控、异常告警、视频联动。

#### Scenario: 实时状态监控验证
- **WHEN** 监控门禁状态时
- **THEN** 门禁状态实时更新
- **AND** 设备在线状态显示
- **AND** 异常状态及时告警

#### Scenario: 异常告警验证
- **WHEN** 门禁异常发生时
- **THEN** 异常事件自动检测
- **AND** 告警信息及时推送
- **AND** 异常处理流程启动

#### Scenario: 视频联动验证
- **WHEN** 门禁事件触发时
- **THEN** 视频监控联动启动
- **AND** 事件录像自动保存
- **AND** 视频画面正确关联

### Requirement: 报表统计功能
门禁微服务 SHALL提供完整的报表统计功能，支持出入统计、异常统计、使用分析。

#### Scenario: 出入统计验证
- **WHEN** 生成出入统计报表时
- **THEN** 统计数据准确完整
- **AND** 统计维度丰富多样
- **AND** 报表导出格式正确

#### Scenario: 异常统计验证
- **WHEN** 生成异常统计报表时
- **THEN** 异常事件完整统计
- **AND** 异常趋势分析准确
- **AND** 异常处理效果评估

### Requirement: 数据库适配
门禁微服务 SHALL使用独立数据库ioedream_access_db，移除设备相关表结构，专注门禁业务数据。

#### Scenario: 数据库结构适配验证
- **WHEN** 适配门禁数据库时
- **THEN** 移除设备基础信息表
- **AND** 保留门禁业务相关表
- **AND** 表结构优化合理

#### Scenario: 数据迁移验证
- **WHEN** 迁移门禁相关数据时
- **THEN** 门禁数据完整迁移
- **AND** 数据关联关系正确
- **AND** 数据完整性验证通过

### Requirement: API接口适配
门禁微服务 SHALL适配新的API接口规范，移除设备管理相关接口，专注门禁业务接口。

#### Scenario: 接口移除验证
- **WHEN** 适配API接口时
- **THEN** 移除设备管理接口
- **AND** 移除设备配置接口
- **AND** 保留门禁业务接口

#### Scenario: 接口新增验证
- **WHEN** 适配服务调用时
- **THEN** 新增设备通讯调用接口
- **AND** 新增网关服务调用功能
- **AND** 接口调用异常处理

### Requirement: 性能优化适配
门禁微服务 SHALL适配新的架构，优化门禁业务处理性能，提高响应速度和并发能力。

#### Scenario: 响应速度优化验证
- **WHEN** 用户请求门禁验证时
- **THEN** 响应时间显著降低
- **AND** 验证过程高效完成
- **AND** 用户体验得到提升

#### Scenario: 并发能力优化验证
- **WHEN** 多用户同时请求门禁时
- **THEN** 系统并发处理能力提升
- **AND** 资源使用更加合理
- **AND** 系统稳定性得到保障