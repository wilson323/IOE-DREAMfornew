# 智能排班引擎 - 集成测试和部署验证计划

## 📋 测试概述

**测试目标**：验证智能排班引擎的前后端集成是否正常，确保系统可以投入使用

**测试范围**：
- ✅ 前后端API联调测试
- ✅ 端到端功能测试
- ✅ 性能压力测试
- ✅ 部署验证测试
- ✅ 用户验收测试（UAT）

**测试时间**：10-15小时（约2天）

---

## 🧪 阶段1：前后端API联调测试（2-3小时）

### 1.1 API接口清单

#### SmartScheduleController（12个接口）

| 序号 | API端点 | HTTP方法 | 功能 | 测试状态 |
|------|---------|----------|------|---------|
| 1 | `/api/v1/schedule/plan` | POST | 创建排班计划 | ⏳ |
| 2 | `/api/v1/schedule/plan/{planId}` | PUT | 更新排班计划 | ⏳ |
| 3 | `/api/v1/schedule/plan/{planId}` | DELETE | 删除排班计划 | ⏳ |
| 4 | `/api/v1/schedule/plan/batch` | DELETE | 批量删除计划 | ⏳ |
| 5 | `/api/v1/schedule/plan/page` | GET | 查询计划列表 | ⏳ |
| 6 | `/api/v1/schedule/plan/{planId}` | GET | 查询计划详情 | ⏳ |
| 7 | `/api/v1/schedule/plan/{planId}/execute` | POST | 执行优化 | ⏳ |
| 8 | `/api/v1/schedule/plan/{planId}/confirm` | POST | 确认计划 | ⏳ |
| 9 | `/api/v1/schedule/plan/{planId}/cancel` | POST | 取消计划 | ⏳ |
| 10 | `/api/v1/schedule/plan/{planId}/export` | GET | 导出结果 | ⏳ |
| 11 | `/api/v1/schedule/result/page` | GET | 查询结果分页 | ⏳ |
| 12 | `/api/v1/schedule/result/list/{planId}` | GET | 查询结果列表 | ⏳ |

#### ScheduleRuleController（14个接口）

| 序号 | API端点 | HTTP方法 | 功能 | 测试状态 |
|------|---------|----------|------|---------|
| 1 | `/api/v1/schedule/rule` | POST | 创建规则 | ⏳ |
| 2 | `/api/v1/schedule/rule/{ruleId}` | PUT | 更新规则 | ⏳ |
| 3 | `/api/v1/schedule/rule/{ruleId}` | DELETE | 删除规则 | ⏳ |
| 4 | `/api/v1/schedule/rule/page` | GET | 查询规则列表 | ⏳ |
| 5 | `/api/v1/schedule/rule/list` | GET | 查询规则不分页 | ⏳ |
| 6 | `/api/v1/schedule/rule/validate` | POST | 验证规则表达式 | ⏳ |
| 7 | `/api/v1/schedule/rule/test` | POST | 测试规则执行 | ⏳ |
| 8 | `/api/v1/schedule/rule/{ruleId}/enable` | POST | 启用规则 | ⏳ |
| 9 | `/api/v1/schedule/rule/{ruleId}/disable` | POST | 禁用规则 | ⏳ |
| 10 | `/api/v1/schedule/rule/priority` | GET | 获取规则优先级 | ⏳ |
| 11 | `/api/v1/schedule/optimize/genetic` | POST | 遗传算法优化 | ⏳ |
| 12 | `/api/v1/schedule/optimize/annealing` | POST | 模拟退火优化 | ⏳ |
| 13 | `/api/v1/schedule/optimize/hybrid` | POST | 混合算法优化 | ⏳ |
| 14 | `/api/v1/schedule/optimize/auto` | POST | 自动算法选择 | ⏳ |

**总计**：26个API接口需要测试

### 1.2 测试用例

#### 测试用例1：创建排班计划

```yaml
测试名称: TC_API_001_创建排班计划
前置条件:
  - 用户已登录
  - 后端服务已启动
测试步骤:
  1. 访问智能排班配置页面
  2. 点击"新增"按钮
  3. 填写计划信息:
     - 计划名称: "测试计划001"
     - 描述: "集成测试计划"
     - 日期范围: 2025-01-27 ~ 2025-02-02
     - 选择员工: [1, 2, 3, 4, 5]
     - 选择班次: [1, 2, 3]
     - 优化目标: 综合最优
     - 约束条件: 最大连续7天, 最小休息2天, 最小人员2人
     - 算法参数: 种群20, 代数50, 交叉率0.8, 变异率0.1
  4. 点击"确定"按钮
预期结果:
  - ✅ API调用成功（HTTP 200）
  - ✅ 返回计划ID（Long类型）
  - ✅ 页面提示"创建成功"
  - ✅ 计划列表中显示新创建的计划
实际结果: [待填写]
测试状态: [待测试]
```

#### 测试用例2：执行排班优化

```yaml
测试名称: TC_API_002_执行排班优化
前置条件:
  - 已创建排班计划（planId = 1）
测试步骤:
  1. 在计划列表中找到"测试计划001"
  2. 点击"执行优化"按钮
  3. 等待优化完成（<10秒）
预期结果:
  - ✅ API调用成功（HTTP 200）
  - ✅ 返回优化结果（包含适应度、迭代次数、执行时长）
  - ✅ 适应度范围: 0.0-1.0
  - ✅ 迭代次数: >0
  - ✅ 执行时长: <10000ms
  - ✅ 页面提示"优化完成"
  - ✅ 计划状态更新为"已完成"
实际结果: [待填写]
测试状态: [待测试]
```

#### 测试用例3：查询排班结果

```yaml
测试名称: TC_API_003_查询排班结果
前置条件:
  - 已执行优化完成（planId = 1）
测试步骤:
  1. 在计划列表中找到"测试计划001"
  2. 点击"查看结果"按钮
  3. 验证结果数据:
     - 统计卡片数据
     - 优化结果详情
     - 排班结果明细表格
预期结果:
  - ✅ API调用成功（HTTP 200）
  - ✅ 总适应度显示正确（百分比）
  - ✅ 排班员工数: 5人
  - ✅ 排班天数: 7天
  - ✅ 四维得分显示正确（公平性、成本、效率、满意度）
  - ✅ 迭代次数和执行时长显示正确
  - ✅ 排班结果明细表格数据完整（5×7=35条记录）
实际结果: [待填写]
测试状态: [待测试]
```

### 1.3 API联调测试检查清单

**请求格式验证**：
- [ ] Content-Type: application/json
- [ ] 请求参数格式正确
- [ ] 日期格式: YYYY-MM-DD
- [ ] 分页参数: pageNum, pageSize

**响应格式验证**：
- [ ] HTTP状态码正确（200/400/500）
- [ ] ResponseDTO格式正确
- [ ] code字段: 200表示成功
- [ ] message字段: 提示信息清晰
- [ ] data字段: 数据类型正确

**异常处理验证**：
- [ ] 无效参数返回400错误
- [ ] 未授权返回401错误
- [ ] 资源不存在返回404错误
- [ ] 服务器错误返回500错误
- [ ] 错误提示信息友好

---

## 🔚 阶段2：端到端功能测试（3-4小时）

### 2.1 完整业务流程测试

#### 流程1：创建排班计划并执行优化

```yaml
测试场景: TS_E2E_001_完整排班流程
测试目标: 验证从创建计划到查看结果的完整流程
测试步骤:
  1. 访问"智能排班配置"页面
  2. 点击"新增"按钮创建计划
  3. 填写完整计划信息
  4. 点击"确定"保存计划
  5. 在计划列表中找到新计划
  6. 点击"执行优化"按钮
  7. 等待优化完成（显示进度）
  8. 点击"查看结果"按钮
  9. 验证统计卡片数据
  10. 验证优化结果详情
  11. 验证排班结果明细表格
  12. 测试筛选功能（按员工、日期范围）
  13. 点击"导出"按钮导出Excel

预期结果:
  - ✅ 所有步骤成功执行
  - ✅ 数据流转正确
  - ✅ 页面跳转流畅
  - ✅ 数据显示准确
  - ✅ Excel导出成功

测试时长: 5-10分钟
测试状态: ⏳ 待测试
```

#### 流程2：规则管理和测试

```yaml
测试场景: TS_E2E_002_规则管理流程
测试目标: 验证规则的创建、测试、启用流程
测试步骤:
  1. 访问"排班规则管理"页面
  2. 点击"新增"按钮创建规则
  3. 填写规则信息:
     - 规则名称: "连续工作天数限制"
     - 规则类型: 员工约束
     - 优先级: 80
     - 规则表达式: "consecutiveWorkDays >= 3 && consecutiveWorkDays <= 7"
     - 规则描述: "限制连续工作天数在3-7天之间"
     - 错误提示: "连续工作天数不符合要求"
  4. 点击"确定"保存规则
  5. 在规则列表中找到新规则
  6. 点击"测试"按钮
  7. 输入测试上下文:
     - 员工ID: 1
     - 日期: 2025-01-30
     - 连续工作天数: 5
  8. 点击"执行测试"
  9. 验证测试结果（应该通过）
 10. 修改测试上下文（连续工作天数: 10）
  11. 再次执行测试（应该失败）
  12. 关闭测试Modal
  13. 点击"启用"开关启用规则
  14. 验证规则状态变为"已启用"

预期结果:
  - ✅ 所有步骤成功执行
  - ✅ 规则创建成功
  - ✅ 规则测试功能正常
  - ✅ 测试结果准确
  - ✅ 规则启用成功
  - ✅ 状态显示正确

测试时长: 3-5分钟
测试状态: ⏳ 待测试
```

### 2.2 功能模块测试

| 模块 | 测试项 | 测试方法 | 预期结果 | 状态 |
|------|--------|---------|---------|------|
| **计划管理** | 创建计划 | 表单填写提交 | 计划创建成功 | ⏳ |
| **计划管理** | 编辑计划 | 修改信息提交 | 计划更新成功 | ⏳ |
| **计划管理** | 删除计划 | 删除按钮确认 | 计划删除成功 | ⏳ |
| **计划管理** | 批量删除 | 多选删除 | 批量删除成功 | ⏳ |
| **计划管理** | 查询列表 | 分页筛选 | 数据正确 | ⏳ |
| **优化执行** | 遗传算法 | 选择算法执行 | 优化完成<10s | ⏳ |
| **优化执行** | 模拟退火 | 选择算法执行 | 优化完成<10s | ⏳ |
| **优化执行** | 混合算法 | 选择算法执行 | 优化完成<10s | ⏳ |
| **结果展示** | 统计卡片 | 查看数据 | 数据准确 | ⏳ |
| **结果展示** | 结果详情 | 查看得分 | 得分正确 | ⏳ |
| **结果展示** | 结果明细 | 表格展示 | 数据完整 | ⏳ |
| **结果展示** | 筛选功能 | 按员工/日期筛选 | 筛选正确 | ⏳ |
| **规则管理** | 创建规则 | 表单填写提交 | 规则创建成功 | ⏳ |
| **规则管理** | 测试规则 | 测试上下文 | 测试结果正确 | ⏳ |
| **规则管理** | 启用禁用 | 开关切换 | 状态更新成功 | ⏳ |
| **规则管理** | 批量操作 | 多选操作 | 批量操作成功 | ⏳ |
| **导出功能** | Excel导出 | 导出按钮 | 文件下载成功 | ⏳ |

---

## ⚡ 阶段3：性能压力测试（2-3小时）

### 3.1 性能基准测试

#### 测试1：优化算法性能

```yaml
测试名称: TP_PERF_001_优化算法性能
测试目标: 验证优化算法在不同规模下的执行时间
测试数据:
  - 小规模: 5员工 × 7天 × 3班次
  - 中规模: 20员工 × 30天 × 5班次
  - 大规模: 50员工 × 90天 × 8班次

性能指标:
  - 小规模: <10秒
  - 中规模: <30秒
  - 大规模: <60秒

测试方法:
  1. 准备测试数据
  2. 执行优化算法
  3. 记录执行时间
  4. 记录迭代次数
  5. 记录最佳适应度

测试结果: [待填写]
通过标准: 所有规模都在预期时间内完成
测试状态: ⏳ 待测试
```

#### 测试2：并发优化测试

```yaml
测试名称: TP_PERF_002_并发优化测试
测试目标: 验证系统同时处理多个优化请求的能力
测试场景:
  - 5个用户同时执行优化
  - 每个用户优化不同的计划

测试方法:
  1. 准备5个不同的排班计划
  2. 同时启动5个优化请求
  3. 监控系统资源使用
  4. 记录所有优化完成时间
  5. 验证优化结果的正确性

通过标准:
  - 所有优化都能成功完成
  - 没有优化失败或超时
  - 服务器资源使用合理（CPU <80%, 内存 <80%）

测试结果: [待填写]
测试状态: ⏳ 待测试
```

#### 测试3：查询性能测试

```yaml
测试名称: TP_PERF_003_查询性能测试
测试目标: 验证数据查询的响应时间
测试场景:
  - 查询计划列表（1000条记录）
  - 查询排班结果（35000条记录）
  - 按员工筛选结果
  - 按日期范围筛选结果

性能指标:
  - 列表查询: <500ms
  - 详情查询: <200ms
  - 筛选查询: <300ms

测试方法:
  1. 准备大量测试数据
  2. 执行各种查询操作
  3. 记录响应时间
  4. 分析查询性能

通过标准: 所有查询都在指标范围内
测试结果: [待填写]
测试状态: ⏳ 待测试
```

---

## 🚀 阶段4：部署验证测试（1-2小时）

### 4.1 构建和部署

#### 步骤1：后端构建和部署

```bash
# 1. 构建后端服务
cd microservices/ioedream-attendance-service
mvn clean package -DskipTests

# 2. 验证构建产物
ls -lh target/*.jar

# 3. 启动服务（测试环境）
java -jar target/ioedream-attendance-service-1.0.0.jar \
  --spring.profiles.active=test \
  --server.port=8091

# 4. 验证服务启动
curl http://localhost:8091/actuator/health

# 5. 验证API可用性
curl http://localhost:8091/api/v1/schedule/plan/page?pageNum=1&pageSize=10
```

#### 步骤2：前端构建和部署

```bash
# 1. 安装依赖
cd smart-admin-web-javascript
npm install

# 2. 构建前端
npm run build:test

# 3. 验证构建产物
ls -lh dist/

# 4. 部署到Web服务器
# 例如：cp -r dist/* /var/www/html/

# 5. 启动Web服务器
# 例如：nginx -c /etc/nginx/nginx.conf

# 6. 访问前端页面
# http://localhost:3000/business/attendance/smart-schedule-config
```

### 4.2 数据库迁移验证

```bash
# 1. 验证Flyway迁移状态
cd microservices/ioedream-attendance-service
mvn flyway:info

# 2. 验证表结构
mysql -u root -p -e "USE ioedream_attendance; SHOW TABLES LIKE 't_smart_schedule%';"

# 3. 验证表结构
mysql -u root -p -e "USE ioedream_attendance; DESC t_smart_schedule_plan;"
mysql -u root -p -e "USE ioedream_attendance; DESC t_smart_schedule_result;"

# 4. 验证初始数据（如果有）
mysql -u root -p -e "USE ioedream_attendance; SELECT COUNT(*) FROM t_smart_schedule_plan;"
```

### 4.3 环境配置验证

**验证项目**：
- [ ] 数据库连接配置
- [ ] Redis缓存配置
- [ ] 日志配置
- [ ] 跨域配置（CORS）
- [ ] 文件上传路径配置
- [ ] 时区配置
- [ ] 字符编码配置（UTF-8）

---

## 👥 阶段5：用户验收测试（UAT）（2-3小时）

### 5.1 UAT测试场景

#### 场景1：管理员创建排班计划

```yaml
角色: 系统管理员
任务: 为下周创建排班计划
步骤:
  1. 登录系统
  2. 进入"智能排班配置"页面
  3. 点击"新增"按钮
  4. 输入计划名称："2025年第5周排班"
  5. 选择日期范围：2025-02-03 ~ 2025-02-09
  6. 选择员工：所有员工（20人）
  7. 选择班次：早班、中班、晚班
  8. 选择优化目标：综合最优
  9. 配置约束条件：
     - 最大连续工作天数：5天
     - 最小休息天数：2天
     - 最小每日人员：8人
  10. 配置算法参数：
      - 种群大小：50
      - 迭代代数：100
      - 交叉率：0.8
      - 变异率：0.1
  11. 点击"确定"保存

预期结果:
  - ✅ 计划创建成功
  - ✅ 可以在列表中看到新计划
  - ✅ 状态显示为"草稿"

用户反馈: [待填写]
```

#### 场景2：HR执行优化并查看结果

```yaml
角色: HR专员
任务: 执行排班优化并分析结果
步骤:
  1. 找到"2025年第5周排班"计划
  2. 点击"执行优化"按钮
  3. 等待优化完成
  4. 点击"查看结果"
  5. 查看统计卡片：
     - 总适应度
     - 排班员工数
     - 排班天数
     - 冲突数量
  6. 查看优化结果详情：
     - 公平性得分
     - 成本得分
     - 效率得分
     - 满意度得分
  7. 查看排班结果明细：
     - 筛选特定员工
     - 筛选特定日期
     - 查看是否有冲突
  8. 如果满意，点击"确认"按钮
  9. 点击"导出"按钮下载Excel

预期结果:
  - ✅ 优化在合理时间内完成（<30秒）
  - ✅ 结果数据显示清晰
  - ✅ 适应度得分合理（>0.6）
  - ✅ 冲突数量可接受
  - ✅ Excel文件可以正常打开

用户反馈: [待填写]
```

#### 场景3：管理员配置排班规则

```yaml
角色: 系统管理员
任务: 配置排班规则以满足公司政策
步骤:
  1. 进入"排班规则管理"页面
  2. 点击"新增"按钮
  3. 创建规则1："周末禁止排班"
     - 规则表达式: "!isWorkday(date) == false"
     - 优先级: 90
  4. 创建规则2："连续工作不超过5天"
     - 规则表达式: "consecutiveWorkDays <= 5"
     - 优先级: 80
  5. 创建规则3："每天至少8人值班"
     - 规则表达式: "dailyStaff >= 8"
     - 优先级: 70
  6. 测试每个规则
  7. 启用所有规则

预期结果:
  - ✅ 规则创建成功
  - ✅ 规则测试通过
  - ✅ 规则启用成功
  - ✅ 优先级排序正确

用户反馈: [待填写]
```

### 5.2 UAT反馈收集

**反馈内容**：
- 功能是否满足需求
- 界面是否友好易用
- 性能是否可接受
- 是否有bug或问题
- 改进建议

**反馈方式**：
- 问卷调查
- 面对面访谈
- 问题清单记录

---

## 📊 测试结果汇总

### 测试通过率

| 阶段 | 测试项总数 | 通过数 | 失败数 | 通过率 | 状态 |
|------|-----------|--------|--------|--------|------|
| API联调测试 | 26 | - | - | - | ⏳ |
| 功能测试 | 17 | - | - | - | ⏳ |
| 性能测试 | 3 | - | - | - | ⏳ |
| 部署验证 | 5 | - | - | - | ⏳ |
| UAT测试 | 3 | - | - | - | ⏳ |
| **总计** | **54** | **-** | **-** | **-** | **⏳** |

### 问题清单

| ID | 问题描述 | 严重程度 | 发现阶段 | 责任人 | 状态 |
|----|---------|---------|---------|--------|------|
| - | - | - | - | - | - |

---

## ✅ 验收标准

### 功能完整性

- [ ] 所有26个API接口正常工作
- [ ] 所有17个功能模块测试通过
- [ ] 前后端数据交互正常
- [ ] 没有阻塞性bug（P0级别）

### 性能要求

- [ ] 小规模优化<10秒
- [ ] 中规模优化<30秒
- [ ] 大规模优化<60秒
- [ ] 查询响应时间<500ms

### 用户体验

- [ ] 界面友好易用
- [ ] 操作流程顺畅
- [ ] 错误提示清晰
- [ ] 页面加载速度合理（<2秒）

### 部署就绪

- [ ] 构建成功无错误
- [ ] 数据库迁移成功
- [ ] 服务启动正常
- [ ] 前端访问正常

---

## 📝 测试执行记录

**测试执行人**：[待填写]
**测试开始时间**：[待填写]
**测试结束时间**：[待填写]
**测试环境**：[待填写]

**每日测试日志**：

### 第1天（YYYY-MM-DD）

**上午工作**（9:00-12:00）：
- [ ] 前后端API联调测试（12个接口）
- [ ] 记录测试结果

**下午工作**（14:00-18:00）：
- [ ] 前后端API联调测试（14个接口）
- [ ] 问题修复和回归测试
- [ ] 功能测试（5个模块）

**问题记录**：
- [ ] 问题描述
- [ ] 修复方案
- [ ] 修复状态

### 第2天（YYYY-MM-DD）

**上午工作**（9:00-12:00）：
- [ ] 功能测试（12个模块）
- [ ] 性能测试

**下午工作**（14:00-18:00）：
- [ ] 部署验证测试
- [ ] UAT测试
- [ ] 测试报告编写

**最终总结**：
- [ ] 测试通过率
- [ ] 剩余问题清单
- [ ] 改进建议
- [ ] 验收结论

---

## 🎯 测试完成标准

**集成测试通过条件**：
1. ✅ API联调测试通过率 ≥ 95%
2. ✅ 功能测试通过率 = 100%
3. ✅ 性能测试全部达标
4. ✅ 部署验证成功
5. ✅ UAT测试用户满意

**可以发布上线条件**：
- ✅ 所有P0级别问题已修复
- ✅ P1级别问题有明确解决计划
- ✅ 用户验收测试通过
- ✅ 性能指标达标

---

**测试计划版本**：v1.0
**创建日期**：2025-01-30
**最后更新**：2025-01-30
**文档状态**：待执行
