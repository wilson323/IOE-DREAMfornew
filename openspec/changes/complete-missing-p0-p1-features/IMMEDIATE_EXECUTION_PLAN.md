# P0级核心功能立即执行计划

> **计划类型**: P0级核心功能紧急实施计划
> **执行周期**: 第1-2月（8周）
> **团队规模**: 5人
> **总工作量**: 132人天

---

## 🎯 执行目标

**短期目标（第1月末）**: 完成P0级核心功能30%，系统完成度68%→76%
**长期目标（第2月末）**: 完成P0级核心功能100%，系统完成度76%→85%

---

## 📅 8周详细排期计划

### Week 1-2: 基础设施与门禁核心功能

#### Week 1: 环境准备与设备自动发现

**目标**: 完成开发环境搭建，启动设备自动发现功能

**Day 1-2: 环境准备**
- [ ] 成立专项工作组，任命项目经理
- [ ] 组建5人团队（后端2人 + 前端1人 + 移动端1人 + 测试1人）
- [ ] 搭建开发环境（Dev/Test/Prod隔离）
- [ ] 配置CI/CD流水线（GitLab CI/Jenkins）
- [ ] SonarQube代码质量平台配置
- [ ] 建立每日站会机制（每日10:00）

**Day 3-5: 设备自动发现功能（后端）**
- [ ] 创建`DeviceDiscoveryService`服务
  - [ ] TCP/UDP多播扫描实现
  - [ ] ONVIF协议适配
  - [ ] 私有协议适配
  - [ ] SNMP协议适配
- [ ] 创建`DiscoveryManager`业务编排
  - [ ] 设备去重逻辑
  - [ ] Redis缓存(30分钟)
  - [ ] 日志记录完整
- [ ] 单元测试编写（覆盖率≥80%）

**Day 6-7: 批量设备导入功能（后端+前端）**
- [ ] 创建`DeviceImportService`服务
  - [ ] Excel解析（EasyExcel）
  - [ ] 数据验证
  - [ ] 批量插入优化（1000条<30秒）
- [ ] 创建`ImportManager`业务编排
  - [ ] 事务管理
  - [ ] 错误报告生成
- [ ] 前端`device-batch-import.vue`页面
  - [ ] Excel模板下载
  - [ ] 文件上传
  - [ ] 进度显示
  - [ ] 错误报告展示

**Week 1交付物**:
- [ ] 开发环境就绪
- [ ] 设备自动发现后端服务（测试通过）
- [ ] 批量设备导入后端服务（测试通过）
- [ ] 前端批量导入页面（UI完成）

#### Week 2: 设备自动发现前端与全局反潜回启动

**Day 8-10: 设备自动发现前端**
- [ ] 前端`device-auto-discovery.vue`页面
  - [ ] 扫描进度实时显示（WebSocket）
  - [ ] 发现设备列表
  - [ ] 一键批量添加
  - [ ] 扫描结果导出
- [ ] 移动端`device-auto-discover.vue`页面
  - [ ] 扫描控制UI
  - [ ] 设备列表展示
  - [ ] 单个设备添加

**Day 11-14: 全局反潜回功能（数据库+后端）**
- [ ] 数据库表设计
  - [ ] `t_anti_passback_config`（配置表）
  - [ ] `t_anti_passback_record`（检测记录表）
  - [ ] 复合索引优化
- [ ] 后端`AntiPassbackService`服务
  - [ ] 全局反潜回模式
  - [ ] 区域反潜回模式
  - [ ] 软反潜回（告警）
  - [ ] 硬反潜回（阻止通行）
  - [ ] 检测算法（<100ms响应）
  - [ ] 防抖处理

**Week 2交付物**:
- [ ] 设备自动发现前端页面（功能完整）
- [ ] 设备自动发现移动端页面（功能完整）
- [ ] 全局反潜回数据库表（上线）
- [ ] 全局反潜回后端服务（单元测试通过）

---

### Week 3-4: 门禁核心功能与考勤智能排班启动

#### Week 3: 全局反潜回完成与固件升级启动

**Day 15-17: 全局反潜回完成**
- [ ] 后端`AntiPassbackManager`业务编排
  - [ ] 反潜回规则配置
  - [ ] 区域关联管理
  - [ ] 检测记录查询
  - [ ] 统计分析
- [ ] 前端`anti-passback-config.vue`页面
  - [ ] 模式选择
  - [ ] 区域配置
  - [ ] 时间窗口配置
  - [ ] 检测记录查询
  - [ ] 统计报表
- [ ] 性能测试
  - [ ] 4种模式测试
  - [ ] 响应时间测试（<100ms）
  - [ ] 边界条件测试
  - [ ] 并发测试（1000 TPS）

**Day 18-21: 固件升级管理功能（数据库+后端）**
- [ ] 数据库表设计
  - [ ] `t_device_firmware`（固件信息表）
  - [ ] `t_firmware_upgrade_task`（升级任务表）
  - [ ] 索引优化
- [ ] 后端`FirmwareService`服务
  - [ ] 固件上传（MD5校验）
  - [ ] 固件版本管理
  - [ ] 固件下载接口
- [ ] 后端`FirmwareUpgradeService`服务
  - [ ] 升级任务创建
  - [ ] 批量设备选择
  - [ ] 升级进度跟踪
  - [ ] 升级结果记录
- [ ] 后端`FirmwareManager`业务编排
  - [ ] 升级流程编排
  - [ ] 失败重试机制
  - [ ] 回滚支持

**Week 3交付物**:
- [ ] 全局反潜回功能（100%完成，测试通过）
- [ ] 固件升级数据库表（上线）
- [ ] 固件升级后端服务（单元测试通过）

#### Week 4: 固件升级完成与智能排班启动

**Day 22-24: 固件升级完成**
- [ ] 前端`firmware-management.vue`页面
  - [ ] 固件上传
  - [ ] 固件列表
  - [ ] 升级任务创建
  - [ ] 升级进度监控
  - [ ] 升级历史查询
- [ ] 移动端`firmware-monitor.vue`页面
  - [ ] 升级进度查看
  - [ ] 升级通知推送
- [ ] 完整测试流程
  - [ ] 固件上传测试
  - [ ] 升级流程测试
  - [ ] 异常处理测试
  - [ ] 性能测试

**Day 25-28: 智能排班算法启动（技术栈集成）**
- [ ] Aviator规则引擎集成
  - [ ] Maven依赖添加
  - [ ] 表达式解析器
  - [ ] 规则验证器
  - [ ] 规则执行器
- [ ] OptaPlanner约束求解器集成
  - [ ] Maven依赖添加
  - [ ] 约束定义（硬约束/软约束）
  - [ ] 求解器配置
  - [ ] 评分函数
  - [ ] 性能优化配置
- [ ] TensorFlow预测模型集成
  - [ ] Maven依赖添加
  - [ ] 模型训练框架
  - [ ] 预测接口

**Week 4交付物**:
- [ ] 固件升级功能（100%完成，测试通过）
- [ ] Aviator规则引擎（集成完成）
- [ ] OptaPlanner求解器（集成完成）
- [ ] TensorFlow预测（集成完成）

**第1月末里程碑**:
- [ ] P0级核心功能完成度30%
- [ ] 系统完成度68%→76%
- [ ] 门禁管理完成度58%→75%
- [ ] 考勤管理完成度70%→75%

---

### Week 5-6: 智能排班算法与考勤其他功能

#### Week 5: 智能排班算法核心实现

**Day 29-35: 智能排班算法（12人天，持续2周）**

**Week 5重点: 算法实现**

**后端`SmartScheduleEngine`服务**:
- [ ] 硬约束实现（3天）
  - [ ] 班次覆盖约束（每个班次必须有人员）
  - [ ] 员工技能约束（员工技能匹配岗位要求）
  - [ ] 工时限制约束（每天≤8小时，每周≤40小时）
  - [ ] 连续工作天数约束（连续≤6天）
  - [ ] 休息间隔约束（休息≥11小时）

- [ ] 软约束实现（3天）
  - [ ] 员工偏好约束（尽量满足员工意愿）
  - [ ] 公平性约束（工作量均衡）
  - [ ] 成本优化约束（加班成本最小化）
  - [ ] 班次连续性约束（避免频繁换班）

- [ ] 优化目标函数（1天）
  - [ ] 多目标加权函数
  - [ ] 约束权重配置
  - [ ] 目标值计算

**后端`SchedulePredictionService`服务**:
- [ ] 基于历史数据预测（2天）
  - [ ] 节假日历史数据分析
  - [ ] 业务量预测模型
  - [ ] 人员需求预测
  - [ ] 突发事件预测

**Week 5交付物**:
- [ ] 硬约束实现（测试通过）
- [ ] 软约束实现（测试通过）
- [ ] 优化目标函数（测试通过）
- [ ] 预测服务（基础功能完成）

#### Week 6: 智能排班完成与考勤其他功能

**Day 36-42: 智能排班完成（Week 5延续）**

**Week 6重点: 业务编排与前端**

**后端`SmartScheduleManager`业务编排**:
- [ ] 排班流程编排（1天）
  - [ ] 参数配置
  - [ ] 约束配置
  - [ ] 算法执行
  - [ ] 结果验证
- [ ] 排班结果验证（1天）
  - [ ] 硬约束检查
  - [ ] 软约束评分
  - [ ] 可行性验证
- [ ] 排班调整建议（1天）
  - [ ] 冲突识别
  - [ ] 调整建议生成
  - [ ] 手动调整支持
- [ ] 排班导出（1天）
  - [ ] Excel导出
  - [ ] PDF排班表
  - [ ] 日历同步

**前端`smart-scheduling.vue`页面**:
- [ ] 排班参数配置（2天）
  - [ ] 排班日期范围
  - [ ] 员工选择
  - [ ] 班次配置
  - [ ] 约束权重配置
- [ ] 一键智能排班（1天）
  - [ ] 启动排班按钮
  - [ ] 进度显示
  - [ ] 实时状态
- [ ] 排班结果展示（1天）
  - [ ] 日历视图
  - [ ] 表格视图
  - [ ] 统计信息
- [ ] 排班调整交互（1天）
  - [ ] 拖拽调整
  - [ ] 手动编辑
  - [ ] 冲突提示
- [ ] 排班导出功能（1天）

**完整测试**:
- [ ] 算法准确性测试
  - [ ] 小规模测试（10人7天）
  - [ ] 中规模测试（50人30天）
  - [ ] 大规模测试（100人30天）
- [ ] 性能测试
  - [ ] 10人7天<3秒
  - [ ] 50人30天<15秒
  - [ ] 100人30天<30秒
- [ ] 边界条件测试

**Week 6其他: 考勤规则配置引擎启动**（并行进行）
- [ ] 后端`AttendanceRuleEngine`服务
  - [ ] Aviator表达式解析
  - [ ] 规则验证
  - [ ] 规则执行

**Week 6交付物**:
- [ ] 智能排班算法（100%完成，性能测试通过）
- [ ] 前端智能排班页面（功能完整）
- [ ] 考勤规则配置引擎（后端完成）

**第2月末里程碑**:
- [ ] P0级核心功能完成度70%
- [ ] 系统完成度76%→82%
- [ ] 考勤管理完成度75%→85%

---

### Week 7-8: 访客与消费核心功能

#### Week 7: 访客管理与消费核心功能

**Day 43-45: 访客预约审批流程**
- [ ] 数据库表设计
  - [ ] `t_visitor_appointment`（预约表）
  - [ ] `t_appointment_approval`（审批表）
- [ ] 后端`AppointmentService`服务
  - [ ] 预约创建
  - [ ] 预约查询
  - [ ] 预约取消
- [ ] 后端`AppointmentApprovalService`服务
  - [ ] 工作流集成
  - [ ] 审批处理
  - [ ] 状态更新
- [ ] 前端`visitor-appointment.vue`页面（员工）
  - [ ] 在线预约表单
  - [ ] 预约记录查询
  - [ ] 预约详情
- [ ] 前端`appointment-approval.vue`页面（审批人）
  - [ ] 待审批列表
  - [ ] 审批操作
  - [ ] 审批历史

**Day 46-49: 电子通行证系统**
- [ ] 后端`ElectronicPassService`服务
  - [ ] ZXing二维码生成
  - [ ] AES加密
  - [ ] 有效期控制（≤24小时）
  - [ ] 离线验证支持
- [ ] 后端`PassValidationService`服务
  - [ ] 二维码解析
  - [ ] AES解密
  - [ ] 通行证验证
  - [ ] 验证记录
- [ ] 前端`electronic-pass-display.vue`页面
  - [ ] 通行证展示
  - [ ] 二维码显示
  - [ ] 有效期倒计时
- [ ] 移动端`epass-mobile.vue`页面
  - [ ] 移动端通行证
  - [ ] 离线通行证缓存
- [ ] 完整测试
  - [ ] 生成测试
  - [ ] 验证测试
  - [ ] 安全测试

**Day 50-52: 消费离线同步启动**
- [ ] 移动端IndexedDB本地存储
  - [ ] 离线消费记录表
  - [ ] 设备配置缓存
  - [ ] 用户信息缓存
- [ ] 移动端离线消费逻辑
  - [ ] 本地余额计算
  - [ ] 离线消费记录
  - [ ] 离线状态提示
- [ ] 后端`OfflineSyncService`服务
  - [ ] 批量上传接口
  - [ ] 数据校验逻辑
  - [ ] 冲突解决策略
  - [ ] 完整性验证

**Week 7交付物**:
- [ ] 访客预约审批流程（100%完成）
- [ ] 电子通行证系统（100%完成，测试通过）
- [ ] 离线消费同步（移动端完成）

#### Week 8: 消费核心功能与视频核心功能

**Day 53-56: 消费功能完善**
- [ ] 后端`OfflineSyncManager`业务编排
  - [ ] 同步流程编排
  - [ ] 失败重试机制
  - [ ] 同步结果通知
- [ ] 前端`offline-sync-monitor.vue`页面
  - [ ] 同步状态监控
  - [ ] 同步记录查询
  - [ ] 冲突记录处理
- [ ] 离线消费完整测试
  - [ ] 离线消费测试
  - [ ] 同步逻辑测试
  - [ ] 冲突解决测试
  - [ ] 数据完整性测试

**Day 57-60: 视频质量诊断与地图展示**
- [ ] 后端`QualityDiagnosisService`服务
  - [ ] 视频质量检测
  - [ ] 清晰度检测
  - [ ] 亮度检测
  - [ ] 噪点检测
  - [ ] 丢帧检测
- [ ] 后端`DeviceHealthScoring`服务
  - [ ] 健康评分算法
  - [ ] 质量趋势分析
  - [ ] 质量报告生成
- [ ] 前端`quality-diagnosis.vue`页面
  - [ ] 质量指标展示
  - [ ] 健康评分展示
  - [ ] 质量趋势图表
- [ ] 视频地图展示启动
  - [ ] 地图SDK选型（百度/高德/Leaflet）
  - [ ] 前端`video-map-display.vue`页面
  - [ ] 摄像头标注
  - [ ] 点击播放视频
  - [ ] 告警联动闪烁

**Week 8交付物**:
- [ ] 离线消费同步（100%完成，测试通过）
- [ ] 视频质量诊断（100%完成）
- [ ] 视频地图展示（前端完成）

**第2月末最终里程碑**:
- [ ] P0级核心功能完成度100%
- [ ] 系统完成度68%→85%（+17%）
- [ ] 门禁管理完成度58%→85%（+27%）
- [ ] 考勤管理完成度70%→88%（+18%）
- [ ] 消费管理完成度63%→82%（+19%）
- [ ] 访客管理完成度58%→80%（+22%）
- [ ] 视频监控完成度75%→88%（+13%）

---

## 📊 资源分配与团队协作

### 团队配置（5人）

**项目经理（0.5人天）**
- 负责进度管理、风险控制、资源协调
- 每日站会主持、每周进度汇报
- 里程碑验收、质量把控

**后端开发工程师A（全职）**
- 专注门禁管理模块（设备发现、反潜回、固件升级）
- 支持访客管理模块（预约审批、电子通行证）

**后端开发工程师B（全职）**
- 专注考勤管理模块（智能排班、规则配置）
- 支持消费管理模块（离线同步）

**前端开发工程师（全职）**
- 所有前端页面开发
- Vue组件开发与优化
- 前后端API联调

**移动端开发工程师（全职）**
- 移动端页面开发
- uni-app跨平台适配
- 移动端特有功能实现

**测试工程师（全职）**
- 单元测试编写
- 集成测试实施
- 性能测试执行
- 自动化测试建设

### 协作机制

**每日站会**（10:00-10:15）
- 昨日完成的任务
- 今日计划的任务
- 遇到的阻碍和需要的帮助

**每周回顾**（周五16:00-17:00）
- 本周完成情况
- 下周计划
- 风险识别
- 调整措施

**里程碑验收**（每月末）
- 功能完整性验收
- 质量指标验收
- 性能指标验收
- 文档完整性验收

---

## 🎯 质量保障措施

### 代码质量
- [ ] SonarQube扫描（每日）
- [ ] 代码审查（每个PR）
- [ ] 单元测试覆盖率≥80%（核心业务100%）
- [ ] 代码规范检查（Checkstyle）

### 功能质量
- [ ] 功能测试用例（每个功能≥5个用例）
- [ ] 边界条件测试
- [ ] 异常场景测试
- [ ] 性能基准测试

### 文档质量
- [ ] API文档100%（Swagger）
- [ ] 开发文档完整
- [ ] 测试报告完整
- [ ] 部署文档完整

---

## ⚠️ 风险控制

### 技术风险

**风险1: OptaPlanner学习曲线陡峭**
- 缓解措施: Week 4启动技术预研，预留2天学习时间
- 备用方案: 简化版启发式算法

**风险2: TensorFlow集成复杂**
- 缓解措施: 先完成基础版本，预测功能P1阶段完善
- 备用方案: 使用统计模型替代

**风险3: 性能指标难以达成**
- 缓解措施: Week 2开始性能测试，提前发现问题
- 备用方案: 分批优化，先达成80%目标

### 进度风险

**风险1: 功能复杂度超预期**
- 缓解措施: 每周回顾，及时调整排期
- 备用方案: 优先完成核心功能，次要功能P1阶段完成

**风险2: 人员变动**
- 缓解措施: 代码规范统一，知识共享充分
- 备用方案: 外部资源补充

### 质量风险

**风险1: 测试覆盖不充分**
- 缓解措施: 测试工程师全程参与，TDD开发模式
- 备用方案: 增加测试时间，P1阶段补充

**风险2: 线上问题**
- 缓解措施: 灰度发布，快速回滚机制
- 备用方案: 紧急修复流程

---

## 📝 下一步行动

### 立即行动（本周内）

1. **成立专项工作组**
   - [ ] 任命项目经理
   - [ ] 组建5人团队
   - [ ] 制定详细排期（本次已完成）
   - [ ] 建立协作机制

2. **环境准备**
   - [ ] 搭建开发环境
   - [ ] 配置CI/CD流水线
   - [ ] 配置SonarQube
   - [ ] 准备测试环境

3. **技术预研**
   - [ ] OptaPlanner官方文档学习
   - [ ] Aviator规则引擎实践
   - [ ] TensorFlow Java API学习
   - [ ] ZXing二维码生成实践

4. **启动开发**
   - [ ] Week 1 Day 3启动设备自动发现功能
   - [ ] 建立Git分支：feature/p0-device-discovery
   - [ ] 创建JIRA任务
   - [ ] 开始每日站会

### 本周目标（Week 1）

- [ ] 完成开发环境搭建
- [ ] 完成设备自动发现后端服务（80%）
- [ ] 完成批量设备导入后端服务（100%）
- [ ] SonarQube代码质量平台运行
- [ ] 第一轮代码审查

---

**报告生成时间**: 2025-01-30
**下次更新**: Week 1结束（2025-02-06）
**负责人**: IOE-DREAM开发团队
**审批人**: 项目委员会
