# IOE-DREAM ç¼–è¯‘å¼‚å¸¸æ ¹æºæ€§è§£å†³æ–¹æ¡ˆä¸ä¼ä¸šçº§è´¨é‡æå‡è®¡åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0 - ä¼ä¸šçº§å®Œæ•´æ–¹æ¡ˆ  
**åˆ¶å®šæ—¥æœŸ**: 2025-12-17  
**é€‚ç”¨èŒƒå›´**: IOE-DREAM æ™ºæ…§å›­åŒºä¸€å¡é€šç®¡ç†å¹³å°å…¨é¡¹ç›®  
**æ‰§è¡Œä¼˜å…ˆçº§**: P0 - æœ€é«˜ä¼˜å…ˆçº§  
**é¢„ä¼°å·¥æœŸ**: 3-4 å‘¨ï¼ˆåˆ†3ä¸ªé˜¶æ®µï¼‰  
**æ–‡æ¡£æ€§è´¨**: å›¢é˜Ÿå¼€å‘ä¸ç»´æŠ¤æƒå¨æŒ‡å¯¼ä¾æ®  

---

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

- [ä¸€ã€æ‰§è¡Œæ‘˜è¦](#ä¸€æ‰§è¡Œæ‘˜è¦)
- [äºŒã€é—®é¢˜æ ¹æºæ·±åº¦åˆ†æ](#äºŒé—®é¢˜æ ¹æºæ·±åº¦åˆ†æ)
- [ä¸‰ã€ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ](#ä¸‰ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ)
- [å››ã€åˆ†é˜¶æ®µå·¥ä½œè®¡åˆ’](#å››åˆ†é˜¶æ®µå·¥ä½œè®¡åˆ’)
- [äº”ã€å…¨å±€ä¸€è‡´æ€§è§„èŒƒ](#äº”å…¨å±€ä¸€è‡´æ€§è§„èŒƒ)
- [å…­ã€è´¨é‡ä¿éšœä½“ç³»](#å…­è´¨é‡ä¿éšœä½“ç³»)
- [ä¸ƒã€é£é™©ç®¡ç†ä¸åº”æ€¥é¢„æ¡ˆ](#ä¸ƒé£é™©ç®¡ç†ä¸åº”æ€¥é¢„æ¡ˆ)
- [å…«ã€é¡¹ç›®éªŒæ”¶æ ‡å‡†](#å…«é¡¹ç›®éªŒæ”¶æ ‡å‡†)

---

## ä¸€ã€æ‰§è¡Œæ‘˜è¦

### 1.1 å½“å‰çŠ¶å†µè¯„ä¼°

IOE-DREAM é¡¹ç›®å½“å‰å¤„äº **P0 çº§ä¼ä¸šå±æœºçŠ¶æ€**ï¼Œä¸»è¦è¡¨ç°ä¸ºï¼š

```plaintext
ç¼–è¯‘çŠ¶æ€: âŒ å®Œå…¨å¤±è´¥ (69ä¸ªç¼–è¯‘é”™è¯¯)
æ„å»ºçŠ¶æ€: âŒ æ— æ³•æ„å»º
éƒ¨ç½²çŠ¶æ€: âŒ æ— æ³•éƒ¨ç½²
åŠŸèƒ½å¼€å‘: â¸ï¸ å®Œå…¨é˜»å¡
å›¢é˜Ÿæ•ˆç‡: âš ï¸ é™ä½80%
ä¸šåŠ¡å½±å“: ğŸ”´ ä¸¥é‡ - æ— æ³•äº¤ä»˜
```

### 1.2 æ ¹æºæ€§åŸå› æ€»ç»“

ç»è¿‡å…¨å±€ä»£ç æ·±åº¦åˆ†æï¼Œé—®é¢˜å‘ˆç°**äº”å±‚é‡‘å­—å¡”ç»“æ„**ï¼š

| å±‚çº§ | åŸå› ç±»å‹ | å½±å“æƒé‡ | è§£å†³éš¾åº¦ |
|------|---------|---------|---------|
| **L5 ç»„ç»‡æµç¨‹å±‚** | è´¨é‡é—¨ç¦ç¼ºå¤±ã€æŠ€æœ¯å€ºåŠ¡å¤±æ§ | 30% | â­â­â­â­â­ |
| **L4 æ¼”è¿›ç®¡ç†å±‚** | æ¶æ„é‡æ„åŠé€”è€ŒåºŸã€è¿ç§»ä¸å®Œæ•´ | 50% | â­â­â­â­â­ |
| **L3 æ¶æ„è®¾è®¡å±‚** | æ¨¡å—èŒè´£ä¸æ¸…ã€ä¾èµ–æ··ä¹± | 15% | â­â­â­â­ |
| **L2 ä»£ç å®ç°å±‚** | APIä¸åŒ¹é…ã€ç±»å¼•ç”¨é”™è¯¯ | 5% | â­â­â­ |
| **L1 ç¼–è¯‘é”™è¯¯å±‚** | 69ä¸ªç¼–è¯‘é”™è¯¯ | 0% | â­â­ |

**æ ¸å¿ƒç»“è®º**: è¿™æ˜¯å…¸å‹çš„"ç»„ç»‡å‹æŠ€æœ¯å€ºåŠ¡å±æœº"ï¼Œéœ€è¦ç³»ç»Ÿæ€§è§£å†³ã€‚

### 1.3 è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ

æœ¬æ–¹æ¡ˆé‡‡ç”¨**ä¸‰é˜¶æ®µé€’è¿›å¼**è§£å†³ç­–ç•¥ï¼š

```mermaid
graph LR
    A[é˜¶æ®µ1<br/>ç´§æ€¥æ­¢è¡€<br/>3-5å¤©] --> B[é˜¶æ®µ2<br/>æ¶æ„é‡æ„<br/>2-3å‘¨]
    B --> C[é˜¶æ®µ3<br/>è´¨é‡æå‡<br/>1å‘¨]
    
    A1[ä¿®å¤ç¼–è¯‘é”™è¯¯<br/>å®ŒæˆJakartaè¿ç§»] --> A
    B1[æ¨¡å—åŒ–æ‹†åˆ†<br/>ä¸šåŠ¡ä»£ç è¿ç§»<br/>ä¾èµ–å…³ç³»ä¼˜åŒ–] --> B
    C1[å»ºç«‹è´¨é‡é—¨ç¦<br/>å®Œå–„CI/CD<br/>åˆ¶å®šå¼€å‘è§„èŒƒ] --> C
```

### 1.4 é¢„æœŸæˆæœ

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | æå‡å¹…åº¦ |
|------|---------|---------|---------|
| **ç¼–è¯‘æˆåŠŸç‡** | 0% | 100% | +100% |
| **ä»£ç è´¨é‡è¯„åˆ†** | 6.5/10 | 9.0/10 | +38% |
| **æ¶æ„åˆè§„æ€§** | 60% | 95%+ | +58% |
| **æµ‹è¯•è¦†ç›–ç‡** | 45% | 85%+ | +89% |
| **æ„å»ºæ—¶é—´** | è¶…æ—¶ | <5åˆ†é’Ÿ | -80% |
| **å›¢é˜Ÿå¼€å‘æ•ˆç‡** | 20% | 100% | +400% |

---

## äºŒã€é—®é¢˜æ ¹æºæ·±åº¦åˆ†æ

### 2.1 æ¶æ„æ¼”è¿›é—®é¢˜åˆ†æ

#### 2.1.1 å½“å‰æ¶æ„çŠ¶æ€å›¾

```mermaid
graph TB
    subgraph "ç›®æ ‡æ¶æ„ (æœªå®Œæˆ)"
        Core[microservices-common-core<br/>æ ¸å¿ƒå…¬å…±]
        Security[microservices-common-security<br/>å®‰å…¨æ¨¡å—]
        Data[microservices-common-data<br/>æ•°æ®å±‚]
        Cache[microservices-common-cache<br/>ç¼“å­˜æ¨¡å—]
        Business[microservices-common-business<br/>ä¸šåŠ¡å…¬å…±]
        
        OA[ioedream-oa-service]
        Consume[ioedream-consume-service]
        Visitor[ioedream-visitor-service]
        Access[ioedream-access-service]
        
        OA --> Core
        OA --> Security
        Consume --> Core
        Consume --> Data
        Visitor --> Core
        Access --> Security
    end
    
    subgraph "å®é™…æ¶æ„ (æ··ä¹±çŠ¶æ€)"
        Common[microservices-common<br/>å¤§æ‚çƒ©<br/>âŒ åŒ…å«17ä¸ªä¸šåŠ¡ç›®å½•]
        
        Common --> |ä¸šåŠ¡ä»£ç æ··æ‚| Workflow[workflow/]
        Common --> |ä¸šåŠ¡ä»£ç æ··æ‚| ConsumeDir[consume/]
        Common --> |ä¸šåŠ¡ä»£ç æ··æ‚| VisitorDir[visitor/]
        Common --> |ä¸šåŠ¡ä»£ç æ··æ‚| AccessDir[access/]
        
        Services[æ‰€æœ‰å¾®æœåŠ¡] --> |å¼ºä¾èµ–| Common
    end
    
    style Common fill:#ff6b6b
    style Services fill:#ffd93d
```

#### 2.1.2 é—®é¢˜æ¸…å•

**æ–‡ä»¶è·¯å¾„**: `d:\IOE-DREAM\microservices\microservices-common\src\main\java\net\lab1024\sa\common\`

| é—®é¢˜ç›®å½• | åº”å½’å±æœåŠ¡ | å½“å‰ä½ç½® | å½±å“èŒƒå›´ |
|---------|-----------|---------|---------|
| `access/` | ioedream-access-service | microservices-common | é—¨ç¦æ¨¡å—å…¨å±€ |
| `consume/` | ioedream-consume-service | microservices-common | æ¶ˆè´¹æ¨¡å—å…¨å±€ |
| `oa/` | ioedream-oa-service | microservices-common | OAå·¥ä½œæµå…¨å±€ |
| `visitor/` | ioedream-visitor-service | microservices-common | è®¿å®¢ç®¡ç†å…¨å±€ |
| `attendance/` | ioedream-attendance-service | microservices-common | è€ƒå‹¤æ¨¡å—å…¨å±€ |
| `video/` | ioedream-video-service | microservices-common | è§†é¢‘ç›‘æ§å…¨å±€ |

**è¿ååŸåˆ™**: 
- âŒ å•ä¸€èŒè´£åŸåˆ™ (SRP)
- âŒ ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
- âŒ æ¥å£éš”ç¦»åŸåˆ™ (ISP)

### 2.2 ç¼–è¯‘é”™è¯¯è¯¦ç»†åˆ†æ

#### 2.2.1 é”™è¯¯åˆ†ç±»ç»Ÿè®¡

```mermaid
pie title 69ä¸ªç¼–è¯‘é”™è¯¯åˆ†ç±»åˆ†å¸ƒ
    "æ–¹æ³•ç­¾åä¸åŒ¹é…" : 25
    "ç±»å¼•ç”¨é”™è¯¯" : 18
    "ä¾èµ–æ³¨å…¥ç¼ºå¤±" : 12
    "ç±»å‹è½¬æ¢é”™è¯¯" : 8
    "Jakartaè¿ç§»æœªå®Œæˆ" : 6
```

#### 2.2.2 æ ¸å¿ƒé”™è¯¯æ¡ˆä¾‹åˆ†æ

**æ¡ˆä¾‹1: UserOpenApiServiceImpl é”™è¯¯é“¾**

**æ–‡ä»¶è·¯å¾„**: `d:\IOE-DREAM\microservices\ioedream-common-service\src\main\java\net\lab1024\sa\common\openapi\service\impl\UserOpenApiServiceImpl.java`

```java
// âŒ é”™è¯¯1: å¯¼å…¥äº†é”™è¯¯çš„ LoginRequest
import net.lab1024.sa.common.openapi.domain.request.LoginRequest;
// å®é™…åº”ä½¿ç”¨
// import net.lab1024.sa.common.auth.domain.dto.LoginRequest;

// âŒ é”™è¯¯2: APIç­¾åä¸åŒ¹é…
String accessToken = jwtTokenUtil.generateAccessToken(
    user.getUserId(), user.getUsername());
// JwtTokenUtil å®é™…ç­¾åéœ€è¦4ä¸ªå‚æ•°:
// generateAccessToken(Long userId, String username, 
//                     List<String> roles, List<String> permissions)

// âŒ é”™è¯¯3: ä¾èµ–æ³¨å…¥ç¼ºå¤±
securityManager.xxx(); // securityManager ä»æœªæ³¨å…¥

// âŒ é”™è¯¯4: æ–¹æ³•ä¸å­˜åœ¨
String phone = request.getPhone(); 
// openapi.LoginRequest æ²¡æœ‰ getPhone() æ–¹æ³•
```

**æ ¹æœ¬åŸå› åˆ†æå›¾**:

```mermaid
graph TD
    A[UserOpenApiServiceImpl<br/>ä½äº ioedream-common-service] --> B[ä¾èµ– microservices-common]
    B --> C[microservices-common æœªå®Œæˆæ‹†åˆ†]
    C --> D[åŒ…å«ä¸¤ä¸ª LoginRequest å®šä¹‰]
    C --> E[JwtTokenUtil API å·²é‡æ„]
    C --> F[SecurityManager æ¥å£æœªå®šä¹‰]
    
    D --> G[å¯¼å…¥é”™è¯¯çš„ç±»]
    E --> H[è°ƒç”¨æ—§APIç­¾å]
    F --> I[ä¾èµ–æ³¨å…¥å¤±è´¥]
    
    G --> J[ğŸ’¥ ç¼–è¯‘é”™è¯¯]
    H --> J
    I --> J
    
    style J fill:#ff6b6b
```

#### 2.2.3 Jakarta EE è¿ç§»çŠ¶æ€

**æ–‡ä»¶è·¯å¾„æ‰«æç»“æœ**:

```plaintext
æœªå®Œæˆè¿ç§»çš„æ–‡ä»¶ (ç¤ºä¾‹):
â”œâ”€â”€ microservices-common/src/.../SomeOldClass.java
â”‚   â””â”€â”€ import javax.annotation.Resource; âŒ
â”œâ”€â”€ microservices-common/src/.../AnotherClass.java  
â”‚   â””â”€â”€ import javax.validation.Valid; âŒ
â””â”€â”€ ... (é¢„ä¼°30+æ–‡ä»¶)

å·²å®Œæˆè¿ç§»çš„æ–‡ä»¶:
â”œâ”€â”€ microservices-common-core/... âœ…
â””â”€â”€ microservices-common-security/... âœ…
```

### 2.3 ä¾èµ–å…³ç³»é—®é¢˜åˆ†æ

#### 2.3.1 å½“å‰ä¾èµ–å…³ç³»å›¾

```mermaid
graph TD
    subgraph "âŒ å½“å‰æ··ä¹±çš„ä¾èµ–å…³ç³»"
        MC[microservices-common]
        CS[ioedream-common-service]
        AS[ioedream-access-service]
        
        MC -->|ä¸å½“ä¾èµ–| UserEntity[UserEntity<br/>ä¸šåŠ¡å®ä½“]
        MC -->|ä¸å½“ä¾èµ–| RoleEntity[RoleEntity<br/>ä¸šåŠ¡å®ä½“]
        
        CS --> MC
        AS --> MC
        
        CS -->|å¾ªç¯ä¾èµ–é£é™©| MC
    end
    
    subgraph "âœ… æ­£ç¡®çš„ä¾èµ–å…³ç³»"
        Core[common-core]
        Security[common-security]
        
        Service[ioedream-common-service]
        
        Security --> DataProvider[PermissionDataProvider<br/>æ¥å£]
        Service --> Security
        Service --> DataProvider
        Service --> Entities[ä¸šåŠ¡å®ä½“]
    end
    
    style MC fill:#ff6b6b
    style Core fill:#51cf66
```

#### 2.3.2 POM ä¾èµ–åˆ†æ

**çˆ¶POM**: `d:\IOE-DREAM\microservices\pom.xml`

```xml
<!-- âœ… ä¾èµ–ç®¡ç†é…ç½®å®Œæ•´ -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>3.5.8</version>
        </dependency>
        <!-- ... å…¶ä»–ä¾èµ– ... -->
    </dependencies>
</dependencyManagement>

<!-- âš ï¸ ä½†æ¨¡å—æ„å»ºé¡ºåºå­˜åœ¨é—®é¢˜ -->
<modules>
    <module>microservices-common-core</module>
    <module>microservices-common-security</module>
    <!-- ... -->
    <module>microservices-common</module> <!-- âŒ åº”è¯¥æœ€åæˆ–ç§»é™¤ -->
    <module>ioedream-common-service</module>
</modules>
```

---

## ä¸‰ã€ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ

### 3.1 æ€»ä½“è§£å†³ç­–ç•¥

#### 3.1.1 è§£å†³æ–¹æ¡ˆæ¶æ„å›¾

```mermaid
graph TB
    subgraph "é˜¶æ®µ1: ç´§æ€¥æ­¢è¡€ (3-5å¤©)"
        A1[1.1 ä¿®å¤æ˜æ˜¾ç¼–è¯‘é”™è¯¯]
        A2[1.2 å®ŒæˆJakartaè¿ç§»]
        A3[1.3 ä¿®å¤APIç­¾åä¸åŒ¹é…]
        A4[1.4 è¡¥å……ä¾èµ–æ³¨å…¥]
        A5[1.5 å»ºç«‹ä¸´æ—¶å¯ç¼–è¯‘çŠ¶æ€]
        
        A1 --> A2 --> A3 --> A4 --> A5
    end
    
    subgraph "é˜¶æ®µ2: æ¶æ„é‡æ„ (2-3å‘¨)"
        B1[2.1 å®Œæˆæ¨¡å—åŒ–æ‹†åˆ†]
        B2[2.2 è¿ç§»ä¸šåŠ¡ä»£ç ]
        B3[2.3 é‡æ„ä¾èµ–å…³ç³»]
        B4[2.4 æ¸…ç†microservices-common]
        B5[2.5 ç»Ÿä¸€æŠ€æœ¯æ ˆç‰ˆæœ¬]
        
        B1 --> B2 --> B3 --> B4 --> B5
    end
    
    subgraph "é˜¶æ®µ3: è´¨é‡æå‡ (1å‘¨)"
        C1[3.1 å»ºç«‹CI/CDè´¨é‡é—¨ç¦]
        C2[3.2 å®Œå–„è‡ªåŠ¨åŒ–æµ‹è¯•]
        C3[3.3 åˆ¶å®šå¼€å‘è§„èŒƒ]
        C4[3.4 å»ºç«‹ä»£ç å®¡æŸ¥æœºåˆ¶]
        C5[3.5 å®Œå–„æ–‡æ¡£ä½“ç³»]
        
        C1 --> C2 --> C3 --> C4 --> C5
    end
    
    A5 --> B1
    B5 --> C1
```

### 3.2 é˜¶æ®µ1: ç´§æ€¥æ­¢è¡€æ–¹æ¡ˆ (3-5å¤©)

#### 3.2.1 ä»»åŠ¡1.1: ä¿®å¤æ˜æ˜¾ç¼–è¯‘é”™è¯¯

**ç›®æ ‡**: ä¿®å¤ UserOpenApiServiceImpl ä¸­çš„ 60 ä¸ªç¼–è¯‘é”™è¯¯

**æ¶‰åŠæ–‡ä»¶**:
- `d:\IOE-DREAM\microservices\ioedream-common-service\src\main\java\net\lab1024\sa\common\openapi\service\impl\UserOpenApiServiceImpl.java`

**å®æ–½æ­¥éª¤**:

**æ­¥éª¤1: ä¿®å¤ LoginRequest ç±»å¼•ç”¨**

```java
// âŒ åˆ é™¤é”™è¯¯çš„å¯¼å…¥
// import net.lab1024.sa.common.openapi.domain.request.LoginRequest;

// âœ… ä½¿ç”¨æ­£ç¡®çš„å¯¼å…¥
import net.lab1024.sa.common.auth.domain.dto.LoginRequest;
```

**æ­¥éª¤2: ä¿®å¤ JwtTokenUtil API è°ƒç”¨**

```java
// âŒ é”™è¯¯çš„è°ƒç”¨æ–¹å¼ (2ä¸ªå‚æ•°)
String accessToken = jwtTokenUtil.generateAccessToken(
    user.getUserId(), user.getUsername());

// âœ… æ–¹æ¡ˆA: ä½¿ç”¨é‡è½½æ–¹æ³• (å¦‚æœå­˜åœ¨)
String accessToken = jwtTokenUtil.generateAccessToken(
    user.getUserId(), user.getUsername());

// âœ… æ–¹æ¡ˆB: ä¼ é€’å®Œæ•´å‚æ•°
List<String> roles = userRoleService.getUserRoles(user.getUserId());
List<String> permissions = permissionService.getUserPermissions(user.getUserId());
String accessToken = jwtTokenUtil.generateAccessToken(
    user.getUserId(), user.getUsername(), roles, permissions);
```

**æ­¥éª¤3: æ³¨å…¥ SecurityManager ä¾èµ–**

```java
@Slf4j
@Service
public class UserOpenApiServiceImpl implements UserOpenApiService {
    
    @Resource
    private JwtTokenUtil jwtTokenUtil;
    
    // âœ… æ–°å¢ SecurityManager æ³¨å…¥
    @Resource
    private SecurityManager securityManager;
    
    // âœ… å¦‚æœ SecurityManager ä¸å­˜åœ¨,éœ€è¦åˆ›å»ºæ¥å£
    // æ–‡ä»¶: microservices-common-security/.../SecurityManager.java
    
    // ... å…¶ä»–ä»£ç  ...
}
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… æ‰€æœ‰Serviceç±»å¿…é¡»ä½¿ç”¨ `@Service` æ³¨è§£
2. âœ… æ‰€æœ‰ä¾èµ–æ³¨å…¥å¿…é¡»ä½¿ç”¨ `@Resource` (æ¨è) æˆ– `@Autowired`
3. âœ… æ‰€æœ‰Serviceç±»å¿…é¡»æ·»åŠ  `@Slf4j` æ³¨è§£ç”¨äºæ—¥å¿—
4. âœ… å¯¼å…¥è¯­å¥å¿…é¡»æŒ‰ç…§è§„èŒƒæ’åº: Javaæ ‡å‡†åº“ â†’ ç¬¬ä¸‰æ–¹åº“ â†’ é¡¹ç›®å†…éƒ¨

**éªŒè¯æ–¹æ³•**:
```powershell
# ç¼–è¯‘éªŒè¯
cd d:\IOE-DREAM\microservices\ioedream-common-service
mvn clean compile -DskipTests

# é¢„æœŸç»“æœ: ç¼–è¯‘æˆåŠŸ,é”™è¯¯æ•°ä»60é™åˆ°0
```

#### 3.2.2 ä»»åŠ¡1.2: å®Œæˆ Jakarta EE è¿ç§»

**ç›®æ ‡**: å…¨é¢å®Œæˆ javax.* â†’ jakarta.* åŒ…åè¿ç§»

**è‡ªåŠ¨åŒ–è¿ç§»è„šæœ¬**:

**æ–‡ä»¶**: `d:\IOE-DREAM\scripts\migrate-to-jakarta.ps1`

```powershell
# IOE-DREAM Jakarta EE è¿ç§»è„šæœ¬
# ç‰ˆæœ¬: 1.0
# ç”¨é€”: è‡ªåŠ¨åŒ–æ›¿æ¢ javax.* ä¸º jakarta.*

param(
    [string]$ProjectRoot = "d:\IOE-DREAM\microservices",
    [switch]$DryRun = $false
)

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Jakarta EE è¿ç§»å·¥å…·" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""

$replacements = @{
    'javax.annotation.Resource' = 'jakarta.annotation.Resource'
    'javax.annotation.PostConstruct' = 'jakarta.annotation.PostConstruct'
    'javax.annotation.PreDestroy' = 'jakarta.annotation.PreDestroy'
    'javax.validation.Valid' = 'jakarta.validation.Valid'
    'javax.validation.constraints.' = 'jakarta.validation.constraints.'
    'javax.transaction.Transactional' = 'jakarta.transaction.Transactional'
    'javax.servlet.' = 'jakarta.servlet.'
    'javax.persistence.' = 'jakarta.persistence.'
}

$files = Get-ChildItem -Path $ProjectRoot -Filter "*.java" -Recurse
$totalFixed = 0

foreach ($file in $files) {
    $content = Get-Content $file.FullName -Raw
    $originalContent = $content
    $fileChanged = $false
    
    foreach ($old in $replacements.Keys) {
        $new = $replacements[$old]
        if ($content -match [regex]::Escape($old)) {
            $content = $content -replace [regex]::Escape($old), $new
            $fileChanged = $true
        }
    }
    
    if ($fileChanged) {
        if (-not $DryRun) {
            Set-Content -Path $file.FullName -Value $content -NoNewline
            Write-Host "âœ… å·²ä¿®å¤: $($file.FullName)" -ForegroundColor Green
        } else {
            Write-Host "ğŸ” éœ€è¦ä¿®å¤: $($file.FullName)" -ForegroundColor Yellow
        }
        $totalFixed++
    }
}

Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "è¿ç§»å®Œæˆ!" -ForegroundColor Green
Write-Host "å…±å¤„ç†æ–‡ä»¶: $($files.Count)" -ForegroundColor White
Write-Host "ä¿®å¤æ–‡ä»¶æ•°: $totalFixed" -ForegroundColor Green
Write-Host "========================================" -ForegroundColor Cyan

if ($DryRun) {
    Write-Host ""
    Write-Host "âš ï¸ è¿™æ˜¯é¢„è§ˆæ¨¡å¼,æœªå®é™…ä¿®æ”¹æ–‡ä»¶" -ForegroundColor Yellow
    Write-Host "æ‰§è¡Œå®é™…è¿ç§»è¯·è¿è¡Œ: .\migrate-to-jakarta.ps1" -ForegroundColor Yellow
}
```

**æ‰§è¡Œæ­¥éª¤**:

```powershell
# æ­¥éª¤1: é¢„è§ˆæ¨¡å¼ (ä¸ä¿®æ”¹æ–‡ä»¶)
cd d:\IOE-DREAM\scripts
.\migrate-to-jakarta.ps1 -DryRun

# æ­¥éª¤2: ç¡®è®¤æ— è¯¯åæ‰§è¡Œå®é™…è¿ç§»
.\migrate-to-jakarta.ps1

# æ­¥éª¤3: éªŒè¯ç¼–è¯‘
cd ..\microservices
mvn clean compile -DskipTests
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… é¡¹ç›®ä¸­**ç¦æ­¢**å‡ºç°ä»»ä½• `javax.*` åŒ…å¯¼å…¥
2. âœ… æ‰€æœ‰æ–°ä»£ç å¿…é¡»ä½¿ç”¨ `jakarta.*` å‘½åç©ºé—´
3. âœ… POMä¾èµ–å¿…é¡»ä½¿ç”¨æ”¯æŒ Jakarta çš„ç‰ˆæœ¬
4. âœ… CI/CD ä¸­å¿…é¡»æ·»åŠ  jakarta åŒ…åæ£€æŸ¥

**éªŒè¯æ£€æŸ¥ç‚¹**:
```powershell
# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ javax æ®‹ç•™
cd d:\IOE-DREAM\microservices
findstr /s /i /m "import javax\." *.java

# é¢„æœŸç»“æœ: æ— ä»»ä½•åŒ¹é…
```

#### 3.2.3 ä»»åŠ¡1.3: ä¿®å¤è§†é¢‘æ¨¡å—ç±»å‹è½¬æ¢é”™è¯¯

**ç›®æ ‡**: ä¿®å¤ VideoBehaviorManagerã€VideoFaceManagerã€VideoPTZManager ä¸­çš„ç±»å‹é”™è¯¯

**æ¶‰åŠæ–‡ä»¶**:
- `d:\IOE-DREAM\microservices\microservices-common\src\main\java\net\lab1024\sa\common\video\manager\VideoBehaviorManager.java`
- `d:\IOE-DREAM\microservices\microservices-common\src\main\java\net\lab1024\sa\common\video\manager\VideoFaceManager.java`
- `d:\IOE-DREAM\microservices\microservices-common\src\main\java\net\lab1024\sa\common\video\manager\VideoPTZManager.java`

**é—®é¢˜åˆ†æä¸ä¿®å¤**:

**é”™è¯¯1: VideoBehaviorManager.java:239**
```java
// âŒ é”™è¯¯ä»£ç 
VideoBehaviorPatternEntity pattern = ...;
VideoBehaviorEntity behavior = someMethod(pattern); // ç±»å‹ä¸åŒ¹é…

// âœ… ä¿®å¤æ–¹æ¡ˆ: ç±»å‹è½¬æ¢æˆ–æ–¹æ³•è¿”å›å€¼è°ƒæ•´
VideoBehaviorPatternEntity pattern = ...;
VideoBehaviorPatternEntity result = someMethod(pattern);
```

**é”™è¯¯2: VideoFaceManager.java:147**
```java
// âŒ é”™è¯¯ä»£ç 
Long cameraId = getCameraId();
int id = cameraId; // Long â†’ int ä¸å®‰å…¨è½¬æ¢

// âœ… ä¿®å¤æ–¹æ¡ˆ: ä½¿ç”¨å®‰å…¨çš„ç±»å‹è½¬æ¢
Long cameraId = getCameraId();
int id = cameraId != null ? cameraId.intValue() : 0;
// æˆ–è€…æ›´å¥½çš„åšæ³•: ä¿®æ”¹æ–¹æ³•ç­¾åç»Ÿä¸€ä½¿ç”¨ Long
```

**é”™è¯¯3: VideoPTZManager.java:243**
```java
// âŒ é”™è¯¯ä»£ç 
VideoPTZEntity entity = dao.selectById(id);
List<VideoPTZEntity> list = entity; // å•ä¸ªå¯¹è±¡ â†’ åˆ—è¡¨ é”™è¯¯

// âœ… ä¿®å¤æ–¹æ¡ˆ: è¿”å›å€¼åŒ…è£…ä¸ºåˆ—è¡¨
VideoPTZEntity entity = dao.selectById(id);
List<VideoPTZEntity> list = entity != null ? Collections.singletonList(entity) : Collections.emptyList();
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… Manager å±‚æ–¹æ³•è¿”å›å€¼å¿…é¡»æ˜ç¡®ç±»å‹,é¿å…éšå¼è½¬æ¢
2. âœ… æ•°å€¼ç±»å‹è½¬æ¢å¿…é¡»æ˜¾å¼ä¸”å®‰å…¨ (Long.intValue() ç­‰)
3. âœ… é›†åˆç±»å‹ä¸å…è®¸éšå¼è½¬æ¢,å¿…é¡»æ˜¾å¼åŒ…è£…
4. âœ… æ‰€æœ‰ç±»å‹è½¬æ¢å¿…é¡»æ·»åŠ  null æ£€æŸ¥

#### 3.2.4 é˜¶æ®µ1 éªŒæ”¶æ ‡å‡†

**éªŒæ”¶æ¸…å•**:

| æ£€æŸ¥é¡¹ | éªŒæ”¶æ ‡å‡† | éªŒè¯æ–¹æ³• |
|-------|---------|---------|
| **ç¼–è¯‘æˆåŠŸ** | 0 ç¼–è¯‘é”™è¯¯ | `mvn clean compile -DskipTests` |
| **Jakartaè¿ç§»** | æ—  javax.* å¯¼å…¥ | `findstr /s /i "import javax\." *.java` |
| **ä»£ç è§„èŒƒ** | é€šè¿‡ PMD æ£€æŸ¥ | `mvn pmd:check` |
| **ä¾èµ–æ³¨å…¥** | æ— æœªæ³¨å…¥çš„ä¾èµ– | ä»£ç å®¡æŸ¥ |

---

### 3.3 é˜¶æ®µ2: æ¶æ„é‡æ„æ–¹æ¡ˆ (2-3å‘¨)

#### 3.3.1 ä»»åŠ¡2.1: å®Œæˆæ¨¡å—åŒ–æ‹†åˆ†

**ç›®æ ‡**: å°† microservices-common ä¸­çš„ä¸šåŠ¡ä»£ç è¿ç§»åˆ°å¯¹åº”æœåŠ¡

**è¿ç§»è®¡åˆ’è¡¨**:

| æºç›®å½• | ç›®æ ‡ä½ç½® | æ–‡ä»¶æ•° | ä¼˜å…ˆçº§ | è´Ÿè´£äºº | é¢„ä¼°å·¥æ—¶ |
|-------|---------|-------|-------|-------|---------|
| `common/access/` | ioedream-access-service | ~15 | P0 | å¼ ä¸‰ | 2å¤© |
| `common/consume/` | ioedream-consume-service | ~20 | P0 | æå›› | 3å¤© |
| `common/oa/` | ioedream-oa-service | ~18 | P0 | ç‹äº” | 3å¤© |
| `common/visitor/` | ioedream-visitor-service | ~12 | P1 | èµµå…­ | 2å¤© |
| `common/attendance/` | ioedream-attendance-service | ~14 | P1 | å­™ä¸ƒ | 2å¤© |
| `common/video/` | ioedream-video-service | ~16 | P1 | å‘¨å…« | 2å¤© |

**è¿ç§»æµç¨‹å›¾**:

```mermaid
graph TD
    A[é€‰æ‹©å¾…è¿ç§»æ¨¡å—] --> B[åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„]
    B --> C[å¤åˆ¶ä»£ç æ–‡ä»¶]
    C --> D[ä¿®æ”¹packageå£°æ˜]
    D --> E[æ›´æ–°å¯¼å…¥è¯­å¥]
    E --> F[ä¿®å¤ä¾èµ–å¼•ç”¨]
    F --> G[æ›´æ–°POMä¾èµ–]
    G --> H[ç¼–è¯‘éªŒè¯]
    H --> I{ç¼–è¯‘æˆåŠŸ?}
    I -->|å¦| F
    I -->|æ˜¯| J[å•å…ƒæµ‹è¯•éªŒè¯]
    J --> K{æµ‹è¯•é€šè¿‡?}
    K -->|å¦| F
    K -->|æ˜¯| L[ä»£ç å®¡æŸ¥]
    L --> M[åˆå¹¶ä»£ç ]
    M --> N[åˆ é™¤æºæ–‡ä»¶]
```

**è¯¦ç»†å®æ–½æ­¥éª¤ (ä»¥ access æ¨¡å—ä¸ºä¾‹)**:

**æ­¥éª¤1: åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„**

```powershell
# ç›®æ ‡è·¯å¾„
cd d:\IOE-DREAM\microservices\ioedream-access-service\src\main\java\net\lab1024\sa

# åˆ›å»ºç›®å½•
mkdir -p access\manager
mkdir -p access\service
mkdir -p access\domain
```

**æ­¥éª¤2: å¤åˆ¶ä»£ç æ–‡ä»¶**

```powershell
# æºè·¯å¾„
$source = "d:\IOE-DREAM\microservices\microservices-common\src\main\java\net\lab1024\sa\common\access"
# ç›®æ ‡è·¯å¾„  
$target = "d:\IOE-DREAM\microservices\ioedream-access-service\src\main\java\net\lab1024\sa\access"

# å¤åˆ¶æ–‡ä»¶
Copy-Item -Path $source\* -Destination $target -Recurse
```

**æ­¥éª¤3: æ‰¹é‡ä¿®æ”¹ package å£°æ˜**

```powershell
# ä¿®æ”¹packageå£°æ˜è„šæœ¬
$files = Get-ChildItem -Path $target -Filter "*.java" -Recurse

foreach ($file in $files) {
    $content = Get-Content $file.FullName -Raw
    $content = $content -replace 'package net\.lab1024\.sa\.common\.access', 'package net.lab1024.sa.access'
    Set-Content -Path $file.FullName -Value $content -NoNewline
}
```

**æ­¥éª¤4: æ›´æ–°å¯¼å…¥è¯­å¥**

```powershell
# æ›´æ–°å¯¼å…¥è¯­å¥
foreach ($file in $files) {
    $content = Get-Content $file.FullName -Raw
    $content = $content -replace 'import net\.lab1024\.sa\.common\.access\.', 'import net.lab1024.sa.access.'
    Set-Content -Path $file.FullName -Value $content -NoNewline
}
```

**æ­¥éª¤5: æ›´æ–° POM ä¾èµ–**

**æ–‡ä»¶**: `d:\IOE-DREAM\microservices\ioedream-access-service\pom.xml`

```xml
<dependencies>
    <!-- âœ… ä¿ç•™å¿…è¦çš„å…¬å…±ä¾èµ– -->
    <dependency>
        <groupId>net.lab1024.sa</groupId>
        <artifactId>microservices-common-core</artifactId>
    </dependency>
    
    <dependency>
        <groupId>net.lab1024.sa</groupId>
        <artifactId>microservices-common-security</artifactId>
    </dependency>
    
    <dependency>
        <groupId>net.lab1024.sa</groupId>
        <artifactId>microservices-common-data</artifactId>
    </dependency>
    
    <!-- âŒ ç§»é™¤å¯¹ microservices-common çš„ä¾èµ– -->
    <!--
    <dependency>
        <groupId>net.lab1024.sa</groupId>
        <artifactId>microservices-common</artifactId>
    </dependency>
    -->
</dependencies>
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… åŒ…åå¿…é¡»éµå¾ªè§„èŒƒ: `net.lab1024.sa.{æœåŠ¡å}.{æ¨¡å—}`
2. âœ… ä¸šåŠ¡ä»£ç **ç¦æ­¢**æ”¾åœ¨ common æ¨¡å—
3. âœ… è¿ç§»åå¿…é¡»åˆ é™¤æºæ–‡ä»¶,é¿å…é‡å¤å®šä¹‰
4. âœ… æ¯æ¬¡è¿ç§»åå¿…é¡»è¿›è¡Œç¼–è¯‘å’Œæµ‹è¯•éªŒè¯

#### 3.3.2 ä»»åŠ¡2.2: é‡æ„ä¾èµ–å…³ç³»

**ç›®æ ‡**: å»ºç«‹æ¸…æ™°çš„ä¾èµ–å±‚æ¬¡,æ¶ˆé™¤å¾ªç¯ä¾èµ–

**æ­£ç¡®çš„ä¾èµ–å±‚æ¬¡å›¾**:

```mermaid
graph TB
    subgraph "ç¬¬1å±‚: æ ¸å¿ƒåŸºç¡€"
        Core[microservices-common-core<br/>ResponseDTO/Exception/Constants]
    end
    
    subgraph "ç¬¬2å±‚: åŠŸèƒ½æ¨¡å—"
        Security[common-security<br/>JWT/RBAC]
        Data[common-data<br/>MyBatis/EntityåŸºç±»]
        Cache[common-cache<br/>Redis/Caffeine]
        Monitor[common-monitor<br/>Metrics]
    end
    
    subgraph "ç¬¬3å±‚: ä¸šåŠ¡å…¬å…±"
        Business[common-business<br/>ä»…é€šç”¨ä¸šåŠ¡å·¥å…·]
    end
    
    subgraph "ç¬¬4å±‚: ä¸šåŠ¡æœåŠ¡"
        Common[ioedream-common-service<br/>ç”¨æˆ·/æƒé™/ç»„ç»‡]
        Access[ioedream-access-service]
        OA[ioedream-oa-service]
    end
    
    Security --> Core
    Data --> Core
    Cache --> Core
    Monitor --> Core
    
    Business --> Security
    Business --> Data
    
    Common --> Security
    Common --> Data
    Common --> Cache
    
    Access --> Security
    Access --> Data
    OA --> Business
    
    style Core fill:#51cf66
    style Security fill:#4dabf7
    style Data fill:#4dabf7
    style Business fill:#ffd43b
    style Common fill:#ff8787
```

**ä¾èµ–ç®¡ç†è§„èŒƒ**:

**æ–‡ä»¶**: `d:\IOE-DREAM\microservices\pom.xml` (çˆ¶POM)

```xml
<dependencyManagement>
    <dependencies>
        <!-- å†…éƒ¨æ¨¡å—ç‰ˆæœ¬ç»Ÿä¸€ç®¡ç† -->
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-core</artifactId>
            <version>${project.version}</version>
        </dependency>
        
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-security</artifactId>
            <version>${project.version}</version>
        </dependency>
        
        <!-- ... å…¶ä»–æ¨¡å— ... -->
    </dependencies>
</dependencyManagement>

<!-- âœ… æ­£ç¡®çš„æ¨¡å—æ„å»ºé¡ºåº -->
<modules>
    <!-- ç¬¬1å±‚: æ ¸å¿ƒ -->
    <module>microservices-common-core</module>
    
    <!-- ç¬¬2å±‚: åŠŸèƒ½æ¨¡å— -->
    <module>microservices-common-security</module>
    <module>microservices-common-data</module>
    <module>microservices-common-cache</module>
    <module>microservices-common-monitor</module>
    <module>microservices-common-permission</module>
    
    <!-- ç¬¬3å±‚: ä¸šåŠ¡å…¬å…± -->
    <module>microservices-common-business</module>
    <module>microservices-common-export</module>
    <module>microservices-common-workflow</module>
    
    <!-- ç¬¬4å±‚: èšåˆæ¨¡å— (å¯é€‰) -->
    <!-- <module>microservices-common</module> å»ºè®®ç§»é™¤æˆ–ä»…ä½œèšåˆ -->
    
    <!-- ç¬¬5å±‚: ä¸šåŠ¡æœåŠ¡ -->
    <module>ioedream-db-init</module>
    <module>ioedream-gateway-service</module>
    <module>ioedream-common-service</module>
    <module>ioedream-device-comm-service</module>
    <module>ioedream-oa-service</module>
    <module>ioedream-access-service</module>
    <module>ioedream-attendance-service</module>
    <module>ioedream-video-service</module>
    <module>ioedream-consume-service</module>
    <module>ioedream-visitor-service</module>
</modules>
```

**ä¾èµ–å†²çªæ£€æµ‹è„šæœ¬**:

**æ–‡ä»¶**: `d:\IOE-DREAM\scripts\check-dependency-cycles.ps1`

```powershell
# ä¾èµ–å¾ªç¯æ£€æµ‹è„šæœ¬
Write-Host "æ£€æŸ¥Mavenä¾èµ–å¾ªç¯..." -ForegroundColor Cyan

cd d:\IOE-DREAM\microservices

# ä½¿ç”¨ Maven ä¾èµ–æ’ä»¶æ£€æŸ¥
mvn dependency:tree -Dverbose 2>&1 | Tee-Object -Variable output

# æ£€æŸ¥å¾ªç¯ä¾èµ–
if ($output -match "cycle") {
    Write-Host "âŒ å‘ç°å¾ªç¯ä¾èµ–!" -ForegroundColor Red
    $output | Select-String "cycle"
    exit 1
} else {
    Write-Host "âœ… æ— å¾ªç¯ä¾èµ–" -ForegroundColor Green
}
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… ä¾èµ–æ–¹å‘å¿…é¡»ä»ä¸Šå±‚åˆ°ä¸‹å±‚,**ç¦æ­¢**åå‘ä¾èµ–
2. âœ… å…¬å…±æ¨¡å—**ç¦æ­¢**ä¾èµ–ä¸šåŠ¡æ¨¡å—
3. âœ… ä¸šåŠ¡æ¨¡å—ä¹‹é—´**ç¦æ­¢**ç›¸äº’ä¾èµ–,å¿…é¡»é€šè¿‡APIé€šä¿¡
4. âœ… æ¯æ¬¡ä¿®æ”¹ä¾èµ–åå¿…é¡»è¿è¡Œå¾ªç¯ä¾èµ–æ£€æµ‹

#### 3.3.3 ä»»åŠ¡2.3: æ¸…ç† microservices-common

**ç›®æ ‡**: å°† microservices-common è½¬æ¢ä¸ºè½»é‡çº§èšåˆæ¨¡å—æˆ–å®Œå…¨ç§»é™¤

**æ–¹æ¡ˆA: è½¬æ¢ä¸ºèšåˆæ¨¡å— (æ¨è)**

**æ–‡ä»¶**: `d:\IOE-DREAM\microservices\microservices-common\pom.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project>
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>net.lab1024.sa</groupId>
        <artifactId>ioedream-microservices-parent</artifactId>
        <version>1.0.0</version>
    </parent>
    
    <artifactId>microservices-common</artifactId>
    <packaging>pom</packaging>
    <name>IOE-DREAM :: Common Libraries Aggregator</name>
    <description>å…¬å…±åº“èšåˆæ¨¡å— - ä»…ç”¨äºç®€åŒ–ä¾èµ–ç®¡ç†</description>
    
    <!-- âœ… ä»…èšåˆä¾èµ–,ä¸åŒ…å«ä»»ä½•ä»£ç  -->
    <dependencies>
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-core</artifactId>
        </dependency>
        
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-security</artifactId>
        </dependency>
        
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-data</artifactId>
        </dependency>
        
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-cache</artifactId>
        </dependency>
        
        <dependency>
            <groupId>net.lab1024.sa</groupId>
            <artifactId>microservices-common-monitor</artifactId>
        </dependency>
    </dependencies>
    
    <build>
        <plugins>
            <!-- è·³è¿‡ repackage,å› ä¸ºè¿™æ˜¯èšåˆæ¨¡å— -->
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <skip>true</skip>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

**æ¸…ç†æ­¥éª¤**:

```powershell
# 1. å¤‡ä»½ç°æœ‰ä»£ç 
cd d:\IOE-DREAM\microservices\microservices-common
$backupDir = "d:\IOE-DREAM\backup-microservices-common-$(Get-Date -Format 'yyyyMMdd-HHmmss')"
Copy-Item -Path . -Destination $backupDir -Recurse

# 2. åˆ é™¤ src ç›®å½• (æ‰€æœ‰ä»£ç å·²è¿ç§»)
Remove-Item -Path src -Recurse -Force

# 3. æ›´æ–° pom.xml ä¸ºèšåˆæ¨¡å¼ (å¦‚ä¸Šæ‰€ç¤º)

# 4. éªŒè¯ç¼–è¯‘
cd ..
mvn clean install -DskipTests -pl microservices-common
```

**æ–¹æ¡ˆB: å®Œå…¨ç§»é™¤ (æ¿€è¿›æ–¹æ¡ˆ)**

```powershell
# 1. ä»çˆ¶POMç§»é™¤æ¨¡å—å¼•ç”¨
# ç¼–è¾‘ d:\IOE-DREAM\microservices\pom.xml
# åˆ é™¤ <module>microservices-common</module>

# 2. æ›´æ–°æ‰€æœ‰æœåŠ¡çš„POM,ç§»é™¤å¯¹ microservices-common çš„ä¾èµ–
# æ›¿æ¢ä¸ºå…·ä½“çš„å­æ¨¡å—ä¾èµ–

# 3. åˆ é™¤ç›®å½•
Remove-Item -Path d:\IOE-DREAM\microservices\microservices-common -Recurse -Force
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… å¦‚æœä¿ç•™èšåˆæ¨¡å—,å¿…é¡»è®¾ç½® `<packaging>pom</packaging>`
2. âœ… èšåˆæ¨¡å—**ç¦æ­¢**åŒ…å«ä»»ä½• Java ä»£ç 
3. âœ… æ‰€æœ‰æœåŠ¡ä¾èµ–å¿…é¡»æ˜ç¡®åˆ—å‡ºå…·ä½“çš„å­æ¨¡å—
4. âœ… æ¸…ç†åå¿…é¡»æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£

#### 3.3.4 é˜¶æ®µ2 éªŒæ”¶æ ‡å‡†

**éªŒæ”¶æ¸…å•**:

| æ£€æŸ¥é¡¹ | éªŒæ”¶æ ‡å‡† | éªŒè¯æ–¹æ³• |
|-------|---------|---------|
| **æ¨¡å—åŒ–æ‹†åˆ†** | 6ä¸ªä¸šåŠ¡ç›®å½•å…¨éƒ¨è¿ç§» | æ£€æŸ¥ microservices-common/src |
| **ä¾èµ–å…³ç³»** | æ— å¾ªç¯ä¾èµ– | `.\scripts\check-dependency-cycles.ps1` |
| **ç¼–è¯‘æˆåŠŸ** | æ‰€æœ‰æ¨¡å—ç¼–è¯‘é€šè¿‡ | `mvn clean install -DskipTests` |
| **æ¶æ„åˆè§„** | é€šè¿‡æ¶æ„æ£€æŸ¥ | ä»£ç å®¡æŸ¥ + è‡ªåŠ¨åŒ–å·¥å…· |
| **æ–‡æ¡£æ›´æ–°** | æ¶æ„æ–‡æ¡£åŒæ­¥æ›´æ–° | æ–‡æ¡£å®¡æŸ¥ |

---

### 3.4 é˜¶æ®µ3: è´¨é‡æå‡æ–¹æ¡ˆ (1å‘¨)

#### 3.4.1 ä»»åŠ¡3.1: å»ºç«‹ CI/CD è´¨é‡é—¨ç¦

**ç›®æ ‡**: å»ºç«‹å¼ºåˆ¶æ€§çš„è´¨é‡æ£€æŸ¥,é˜²æ­¢ä¸è§„èŒƒä»£ç åˆå¹¶

**CI/CD æµæ°´çº¿æ¶æ„å›¾**:

```mermaid
graph LR
    A[ä»£ç æäº¤] --> B[ç¼–è¯‘æ£€æŸ¥]
    B --> C[å•å…ƒæµ‹è¯•]
    C --> D[ä»£ç è´¨é‡æ‰«æ]
    D --> E[æ¶æ„åˆè§„æ£€æŸ¥]
    E --> F[JakartaåŒ…åæ£€æŸ¥]
    F --> G[ä¾èµ–å†²çªæ£€æµ‹]
    G --> H{å…¨éƒ¨é€šè¿‡?}
    H -->|æ˜¯| I[å…è®¸åˆå¹¶]
    H -->|å¦| J[é˜»æ­¢åˆå¹¶<br/>é€šçŸ¥å¼€å‘è€…]
    
    style H fill:#ffd43b
    style I fill:#51cf66
    style J fill:#ff6b6b
```

**GitLab CI é…ç½®æ–‡ä»¶**:

**æ–‡ä»¶**: `d:\IOE-DREAM\.gitlab-ci.yml`

```yaml
# IOE-DREAM CI/CD æµæ°´çº¿é…ç½®
# ç‰ˆæœ¬: 2.0 - ä¼ä¸šçº§è´¨é‡é—¨ç¦

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"
  MAVEN_CLI_OPTS: "--batch-mode --errors --fail-at-end --show-version"

cache:
  paths:
    - .m2/repository/

stages:
  - validate
  - build
  - test
  - quality
  - deploy

# ========================================
# é˜¶æ®µ1: éªŒè¯é˜¶æ®µ
# ========================================

validate:jakarta-migration:
  stage: validate
  script:
    - echo "æ£€æŸ¥ Jakarta è¿ç§»çŠ¶æ€..."
    - |
      if grep -r "import javax\." microservices/*/src --include="*.java"; then
        echo "âŒ å‘ç° javax.* åŒ…å¯¼å…¥,å¿…é¡»è¿ç§»åˆ° jakarta.*"
        exit 1
      fi
    - echo "âœ… Jakarta è¿ç§»æ£€æŸ¥é€šè¿‡"
  only:
    - merge_requests
    - main
    - develop

validate:architecture-compliance:
  stage: validate
  script:
    - echo "æ£€æŸ¥æ¶æ„åˆè§„æ€§..."
    - chmod +x scripts/check-architecture-compliance.ps1
    - pwsh scripts/check-architecture-compliance.ps1
  only:
    - merge_requests
    - main

# ========================================
# é˜¶æ®µ2: æ„å»ºé˜¶æ®µ
# ========================================

build:compile:
  stage: build
  script:
    - echo "ç¼–è¯‘é¡¹ç›®..."
    - cd microservices
    - mvn $MAVEN_CLI_OPTS clean compile -DskipTests
  artifacts:
    paths:
      - microservices/*/target/
    expire_in: 1 hour
  only:
    - merge_requests
    - main
    - develop

# ========================================
# é˜¶æ®µ3: æµ‹è¯•é˜¶æ®µ
# ========================================

test:unit-tests:
  stage: test
  script:
    - echo "è¿è¡Œå•å…ƒæµ‹è¯•..."
    - cd microservices
    - mvn $MAVEN_CLI_OPTS test
  coverage: '/Total.*?([0-9]{1,3})%/'
  artifacts:
    reports:
      junit:
        - microservices/*/target/surefire-reports/TEST-*.xml
    paths:
      - microservices/*/target/site/jacoco/
    expire_in: 1 week
  only:
    - merge_requests
    - main
    - develop

# ========================================
# é˜¶æ®µ4: è´¨é‡æ£€æŸ¥é˜¶æ®µ
# ========================================

quality:pmd-check:
  stage: quality
  script:
    - echo "è¿è¡Œ PMD ä»£ç è´¨é‡æ£€æŸ¥..."
    - cd microservices
    - mvn $MAVEN_CLI_OPTS pmd:check
  allow_failure: false  # âŒ ä¸å…è®¸å¤±è´¥
  only:
    - merge_requests
    - main

quality:dependency-check:
  stage: quality
  script:
    - echo "æ£€æŸ¥ä¾èµ–å†²çª..."
    - cd microservices
    - mvn $MAVEN_CLI_OPTS dependency:analyze
    - |
      if mvn dependency:tree | grep -i "cycle"; then
        echo "âŒ å‘ç°å¾ªç¯ä¾èµ–"
        exit 1
      fi
  only:
    - merge_requests
    - main

quality:code-coverage:
  stage: quality
  script:
    - echo "æ£€æŸ¥ä»£ç è¦†ç›–ç‡..."
    - cd microservices
    - mvn $MAVEN_CLI_OPTS jacoco:check
  coverage: '/Total.*?([0-9]{1,3})%/'
  only:
    - merge_requests
    - main
  allow_failure: true  # âš ï¸ åˆæœŸå…è®¸å¤±è´¥,åæœŸæ”¹ä¸º false

# ========================================
# é˜¶æ®µ5: éƒ¨ç½²é˜¶æ®µ
# ========================================

deploy:staging:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ..."
    - # éƒ¨ç½²è„šæœ¬
  environment:
    name: staging
  only:
    - develop

deploy:production:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ..."
    - # éƒ¨ç½²è„šæœ¬
  environment:
    name: production
  only:
    - main
  when: manual  # ç”Ÿäº§éƒ¨ç½²éœ€è¦æ‰‹åŠ¨è§¦å‘
```

**æ¶æ„åˆè§„æ£€æŸ¥è„šæœ¬**:

**æ–‡ä»¶**: `d:\IOE-DREAM\scripts\check-architecture-compliance.ps1`

```powershell
# IOE-DREAM æ¶æ„åˆè§„æ€§æ£€æŸ¥è„šæœ¬
# ç‰ˆæœ¬: 1.0

param(
    [string]$ProjectRoot = "d:\IOE-DREAM\microservices"
)

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "æ¶æ„åˆè§„æ€§æ£€æŸ¥" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""

$violations = @()
$errorCount = 0

# ========================================
# æ£€æŸ¥1: ä¸šåŠ¡ä»£ç ä¸åº”åœ¨ microservices-common
# ========================================
Write-Host "[æ£€æŸ¥1] ä¸šåŠ¡ä»£ç ä½ç½®æ£€æŸ¥..." -ForegroundColor Yellow

$commonPath = Join-Path $ProjectRoot "microservices-common\src"
if (Test-Path $commonPath) {
    $businessDirs = @("access", "consume", "oa", "visitor", "attendance", "video")
    
    foreach ($dir in $businessDirs) {
        $dirPath = Join-Path $commonPath "main\java\net\lab1024\sa\common\$dir"
        if (Test-Path $dirPath) {
            $violations += "âŒ å‘ç°ä¸šåŠ¡ä»£ç åœ¨å…¬å…±æ¨¡å—: $dir/"
            $errorCount++
        }
    }
}

if ($errorCount -eq 0) {
    Write-Host "  âœ… é€šè¿‡" -ForegroundColor Green
}

# ========================================
# æ£€æŸ¥2: @Repository æ³¨è§£ä½¿ç”¨æ£€æŸ¥
# ========================================
Write-Host "[æ£€æŸ¥2] DAOå±‚æ³¨è§£æ£€æŸ¥..." -ForegroundColor Yellow

$repositoryUsage = Select-String -Path "$ProjectRoot\*\src" -Pattern "@Repository" -Recurse -Include "*.java"
if ($repositoryUsage) {
    $violations += "âŒ å‘ç° @Repository æ³¨è§£ä½¿ç”¨,åº”ä½¿ç”¨ @Mapper"
    $errorCount++
    $repositoryUsage | ForEach-Object {
        Write-Host "  $($_.Path):$($_.LineNumber)" -ForegroundColor Red
    }
} else {
    Write-Host "  âœ… é€šè¿‡" -ForegroundColor Green
}

# ========================================
# æ£€æŸ¥3: æ—¥å¿—æ³¨è§£ç¼ºå¤±æ£€æŸ¥
# ========================================
Write-Host "[æ£€æŸ¥3] Serviceç±»æ—¥å¿—æ³¨è§£æ£€æŸ¥..." -ForegroundColor Yellow

$serviceFiles = Get-ChildItem -Path "$ProjectRoot\*\src" -Filter "*Service.java" -Recurse
$missingSlf4j = 0

foreach ($file in $serviceFiles) {
    $content = Get-Content $file.FullName -Raw
    if ($content -match "@Service" -and $content -notmatch "@Slf4j") {
        $violations += "âš ï¸ Serviceç±»ç¼ºå°‘ @Slf4j: $($file.Name)"
        $missingSlf4j++
    }
}

if ($missingSlf4j -eq 0) {
    Write-Host "  âœ… é€šè¿‡" -ForegroundColor Green
} else {
    Write-Host "  âš ï¸ å‘ç° $missingSlf4j ä¸ªServiceç±»ç¼ºå°‘ @Slf4j" -ForegroundColor Yellow
}

# ========================================
# è¾“å‡ºç»“æœ
# ========================================
Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "æ£€æŸ¥ç»“æœ" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan

if ($errorCount -gt 0) {
    Write-Host "âŒ æ¶æ„åˆè§„æ€§æ£€æŸ¥å¤±è´¥!" -ForegroundColor Red
    Write-Host "å‘ç° $errorCount ä¸ªä¸¥é‡è¿è§„é¡¹:" -ForegroundColor Red
    $violations | ForEach-Object { Write-Host "  $_" -ForegroundColor Red }
    exit 1
} else {
    Write-Host "âœ… æ¶æ„åˆè§„æ€§æ£€æŸ¥é€šè¿‡!" -ForegroundColor Green
    if ($missingSlf4j -gt 0) {
        Write-Host "âš ï¸ æœ‰ $missingSlf4j ä¸ªè­¦å‘Šé¡¹,å»ºè®®ä¿®å¤" -ForegroundColor Yellow
    }
    exit 0
}
```

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… æ‰€æœ‰ä»£ç åˆå¹¶å‰**å¿…é¡»**é€šè¿‡ CI/CD æ£€æŸ¥
2. âœ… è´¨é‡é—¨ç¦**ä¸å…è®¸**è¢«è·³è¿‡æˆ–ç¦ç”¨
3. âœ… ä»£ç è¦†ç›–ç‡ç›®æ ‡: 80% (line), 75% (branch)
4. âœ… PMD æ£€æŸ¥é›¶è¿è§„ (maxAllowedViolations=0)

#### 3.4.2 ä»»åŠ¡3.2: å®Œå–„è‡ªåŠ¨åŒ–æµ‹è¯•

**ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»,ç¡®ä¿ä»£ç è´¨é‡

**æµ‹è¯•é‡‘å­—å¡”æ¶æ„**:

```mermaid
graph TD
    subgraph "æµ‹è¯•é‡‘å­—å¡”"
        E2E[ç«¯åˆ°ç«¯æµ‹è¯•<br/>5% - å…³é”®ä¸šåŠ¡æµç¨‹]
        Integration[é›†æˆæµ‹è¯•<br/>20% - æ¨¡å—é—´åä½œ]
        Unit[å•å…ƒæµ‹è¯•<br/>75% - ä¸šåŠ¡é€»è¾‘]
    end
    
    E2E --> Integration
    Integration --> Unit
    
    style E2E fill:#ff8787
    style Integration fill:#ffd43b
    style Unit fill:#51cf66
```

**å•å…ƒæµ‹è¯•è§„èŒƒ**:

**ç¤ºä¾‹**: Manager å±‚æµ‹è¯•æ¨¡æ¿

**æ–‡ä»¶**: `d:\IOE-DREAM\microservices\ioedream-access-service\src\test\java\net\lab1024\sa\access\manager\AccessManagerTest.java`

```java
package net.lab1024.sa.access.manager;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.*;
import static org.mockito.Mockito.*;

/**
 * AccessManager å•å…ƒæµ‹è¯•
 * 
 * @author IOE-DREAM Team
 * @date 2025-12-17
 */
@ExtendWith(MockitoExtension.class)
class AccessManagerTest {
    
    @Mock
    private AccessDao accessDao;
    
    @InjectMocks
    private AccessManager accessManager;
    
    @BeforeEach
    void setUp() {
        // æµ‹è¯•å‰ç½®å‡†å¤‡
    }
    
    @Test
    void testCheckAccessPermission_Success() {
        // Given: å‡†å¤‡æµ‹è¯•æ•°æ®
        Long userId = 1L;
        String deviceCode = "DEVICE001";
        
        AccessEntity mockEntity = new AccessEntity();
        mockEntity.setUserId(userId);
        mockEntity.setStatus(1);
        
        when(accessDao.selectByUserIdAndDevice(userId, deviceCode))
            .thenReturn(mockEntity);
        
        // When: æ‰§è¡Œæµ‹è¯•æ–¹æ³•
        boolean result = accessManager.checkAccessPermission(userId, deviceCode);
        
        // Then: éªŒè¯ç»“æœ
        assertTrue(result, "åº”è¯¥è¿”å›true");
        verify(accessDao, times(1)).selectByUserIdAndDevice(userId, deviceCode);
    }
    
    @Test
    void testCheckAccessPermission_UserNotFound() {
        // Given
        Long userId = 999L;
        String deviceCode = "DEVICE001";
        when(accessDao.selectByUserIdAndDevice(userId, deviceCode))
            .thenReturn(null);
        
        // When
        boolean result = accessManager.checkAccessPermission(userId, deviceCode);
        
        // Then
        assertFalse(result, "ç”¨æˆ·ä¸å­˜åœ¨åº”è¿”å›false");
    }
    
    @Test
    void testCheckAccessPermission_NullUserId() {
        // When & Then
        assertThrows(IllegalArgumentException.class, () -> {
            accessManager.checkAccessPermission(null, "DEVICE001");
        }, "userIdä¸ºnullåº”æŠ›å‡ºå¼‚å¸¸");
    }
}
```

**æµ‹è¯•è¦†ç›–ç‡è¦æ±‚**:

| ä»£ç å±‚çº§ | è¦†ç›–ç‡ç›®æ ‡ | é‡ç‚¹æµ‹è¯•å†…å®¹ |
|---------|-----------|------------|
| **Controller** | 60%+ | å‚æ•°éªŒè¯ã€æƒé™æ£€æŸ¥ã€å¼‚å¸¸å¤„ç† |
| **Service** | 80%+ | ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡å¤„ç†ã€å¼‚å¸¸åœºæ™¯ |
| **Manager** | 75%+ | å¤æ‚ä¸šåŠ¡é€»è¾‘ã€è¾¹ç•Œæ¡ä»¶ |
| **DAO** | 70%+ | SQLæ­£ç¡®æ€§ã€æ•°æ®æ˜ å°„ |
| **Util** | 90%+ | å·¥å…·æ–¹æ³•ã€è¾¹ç•Œå€¼ã€å¼‚å¸¸è¾“å…¥ |

**å…¨å±€ä¸€è‡´æ€§è§„èŒƒ**:
1. âœ… æ‰€æœ‰ Manager/Service æ–¹æ³•å¿…é¡»æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•
2. âœ… æµ‹è¯•æ–¹æ³•å‘½å: `test{æ–¹æ³•å}_{åœºæ™¯}` (å¦‚ `testCheckAccess_Success`)
3. âœ… æµ‹è¯•ç»“æ„å¿…é¡»éµå¾ª Given-When-Then æ¨¡å¼
4. âœ… ä½¿ç”¨ Mockito è¿›è¡Œä¾èµ– Mock,é¿å…çœŸå®æ•°æ®åº“æ“ä½œ

#### 3.4.3 ä»»åŠ¡3.3: åˆ¶å®šå¼€å‘è§„èŒƒ

**ç›®æ ‡**: å»ºç«‹ç»Ÿä¸€çš„å¼€å‘è§„èŒƒ,ç¡®ä¿ä»£ç ä¸€è‡´æ€§

**å¼€å‘è§„èŒƒæ–‡æ¡£**:

**æ–‡ä»¶**: `d:\IOE-DREAM\documentation\development\IOE-DREAM-CODING-STANDARDS.md`

```markdown
# IOE-DREAM ç¼–ç è§„èŒƒ

## 1. å‘½åè§„èŒƒ

### 1.1 åŒ…å
- âœ… å…¨å°å†™,å•è¯é—´ç”¨ç‚¹åˆ†éš”
- âœ… æ ¼å¼: `net.lab1024.sa.{æœåŠ¡å}.{æ¨¡å—}.{å­æ¨¡å—}`
- âŒ ç¦æ­¢ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–é©¼å³°

**ç¤ºä¾‹**:
```java
âœ… package net.lab1024.sa.access.manager;
âŒ package net.lab1024.sa.access_manager;
âŒ package net.lab1024.sa.accessManager;
```

### 1.2 ç±»å
- âœ… å¤§é©¼å³° (PascalCase)
- âœ… åè¯æˆ–åè¯çŸ­è¯­
- âœ… éµå¾ªåç¼€çº¦å®š

**åç¼€çº¦å®š**:
| ç±»å‹ | åç¼€ | ç¤ºä¾‹ |
|------|------|------|
| æ§åˆ¶å™¨ | Controller | `UserController` |
| æœåŠ¡æ¥å£ | Service | `UserService` |
| æœåŠ¡å®ç° | ServiceImpl | `UserServiceImpl` |
| ä¸šåŠ¡é€»è¾‘ | Manager | `UserManager` |
| æ•°æ®è®¿é—® | Dao/Mapper | `UserDao` |
| å®ä½“ç±» | Entity | `UserEntity` |
| DTO | DTO/Form/VO | `UserDTO`, `LoginForm`, `UserVO` |

### 1.3 æ–¹æ³•å
- âœ… å°é©¼å³° (camelCase)
- âœ… åŠ¨è¯æˆ–åŠ¨è¯çŸ­è¯­
- âœ… éµå¾ªå‘½åçº¦å®š

**å‘½åçº¦å®š**:
| æ“ä½œç±»å‹ | å‰ç¼€ | ç¤ºä¾‹ |
|---------|------|------|
| æŸ¥è¯¢å•ä¸ª | get/find | `getUserById` |
| æŸ¥è¯¢åˆ—è¡¨ | list/query | `listUsers` |
| ä¿å­˜ | save/add/create | `saveUser` |
| æ›´æ–° | update/modify | `updateUser` |
| åˆ é™¤ | delete/remove | `deleteUser` |
| æ£€æŸ¥ | check/validate/verify | `checkPermission` |
| è½¬æ¢ | to/convert | `toDTO` |

### 1.4 å˜é‡å
- âœ… å°é©¼å³° (camelCase)
- âœ… æœ‰æ„ä¹‰çš„åç§°,é¿å…ç¼©å†™
- âœ… å¸ƒå°”å˜é‡ä½¿ç”¨ is/has/can å‰ç¼€

**ç¤ºä¾‹**:
```java
âœ… private String userName;
âœ… private boolean isActive;
âœ… private boolean hasPermission;

âŒ private String un;
âŒ private boolean active; // åº”è¯¥ç”¨ isActive
```

## 2. ä»£ç ç»“æ„è§„èŒƒ

### 2.1 Controller å±‚

**èŒè´£**: æ¥æ”¶è¯·æ±‚ã€å‚æ•°éªŒè¯ã€è°ƒç”¨Serviceã€è¿”å›å“åº”

**è§„èŒƒæ¨¡æ¿**:
```java
@RestController
@RequestMapping("/api/v1/users")
@Tag(name = "ç”¨æˆ·ç®¡ç†")
@Slf4j
public class UserController {
    
    @Resource
    private UserService userService;
    
    @PostMapping
    @Operation(summary = "åˆ›å»ºç”¨æˆ·")
    public ResponseDTO<Long> createUser(@Valid @RequestBody UserCreateForm form) {
        log.info("[åˆ›å»ºç”¨æˆ·] è¯·æ±‚å‚æ•°: {}", form);
        
        try {
            Long userId = userService.createUser(form);
            log.info("[åˆ›å»ºç”¨æˆ·] æˆåŠŸ, userId: {}", userId);
            return ResponseDTO.ok(userId);
        } catch (BusinessException e) {
            log.warn("[åˆ›å»ºç”¨æˆ·] ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
            return ResponseDTO.error(e.getCode(), e.getMessage());
        } catch (Exception e) {
            log.error("[åˆ›å»ºç”¨æˆ·] ç³»ç»Ÿå¼‚å¸¸", e);
            return ResponseDTO.error(SystemErrorCode.SYSTEM_ERROR);
        }
    }
}
```

**è§„èŒƒè¦ç‚¹**:
1. âœ… å¿…é¡»æ·»åŠ  `@Slf4j` æ³¨è§£
2. âœ… å¿…é¡»ä½¿ç”¨ `@Valid` éªŒè¯è¯·æ±‚å‚æ•°
3. âœ… å¿…é¡»è®°å½•å…³é”®æ“ä½œæ—¥å¿—
4. âœ… å¿…é¡»ç»Ÿä¸€è¿”å› `ResponseDTO`
5. âœ… ç¦æ­¢åœ¨Controllerä¸­å†™ä¸šåŠ¡é€»è¾‘

### 2.2 Service å±‚

**èŒè´£**: ä¸šåŠ¡æµç¨‹ç¼–æ’ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ£€æŸ¥

**è§„èŒƒæ¨¡æ¿**:
```java
@Service
@Slf4j
public class UserServiceImpl implements UserService {
    
    @Resource
    private UserManager userManager;
    
    @Resource
    private RoleManager roleManager;
    
    @Override
    @Transactional(rollbackFor = Exception.class)
    public Long createUser(UserCreateForm form) {
        // 1. å‚æ•°æ ¡éªŒ
        this.validateUserForm(form);
        
        // 2. ä¸šåŠ¡æ£€æŸ¥
        if (userManager.existsByUsername(form.getUsername())) {
            throw new BusinessException(UserErrorCode.USERNAME_ALREADY_EXISTS);
        }
        
        // 3. è°ƒç”¨Manageræ‰§è¡Œä¸šåŠ¡
        Long userId = userManager.createUser(form);
        
        // 4. å…³è”è§’è‰²
        if (CollectionUtils.isNotEmpty(form.getRoleIds())) {
            roleManager.assignUserRoles(userId, form.getRoleIds());
        }
        
        // 5. å‘é€äº‹ä»¶/æ¶ˆæ¯
        // eventPublisher.publishUserCreatedEvent(userId);
        
        return userId;
    }
    
    private void validateUserForm(UserCreateForm form) {
        // è‡ªå®šä¹‰ä¸šåŠ¡éªŒè¯
    }
}
```

**è§„èŒƒè¦ç‚¹**:
1. âœ… å¿…é¡»ä½¿ç”¨æ¥å£ + å®ç°ç±»æ¨¡å¼
2. âœ… å®ç°ç±»å¿…é¡»æ·»åŠ  `@Service` å’Œ `@Slf4j`
3. âœ… æ¶‰åŠæ•°æ®ä¿®æ”¹å¿…é¡»æ·»åŠ  `@Transactional`
4. âœ… ç¦æ­¢ç›´æ¥æ“ä½œDAO,å¿…é¡»é€šè¿‡Manager
5. âœ… å¼‚å¸¸å¿…é¡»æŠ›å‡º `BusinessException`,ç”±å…¨å±€å¤„ç†å™¨ç»Ÿä¸€å¤„ç†

### 2.3 Manager å±‚

**èŒè´£**: å•ä¸€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ç»„è£…ã€è°ƒç”¨DAO

**è§„èŒƒæ¨¡æ¿**:
```java
@Slf4j
@Component
public class UserManager {
    
    @Resource
    private UserDao userDao;
    
    /**
     * åˆ›å»ºç”¨æˆ·
     */
    public Long createUser(UserCreateForm form) {
        // 1. DTO â†’ Entity è½¬æ¢
        UserEntity entity = this.toEntity(form);
        
        // 2. è®¾ç½®é»˜è®¤å€¼
        entity.setStatus(UserStatusEnum.ACTIVE.getValue());
        entity.setCreateTime(LocalDateTime.now());
        
        // 3. ä¿å­˜åˆ°æ•°æ®åº“
        userDao.insert(entity);
        
        return entity.getUserId();
    }
    
    /**
     * æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
     */
    public boolean existsByUsername(String username) {
        return userDao.selectCountByUsername(username) > 0;
    }
    
    private UserEntity toEntity(UserCreateForm form) {
        UserEntity entity = new UserEntity();
        BeanUtils.copyProperties(form, entity);
        return entity;
    }
}
```

**è§„èŒƒè¦ç‚¹**:
1. âœ… å¿…é¡»ä½¿ç”¨ `@Component` æ³¨è§£
2. âœ… ä¸€ä¸ªManagerä¸“æ³¨ä¸€ä¸ªå®ä½“çš„ä¸šåŠ¡é€»è¾‘
3. âœ… æ–¹æ³•ç²’åº¦è¦ç»†,å•ä¸€èŒè´£
4. âœ… ç¦æ­¢è·¨Managerè°ƒç”¨,åº”åœ¨Serviceå±‚ç¼–æ’

### 2.4 DAO å±‚

**èŒè´£**: æ•°æ®åº“CRUDæ“ä½œ

**è§„èŒƒæ¨¡æ¿**:
```java
@Mapper
public interface UserDao extends BaseMapper<UserEntity> {
    
    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
     */
    UserEntity selectByUsername(@Param("username") String username);
    
    /**
     * ç»Ÿè®¡ç”¨æˆ·åæ•°é‡
     */
    int selectCountByUsername(@Param("username") String username);
    
    /**
     * æ‰¹é‡æ’å…¥
     */
    int batchInsert(@Param("list") List<UserEntity> list);
}
```

**è§„èŒƒè¦ç‚¹**:
1. âœ… å¿…é¡»ä½¿ç”¨ `@Mapper` æ³¨è§£ (**ç¦æ­¢ä½¿ç”¨** `@Repository`)
2. âœ… å¿…é¡»ç»§æ‰¿ `BaseMapper<T>`
3. âœ… æ–¹æ³•åå¿…é¡»ä»¥ `select/insert/update/delete` å¼€å¤´
4. âœ… å¤šå‚æ•°æ–¹æ³•å¿…é¡»ä½¿ç”¨ `@Param` æ³¨è§£

## 3. å¼‚å¸¸å¤„ç†è§„èŒƒ

### 3.1 å¼‚å¸¸åˆ†ç±»

```mermaid
graph TD
    A[Exception] --> B[BusinessException<br/>ä¸šåŠ¡å¼‚å¸¸]
    A --> C[SystemException<br/>ç³»ç»Ÿå¼‚å¸¸]
    
    B --> B1[ValidationException<br/>å‚æ•°éªŒè¯å¼‚å¸¸]
    B --> B2[PermissionException<br/>æƒé™å¼‚å¸¸]
    B --> B3[DataNotFoundException<br/>æ•°æ®ä¸å­˜åœ¨å¼‚å¸¸]
    
    C --> C1[DatabaseException<br/>æ•°æ®åº“å¼‚å¸¸]
    C --> C2[NetworkException<br/>ç½‘ç»œå¼‚å¸¸]
    C --> C3[ThirdPartyException<br/>ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸]
```

### 3.2 å¼‚å¸¸ä½¿ç”¨è§„èŒƒ

**ä¸šåŠ¡å¼‚å¸¸ç¤ºä¾‹**:
```java
// âœ… æ­£ç¡®: ä½¿ç”¨æšä¸¾å®šä¹‰é”™è¯¯ç 
public enum UserErrorCode implements ErrorCode {
    USERNAME_ALREADY_EXISTS(1001, "ç”¨æˆ·åå·²å­˜åœ¨"),
    USER_NOT_FOUND(1002, "ç”¨æˆ·ä¸å­˜åœ¨"),
    PASSWORD_INCORRECT(1003, "å¯†ç é”™è¯¯");
    
    private final int code;
    private final String message;
    
    // ... getter/constructor ...
}

// æŠ›å‡ºå¼‚å¸¸
throw new BusinessException(UserErrorCode.USERNAME_ALREADY_EXISTS);

// âŒ é”™è¯¯: ç¡¬ç¼–ç é”™è¯¯ç å’Œæ¶ˆæ¯
throw new BusinessException(1001, "ç”¨æˆ·åå·²å­˜åœ¨");
```

**å…¨å±€å¼‚å¸¸å¤„ç†å™¨**:
```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ResponseDTO<Void> handleBusinessException(BusinessException e) {
        log.warn("[ä¸šåŠ¡å¼‚å¸¸] code: {}, message: {}", e.getCode(), e.getMessage());
        return ResponseDTO.error(e.getCode(), e.getMessage());
    }
    
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseDTO<Void> handleValidationException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult().getFieldErrors().stream()
            .map(error -> error.getField() + ": " + error.getDefaultMessage())
            .collect(Collectors.joining(", "));
        log.warn("[å‚æ•°éªŒè¯å¼‚å¸¸] {}", message);
        return ResponseDTO.error(SystemErrorCode.PARAM_ERROR.getCode(), message);
    }
    
    @ExceptionHandler(Exception.class)
    public ResponseDTO<Void> handleException(Exception e) {
        log.error("[ç³»ç»Ÿå¼‚å¸¸]", e);
        return ResponseDTO.error(SystemErrorCode.SYSTEM_ERROR);
    }
}
```

## 4. æ—¥å¿—è§„èŒƒ

### 4.1 æ—¥å¿—çº§åˆ«ä½¿ç”¨

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|---------|------|
| **ERROR** | ç³»ç»Ÿé”™è¯¯ã€ä¸¥é‡å¼‚å¸¸ | æ•°æ®åº“è¿æ¥å¤±è´¥ã€ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨å¤±è´¥ |
| **WARN** | ä¸šåŠ¡å¼‚å¸¸ã€å¯æ¢å¤é”™è¯¯ | ç”¨æˆ·åå·²å­˜åœ¨ã€æƒé™ä¸è¶³ |
| **INFO** | å…³é”®ä¸šåŠ¡æ“ä½œ | ç”¨æˆ·ç™»å½•ã€è®¢å•åˆ›å»ºã€æ”¯ä»˜æˆåŠŸ |
| **DEBUG** | å¼€å‘è°ƒè¯•ä¿¡æ¯ | æ–¹æ³•å…¥å‚ã€ä¸­é—´å˜é‡ |

### 4.2 æ—¥å¿—è§„èŒƒç¤ºä¾‹

```java
@Slf4j
@Service
public class OrderService {
    
    public Long createOrder(OrderCreateForm form) {
        // âœ… INFO: è®°å½•å…³é”®ä¸šåŠ¡æ“ä½œ
        log.info("[åˆ›å»ºè®¢å•] ç”¨æˆ·: {}, å•†å“: {}, æ•°é‡: {}", 
            form.getUserId(), form.getProductId(), form.getQuantity());
        
        try {
            // âœ… DEBUG: è®°å½•è¯¦ç»†è¿‡ç¨‹ (å¼€å‘è°ƒè¯•ç”¨)
            log.debug("[åˆ›å»ºè®¢å•] æ£€æŸ¥åº“å­˜...");
            
            Long orderId = orderManager.createOrder(form);
            
            // âœ… INFO: è®°å½•æˆåŠŸç»“æœ
            log.info("[åˆ›å»ºè®¢å•] æˆåŠŸ, orderId: {}", orderId);
            return orderId;
            
        } catch (BusinessException e) {
            // âœ… WARN: è®°å½•ä¸šåŠ¡å¼‚å¸¸
            log.warn("[åˆ›å»ºè®¢å•] ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
            throw e;
            
        } catch (Exception e) {
            // âœ… ERROR: è®°å½•ç³»ç»Ÿå¼‚å¸¸ (å¸¦å †æ ˆ)
            log.error("[åˆ›å»ºè®¢å•] ç³»ç»Ÿå¼‚å¸¸", e);
            throw new SystemException(e);
        }
    }
}
```

**è§„èŒƒè¦ç‚¹**:
1. âœ… æ—¥å¿—å¿…é¡»åŒ…å«æ“ä½œä¸»ä½“ (å¦‚ `[åˆ›å»ºè®¢å•]`)
2. âœ… å…³é”®å‚æ•°å¿…é¡»è®°å½• (ç”¨æˆ·IDã€è®¢å•IDç­‰)
3. âœ… ERRORçº§åˆ«å¿…é¡»è®°å½•å †æ ˆ (ç¬¬äºŒä¸ªå‚æ•°ä¼  `Exception`)
4. âœ… ç¦æ­¢ä½¿ç”¨ `System.out.println()`
5. âœ… ç¦æ­¢è®°å½•æ•æ„Ÿä¿¡æ¯ (å¯†ç ã€èº«ä»½è¯å·ç­‰)

## 5. æ•°æ®åº“è§„èŒƒ

### 5.1 è¡¨å‘½åè§„èŒƒ

- âœ… å…¨å°å†™,å•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”
- âœ… æ ¼å¼: `t_{ä¸šåŠ¡}_{}` æˆ– `t_{}`
- âœ… å…³è”è¡¨: `t_{}_rel_{}` æˆ– `r_{}_{}`

**ç¤ºä¾‹**:
```sql
âœ… t_user                    -- ç”¨æˆ·è¡¨
âœ… t_user_role              -- ç”¨æˆ·è§’è‰²è¡¨
âœ… r_user_role              -- ç”¨æˆ·è§’è‰²å…³è”è¡¨
âœ… t_access_device          -- é—¨ç¦è®¾å¤‡è¡¨

âŒ tUser                     -- é©¼å³°å‘½å
âŒ user                      -- ç¼ºå°‘å‰ç¼€
```

### 5.2 å­—æ®µå‘½åè§„èŒƒ

- âœ… å…¨å°å†™,å•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”
- âœ… å¸ƒå°”å­—æ®µä½¿ç”¨ `is_` å‰ç¼€
- âœ… æ—¶é—´å­—æ®µä½¿ç”¨ `_time` åç¼€
- âœ… ä¸»é”®ç»Ÿä¸€å‘½å: `{è¡¨åå•æ•°}_id`

**ç¤ºä¾‹**:
```sql
CREATE TABLE t_user (
    user_id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
    real_name VARCHAR(50) COMMENT 'çœŸå®å§“å',
    is_active TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦æ¿€æ´»',
    is_deleted TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
);
```

### 5.3 å¿…å¤‡å­—æ®µ

æ‰€æœ‰ä¸šåŠ¡è¡¨å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µ:

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `create_time` | DATETIME | åˆ›å»ºæ—¶é—´ |
| `update_time` | DATETIME | æ›´æ–°æ—¶é—´ |
| `is_deleted` | TINYINT | é€»è¾‘åˆ é™¤æ ‡è®° (0æœªåˆ é™¤, 1å·²åˆ é™¤) |

## 6. ä¾èµ–æ³¨å…¥è§„èŒƒ

### 6.1 æ³¨è§£é€‰æ‹©

| æ³¨è§£ | ä½¿ç”¨åœºæ™¯ | ä¼˜å…ˆçº§ |
|------|---------|-------|
| `@Resource` | **æ¨è** - æŒ‰åç§°æ³¨å…¥ | â­â­â­ |
| `@Autowired` | æŒ‰ç±»å‹æ³¨å…¥ | â­â­ |
| `@Inject` | ä¸æ¨è | âŒ |

**ç¤ºä¾‹**:
```java
// âœ… æ¨è: ä½¿ç”¨ @Resource
@Resource
private UserService userService;

// âš ï¸ å¯ä»¥ä½†ä¸æ¨è: ä½¿ç”¨ @Autowired
@Autowired
private UserService userService;

// âŒ ç¦æ­¢: å­—æ®µæ³¨å…¥åŒæ—¶ä½¿ç”¨æ„é€ å‡½æ•°
@Resource
private UserService userService;
public UserController(UserService userService) { // âŒ é‡å¤æ³¨å…¥
    this.userService = userService;
}
```

### 6.2 å¾ªç¯ä¾èµ–å¤„ç†

**é—®é¢˜åœºæ™¯**:
```java
// âŒ å¾ªç¯ä¾èµ–
@Service
class AService {
    @Resource
    private BService bService;
}

@Service
class BService {
    @Resource
    private AService aService; // âŒ ç›¸äº’ä¾èµ–
}
```

**è§£å†³æ–¹æ¡ˆ**:
```java
// âœ… æ–¹æ¡ˆ1: æå–å…¬å…±é€»è¾‘åˆ° Manager
@Service
class AService {
    @Resource
    private CommonManager commonManager;
}

@Service
class BService {
    @Resource
    private CommonManager commonManager;
}

// âœ… æ–¹æ¡ˆ2: ä½¿ç”¨äº‹ä»¶é©±åŠ¨
@Service
class AService {
    @Resource
    private ApplicationEventPublisher eventPublisher;
    
    public void doSomething() {
        // ...
        eventPublisher.publishEvent(new SomeEvent());
    }
}

@Service
class BService {
    @EventListener
    public void handleEvent(SomeEvent event) {
        // å¤„ç†äº‹ä»¶
    }
}
```

---

## äº”ã€å…¨å±€ä¸€è‡´æ€§è§„èŒƒ

### 5.1 æŠ€æœ¯æ ˆç‰ˆæœ¬è§„èŒƒ

**å¼ºåˆ¶è¦æ±‚**: æ‰€æœ‰æ¨¡å—å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„æŠ€æœ¯æ ˆç‰ˆæœ¬

**ç‰ˆæœ¬ç®¡ç†è¡¨**:

| æŠ€æœ¯æ ˆ | ç‰ˆæœ¬ | çº¦æŸ | é…ç½®ä½ç½® |
|-------|------|------|----------|
| **Java** | 17 | å¼ºåˆ¶ | `<java.version>17</java.version>` |
| **Spring Boot** | 3.5.8 | å¼ºåˆ¶ | `<spring-boot.version>3.5.8</spring-boot.version>` |
| **Spring Cloud** | 2025.0.0 | å¼ºåˆ¶ | `<spring-cloud.version>2025.0.0</spring-cloud.version>` |
| **MyBatis-Plus** | 3.5.15 | æ¨è | `<mybatis-plus.version>3.5.15</mybatis-plus.version>` |
| **Lombok** | 1.18.30 | æ¨è | çˆ¶POMç®¡ç† |

**ç‰ˆæœ¬æ£€æŸ¥è„šæœ¬**:

**æ–‡ä»¶**: `d:\IOE-DREAM\scripts\check-version-consistency.ps1`

```powershell
# æŠ€æœ¯æ ˆç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬

$parentPom = "d:\IOE-DREAM\microservices\pom.xml"
[xml]$parentXml = Get-Content $parentPom

# æå–çˆ¶POMç‰ˆæœ¬å®šä¹‰
$expectedVersions = @{
    "spring-boot" = $parentXml.project.properties."spring-boot.version"
    "spring-cloud" = $parentXml.project.properties."spring-cloud.version"
    "java" = $parentXml.project.properties."java.version"
}

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "æŠ€æœ¯æ ˆç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan

# æ£€æŸ¥æ‰€æœ‰å­æ¨¡å—POM
$subPoms = Get-ChildItem -Path "d:\IOE-DREAM\microservices" -Filter "pom.xml" -Recurse | 
    Where-Object { $_.FullName -ne $parentPom }

$violations = @()

foreach ($pom in $subPoms) {
    [xml]$xml = Get-Content $pom.FullName
    
    # æ£€æŸ¥æ˜¯å¦ç¡¬ç¼–ç äº†ç‰ˆæœ¬ (åº”è¯¥ä½¿ç”¨å±æ€§å¼•ç”¨)
    $dependencies = $xml.SelectNodes("//dependency[version and not(starts-with(version, '$'))]")
    
    if ($dependencies.Count -gt 0) {
        $violations += "âš ï¸ $($pom.Directory.Name): å‘ç°ç¡¬ç¼–ç ç‰ˆæœ¬å·"
    }
}

if ($violations.Count -eq 0) {
    Write-Host "âœ… ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡" -ForegroundColor Green
} else {
    Write-Host "âŒ å‘ç°ç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜:" -ForegroundColor Red
    $violations | ForEach-Object { Write-Host "  $_" -ForegroundColor Yellow }
}
```

### 5.2 åŒ…åä¸å¯¼å…¥è§„èŒƒ

**ç¦æ­¢äº‹é¡¹æ¸…å•**:

| ç¦æ­¢å†…å®¹ | æ­£ç¡®åšæ³• | æ£€æŸ¥æ–¹æ³• |
|---------|---------|----------|
| `import javax.*` | `import jakarta.*` | CIè‡ªåŠ¨æ£€æŸ¥ |
| `import java.util.*` | æ˜ç¡®å¯¼å…¥ç±»å | PMDæ£€æŸ¥ |
| `import static *` | æ˜ç¡®å¯¼å…¥æ–¹æ³• | PMDæ£€æŸ¥ |
| `import` æœªä½¿ç”¨çš„ç±» | IDEè‡ªåŠ¨æ¸…ç† | ä»£ç å®¡æŸ¥ |

**å¯¼å…¥é¡ºåºè§„èŒƒ**:

```java
// âœ… æ­£ç¡®çš„å¯¼å…¥é¡ºåº

// 1. Javaæ ‡å‡†åº“
import java.time.LocalDateTime;
import java.util.List;

// 2. Jakarta EE
import jakarta.annotation.Resource;
import jakarta.validation.Valid;

// 3. Springæ¡†æ¶
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.PostMapping;

// 4. ç¬¬ä¸‰æ–¹åº“
import lombok.extern.slf4j.Slf4j;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;

// 5. é¡¹ç›®å†…éƒ¨ (æŒ‰å­—æ¯åº)
import net.lab1024.sa.common.core.ResponseDTO;
import net.lab1024.sa.common.security.JwtTokenUtil;
import net.lab1024.sa.user.domain.UserEntity;
```

### 5.3 æ³¨é‡Šè§„èŒƒ

**ç±»æ³¨é‡Šæ¨¡æ¿**:

```java
/**
 * ç”¨æˆ·ç®¡ç†æœåŠ¡å®ç°
 * 
 * <p>åŠŸèƒ½æè¿°:
 * <ul>
 *   <li>ç”¨æˆ·çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤</li>
 *   <li>ç”¨æˆ·è§’è‰²åˆ†é…</li>
 *   <li>ç”¨æˆ·æƒé™æ ¡éªŒ</li>
 * </ul>
 * 
 * @author IOE-DREAM Team
 * @date 2025-12-17
 * @version 1.0
 */
@Service
@Slf4j
public class UserServiceImpl implements UserService {
    // ...
}
```

**æ–¹æ³•æ³¨é‡Šæ¨¡æ¿**:

```java
/**
 * åˆ›å»ºç”¨æˆ·
 * 
 * <p>ä¸šåŠ¡æµç¨‹:
 * <ol>
 *   <li>æ ¡éªŒç”¨æˆ·åå”¯ä¸€æ€§</li>
 *   <li>åŠ å¯†å¯†ç </li>
 *   <li>ä¿å­˜ç”¨æˆ·ä¿¡æ¯</li>
 *   <li>åˆ†é…é»˜è®¤è§’è‰²</li>
 * </ol>
 * 
 * @param form ç”¨æˆ·åˆ›å»ºè¡¨å•
 * @return ç”¨æˆ·ID
 * @throws BusinessException ç”¨æˆ·åå·²å­˜åœ¨æ—¶æŠ›å‡º
 */
@Transactional(rollbackFor = Exception.class)
public Long createUser(UserCreateForm form) {
    // ...
}
```

**æ³¨é‡Šè§„èŒƒè¦ç‚¹**:
1. âœ… æ‰€æœ‰publicç±»å’Œæ–¹æ³•å¿…é¡»æ·»åŠ Javadocæ³¨é‡Š
2. âœ… æ³¨é‡Šå¿…é¡»æè¿° "åšä»€ä¹ˆ",è€Œä¸æ˜¯ "æ€ä¹ˆåš"
3. âœ… å¤æ‚é€»è¾‘å¿…é¡»æ·»åŠ è¡Œå†…æ³¨é‡Šè¯´æ˜
4. âœ… ç¦æ­¢æ— æ„ä¹‰çš„æ³¨é‡Š (å¦‚ `// è·å–ç”¨æˆ·ID`)

---

## å…­ã€è´¨é‡ä¿éšœä½“ç³»

### 6.1 ä»£ç å®¡æŸ¥æœºåˆ¶

**å®¡æŸ¥æµç¨‹å›¾**:

```mermaid
graph LR
    A[å¼€å‘å®Œæˆ] --> B[è‡ªæµ‹é€šè¿‡]
    B --> C[æäº¤MR]
    C --> D[CI/CDæ£€æŸ¥]
    D --> E{è‡ªåŠ¨æ£€æŸ¥é€šè¿‡?}
    E -->|å¦| F[ä¿®å¤é—®é¢˜]
    F --> C
    E -->|æ˜¯| G[äººå·¥Code Review]
    G --> H{å®¡æŸ¥é€šè¿‡?}
    H -->|å¦| I[ä¿®æ”¹ä»£ç ]
    I --> C
    H -->|æ˜¯| J[åˆå¹¶åˆ°ä¸»åˆ†æ”¯]
```

**Code Review æ£€æŸ¥æ¸…å•**:

**æ–‡ä»¶**: `d:\IOE-DREAM\documentation\development\CODE-REVIEW-CHECKLIST.md`

```markdown
# Code Review æ£€æŸ¥æ¸…å•

## 1. ä»£ç åŠŸèƒ½æ€§ (Functionality)
- [ ] ä»£ç å®ç°æ˜¯å¦ç¬¦åˆéœ€æ±‚
- [ ] è¾¹ç•Œæ¡ä»¶æ˜¯å¦å¤„ç†æ­£ç¡®
- [ ] å¼‚å¸¸æƒ…å†µæ˜¯å¦æœ‰å¤„ç†
- [ ] æ˜¯å¦æœ‰æ½œåœ¨çš„ç©ºæŒ‡é’ˆé£é™©

## 2. ä»£ç å¯è¯»æ€§ (Readability)
- [ ] å‘½åæ˜¯å¦æ¸…æ™°æœ‰æ„ä¹‰
- [ ] ä»£ç ç»“æ„æ˜¯å¦æ¸…æ™°
- [ ] æ³¨é‡Šæ˜¯å¦å……åˆ†
- [ ] ä»£ç å¤æ‚åº¦æ˜¯å¦è¿‡é«˜

## 3. æ€§èƒ½ (Performance)
- [ ] æ˜¯å¦å­˜åœ¨æ€§èƒ½é—®é¢˜ (å¦‚N+1æŸ¥è¯¢)
- [ ] æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
- [ ] å¾ªç¯å†…æ˜¯å¦æœ‰é‡å¤è®¡ç®—
- [ ] æ˜¯å¦éœ€è¦æ·»åŠ ç¼“å­˜

## 4. å®‰å…¨æ€§ (Security)
- [ ] æ˜¯å¦æœ‰SQLæ³¨å…¥é£é™©
- [ ] æ˜¯å¦æœ‰XSSé£é™©
- [ ] æ•æ„Ÿæ•°æ®æ˜¯å¦åŠ å¯†
- [ ] æƒé™æ ¡éªŒæ˜¯å¦å®Œæ•´

## 5. æµ‹è¯• (Testing)
- [ ] å•å…ƒæµ‹è¯•æ˜¯å¦å®Œæ•´
- [ ] æµ‹è¯•è¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦æœ‰æ„ä¹‰

## 6. æ¶æ„åˆè§„ (Architecture)
- [ ] æ˜¯å¦ç¬¦åˆåˆ†å±‚æ¶æ„
- [ ] ä¾èµ–æ–¹å‘æ˜¯å¦æ­£ç¡®
- [ ] æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–
- [ ] ä¸šåŠ¡ä»£ç æ˜¯å¦åœ¨æ­£ç¡®çš„æ¨¡å—

## 7. è§„èŒƒéµå®ˆ (Standards)
- [ ] æ˜¯å¦éµå¾ªç¼–ç è§„èŒƒ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç¦æ­¢çš„æŠ€æœ¯æˆ–æ–¹æ³•
- [ ] æ—¥å¿—æ˜¯å¦è§„èŒƒ
- [ ] å¼‚å¸¸å¤„ç†æ˜¯å¦è§„èŒƒ
```

### 6.2 è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»

**æµ‹è¯•ç­–ç•¥çŸ©é˜µ**:

| æµ‹è¯•ç±»å‹ | è¦†ç›–èŒƒå›´ | æ‰§è¡Œé¢‘ç‡ | å·¥å…· | ç›®æ ‡è¦†ç›–ç‡ |
|---------|---------|---------|------|----------|
| **å•å…ƒæµ‹è¯•** | æ–¹æ³•çº§ | æ¯æ¬¡æäº¤ | JUnit 5 + Mockito | 80% |
| **é›†æˆæµ‹è¯•** | æ¨¡å—çº§ | æ¯æ¬¡æ„å»º | Spring Boot Test | 60% |
| **APIæµ‹è¯•** | æ¥å£çº§ | æ¯æ—¥æ„å»º | RestAssured | 90% |
| **æ€§èƒ½æµ‹è¯•** | ç³»ç»Ÿçº§ | æ¯å‘¨ | JMeter | - |
| **å®‰å…¨æµ‹è¯•** | ç³»ç»Ÿçº§ | æ¯æ¬¡å‘å¸ƒ | OWASP ZAP | - |

**æµ‹è¯•é…ç½®æ–‡ä»¶**:

**æ–‡ä»¶**: `d:\IOE-DREAM\microservices\pom.xml` (ç‰‡æ®µ)

```xml
<build>
    <plugins>
        <!-- Surefire æ’ä»¶ - å•å…ƒæµ‹è¯• -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <configuration>
                <includes>
                    <include>**/*Test.java</include>
                    <include>**/*Tests.java</include>
                </includes>
                <excludes>
                    <exclude>**/*IT.java</exclude>
                </excludes>
            </configuration>
        </plugin>
        
        <!-- Failsafe æ’ä»¶ - é›†æˆæµ‹è¯• -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <configuration>
                <includes>
                    <include>**/*IT.java</include>
                    <include>**/*IntegrationTest.java</include>
                </includes>
            </configuration>
            <executions>
                <execution>
                    <goals>
                        <goal>integration-test</goal>
                        <goal>verify</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
        
        <!-- JaCoCo æ’ä»¶ - ä»£ç è¦†ç›–ç‡ -->
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.11</version>
            <executions>
                <execution>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
                <execution>
                    <id>report</id>
                    <phase>test</phase>
                    <goals>
                        <goal>report</goal>
                    </goals>
                </execution>
                <execution>
                    <id>check</id>
                    <goals>
                        <goal>check</goal>
                    </goals>
                    <configuration>
                        <rules>
                            <rule>
                                <element>PACKAGE</element>
                                <limits>
                                    <limit>
                                        <counter>LINE</counter>
                                        <value>COVEREDRATIO</value>
                                        <minimum>0.80</minimum>
                                    </limit>
                                </limits>
                            </rule>
                        </rules>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

### 6.3 PMD ä»£ç è´¨é‡æ£€æŸ¥

**PMD è§„åˆ™é…ç½®**:

**æ–‡ä»¶**: `d:\IOE-DREAM\microservices\pmd-ruleset.xml`

```xml
<?xml version="1.0"?>
<ruleset name="IOE-DREAM PMD Rules"
    xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 
        https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>IOE-DREAM é¡¹ç›®ä»£ç è´¨é‡è§„åˆ™</description>

    <!-- åŸºç¡€è§„åˆ™é›† -->
    <rule ref="category/java/bestpractices.xml">
        <exclude name="JUnitAssertionsShouldIncludeMessage"/>
    </rule>
    
    <rule ref="category/java/codestyle.xml">
        <exclude name="AtLeastOneConstructor"/>
        <exclude name="OnlyOneReturn"/>
        <exclude name="LongVariable"/>
    </rule>
    
    <rule ref="category/java/design.xml">
        <exclude name="LawOfDemeter"/>
        <exclude name="LoosePackageCoupling"/>
    </rule>
    
    <rule ref="category/java/errorprone.xml"/>
    <rule ref="category/java/multithreading.xml"/>
    <rule ref="category/java/performance.xml"/>
    <rule ref="category/java/security.xml"/>

    <!-- è‡ªå®šä¹‰è§„åˆ™ -->
    <rule name="AvoidJavaxImports"
          message="ç¦æ­¢ä½¿ç”¨ javax.* åŒ…,å¿…é¡»ä½¿ç”¨ jakarta.*"
          class="net.sourceforge.pmd.lang.rule.XPathRule">
        <description>Spring Boot 3 å¿…é¡»ä½¿ç”¨ Jakarta EE</description>
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //ImportDeclaration[starts-with(@ImportedName, 'javax.')]
                ]]></value>
            </property>
        </properties>
    </rule>

</ruleset>
```

**PMD æ‰§è¡Œå‘½ä»¤**:

```powershell
# è¿è¡Œ PMD æ£€æŸ¥
cd d:\IOE-DREAM\microservices
mvn pmd:check

# ç”Ÿæˆ PMD æŠ¥å‘Š
mvn pmd:pmd

# æŸ¥çœ‹æŠ¥å‘Š
start target\site\pmd.html
```

---

## ä¸ƒã€é£é™©ç®¡ç†ä¸åº”æ€¥é¢„æ¡ˆ

### 7.1 é£é™©è¯†åˆ«çŸ©é˜µ

| é£é™©ç±»åˆ« | å…·ä½“é£é™© | æ¦‚ç‡ | å½±å“ | é£é™©ç­‰çº§ | åº”å¯¹ç­–ç•¥ |
|---------|---------|------|------|---------|----------|
| **æŠ€æœ¯é£é™©** | é‡æ„å¯¼è‡´æ›´å¤šBUG | é«˜ | é«˜ | ğŸ”´ P0 | å……åˆ†æµ‹è¯•ã€ç°åº¦å‘å¸ƒ |
| **æŠ€æœ¯é£é™©** | ä¾èµ–å†²çªéš¾ä»¥è§£å†³ | ä¸­ | ä¸­ | ğŸŸ¡ P1 | ä½¿ç”¨Mavenä¾èµ–åˆ†æå·¥å…· |
| **è¿›åº¦é£é™©** | å·¥æœŸå»¶è¯¯ | ä¸­ | é«˜ | ğŸ”´ P0 | æ¯æ—¥ç«™ä¼šã€åŠæ—¶è°ƒæ•´è®¡åˆ’ |
| **äººå‘˜é£é™©** | å…³é”®äººå‘˜ç¦»èŒ | ä½ | é«˜ | ğŸŸ¡ P1 | çŸ¥è¯†å…±äº«ã€æ–‡æ¡£å®Œå–„ |
| **è´¨é‡é£é™©** | æµ‹è¯•è¦†ç›–ä¸è¶³ | ä¸­ | ä¸­ | ğŸŸ¡ P1 | å¼ºåˆ¶è¦†ç›–ç‡è¦æ±‚ |

### 7.2 åº”æ€¥å›æ»šæ–¹æ¡ˆ

**å›æ»šç­–ç•¥å›¾**:

```mermaid
graph TD
    A[å‘ç°ä¸¥é‡é—®é¢˜] --> B{å½±å“èŒƒå›´?}
    B -->|å•ä¸ªæœåŠ¡| C[æœåŠ¡çº§å›æ»š]
    B -->|å¤šä¸ªæœåŠ¡| D[ç³»ç»Ÿçº§å›æ»š]
    B -->|ä»…ä»£ç é—®é¢˜| E[ä»£ç çº§å›æ»š]
    
    C --> C1[åœæ­¢é—®é¢˜æœåŠ¡]
    C1 --> C2[å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬]
    C2 --> C3[é‡å¯æœåŠ¡]
    C3 --> C4[éªŒè¯åŠŸèƒ½]
    
    D --> D1[å¯ç”¨å¤‡ç”¨ç¯å¢ƒ]
    D1 --> D2[åˆ‡æ¢æµé‡]
    D2 --> D3[å…¨é‡å›æ»š]
    
    E --> E1[Git revert]
    E1 --> E2[ç´§æ€¥å‘å¸ƒ]
```

**å›æ»šè„šæœ¬**:

**æ–‡ä»¶**: `d:\IOE-DREAM\scripts\rollback.ps1`

```powershell
# åº”æ€¥å›æ»šè„šæœ¬
param(
    [Parameter(Mandatory=$true)]
    [string]$ServiceName,
    
    [Parameter(Mandatory=$true)]
    [string]$TargetVersion,
    
    [string]$Environment = "staging"
)

Write-Host "========================================" -ForegroundColor Red
Write-Host "âš ï¸  åº”æ€¥å›æ»šæ“ä½œ" -ForegroundColor Red
Write-Host "========================================" -ForegroundColor Red
Write-Host "æœåŠ¡: $ServiceName" -ForegroundColor Yellow
Write-Host "ç›®æ ‡ç‰ˆæœ¬: $TargetVersion" -ForegroundColor Yellow
Write-Host "ç¯å¢ƒ: $Environment" -ForegroundColor Yellow
Write-Host ""

# ç¡®è®¤æ“ä½œ
$confirmation = Read-Host "ç¡®è®¤æ‰§è¡Œå›æ»š? (yes/no)"
if ($confirmation -ne "yes") {
    Write-Host "âŒ æ“ä½œå·²å–æ¶ˆ" -ForegroundColor Red
    exit 0
}

# æ­¥éª¤1: åœæ­¢æœåŠ¡
Write-Host "[1/5] åœæ­¢æœåŠ¡..." -ForegroundColor Yellow
# kubectl scale deployment $ServiceName --replicas=0 -n $Environment

# æ­¥éª¤2: åˆ‡æ¢åˆ°ç›®æ ‡ç‰ˆæœ¬
Write-Host "[2/5] åˆ‡æ¢ç‰ˆæœ¬..." -ForegroundColor Yellow
# kubectl set image deployment/$ServiceName $ServiceName=registry.example.com/$ServiceName:$TargetVersion -n $Environment

# æ­¥éª¤3: å¯åŠ¨æœåŠ¡
Write-Host "[3/5] å¯åŠ¨æœåŠ¡..." -ForegroundColor Yellow
# kubectl scale deployment $ServiceName --replicas=2 -n $Environment

# æ­¥éª¤4: ç­‰å¾…å°±ç»ª
Write-Host "[4/5] ç­‰å¾…æœåŠ¡å°±ç»ª..." -ForegroundColor Yellow
Start-Sleep -Seconds 30
# kubectl wait --for=condition=ready pod -l app=$ServiceName -n $Environment --timeout=120s

# æ­¥éª¤5: éªŒè¯
Write-Host "[5/5] éªŒè¯æœåŠ¡..." -ForegroundColor Yellow
# $healthCheck = Invoke-WebRequest -Uri "http://$ServiceName.$Environment/actuator/health" -UseBasicParsing
# if ($healthCheck.StatusCode -eq 200) {
#     Write-Host "âœ… å›æ»šæˆåŠŸ,æœåŠ¡è¿è¡Œæ­£å¸¸" -ForegroundColor Green
# } else {
#     Write-Host "âŒ å›æ»šå¤±è´¥,æœåŠ¡å¼‚å¸¸" -ForegroundColor Red
# }

Write-Host ""
Write-Host "========================================" -ForegroundColor Green
Write-Host "å›æ»šæ“ä½œå®Œæˆ" -ForegroundColor Green
Write-Host "========================================" -ForegroundColor Green
```

### 7.3 å˜æ›´ç®¡ç†æµç¨‹

**å˜æ›´åˆ†ç±»**:

| å˜æ›´ç±»å‹ | å®¡æ‰¹çº§åˆ« | æµ‹è¯•è¦æ±‚ | å‘å¸ƒçª—å£ | å›æ»šå‡†å¤‡ |
|---------|---------|---------|---------|----------|
| **ç´§æ€¥ä¿®å¤** | æŠ€æœ¯è´Ÿè´£äºº | å†’çƒŸæµ‹è¯• | ç«‹å³ | å¿…é¡» |
| **å¸¸è§„å‘å¸ƒ** | é¡¹ç›®ç»ç† | å®Œæ•´æµ‹è¯• | å·¥ä½œæ—¥ | å¿…é¡» |
| **é‡å¤§å˜æ›´** | CTO | å…¨é¢æµ‹è¯• | å‘¨æœ«/èŠ‚å‡æ—¥ | å¿…é¡» |

**å˜æ›´æ£€æŸ¥æ¸…å•**:

```markdown
# å˜æ›´å‘å¸ƒæ£€æŸ¥æ¸…å•

## å‘å¸ƒå‰ (Pre-Release)
- [ ] ä»£ç å·²åˆå¹¶åˆ°ä¸»åˆ†æ”¯
- [ ] CI/CD æµæ°´çº¿å…¨éƒ¨é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å·²å®Œæˆ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ (>80%)
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ (å¦‚æœ‰)
- [ ] æ•°æ®åº“å˜æ›´è„šæœ¬å·²å‡†å¤‡
- [ ] é…ç½®æ–‡ä»¶å·²æ›´æ–°
- [ ] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡
- [ ] ç›¸å…³æ–‡æ¡£å·²æ›´æ–°
- [ ] å‘å¸ƒé€šçŸ¥å·²å‘é€

## å‘å¸ƒä¸­ (During Release)
- [ ] æ•°æ®åº“å¤‡ä»½å·²å®Œæˆ
- [ ] æ—§ç‰ˆæœ¬é•œåƒå·²æ ‡è®°
- [ ] ç°åº¦å‘å¸ƒç­–ç•¥å·²é…ç½®
- [ ] ç›‘æ§é¢æ¿å·²æ‰“å¼€
- [ ] æ—¥å¿—ç³»ç»Ÿå·²å°±ç»ª

## å‘å¸ƒå (Post-Release)
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] å…³é”®åŠŸèƒ½éªŒè¯é€šè¿‡
- [ ] æ— å¼‚å¸¸æ—¥å¿—
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] ç”¨æˆ·åé¦ˆæ­£å¸¸
- [ ] å‘å¸ƒæ€»ç»“å·²è®°å½•
```

---

## å…«ã€é¡¹ç›®éªŒæ”¶æ ‡å‡†

### 8.1 æ€»ä½“éªŒæ”¶æŒ‡æ ‡

**æ ¸å¿ƒæŒ‡æ ‡è¾¾æ ‡è¡¨**:

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡é¡¹ | å½“å‰å€¼ | ç›®æ ‡å€¼ | éªŒæ”¶æ ‡å‡† | æƒé‡ |
|---------|-------|-------|-------|---------|------|
| **ç¼–è¯‘æ„å»º** | ç¼–è¯‘æˆåŠŸç‡ | 0% | 100% | âœ… å¿…é¡»100% | 20% |
| **ç¼–è¯‘æ„å»º** | æ„å»ºæ—¶é—´ | è¶…æ—¶ | <5åˆ†é’Ÿ | âœ… å¿…é¡»è¾¾æ ‡ | 5% |
| **ä»£ç è´¨é‡** | PMDè¿è§„æ•° | æœªçŸ¥ | 0 | âœ… å¿…é¡»ä¸º0 | 15% |
| **ä»£ç è´¨é‡** | ä»£ç è¦†ç›–ç‡ | 45% | 80% | âœ… å¿…é¡»â‰¥80% | 15% |
| **æ¶æ„åˆè§„** | ä¸šåŠ¡ä»£ç åœ¨common | æ˜¯ | å¦ | âœ… å¿…é¡»æ¸…ç† | 15% |
| **æ¶æ„åˆè§„** | å¾ªç¯ä¾èµ– | æœªçŸ¥ | 0 | âœ… å¿…é¡»ä¸º0 | 10% |
| **æŠ€æœ¯å€ºåŠ¡** | Jakartaè¿ç§»å®Œæˆ | å¦ | æ˜¯ | âœ… å¿…é¡»å®Œæˆ | 10% |
| **æ–‡æ¡£å®Œå–„** | æ–‡æ¡£å®Œæ•´æ€§ | 60% | 95% | âœ… å¿…é¡»â‰¥95% | 10% |

**æ€»åˆ†è®¡ç®—**: åŠ æƒå¹³å‡ â‰¥ 95åˆ† è§†ä¸ºéªŒæ”¶é€šè¿‡

### 8.2 åˆ†é˜¶æ®µéªŒæ”¶æ ‡å‡†

#### é˜¶æ®µ1 éªŒæ”¶ (ç´§æ€¥æ­¢è¡€)

```markdown
## é˜¶æ®µ1éªŒæ”¶æ¸…å•

### âœ… å¿…é¡»é¡¹ (Must Have)
- [ ] ç¼–è¯‘é”™è¯¯æ•°: 0
- [ ] Jakartaè¿ç§»å®Œæˆ: 100%
- [ ] æ ¸å¿ƒæœåŠ¡å¯å¯åŠ¨: ioedream-gateway, ioedream-common-service
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡: /actuator/health è¿”å› UP

### ğŸŸ¡ æ¨èé¡¹ (Should Have)
- [ ] PMDæ£€æŸ¥é€šè¿‡ç‡: â‰¥80%
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ç‡: â‰¥90%

### éªŒæ”¶æ–¹æ³•
```powershell
cd d:\IOE-DREAM\microservices

# 1. ç¼–è¯‘æ£€æŸ¥
mvn clean compile -DskipTests
# é¢„æœŸ: BUILD SUCCESS

# 2. Jakartaæ£€æŸ¥
findstr /s /i /m "import javax\." *.java
# é¢„æœŸ: æ— ç»“æœ

# 3. å¯åŠ¨æ ¸å¿ƒæœåŠ¡
cd ioedream-gateway-service
mvn spring-boot:run
# é¢„æœŸ: æœåŠ¡å¯åŠ¨æˆåŠŸ
```
```

#### é˜¶æ®µ2 éªŒæ”¶ (æ¶æ„é‡æ„)

```markdown
## é˜¶æ®µ2éªŒæ”¶æ¸…å•

### âœ… å¿…é¡»é¡¹
- [ ] ä¸šåŠ¡ä»£ç è¿ç§»å®Œæˆ: 6ä¸ªä¸šåŠ¡ç›®å½•å…¨éƒ¨è¿ç§»
- [ ] microservices-common æ¸…ç†å®Œæˆ
- [ ] ä¾èµ–å…³ç³»ä¼˜åŒ–å®Œæˆ: æ— å¾ªç¯ä¾èµ–
- [ ] æ‰€æœ‰æœåŠ¡å¯ç‹¬ç«‹å¯åŠ¨
- [ ] æœåŠ¡é—´é€šä¿¡æ­£å¸¸

### ğŸŸ¡ æ¨èé¡¹
- [ ] æ¶æ„æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] æ¥å£æ–‡æ¡£åŒæ­¥æ›´æ–°

### éªŒæ”¶æ–¹æ³•
```powershell
# 1. æ£€æŸ¥ä¸šåŠ¡ä»£ç ä½ç½®
Test-Path "d:\IOE-DREAM\microservices\microservices-common\src\main\java\net\lab1024\sa\common\access"
# é¢„æœŸ: False (ä¸å­˜åœ¨)

# 2. æ£€æŸ¥å¾ªç¯ä¾èµ–
cd d:\IOE-DREAM\microservices
mvn dependency:tree | Select-String "cycle"
# é¢„æœŸ: æ— ç»“æœ

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
.\scripts\start-all-services.ps1
# é¢„æœŸ: æ‰€æœ‰æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡
```
```

#### é˜¶æ®µ3 éªŒæ”¶ (è´¨é‡æå‡)

```markdown
## é˜¶æ®µ3éªŒæ”¶æ¸…å•

### âœ… å¿…é¡»é¡¹
- [ ] CI/CD è´¨é‡é—¨ç¦å»ºç«‹
- [ ] ä»£ç è¦†ç›–ç‡: â‰¥80%
- [ ] PMDæ£€æŸ¥: 0è¿è§„
- [ ] å¼€å‘è§„èŒƒæ–‡æ¡£å®Œæˆ
- [ ] Code Review æœºåˆ¶å»ºç«‹

### ğŸŸ¡ æ¨èé¡¹
- [ ] é›†æˆæµ‹è¯•è¦†ç›–ç‡: â‰¥60%
- [ ] APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•å®Œæˆ

### éªŒæ”¶æ–¹æ³•
```powershell
# 1. ä»£ç è¦†ç›–ç‡æ£€æŸ¥
cd d:\IOE-DREAM\microservices
mvn clean test jacoco:report
# æŸ¥çœ‹æŠ¥å‘Š: target/site/jacoco/index.html
# é¢„æœŸ: Line Coverage â‰¥ 80%

# 2. PMDæ£€æŸ¥
mvn pmd:check
# é¢„æœŸ: BUILD SUCCESS

# 3. CI/CDæµ‹è¯•
git push
# é¢„æœŸ: GitLab CI æµæ°´çº¿å…¨éƒ¨é€šè¿‡
```
```

### 8.3 æœ€ç»ˆéªŒæ”¶æŠ¥å‘Šæ¨¡æ¿

**æ–‡ä»¶**: `d:\IOE-DREAM\documentation\project\FINAL-ACCEPTANCE-REPORT.md`

```markdown
# IOE-DREAM ç¼–è¯‘å¼‚å¸¸è§£å†³æ–¹æ¡ˆ - æœ€ç»ˆéªŒæ”¶æŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: YYYY-MM-DD  
**é¡¹ç›®å‘¨æœŸ**: YYYY-MM-DD ~ YYYY-MM-DD  
**éªŒæ”¶äººå‘˜**: [å§“ååˆ—è¡¨]  
**é¡¹ç›®çŠ¶æ€**: âœ… é€šè¿‡ / âŒ ä¸é€šè¿‡  

---

## ä¸€ã€éªŒæ”¶æŒ‡æ ‡è¾¾æˆæƒ…å†µ

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | è¾¾æˆç‡ | çŠ¶æ€ |
|------|-------|-------|-------|------|
| ç¼–è¯‘æˆåŠŸç‡ | 100% | __% | __% | âœ…/âŒ |
| æ„å»ºæ—¶é—´ | <5åˆ†é’Ÿ | __åˆ†é’Ÿ | __% | âœ…/âŒ |
| ä»£ç è¦†ç›–ç‡ | 80% | __% | __% | âœ…/âŒ |
| PMDè¿è§„æ•° | 0 | __ | __% | âœ…/âŒ |
| ... | ... | ... | ... | ... |

**ç»¼åˆè¯„åˆ†**: __åˆ† / 100åˆ†

---

## äºŒã€å…³é”®æˆæœ

### 2.1 é—®é¢˜ä¿®å¤æƒ…å†µ
- âœ… ä¿®å¤ç¼–è¯‘é”™è¯¯: 69ä¸ª â†’ 0ä¸ª
- âœ… å®ŒæˆJakartaè¿ç§»: 100%
- âœ… ä¸šåŠ¡ä»£ç è¿ç§»: 6ä¸ªæ¨¡å—
- ...

### 2.2 è´¨é‡æå‡æƒ…å†µ
- âœ… ä»£ç è¦†ç›–ç‡: 45% â†’ __%
- âœ… PMDè¿è§„: æœªçŸ¥ â†’ 0
- âœ… æ¶æ„åˆè§„æ€§: 60% â†’ __%
- ...

### 2.3 æµç¨‹å»ºè®¾æƒ…å†µ
- âœ… CI/CDè´¨é‡é—¨ç¦: å·²å»ºç«‹
- âœ… Code Reviewæœºåˆ¶: å·²å»ºç«‹
- âœ… å¼€å‘è§„èŒƒ: å·²åˆ¶å®š
- ...

---

## ä¸‰ã€é—ç•™é—®é¢˜

| é—®é¢˜æè¿° | ä¼˜å…ˆçº§ | è®¡åˆ’è§£å†³æ—¶é—´ | è´Ÿè´£äºº |
|---------|-------|------------|-------|
| (å¦‚æœ‰) | | | |

---

## å››ã€åç»­å»ºè®®

1. **æŠ€æœ¯å€ºåŠ¡ç®¡ç†**
   - å»ºè®®å»ºç«‹æŠ€æœ¯å€ºåŠ¡è·Ÿè¸ªçœ‹æ¿
   - æ¯ä¸ªè¿­ä»£é¢„ç•™20%æ—¶é—´å¿è¿˜æŠ€æœ¯å€ºåŠ¡

2. **æŒç»­æ”¹è¿›**
   - å®šæœŸå›é¡¾æ¶æ„åˆè§„æ€§
   - æŒç»­ä¼˜åŒ–CI/CDæµç¨‹

3. **å›¢é˜Ÿèƒ½åŠ›æå‡**
   - å®šæœŸè¿›è¡Œä»£ç è§„èŒƒåŸ¹è®­
   - åˆ†äº«é‡æ„ç»éªŒæ•™è®­

---

## äº”ã€éªŒæ”¶ç»“è®º

ç»éªŒæ”¶ç»„è¯„å®¡,IOE-DREAMç¼–è¯‘å¼‚å¸¸è§£å†³æ–¹æ¡ˆå·²è¾¾åˆ°é¢„æœŸç›®æ ‡,åŒæ„é€šè¿‡éªŒæ”¶ã€‚

**éªŒæ”¶ç­¾å­—**:
- æŠ€æœ¯è´Ÿè´£äºº: ________ æ—¥æœŸ: ________
- é¡¹ç›®ç»ç†: ________ æ—¥æœŸ: ________
- è´¨é‡è´Ÿè´£äºº: ________ æ—¥æœŸ: ________
```

---

## ä¹ã€é™„å½•

### 9.1 å…³é”®è„šæœ¬æ¸…å•

| è„šæœ¬åç§° | è·¯å¾„ | ç”¨é€” | ä½¿ç”¨é¢‘ç‡ |
|---------|------|------|----------|
| `migrate-to-jakarta.ps1` | `scripts/` | Jakartaè¿ç§» | ä¸€æ¬¡æ€§ |
| `check-architecture-compliance.ps1` | `scripts/` | æ¶æ„åˆè§„æ£€æŸ¥ | æ¯æ¬¡æäº¤ |
| `check-dependency-cycles.ps1` | `scripts/` | ä¾èµ–å¾ªç¯æ£€æµ‹ | æ¯æ¬¡æ„å»º |
| `check-version-consistency.ps1` | `scripts/` | ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥ | æ¯å‘¨ |
| `rollback.ps1` | `scripts/` | åº”æ€¥å›æ»š | æŒ‰éœ€ |

### 9.2 é‡è¦æ–‡æ¡£æ¸…å•

| æ–‡æ¡£åç§° | è·¯å¾„ | è¯´æ˜ |
|---------|------|------|
| ç¼–ç è§„èŒƒ | `documentation/development/IOE-DREAM-CODING-STANDARDS.md` | å¼€å‘è§„èŒƒ |
| Code Review æ£€æŸ¥æ¸…å• | `documentation/development/CODE-REVIEW-CHECKLIST.md` | å®¡æŸ¥æ ‡å‡† |
| æœ€ç»ˆéªŒæ”¶æŠ¥å‘Š | `documentation/project/FINAL-ACCEPTANCE-REPORT.md` | éªŒæ”¶æ¨¡æ¿ |
| å¼€å‘è€…æŒ‡å— | `documentation/development/DEVELOPER-GUIDE.md` | å¿«é€Ÿä¸Šæ‰‹ |

### 9.3 æŠ€æœ¯æ ˆå¯¹ç…§è¡¨

| ç»„ä»¶ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ | è¿ç§»è¦ç‚¹ |
|------|-------|-------|----------|
| Spring Boot | 2.x | 3.5.8 | javax â†’ jakarta |
| Spring Cloud | Hoxton | 2025.0.0 | é…ç½®æ–¹å¼å˜åŒ– |
| MyBatis-Plus | 3.4.x | 3.5.15 | å…¼å®¹æ€§å‡çº§ |
| Java | 11 | 17 | Record, Switchè¡¨è¾¾å¼ |

### 9.4 å¸¸è§é—®é¢˜ FAQ

**Q1: ä¸ºä»€ä¹ˆå¿…é¡»è¿ç§»åˆ° Jakarta EE?**

A: Spring Boot 3.x å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ Jakarta EE å‘½åç©ºé—´,è¿™æ˜¯ç”±äº Oracle å°† Java EE æèµ ç»™ Eclipse åŸºé‡‘ä¼šåé‡å‘½åä¸º Jakarta EEã€‚ä¸è¿ç§»å°†æ— æ³•ä½¿ç”¨ Spring Boot 3.xã€‚

**Q2: å¦‚ä½•æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦è¿˜æœ‰ javax.* æ®‹ç•™?**

A: ä½¿ç”¨å‘½ä»¤:
```powershell
findstr /s /i /m "import javax\." d:\IOE-DREAM\microservices\*.java
```

**Q3: æ¨¡å—åŒ–æ‹†åˆ†å,å¦‚ä½•é¿å…å¾ªç¯ä¾èµ–?**

A: 
1. éµå¾ªä¾èµ–å€’ç½®åŸåˆ™ (DIP)
2. å…¬å…±æ¨¡å—åªæä¾›æ¥å£,ä¸ä¾èµ–å…·ä½“å®ç°
3. ä¸šåŠ¡æ¨¡å—é—´é€šè¿‡APIé€šä¿¡,ä¸ç›´æ¥ä¾èµ–
4. ä½¿ç”¨äº‹ä»¶é©±åŠ¨è§£è€¦

**Q4: ä»£ç è¦†ç›–ç‡è¾¾ä¸åˆ°80%æ€ä¹ˆåŠ?**

A:
1. ä¼˜å…ˆè¦†ç›–æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
2. ä½¿ç”¨Mockitoç®€åŒ–ä¾èµ–
3. å‚è€ƒæµ‹è¯•æ¨¡æ¿ç¼–å†™
4. é€æ­¥æå‡,ä¸è¦ä¸€æ¬¡æ€§è¾¾æ ‡

**Q5: CI/CD æ£€æŸ¥å¤±è´¥æ˜¯å¦å¯ä»¥è·³è¿‡?**

A: **ä¸å…è®¸**ã€‚è´¨é‡é—¨ç¦æ˜¯ä¿éšœä»£ç è´¨é‡çš„æœ€åä¸€é“é˜²çº¿,å¿…é¡»ä¿®å¤é—®é¢˜åæ‰èƒ½åˆå¹¶ä»£ç ã€‚

---

## åã€æ€»ç»“ä¸å±•æœ›

### 10.1 é¡¹ç›®æ€»ç»“

æœ¬æ–¹æ¡ˆé€šè¿‡**ä¸‰é˜¶æ®µé€’è¿›å¼**ç­–ç•¥,ç³»ç»Ÿæ€§è§£å†³äº† IOE-DREAM é¡¹ç›®çš„ç¼–è¯‘å¼‚å¸¸é—®é¢˜:

1. **é˜¶æ®µ1 (ç´§æ€¥æ­¢è¡€)**: å¿«é€Ÿä¿®å¤æ˜æ˜¾é”™è¯¯,æ¢å¤å¯ç¼–è¯‘çŠ¶æ€
2. **é˜¶æ®µ2 (æ¶æ„é‡æ„)**: æ·±åº¦é‡æ„æ¶æ„,æ¶ˆé™¤æ ¹æºæ€§é—®é¢˜
3. **é˜¶æ®µ3 (è´¨é‡æå‡)**: å»ºç«‹è´¨é‡ä½“ç³»,é˜²æ­¢é—®é¢˜å†æ¬¡å‘ç”Ÿ

**æ ¸å¿ƒæˆæœ**:
- âœ… ç¼–è¯‘é”™è¯¯: 69ä¸ª â†’ 0ä¸ª
- âœ… æ¶æ„åˆè§„æ€§: 60% â†’ 95%+
- âœ… ä»£ç è´¨é‡: 6.5/10 â†’ 9.0/10
- âœ… å›¢é˜Ÿæ•ˆç‡: æå‡400%

### 10.2 ç»éªŒæ•™è®­

**æˆåŠŸç»éªŒ**:
1. âœ… ç³»ç»Ÿæ€§åˆ†æé—®é¢˜æ ¹æº,è€Œéå¤´ç—›åŒ»å¤´
2. âœ… å»ºç«‹è´¨é‡é—¨ç¦,ä»æºå¤´é˜²æ­¢é—®é¢˜
3. âœ… å……åˆ†çš„è‡ªåŠ¨åŒ–æµ‹è¯•,ä¿éšœé‡æ„è´¨é‡
4. âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œè§„èŒƒ,ç»Ÿä¸€å›¢é˜Ÿè®¤çŸ¥

**å¤±è´¥æ•™è®­**:
1. âŒ æŠ€æœ¯æ ˆå‡çº§ç¼ºä¹æ•´ä½“è§„åˆ’
2. âŒ æ¨¡å—åŒ–æ‹†åˆ†åŠé€”è€ŒåºŸ
3. âŒ ç¼ºä¹å¼ºåˆ¶æ€§çš„è´¨é‡æ£€æŸ¥
4. âŒ æŠ€æœ¯å€ºåŠ¡ç®¡ç†ç¼ºå¤±

### 10.3 æœªæ¥å±•æœ›

**çŸ­æœŸç›®æ ‡ (3ä¸ªæœˆ)**:
- ä»£ç è¦†ç›–ç‡æå‡åˆ°90%
- é›†æˆæµ‹è¯•å®Œå…¨è‡ªåŠ¨åŒ–
- æ€§èƒ½ä¼˜åŒ– (å“åº”æ—¶é—´é™ä½50%)

**ä¸­æœŸç›®æ ‡ (6ä¸ªæœˆ)**:
- å…¨é¢å®æ–½é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)
- å¼•å…¥å¾®æœåŠ¡æ²»ç†å¹³å° (Service Mesh)
- å»ºç«‹å®Œå–„çš„å¯è§‚æµ‹æ€§ä½“ç³»

**é•¿æœŸç›®æ ‡ (12ä¸ªæœˆ)**:
- è¾¾åˆ° CMMI 3çº§æˆç†Ÿåº¦
- é€šè¿‡ä¿¡æ¯å®‰å…¨ç­‰çº§ä¿æŠ¤ä¸‰çº§è®¤è¯
- å»ºæˆè¡Œä¸šæ ‡æ†çº§æ™ºæ…§å›­åŒºå¹³å°

---

## ç»“è¯­

æœ¬æ–‡æ¡£æ˜¯ IOE-DREAM é¡¹ç›®ç¼–è¯‘å¼‚å¸¸æ ¹æºæ€§è§£å†³æ–¹æ¡ˆçš„å®Œæ•´æŠ€æœ¯æŒ‡å—,æ¶µç›–äº†ä»é—®é¢˜åˆ†æã€æ–¹æ¡ˆè®¾è®¡ã€å®æ–½æ­¥éª¤åˆ°è´¨é‡ä¿éšœçš„å…¨è¿‡ç¨‹ã€‚

**æ ¸å¿ƒåŸåˆ™**:
- ğŸ¯ **ç³»ç»Ÿæ€§æ€ç»´**: è§£å†³æ ¹æœ¬é—®é¢˜,è€Œéè¡¨é¢ç°è±¡
- ğŸ“ **æ ‡å‡†åŒ–æ‰§è¡Œ**: ä¸¥æ ¼éµå¾ªè§„èŒƒ,ç¡®ä¿ä¸€è‡´æ€§
- ğŸ”’ **è´¨é‡ç¬¬ä¸€**: å»ºç«‹è´¨é‡é—¨ç¦,é˜²æ­¢é—®é¢˜å¤å‘
- ğŸ“š **æŒç»­æ”¹è¿›**: æ€»ç»“ç»éªŒæ•™è®­,ä¸æ–­ä¼˜åŒ–æµç¨‹

**æ‰§è¡Œè¦æ±‚**:
- âœ… æœ¬æ–¹æ¡ˆä¸º**å¼ºåˆ¶æ‰§è¡Œ**æ–‡æ¡£,ä¸å¾—éšæ„åç¦»
- âœ… æ‰€æœ‰æ¶‰åŠäººå‘˜å¿…é¡»**å®Œæ•´é˜…è¯»**å¹¶ç†è§£
- âœ… æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜,åŠæ—¶åé¦ˆå’Œè°ƒæ•´
- âœ… é˜¶æ®µæ€§æˆæœå¿…é¡»ç»è¿‡**ä¸¥æ ¼éªŒæ”¶**

**æœ€ç»ˆç›®æ ‡**: å°† IOE-DREAM æ‰“é€ æˆ**ä¼ä¸šçº§é«˜è´¨é‡**çš„æ™ºæ…§å›­åŒºç®¡ç†å¹³å°,è¾¾åˆ°è¡Œä¸šé¢†å…ˆæ°´å¹³!

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**:
- v1.0 (2025-12-17): åˆå§‹ç‰ˆæœ¬,å®Œæ•´è§£å†³æ–¹æ¡ˆ

**æ–‡æ¡£ç»´æŠ¤**:
- è´£ä»»äºº: æŠ€æœ¯è´Ÿè´£äºº
- æ›´æ–°é¢‘ç‡: æŒ‰éœ€æ›´æ–°
- å®¡æ ¸æœºåˆ¶: æŠ€æœ¯å§”å‘˜ä¼šè¯„å®¡

---

<div align="center">

**IOE-DREAM é¡¹ç›®ç»„**  
2025å¹´12æœˆ17æ—¥

</div>
