# æµ‹è¯•è§„èŒƒï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„å”¯ä¸€æµ‹è¯•è§„èŒƒæƒå¨æ¥æºï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚

## âš ï¸ æµ‹è¯•é“å¾‹ï¼ˆä¸å¯è¿åï¼‰

### ğŸš« ç»å¯¹ç¦æ­¢
```markdown
âŒ ç¦æ­¢ä»£ç æäº¤å‰ä¸è¿›è¡Œå•å…ƒæµ‹è¯•
âŒ ç¦æ­¢ç¼ºå°‘æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„æµ‹è¯•è¦†ç›–
âŒ ç¦æ­¢ä½¿ç”¨ç”Ÿäº§æ•°æ®åº“è¿›è¡Œæµ‹è¯•
âŒ ç¦æ­¢æµ‹è¯•ä»£ç åŒ…å«ç¡¬ç¼–ç å€¼
âŒ ç¦æ­¢å¿½ç•¥æµ‹è¯•å¤±è´¥
âŒ ç¦æ­¢æµ‹è¯•è¦†ç›–ç‡ä½äº80%
âŒ ç¦æ­¢ç¼ºå°‘é›†æˆæµ‹è¯•
âŒ ç¦æ­¢æµ‹è¯•ç¯å¢ƒé…ç½®ä¸ä¸€è‡´
```

### âœ… å¿…é¡»æ‰§è¡Œ
```markdown
âœ… å¿…é¡»è¾¾åˆ°80%ä»¥ä¸Šçš„æµ‹è¯•è¦†ç›–ç‡
âœ… å¿…é¡»ç¼–å†™ç‹¬ç«‹ã€å¯é‡å¤çš„æµ‹è¯•ç”¨ä¾‹
âœ… å¿…é¡»ä½¿ç”¨æµ‹è¯•ä¸“ç”¨æ•°æ®åº“
âœ… å¿…é¡»è¿›è¡Œæ¥å£é›†æˆæµ‹è¯•
âœ… å¿…é¡»æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯æµ‹è¯•
âœ… å¿…é¡»å®šæœŸè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
âœ… å¿…é¡»ç¼–å†™æ¸…æ™°çš„æµ‹è¯•æ–‡æ¡£
âœ… å¿…é¡»è¿›è¡Œæ€§èƒ½å’Œå‹åŠ›æµ‹è¯•
```

## ğŸ§ª æµ‹è¯•åˆ†å±‚ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”
```
        /\
       /  \     E2Eæµ‹è¯• (10%)
      /____\    ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
     /      \
    /        \  é›†æˆæµ‹è¯• (20%)
   /__________\ æœåŠ¡é—´é›†æˆæµ‹è¯•
  /            \
 /              \ å•å…ƒæµ‹è¯• (70%)
/________________\ å‡½æ•°/ç±»çº§åˆ«æµ‹è¯•
```

### æµ‹è¯•åˆ†ç±»å’ŒèŒè´£
```markdown
#### å•å…ƒæµ‹è¯• (70%)
- æµ‹è¯•èŒƒå›´ï¼šå•ä¸ªå‡½æ•°ã€æ–¹æ³•ã€ç±»
- æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯ä»£ç é€»è¾‘æ­£ç¡®æ€§
- æ‰§è¡Œé¢‘ç‡ï¼šæ¯æ¬¡ä»£ç æäº¤
- æ‰§è¡Œæ—¶é—´ï¼šç§’çº§

#### é›†æˆæµ‹è¯• (20%)
- æµ‹è¯•èŒƒå›´ï¼šæ¨¡å—é—´æ¥å£ã€æ•°æ®åº“äº¤äº’
- æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯ç»„ä»¶åä½œæ­£ç¡®æ€§
- æ‰§è¡Œé¢‘ç‡ï¼šæ¯æ—¥æ„å»º
- æ‰§è¡Œæ—¶é—´ï¼šåˆ†é’Ÿçº§

#### ç«¯åˆ°ç«¯æµ‹è¯• (10%)
- æµ‹è¯•èŒƒå›´ï¼šå®Œæ•´ä¸šåŠ¡æµç¨‹
- æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯ç”¨æˆ·åœºæ™¯æ­£ç¡®æ€§
- æ‰§è¡Œé¢‘ç‡ï¼šå‘å¸ƒå‰
- æ‰§è¡Œæ—¶é—´ï¼šå°æ—¶çº§
```

## ğŸ”¬ å•å…ƒæµ‹è¯•è§„èŒƒ

### Javaå•å…ƒæµ‹è¯•æ¨¡æ¿
```java
// UserServiceTest.java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {

    @Mock
    private UserDao userDao;

    @Mock
    private UserCacheManager userCacheManager;

    @InjectMocks
    private UserService userService;

    private UserEntity testUser;

    @BeforeEach
    void setUp() {
        testUser = UserEntity.builder()
                .userId(1L)
                .userName("testuser")
                .email("test@example.com")
                .status(1)
                .build();
    }

    @Test
    @DisplayName("æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void getUserById_Success() {
        // Given
        Long userId = 1L;
        when(userDao.selectById(userId)).thenReturn(testUser);

        // When
        UserEntity result = userService.getUserById(userId);

        // Then
        assertThat(result).isNotNull();
        assertThat(result.getUserId()).isEqualTo(userId);
        assertThat(result.getUserName()).isEqualTo("testuser");

        verify(userDao, times(1)).selectById(userId);
        verify(userCacheManager, times(1)).queryUserInfo(userId);
    }

    @Test
    @DisplayName("æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ· - ç”¨æˆ·ä¸å­˜åœ¨")
    void getUserById_UserNotFound() {
        // Given
        Long userId = 999L;
        when(userDao.selectById(userId)).thenReturn(null);

        // When & Then
        assertThatThrownBy(() -> userService.getUserById(userId))
                .isInstanceOf(BusinessException.class)
                .hasMessage("ç”¨æˆ·ä¸å­˜åœ¨");

        verify(userDao, times(1)).selectById(userId);
    }

    @Test
    @DisplayName("æ–°å¢ç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void addUser_Success() {
        // Given
        UserAddForm addForm = UserAddForm.builder()
                .userName("newuser")
                .email("newuser@example.com")
                .password("password123")
                .build();

        when(userDao.insert(any(UserEntity.class))).thenReturn(1);
        doNothing().when(userCacheManager).removeUserCache(anyLong());

        // When
        ResponseDTO<String> result = userService.addUser(addForm);

        // Then
        assertThat(result.isSuccess()).isTrue();

        verify(userDao, times(1)).insert(any(UserEntity.class));
        verify(userCacheManager, times(1)).removeUserCache(anyLong());

        // éªŒè¯å¯†ç åŠ å¯†
        ArgumentCaptor<UserEntity> userCaptor = ArgumentCaptor.forClass(UserEntity.class);
        verify(userDao).insert(userCaptor.capture());
        UserEntity savedUser = userCaptor.getValue();
        assertThat(savedUser.getPassword()).isNotEqualTo("password123");
        assertThat(savedUser.getPassword()).contains(":");
    }

    @Test
    @DisplayName("æ–°å¢ç”¨æˆ· - ç”¨æˆ·åå·²å­˜åœ¨")
    void addUser_UserNameExists() {
        // Given
        UserAddForm addForm = UserAddForm.builder()
                .userName("existinguser")
                .email("newuser@example.com")
                .password("password123")
                .build();

        when(userDao.selectByUserName("existinguser")).thenReturn(testUser);

        // When & Then
        assertThatThrownBy(() -> userService.addUser(addForm))
                .isInstanceOf(BusinessException.class)
                .hasMessage("ç”¨æˆ·åå·²å­˜åœ¨");

        verify(userDao, never()).insert(any(UserEntity.class));
        verify(userCacheManager, never()).removeUserCache(anyLong());
    }

    @Test
    @DisplayName("æ‰¹é‡æŸ¥è¯¢ç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void batchGetUsers_Success() {
        // Given
        List<Long> userIds = Arrays.asList(1L, 2L, 3L);
        List<UserEntity> users = Arrays.asList(testUser, testUser, testUser);

        when(userDao.selectBatchIds(userIds)).thenReturn(users);

        // When
        Map<Long, UserEntity> result = userService.batchGetUsers(userIds);

        // Then
        assertThat(result).hasSize(3);
        assertThat(result).containsKeys(1L, 2L, 3L);

        verify(userDao, times(1)).selectBatchIds(userIds);
    }

    @ParameterizedTest
    @DisplayName("ç”¨æˆ·çŠ¶æ€éªŒè¯ - å‚æ•°åŒ–æµ‹è¯•")
    @ValueSource(ints = {0, 1, 2})
    void validateUserStatus(int status) {
        // Given
        testUser.setStatus(status);

        // When
        boolean isValid = userService.validateUserStatus(testUser);

        // Then
        if (status == 1) {
            assertThat(isValid).isTrue();
        } else {
            assertThat(isValid).isFalse();
        }
    }
}
```

### å‰ç«¯å•å…ƒæµ‹è¯•æ¨¡æ¿
```typescript
// UserList.test.ts
import { mount } from '@vue/test-utils'
import { describe, it, expect, vi, beforeEach } from 'vitest'
import UserList from '@/components/UserList.vue'
import { userApi } from '@/api/user'
import type { UserItem } from '@/types/user'

// Mock API
vi.mock('@/api/user', () => ({
  userApi: {
    getList: vi.fn(),
    delete: vi.fn(),
    batchDelete: vi.fn()
  }
}))

const mockUsers: UserItem[] = [
  {
    id: 1,
    userName: 'user1',
    email: 'user1@example.com',
    status: 1,
    createTime: '2024-01-01 10:00:00'
  },
  {
    id: 2,
    userName: 'user2',
    email: 'user2@example.com',
    status: 0,
    createTime: '2024-01-02 10:00:00'
  }
]

describe('UserList', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })

  it('æ­£ç¡®æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨', async () => {
    // Given
    const mockResponse = {
      data: {
        records: mockUsers,
        total: 2
      }
    }
    vi.mocked(userApi.getList).mockResolvedValue(mockResponse)

    // When
    const wrapper = mount(UserList)
    await wrapper.vm.$nextTick()

    // Then
    expect(wrapper.find('.user-list').exists()).toBe(true)
    expect(wrapper.findAll('.ant-table-row')).toHaveLength(2)
    expect(wrapper.text()).toContain('user1')
    expect(wrapper.text()).toContain('user2')
  })

  it('æœç´¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ', async () => {
    // Given
    const mockResponse = {
      data: {
        records: [mockUsers[0]],
        total: 1
      }
    }
    vi.mocked(userApi.getList).mockResolvedValue(mockResponse)

    const wrapper = mount(UserList)
    await wrapper.vm.$nextTick()

    // When
    await wrapper.find('input[placeholder="è¯·è¾“å…¥ç”¨æˆ·å"]').setValue('user1')
    await wrapper.find('button[type="primary"]').trigger('click')
    await wrapper.vm.$nextTick()

    // Then
    expect(vi.mocked(userApi.getList)).toHaveBeenCalledWith(
      expect.objectContaining({
        userName: 'user1'
      })
    )
  })

  it('åˆ é™¤å•ä¸ªç”¨æˆ·', async () => {
    // Given
    const mockResponse = { data: { records: mockUsers, total: 2 } }
    vi.mocked(userApi.getList).mockResolvedValue(mockResponse)
    vi.mocked(userApi.delete).mockResolvedValue({})

    const wrapper = mount(UserList)
    await wrapper.vm.$nextTick()

    // When
    const deleteButton = wrapper.find('button:contains("åˆ é™¤")')
    await deleteButton.trigger('click')

    // ç¡®è®¤åˆ é™¤
    const confirmButton = wrapper.find('.ant-modal-confirm-btns .ant-btn-primary')
    await confirmButton.trigger('click')

    // Then
    expect(vi.mocked(userApi.delete)).toHaveBeenCalledWith(1)
  })

  it('æ‰¹é‡åˆ é™¤ç”¨æˆ·', async () => {
    // Given
    const mockResponse = { data: { records: mockUsers, total: 2 } }
    vi.mocked(userApi.getList).mockResolvedValue(mockResponse)
    vi.mocked(userApi.batchDelete).mockResolvedValue({})

    const wrapper = mount(UserList)
    await wrapper.vm.$nextTick()

    // When
    // é€‰æ‹©ç”¨æˆ·
    const checkboxes = wrapper.findAll('.ant-checkbox-input')
    await checkboxes[0].setChecked(true)
    await checkboxes[1].setChecked(true)

    // æ‰¹é‡åˆ é™¤
    const batchDeleteButton = wrapper.find('button:contains("æ‰¹é‡åˆ é™¤")')
    await batchDeleteButton.trigger('click')

    // ç¡®è®¤åˆ é™¤
    const confirmButton = wrapper.find('.ant-modal-confirm-btns .ant-btn-primary')
    await confirmButton.trigger('click')

    // Then
    expect(vi.mocked(userApi.batchDelete)).toHaveBeenCalledWith([1, 2])
  })

  it('å¤„ç†åŠ è½½çŠ¶æ€', async () => {
    // Given
    vi.mocked(userApi.getList).mockImplementation(() => new Promise(resolve => setTimeout(resolve, 100)))

    const wrapper = mount(UserList)

    // When
    wrapper.vm.loadData()

    // Then
    expect(wrapper.find('.ant-spin').exists()).toBe(true)
  })

  it('å¤„ç†é”™è¯¯çŠ¶æ€', async () => {
    // Given
    vi.mocked(userApi.getList).mockRejectedValue(new Error('ç½‘ç»œé”™è¯¯'))

    const wrapper = mount(UserList)
    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {})

    // When
    await wrapper.vm.loadData()

    // Then
    expect(consoleSpy).toHaveBeenCalledWith('åŠ è½½æ•°æ®å¤±è´¥', expect.any(Error))
    consoleSpy.mockRestore()
  })
})
```

## ğŸ”— é›†æˆæµ‹è¯•è§„èŒƒ

### APIé›†æˆæµ‹è¯•æ¨¡æ¿
```java
// UserControllerIntegrationTest.java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@TestPropertySource(locations = "classpath:application-test.properties")
@Transactional
@Rollback
class UserControllerIntegrationTest {

    @Autowired
    private TestRestTemplate restTemplate;

    @Autowired
    private TestEntityManager entityManager;

    private UserEntity testUser;

    @BeforeEach
    void setUp() {
        testUser = UserEntity.builder()
                .userName("testuser")
                .email("test@example.com")
                .password(BCrypt.hashpw("password123", BCrypt.gensalt()))
                .status(1)
                .build();
        entityManager.persistAndFlush(testUser);
    }

    @Test
    @DisplayName("è·å–ç”¨æˆ·åˆ—è¡¨ - æˆåŠŸåœºæ™¯")
    void getUserList_Success() {
        // Given
        String url = "/api/user/list";

        // When
        ResponseEntity<ResponseDTO<PageResult<UserVO>>> response =
            restTemplate.exchange(url, HttpMethod.GET, null,
                new ParameterizedTypeReference<ResponseDTO<PageResult<UserVO>>>() {});

        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().isSuccess()).isTrue();
        assertThat(response.getBody().getData().getRecords()).hasSize(1);
        assertThat(response.getBody().getData().getRecords().get(0).getUserName())
                .isEqualTo("testuser");
    }

    @Test
    @DisplayName("æ ¹æ®IDè·å–ç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void getUserById_Success() {
        // Given
        String url = "/api/user/" + testUser.getUserId();

        // When
        ResponseEntity<ResponseDTO<UserVO>> response =
            restTemplate.exchange(url, HttpMethod.GET, null,
                new ParameterizedTypeReference<ResponseDTO<UserVO>>() {});

        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().isSuccess()).isTrue();
        assertThat(response.getBody().getData().getUserId())
                .isEqualTo(testUser.getUserId());
    }

    @Test
    @DisplayName("æ–°å¢ç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void addUser_Success() {
        // Given
        String url = "/api/user";
        UserAddForm addForm = UserAddForm.builder()
                .userName("newuser")
                .email("newuser@example.com")
                .password("password123")
                .build();

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity<UserAddForm> request = new HttpEntity<>(addForm, headers);

        // When
        ResponseEntity<ResponseDTO<String>> response =
            restTemplate.exchange(url, HttpMethod.POST, request,
                new ParameterizedTypeReference<ResponseDTO<String>>() {});

        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().isSuccess()).isTrue();

        // éªŒè¯æ•°æ®åº“ä¸­å­˜åœ¨è¯¥ç”¨æˆ·
        UserEntity savedUser = entityManager.find(UserEntity.class,
            Long.parseLong(response.getBody().getData()));
        assertThat(savedUser).isNotNull();
        assertThat(savedUser.getUserName()).isEqualTo("newuser");
    }

    @Test
    @DisplayName("æ–°å¢ç”¨æˆ· - ç”¨æˆ·åå·²å­˜åœ¨")
    void addUser_UserNameExists() {
        // Given
        String url = "/api/user";
        UserAddForm addForm = UserAddForm.builder()
                .userName("testuser") // å·²å­˜åœ¨çš„ç”¨æˆ·å
                .email("newuser@example.com")
                .password("password123")
                .build();

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity<UserAddForm> request = new HttpEntity<>(addForm, headers);

        // When
        ResponseEntity<ResponseDTO<String>> response =
            restTemplate.exchange(url, HttpMethod.POST, request,
                new ParameterizedTypeReference<ResponseDTO<String>>() {});

        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().isSuccess()).isFalse();
        assertThat(response.getBody().getMessage()).contains("ç”¨æˆ·åå·²å­˜åœ¨");
    }
}
```

### æ•°æ®åº“é›†æˆæµ‹è¯•æ¨¡æ¿
```java
// UserDaoIntegrationTest.java
@DataJpaTest
@TestPropertySource(locations = "classpath:application-test.properties")
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
@Testcontainers
class UserDaoIntegrationTest {

    @Container
    static MySQLContainer<?> mysql = new MySQLContainer<>("mysql:9.3")
            .withDatabaseName("test_db")
            .withUsername("test")
            .withPassword("test");

    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", mysql::getJdbcUrl);
        registry.add("spring.datasource.username", mysql::getUsername);
        registry.add("spring.datasource.password", mysql::getPassword);
    }

    @Autowired
    private TestEntityManager entityManager;

    @Autowired
    private UserDao userDao;

    @Test
    @DisplayName("æ’å…¥ç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void insertUser_Success() {
        // Given
        UserEntity user = UserEntity.builder()
                .userName("testuser")
                .email("test@example.com")
                .status(1)
                .build();

        // When
        int result = userDao.insert(user);

        // Then
        assertThat(result).isEqualTo(1);
        assertThat(user.getUserId()).isNotNull();

        // éªŒè¯æ•°æ®åº“ä¸­çš„æ•°æ®
        UserEntity savedUser = entityManager.find(UserEntity.class, user.getUserId());
        assertThat(savedUser).isNotNull();
        assertThat(savedUser.getUserName()).isEqualTo("testuser");
    }

    @Test
    @DisplayName("æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·")
    void selectByUserName_Success() {
        // Given
        UserEntity user = UserEntity.builder()
                .userName("testuser")
                .email("test@example.com")
                .status(1)
                .build();
        entityManager.persistAndFlush(user);

        // When
        UserEntity result = userDao.selectByUserName("testuser");

        // Then
        assertThat(result).isNotNull();
        assertThat(result.getUserName()).isEqualTo("testuser");
        assertThat(result.getEmail()).isEqualTo("test@example.com");
    }

    @Test
    @DisplayName("åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·")
    void selectPage_Success() {
        // Given
        for (int i = 1; i <= 25; i++) {
            UserEntity user = UserEntity.builder()
                    .userName("user" + i)
                    .email("user" + i + "@example.com")
                    .status(1)
                    .build();
            entityManager.persistAndFlush(user);
        }

        Page<UserEntity> page = new Page<>(1, 10);
        UserQueryForm queryForm = new UserQueryForm();

        // When
        IPage<UserEntity> result = userDao.selectPage(page, queryForm);

        // Then
        assertThat(result.getTotal()).isEqualTo(25);
        assertThat(result.getRecords()).hasSize(10);
        assertThat(result.getCurrent()).isEqualTo(1);
        assertThat(result.getSize()).isEqualTo(10);
    }
}
```

## ğŸŒ ç«¯åˆ°ç«¯æµ‹è¯•è§„èŒƒ

### E2Eæµ‹è¯•æ¨¡æ¿ (Playwright)
```typescript
// user-management.e2e.ts
import { test, expect } from '@playwright/test'

test.describe('ç”¨æˆ·ç®¡ç†', () => {
  test.beforeEach(async ({ page }) => {
    // ç™»å½•
    await page.goto('/login')
    await page.fill('[data-testid=username]', 'admin')
    await page.fill('[data-testid=password]', 'password')
    await page.click('[data-testid=login-button]')
    await page.waitForURL('/dashboard')
  })

  test('ç”¨æˆ·åˆ—è¡¨é¡µé¢åŠŸèƒ½', async ({ page }) => {
    // å¯¼èˆªåˆ°ç”¨æˆ·ç®¡ç†é¡µé¢
    await page.click('[data-testid=user-management-menu]')
    await page.waitForURL('/user/list')

    // éªŒè¯é¡µé¢æ ‡é¢˜
    await expect(page.locator('h1')).toContainText('ç”¨æˆ·ç®¡ç†')

    // éªŒè¯è¡¨æ ¼å­˜åœ¨
    await expect(page.locator('[data-testid=user-table]')).toBeVisible()

    // éªŒè¯æœç´¢åŠŸèƒ½
    await page.fill('[data-testid=search-input]', 'admin')
    await page.click('[data-testid=search-button]')
    await page.waitForTimeout(1000) // ç­‰å¾…æœç´¢ç»“æœ

    // éªŒè¯æœç´¢ç»“æœ
    const rows = page.locator('[data-testid=user-table] tbody tr')
    await expect(rows.first()).toContainText('admin')

    // éªŒè¯æ–°å¢ç”¨æˆ·åŠŸèƒ½
    await page.click('[data-testid=add-user-button]')
    await page.waitForSelector('[data-testid=user-modal]')

    await page.fill('[data-testid=username-input]', 'newuser')
    await page.fill('[data-testid=email-input]', 'newuser@example.com')
    await page.fill('[data-testid=password-input]', 'password123')
    await page.click('[data-testid=submit-button]')

    // éªŒè¯æˆåŠŸæç¤º
    await expect(page.locator('.ant-message-success')).toBeVisible()

    // éªŒè¯æ–°ç”¨æˆ·å‡ºç°åœ¨åˆ—è¡¨ä¸­
    await expect(page.locator('[data-testid=user-table]')).toContainText('newuser')
  })

  test('ç”¨æˆ·ç¼–è¾‘åŠŸèƒ½', async ({ page }) => {
    await page.goto('/user/list')

    // ç‚¹å‡»ç¼–è¾‘æŒ‰é’®
    await page.click('[data-testid=edit-button-1]')
    await page.waitForSelector('[data-testid=user-modal]')

    // ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
    await page.fill('[data-testid=email-input]', 'updated@example.com')
    await page.click('[data-testid=submit-button]')

    // éªŒè¯æˆåŠŸæç¤º
    await expect(page.locator('.ant-message-success')).toBeVisible()

    // éªŒè¯ä¿®æ”¹åçš„ä¿¡æ¯
    await expect(page.locator('[data-testid=user-table]')).toContainText('updated@example.com')
  })

  test('ç”¨æˆ·åˆ é™¤åŠŸèƒ½', async ({ page }) => {
    await page.goto('/user/list')

    // è·å–åˆå§‹è¡Œæ•°
    const initialRows = await page.locator('[data-testid=user-table] tbody tr').count()

    // ç‚¹å‡»åˆ é™¤æŒ‰é’®
    await page.click('[data-testid=delete-button-1]')

    // ç¡®è®¤åˆ é™¤
    await page.click('.ant-modal-confirm-btns .ant-btn-primary')

    // éªŒè¯æˆåŠŸæç¤º
    await expect(page.locator('.ant-message-success')).toBeVisible()

    // éªŒè¯è¡Œæ•°å‡å°‘
    await page.waitForTimeout(1000)
    const finalRows = await page.locator('[data-testid=user-table] tbody tr').count()
    await expect(finalRows).toBe(initialRows - 1)
  })

  test('æ‰¹é‡åˆ é™¤åŠŸèƒ½', async ({ page }) => {
    await page.goto('/user/list')

    // é€‰æ‹©å¤šä¸ªç”¨æˆ·
    await page.check('[data-testid=checkbox-1]')
    await page.check('[data-testid=checkbox-2]')

    // æ‰¹é‡åˆ é™¤
    await page.click('[data-testid=batch-delete-button]')

    // ç¡®è®¤åˆ é™¤
    await page.click('.ant-modal-confirm-btns .ant-btn-primary')

    // éªŒè¯æˆåŠŸæç¤º
    await expect(page.locator('.ant-message-success')).toBeVisible()
  })

  test('å“åº”å¼è®¾è®¡', async ({ page }) => {
    await page.goto('/user/list')

    // æµ‹è¯•æ¡Œé¢ç«¯
    await page.setViewportSize({ width: 1200, height: 800 })
    await expect(page.locator('[data-testid=user-table]')).toBeVisible()

    // æµ‹è¯•å¹³æ¿ç«¯
    await page.setViewportSize({ width: 768, height: 1024 })
    await expect(page.locator('[data-testid=user-table]')).toBeVisible()

    // æµ‹è¯•æ‰‹æœºç«¯
    await page.setViewportSize({ width: 375, height: 667 })
    await expect(page.locator('[data-testid=user-table]')).toBeVisible()

    // éªŒè¯å“åº”å¼å¸ƒå±€è°ƒæ•´
    await expect(page.locator('.ant-table-wrapper')).toHaveClass(/ant-table-responsive/)
  })
})
```

## ğŸ“Š æµ‹è¯•æ•°æ®ç®¡ç†

### æµ‹è¯•æ•°æ®å·¥å‚
```java
// TestDataFactory.java
@Component
public class TestDataFactory {

    @Autowired
    private PasswordEncoder passwordEncoder;

    public UserEntity createUser(String userName, String email) {
        return UserEntity.builder()
                .userName(userName)
                .email(email)
                .password(passwordEncoder.encode("password123"))
                .status(1)
                .createTime(LocalDateTime.now())
                .updateTime(LocalDateTime.now())
                .deletedFlag(0)
                .version(0)
                .build();
    }

    public UserEntity createAdminUser() {
        return createUser("admin", "admin@example.com");
    }

    public UserEntity createNormalUser() {
        return createUser("user", "user@example.com");
    }

    public List<UserEntity> createUsers(int count) {
        List<UserEntity> users = new ArrayList<>();
        for (int i = 1; i <= count; i++) {
            users.add(createUser("user" + i, "user" + i + "@example.com"));
        }
        return users;
    }

    public UserAddForm createUserAddForm() {
        return UserAddForm.builder()
                .userName("newuser")
                .email("newuser@example.com")
                .password("password123")
                .status(1)
                .build();
    }
}
```

### æµ‹è¯•é…ç½®æ–‡ä»¶
```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  redis:
    host: localhost
    port: 6379
    database: 15 # ä½¿ç”¨ä¸“ç”¨æµ‹è¯•æ•°æ®åº“

# æµ‹è¯•é…ç½®
test:
  mock-external-apis: true
  disable-security: true
  cleanup-data: true

# æ—¥å¿—é…ç½®
logging:
  level:
    com.smart.admin: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Šå’Œç›‘æ§

### æµ‹è¯•è¦†ç›–ç‡é…ç½®
```xml
<!-- pom.xml -->
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.8</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
        <execution>
            <id>check</id>
            <goals>
                <goal>check</goal>
            </goals>
            <configuration>
                <rules>
                    <rule>
                        <element>BUNDLE</element>
                        <limits>
                            <limit>
                                <counter>INSTRUCTION</counter>
                                <value>COVEREDRATIO</value>
                                <minimum>0.80</minimum>
                            </limit>
                        </limits>
                    </rule>
                </rules>
            </configuration>
        </execution>
    </executions>
</plugin>
```

### è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿
```yaml
# .github/workflows/test.yml
name: Test Suite

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  unit-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Cache Maven dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}

    - name: Run unit tests
      run: mvn test

    - name: Generate test report
      run: mvn jacoco:report

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./target/site/jacoco/jacoco.xml

  integration-test:
    runs-on: ubuntu-latest
    needs: unit-test

    services:
      mysql:
        image: mysql:9.3
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: test_db
        ports:
          - 3306:3306
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3

      redis:
        image: redis:7
        ports:
          - 6379:6379
        options: --health-cmd="redis-cli ping" --health-interval=10s --health-timeout=5s --health-retries=3

    steps:
    - uses: actions/checkout@v3

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Run integration tests
      run: mvn test -Dtest="**/*IntegrationTest"
      env:
        SPRING_PROFILES_ACTIVE: test

  e2e-test:
    runs-on: ubuntu-latest
    needs: integration-test

    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm ci

    - name: Install Playwright
      run: npx playwright install --with-deps

    - name: Run E2E tests
      run: npx playwright test

    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: failure()
      with:
        name: playwright-report
        path: playwright-report/
```

---

**ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼š
1. **è´¨é‡ä¼˜å…ˆ** - ç¡®ä¿ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§
2. **è‡ªåŠ¨åŒ–ä¸ºä¸»** - å‡å°‘äººå·¥æµ‹è¯•ï¼Œæé«˜æ•ˆç‡
3. **åˆ†å±‚æµ‹è¯•** - å•å…ƒã€é›†æˆã€E2Eä¸‰å±‚è¦†ç›–
4. **æ•°æ®éš”ç¦»** - æµ‹è¯•æ•°æ®ç‹¬ç«‹ï¼Œä¸å½±å“ç”Ÿäº§
5. **æŒç»­ç›‘æ§** - å®æ—¶ç›‘æ§æµ‹è¯•è´¨é‡æŒ‡æ ‡

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [ä»£ç è¯„å®¡è§„èŒƒ](../02-æµç¨‹è§„èŒƒå±‚/ä»£ç è¯„å®¡è§„èŒƒ.md) - ä»£ç è´¨é‡ä¿è¯
- [APIè§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/APIè§„èŒƒ.md) - æ¥å£æµ‹è¯•æ ‡å‡†
- [å¤šç¯å¢ƒé…ç½®è§„èŒƒ](../01-æ ¸å¿ƒè§„èŒƒå±‚/å¤šç¯å¢ƒé…ç½®è§„èŒƒ.md) - æµ‹è¯•ç¯å¢ƒé…ç½®