# æ•°æ®è§„èŒƒï¼ˆæƒå¨æ–‡æ¡£ï¼‰

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v4.0.0 (æ•´åˆç‰ˆ)
> **ğŸ“‹ æ–‡æ¡£èŒè´£**: SmartAdminé¡¹ç›®çš„å”¯ä¸€æ•°æ®è§„èŒƒæƒå¨æ¥æºï¼ŒåŸºäºMySQL 9.3.0å’ŒMyBatis-Plus 3.5.12ï¼Œè´´åˆé¡¹ç›®å®é™…æƒ…å†µã€‚

## âš ï¸ æ•°æ®é“å¾‹ï¼ˆä¸å¯è¿åï¼‰

### ğŸš« ç»å¯¹ç¦æ­¢
```markdown
âŒ ç¦æ­¢ç‰©ç†åˆ é™¤æ•°æ®ï¼ˆå¿…é¡»ä½¿ç”¨è½¯åˆ é™¤ï¼‰
âŒ ç¦æ­¢ç¼ºå°‘å®¡è®¡å­—æ®µï¼ˆåˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ç­‰ï¼‰
âŒ ç¦æ­¢ä½¿ç”¨æ‹¼éŸ³æˆ–ä¸è§„èŒƒå‘½å
âŒ ç¦æ­¢ç¼ºå°‘å¿…è¦çš„ç´¢å¼•
âŒ ç¦æ­¢å¤§äº‹åŠ¡æ“ä½œï¼ˆè¶…è¿‡30ç§’ï¼‰
âŒ ç¦æ­¢è·¨æœåŠ¡ç›´æ¥è®¿é—®æ•°æ®åº“
âŒ ç¦æ­¢ç¼ºå°‘æ•°æ®å¤‡ä»½æœºåˆ¶
âŒ ç¦æ­¢æ•°æ®ä¸ä¸€è‡´çŠ¶æ€
```

### âœ… å¿…é¡»æ‰§è¡Œ
```markdown
âœ… å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒ
âœ… å¿…é¡»åŒ…å«å®Œæ•´çš„å®¡è®¡å­—æ®µ
âœ… å¿…é¡»å»ºç«‹åˆé€‚çš„ç´¢å¼•
âœ… å¿…é¡»ä½¿ç”¨è½¯åˆ é™¤æœºåˆ¶
âœ… å¿…é¡»ä¿è¯æ•°æ®ä¸€è‡´æ€§
âœ… å¿…é¡»å®ç°æ•°æ®å¤‡ä»½æ¢å¤
âœ… å¿…é¡»è¿›è¡Œæ•°æ®è„±æ•å¤„ç†
âœ… å¿…é¡»ç›‘æ§æ•°æ®è´¨é‡
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è§„èŒƒ

### è¡¨å‘½åè§„èŒƒ
```markdown
âœ… æ ¼å¼ï¼št_{business}_{entity}
âœ… ç¤ºä¾‹ï¼št_user_info, t_business_order, t_system_config
âœ… ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
âœ… åç§°è¦æœ‰ä¸šåŠ¡å«ä¹‰
âœ… é¿å…ä½¿ç”¨æ•°æ®åº“å…³é”®å­—
âŒ ç¦æ­¢ï¼šuser, order, config, t_user
âŒ ç¦æ­¢ï¼štUser, T_USER, user_table
```

### å­—æ®µå‘½åè§„èŒƒ
```markdown
âœ… ä¸»é”®å­—æ®µï¼š{entity}Idï¼ˆuserId, orderId, configIdï¼‰
âœ… å¤–é”®å­—æ®µï¼š{relatedEntity}Idï¼ˆuserId, deptId, roleIdï¼‰
âœ… æ™®é€šå­—æ®µï¼šå°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼ˆuser_name, create_timeï¼‰
âœ… æ ‡è®°å­—æ®µï¼š{business}Flagï¼ˆdisabled_flag, deleted_flagï¼‰
âœ… æ—¶é—´å­—æ®µï¼š{action}_timeï¼ˆcreate_time, update_timeï¼‰
âœ… çŠ¶æ€å­—æ®µï¼š{entity}_statusï¼ˆuser_status, order_statusï¼‰
âœ… æ•°é‡å­—æ®µï¼š{entity}_countï¼ˆuser_count, order_countï¼‰
âŒ ç¦æ­¢ï¼šuserName, createTime, FLAG
âŒ ç¦æ­¢ï¼šuser_name, createTime, is_deleted
```

### MySQL 9.3.0æ ‡å‡†è¡¨ç»“æ„æ¨¡æ¿
```sql
CREATE TABLE `t_{business}_{entity}` (
  `{entity}Id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '{å®ä½“}ID',
  `{business_name}` varchar(100) NOT NULL COMMENT '{ä¸šåŠ¡åç§°}',
  `{business_code}` varchar(50) DEFAULT NULL COMMENT '{ä¸šåŠ¡ç¼–ç }',
  `{status}` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'çŠ¶æ€ï¼š1-æ­£å¸¸ 0-ç¦ç”¨',
  `sort_value` int(11) NOT NULL DEFAULT '0' COMMENT 'æ’åºå€¼',
  `remark` varchar(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',

  -- å®¡è®¡å­—æ®µï¼ˆå¿…é¡»åŒ…å«ï¼‰
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'åˆ›å»ºæ—¶é—´ï¼ˆå¾®ç§’ç²¾åº¦ï¼‰',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6) COMMENT 'æ›´æ–°æ—¶é—´ï¼ˆå¾®ç§’ç²¾åº¦ï¼‰',
  `create_user_id` bigint(20) DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
  `update_user_id` bigint(20) DEFAULT NULL COMMENT 'æ›´æ–°äººID',
  `deleted_flag` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'åˆ é™¤æ ‡è®° 0-æ­£å¸¸ 1-åˆ é™¤',
  `version` int(11) NOT NULL DEFAULT '0' COMMENT 'ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰',

  -- MySQL 9.3.0æ–°ç‰¹æ€§ï¼šJSONå­—æ®µæ”¯æŒ
  `extend_info` json DEFAULT NULL COMMENT 'æ‰©å±•ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰',

  PRIMARY KEY (`{entity}Id`),

  -- æ™®é€šç´¢å¼•
  KEY `idx_create_time` (`create_time`),
  KEY `idx_update_time` (`update_time`),
  KEY `idx_status` (`status`),
  KEY `idx_create_user_id` (`create_user_id`),
  KEY `idx_{business_code}` (`{business_code}`),

  -- MySQL 9.3.0å‡½æ•°ç´¢å¼•
  KEY `idx_business_name_length` ((length(`{business_name}`))),
  KEY `idx_extend_info_json` ((cast(`extend_info` as unsigned))),

  -- JSONç´¢å¼•ï¼ˆMySQL 9.3.0æ”¯æŒï¼‰
  KEY `idx_extend_info_type` ((cast(`extend_info` ->> '$.type' as char(50))))

) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='{å®ä½“è¡¨}';
```

### MySQL 9.3.0æ•°æ®ç±»å‹é€‰æ‹©è§„èŒƒ
```markdown
âœ… ä¸»é”®ï¼šbigint(20) AUTO_INCREMENT
âœ… å§“å/åç§°ï¼švarchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci
âœ… ç¼–ç ï¼švarchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci
âœ… æ‰‹æœºå·ï¼švarchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci
âœ… é‚®ç®±ï¼švarchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci
âœ… é‡‘é¢ï¼šdecimal(20,8)ï¼ˆæ”¯æŒæ›´é«˜ç²¾åº¦ï¼‰
âœ… æ•°é‡ï¼šint(11) UNSIGNEDï¼ˆæ— ç¬¦å·ï¼‰
âœ… çŠ¶æ€ï¼štinyint(4) UNSIGNED
âœ… æ ‡è®°ï¼štinyint(1) UNSIGNED
âœ… æ—¶é—´ï¼šdatetime(6)ï¼ˆå¾®ç§’ç²¾åº¦ï¼‰
âœ… é•¿æ–‡æœ¬ï¼šlongtext
âœ… JSONæ•°æ®ï¼šjsonï¼ˆMySQL 9.3.0å¢å¼ºï¼‰
âœ… äºŒè¿›åˆ¶æ•°æ®ï¼švarbinary(1024)
âœ… UUIDï¼šchar(36) CHARACTER SET ascii
âŒ ç¦æ­¢ï¼šä½¿ç”¨floatå­˜å‚¨é‡‘é¢
âŒ ç¦æ­¢ï¼šä½¿ç”¨varcharå­˜å‚¨æ•°å­—
âŒ ç¦æ­¢ï¼šä½¿ç”¨textå­˜å‚¨å°‘é‡æ–‡å­—
âŒ ç¦æ­¢ï¼šä½¿ç”¨utf8å­—ç¬¦é›†ï¼ˆå¿…é¡»ç”¨utf8mb4ï¼‰
```

## ğŸ¯ ç´¢å¼•è®¾è®¡è§„èŒƒ

### ç´¢å¼•å‘½åè§„èŒƒ
```markdown
âœ… ä¸»é”®ç´¢å¼•ï¼šPRIMARY
âœ… å”¯ä¸€ç´¢å¼•ï¼šuk_{table}_{column}
âœ… æ™®é€šç´¢å¼•ï¼šidx_{table}_{column}
âœ… ç»„åˆç´¢å¼•ï¼šidx_{table}_{column1}_{column2}
âœ… å‰ç¼€ç´¢å¼•ï¼šidx_{table}_{column}_prefix
âœ… å…¨æ–‡ç´¢å¼•ï¼šft_{table}_{column}
âŒ ç¦æ­¢ï¼šindex_name, idx_name, user_index
```

### MySQL 9.3.0ç´¢å¼•è®¾è®¡åŸåˆ™
```markdown
âœ… ä¸ºç»å¸¸æŸ¥è¯¢çš„å­—æ®µåˆ›å»ºç´¢å¼•
âœ… ä¸ºå¤–é”®å­—æ®µåˆ›å»ºç´¢å¼•
âœ… ä¸ºORDER BYå­—æ®µåˆ›å»ºç´¢å¼•
âœ… ä¸ºGROUP BYå­—æ®µåˆ›å»ºç´¢å¼•
âœ… æ§åˆ¶ç´¢å¼•æ•°é‡ï¼ˆå•è¡¨ä¸è¶…è¿‡8ä¸ªï¼‰
âœ… è€ƒè™‘ç´¢å¼•çš„é€‰æ‹©æ€§ï¼ˆâ‰¥0.8ï¼‰
âœ… ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨
âœ… å®šæœŸåˆ†æå’Œä¼˜åŒ–ç´¢å¼•
âœ… ä½¿ç”¨MySQL 9.3.0çš„å‡½æ•°ç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½
âœ… ä½¿ç”¨JSONç´¢å¼•ä¼˜åŒ–JSONå­—æ®µæŸ¥è¯¢
âœ… ä½¿ç”¨å¤šå€¼ç´¢å¼•ä¼˜åŒ–æ•°ç»„ç±»å‹æ•°æ®
âŒ ç¦æ­¢ï¼šä¸ºä½é€‰æ‹©æ€§å­—æ®µåˆ›å»ºç´¢å¼•
âŒ ç¦æ­¢ï¼šåˆ›å»ºè¿‡å¤šçš„ç´¢å¼•
âŒ ç¦æ­¢ï¼šåˆ›å»ºé‡å¤çš„ç´¢å¼•
âŒ ç¦æ­¢ï¼šä»ä¸ä½¿ç”¨çš„ç´¢å¼•
```

### MySQL 9.3.0ç´¢å¼•ä¼˜åŒ–ç¤ºä¾‹
```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•è®¾è®¡ï¼ˆMySQL 9.3.0å¢å¼ºç‰ˆï¼‰
CREATE TABLE `t_user_info` (
  `userId` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `userName` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT 'ç”¨æˆ·å',
  `email` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT 'é‚®ç®±',
  `phone` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `status` tinyint(4) UNSIGNED NOT NULL DEFAULT '1' COMMENT 'çŠ¶æ€',
  `createTime` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) COMMENT 'åˆ›å»ºæ—¶é—´',
  `profile` json DEFAULT NULL COMMENT 'ç”¨æˆ·èµ„æ–™ï¼ˆJSONæ ¼å¼ï¼‰',
  `tags` json DEFAULT NULL COMMENT 'ç”¨æˆ·æ ‡ç­¾ï¼ˆJSONæ•°ç»„ï¼‰',
  PRIMARY KEY (`userId`),

  -- å”¯ä¸€ç´¢å¼•
  UNIQUE KEY `uk_user_userName` (`userName`),
  UNIQUE KEY `uk_user_email` (`email`),
  UNIQUE KEY `uk_user_phone` (`phone`),

  -- æ™®é€šç´¢å¼•
  KEY `idx_user_status` (`status`),
  KEY `idx_user_createTime` (`createTime`),
  KEY `idx_user_status_createTime` (`status`, `createTime`),

  -- MySQL 9.3.0å‡½æ•°ç´¢å¼•
  KEY `idx_userName_length` ((length(`userName`))),
  KEY `idx_phone_prefix` ((left(`phone`, 3))),

  -- JSONç´¢å¼•ï¼ˆMySQL 9.3.0æ–°ç‰¹æ€§ï¼‰
  KEY `idx_profile_age` ((cast(`profile` ->> '$.age' as unsigned))),
  KEY `idx_profile_city` ((cast(`profile` ->> '$.city' as char(50)))),

  -- å¤šå€¼ç´¢å¼•ï¼ˆMySQL 9.3.0æ–°ç‰¹æ€§ï¼‰
  KEY `idx_tags` ((cast(`tags` as char(50)) array))

) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='ç”¨æˆ·ä¿¡æ¯è¡¨';

-- MySQL 9.3.0åˆ†æè¡¨ä¼˜åŒ–
ANALYZE TABLE `t_user_info` PERSISTENT FOR ALL;

-- MySQL 9.3.0ç´¢å¼•å¯è§æ€§æ§åˆ¶ï¼ˆè°ƒè¯•ç”¨ï¼‰
ALTER TABLE `t_user_info` ALTER INDEX `idx_userName_length` INVISIBLE;
ALTER TABLE `t_user_info` ALTER INDEX `idx_userName_length` VISIBLE;
```

## ğŸ”„ æ•°æ®æ“ä½œè§„èŒƒ

### CRUDæ“ä½œè§„èŒƒ
```markdown
âœ… æŸ¥è¯¢æ“ä½œï¼šä½¿ç”¨é¢„ç¼–è¯‘SQLé˜²æ­¢SQLæ³¨å…¥
âœ… æ’å…¥æ“ä½œï¼šæ‰¹é‡æ’å…¥æ—¶æ§åˆ¶æ‰¹æ¬¡å¤§å°
âœ… æ›´æ–°æ“ä½œï¼šä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘å†²çª
âœ… åˆ é™¤æ“ä½œï¼šä½¿ç”¨è½¯åˆ é™¤ï¼Œç¦æ­¢ç‰©ç†åˆ é™¤
âœ… äº‹åŠ¡æ“ä½œï¼šæ§åˆ¶äº‹åŠ¡å¤§å°å’Œæ‰§è¡Œæ—¶é—´
âœ… åˆ†é¡µæŸ¥è¯¢ï¼šä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæ›¿ä»£OFFSET
âœ… æ•°æ®è½¬æ¢ï¼šä½¿ç”¨ä¸“é—¨çš„è½¬æ¢å·¥å…·
âœ… å¼‚å¸¸å¤„ç†ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
```

### MyBatis-Plus 3.5.12æœ€ä½³å®è·µ
```java
// BaseMapperæ‰©å±•æ¥å£
@Mapper
public interface UserDao extends BaseMapper<UserEntity> {

    /**
     * æ’å…¥ç”¨æˆ·ä¿¡æ¯ï¼ˆè‡ªåŠ¨å¡«å……å®¡è®¡å­—æ®µï¼‰
     */
    @Override
    @Insert("INSERT INTO t_user_info (userName, email, phone, status, createTime, createUserId) " +
            "VALUES (#{userName}, #{email}, #{phone}, #{status}, NOW(6), #{createUserId})")
    @Options(useGeneratedKeys = true, keyProperty = "userId")
    int insert(UserEntity user);

    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆä¹è§‚é” + è‡ªåŠ¨å¡«å……ï¼‰
     */
    @Update("UPDATE t_user_info SET " +
            "userName = #{userName}, " +
            "email = #{email}, " +
            "phone = #{phone}, " +
            "status = #{status}, " +
            "version = version + 1, " +
            "updateTime = NOW(6), " +
            "updateUserId = #{updateUserId} " +
            "WHERE userId = #{userId} AND version = #{version}")
    int updateByVersion(UserEntity user);

    /**
     * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ï¼ˆMyBatis-Plusåˆ†é¡µæ’ä»¶ï¼‰
     */
    @Select("<script>" +
            "SELECT * FROM t_user_info " +
            "WHERE deletedFlag = 0 " +
            "<if test='queryForm.userName != null and queryForm.userName != \"\"'>" +
            "AND userName LIKE CONCAT('%', #{queryForm.userName}, '%') " +
            "</if>" +
            "<if test='queryForm.status != null'>" +
            "AND status = #{queryForm.status} " +
            "</if>" +
            "<if test='queryForm.createTimeStart != null and queryForm.createTimeStart != \"\"'>" +
            "AND createTime >= #{queryForm.createTimeStart} " +
            "</if>" +
            "<if test='queryForm.createTimeEnd != null and queryForm.createTimeEnd != \"\"'>" +
            "AND createTime <= #{queryForm.createTimeEnd} " +
            "</if>" +
            "<if test='queryForm.profileCity != null and queryForm.profileCity != \"\"'>" +
            "AND profile ->> '$.city' = #{queryForm.profileCity} " +
            "</if>" +
            "ORDER BY createTime DESC " +
            "</script>")
    IPage<UserEntity> selectPage(Page<UserEntity> page, @Param("queryForm") UserQueryForm queryForm);

    /**
     * è½¯åˆ é™¤ç”¨æˆ·ï¼ˆMyBatis-Plusé€»è¾‘åˆ é™¤ï¼‰
     */
    @Update("UPDATE t_user_info SET " +
            "deletedFlag = 1, " +
            "updateTime = NOW(6), " +
            "updateUserId = #{updateUserId} " +
            "WHERE userId = #{userId}")
    int deleteSoft(@Param("userId") Long userId, @Param("updateUserId") Long updateUserId);

    /**
     * JSONå­—æ®µæŸ¥è¯¢ï¼ˆMySQL 9.3.0æ”¯æŒï¼‰
     */
    @Select("<script>" +
            "SELECT * FROM t_user_info " +
            "WHERE deletedFlag = 0 " +
            "<if test='minAge != null'>" +
            "AND (profile ->> '$.age')::UNSIGNED >= #{minAge} " +
            "</if>" +
            "<if test='city != null and city != \"\"'>" +
            "AND profile ->> '$.city' = #{city} " +
            "</if>" +
            "<if test='tag != null and tag != \"\"'>" +
            "AND JSON_CONTAINS(tags, '\"#{tag}\"') " +
            "</if>" +
            "</script>")
    List<UserEntity> selectByJsonCondition(@Param("minAge") Integer minAge,
                                          @Param("city") String city,
                                          @Param("tag") String tag);
}

// å®ä½“ç±»ï¼ˆMyBatis-Plusæ³¨è§£ï¼‰
@Data
@TableName("t_user_info")
public class UserEntity {

    @TableId(type = IdType.AUTO)
    private Long userId;

    @TableField("userName")
    private String userName;

    @TableField("email")
    private String email;

    @TableField("phone")
    private String phone;

    @TableField("status")
    private Integer status;

    @TableField(value = "createTime", fill = FieldFill.INSERT)
    private LocalDateTime createTime;

    @TableField(value = "updateTime", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;

    @TableField("createUserId")
    private Long createUserId;

    @TableField("updateUserId")
    private Long updateUserId;

    @TableField("deletedFlag")
    @TableLogic
    private Integer deletedFlag;

    @Version
    @TableField("version")
    private Integer version;

    @TableField(typeHandler = JacksonTypeHandler.class)
    private UserProfile profile; // JSONå­—æ®µ

    @TableField(typeHandler = JacksonTypeHandler.class)
    private List<String> tags; // JSONæ•°ç»„å­—æ®µ
}

// JSONå­—æ®µç±»å‹å®šä¹‰
@Data
public class UserProfile {
    private Integer age;
    private String city;
    private String province;
    private String avatar;
    private Map<String, Object> extend;
}
```

## ğŸ“Š æ•°æ®è´¨é‡ç®¡ç†

### æ•°æ®å®Œæ•´æ€§
```markdown
âœ… å®ä½“å®Œæ•´æ€§ï¼šä¸»é”®å”¯ä¸€ä¸”éç©º
âœ… åŸŸå®Œæ•´æ€§ï¼šå­—æ®µç±»å‹å’Œçº¦æŸæ­£ç¡®
âœ… å¼•ç”¨å®Œæ•´æ€§ï¼šå¤–é”®å…³ç³»æ­£ç¡®
âœ… ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§ï¼šä¸šåŠ¡è§„åˆ™æ­£ç¡®
âœ… æ•°æ®ä¸€è‡´æ€§ï¼šç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´
âœ… æ•°æ®å‡†ç¡®æ€§ï¼šæ•°æ®çœŸå®å¯é 
âœ… æ•°æ®åŠæ—¶æ€§ï¼šæ•°æ®æ›´æ–°åŠæ—¶
âœ… æ•°æ®å”¯ä¸€æ€§ï¼šé¿å…é‡å¤æ•°æ®
```

### æ•°æ®è´¨é‡ç›‘æ§
```java
@Component
@Slf4j
public class DataQualityMonitor {

    /**
     * æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
     */
    @Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    public void checkDataIntegrity() {
        try {
            // æ£€æŸ¥å­¤ç«‹æ•°æ®
            this.checkOrphanedData();

            // æ£€æŸ¥é‡å¤æ•°æ®
            this.checkDuplicateData();

            // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
            this.checkDataConsistency();

            // æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
            this.checkDataCompleteness();

            log.info("æ•°æ®è´¨é‡æ£€æŸ¥å®Œæˆ");
        } catch (Exception e) {
            log.error("æ•°æ®è´¨é‡æ£€æŸ¥å¤±è´¥", e);
        }
    }

    /**
     * æ£€æŸ¥å­¤ç«‹æ•°æ®
     */
    private void checkOrphanedData() {
        // æ£€æŸ¥ç”¨æˆ·è§’è‰²è¡¨ä¸­çš„å­¤ç«‹è®°å½•
        String sql = "SELECT ur.userId FROM t_user_role ur " +
                    "LEFT JOIN t_user_info u ON ur.userId = u.userId " +
                    "WHERE u.userId IS NULL AND ur.deletedFlag = 0";

        List<Long> orphanedUserIds = jdbcTemplate.queryForList(sql, Long.class);
        if (!orphanedUserIds.isEmpty()) {
            log.warn("å‘ç°{}æ¡å­¤ç«‹çš„ç”¨æˆ·è§’è‰²è®°å½•", orphanedUserIds.size());
            // å‘é€å‘Šè­¦é€šçŸ¥
            alertService.sendDataQualityAlert("å‘ç°å­¤ç«‹çš„ç”¨æˆ·è§’è‰²è®°å½•", orphanedUserIds);
        }
    }

    /**
     * æ£€æŸ¥é‡å¤æ•°æ®
     */
    private void checkDuplicateData() {
        // æ£€æŸ¥é‡å¤çš„ç”¨æˆ·å
        String sql = "SELECT userName, COUNT(*) as cnt FROM t_user_info " +
                    "WHERE deletedFlag = 0 GROUP BY userName HAVING cnt > 1";

        List<Map<String, Object>> duplicateUsers = jdbcTemplate.queryForList(sql);
        if (!duplicateUsers.isEmpty()) {
            log.warn("å‘ç°{}ä¸ªé‡å¤çš„ç”¨æˆ·å", duplicateUsers.size());
            alertService.sendDataQualityAlert("å‘ç°é‡å¤çš„ç”¨æˆ·å", duplicateUsers);
        }
    }
}
```

## ğŸš« æ•°æ®å®‰å…¨è§„èŒƒ

### æ•°æ®è„±æ•
```markdown
âœ… èº«ä»½è¯å·ï¼šæ˜¾ç¤ºå‰6ä½å’Œå4ä½
âœ… æ‰‹æœºå·ï¼šæ˜¾ç¤ºå‰3ä½å’Œå4ä½
âœ… é“¶è¡Œå¡å·ï¼šæ˜¾ç¤ºå‰4ä½å’Œå4ä½
âœ… é‚®ç®±ï¼šæ˜¾ç¤ºå‰1ä½å’Œ@ç¬¦å·åå†…å®¹
âœ… å§“åï¼šæ˜¾ç¤ºå§“æ°å’Œåå­—é¦–å­—
âœ… åœ°å€ï¼šåªæ˜¾ç¤ºçœå¸‚åŒºä¿¡æ¯
âœ… å¯†ç ï¼šå®Œå…¨éšè—ï¼Œæ˜¾ç¤ºä¸º******
âœ… æ•æ„Ÿé…ç½®ï¼šéƒ¨åˆ†éšè—å…³é”®ä¿¡æ¯
```

### MySQL 9.3.0æ•°æ®å¤‡ä»½ç­–ç•¥
```markdown
âœ… å…¨é‡å¤‡ä»½ï¼šæ¯å¤©å‡Œæ™¨ä½¿ç”¨mysqldumpè¿›è¡Œå…¨é‡å¤‡ä»½
âœ… å¢é‡å¤‡ä»½ï¼šæ¯å°æ—¶è¿›è¡Œå¢é‡å¤‡ä»½ï¼ˆåŸºäºbinlogï¼‰
âœ… äºŒè¿›åˆ¶æ—¥å¿—ï¼šå®æ—¶å¤‡ä»½äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆMySQL 9.3.0å¢å¼ºï¼‰
âœ… å¼‚åœ°å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶å­˜å‚¨åˆ°å¼‚åœ°äº‘å­˜å‚¨
âœ… å¤‡ä»½éªŒè¯ï¼šå®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
âœ… æ¢å¤æµ‹è¯•ï¼šå®šæœŸè¿›è¡Œæ¢å¤æµ‹è¯•
âœ… å¤‡ä»½ç›‘æ§ï¼šç›‘æ§å¤‡ä»½ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
âœ… å¤‡ä»½ä¿ç•™ï¼šä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½æ–‡ä»¶
âœ… å‹ç¼©å¤‡ä»½ï¼šä½¿ç”¨zstdå‹ç¼©ç®—æ³•å‡å°‘å­˜å‚¨ç©ºé—´
âœ… åŠ å¯†å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶ä½¿ç”¨AES-256åŠ å¯†å­˜å‚¨
```

### MySQL 9.3.0å¤‡ä»½è„šæœ¬ç¤ºä¾‹
```bash
#!/bin/bash
# MySQL 9.3.0å¤‡ä»½è„šæœ¬

# é…ç½®å‚æ•°
DB_HOST="localhost"
DB_PORT="3306"
DB_USER="backup_user"
DB_PASSWORD="backup_password"
DB_NAME="smart_admin"
BACKUP_DIR="/data/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
LOG_FILE="/var/log/mysql_backup.log"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å…¨é‡å¤‡ä»½ï¼ˆä½¿ç”¨MySQL 9.3.0æ–°ç‰¹æ€§ï¼‰
echo "[$DATE] å¼€å§‹å…¨é‡å¤‡ä»½..." >> $LOG_FILE
mysqldump \
    --host=$DB_HOST \
    --port=$DB_PORT \
    --user=$DB_USER \
    --password=$DB_PASSWORD \
    --single-transaction \
    --routines \
    --triggers \
    --events \
    --hex-blob \
    --set-gtid-purged=OFF \
    --default-character-set=utf8mb4 \
    --tz-utc \
    $DB_NAME | zstd -19 > $BACKUP_DIR/full_backup_$DATE.sql.zst

# æ£€æŸ¥å¤‡ä»½ç»“æœ
if [ ${PIPESTATUS[0]} -eq 0 ]; then
    echo "[$DATE] å…¨é‡å¤‡ä»½æˆåŠŸ: full_backup_$DATE.sql.zst" >> $LOG_FILE

    # ä¸Šä¼ åˆ°äº‘å­˜å‚¨ï¼ˆç¤ºä¾‹ï¼šé˜¿é‡Œäº‘OSSï¼‰
    ossutil cp $BACKUP_DIR/full_backup_$DATE.sql.zst oss://smart-admin-backup/mysql/

    # æ¸…ç†æœ¬åœ°æ—§å¤‡ä»½ï¼ˆä¿ç•™7å¤©ï¼‰
    find $BACKUP_DIR -name "full_backup_*.sql.zst" -mtime +7 -delete
else
    echo "[$DATE] å…¨é‡å¤‡ä»½å¤±è´¥!" >> $LOG_FILE
    # å‘é€å‘Šè­¦
    curl -X POST "https://api.alertmanager.com/alerts" \
         -H "Content-Type: application/json" \
         -d '{"alertname":"MySQLå¤‡ä»½å¤±è´¥","severity":"critical"}'
fi

# å¢é‡å¤‡ä»½ï¼ˆåŸºäºbinlogï¼‰
echo "[$DATE] å¼€å§‹å¢é‡å¤‡ä»½..." >> $LOG_FILE
mysqlbinlog \
    --host=$DB_HOST \
    --port=$DB_PORT \
    --user=$DB_USER \
    --password=$DB_PASSWORD \
    --read-from-remote-server \
    --raw \
    --stop-never \
    --result-file=$BACKUP_DIR/binlog/ \
    mysql-bin

echo "[$DATE] å¤‡ä»½å®Œæˆ" >> $LOG_FILE
```

---

**ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼š
1. **æ•°æ®ä¸€è‡´æ€§** - ç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§
2. **æ€§èƒ½ä¼˜å…ˆ** - é€šè¿‡ä¼˜åŒ–è®¾è®¡æå‡æ•°æ®æ“ä½œæ€§èƒ½
3. **å®‰å…¨ç¬¬ä¸€** - ä¿æŠ¤æ•æ„Ÿæ•°æ®çš„å®‰å…¨
4. **å¯ç»´æŠ¤æ€§** - è®¾è®¡æ˜“äºç»´æŠ¤çš„æ•°æ®ç»“æ„
5. **å¯æ‰©å±•æ€§** - æ”¯æŒä¸šåŠ¡å¢é•¿å’Œæ•°æ®æ‰©å±•

**ğŸ“– ç›¸å…³æ–‡æ¡£**ï¼š
- [æ¶æ„è§„èŒƒ](./æ¶æ„è§„èŒƒ.md) - æ•°æ®åº“æ¶æ„è®¾è®¡
- [ç¼–ç è§„èŒƒ](./ç¼–ç è§„èŒƒ.md) - æ•°æ®æ“ä½œç¼–ç è§„èŒƒ
- [å®‰å…¨è§„èŒƒ](./å®‰å…¨è§„èŒƒ.md) - æ•°æ®å®‰å…¨ç›¸å…³è§„èŒƒ